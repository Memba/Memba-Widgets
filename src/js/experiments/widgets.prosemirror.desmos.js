// https://teacher.desmos.com/demo/prosemirror

var __extends;
var __assign;
var __rest;
var __decorate;
var __param;
var __metadata;
var __awaiter;
var __generator;
var __exportStar;
var __values;
var __read;
var __spread;
var __spreadArrays;
var __await;
var __asyncGenerator;
var __asyncDelegator;
var __asyncValues;
var __makeTemplateObject;
var __importStar;
var __importDefault;
(function(factory) {
        var root = typeof global === "object" ? global : typeof self === "object" ? self : typeof this === "object" ? this : {};
        if (typeof define === "function" && define.amd) {
            define("tslib", ["exports"], function(exports) {
                factory(createExporter(root, createExporter(exports)))
            })
        } else if (typeof module === "object" && typeof module.exports === "object") {
            factory(createExporter(root, createExporter(module.exports)))
        } else {
            factory(createExporter(root))
        }
        function createExporter(exports, previous) {
            if (exports !== root) {
                if (typeof Object.create === "function") {
                    Object.defineProperty(exports, "__esModule", {
                        value: true
                    })
                } else {
                    exports.__esModule = true
                }
            }
            return function(id, v) {
                return exports[id] = previous ? previous(id, v) : v
            }
        }
    }
)(function(exporter) {
    var extendStatics = Object.setPrototypeOf || {
            __proto__: []
        }instanceof Array && function(d, b) {
            d.__proto__ = b
        }
        || function(d, b) {
            for (var p in b)
                if (b.hasOwnProperty(p))
                    d[p] = b[p]
        }
    ;
    __extends = function(d, b) {
        extendStatics(d, b);
        function __() {
            this.constructor = d
        }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype,
            new __)
    }
    ;
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s)
                if (Object.prototype.hasOwnProperty.call(s, p))
                    t[p] = s[p]
        }
        return t
    }
    ;
    __rest = function(s, e) {
        var t = {};
        for (var p in s)
            if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
                t[p] = s[p];
        if (s != null && typeof Object.getOwnPropertySymbols === "function")
            for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
                if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                    t[p[i]] = s[p[i]]
            }
        return t
    }
    ;
    __decorate = function(decorators, target, key, desc) {
        var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
        if (typeof Reflect === "object" && typeof Reflect.decorate === "function")
            r = Reflect.decorate(decorators, target, key, desc);
        else
            for (var i = decorators.length - 1; i >= 0; i--)
                if (d = decorators[i])
                    r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
        return c > 3 && r && Object.defineProperty(target, key, r),
            r
    }
    ;
    __param = function(paramIndex, decorator) {
        return function(target, key) {
            decorator(target, key, paramIndex)
        }
    }
    ;
    __metadata = function(metadataKey, metadataValue) {
        if (typeof Reflect === "object" && typeof Reflect.metadata === "function")
            return Reflect.metadata(metadataKey, metadataValue)
    }
    ;
    __awaiter = function(thisArg, _arguments, P, generator) {
        return new (P || (P = Promise))(function(resolve, reject) {
                function fulfilled(value) {
                    try {
                        step(generator.next(value))
                    } catch (e) {
                        reject(e)
                    }
                }
                function rejected(value) {
                    try {
                        step(generator["throw"](value))
                    } catch (e) {
                        reject(e)
                    }
                }
                function step(result) {
                    result.done ? resolve(result.value) : new P(function(resolve) {
                            resolve(result.value)
                        }
                    ).then(fulfilled, rejected)
                }
                step((generator = generator.apply(thisArg, _arguments || [])).next())
            }
        )
    }
    ;
    __generator = function(thisArg, body) {
        var _ = {
            label: 0,
            sent: function() {
                if (t[0] & 1)
                    throw t[1];
                return t[1]
            },
            trys: [],
            ops: []
        }, f, y, t, g;
        return g = {
            next: verb(0),
            throw: verb(1),
            return: verb(2)
        },
        typeof Symbol === "function" && (g[Symbol.iterator] = function() {
                return this
            }
        ),
            g;
        function verb(n) {
            return function(v) {
                return step([n, v])
            }
        }
        function step(op) {
            if (f)
                throw new TypeError("Generator is already executing.");
            while (_)
                try {
                    if (f = 1,
                    y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y),
                        0) : y.next) && !(t = t.call(y, op[1])).done)
                        return t;
                    if (y = 0,
                        t)
                        op = [op[0] & 2, t.value];
                    switch (op[0]) {
                        case 0:
                        case 1:
                            t = op;
                            break;
                        case 4:
                            _.label++;
                            return {
                                value: op[1],
                                done: false
                            };
                        case 5:
                            _.label++;
                            y = op[1];
                            op = [0];
                            continue;
                        case 7:
                            op = _.ops.pop();
                            _.trys.pop();
                            continue;
                        default:
                            if (!(t = _.trys,
                                t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {
                                _ = 0;
                                continue
                            }
                            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {
                                _.label = op[1];
                                break
                            }
                            if (op[0] === 6 && _.label < t[1]) {
                                _.label = t[1];
                                t = op;
                                break
                            }
                            if (t && _.label < t[2]) {
                                _.label = t[2];
                                _.ops.push(op);
                                break
                            }
                            if (t[2])
                                _.ops.pop();
                            _.trys.pop();
                            continue
                    }
                    op = body.call(thisArg, _)
                } catch (e) {
                    op = [6, e];
                    y = 0
                } finally {
                    f = t = 0
                }
            if (op[0] & 5)
                throw op[1];
            return {
                value: op[0] ? op[1] : void 0,
                done: true
            }
        }
    }
    ;
    __exportStar = function(m, exports) {
        for (var p in m)
            if (!exports.hasOwnProperty(p))
                exports[p] = m[p]
    }
    ;
    __values = function(o) {
        var m = typeof Symbol === "function" && o[Symbol.iterator]
            , i = 0;
        if (m)
            return m.call(o);
        return {
            next: function() {
                if (o && i >= o.length)
                    o = void 0;
                return {
                    value: o && o[i++],
                    done: !o
                }
            }
        }
    }
    ;
    __read = function(o, n) {
        var m = typeof Symbol === "function" && o[Symbol.iterator];
        if (!m)
            return o;
        var i = m.call(o), r, ar = [], e;
        try {
            while ((n === void 0 || n-- > 0) && !(r = i.next()).done)
                ar.push(r.value)
        } catch (error) {
            e = {
                error: error
            }
        } finally {
            try {
                if (r && !r.done && (m = i["return"]))
                    m.call(i)
            } finally {
                if (e)
                    throw e.error
            }
        }
        return ar
    }
    ;
    __spread = function() {
        for (var ar = [], i = 0; i < arguments.length; i++)
            ar = ar.concat(__read(arguments[i]));
        return ar
    }
    ;
    __spreadArrays = function() {
        for (var s = 0, i = 0, il = arguments.length; i < il; i++)
            s += arguments[i].length;
        for (var r = Array(s), k = 0, i = 0; i < il; i++)
            for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++,
                k++)
                r[k] = a[j];
        return r
    }
    ;
    __await = function(v) {
        return this instanceof __await ? (this.v = v,
            this) : new __await(v)
    }
    ;
    __asyncGenerator = function(thisArg, _arguments, generator) {
        if (!Symbol.asyncIterator)
            throw new TypeError("Symbol.asyncIterator is not defined.");
        var g = generator.apply(thisArg, _arguments || []), i, q = [];
        return i = {},
            verb("next"),
            verb("throw"),
            verb("return"),
            i[Symbol.asyncIterator] = function() {
                return this
            }
            ,
            i;
        function verb(n) {
            if (g[n])
                i[n] = function(v) {
                    return new Promise(function(a, b) {
                            q.push([n, v, a, b]) > 1 || resume(n, v)
                        }
                    )
                }
        }
        function resume(n, v) {
            try {
                step(g[n](v))
            } catch (e) {
                settle(q[0][3], e)
            }
        }
        function step(r) {
            r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r)
        }
        function fulfill(value) {
            resume("next", value)
        }
        function reject(value) {
            resume("throw", value)
        }
        function settle(f, v) {
            if (f(v),
                q.shift(),
                q.length)
                resume(q[0][0], q[0][1])
        }
    }
    ;
    __asyncDelegator = function(o) {
        var i, p;
        return i = {},
            verb("next"),
            verb("throw", function(e) {
                throw e
            }),
            verb("return"),
            i[Symbol.iterator] = function() {
                return this
            }
            ,
            i;
        function verb(n, f) {
            i[n] = o[n] ? function(v) {
                    return (p = !p) ? {
                        value: __await(o[n](v)),
                        done: n === "return"
                    } : f ? f(v) : v
                }
                : f
        }
    }
    ;
    __asyncValues = function(o) {
        if (!Symbol.asyncIterator)
            throw new TypeError("Symbol.asyncIterator is not defined.");
        var m = o[Symbol.asyncIterator], i;
        return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](),
            i = {},
            verb("next"),
            verb("throw"),
            verb("return"),
            i[Symbol.asyncIterator] = function() {
                return this
            }
            ,
            i);
        function verb(n) {
            i[n] = o[n] && function(v) {
                return new Promise(function(resolve, reject) {
                        v = o[n](v),
                            settle(resolve, reject, v.done, v.value)
                    }
                )
            }
        }
        function settle(resolve, reject, d, v) {
            Promise.resolve(v).then(function(v) {
                resolve({
                    value: v,
                    done: d
                })
            }, reject)
        }
    }
    ;
    __makeTemplateObject = function(cooked, raw) {
        if (Object.defineProperty) {
            Object.defineProperty(cooked, "raw", {
                value: raw
            })
        } else {
            cooked.raw = raw
        }
        return cooked
    }
    ;
    __importStar = function(mod) {
        if (mod && mod.__esModule)
            return mod;
        var result = {};
        if (mod != null)
            for (var k in mod)
                if (Object.hasOwnProperty.call(mod, k))
                    result[k] = mod[k];
        result["default"] = mod;
        return result
    }
    ;
    __importDefault = function(mod) {
        return mod && mod.__esModule ? mod : {
            default: mod
        }
    }
    ;
    exporter("__extends", __extends);
    exporter("__assign", __assign);
    exporter("__rest", __rest);
    exporter("__decorate", __decorate);
    exporter("__param", __param);
    exporter("__metadata", __metadata);
    exporter("__awaiter", __awaiter);
    exporter("__generator", __generator);
    exporter("__exportStar", __exportStar);
    exporter("__values", __values);
    exporter("__read", __read);
    exporter("__spread", __spread);
    exporter("__spreadArrays", __spreadArrays);
    exporter("__await", __await);
    exporter("__asyncGenerator", __asyncGenerator);
    exporter("__asyncDelegator", __asyncDelegator);
    exporter("__asyncValues", __asyncValues);
    exporter("__makeTemplateObject", __makeTemplateObject);
    exporter("__importStar", __importStar);
    exporter("__importDefault", __importDefault)
});
(function(global, factory) {
        if (typeof module === "object" && typeof module.exports === "object") {
            module.exports = global.document ? factory(global, true) : function(w) {
                if (!w.document) {
                    throw new Error("jQuery requires a window with a document")
                }
                return factory(w)
            }
        } else {
            factory(global)
        }
    }
)(typeof window !== "undefined" ? window : this, function(window, noGlobal) {
    var arr = [];
    var document = window.document;
    var slice = arr.slice;
    var concat = arr.concat;
    var push = arr.push;
    var indexOf = arr.indexOf;
    var class2type = {};
    var toString = class2type.toString;
    var hasOwn = class2type.hasOwnProperty;
    var support = {};
    var version = "2.2.4"
        , jQuery = function(selector, context) {
        return new jQuery.fn.init(selector,context)
    }
        , rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g
        , rmsPrefix = /^-ms-/
        , rdashAlpha = /-([\da-z])/gi
        , fcamelCase = function(all, letter) {
        return letter.toUpperCase()
    };
    jQuery.fn = jQuery.prototype = {
        jquery: version,
        constructor: jQuery,
        selector: "",
        length: 0,
        toArray: function() {
            return slice.call(this)
        },
        get: function(num) {
            return num != null ? num < 0 ? this[num + this.length] : this[num] : slice.call(this)
        },
        pushStack: function(elems) {
            var ret = jQuery.merge(this.constructor(), elems);
            ret.prevObject = this;
            ret.context = this.context;
            return ret
        },
        each: function(callback) {
            return jQuery.each(this, callback)
        },
        map: function(callback) {
            return this.pushStack(jQuery.map(this, function(elem, i) {
                return callback.call(elem, i, elem)
            }))
        },
        slice: function() {
            return this.pushStack(slice.apply(this, arguments))
        },
        first: function() {
            return this.eq(0)
        },
        last: function() {
            return this.eq(-1)
        },
        eq: function(i) {
            var len = this.length
                , j = +i + (i < 0 ? len : 0);
            return this.pushStack(j >= 0 && j < len ? [this[j]] : [])
        },
        end: function() {
            return this.prevObject || this.constructor()
        },
        push: push,
        sort: arr.sort,
        splice: arr.splice
    };
    jQuery.extend = jQuery.fn.extend = function() {
        var options, name, src, copy, copyIsArray, clone, target = arguments[0] || {}, i = 1, length = arguments.length, deep = false;
        if (typeof target === "boolean") {
            deep = target;
            target = arguments[i] || {};
            i++
        }
        if (typeof target !== "object" && !jQuery.isFunction(target)) {
            target = {}
        }
        if (i === length) {
            target = this;
            i--
        }
        for (; i < length; i++) {
            if ((options = arguments[i]) != null) {
                for (name in options) {
                    src = target[name];
                    copy = options[name];
                    if (target === copy) {
                        continue
                    }
                    if (deep && copy && (jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)))) {
                        if (copyIsArray) {
                            copyIsArray = false;
                            clone = src && jQuery.isArray(src) ? src : []
                        } else {
                            clone = src && jQuery.isPlainObject(src) ? src : {}
                        }
                        target[name] = jQuery.extend(deep, clone, copy)
                    } else if (copy !== undefined) {
                        target[name] = copy
                    }
                }
            }
        }
        return target
    }
    ;
    jQuery.extend({
        expando: "jQuery" + (version + Math.random()).replace(/\D/g, ""),
        isReady: true,
        error: function(msg) {
            throw new Error(msg)
        },
        noop: function() {},
        isFunction: function(obj) {
            return jQuery.type(obj) === "function"
        },
        isArray: Array.isArray,
        isWindow: function(obj) {
            return obj != null && obj === obj.window
        },
        isNumeric: function(obj) {
            var realStringObj = obj && obj.toString();
            return !jQuery.isArray(obj) && realStringObj - parseFloat(realStringObj) + 1 >= 0
        },
        isPlainObject: function(obj) {
            var key;
            if (jQuery.type(obj) !== "object" || obj.nodeType || jQuery.isWindow(obj)) {
                return false
            }
            if (obj.constructor && !hasOwn.call(obj, "constructor") && !hasOwn.call(obj.constructor.prototype || {}, "isPrototypeOf")) {
                return false
            }
            for (key in obj) {}
            return key === undefined || hasOwn.call(obj, key)
        },
        isEmptyObject: function(obj) {
            var name;
            for (name in obj) {
                return false
            }
            return true
        },
        type: function(obj) {
            if (obj == null) {
                return obj + ""
            }
            return typeof obj === "object" || typeof obj === "function" ? class2type[toString.call(obj)] || "object" : typeof obj
        },
        globalEval: function(code) {
            var script, indirect = eval;
            code = jQuery.trim(code);
            if (code) {
                if (code.indexOf("use strict") === 1) {
                    script = document.createElement("script");
                    script.text = code;
                    document.head.appendChild(script).parentNode.removeChild(script)
                } else {
                    indirect(code)
                }
            }
        },
        camelCase: function(string) {
            return string.replace(rmsPrefix, "ms-").replace(rdashAlpha, fcamelCase)
        },
        nodeName: function(elem, name) {
            return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase()
        },
        each: function(obj, callback) {
            var length, i = 0;
            if (isArrayLike(obj)) {
                length = obj.length;
                for (; i < length; i++) {
                    if (callback.call(obj[i], i, obj[i]) === false) {
                        break
                    }
                }
            } else {
                for (i in obj) {
                    if (callback.call(obj[i], i, obj[i]) === false) {
                        break
                    }
                }
            }
            return obj
        },
        trim: function(text) {
            return text == null ? "" : (text + "").replace(rtrim, "")
        },
        makeArray: function(arr, results) {
            var ret = results || [];
            if (arr != null) {
                if (isArrayLike(Object(arr))) {
                    jQuery.merge(ret, typeof arr === "string" ? [arr] : arr)
                } else {
                    push.call(ret, arr)
                }
            }
            return ret
        },
        inArray: function(elem, arr, i) {
            return arr == null ? -1 : indexOf.call(arr, elem, i)
        },
        merge: function(first, second) {
            var len = +second.length
                , j = 0
                , i = first.length;
            for (; j < len; j++) {
                first[i++] = second[j]
            }
            first.length = i;
            return first
        },
        grep: function(elems, callback, invert) {
            var callbackInverse, matches = [], i = 0, length = elems.length, callbackExpect = !invert;
            for (; i < length; i++) {
                callbackInverse = !callback(elems[i], i);
                if (callbackInverse !== callbackExpect) {
                    matches.push(elems[i])
                }
            }
            return matches
        },
        map: function(elems, callback, arg) {
            var length, value, i = 0, ret = [];
            if (isArrayLike(elems)) {
                length = elems.length;
                for (; i < length; i++) {
                    value = callback(elems[i], i, arg);
                    if (value != null) {
                        ret.push(value)
                    }
                }
            } else {
                for (i in elems) {
                    value = callback(elems[i], i, arg);
                    if (value != null) {
                        ret.push(value)
                    }
                }
            }
            return concat.apply([], ret)
        },
        guid: 1,
        proxy: function(fn, context) {
            var tmp, args, proxy;
            if (typeof context === "string") {
                tmp = fn[context];
                context = fn;
                fn = tmp
            }
            if (!jQuery.isFunction(fn)) {
                return undefined
            }
            args = slice.call(arguments, 2);
            proxy = function() {
                return fn.apply(context || this, args.concat(slice.call(arguments)))
            }
            ;
            proxy.guid = fn.guid = fn.guid || jQuery.guid++;
            return proxy
        },
        now: Date.now,
        support: support
    });
    if (typeof Symbol === "function") {
        jQuery.fn[Symbol.iterator] = arr[Symbol.iterator]
    }
    jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "), function(i, name) {
        class2type["[object " + name + "]"] = name.toLowerCase()
    });
    function isArrayLike(obj) {
        var length = !!obj && "length"in obj && obj.length
            , type = jQuery.type(obj);
        if (type === "function" || jQuery.isWindow(obj)) {
            return false
        }
        return type === "array" || length === 0 || typeof length === "number" && length > 0 && length - 1 in obj
    }
    var Sizzle = function(window) {
        var i, support, Expr, getText, isXML, tokenize, compile, select, outermostContext, sortInput, hasDuplicate, setDocument, document, docElem, documentIsHTML, rbuggyQSA, rbuggyMatches, matches, contains, expando = "sizzle" + 1 * new Date, preferredDoc = window.document, dirruns = 0, done = 0, classCache = createCache(), tokenCache = createCache(), compilerCache = createCache(), sortOrder = function(a, b) {
            if (a === b) {
                hasDuplicate = true
            }
            return 0
        }, MAX_NEGATIVE = 1 << 31, hasOwn = {}.hasOwnProperty, arr = [], pop = arr.pop, push_native = arr.push, push = arr.push, slice = arr.slice, indexOf = function(list, elem) {
            var i = 0
                , len = list.length;
            for (; i < len; i++) {
                if (list[i] === elem) {
                    return i
                }
            }
            return -1
        }, booleans = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", whitespace = "[\\x20\\t\\r\\n\\f]", identifier = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", attributes = "\\[" + whitespace + "*(" + identifier + ")(?:" + whitespace + "*([*^$|!~]?=)" + whitespace + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + identifier + "))|)" + whitespace + "*\\]", pseudos = ":(" + identifier + ")(?:\\((" + "('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|" + "((?:\\\\.|[^\\\\()[\\]]|" + attributes + ")*)|" + ".*" + ")\\)|)", rwhitespace = new RegExp(whitespace + "+","g"), rtrim = new RegExp("^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$","g"), rcomma = new RegExp("^" + whitespace + "*," + whitespace + "*"), rcombinators = new RegExp("^" + whitespace + "*([>+~]|" + whitespace + ")" + whitespace + "*"), rattributeQuotes = new RegExp("=" + whitespace + "*([^\\]'\"]*?)" + whitespace + "*\\]","g"), rpseudo = new RegExp(pseudos), ridentifier = new RegExp("^" + identifier + "$"), matchExpr = {
            ID: new RegExp("^#(" + identifier + ")"),
            CLASS: new RegExp("^\\.(" + identifier + ")"),
            TAG: new RegExp("^(" + identifier + "|[*])"),
            ATTR: new RegExp("^" + attributes),
            PSEUDO: new RegExp("^" + pseudos),
            CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + whitespace + "*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace + "*(\\d+)|))" + whitespace + "*\\)|)","i"),
            bool: new RegExp("^(?:" + booleans + ")$","i"),
            needsContext: new RegExp("^" + whitespace + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + whitespace + "*((?:-\\d)?\\d*)" + whitespace + "*\\)|)(?=[^-]|$)","i")
        }, rinputs = /^(?:input|select|textarea|button)$/i, rheader = /^h\d$/i, rnative = /^[^{]+\{\s*\[native \w/, rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, rsibling = /[+~]/, rescape = /'|\\/g, runescape = new RegExp("\\\\([\\da-f]{1,6}" + whitespace + "?|(" + whitespace + ")|.)","ig"), funescape = function(_, escaped, escapedWhitespace) {
            var high = "0x" + escaped - 65536;
            return high !== high || escapedWhitespace ? escaped : high < 0 ? String.fromCharCode(high + 65536) : String.fromCharCode(high >> 10 | 55296, high & 1023 | 56320)
        }, unloadHandler = function() {
            setDocument()
        };
        try {
            push.apply(arr = slice.call(preferredDoc.childNodes), preferredDoc.childNodes);
            arr[preferredDoc.childNodes.length].nodeType
        } catch (e) {
            push = {
                apply: arr.length ? function(target, els) {
                        push_native.apply(target, slice.call(els))
                    }
                    : function(target, els) {
                        var j = target.length
                            , i = 0;
                        while (target[j++] = els[i++]) {}
                        target.length = j - 1
                    }
            }
        }
        function Sizzle(selector, context, results, seed) {
            var m, i, elem, nid, nidselect, match, groups, newSelector, newContext = context && context.ownerDocument, nodeType = context ? context.nodeType : 9;
            results = results || [];
            if (typeof selector !== "string" || !selector || nodeType !== 1 && nodeType !== 9 && nodeType !== 11) {
                return results
            }
            if (!seed) {
                if ((context ? context.ownerDocument || context : preferredDoc) !== document) {
                    setDocument(context)
                }
                context = context || document;
                if (documentIsHTML) {
                    if (nodeType !== 11 && (match = rquickExpr.exec(selector))) {
                        if (m = match[1]) {
                            if (nodeType === 9) {
                                if (elem = context.getElementById(m)) {
                                    if (elem.id === m) {
                                        results.push(elem);
                                        return results
                                    }
                                } else {
                                    return results
                                }
                            } else {
                                if (newContext && (elem = newContext.getElementById(m)) && contains(context, elem) && elem.id === m) {
                                    results.push(elem);
                                    return results
                                }
                            }
                        } else if (match[2]) {
                            push.apply(results, context.getElementsByTagName(selector));
                            return results
                        } else if ((m = match[3]) && support.getElementsByClassName && context.getElementsByClassName) {
                            push.apply(results, context.getElementsByClassName(m));
                            return results
                        }
                    }
                    if (support.qsa && !compilerCache[selector + " "] && (!rbuggyQSA || !rbuggyQSA.test(selector))) {
                        if (nodeType !== 1) {
                            newContext = context;
                            newSelector = selector
                        } else if (context.nodeName.toLowerCase() !== "object") {
                            if (nid = context.getAttribute("id")) {
                                nid = nid.replace(rescape, "\\$&")
                            } else {
                                context.setAttribute("id", nid = expando)
                            }
                            groups = tokenize(selector);
                            i = groups.length;
                            nidselect = ridentifier.test(nid) ? "#" + nid : "[id='" + nid + "']";
                            while (i--) {
                                groups[i] = nidselect + " " + toSelector(groups[i])
                            }
                            newSelector = groups.join(",");
                            newContext = rsibling.test(selector) && testContext(context.parentNode) || context
                        }
                        if (newSelector) {
                            try {
                                push.apply(results, newContext.querySelectorAll(newSelector));
                                return results
                            } catch (qsaError) {} finally {
                                if (nid === expando) {
                                    context.removeAttribute("id")
                                }
                            }
                        }
                    }
                }
            }
            return select(selector.replace(rtrim, "$1"), context, results, seed)
        }
        function createCache() {
            var keys = [];
            function cache(key, value) {
                if (keys.push(key + " ") > Expr.cacheLength) {
                    delete cache[keys.shift()]
                }
                return cache[key + " "] = value
            }
            return cache
        }
        function markFunction(fn) {
            fn[expando] = true;
            return fn
        }
        function assert(fn) {
            var div = document.createElement("div");
            try {
                return !!fn(div)
            } catch (e) {
                return false
            } finally {
                if (div.parentNode) {
                    div.parentNode.removeChild(div)
                }
                div = null
            }
        }
        function addHandle(attrs, handler) {
            var arr = attrs.split("|")
                , i = arr.length;
            while (i--) {
                Expr.attrHandle[arr[i]] = handler
            }
        }
        function siblingCheck(a, b) {
            var cur = b && a
                , diff = cur && a.nodeType === 1 && b.nodeType === 1 && (~b.sourceIndex || MAX_NEGATIVE) - (~a.sourceIndex || MAX_NEGATIVE);
            if (diff) {
                return diff
            }
            if (cur) {
                while (cur = cur.nextSibling) {
                    if (cur === b) {
                        return -1
                    }
                }
            }
            return a ? 1 : -1
        }
        function createInputPseudo(type) {
            return function(elem) {
                var name = elem.nodeName.toLowerCase();
                return name === "input" && elem.type === type
            }
        }
        function createButtonPseudo(type) {
            return function(elem) {
                var name = elem.nodeName.toLowerCase();
                return (name === "input" || name === "button") && elem.type === type
            }
        }
        function createPositionalPseudo(fn) {
            return markFunction(function(argument) {
                argument = +argument;
                return markFunction(function(seed, matches) {
                    var j, matchIndexes = fn([], seed.length, argument), i = matchIndexes.length;
                    while (i--) {
                        if (seed[j = matchIndexes[i]]) {
                            seed[j] = !(matches[j] = seed[j])
                        }
                    }
                })
            })
        }
        function testContext(context) {
            return context && typeof context.getElementsByTagName !== "undefined" && context
        }
        support = Sizzle.support = {};
        isXML = Sizzle.isXML = function(elem) {
            var documentElement = elem && (elem.ownerDocument || elem).documentElement;
            return documentElement ? documentElement.nodeName !== "HTML" : false
        }
        ;
        setDocument = Sizzle.setDocument = function(node) {
            var hasCompare, parent, doc = node ? node.ownerDocument || node : preferredDoc;
            if (doc === document || doc.nodeType !== 9 || !doc.documentElement) {
                return document
            }
            document = doc;
            docElem = document.documentElement;
            documentIsHTML = !isXML(document);
            if ((parent = document.defaultView) && parent.top !== parent) {
                if (parent.addEventListener) {
                    parent.addEventListener("unload", unloadHandler, false)
                } else if (parent.attachEvent) {
                    parent.attachEvent("onunload", unloadHandler)
                }
            }
            support.attributes = assert(function(div) {
                div.className = "i";
                return !div.getAttribute("className")
            });
            support.getElementsByTagName = assert(function(div) {
                div.appendChild(document.createComment(""));
                return !div.getElementsByTagName("*").length
            });
            support.getElementsByClassName = rnative.test(document.getElementsByClassName);
            support.getById = assert(function(div) {
                docElem.appendChild(div).id = expando;
                return !document.getElementsByName || !document.getElementsByName(expando).length
            });
            if (support.getById) {
                Expr.find["ID"] = function(id, context) {
                    if (typeof context.getElementById !== "undefined" && documentIsHTML) {
                        var m = context.getElementById(id);
                        return m ? [m] : []
                    }
                }
                ;
                Expr.filter["ID"] = function(id) {
                    var attrId = id.replace(runescape, funescape);
                    return function(elem) {
                        return elem.getAttribute("id") === attrId
                    }
                }
            } else {
                delete Expr.find["ID"];
                Expr.filter["ID"] = function(id) {
                    var attrId = id.replace(runescape, funescape);
                    return function(elem) {
                        var node = typeof elem.getAttributeNode !== "undefined" && elem.getAttributeNode("id");
                        return node && node.value === attrId
                    }
                }
            }
            Expr.find["TAG"] = support.getElementsByTagName ? function(tag, context) {
                    if (typeof context.getElementsByTagName !== "undefined") {
                        return context.getElementsByTagName(tag)
                    } else if (support.qsa) {
                        return context.querySelectorAll(tag)
                    }
                }
                : function(tag, context) {
                    var elem, tmp = [], i = 0, results = context.getElementsByTagName(tag);
                    if (tag === "*") {
                        while (elem = results[i++]) {
                            if (elem.nodeType === 1) {
                                tmp.push(elem)
                            }
                        }
                        return tmp
                    }
                    return results
                }
            ;
            Expr.find["CLASS"] = support.getElementsByClassName && function(className, context) {
                if (typeof context.getElementsByClassName !== "undefined" && documentIsHTML) {
                    return context.getElementsByClassName(className)
                }
            }
            ;
            rbuggyMatches = [];
            rbuggyQSA = [];
            if (support.qsa = rnative.test(document.querySelectorAll)) {
                assert(function(div) {
                    docElem.appendChild(div).innerHTML = "<a id='" + expando + "'></a>" + "<select id='" + expando + "-\r\\' msallowcapture=''>" + "<option selected=''></option></select>";
                    if (div.querySelectorAll("[msallowcapture^='']").length) {
                        rbuggyQSA.push("[*^$]=" + whitespace + "*(?:''|\"\")")
                    }
                    if (!div.querySelectorAll("[selected]").length) {
                        rbuggyQSA.push("\\[" + whitespace + "*(?:value|" + booleans + ")")
                    }
                    if (!div.querySelectorAll("[id~=" + expando + "-]").length) {
                        rbuggyQSA.push("~=")
                    }
                    if (!div.querySelectorAll(":checked").length) {
                        rbuggyQSA.push(":checked")
                    }
                    if (!div.querySelectorAll("a#" + expando + "+*").length) {
                        rbuggyQSA.push(".#.+[+~]")
                    }
                });
                assert(function(div) {
                    var input = document.createElement("input");
                    input.setAttribute("type", "hidden");
                    div.appendChild(input).setAttribute("name", "D");
                    if (div.querySelectorAll("[name=d]").length) {
                        rbuggyQSA.push("name" + whitespace + "*[*^$|!~]?=")
                    }
                    if (!div.querySelectorAll(":enabled").length) {
                        rbuggyQSA.push(":enabled", ":disabled")
                    }
                    div.querySelectorAll("*,:x");
                    rbuggyQSA.push(",.*:")
                })
            }
            if (support.matchesSelector = rnative.test(matches = docElem.matches || docElem.webkitMatchesSelector || docElem.mozMatchesSelector || docElem.oMatchesSelector || docElem.msMatchesSelector)) {
                assert(function(div) {
                    support.disconnectedMatch = matches.call(div, "div");
                    matches.call(div, "[s!='']:x");
                    rbuggyMatches.push("!=", pseudos)
                })
            }
            rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join("|"));
            rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join("|"));
            hasCompare = rnative.test(docElem.compareDocumentPosition);
            contains = hasCompare || rnative.test(docElem.contains) ? function(a, b) {
                    var adown = a.nodeType === 9 ? a.documentElement : a
                        , bup = b && b.parentNode;
                    return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains ? adown.contains(bup) : a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16))
                }
                : function(a, b) {
                    if (b) {
                        while (b = b.parentNode) {
                            if (b === a) {
                                return true
                            }
                        }
                    }
                    return false
                }
            ;
            sortOrder = hasCompare ? function(a, b) {
                    if (a === b) {
                        hasDuplicate = true;
                        return 0
                    }
                    var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;
                    if (compare) {
                        return compare
                    }
                    compare = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1;
                    if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare) {
                        if (a === document || a.ownerDocument === preferredDoc && contains(preferredDoc, a)) {
                            return -1
                        }
                        if (b === document || b.ownerDocument === preferredDoc && contains(preferredDoc, b)) {
                            return 1
                        }
                        return sortInput ? indexOf(sortInput, a) - indexOf(sortInput, b) : 0
                    }
                    return compare & 4 ? -1 : 1
                }
                : function(a, b) {
                    if (a === b) {
                        hasDuplicate = true;
                        return 0
                    }
                    var cur, i = 0, aup = a.parentNode, bup = b.parentNode, ap = [a], bp = [b];
                    if (!aup || !bup) {
                        return a === document ? -1 : b === document ? 1 : aup ? -1 : bup ? 1 : sortInput ? indexOf(sortInput, a) - indexOf(sortInput, b) : 0
                    } else if (aup === bup) {
                        return siblingCheck(a, b)
                    }
                    cur = a;
                    while (cur = cur.parentNode) {
                        ap.unshift(cur)
                    }
                    cur = b;
                    while (cur = cur.parentNode) {
                        bp.unshift(cur)
                    }
                    while (ap[i] === bp[i]) {
                        i++
                    }
                    return i ? siblingCheck(ap[i], bp[i]) : ap[i] === preferredDoc ? -1 : bp[i] === preferredDoc ? 1 : 0
                }
            ;
            return document
        }
        ;
        Sizzle.matches = function(expr, elements) {
            return Sizzle(expr, null, null, elements)
        }
        ;
        Sizzle.matchesSelector = function(elem, expr) {
            if ((elem.ownerDocument || elem) !== document) {
                setDocument(elem)
            }
            expr = expr.replace(rattributeQuotes, "='$1']");
            if (support.matchesSelector && documentIsHTML && !compilerCache[expr + " "] && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))) {
                try {
                    var ret = matches.call(elem, expr);
                    if (ret || support.disconnectedMatch || elem.document && elem.document.nodeType !== 11) {
                        return ret
                    }
                } catch (e) {}
            }
            return Sizzle(expr, document, null, [elem]).length > 0
        }
        ;
        Sizzle.contains = function(context, elem) {
            if ((context.ownerDocument || context) !== document) {
                setDocument(context)
            }
            return contains(context, elem)
        }
        ;
        Sizzle.attr = function(elem, name) {
            if ((elem.ownerDocument || elem) !== document) {
                setDocument(elem)
            }
            var fn = Expr.attrHandle[name.toLowerCase()]
                , val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase()) ? fn(elem, name, !documentIsHTML) : undefined;
            return val !== undefined ? val : support.attributes || !documentIsHTML ? elem.getAttribute(name) : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null
        }
        ;
        Sizzle.error = function(msg) {
            throw new Error("Syntax error, unrecognized expression: " + msg)
        }
        ;
        Sizzle.uniqueSort = function(results) {
            var elem, duplicates = [], j = 0, i = 0;
            hasDuplicate = !support.detectDuplicates;
            sortInput = !support.sortStable && results.slice(0);
            results.sort(sortOrder);
            if (hasDuplicate) {
                while (elem = results[i++]) {
                    if (elem === results[i]) {
                        j = duplicates.push(i)
                    }
                }
                while (j--) {
                    results.splice(duplicates[j], 1)
                }
            }
            sortInput = null;
            return results
        }
        ;
        getText = Sizzle.getText = function(elem) {
            var node, ret = "", i = 0, nodeType = elem.nodeType;
            if (!nodeType) {
                while (node = elem[i++]) {
                    ret += getText(node)
                }
            } else if (nodeType === 1 || nodeType === 9 || nodeType === 11) {
                if (typeof elem.textContent === "string") {
                    return elem.textContent
                } else {
                    for (elem = elem.firstChild; elem; elem = elem.nextSibling) {
                        ret += getText(elem)
                    }
                }
            } else if (nodeType === 3 || nodeType === 4) {
                return elem.nodeValue
            }
            return ret
        }
        ;
        Expr = Sizzle.selectors = {
            cacheLength: 50,
            createPseudo: markFunction,
            match: matchExpr,
            attrHandle: {},
            find: {},
            relative: {
                ">": {
                    dir: "parentNode",
                    first: true
                },
                " ": {
                    dir: "parentNode"
                },
                "+": {
                    dir: "previousSibling",
                    first: true
                },
                "~": {
                    dir: "previousSibling"
                }
            },
            preFilter: {
                ATTR: function(match) {
                    match[1] = match[1].replace(runescape, funescape);
                    match[3] = (match[3] || match[4] || match[5] || "").replace(runescape, funescape);
                    if (match[2] === "~=") {
                        match[3] = " " + match[3] + " "
                    }
                    return match.slice(0, 4)
                },
                CHILD: function(match) {
                    match[1] = match[1].toLowerCase();
                    if (match[1].slice(0, 3) === "nth") {
                        if (!match[3]) {
                            Sizzle.error(match[0])
                        }
                        match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === "even" || match[3] === "odd"));
                        match[5] = +(match[7] + match[8] || match[3] === "odd")
                    } else if (match[3]) {
                        Sizzle.error(match[0])
                    }
                    return match
                },
                PSEUDO: function(match) {
                    var excess, unquoted = !match[6] && match[2];
                    if (matchExpr["CHILD"].test(match[0])) {
                        return null
                    }
                    if (match[3]) {
                        match[2] = match[4] || match[5] || ""
                    } else if (unquoted && rpseudo.test(unquoted) && (excess = tokenize(unquoted, true)) && (excess = unquoted.indexOf(")", unquoted.length - excess) - unquoted.length)) {
                        match[0] = match[0].slice(0, excess);
                        match[2] = unquoted.slice(0, excess)
                    }
                    return match.slice(0, 3)
                }
            },
            filter: {
                TAG: function(nodeNameSelector) {
                    var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();
                    return nodeNameSelector === "*" ? function() {
                            return true
                        }
                        : function(elem) {
                            return elem.nodeName && elem.nodeName.toLowerCase() === nodeName
                        }
                },
                CLASS: function(className) {
                    var pattern = classCache[className + " "];
                    return pattern || (pattern = new RegExp("(^|" + whitespace + ")" + className + "(" + whitespace + "|$)")) && classCache(className, function(elem) {
                        return pattern.test(typeof elem.className === "string" && elem.className || typeof elem.getAttribute !== "undefined" && elem.getAttribute("class") || "")
                    })
                },
                ATTR: function(name, operator, check) {
                    return function(elem) {
                        var result = Sizzle.attr(elem, name);
                        if (result == null) {
                            return operator === "!="
                        }
                        if (!operator) {
                            return true
                        }
                        result += "";
                        return operator === "=" ? result === check : operator === "!=" ? result !== check : operator === "^=" ? check && result.indexOf(check) === 0 : operator === "*=" ? check && result.indexOf(check) > -1 : operator === "$=" ? check && result.slice(-check.length) === check : operator === "~=" ? (" " + result.replace(rwhitespace, " ") + " ").indexOf(check) > -1 : operator === "|=" ? result === check || result.slice(0, check.length + 1) === check + "-" : false
                    }
                },
                CHILD: function(type, what, argument, first, last) {
                    var simple = type.slice(0, 3) !== "nth"
                        , forward = type.slice(-4) !== "last"
                        , ofType = what === "of-type";
                    return first === 1 && last === 0 ? function(elem) {
                            return !!elem.parentNode
                        }
                        : function(elem, context, xml) {
                            var cache, uniqueCache, outerCache, node, nodeIndex, start, dir = simple !== forward ? "nextSibling" : "previousSibling", parent = elem.parentNode, name = ofType && elem.nodeName.toLowerCase(), useCache = !xml && !ofType, diff = false;
                            if (parent) {
                                if (simple) {
                                    while (dir) {
                                        node = elem;
                                        while (node = node[dir]) {
                                            if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {
                                                return false
                                            }
                                        }
                                        start = dir = type === "only" && !start && "nextSibling"
                                    }
                                    return true
                                }
                                start = [forward ? parent.firstChild : parent.lastChild];
                                if (forward && useCache) {
                                    node = parent;
                                    outerCache = node[expando] || (node[expando] = {});
                                    uniqueCache = outerCache[node.uniqueID] || (outerCache[node.uniqueID] = {});
                                    cache = uniqueCache[type] || [];
                                    nodeIndex = cache[0] === dirruns && cache[1];
                                    diff = nodeIndex && cache[2];
                                    node = nodeIndex && parent.childNodes[nodeIndex];
                                    while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {
                                        if (node.nodeType === 1 && ++diff && node === elem) {
                                            uniqueCache[type] = [dirruns, nodeIndex, diff];
                                            break
                                        }
                                    }
                                } else {
                                    if (useCache) {
                                        node = elem;
                                        outerCache = node[expando] || (node[expando] = {});
                                        uniqueCache = outerCache[node.uniqueID] || (outerCache[node.uniqueID] = {});
                                        cache = uniqueCache[type] || [];
                                        nodeIndex = cache[0] === dirruns && cache[1];
                                        diff = nodeIndex
                                    }
                                    if (diff === false) {
                                        while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {
                                            if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {
                                                if (useCache) {
                                                    outerCache = node[expando] || (node[expando] = {});
                                                    uniqueCache = outerCache[node.uniqueID] || (outerCache[node.uniqueID] = {});
                                                    uniqueCache[type] = [dirruns, diff]
                                                }
                                                if (node === elem) {
                                                    break
                                                }
                                            }
                                        }
                                    }
                                }
                                diff -= last;
                                return diff === first || diff % first === 0 && diff / first >= 0
                            }
                        }
                },
                PSEUDO: function(pseudo, argument) {
                    var args, fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error("unsupported pseudo: " + pseudo);
                    if (fn[expando]) {
                        return fn(argument)
                    }
                    if (fn.length > 1) {
                        args = [pseudo, pseudo, "", argument];
                        return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ? markFunction(function(seed, matches) {
                            var idx, matched = fn(seed, argument), i = matched.length;
                            while (i--) {
                                idx = indexOf(seed, matched[i]);
                                seed[idx] = !(matches[idx] = matched[i])
                            }
                        }) : function(elem) {
                            return fn(elem, 0, args)
                        }
                    }
                    return fn
                }
            },
            pseudos: {
                not: markFunction(function(selector) {
                    var input = []
                        , results = []
                        , matcher = compile(selector.replace(rtrim, "$1"));
                    return matcher[expando] ? markFunction(function(seed, matches, context, xml) {
                        var elem, unmatched = matcher(seed, null, xml, []), i = seed.length;
                        while (i--) {
                            if (elem = unmatched[i]) {
                                seed[i] = !(matches[i] = elem)
                            }
                        }
                    }) : function(elem, context, xml) {
                        input[0] = elem;
                        matcher(input, null, xml, results);
                        input[0] = null;
                        return !results.pop()
                    }
                }),
                has: markFunction(function(selector) {
                    return function(elem) {
                        return Sizzle(selector, elem).length > 0
                    }
                }),
                contains: markFunction(function(text) {
                    text = text.replace(runescape, funescape);
                    return function(elem) {
                        return (elem.textContent || elem.innerText || getText(elem)).indexOf(text) > -1
                    }
                }),
                lang: markFunction(function(lang) {
                    if (!ridentifier.test(lang || "")) {
                        Sizzle.error("unsupported lang: " + lang)
                    }
                    lang = lang.replace(runescape, funescape).toLowerCase();
                    return function(elem) {
                        var elemLang;
                        do {
                            if (elemLang = documentIsHTML ? elem.lang : elem.getAttribute("xml:lang") || elem.getAttribute("lang")) {
                                elemLang = elemLang.toLowerCase();
                                return elemLang === lang || elemLang.indexOf(lang + "-") === 0
                            }
                        } while ((elem = elem.parentNode) && elem.nodeType === 1);return false
                    }
                }),
                target: function(elem) {
                    var hash = window.location && window.location.hash;
                    return hash && hash.slice(1) === elem.id
                },
                root: function(elem) {
                    return elem === docElem
                },
                focus: function(elem) {
                    return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex)
                },
                enabled: function(elem) {
                    return elem.disabled === false
                },
                disabled: function(elem) {
                    return elem.disabled === true
                },
                checked: function(elem) {
                    var nodeName = elem.nodeName.toLowerCase();
                    return nodeName === "input" && !!elem.checked || nodeName === "option" && !!elem.selected
                },
                selected: function(elem) {
                    if (elem.parentNode) {
                        elem.parentNode.selectedIndex
                    }
                    return elem.selected === true
                },
                empty: function(elem) {
                    for (elem = elem.firstChild; elem; elem = elem.nextSibling) {
                        if (elem.nodeType < 6) {
                            return false
                        }
                    }
                    return true
                },
                parent: function(elem) {
                    return !Expr.pseudos["empty"](elem)
                },
                header: function(elem) {
                    return rheader.test(elem.nodeName)
                },
                input: function(elem) {
                    return rinputs.test(elem.nodeName)
                },
                button: function(elem) {
                    var name = elem.nodeName.toLowerCase();
                    return name === "input" && elem.type === "button" || name === "button"
                },
                text: function(elem) {
                    var attr;
                    return elem.nodeName.toLowerCase() === "input" && elem.type === "text" && ((attr = elem.getAttribute("type")) == null || attr.toLowerCase() === "text")
                },
                first: createPositionalPseudo(function() {
                    return [0]
                }),
                last: createPositionalPseudo(function(matchIndexes, length) {
                    return [length - 1]
                }),
                eq: createPositionalPseudo(function(matchIndexes, length, argument) {
                    return [argument < 0 ? argument + length : argument]
                }),
                even: createPositionalPseudo(function(matchIndexes, length) {
                    var i = 0;
                    for (; i < length; i += 2) {
                        matchIndexes.push(i)
                    }
                    return matchIndexes
                }),
                odd: createPositionalPseudo(function(matchIndexes, length) {
                    var i = 1;
                    for (; i < length; i += 2) {
                        matchIndexes.push(i)
                    }
                    return matchIndexes
                }),
                lt: createPositionalPseudo(function(matchIndexes, length, argument) {
                    var i = argument < 0 ? argument + length : argument;
                    for (; --i >= 0; ) {
                        matchIndexes.push(i)
                    }
                    return matchIndexes
                }),
                gt: createPositionalPseudo(function(matchIndexes, length, argument) {
                    var i = argument < 0 ? argument + length : argument;
                    for (; ++i < length; ) {
                        matchIndexes.push(i)
                    }
                    return matchIndexes
                })
            }
        };
        Expr.pseudos["nth"] = Expr.pseudos["eq"];
        for (i in {
            radio: true,
            checkbox: true,
            file: true,
            password: true,
            image: true
        }) {
            Expr.pseudos[i] = createInputPseudo(i)
        }
        for (i in {
            submit: true,
            reset: true
        }) {
            Expr.pseudos[i] = createButtonPseudo(i)
        }
        function setFilters() {}
        setFilters.prototype = Expr.filters = Expr.pseudos;
        Expr.setFilters = new setFilters;
        tokenize = Sizzle.tokenize = function(selector, parseOnly) {
            var matched, match, tokens, type, soFar, groups, preFilters, cached = tokenCache[selector + " "];
            if (cached) {
                return parseOnly ? 0 : cached.slice(0)
            }
            soFar = selector;
            groups = [];
            preFilters = Expr.preFilter;
            while (soFar) {
                if (!matched || (match = rcomma.exec(soFar))) {
                    if (match) {
                        soFar = soFar.slice(match[0].length) || soFar
                    }
                    groups.push(tokens = [])
                }
                matched = false;
                if (match = rcombinators.exec(soFar)) {
                    matched = match.shift();
                    tokens.push({
                        value: matched,
                        type: match[0].replace(rtrim, " ")
                    });
                    soFar = soFar.slice(matched.length)
                }
                for (type in Expr.filter) {
                    if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))) {
                        matched = match.shift();
                        tokens.push({
                            value: matched,
                            type: type,
                            matches: match
                        });
                        soFar = soFar.slice(matched.length)
                    }
                }
                if (!matched) {
                    break
                }
            }
            return parseOnly ? soFar.length : soFar ? Sizzle.error(selector) : tokenCache(selector, groups).slice(0)
        }
        ;
        function toSelector(tokens) {
            var i = 0
                , len = tokens.length
                , selector = "";
            for (; i < len; i++) {
                selector += tokens[i].value
            }
            return selector
        }
        function addCombinator(matcher, combinator, base) {
            var dir = combinator.dir
                , checkNonElements = base && dir === "parentNode"
                , doneName = done++;
            return combinator.first ? function(elem, context, xml) {
                    while (elem = elem[dir]) {
                        if (elem.nodeType === 1 || checkNonElements) {
                            return matcher(elem, context, xml)
                        }
                    }
                }
                : function(elem, context, xml) {
                    var oldCache, uniqueCache, outerCache, newCache = [dirruns, doneName];
                    if (xml) {
                        while (elem = elem[dir]) {
                            if (elem.nodeType === 1 || checkNonElements) {
                                if (matcher(elem, context, xml)) {
                                    return true
                                }
                            }
                        }
                    } else {
                        while (elem = elem[dir]) {
                            if (elem.nodeType === 1 || checkNonElements) {
                                outerCache = elem[expando] || (elem[expando] = {});
                                uniqueCache = outerCache[elem.uniqueID] || (outerCache[elem.uniqueID] = {});
                                if ((oldCache = uniqueCache[dir]) && oldCache[0] === dirruns && oldCache[1] === doneName) {
                                    return newCache[2] = oldCache[2]
                                } else {
                                    uniqueCache[dir] = newCache;
                                    if (newCache[2] = matcher(elem, context, xml)) {
                                        return true
                                    }
                                }
                            }
                        }
                    }
                }
        }
        function elementMatcher(matchers) {
            return matchers.length > 1 ? function(elem, context, xml) {
                    var i = matchers.length;
                    while (i--) {
                        if (!matchers[i](elem, context, xml)) {
                            return false
                        }
                    }
                    return true
                }
                : matchers[0]
        }
        function multipleContexts(selector, contexts, results) {
            var i = 0
                , len = contexts.length;
            for (; i < len; i++) {
                Sizzle(selector, contexts[i], results)
            }
            return results
        }
        function condense(unmatched, map, filter, context, xml) {
            var elem, newUnmatched = [], i = 0, len = unmatched.length, mapped = map != null;
            for (; i < len; i++) {
                if (elem = unmatched[i]) {
                    if (!filter || filter(elem, context, xml)) {
                        newUnmatched.push(elem);
                        if (mapped) {
                            map.push(i)
                        }
                    }
                }
            }
            return newUnmatched
        }
        function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {
            if (postFilter && !postFilter[expando]) {
                postFilter = setMatcher(postFilter)
            }
            if (postFinder && !postFinder[expando]) {
                postFinder = setMatcher(postFinder, postSelector)
            }
            return markFunction(function(seed, results, context, xml) {
                var temp, i, elem, preMap = [], postMap = [], preexisting = results.length, elems = seed || multipleContexts(selector || "*", context.nodeType ? [context] : context, []), matcherIn = preFilter && (seed || !selector) ? condense(elems, preMap, preFilter, context, xml) : elems, matcherOut = matcher ? postFinder || (seed ? preFilter : preexisting || postFilter) ? [] : results : matcherIn;
                if (matcher) {
                    matcher(matcherIn, matcherOut, context, xml)
                }
                if (postFilter) {
                    temp = condense(matcherOut, postMap);
                    postFilter(temp, [], context, xml);
                    i = temp.length;
                    while (i--) {
                        if (elem = temp[i]) {
                            matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem)
                        }
                    }
                }
                if (seed) {
                    if (postFinder || preFilter) {
                        if (postFinder) {
                            temp = [];
                            i = matcherOut.length;
                            while (i--) {
                                if (elem = matcherOut[i]) {
                                    temp.push(matcherIn[i] = elem)
                                }
                            }
                            postFinder(null, matcherOut = [], temp, xml)
                        }
                        i = matcherOut.length;
                        while (i--) {
                            if ((elem = matcherOut[i]) && (temp = postFinder ? indexOf(seed, elem) : preMap[i]) > -1) {
                                seed[temp] = !(results[temp] = elem)
                            }
                        }
                    }
                } else {
                    matcherOut = condense(matcherOut === results ? matcherOut.splice(preexisting, matcherOut.length) : matcherOut);
                    if (postFinder) {
                        postFinder(null, results, matcherOut, xml)
                    } else {
                        push.apply(results, matcherOut)
                    }
                }
            })
        }
        function matcherFromTokens(tokens) {
            var checkContext, matcher, j, len = tokens.length, leadingRelative = Expr.relative[tokens[0].type], implicitRelative = leadingRelative || Expr.relative[" "], i = leadingRelative ? 1 : 0, matchContext = addCombinator(function(elem) {
                return elem === checkContext
            }, implicitRelative, true), matchAnyContext = addCombinator(function(elem) {
                return indexOf(checkContext, elem) > -1
            }, implicitRelative, true), matchers = [function(elem, context, xml) {
                var ret = !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType ? matchContext(elem, context, xml) : matchAnyContext(elem, context, xml));
                checkContext = null;
                return ret
            }
            ];
            for (; i < len; i++) {
                if (matcher = Expr.relative[tokens[i].type]) {
                    matchers = [addCombinator(elementMatcher(matchers), matcher)]
                } else {
                    matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches);
                    if (matcher[expando]) {
                        j = ++i;
                        for (; j < len; j++) {
                            if (Expr.relative[tokens[j].type]) {
                                break
                            }
                        }
                        return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector(tokens.slice(0, i - 1).concat({
                            value: tokens[i - 2].type === " " ? "*" : ""
                        })).replace(rtrim, "$1"), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens))
                    }
                    matchers.push(matcher)
                }
            }
            return elementMatcher(matchers)
        }
        function matcherFromGroupMatchers(elementMatchers, setMatchers) {
            var bySet = setMatchers.length > 0
                , byElement = elementMatchers.length > 0
                , superMatcher = function(seed, context, xml, results, outermost) {
                var elem, j, matcher, matchedCount = 0, i = "0", unmatched = seed && [], setMatched = [], contextBackup = outermostContext, elems = seed || byElement && Expr.find["TAG"]("*", outermost), dirrunsUnique = dirruns += contextBackup == null ? 1 : Math.random() || .1, len = elems.length;
                if (outermost) {
                    outermostContext = context === document || context || outermost
                }
                for (; i !== len && (elem = elems[i]) != null; i++) {
                    if (byElement && elem) {
                        j = 0;
                        if (!context && elem.ownerDocument !== document) {
                            setDocument(elem);
                            xml = !documentIsHTML
                        }
                        while (matcher = elementMatchers[j++]) {
                            if (matcher(elem, context || document, xml)) {
                                results.push(elem);
                                break
                            }
                        }
                        if (outermost) {
                            dirruns = dirrunsUnique
                        }
                    }
                    if (bySet) {
                        if (elem = !matcher && elem) {
                            matchedCount--
                        }
                        if (seed) {
                            unmatched.push(elem)
                        }
                    }
                }
                matchedCount += i;
                if (bySet && i !== matchedCount) {
                    j = 0;
                    while (matcher = setMatchers[j++]) {
                        matcher(unmatched, setMatched, context, xml)
                    }
                    if (seed) {
                        if (matchedCount > 0) {
                            while (i--) {
                                if (!(unmatched[i] || setMatched[i])) {
                                    setMatched[i] = pop.call(results)
                                }
                            }
                        }
                        setMatched = condense(setMatched)
                    }
                    push.apply(results, setMatched);
                    if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1) {
                        Sizzle.uniqueSort(results)
                    }
                }
                if (outermost) {
                    dirruns = dirrunsUnique;
                    outermostContext = contextBackup
                }
                return unmatched
            };
            return bySet ? markFunction(superMatcher) : superMatcher
        }
        compile = Sizzle.compile = function(selector, match) {
            var i, setMatchers = [], elementMatchers = [], cached = compilerCache[selector + " "];
            if (!cached) {
                if (!match) {
                    match = tokenize(selector)
                }
                i = match.length;
                while (i--) {
                    cached = matcherFromTokens(match[i]);
                    if (cached[expando]) {
                        setMatchers.push(cached)
                    } else {
                        elementMatchers.push(cached)
                    }
                }
                cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers));
                cached.selector = selector
            }
            return cached
        }
        ;
        select = Sizzle.select = function(selector, context, results, seed) {
            var i, tokens, token, type, find, compiled = typeof selector === "function" && selector, match = !seed && tokenize(selector = compiled.selector || selector);
            results = results || [];
            if (match.length === 1) {
                tokens = match[0] = match[0].slice(0);
                if (tokens.length > 2 && (token = tokens[0]).type === "ID" && support.getById && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]) {
                    context = (Expr.find["ID"](token.matches[0].replace(runescape, funescape), context) || [])[0];
                    if (!context) {
                        return results
                    } else if (compiled) {
                        context = context.parentNode
                    }
                    selector = selector.slice(tokens.shift().value.length)
                }
                i = matchExpr["needsContext"].test(selector) ? 0 : tokens.length;
                while (i--) {
                    token = tokens[i];
                    if (Expr.relative[type = token.type]) {
                        break
                    }
                    if (find = Expr.find[type]) {
                        if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)) {
                            tokens.splice(i, 1);
                            selector = seed.length && toSelector(tokens);
                            if (!selector) {
                                push.apply(results, seed);
                                return results
                            }
                            break
                        }
                    }
                }
            }
            (compiled || compile(selector, match))(seed, context, !documentIsHTML, results, !context || rsibling.test(selector) && testContext(context.parentNode) || context);
            return results
        }
        ;
        support.sortStable = expando.split("").sort(sortOrder).join("") === expando;
        support.detectDuplicates = !!hasDuplicate;
        setDocument();
        support.sortDetached = assert(function(div1) {
            return div1.compareDocumentPosition(document.createElement("div")) & 1
        });
        if (!assert(function(div) {
            div.innerHTML = "<a href='#'></a>";
            return div.firstChild.getAttribute("href") === "#"
        })) {
            addHandle("type|href|height|width", function(elem, name, isXML) {
                if (!isXML) {
                    return elem.getAttribute(name, name.toLowerCase() === "type" ? 1 : 2)
                }
            })
        }
        if (!support.attributes || !assert(function(div) {
            div.innerHTML = "<input/>";
            div.firstChild.setAttribute("value", "");
            return div.firstChild.getAttribute("value") === ""
        })) {
            addHandle("value", function(elem, name, isXML) {
                if (!isXML && elem.nodeName.toLowerCase() === "input") {
                    return elem.defaultValue
                }
            })
        }
        if (!assert(function(div) {
            return div.getAttribute("disabled") == null
        })) {
            addHandle(booleans, function(elem, name, isXML) {
                var val;
                if (!isXML) {
                    return elem[name] === true ? name.toLowerCase() : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null
                }
            })
        }
        return Sizzle
    }(window);
    jQuery.find = Sizzle;
    jQuery.expr = Sizzle.selectors;
    jQuery.expr[":"] = jQuery.expr.pseudos;
    jQuery.uniqueSort = jQuery.unique = Sizzle.uniqueSort;
    jQuery.text = Sizzle.getText;
    jQuery.isXMLDoc = Sizzle.isXML;
    jQuery.contains = Sizzle.contains;
    var dir = function(elem, dir, until) {
        var matched = []
            , truncate = until !== undefined;
        while ((elem = elem[dir]) && elem.nodeType !== 9) {
            if (elem.nodeType === 1) {
                if (truncate && jQuery(elem).is(until)) {
                    break
                }
                matched.push(elem)
            }
        }
        return matched
    };
    var siblings = function(n, elem) {
        var matched = [];
        for (; n; n = n.nextSibling) {
            if (n.nodeType === 1 && n !== elem) {
                matched.push(n)
            }
        }
        return matched
    };
    var rneedsContext = jQuery.expr.match.needsContext;
    var rsingleTag = /^<([\w-]+)\s*\/?>(?:<\/\1>|)$/;
    var risSimple = /^.[^:#\[\.,]*$/;
    function winnow(elements, qualifier, not) {
        if (jQuery.isFunction(qualifier)) {
            return jQuery.grep(elements, function(elem, i) {
                return !!qualifier.call(elem, i, elem) !== not
            })
        }
        if (qualifier.nodeType) {
            return jQuery.grep(elements, function(elem) {
                return elem === qualifier !== not
            })
        }
        if (typeof qualifier === "string") {
            if (risSimple.test(qualifier)) {
                return jQuery.filter(qualifier, elements, not)
            }
            qualifier = jQuery.filter(qualifier, elements)
        }
        return jQuery.grep(elements, function(elem) {
            return indexOf.call(qualifier, elem) > -1 !== not
        })
    }
    jQuery.filter = function(expr, elems, not) {
        var elem = elems[0];
        if (not) {
            expr = ":not(" + expr + ")"
        }
        return elems.length === 1 && elem.nodeType === 1 ? jQuery.find.matchesSelector(elem, expr) ? [elem] : [] : jQuery.find.matches(expr, jQuery.grep(elems, function(elem) {
            return elem.nodeType === 1
        }))
    }
    ;
    jQuery.fn.extend({
        find: function(selector) {
            var i, len = this.length, ret = [], self = this;
            if (typeof selector !== "string") {
                return this.pushStack(jQuery(selector).filter(function() {
                    for (i = 0; i < len; i++) {
                        if (jQuery.contains(self[i], this)) {
                            return true
                        }
                    }
                }))
            }
            for (i = 0; i < len; i++) {
                jQuery.find(selector, self[i], ret)
            }
            ret = this.pushStack(len > 1 ? jQuery.unique(ret) : ret);
            ret.selector = this.selector ? this.selector + " " + selector : selector;
            return ret
        },
        filter: function(selector) {
            return this.pushStack(winnow(this, selector || [], false))
        },
        not: function(selector) {
            return this.pushStack(winnow(this, selector || [], true))
        },
        is: function(selector) {
            return !!winnow(this, typeof selector === "string" && rneedsContext.test(selector) ? jQuery(selector) : selector || [], false).length
        }
    });
    var rootjQuery, rquickExpr = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/, init = jQuery.fn.init = function(selector, context, root) {
            var match, elem;
            if (!selector) {
                return this
            }
            root = root || rootjQuery;
            if (typeof selector === "string") {
                if (selector[0] === "<" && selector[selector.length - 1] === ">" && selector.length >= 3) {
                    match = [null, selector, null]
                } else {
                    match = rquickExpr.exec(selector)
                }
                if (match && (match[1] || !context)) {
                    if (match[1]) {
                        context = context instanceof jQuery ? context[0] : context;
                        jQuery.merge(this, jQuery.parseHTML(match[1], context && context.nodeType ? context.ownerDocument || context : document, true));
                        if (rsingleTag.test(match[1]) && jQuery.isPlainObject(context)) {
                            for (match in context) {
                                if (jQuery.isFunction(this[match])) {
                                    this[match](context[match])
                                } else {
                                    this.attr(match, context[match])
                                }
                            }
                        }
                        return this
                    } else {
                        elem = document.getElementById(match[2]);
                        if (elem && elem.parentNode) {
                            this.length = 1;
                            this[0] = elem
                        }
                        this.context = document;
                        this.selector = selector;
                        return this
                    }
                } else if (!context || context.jquery) {
                    return (context || root).find(selector)
                } else {
                    return this.constructor(context).find(selector)
                }
            } else if (selector.nodeType) {
                this.context = this[0] = selector;
                this.length = 1;
                return this
            } else if (jQuery.isFunction(selector)) {
                return root.ready !== undefined ? root.ready(selector) : selector(jQuery)
            }
            if (selector.selector !== undefined) {
                this.selector = selector.selector;
                this.context = selector.context
            }
            return jQuery.makeArray(selector, this)
        }
    ;
    init.prototype = jQuery.fn;
    rootjQuery = jQuery(document);
    var rparentsprev = /^(?:parents|prev(?:Until|All))/
        , guaranteedUnique = {
        children: true,
        contents: true,
        next: true,
        prev: true
    };
    jQuery.fn.extend({
        has: function(target) {
            var targets = jQuery(target, this)
                , l = targets.length;
            return this.filter(function() {
                var i = 0;
                for (; i < l; i++) {
                    if (jQuery.contains(this, targets[i])) {
                        return true
                    }
                }
            })
        },
        closest: function(selectors, context) {
            var cur, i = 0, l = this.length, matched = [], pos = rneedsContext.test(selectors) || typeof selectors !== "string" ? jQuery(selectors, context || this.context) : 0;
            for (; i < l; i++) {
                for (cur = this[i]; cur && cur !== context; cur = cur.parentNode) {
                    if (cur.nodeType < 11 && (pos ? pos.index(cur) > -1 : cur.nodeType === 1 && jQuery.find.matchesSelector(cur, selectors))) {
                        matched.push(cur);
                        break
                    }
                }
            }
            return this.pushStack(matched.length > 1 ? jQuery.uniqueSort(matched) : matched)
        },
        index: function(elem) {
            if (!elem) {
                return this[0] && this[0].parentNode ? this.first().prevAll().length : -1
            }
            if (typeof elem === "string") {
                return indexOf.call(jQuery(elem), this[0])
            }
            return indexOf.call(this, elem.jquery ? elem[0] : elem)
        },
        add: function(selector, context) {
            return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(), jQuery(selector, context))))
        },
        addBack: function(selector) {
            return this.add(selector == null ? this.prevObject : this.prevObject.filter(selector))
        }
    });
    function sibling(cur, dir) {
        while ((cur = cur[dir]) && cur.nodeType !== 1) {}
        return cur
    }
    jQuery.each({
        parent: function(elem) {
            var parent = elem.parentNode;
            return parent && parent.nodeType !== 11 ? parent : null
        },
        parents: function(elem) {
            return dir(elem, "parentNode")
        },
        parentsUntil: function(elem, i, until) {
            return dir(elem, "parentNode", until)
        },
        next: function(elem) {
            return sibling(elem, "nextSibling")
        },
        prev: function(elem) {
            return sibling(elem, "previousSibling")
        },
        nextAll: function(elem) {
            return dir(elem, "nextSibling")
        },
        prevAll: function(elem) {
            return dir(elem, "previousSibling")
        },
        nextUntil: function(elem, i, until) {
            return dir(elem, "nextSibling", until)
        },
        prevUntil: function(elem, i, until) {
            return dir(elem, "previousSibling", until)
        },
        siblings: function(elem) {
            return siblings((elem.parentNode || {}).firstChild, elem)
        },
        children: function(elem) {
            return siblings(elem.firstChild)
        },
        contents: function(elem) {
            return elem.contentDocument || jQuery.merge([], elem.childNodes)
        }
    }, function(name, fn) {
        jQuery.fn[name] = function(until, selector) {
            var matched = jQuery.map(this, fn, until);
            if (name.slice(-5) !== "Until") {
                selector = until
            }
            if (selector && typeof selector === "string") {
                matched = jQuery.filter(selector, matched)
            }
            if (this.length > 1) {
                if (!guaranteedUnique[name]) {
                    jQuery.uniqueSort(matched)
                }
                if (rparentsprev.test(name)) {
                    matched.reverse()
                }
            }
            return this.pushStack(matched)
        }
    });
    var rnotwhite = /\S+/g;
    function createOptions(options) {
        var object = {};
        jQuery.each(options.match(rnotwhite) || [], function(_, flag) {
            object[flag] = true
        });
        return object
    }
    jQuery.Callbacks = function(options) {
        options = typeof options === "string" ? createOptions(options) : jQuery.extend({}, options);
        var firing, memory, fired, locked, list = [], queue = [], firingIndex = -1, fire = function() {
            locked = options.once;
            fired = firing = true;
            for (; queue.length; firingIndex = -1) {
                memory = queue.shift();
                while (++firingIndex < list.length) {
                    if (list[firingIndex].apply(memory[0], memory[1]) === false && options.stopOnFalse) {
                        firingIndex = list.length;
                        memory = false
                    }
                }
            }
            if (!options.memory) {
                memory = false
            }
            firing = false;
            if (locked) {
                if (memory) {
                    list = []
                } else {
                    list = ""
                }
            }
        }, self = {
            add: function() {
                if (list) {
                    if (memory && !firing) {
                        firingIndex = list.length - 1;
                        queue.push(memory)
                    }
                    (function add(args) {
                            jQuery.each(args, function(_, arg) {
                                if (jQuery.isFunction(arg)) {
                                    if (!options.unique || !self.has(arg)) {
                                        list.push(arg)
                                    }
                                } else if (arg && arg.length && jQuery.type(arg) !== "string") {
                                    add(arg)
                                }
                            })
                        }
                    )(arguments);
                    if (memory && !firing) {
                        fire()
                    }
                }
                return this
            },
            remove: function() {
                jQuery.each(arguments, function(_, arg) {
                    var index;
                    while ((index = jQuery.inArray(arg, list, index)) > -1) {
                        list.splice(index, 1);
                        if (index <= firingIndex) {
                            firingIndex--
                        }
                    }
                });
                return this
            },
            has: function(fn) {
                return fn ? jQuery.inArray(fn, list) > -1 : list.length > 0
            },
            empty: function() {
                if (list) {
                    list = []
                }
                return this
            },
            disable: function() {
                locked = queue = [];
                list = memory = "";
                return this
            },
            disabled: function() {
                return !list
            },
            lock: function() {
                locked = queue = [];
                if (!memory) {
                    list = memory = ""
                }
                return this
            },
            locked: function() {
                return !!locked
            },
            fireWith: function(context, args) {
                if (!locked) {
                    args = args || [];
                    args = [context, args.slice ? args.slice() : args];
                    queue.push(args);
                    if (!firing) {
                        fire()
                    }
                }
                return this
            },
            fire: function() {
                self.fireWith(this, arguments);
                return this
            },
            fired: function() {
                return !!fired
            }
        };
        return self
    }
    ;
    jQuery.extend({
        Deferred: function(func) {
            var tuples = [["resolve", "done", jQuery.Callbacks("once memory"), "resolved"], ["reject", "fail", jQuery.Callbacks("once memory"), "rejected"], ["notify", "progress", jQuery.Callbacks("memory")]]
                , state = "pending"
                , promise = {
                state: function() {
                    return state
                },
                always: function() {
                    deferred.done(arguments).fail(arguments);
                    return this
                },
                then: function() {
                    var fns = arguments;
                    return jQuery.Deferred(function(newDefer) {
                        jQuery.each(tuples, function(i, tuple) {
                            var fn = jQuery.isFunction(fns[i]) && fns[i];
                            deferred[tuple[1]](function() {
                                var returned = fn && fn.apply(this, arguments);
                                if (returned && jQuery.isFunction(returned.promise)) {
                                    returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject)
                                } else {
                                    newDefer[tuple[0] + "With"](this === promise ? newDefer.promise() : this, fn ? [returned] : arguments)
                                }
                            })
                        });
                        fns = null
                    }).promise()
                },
                promise: function(obj) {
                    return obj != null ? jQuery.extend(obj, promise) : promise
                }
            }
                , deferred = {};
            promise.pipe = promise.then;
            jQuery.each(tuples, function(i, tuple) {
                var list = tuple[2]
                    , stateString = tuple[3];
                promise[tuple[1]] = list.add;
                if (stateString) {
                    list.add(function() {
                        state = stateString
                    }, tuples[i ^ 1][2].disable, tuples[2][2].lock)
                }
                deferred[tuple[0]] = function() {
                    deferred[tuple[0] + "With"](this === deferred ? promise : this, arguments);
                    return this
                }
                ;
                deferred[tuple[0] + "With"] = list.fireWith
            });
            promise.promise(deferred);
            if (func) {
                func.call(deferred, deferred)
            }
            return deferred
        },
        when: function(subordinate) {
            var i = 0, resolveValues = slice.call(arguments), length = resolveValues.length, remaining = length !== 1 || subordinate && jQuery.isFunction(subordinate.promise) ? length : 0, deferred = remaining === 1 ? subordinate : jQuery.Deferred(), updateFunc = function(i, contexts, values) {
                return function(value) {
                    contexts[i] = this;
                    values[i] = arguments.length > 1 ? slice.call(arguments) : value;
                    if (values === progressValues) {
                        deferred.notifyWith(contexts, values)
                    } else if (!--remaining) {
                        deferred.resolveWith(contexts, values)
                    }
                }
            }, progressValues, progressContexts, resolveContexts;
            if (length > 1) {
                progressValues = new Array(length);
                progressContexts = new Array(length);
                resolveContexts = new Array(length);
                for (; i < length; i++) {
                    if (resolveValues[i] && jQuery.isFunction(resolveValues[i].promise)) {
                        resolveValues[i].promise().progress(updateFunc(i, progressContexts, progressValues)).done(updateFunc(i, resolveContexts, resolveValues)).fail(deferred.reject)
                    } else {
                        --remaining
                    }
                }
            }
            if (!remaining) {
                deferred.resolveWith(resolveContexts, resolveValues)
            }
            return deferred.promise()
        }
    });
    var readyList;
    jQuery.fn.ready = function(fn) {
        jQuery.ready.promise().done(fn);
        return this
    }
    ;
    jQuery.extend({
        isReady: false,
        readyWait: 1,
        holdReady: function(hold) {
            if (hold) {
                jQuery.readyWait++
            } else {
                jQuery.ready(true)
            }
        },
        ready: function(wait) {
            if (wait === true ? --jQuery.readyWait : jQuery.isReady) {
                return
            }
            jQuery.isReady = true;
            if (wait !== true && --jQuery.readyWait > 0) {
                return
            }
            readyList.resolveWith(document, [jQuery]);
            if (jQuery.fn.triggerHandler) {
                jQuery(document).triggerHandler("ready");
                jQuery(document).off("ready")
            }
        }
    });
    function completed() {
        document.removeEventListener("DOMContentLoaded", completed);
        window.removeEventListener("load", completed);
        jQuery.ready()
    }
    jQuery.ready.promise = function(obj) {
        if (!readyList) {
            readyList = jQuery.Deferred();
            if (document.readyState === "complete" || document.readyState !== "loading" && !document.documentElement.doScroll) {
                window.setTimeout(jQuery.ready)
            } else {
                document.addEventListener("DOMContentLoaded", completed);
                window.addEventListener("load", completed)
            }
        }
        return readyList.promise(obj)
    }
    ;
    jQuery.ready.promise();
    var access = function(elems, fn, key, value, chainable, emptyGet, raw) {
        var i = 0
            , len = elems.length
            , bulk = key == null;
        if (jQuery.type(key) === "object") {
            chainable = true;
            for (i in key) {
                access(elems, fn, i, key[i], true, emptyGet, raw)
            }
        } else if (value !== undefined) {
            chainable = true;
            if (!jQuery.isFunction(value)) {
                raw = true
            }
            if (bulk) {
                if (raw) {
                    fn.call(elems, value);
                    fn = null
                } else {
                    bulk = fn;
                    fn = function(elem, key, value) {
                        return bulk.call(jQuery(elem), value)
                    }
                }
            }
            if (fn) {
                for (; i < len; i++) {
                    fn(elems[i], key, raw ? value : value.call(elems[i], i, fn(elems[i], key)))
                }
            }
        }
        return chainable ? elems : bulk ? fn.call(elems) : len ? fn(elems[0], key) : emptyGet
    };
    var acceptData = function(owner) {
        return owner.nodeType === 1 || owner.nodeType === 9 || !+owner.nodeType
    };
    function Data() {
        this.expando = jQuery.expando + Data.uid++
    }
    Data.uid = 1;
    Data.prototype = {
        register: function(owner, initial) {
            var value = initial || {};
            if (owner.nodeType) {
                owner[this.expando] = value
            } else {
                Object.defineProperty(owner, this.expando, {
                    value: value,
                    writable: true,
                    configurable: true
                })
            }
            return owner[this.expando]
        },
        cache: function(owner) {
            if (!acceptData(owner)) {
                return {}
            }
            var value = owner[this.expando];
            if (!value) {
                value = {};
                if (acceptData(owner)) {
                    if (owner.nodeType) {
                        owner[this.expando] = value
                    } else {
                        Object.defineProperty(owner, this.expando, {
                            value: value,
                            configurable: true
                        })
                    }
                }
            }
            return value
        },
        set: function(owner, data, value) {
            var prop, cache = this.cache(owner);
            if (typeof data === "string") {
                cache[data] = value
            } else {
                for (prop in data) {
                    cache[prop] = data[prop]
                }
            }
            return cache
        },
        get: function(owner, key) {
            return key === undefined ? this.cache(owner) : owner[this.expando] && owner[this.expando][key]
        },
        access: function(owner, key, value) {
            var stored;
            if (key === undefined || key && typeof key === "string" && value === undefined) {
                stored = this.get(owner, key);
                return stored !== undefined ? stored : this.get(owner, jQuery.camelCase(key))
            }
            this.set(owner, key, value);
            return value !== undefined ? value : key
        },
        remove: function(owner, key) {
            var i, name, camel, cache = owner[this.expando];
            if (cache === undefined) {
                return
            }
            if (key === undefined) {
                this.register(owner)
            } else {
                if (jQuery.isArray(key)) {
                    name = key.concat(key.map(jQuery.camelCase))
                } else {
                    camel = jQuery.camelCase(key);
                    if (key in cache) {
                        name = [key, camel]
                    } else {
                        name = camel;
                        name = name in cache ? [name] : name.match(rnotwhite) || []
                    }
                }
                i = name.length;
                while (i--) {
                    delete cache[name[i]]
                }
            }
            if (key === undefined || jQuery.isEmptyObject(cache)) {
                if (owner.nodeType) {
                    owner[this.expando] = undefined
                } else {
                    delete owner[this.expando]
                }
            }
        },
        hasData: function(owner) {
            var cache = owner[this.expando];
            return cache !== undefined && !jQuery.isEmptyObject(cache)
        }
    };
    var dataPriv = new Data;
    var dataUser = new Data;
    var rbrace = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/
        , rmultiDash = /[A-Z]/g;
    function dataAttr(elem, key, data) {
        var name;
        if (data === undefined && elem.nodeType === 1) {
            name = "data-" + key.replace(rmultiDash, "-$&").toLowerCase();
            data = elem.getAttribute(name);
            if (typeof data === "string") {
                try {
                    data = data === "true" ? true : data === "false" ? false : data === "null" ? null : +data + "" === data ? +data : rbrace.test(data) ? jQuery.parseJSON(data) : data
                } catch (e) {}
                dataUser.set(elem, key, data)
            } else {
                data = undefined
            }
        }
        return data
    }
    jQuery.extend({
        hasData: function(elem) {
            return dataUser.hasData(elem) || dataPriv.hasData(elem)
        },
        data: function(elem, name, data) {
            return dataUser.access(elem, name, data)
        },
        removeData: function(elem, name) {
            dataUser.remove(elem, name)
        },
        _data: function(elem, name, data) {
            return dataPriv.access(elem, name, data)
        },
        _removeData: function(elem, name) {
            dataPriv.remove(elem, name)
        }
    });
    jQuery.fn.extend({
        data: function(key, value) {
            var i, name, data, elem = this[0], attrs = elem && elem.attributes;
            if (key === undefined) {
                if (this.length) {
                    data = dataUser.get(elem);
                    if (elem.nodeType === 1 && !dataPriv.get(elem, "hasDataAttrs")) {
                        i = attrs.length;
                        while (i--) {
                            if (attrs[i]) {
                                name = attrs[i].name;
                                if (name.indexOf("data-") === 0) {
                                    name = jQuery.camelCase(name.slice(5));
                                    dataAttr(elem, name, data[name])
                                }
                            }
                        }
                        dataPriv.set(elem, "hasDataAttrs", true)
                    }
                }
                return data
            }
            if (typeof key === "object") {
                return this.each(function() {
                    dataUser.set(this, key)
                })
            }
            return access(this, function(value) {
                var data, camelKey;
                if (elem && value === undefined) {
                    data = dataUser.get(elem, key) || dataUser.get(elem, key.replace(rmultiDash, "-$&").toLowerCase());
                    if (data !== undefined) {
                        return data
                    }
                    camelKey = jQuery.camelCase(key);
                    data = dataUser.get(elem, camelKey);
                    if (data !== undefined) {
                        return data
                    }
                    data = dataAttr(elem, camelKey, undefined);
                    if (data !== undefined) {
                        return data
                    }
                    return
                }
                camelKey = jQuery.camelCase(key);
                this.each(function() {
                    var data = dataUser.get(this, camelKey);
                    dataUser.set(this, camelKey, value);
                    if (key.indexOf("-") > -1 && data !== undefined) {
                        dataUser.set(this, key, value)
                    }
                })
            }, null, value, arguments.length > 1, null, true)
        },
        removeData: function(key) {
            return this.each(function() {
                dataUser.remove(this, key)
            })
        }
    });
    jQuery.extend({
        queue: function(elem, type, data) {
            var queue;
            if (elem) {
                type = (type || "fx") + "queue";
                queue = dataPriv.get(elem, type);
                if (data) {
                    if (!queue || jQuery.isArray(data)) {
                        queue = dataPriv.access(elem, type, jQuery.makeArray(data))
                    } else {
                        queue.push(data)
                    }
                }
                return queue || []
            }
        },
        dequeue: function(elem, type) {
            type = type || "fx";
            var queue = jQuery.queue(elem, type)
                , startLength = queue.length
                , fn = queue.shift()
                , hooks = jQuery._queueHooks(elem, type)
                , next = function() {
                jQuery.dequeue(elem, type)
            };
            if (fn === "inprogress") {
                fn = queue.shift();
                startLength--
            }
            if (fn) {
                if (type === "fx") {
                    queue.unshift("inprogress")
                }
                delete hooks.stop;
                fn.call(elem, next, hooks)
            }
            if (!startLength && hooks) {
                hooks.empty.fire()
            }
        },
        _queueHooks: function(elem, type) {
            var key = type + "queueHooks";
            return dataPriv.get(elem, key) || dataPriv.access(elem, key, {
                empty: jQuery.Callbacks("once memory").add(function() {
                    dataPriv.remove(elem, [type + "queue", key])
                })
            })
        }
    });
    jQuery.fn.extend({
        queue: function(type, data) {
            var setter = 2;
            if (typeof type !== "string") {
                data = type;
                type = "fx";
                setter--
            }
            if (arguments.length < setter) {
                return jQuery.queue(this[0], type)
            }
            return data === undefined ? this : this.each(function() {
                var queue = jQuery.queue(this, type, data);
                jQuery._queueHooks(this, type);
                if (type === "fx" && queue[0] !== "inprogress") {
                    jQuery.dequeue(this, type)
                }
            })
        },
        dequeue: function(type) {
            return this.each(function() {
                jQuery.dequeue(this, type)
            })
        },
        clearQueue: function(type) {
            return this.queue(type || "fx", [])
        },
        promise: function(type, obj) {
            var tmp, count = 1, defer = jQuery.Deferred(), elements = this, i = this.length, resolve = function() {
                if (!--count) {
                    defer.resolveWith(elements, [elements])
                }
            };
            if (typeof type !== "string") {
                obj = type;
                type = undefined
            }
            type = type || "fx";
            while (i--) {
                tmp = dataPriv.get(elements[i], type + "queueHooks");
                if (tmp && tmp.empty) {
                    count++;
                    tmp.empty.add(resolve)
                }
            }
            resolve();
            return defer.promise(obj)
        }
    });
    var pnum = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;
    var rcssNum = new RegExp("^(?:([+-])=|)(" + pnum + ")([a-z%]*)$","i");
    var cssExpand = ["Top", "Right", "Bottom", "Left"];
    var isHidden = function(elem, el) {
        elem = el || elem;
        return jQuery.css(elem, "display") === "none" || !jQuery.contains(elem.ownerDocument, elem)
    };
    function adjustCSS(elem, prop, valueParts, tween) {
        var adjusted, scale = 1, maxIterations = 20, currentValue = tween ? function() {
                return tween.cur()
            }
            : function() {
                return jQuery.css(elem, prop, "")
            }
            , initial = currentValue(), unit = valueParts && valueParts[3] || (jQuery.cssNumber[prop] ? "" : "px"), initialInUnit = (jQuery.cssNumber[prop] || unit !== "px" && +initial) && rcssNum.exec(jQuery.css(elem, prop));
        if (initialInUnit && initialInUnit[3] !== unit) {
            unit = unit || initialInUnit[3];
            valueParts = valueParts || [];
            initialInUnit = +initial || 1;
            do {
                scale = scale || ".5";
                initialInUnit = initialInUnit / scale;
                jQuery.style(elem, prop, initialInUnit + unit)
            } while (scale !== (scale = currentValue() / initial) && scale !== 1 && --maxIterations)
        }
        if (valueParts) {
            initialInUnit = +initialInUnit || +initial || 0;
            adjusted = valueParts[1] ? initialInUnit + (valueParts[1] + 1) * valueParts[2] : +valueParts[2];
            if (tween) {
                tween.unit = unit;
                tween.start = initialInUnit;
                tween.end = adjusted
            }
        }
        return adjusted
    }
    var rcheckableType = /^(?:checkbox|radio)$/i;
    var rtagName = /<([\w:-]+)/;
    var rscriptType = /^$|\/(?:java|ecma)script/i;
    var wrapMap = {
        option: [1, "<select multiple='multiple'>", "</select>"],
        thead: [1, "<table>", "</table>"],
        col: [2, "<table><colgroup>", "</colgroup></table>"],
        tr: [2, "<table><tbody>", "</tbody></table>"],
        td: [3, "<table><tbody><tr>", "</tr></tbody></table>"],
        _default: [0, "", ""]
    };
    wrapMap.optgroup = wrapMap.option;
    wrapMap.tbody = wrapMap.tfoot = wrapMap.colgroup = wrapMap.caption = wrapMap.thead;
    wrapMap.th = wrapMap.td;
    function getAll(context, tag) {
        var ret = typeof context.getElementsByTagName !== "undefined" ? context.getElementsByTagName(tag || "*") : typeof context.querySelectorAll !== "undefined" ? context.querySelectorAll(tag || "*") : [];
        return tag === undefined || tag && jQuery.nodeName(context, tag) ? jQuery.merge([context], ret) : ret
    }
    function setGlobalEval(elems, refElements) {
        var i = 0
            , l = elems.length;
        for (; i < l; i++) {
            dataPriv.set(elems[i], "globalEval", !refElements || dataPriv.get(refElements[i], "globalEval"))
        }
    }
    var rhtml = /<|&#?\w+;/;
    function buildFragment(elems, context, scripts, selection, ignored) {
        var elem, tmp, tag, wrap, contains, j, fragment = context.createDocumentFragment(), nodes = [], i = 0, l = elems.length;
        for (; i < l; i++) {
            elem = elems[i];
            if (elem || elem === 0) {
                if (jQuery.type(elem) === "object") {
                    jQuery.merge(nodes, elem.nodeType ? [elem] : elem)
                } else if (!rhtml.test(elem)) {
                    nodes.push(context.createTextNode(elem))
                } else {
                    tmp = tmp || fragment.appendChild(context.createElement("div"));
                    tag = (rtagName.exec(elem) || ["", ""])[1].toLowerCase();
                    wrap = wrapMap[tag] || wrapMap._default;
                    tmp.innerHTML = wrap[1] + jQuery.htmlPrefilter(elem) + wrap[2];
                    j = wrap[0];
                    while (j--) {
                        tmp = tmp.lastChild
                    }
                    jQuery.merge(nodes, tmp.childNodes);
                    tmp = fragment.firstChild;
                    tmp.textContent = ""
                }
            }
        }
        fragment.textContent = "";
        i = 0;
        while (elem = nodes[i++]) {
            if (selection && jQuery.inArray(elem, selection) > -1) {
                if (ignored) {
                    ignored.push(elem)
                }
                continue
            }
            contains = jQuery.contains(elem.ownerDocument, elem);
            tmp = getAll(fragment.appendChild(elem), "script");
            if (contains) {
                setGlobalEval(tmp)
            }
            if (scripts) {
                j = 0;
                while (elem = tmp[j++]) {
                    if (rscriptType.test(elem.type || "")) {
                        scripts.push(elem)
                    }
                }
            }
        }
        return fragment
    }
    (function() {
            var fragment = document.createDocumentFragment()
                , div = fragment.appendChild(document.createElement("div"))
                , input = document.createElement("input");
            input.setAttribute("type", "radio");
            input.setAttribute("checked", "checked");
            input.setAttribute("name", "t");
            div.appendChild(input);
            support.checkClone = div.cloneNode(true).cloneNode(true).lastChild.checked;
            div.innerHTML = "<textarea>x</textarea>";
            support.noCloneChecked = !!div.cloneNode(true).lastChild.defaultValue
        }
    )();
    var rkeyEvent = /^key/
        , rmouseEvent = /^(?:mouse|pointer|contextmenu|drag|drop)|click/
        , rtypenamespace = /^([^.]*)(?:\.(.+)|)/;
    function returnTrue() {
        return true
    }
    function returnFalse() {
        return false
    }
    function safeActiveElement() {
        try {
            return document.activeElement
        } catch (err) {}
    }
    function on(elem, types, selector, data, fn, one) {
        var origFn, type;
        if (typeof types === "object") {
            if (typeof selector !== "string") {
                data = data || selector;
                selector = undefined
            }
            for (type in types) {
                on(elem, type, selector, data, types[type], one)
            }
            return elem
        }
        if (data == null && fn == null) {
            fn = selector;
            data = selector = undefined
        } else if (fn == null) {
            if (typeof selector === "string") {
                fn = data;
                data = undefined
            } else {
                fn = data;
                data = selector;
                selector = undefined
            }
        }
        if (fn === false) {
            fn = returnFalse
        } else if (!fn) {
            return elem
        }
        if (one === 1) {
            origFn = fn;
            fn = function(event) {
                jQuery().off(event);
                return origFn.apply(this, arguments)
            }
            ;
            fn.guid = origFn.guid || (origFn.guid = jQuery.guid++)
        }
        return elem.each(function() {
            jQuery.event.add(this, types, fn, data, selector)
        })
    }
    jQuery.event = {
        global: {},
        add: function(elem, types, handler, data, selector) {
            var handleObjIn, eventHandle, tmp, events, t, handleObj, special, handlers, type, namespaces, origType, elemData = dataPriv.get(elem);
            if (!elemData) {
                return
            }
            if (handler.handler) {
                handleObjIn = handler;
                handler = handleObjIn.handler;
                selector = handleObjIn.selector
            }
            if (!handler.guid) {
                handler.guid = jQuery.guid++
            }
            if (!(events = elemData.events)) {
                events = elemData.events = {}
            }
            if (!(eventHandle = elemData.handle)) {
                eventHandle = elemData.handle = function(e) {
                    return typeof jQuery !== "undefined" && jQuery.event.triggered !== e.type ? jQuery.event.dispatch.apply(elem, arguments) : undefined
                }
            }
            types = (types || "").match(rnotwhite) || [""];
            t = types.length;
            while (t--) {
                tmp = rtypenamespace.exec(types[t]) || [];
                type = origType = tmp[1];
                namespaces = (tmp[2] || "").split(".").sort();
                if (!type) {
                    continue
                }
                special = jQuery.event.special[type] || {};
                type = (selector ? special.delegateType : special.bindType) || type;
                special = jQuery.event.special[type] || {};
                handleObj = jQuery.extend({
                    type: type,
                    origType: origType,
                    data: data,
                    handler: handler,
                    guid: handler.guid,
                    selector: selector,
                    needsContext: selector && jQuery.expr.match.needsContext.test(selector),
                    namespace: namespaces.join(".")
                }, handleObjIn);
                if (!(handlers = events[type])) {
                    handlers = events[type] = [];
                    handlers.delegateCount = 0;
                    if (!special.setup || special.setup.call(elem, data, namespaces, eventHandle) === false) {
                        if (elem.addEventListener) {
                            elem.addEventListener(type, eventHandle)
                        }
                    }
                }
                if (special.add) {
                    special.add.call(elem, handleObj);
                    if (!handleObj.handler.guid) {
                        handleObj.handler.guid = handler.guid
                    }
                }
                if (selector) {
                    handlers.splice(handlers.delegateCount++, 0, handleObj)
                } else {
                    handlers.push(handleObj)
                }
                jQuery.event.global[type] = true
            }
        },
        remove: function(elem, types, handler, selector, mappedTypes) {
            var j, origCount, tmp, events, t, handleObj, special, handlers, type, namespaces, origType, elemData = dataPriv.hasData(elem) && dataPriv.get(elem);
            if (!elemData || !(events = elemData.events)) {
                return
            }
            types = (types || "").match(rnotwhite) || [""];
            t = types.length;
            while (t--) {
                tmp = rtypenamespace.exec(types[t]) || [];
                type = origType = tmp[1];
                namespaces = (tmp[2] || "").split(".").sort();
                if (!type) {
                    for (type in events) {
                        jQuery.event.remove(elem, type + types[t], handler, selector, true)
                    }
                    continue
                }
                special = jQuery.event.special[type] || {};
                type = (selector ? special.delegateType : special.bindType) || type;
                handlers = events[type] || [];
                tmp = tmp[2] && new RegExp("(^|\\.)" + namespaces.join("\\.(?:.*\\.|)") + "(\\.|$)");
                origCount = j = handlers.length;
                while (j--) {
                    handleObj = handlers[j];
                    if ((mappedTypes || origType === handleObj.origType) && (!handler || handler.guid === handleObj.guid) && (!tmp || tmp.test(handleObj.namespace)) && (!selector || selector === handleObj.selector || selector === "**" && handleObj.selector)) {
                        handlers.splice(j, 1);
                        if (handleObj.selector) {
                            handlers.delegateCount--
                        }
                        if (special.remove) {
                            special.remove.call(elem, handleObj)
                        }
                    }
                }
                if (origCount && !handlers.length) {
                    if (!special.teardown || special.teardown.call(elem, namespaces, elemData.handle) === false) {
                        jQuery.removeEvent(elem, type, elemData.handle)
                    }
                    delete events[type]
                }
            }
            if (jQuery.isEmptyObject(events)) {
                dataPriv.remove(elem, "handle events")
            }
        },
        dispatch: function(event) {
            event = jQuery.event.fix(event);
            var i, j, ret, matched, handleObj, handlerQueue = [], args = slice.call(arguments), handlers = (dataPriv.get(this, "events") || {})[event.type] || [], special = jQuery.event.special[event.type] || {};
            args[0] = event;
            event.delegateTarget = this;
            if (special.preDispatch && special.preDispatch.call(this, event) === false) {
                return
            }
            handlerQueue = jQuery.event.handlers.call(this, event, handlers);
            i = 0;
            while ((matched = handlerQueue[i++]) && !event.isPropagationStopped()) {
                event.currentTarget = matched.elem;
                j = 0;
                while ((handleObj = matched.handlers[j++]) && !event.isImmediatePropagationStopped()) {
                    if (!event.rnamespace || event.rnamespace.test(handleObj.namespace)) {
                        event.handleObj = handleObj;
                        event.data = handleObj.data;
                        ret = ((jQuery.event.special[handleObj.origType] || {}).handle || handleObj.handler).apply(matched.elem, args);
                        if (ret !== undefined) {
                            if ((event.result = ret) === false) {
                                event.preventDefault();
                                event.stopPropagation()
                            }
                        }
                    }
                }
            }
            if (special.postDispatch) {
                special.postDispatch.call(this, event)
            }
            return event.result
        },
        handlers: function(event, handlers) {
            var i, matches, sel, handleObj, handlerQueue = [], delegateCount = handlers.delegateCount, cur = event.target;
            if (delegateCount && cur.nodeType && (event.type !== "click" || isNaN(event.button) || event.button < 1)) {
                for (; cur !== this; cur = cur.parentNode || this) {
                    if (cur.nodeType === 1 && (cur.disabled !== true || event.type !== "click")) {
                        matches = [];
                        for (i = 0; i < delegateCount; i++) {
                            handleObj = handlers[i];
                            sel = handleObj.selector + " ";
                            if (matches[sel] === undefined) {
                                matches[sel] = handleObj.needsContext ? jQuery(sel, this).index(cur) > -1 : jQuery.find(sel, this, null, [cur]).length
                            }
                            if (matches[sel]) {
                                matches.push(handleObj)
                            }
                        }
                        if (matches.length) {
                            handlerQueue.push({
                                elem: cur,
                                handlers: matches
                            })
                        }
                    }
                }
            }
            if (delegateCount < handlers.length) {
                handlerQueue.push({
                    elem: this,
                    handlers: handlers.slice(delegateCount)
                })
            }
            return handlerQueue
        },
        props: ("altKey bubbles cancelable ctrlKey currentTarget detail eventPhase " + "metaKey relatedTarget shiftKey target timeStamp view which").split(" "),
        fixHooks: {},
        keyHooks: {
            props: "char charCode key keyCode".split(" "),
            filter: function(event, original) {
                if (event.which == null) {
                    event.which = original.charCode != null ? original.charCode : original.keyCode
                }
                return event
            }
        },
        mouseHooks: {
            props: ("button buttons clientX clientY offsetX offsetY pageX pageY " + "screenX screenY toElement").split(" "),
            filter: function(event, original) {
                var eventDoc, doc, body, button = original.button;
                if (event.pageX == null && original.clientX != null) {
                    eventDoc = event.target.ownerDocument || document;
                    doc = eventDoc.documentElement;
                    body = eventDoc.body;
                    event.pageX = original.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);
                    event.pageY = original.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0)
                }
                if (!event.which && button !== undefined) {
                    event.which = button & 1 ? 1 : button & 2 ? 3 : button & 4 ? 2 : 0
                }
                return event
            }
        },
        fix: function(event) {
            if (event[jQuery.expando]) {
                return event
            }
            var i, prop, copy, type = event.type, originalEvent = event, fixHook = this.fixHooks[type];
            if (!fixHook) {
                this.fixHooks[type] = fixHook = rmouseEvent.test(type) ? this.mouseHooks : rkeyEvent.test(type) ? this.keyHooks : {}
            }
            copy = fixHook.props ? this.props.concat(fixHook.props) : this.props;
            event = new jQuery.Event(originalEvent);
            i = copy.length;
            while (i--) {
                prop = copy[i];
                event[prop] = originalEvent[prop]
            }
            if (!event.target) {
                event.target = document
            }
            if (event.target.nodeType === 3) {
                event.target = event.target.parentNode
            }
            return fixHook.filter ? fixHook.filter(event, originalEvent) : event
        },
        special: {
            load: {
                noBubble: true
            },
            focus: {
                trigger: function() {
                    if (this !== safeActiveElement() && this.focus) {
                        this.focus();
                        return false
                    }
                },
                delegateType: "focusin"
            },
            blur: {
                trigger: function() {
                    if (this === safeActiveElement() && this.blur) {
                        this.blur();
                        return false
                    }
                },
                delegateType: "focusout"
            },
            click: {
                trigger: function() {
                    if (this.type === "checkbox" && this.click && jQuery.nodeName(this, "input")) {
                        this.click();
                        return false
                    }
                },
                _default: function(event) {
                    return jQuery.nodeName(event.target, "a")
                }
            },
            beforeunload: {
                postDispatch: function(event) {
                    if (event.result !== undefined && event.originalEvent) {
                        event.originalEvent.returnValue = event.result
                    }
                }
            }
        }
    };
    jQuery.removeEvent = function(elem, type, handle) {
        if (elem.removeEventListener) {
            elem.removeEventListener(type, handle)
        }
    }
    ;
    jQuery.Event = function(src, props) {
        if (!(this instanceof jQuery.Event)) {
            return new jQuery.Event(src,props)
        }
        if (src && src.type) {
            this.originalEvent = src;
            this.type = src.type;
            this.isDefaultPrevented = src.defaultPrevented || src.defaultPrevented === undefined && src.returnValue === false ? returnTrue : returnFalse
        } else {
            this.type = src
        }
        if (props) {
            jQuery.extend(this, props)
        }
        this.timeStamp = src && src.timeStamp || jQuery.now();
        this[jQuery.expando] = true
    }
    ;
    jQuery.Event.prototype = {
        constructor: jQuery.Event,
        isDefaultPrevented: returnFalse,
        isPropagationStopped: returnFalse,
        isImmediatePropagationStopped: returnFalse,
        isSimulated: false,
        preventDefault: function() {
            var e = this.originalEvent;
            this.isDefaultPrevented = returnTrue;
            if (e && !this.isSimulated) {
                e.preventDefault()
            }
        },
        stopPropagation: function() {
            var e = this.originalEvent;
            this.isPropagationStopped = returnTrue;
            if (e && !this.isSimulated) {
                e.stopPropagation()
            }
        },
        stopImmediatePropagation: function() {
            var e = this.originalEvent;
            this.isImmediatePropagationStopped = returnTrue;
            if (e && !this.isSimulated) {
                e.stopImmediatePropagation()
            }
            this.stopPropagation()
        }
    };
    jQuery.each({
        mouseenter: "mouseover",
        mouseleave: "mouseout",
        pointerenter: "pointerover",
        pointerleave: "pointerout"
    }, function(orig, fix) {
        jQuery.event.special[orig] = {
            delegateType: fix,
            bindType: fix,
            handle: function(event) {
                var ret, target = this, related = event.relatedTarget, handleObj = event.handleObj;
                if (!related || related !== target && !jQuery.contains(target, related)) {
                    event.type = handleObj.origType;
                    ret = handleObj.handler.apply(this, arguments);
                    event.type = fix
                }
                return ret
            }
        }
    });
    jQuery.fn.extend({
        on: function(types, selector, data, fn) {
            return on(this, types, selector, data, fn)
        },
        one: function(types, selector, data, fn) {
            return on(this, types, selector, data, fn, 1)
        },
        off: function(types, selector, fn) {
            var handleObj, type;
            if (types && types.preventDefault && types.handleObj) {
                handleObj = types.handleObj;
                jQuery(types.delegateTarget).off(handleObj.namespace ? handleObj.origType + "." + handleObj.namespace : handleObj.origType, handleObj.selector, handleObj.handler);
                return this
            }
            if (typeof types === "object") {
                for (type in types) {
                    this.off(type, selector, types[type])
                }
                return this
            }
            if (selector === false || typeof selector === "function") {
                fn = selector;
                selector = undefined
            }
            if (fn === false) {
                fn = returnFalse
            }
            return this.each(function() {
                jQuery.event.remove(this, types, fn, selector)
            })
        }
    });
    var rxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi
        , rnoInnerhtml = /<script|<style|<link/i
        , rchecked = /checked\s*(?:[^=]|=\s*.checked.)/i
        , rscriptTypeMasked = /^true\/(.*)/
        , rcleanScript = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;
    function manipulationTarget(elem, content) {
        return jQuery.nodeName(elem, "table") && jQuery.nodeName(content.nodeType !== 11 ? content : content.firstChild, "tr") ? elem.getElementsByTagName("tbody")[0] || elem.appendChild(elem.ownerDocument.createElement("tbody")) : elem
    }
    function disableScript(elem) {
        elem.type = (elem.getAttribute("type") !== null) + "/" + elem.type;
        return elem
    }
    function restoreScript(elem) {
        var match = rscriptTypeMasked.exec(elem.type);
        if (match) {
            elem.type = match[1]
        } else {
            elem.removeAttribute("type")
        }
        return elem
    }
    function cloneCopyEvent(src, dest) {
        var i, l, type, pdataOld, pdataCur, udataOld, udataCur, events;
        if (dest.nodeType !== 1) {
            return
        }
        if (dataPriv.hasData(src)) {
            pdataOld = dataPriv.access(src);
            pdataCur = dataPriv.set(dest, pdataOld);
            events = pdataOld.events;
            if (events) {
                delete pdataCur.handle;
                pdataCur.events = {};
                for (type in events) {
                    for (i = 0,
                             l = events[type].length; i < l; i++) {
                        jQuery.event.add(dest, type, events[type][i])
                    }
                }
            }
        }
        if (dataUser.hasData(src)) {
            udataOld = dataUser.access(src);
            udataCur = jQuery.extend({}, udataOld);
            dataUser.set(dest, udataCur)
        }
    }
    function fixInput(src, dest) {
        var nodeName = dest.nodeName.toLowerCase();
        if (nodeName === "input" && rcheckableType.test(src.type)) {
            dest.checked = src.checked
        } else if (nodeName === "input" || nodeName === "textarea") {
            dest.defaultValue = src.defaultValue
        }
    }
    function domManip(collection, args, callback, ignored) {
        args = concat.apply([], args);
        var fragment, first, scripts, hasScripts, node, doc, i = 0, l = collection.length, iNoClone = l - 1, value = args[0], isFunction = jQuery.isFunction(value);
        if (isFunction || l > 1 && typeof value === "string" && !support.checkClone && rchecked.test(value)) {
            return collection.each(function(index) {
                var self = collection.eq(index);
                if (isFunction) {
                    args[0] = value.call(this, index, self.html())
                }
                domManip(self, args, callback, ignored)
            })
        }
        if (l) {
            fragment = buildFragment(args, collection[0].ownerDocument, false, collection, ignored);
            first = fragment.firstChild;
            if (fragment.childNodes.length === 1) {
                fragment = first
            }
            if (first || ignored) {
                scripts = jQuery.map(getAll(fragment, "script"), disableScript);
                hasScripts = scripts.length;
                for (; i < l; i++) {
                    node = fragment;
                    if (i !== iNoClone) {
                        node = jQuery.clone(node, true, true);
                        if (hasScripts) {
                            jQuery.merge(scripts, getAll(node, "script"))
                        }
                    }
                    callback.call(collection[i], node, i)
                }
                if (hasScripts) {
                    doc = scripts[scripts.length - 1].ownerDocument;
                    jQuery.map(scripts, restoreScript);
                    for (i = 0; i < hasScripts; i++) {
                        node = scripts[i];
                        if (rscriptType.test(node.type || "") && !dataPriv.access(node, "globalEval") && jQuery.contains(doc, node)) {
                            if (node.src) {
                                if (jQuery._evalUrl) {
                                    jQuery._evalUrl(node.src)
                                }
                            } else {
                                jQuery.globalEval(node.textContent.replace(rcleanScript, ""))
                            }
                        }
                    }
                }
            }
        }
        return collection
    }
    function remove(elem, selector, keepData) {
        var node, nodes = selector ? jQuery.filter(selector, elem) : elem, i = 0;
        for (; (node = nodes[i]) != null; i++) {
            if (!keepData && node.nodeType === 1) {
                jQuery.cleanData(getAll(node))
            }
            if (node.parentNode) {
                if (keepData && jQuery.contains(node.ownerDocument, node)) {
                    setGlobalEval(getAll(node, "script"))
                }
                node.parentNode.removeChild(node)
            }
        }
        return elem
    }
    jQuery.extend({
        htmlPrefilter: function(html) {
            return html.replace(rxhtmlTag, "<$1></$2>")
        },
        clone: function(elem, dataAndEvents, deepDataAndEvents) {
            var i, l, srcElements, destElements, clone = elem.cloneNode(true), inPage = jQuery.contains(elem.ownerDocument, elem);
            if (!support.noCloneChecked && (elem.nodeType === 1 || elem.nodeType === 11) && !jQuery.isXMLDoc(elem)) {
                destElements = getAll(clone);
                srcElements = getAll(elem);
                for (i = 0,
                         l = srcElements.length; i < l; i++) {
                    fixInput(srcElements[i], destElements[i])
                }
            }
            if (dataAndEvents) {
                if (deepDataAndEvents) {
                    srcElements = srcElements || getAll(elem);
                    destElements = destElements || getAll(clone);
                    for (i = 0,
                             l = srcElements.length; i < l; i++) {
                        cloneCopyEvent(srcElements[i], destElements[i])
                    }
                } else {
                    cloneCopyEvent(elem, clone)
                }
            }
            destElements = getAll(clone, "script");
            if (destElements.length > 0) {
                setGlobalEval(destElements, !inPage && getAll(elem, "script"))
            }
            return clone
        },
        cleanData: function(elems) {
            var data, elem, type, special = jQuery.event.special, i = 0;
            for (; (elem = elems[i]) !== undefined; i++) {
                if (acceptData(elem)) {
                    if (data = elem[dataPriv.expando]) {
                        if (data.events) {
                            for (type in data.events) {
                                if (special[type]) {
                                    jQuery.event.remove(elem, type)
                                } else {
                                    jQuery.removeEvent(elem, type, data.handle)
                                }
                            }
                        }
                        elem[dataPriv.expando] = undefined
                    }
                    if (elem[dataUser.expando]) {
                        elem[dataUser.expando] = undefined
                    }
                }
            }
        }
    });
    jQuery.fn.extend({
        domManip: domManip,
        detach: function(selector) {
            return remove(this, selector, true)
        },
        remove: function(selector) {
            return remove(this, selector)
        },
        text: function(value) {
            return access(this, function(value) {
                return value === undefined ? jQuery.text(this) : this.empty().each(function() {
                    if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9) {
                        this.textContent = value
                    }
                })
            }, null, value, arguments.length)
        },
        append: function() {
            return domManip(this, arguments, function(elem) {
                if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9) {
                    var target = manipulationTarget(this, elem);
                    target.appendChild(elem)
                }
            })
        },
        prepend: function() {
            return domManip(this, arguments, function(elem) {
                if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9) {
                    var target = manipulationTarget(this, elem);
                    target.insertBefore(elem, target.firstChild)
                }
            })
        },
        before: function() {
            return domManip(this, arguments, function(elem) {
                if (this.parentNode) {
                    this.parentNode.insertBefore(elem, this)
                }
            })
        },
        after: function() {
            return domManip(this, arguments, function(elem) {
                if (this.parentNode) {
                    this.parentNode.insertBefore(elem, this.nextSibling)
                }
            })
        },
        empty: function() {
            var elem, i = 0;
            for (; (elem = this[i]) != null; i++) {
                if (elem.nodeType === 1) {
                    jQuery.cleanData(getAll(elem, false));
                    elem.textContent = ""
                }
            }
            return this
        },
        clone: function(dataAndEvents, deepDataAndEvents) {
            dataAndEvents = dataAndEvents == null ? false : dataAndEvents;
            deepDataAndEvents = deepDataAndEvents == null ? dataAndEvents : deepDataAndEvents;
            return this.map(function() {
                return jQuery.clone(this, dataAndEvents, deepDataAndEvents)
            })
        },
        html: function(value) {
            return access(this, function(value) {
                var elem = this[0] || {}
                    , i = 0
                    , l = this.length;
                if (value === undefined && elem.nodeType === 1) {
                    return elem.innerHTML
                }
                if (typeof value === "string" && !rnoInnerhtml.test(value) && !wrapMap[(rtagName.exec(value) || ["", ""])[1].toLowerCase()]) {
                    value = jQuery.htmlPrefilter(value);
                    try {
                        for (; i < l; i++) {
                            elem = this[i] || {};
                            if (elem.nodeType === 1) {
                                jQuery.cleanData(getAll(elem, false));
                                elem.innerHTML = value
                            }
                        }
                        elem = 0
                    } catch (e) {}
                }
                if (elem) {
                    this.empty().append(value)
                }
            }, null, value, arguments.length)
        },
        replaceWith: function() {
            var ignored = [];
            return domManip(this, arguments, function(elem) {
                var parent = this.parentNode;
                if (jQuery.inArray(this, ignored) < 0) {
                    jQuery.cleanData(getAll(this));
                    if (parent) {
                        parent.replaceChild(elem, this)
                    }
                }
            }, ignored)
        }
    });
    jQuery.each({
        appendTo: "append",
        prependTo: "prepend",
        insertBefore: "before",
        insertAfter: "after",
        replaceAll: "replaceWith"
    }, function(name, original) {
        jQuery.fn[name] = function(selector) {
            var elems, ret = [], insert = jQuery(selector), last = insert.length - 1, i = 0;
            for (; i <= last; i++) {
                elems = i === last ? this : this.clone(true);
                jQuery(insert[i])[original](elems);
                push.apply(ret, elems.get())
            }
            return this.pushStack(ret)
        }
    });
    var iframe, elemdisplay = {
        HTML: "block",
        BODY: "block"
    };
    function actualDisplay(name, doc) {
        var elem = jQuery(doc.createElement(name)).appendTo(doc.body)
            , display = jQuery.css(elem[0], "display");
        elem.detach();
        return display
    }
    function defaultDisplay(nodeName) {
        var doc = document
            , display = elemdisplay[nodeName];
        if (!display) {
            display = actualDisplay(nodeName, doc);
            if (display === "none" || !display) {
                iframe = (iframe || jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement);
                doc = iframe[0].contentDocument;
                doc.write();
                doc.close();
                display = actualDisplay(nodeName, doc);
                iframe.detach()
            }
            elemdisplay[nodeName] = display
        }
        return display
    }
    var rmargin = /^margin/;
    var rnumnonpx = new RegExp("^(" + pnum + ")(?!px)[a-z%]+$","i");
    var getStyles = function(elem) {
        var view = elem.ownerDocument.defaultView;
        if (!view || !view.opener) {
            view = window
        }
        return view.getComputedStyle(elem)
    };
    var swap = function(elem, options, callback, args) {
        var ret, name, old = {};
        for (name in options) {
            old[name] = elem.style[name];
            elem.style[name] = options[name]
        }
        ret = callback.apply(elem, args || []);
        for (name in options) {
            elem.style[name] = old[name]
        }
        return ret
    };
    var documentElement = document.documentElement;
    (function() {
            var pixelPositionVal, boxSizingReliableVal, pixelMarginRightVal, reliableMarginLeftVal, container = document.createElement("div"), div = document.createElement("div");
            if (!div.style) {
                return
            }
            div.style.backgroundClip = "content-box";
            div.cloneNode(true).style.backgroundClip = "";
            support.clearCloneStyle = div.style.backgroundClip === "content-box";
            container.style.cssText = "border:0;width:8px;height:0;top:0;left:-9999px;" + "padding:0;margin-top:1px;position:absolute";
            container.appendChild(div);
            function computeStyleTests() {
                div.style.cssText = "-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;" + "position:relative;display:block;" + "margin:auto;border:1px;padding:1px;" + "top:1%;width:50%";
                div.innerHTML = "";
                documentElement.appendChild(container);
                var divStyle = window.getComputedStyle(div);
                pixelPositionVal = divStyle.top !== "1%";
                reliableMarginLeftVal = divStyle.marginLeft === "2px";
                boxSizingReliableVal = divStyle.width === "4px";
                div.style.marginRight = "50%";
                pixelMarginRightVal = divStyle.marginRight === "4px";
                documentElement.removeChild(container)
            }
            jQuery.extend(support, {
                pixelPosition: function() {
                    computeStyleTests();
                    return pixelPositionVal
                },
                boxSizingReliable: function() {
                    if (boxSizingReliableVal == null) {
                        computeStyleTests()
                    }
                    return boxSizingReliableVal
                },
                pixelMarginRight: function() {
                    if (boxSizingReliableVal == null) {
                        computeStyleTests()
                    }
                    return pixelMarginRightVal
                },
                reliableMarginLeft: function() {
                    if (boxSizingReliableVal == null) {
                        computeStyleTests()
                    }
                    return reliableMarginLeftVal
                },
                reliableMarginRight: function() {
                    var ret, marginDiv = div.appendChild(document.createElement("div"));
                    marginDiv.style.cssText = div.style.cssText = "-webkit-box-sizing:content-box;box-sizing:content-box;" + "display:block;margin:0;border:0;padding:0";
                    marginDiv.style.marginRight = marginDiv.style.width = "0";
                    div.style.width = "1px";
                    documentElement.appendChild(container);
                    ret = !parseFloat(window.getComputedStyle(marginDiv).marginRight);
                    documentElement.removeChild(container);
                    div.removeChild(marginDiv);
                    return ret
                }
            })
        }
    )();
    function curCSS(elem, name, computed) {
        var width, minWidth, maxWidth, ret, style = elem.style;
        computed = computed || getStyles(elem);
        ret = computed ? computed.getPropertyValue(name) || computed[name] : undefined;
        if ((ret === "" || ret === undefined) && !jQuery.contains(elem.ownerDocument, elem)) {
            ret = jQuery.style(elem, name)
        }
        if (computed) {
            if (!support.pixelMarginRight() && rnumnonpx.test(ret) && rmargin.test(name)) {
                width = style.width;
                minWidth = style.minWidth;
                maxWidth = style.maxWidth;
                style.minWidth = style.maxWidth = style.width = ret;
                ret = computed.width;
                style.width = width;
                style.minWidth = minWidth;
                style.maxWidth = maxWidth
            }
        }
        return ret !== undefined ? ret + "" : ret
    }
    function addGetHookIf(conditionFn, hookFn) {
        return {
            get: function() {
                if (conditionFn()) {
                    delete this.get;
                    return
                }
                return (this.get = hookFn).apply(this, arguments)
            }
        }
    }
    var rdisplayswap = /^(none|table(?!-c[ea]).+)/
        , cssShow = {
        position: "absolute",
        visibility: "hidden",
        display: "block"
    }
        , cssNormalTransform = {
        letterSpacing: "0",
        fontWeight: "400"
    }
        , cssPrefixes = ["Webkit", "O", "Moz", "ms"]
        , emptyStyle = document.createElement("div").style;
    function vendorPropName(name) {
        if (name in emptyStyle) {
            return name
        }
        var capName = name[0].toUpperCase() + name.slice(1)
            , i = cssPrefixes.length;
        while (i--) {
            name = cssPrefixes[i] + capName;
            if (name in emptyStyle) {
                return name
            }
        }
    }
    function setPositiveNumber(elem, value, subtract) {
        var matches = rcssNum.exec(value);
        return matches ? Math.max(0, matches[2] - (subtract || 0)) + (matches[3] || "px") : value
    }
    function augmentWidthOrHeight(elem, name, extra, isBorderBox, styles) {
        var i = extra === (isBorderBox ? "border" : "content") ? 4 : name === "width" ? 1 : 0
            , val = 0;
        for (; i < 4; i += 2) {
            if (extra === "margin") {
                val += jQuery.css(elem, extra + cssExpand[i], true, styles)
            }
            if (isBorderBox) {
                if (extra === "content") {
                    val -= jQuery.css(elem, "padding" + cssExpand[i], true, styles)
                }
                if (extra !== "margin") {
                    val -= jQuery.css(elem, "border" + cssExpand[i] + "Width", true, styles)
                }
            } else {
                val += jQuery.css(elem, "padding" + cssExpand[i], true, styles);
                if (extra !== "padding") {
                    val += jQuery.css(elem, "border" + cssExpand[i] + "Width", true, styles)
                }
            }
        }
        return val
    }
    function getWidthOrHeight(elem, name, extra) {
        var valueIsBorderBox = true
            , val = name === "width" ? elem.offsetWidth : elem.offsetHeight
            , styles = getStyles(elem)
            , isBorderBox = jQuery.css(elem, "boxSizing", false, styles) === "border-box";
        if (val <= 0 || val == null) {
            val = curCSS(elem, name, styles);
            if (val < 0 || val == null) {
                val = elem.style[name]
            }
            if (rnumnonpx.test(val)) {
                return val
            }
            valueIsBorderBox = isBorderBox && (support.boxSizingReliable() || val === elem.style[name]);
            val = parseFloat(val) || 0
        }
        return val + augmentWidthOrHeight(elem, name, extra || (isBorderBox ? "border" : "content"), valueIsBorderBox, styles) + "px"
    }
    function showHide(elements, show) {
        var display, elem, hidden, values = [], index = 0, length = elements.length;
        for (; index < length; index++) {
            elem = elements[index];
            if (!elem.style) {
                continue
            }
            values[index] = dataPriv.get(elem, "olddisplay");
            display = elem.style.display;
            if (show) {
                if (!values[index] && display === "none") {
                    elem.style.display = ""
                }
                if (elem.style.display === "" && isHidden(elem)) {
                    values[index] = dataPriv.access(elem, "olddisplay", defaultDisplay(elem.nodeName))
                }
            } else {
                hidden = isHidden(elem);
                if (display !== "none" || !hidden) {
                    dataPriv.set(elem, "olddisplay", hidden ? display : jQuery.css(elem, "display"))
                }
            }
        }
        for (index = 0; index < length; index++) {
            elem = elements[index];
            if (!elem.style) {
                continue
            }
            if (!show || elem.style.display === "none" || elem.style.display === "") {
                elem.style.display = show ? values[index] || "" : "none"
            }
        }
        return elements
    }
    jQuery.extend({
        cssHooks: {
            opacity: {
                get: function(elem, computed) {
                    if (computed) {
                        var ret = curCSS(elem, "opacity");
                        return ret === "" ? "1" : ret
                    }
                }
            }
        },
        cssNumber: {
            animationIterationCount: true,
            columnCount: true,
            fillOpacity: true,
            flexGrow: true,
            flexShrink: true,
            fontWeight: true,
            lineHeight: true,
            opacity: true,
            order: true,
            orphans: true,
            widows: true,
            zIndex: true,
            zoom: true
        },
        cssProps: {
            float: "cssFloat"
        },
        style: function(elem, name, value, extra) {
            if (!elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style) {
                return
            }
            var ret, type, hooks, origName = jQuery.camelCase(name), style = elem.style;
            name = jQuery.cssProps[origName] || (jQuery.cssProps[origName] = vendorPropName(origName) || origName);
            hooks = jQuery.cssHooks[name] || jQuery.cssHooks[origName];
            if (value !== undefined) {
                type = typeof value;
                if (type === "string" && (ret = rcssNum.exec(value)) && ret[1]) {
                    value = adjustCSS(elem, name, ret);
                    type = "number"
                }
                if (value == null || value !== value) {
                    return
                }
                if (type === "number") {
                    value += ret && ret[3] || (jQuery.cssNumber[origName] ? "" : "px")
                }
                if (!support.clearCloneStyle && value === "" && name.indexOf("background") === 0) {
                    style[name] = "inherit"
                }
                if (!hooks || !("set"in hooks) || (value = hooks.set(elem, value, extra)) !== undefined) {
                    style[name] = value
                }
            } else {
                if (hooks && "get"in hooks && (ret = hooks.get(elem, false, extra)) !== undefined) {
                    return ret
                }
                return style[name]
            }
        },
        css: function(elem, name, extra, styles) {
            var val, num, hooks, origName = jQuery.camelCase(name);
            name = jQuery.cssProps[origName] || (jQuery.cssProps[origName] = vendorPropName(origName) || origName);
            hooks = jQuery.cssHooks[name] || jQuery.cssHooks[origName];
            if (hooks && "get"in hooks) {
                val = hooks.get(elem, true, extra)
            }
            if (val === undefined) {
                val = curCSS(elem, name, styles)
            }
            if (val === "normal" && name in cssNormalTransform) {
                val = cssNormalTransform[name]
            }
            if (extra === "" || extra) {
                num = parseFloat(val);
                return extra === true || isFinite(num) ? num || 0 : val
            }
            return val
        }
    });
    jQuery.each(["height", "width"], function(i, name) {
        jQuery.cssHooks[name] = {
            get: function(elem, computed, extra) {
                if (computed) {
                    return rdisplayswap.test(jQuery.css(elem, "display")) && elem.offsetWidth === 0 ? swap(elem, cssShow, function() {
                        return getWidthOrHeight(elem, name, extra)
                    }) : getWidthOrHeight(elem, name, extra)
                }
            },
            set: function(elem, value, extra) {
                var matches, styles = extra && getStyles(elem), subtract = extra && augmentWidthOrHeight(elem, name, extra, jQuery.css(elem, "boxSizing", false, styles) === "border-box", styles);
                if (subtract && (matches = rcssNum.exec(value)) && (matches[3] || "px") !== "px") {
                    elem.style[name] = value;
                    value = jQuery.css(elem, name)
                }
                return setPositiveNumber(elem, value, subtract)
            }
        }
    });
    jQuery.cssHooks.marginLeft = addGetHookIf(support.reliableMarginLeft, function(elem, computed) {
        if (computed) {
            return (parseFloat(curCSS(elem, "marginLeft")) || elem.getBoundingClientRect().left - swap(elem, {
                marginLeft: 0
            }, function() {
                return elem.getBoundingClientRect().left
            })) + "px"
        }
    });
    jQuery.cssHooks.marginRight = addGetHookIf(support.reliableMarginRight, function(elem, computed) {
        if (computed) {
            return swap(elem, {
                display: "inline-block"
            }, curCSS, [elem, "marginRight"])
        }
    });
    jQuery.each({
        margin: "",
        padding: "",
        border: "Width"
    }, function(prefix, suffix) {
        jQuery.cssHooks[prefix + suffix] = {
            expand: function(value) {
                var i = 0
                    , expanded = {}
                    , parts = typeof value === "string" ? value.split(" ") : [value];
                for (; i < 4; i++) {
                    expanded[prefix + cssExpand[i] + suffix] = parts[i] || parts[i - 2] || parts[0]
                }
                return expanded
            }
        };
        if (!rmargin.test(prefix)) {
            jQuery.cssHooks[prefix + suffix].set = setPositiveNumber
        }
    });
    jQuery.fn.extend({
        css: function(name, value) {
            return access(this, function(elem, name, value) {
                var styles, len, map = {}, i = 0;
                if (jQuery.isArray(name)) {
                    styles = getStyles(elem);
                    len = name.length;
                    for (; i < len; i++) {
                        map[name[i]] = jQuery.css(elem, name[i], false, styles)
                    }
                    return map
                }
                return value !== undefined ? jQuery.style(elem, name, value) : jQuery.css(elem, name)
            }, name, value, arguments.length > 1)
        },
        show: function() {
            return showHide(this, true)
        },
        hide: function() {
            return showHide(this)
        },
        toggle: function(state) {
            if (typeof state === "boolean") {
                return state ? this.show() : this.hide()
            }
            return this.each(function() {
                if (isHidden(this)) {
                    jQuery(this).show()
                } else {
                    jQuery(this).hide()
                }
            })
        }
    });
    function Tween(elem, options, prop, end, easing) {
        return new Tween.prototype.init(elem,options,prop,end,easing)
    }
    jQuery.Tween = Tween;
    Tween.prototype = {
        constructor: Tween,
        init: function(elem, options, prop, end, easing, unit) {
            this.elem = elem;
            this.prop = prop;
            this.easing = easing || jQuery.easing._default;
            this.options = options;
            this.start = this.now = this.cur();
            this.end = end;
            this.unit = unit || (jQuery.cssNumber[prop] ? "" : "px")
        },
        cur: function() {
            var hooks = Tween.propHooks[this.prop];
            return hooks && hooks.get ? hooks.get(this) : Tween.propHooks._default.get(this)
        },
        run: function(percent) {
            var eased, hooks = Tween.propHooks[this.prop];
            if (this.options.duration) {
                this.pos = eased = jQuery.easing[this.easing](percent, this.options.duration * percent, 0, 1, this.options.duration)
            } else {
                this.pos = eased = percent
            }
            this.now = (this.end - this.start) * eased + this.start;
            if (this.options.step) {
                this.options.step.call(this.elem, this.now, this)
            }
            if (hooks && hooks.set) {
                hooks.set(this)
            } else {
                Tween.propHooks._default.set(this)
            }
            return this
        }
    };
    Tween.prototype.init.prototype = Tween.prototype;
    Tween.propHooks = {
        _default: {
            get: function(tween) {
                var result;
                if (tween.elem.nodeType !== 1 || tween.elem[tween.prop] != null && tween.elem.style[tween.prop] == null) {
                    return tween.elem[tween.prop]
                }
                result = jQuery.css(tween.elem, tween.prop, "");
                return !result || result === "auto" ? 0 : result
            },
            set: function(tween) {
                if (jQuery.fx.step[tween.prop]) {
                    jQuery.fx.step[tween.prop](tween)
                } else if (tween.elem.nodeType === 1 && (tween.elem.style[jQuery.cssProps[tween.prop]] != null || jQuery.cssHooks[tween.prop])) {
                    jQuery.style(tween.elem, tween.prop, tween.now + tween.unit)
                } else {
                    tween.elem[tween.prop] = tween.now
                }
            }
        }
    };
    Tween.propHooks.scrollTop = Tween.propHooks.scrollLeft = {
        set: function(tween) {
            if (tween.elem.nodeType && tween.elem.parentNode) {
                tween.elem[tween.prop] = tween.now
            }
        }
    };
    jQuery.easing = {
        linear: function(p) {
            return p
        },
        swing: function(p) {
            return .5 - Math.cos(p * Math.PI) / 2
        },
        _default: "swing"
    };
    jQuery.fx = Tween.prototype.init;
    jQuery.fx.step = {};
    var fxNow, timerId, rfxtypes = /^(?:toggle|show|hide)$/, rrun = /queueHooks$/;
    function createFxNow() {
        window.setTimeout(function() {
            fxNow = undefined
        });
        return fxNow = jQuery.now()
    }
    function genFx(type, includeWidth) {
        var which, i = 0, attrs = {
            height: type
        };
        includeWidth = includeWidth ? 1 : 0;
        for (; i < 4; i += 2 - includeWidth) {
            which = cssExpand[i];
            attrs["margin" + which] = attrs["padding" + which] = type
        }
        if (includeWidth) {
            attrs.opacity = attrs.width = type
        }
        return attrs
    }
    function createTween(value, prop, animation) {
        var tween, collection = (Animation.tweeners[prop] || []).concat(Animation.tweeners["*"]), index = 0, length = collection.length;
        for (; index < length; index++) {
            if (tween = collection[index].call(animation, prop, value)) {
                return tween
            }
        }
    }
    function defaultPrefilter(elem, props, opts) {
        var prop, value, toggle, tween, hooks, oldfire, display, checkDisplay, anim = this, orig = {}, style = elem.style, hidden = elem.nodeType && isHidden(elem), dataShow = dataPriv.get(elem, "fxshow");
        if (!opts.queue) {
            hooks = jQuery._queueHooks(elem, "fx");
            if (hooks.unqueued == null) {
                hooks.unqueued = 0;
                oldfire = hooks.empty.fire;
                hooks.empty.fire = function() {
                    if (!hooks.unqueued) {
                        oldfire()
                    }
                }
            }
            hooks.unqueued++;
            anim.always(function() {
                anim.always(function() {
                    hooks.unqueued--;
                    if (!jQuery.queue(elem, "fx").length) {
                        hooks.empty.fire()
                    }
                })
            })
        }
        if (elem.nodeType === 1 && ("height"in props || "width"in props)) {
            opts.overflow = [style.overflow, style.overflowX, style.overflowY];
            display = jQuery.css(elem, "display");
            checkDisplay = display === "none" ? dataPriv.get(elem, "olddisplay") || defaultDisplay(elem.nodeName) : display;
            if (checkDisplay === "inline" && jQuery.css(elem, "float") === "none") {
                style.display = "inline-block"
            }
        }
        if (opts.overflow) {
            style.overflow = "hidden";
            anim.always(function() {
                style.overflow = opts.overflow[0];
                style.overflowX = opts.overflow[1];
                style.overflowY = opts.overflow[2]
            })
        }
        for (prop in props) {
            value = props[prop];
            if (rfxtypes.exec(value)) {
                delete props[prop];
                toggle = toggle || value === "toggle";
                if (value === (hidden ? "hide" : "show")) {
                    if (value === "show" && dataShow && dataShow[prop] !== undefined) {
                        hidden = true
                    } else {
                        continue
                    }
                }
                orig[prop] = dataShow && dataShow[prop] || jQuery.style(elem, prop)
            } else {
                display = undefined
            }
        }
        if (!jQuery.isEmptyObject(orig)) {
            if (dataShow) {
                if ("hidden"in dataShow) {
                    hidden = dataShow.hidden
                }
            } else {
                dataShow = dataPriv.access(elem, "fxshow", {})
            }
            if (toggle) {
                dataShow.hidden = !hidden
            }
            if (hidden) {
                jQuery(elem).show()
            } else {
                anim.done(function() {
                    jQuery(elem).hide()
                })
            }
            anim.done(function() {
                var prop;
                dataPriv.remove(elem, "fxshow");
                for (prop in orig) {
                    jQuery.style(elem, prop, orig[prop])
                }
            });
            for (prop in orig) {
                tween = createTween(hidden ? dataShow[prop] : 0, prop, anim);
                if (!(prop in dataShow)) {
                    dataShow[prop] = tween.start;
                    if (hidden) {
                        tween.end = tween.start;
                        tween.start = prop === "width" || prop === "height" ? 1 : 0
                    }
                }
            }
        } else if ((display === "none" ? defaultDisplay(elem.nodeName) : display) === "inline") {
            style.display = display
        }
    }
    function propFilter(props, specialEasing) {
        var index, name, easing, value, hooks;
        for (index in props) {
            name = jQuery.camelCase(index);
            easing = specialEasing[name];
            value = props[index];
            if (jQuery.isArray(value)) {
                easing = value[1];
                value = props[index] = value[0]
            }
            if (index !== name) {
                props[name] = value;
                delete props[index]
            }
            hooks = jQuery.cssHooks[name];
            if (hooks && "expand"in hooks) {
                value = hooks.expand(value);
                delete props[name];
                for (index in value) {
                    if (!(index in props)) {
                        props[index] = value[index];
                        specialEasing[index] = easing
                    }
                }
            } else {
                specialEasing[name] = easing
            }
        }
    }
    function Animation(elem, properties, options) {
        var result, stopped, index = 0, length = Animation.prefilters.length, deferred = jQuery.Deferred().always(function() {
            delete tick.elem
        }), tick = function() {
            if (stopped) {
                return false
            }
            var currentTime = fxNow || createFxNow()
                , remaining = Math.max(0, animation.startTime + animation.duration - currentTime)
                , temp = remaining / animation.duration || 0
                , percent = 1 - temp
                , index = 0
                , length = animation.tweens.length;
            for (; index < length; index++) {
                animation.tweens[index].run(percent)
            }
            deferred.notifyWith(elem, [animation, percent, remaining]);
            if (percent < 1 && length) {
                return remaining
            } else {
                deferred.resolveWith(elem, [animation]);
                return false
            }
        }, animation = deferred.promise({
            elem: elem,
            props: jQuery.extend({}, properties),
            opts: jQuery.extend(true, {
                specialEasing: {},
                easing: jQuery.easing._default
            }, options),
            originalProperties: properties,
            originalOptions: options,
            startTime: fxNow || createFxNow(),
            duration: options.duration,
            tweens: [],
            createTween: function(prop, end) {
                var tween = jQuery.Tween(elem, animation.opts, prop, end, animation.opts.specialEasing[prop] || animation.opts.easing);
                animation.tweens.push(tween);
                return tween
            },
            stop: function(gotoEnd) {
                var index = 0
                    , length = gotoEnd ? animation.tweens.length : 0;
                if (stopped) {
                    return this
                }
                stopped = true;
                for (; index < length; index++) {
                    animation.tweens[index].run(1)
                }
                if (gotoEnd) {
                    deferred.notifyWith(elem, [animation, 1, 0]);
                    deferred.resolveWith(elem, [animation, gotoEnd])
                } else {
                    deferred.rejectWith(elem, [animation, gotoEnd])
                }
                return this
            }
        }), props = animation.props;
        propFilter(props, animation.opts.specialEasing);
        for (; index < length; index++) {
            result = Animation.prefilters[index].call(animation, elem, props, animation.opts);
            if (result) {
                if (jQuery.isFunction(result.stop)) {
                    jQuery._queueHooks(animation.elem, animation.opts.queue).stop = jQuery.proxy(result.stop, result)
                }
                return result
            }
        }
        jQuery.map(props, createTween, animation);
        if (jQuery.isFunction(animation.opts.start)) {
            animation.opts.start.call(elem, animation)
        }
        jQuery.fx.timer(jQuery.extend(tick, {
            elem: elem,
            anim: animation,
            queue: animation.opts.queue
        }));
        return animation.progress(animation.opts.progress).done(animation.opts.done, animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)
    }
    jQuery.Animation = jQuery.extend(Animation, {
        tweeners: {
            "*": [function(prop, value) {
                var tween = this.createTween(prop, value);
                adjustCSS(tween.elem, prop, rcssNum.exec(value), tween);
                return tween
            }
            ]
        },
        tweener: function(props, callback) {
            if (jQuery.isFunction(props)) {
                callback = props;
                props = ["*"]
            } else {
                props = props.match(rnotwhite)
            }
            var prop, index = 0, length = props.length;
            for (; index < length; index++) {
                prop = props[index];
                Animation.tweeners[prop] = Animation.tweeners[prop] || [];
                Animation.tweeners[prop].unshift(callback)
            }
        },
        prefilters: [defaultPrefilter],
        prefilter: function(callback, prepend) {
            if (prepend) {
                Animation.prefilters.unshift(callback)
            } else {
                Animation.prefilters.push(callback)
            }
        }
    });
    jQuery.speed = function(speed, easing, fn) {
        var opt = speed && typeof speed === "object" ? jQuery.extend({}, speed) : {
            complete: fn || !fn && easing || jQuery.isFunction(speed) && speed,
            duration: speed,
            easing: fn && easing || easing && !jQuery.isFunction(easing) && easing
        };
        opt.duration = jQuery.fx.off ? 0 : typeof opt.duration === "number" ? opt.duration : opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[opt.duration] : jQuery.fx.speeds._default;
        if (opt.queue == null || opt.queue === true) {
            opt.queue = "fx"
        }
        opt.old = opt.complete;
        opt.complete = function() {
            if (jQuery.isFunction(opt.old)) {
                opt.old.call(this)
            }
            if (opt.queue) {
                jQuery.dequeue(this, opt.queue)
            }
        }
        ;
        return opt
    }
    ;
    jQuery.fn.extend({
        fadeTo: function(speed, to, easing, callback) {
            return this.filter(isHidden).css("opacity", 0).show().end().animate({
                opacity: to
            }, speed, easing, callback)
        },
        animate: function(prop, speed, easing, callback) {
            var empty = jQuery.isEmptyObject(prop)
                , optall = jQuery.speed(speed, easing, callback)
                , doAnimation = function() {
                var anim = Animation(this, jQuery.extend({}, prop), optall);
                if (empty || dataPriv.get(this, "finish")) {
                    anim.stop(true)
                }
            };
            doAnimation.finish = doAnimation;
            return empty || optall.queue === false ? this.each(doAnimation) : this.queue(optall.queue, doAnimation)
        },
        stop: function(type, clearQueue, gotoEnd) {
            var stopQueue = function(hooks) {
                var stop = hooks.stop;
                delete hooks.stop;
                stop(gotoEnd)
            };
            if (typeof type !== "string") {
                gotoEnd = clearQueue;
                clearQueue = type;
                type = undefined
            }
            if (clearQueue && type !== false) {
                this.queue(type || "fx", [])
            }
            return this.each(function() {
                var dequeue = true
                    , index = type != null && type + "queueHooks"
                    , timers = jQuery.timers
                    , data = dataPriv.get(this);
                if (index) {
                    if (data[index] && data[index].stop) {
                        stopQueue(data[index])
                    }
                } else {
                    for (index in data) {
                        if (data[index] && data[index].stop && rrun.test(index)) {
                            stopQueue(data[index])
                        }
                    }
                }
                for (index = timers.length; index--; ) {
                    if (timers[index].elem === this && (type == null || timers[index].queue === type)) {
                        timers[index].anim.stop(gotoEnd);
                        dequeue = false;
                        timers.splice(index, 1)
                    }
                }
                if (dequeue || !gotoEnd) {
                    jQuery.dequeue(this, type)
                }
            })
        },
        finish: function(type) {
            if (type !== false) {
                type = type || "fx"
            }
            return this.each(function() {
                var index, data = dataPriv.get(this), queue = data[type + "queue"], hooks = data[type + "queueHooks"], timers = jQuery.timers, length = queue ? queue.length : 0;
                data.finish = true;
                jQuery.queue(this, type, []);
                if (hooks && hooks.stop) {
                    hooks.stop.call(this, true)
                }
                for (index = timers.length; index--; ) {
                    if (timers[index].elem === this && timers[index].queue === type) {
                        timers[index].anim.stop(true);
                        timers.splice(index, 1)
                    }
                }
                for (index = 0; index < length; index++) {
                    if (queue[index] && queue[index].finish) {
                        queue[index].finish.call(this)
                    }
                }
                delete data.finish
            })
        }
    });
    jQuery.each(["toggle", "show", "hide"], function(i, name) {
        var cssFn = jQuery.fn[name];
        jQuery.fn[name] = function(speed, easing, callback) {
            return speed == null || typeof speed === "boolean" ? cssFn.apply(this, arguments) : this.animate(genFx(name, true), speed, easing, callback)
        }
    });
    jQuery.each({
        slideDown: genFx("show"),
        slideUp: genFx("hide"),
        slideToggle: genFx("toggle"),
        fadeIn: {
            opacity: "show"
        },
        fadeOut: {
            opacity: "hide"
        },
        fadeToggle: {
            opacity: "toggle"
        }
    }, function(name, props) {
        jQuery.fn[name] = function(speed, easing, callback) {
            return this.animate(props, speed, easing, callback)
        }
    });
    jQuery.timers = [];
    jQuery.fx.tick = function() {
        var timer, i = 0, timers = jQuery.timers;
        fxNow = jQuery.now();
        for (; i < timers.length; i++) {
            timer = timers[i];
            if (!timer() && timers[i] === timer) {
                timers.splice(i--, 1)
            }
        }
        if (!timers.length) {
            jQuery.fx.stop()
        }
        fxNow = undefined
    }
    ;
    jQuery.fx.timer = function(timer) {
        jQuery.timers.push(timer);
        if (timer()) {
            jQuery.fx.start()
        } else {
            jQuery.timers.pop()
        }
    }
    ;
    jQuery.fx.interval = 13;
    jQuery.fx.start = function() {
        if (!timerId) {
            timerId = window.setInterval(jQuery.fx.tick, jQuery.fx.interval)
        }
    }
    ;
    jQuery.fx.stop = function() {
        window.clearInterval(timerId);
        timerId = null
    }
    ;
    jQuery.fx.speeds = {
        slow: 600,
        fast: 200,
        _default: 400
    };
    jQuery.fn.delay = function(time, type) {
        time = jQuery.fx ? jQuery.fx.speeds[time] || time : time;
        type = type || "fx";
        return this.queue(type, function(next, hooks) {
            var timeout = window.setTimeout(next, time);
            hooks.stop = function() {
                window.clearTimeout(timeout)
            }
        })
    }
    ;
    (function() {
            var input = document.createElement("input")
                , select = document.createElement("select")
                , opt = select.appendChild(document.createElement("option"));
            input.type = "checkbox";
            support.checkOn = input.value !== "";
            support.optSelected = opt.selected;
            select.disabled = true;
            support.optDisabled = !opt.disabled;
            input = document.createElement("input");
            input.value = "t";
            input.type = "radio";
            support.radioValue = input.value === "t"
        }
    )();
    var boolHook, attrHandle = jQuery.expr.attrHandle;
    jQuery.fn.extend({
        attr: function(name, value) {
            return access(this, jQuery.attr, name, value, arguments.length > 1)
        },
        removeAttr: function(name) {
            return this.each(function() {
                jQuery.removeAttr(this, name)
            })
        }
    });
    jQuery.extend({
        attr: function(elem, name, value) {
            var ret, hooks, nType = elem.nodeType;
            if (nType === 3 || nType === 8 || nType === 2) {
                return
            }
            if (typeof elem.getAttribute === "undefined") {
                return jQuery.prop(elem, name, value)
            }
            if (nType !== 1 || !jQuery.isXMLDoc(elem)) {
                name = name.toLowerCase();
                hooks = jQuery.attrHooks[name] || (jQuery.expr.match.bool.test(name) ? boolHook : undefined)
            }
            if (value !== undefined) {
                if (value === null) {
                    jQuery.removeAttr(elem, name);
                    return
                }
                if (hooks && "set"in hooks && (ret = hooks.set(elem, value, name)) !== undefined) {
                    return ret
                }
                elem.setAttribute(name, value + "");
                return value
            }
            if (hooks && "get"in hooks && (ret = hooks.get(elem, name)) !== null) {
                return ret
            }
            ret = jQuery.find.attr(elem, name);
            return ret == null ? undefined : ret
        },
        attrHooks: {
            type: {
                set: function(elem, value) {
                    if (!support.radioValue && value === "radio" && jQuery.nodeName(elem, "input")) {
                        var val = elem.value;
                        elem.setAttribute("type", value);
                        if (val) {
                            elem.value = val
                        }
                        return value
                    }
                }
            }
        },
        removeAttr: function(elem, value) {
            var name, propName, i = 0, attrNames = value && value.match(rnotwhite);
            if (attrNames && elem.nodeType === 1) {
                while (name = attrNames[i++]) {
                    propName = jQuery.propFix[name] || name;
                    if (jQuery.expr.match.bool.test(name)) {
                        elem[propName] = false
                    }
                    elem.removeAttribute(name)
                }
            }
        }
    });
    boolHook = {
        set: function(elem, value, name) {
            if (value === false) {
                jQuery.removeAttr(elem, name)
            } else {
                elem.setAttribute(name, name)
            }
            return name
        }
    };
    jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g), function(i, name) {
        var getter = attrHandle[name] || jQuery.find.attr;
        attrHandle[name] = function(elem, name, isXML) {
            var ret, handle;
            if (!isXML) {
                handle = attrHandle[name];
                attrHandle[name] = ret;
                ret = getter(elem, name, isXML) != null ? name.toLowerCase() : null;
                attrHandle[name] = handle
            }
            return ret
        }
    });
    var rfocusable = /^(?:input|select|textarea|button)$/i
        , rclickable = /^(?:a|area)$/i;
    jQuery.fn.extend({
        prop: function(name, value) {
            return access(this, jQuery.prop, name, value, arguments.length > 1)
        },
        removeProp: function(name) {
            return this.each(function() {
                delete this[jQuery.propFix[name] || name]
            })
        }
    });
    jQuery.extend({
        prop: function(elem, name, value) {
            var ret, hooks, nType = elem.nodeType;
            if (nType === 3 || nType === 8 || nType === 2) {
                return
            }
            if (nType !== 1 || !jQuery.isXMLDoc(elem)) {
                name = jQuery.propFix[name] || name;
                hooks = jQuery.propHooks[name]
            }
            if (value !== undefined) {
                if (hooks && "set"in hooks && (ret = hooks.set(elem, value, name)) !== undefined) {
                    return ret
                }
                return elem[name] = value
            }
            if (hooks && "get"in hooks && (ret = hooks.get(elem, name)) !== null) {
                return ret
            }
            return elem[name]
        },
        propHooks: {
            tabIndex: {
                get: function(elem) {
                    var tabindex = jQuery.find.attr(elem, "tabindex");
                    return tabindex ? parseInt(tabindex, 10) : rfocusable.test(elem.nodeName) || rclickable.test(elem.nodeName) && elem.href ? 0 : -1
                }
            }
        },
        propFix: {
            for: "htmlFor",
            class: "className"
        }
    });
    if (!support.optSelected) {
        jQuery.propHooks.selected = {
            get: function(elem) {
                var parent = elem.parentNode;
                if (parent && parent.parentNode) {
                    parent.parentNode.selectedIndex
                }
                return null
            },
            set: function(elem) {
                var parent = elem.parentNode;
                if (parent) {
                    parent.selectedIndex;
                    if (parent.parentNode) {
                        parent.parentNode.selectedIndex
                    }
                }
            }
        }
    }
    jQuery.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function() {
        jQuery.propFix[this.toLowerCase()] = this
    });
    var rclass = /[\t\r\n\f]/g;
    function getClass(elem) {
        return elem.getAttribute && elem.getAttribute("class") || ""
    }
    jQuery.fn.extend({
        addClass: function(value) {
            var classes, elem, cur, curValue, clazz, j, finalValue, i = 0;
            if (jQuery.isFunction(value)) {
                return this.each(function(j) {
                    jQuery(this).addClass(value.call(this, j, getClass(this)))
                })
            }
            if (typeof value === "string" && value) {
                classes = value.match(rnotwhite) || [];
                while (elem = this[i++]) {
                    curValue = getClass(elem);
                    cur = elem.nodeType === 1 && (" " + curValue + " ").replace(rclass, " ");
                    if (cur) {
                        j = 0;
                        while (clazz = classes[j++]) {
                            if (cur.indexOf(" " + clazz + " ") < 0) {
                                cur += clazz + " "
                            }
                        }
                        finalValue = jQuery.trim(cur);
                        if (curValue !== finalValue) {
                            elem.setAttribute("class", finalValue)
                        }
                    }
                }
            }
            return this
        },
        removeClass: function(value) {
            var classes, elem, cur, curValue, clazz, j, finalValue, i = 0;
            if (jQuery.isFunction(value)) {
                return this.each(function(j) {
                    jQuery(this).removeClass(value.call(this, j, getClass(this)))
                })
            }
            if (!arguments.length) {
                return this.attr("class", "")
            }
            if (typeof value === "string" && value) {
                classes = value.match(rnotwhite) || [];
                while (elem = this[i++]) {
                    curValue = getClass(elem);
                    cur = elem.nodeType === 1 && (" " + curValue + " ").replace(rclass, " ");
                    if (cur) {
                        j = 0;
                        while (clazz = classes[j++]) {
                            while (cur.indexOf(" " + clazz + " ") > -1) {
                                cur = cur.replace(" " + clazz + " ", " ")
                            }
                        }
                        finalValue = jQuery.trim(cur);
                        if (curValue !== finalValue) {
                            elem.setAttribute("class", finalValue)
                        }
                    }
                }
            }
            return this
        },
        toggleClass: function(value, stateVal) {
            var type = typeof value;
            if (typeof stateVal === "boolean" && type === "string") {
                return stateVal ? this.addClass(value) : this.removeClass(value)
            }
            if (jQuery.isFunction(value)) {
                return this.each(function(i) {
                    jQuery(this).toggleClass(value.call(this, i, getClass(this), stateVal), stateVal)
                })
            }
            return this.each(function() {
                var className, i, self, classNames;
                if (type === "string") {
                    i = 0;
                    self = jQuery(this);
                    classNames = value.match(rnotwhite) || [];
                    while (className = classNames[i++]) {
                        if (self.hasClass(className)) {
                            self.removeClass(className)
                        } else {
                            self.addClass(className)
                        }
                    }
                } else if (value === undefined || type === "boolean") {
                    className = getClass(this);
                    if (className) {
                        dataPriv.set(this, "__className__", className)
                    }
                    if (this.setAttribute) {
                        this.setAttribute("class", className || value === false ? "" : dataPriv.get(this, "__className__") || "")
                    }
                }
            })
        },
        hasClass: function(selector) {
            var className, elem, i = 0;
            className = " " + selector + " ";
            while (elem = this[i++]) {
                if (elem.nodeType === 1 && (" " + getClass(elem) + " ").replace(rclass, " ").indexOf(className) > -1) {
                    return true
                }
            }
            return false
        }
    });
    var rreturn = /\r/g
        , rspaces = /[\x20\t\r\n\f]+/g;
    jQuery.fn.extend({
        val: function(value) {
            var hooks, ret, isFunction, elem = this[0];
            if (!arguments.length) {
                if (elem) {
                    hooks = jQuery.valHooks[elem.type] || jQuery.valHooks[elem.nodeName.toLowerCase()];
                    if (hooks && "get"in hooks && (ret = hooks.get(elem, "value")) !== undefined) {
                        return ret
                    }
                    ret = elem.value;
                    return typeof ret === "string" ? ret.replace(rreturn, "") : ret == null ? "" : ret
                }
                return
            }
            isFunction = jQuery.isFunction(value);
            return this.each(function(i) {
                var val;
                if (this.nodeType !== 1) {
                    return
                }
                if (isFunction) {
                    val = value.call(this, i, jQuery(this).val())
                } else {
                    val = value
                }
                if (val == null) {
                    val = ""
                } else if (typeof val === "number") {
                    val += ""
                } else if (jQuery.isArray(val)) {
                    val = jQuery.map(val, function(value) {
                        return value == null ? "" : value + ""
                    })
                }
                hooks = jQuery.valHooks[this.type] || jQuery.valHooks[this.nodeName.toLowerCase()];
                if (!hooks || !("set"in hooks) || hooks.set(this, val, "value") === undefined) {
                    this.value = val
                }
            })
        }
    });
    jQuery.extend({
        valHooks: {
            option: {
                get: function(elem) {
                    var val = jQuery.find.attr(elem, "value");
                    return val != null ? val : jQuery.trim(jQuery.text(elem)).replace(rspaces, " ")
                }
            },
            select: {
                get: function(elem) {
                    var value, option, options = elem.options, index = elem.selectedIndex, one = elem.type === "select-one" || index < 0, values = one ? null : [], max = one ? index + 1 : options.length, i = index < 0 ? max : one ? index : 0;
                    for (; i < max; i++) {
                        option = options[i];
                        if ((option.selected || i === index) && (support.optDisabled ? !option.disabled : option.getAttribute("disabled") === null) && (!option.parentNode.disabled || !jQuery.nodeName(option.parentNode, "optgroup"))) {
                            value = jQuery(option).val();
                            if (one) {
                                return value
                            }
                            values.push(value)
                        }
                    }
                    return values
                },
                set: function(elem, value) {
                    var optionSet, option, options = elem.options, values = jQuery.makeArray(value), i = options.length;
                    while (i--) {
                        option = options[i];
                        if (option.selected = jQuery.inArray(jQuery.valHooks.option.get(option), values) > -1) {
                            optionSet = true
                        }
                    }
                    if (!optionSet) {
                        elem.selectedIndex = -1
                    }
                    return values
                }
            }
        }
    });
    jQuery.each(["radio", "checkbox"], function() {
        jQuery.valHooks[this] = {
            set: function(elem, value) {
                if (jQuery.isArray(value)) {
                    return elem.checked = jQuery.inArray(jQuery(elem).val(), value) > -1
                }
            }
        };
        if (!support.checkOn) {
            jQuery.valHooks[this].get = function(elem) {
                return elem.getAttribute("value") === null ? "on" : elem.value
            }
        }
    });
    var rfocusMorph = /^(?:focusinfocus|focusoutblur)$/;
    jQuery.extend(jQuery.event, {
        trigger: function(event, data, elem, onlyHandlers) {
            var i, cur, tmp, bubbleType, ontype, handle, special, eventPath = [elem || document], type = hasOwn.call(event, "type") ? event.type : event, namespaces = hasOwn.call(event, "namespace") ? event.namespace.split(".") : [];
            cur = tmp = elem = elem || document;
            if (elem.nodeType === 3 || elem.nodeType === 8) {
                return
            }
            if (rfocusMorph.test(type + jQuery.event.triggered)) {
                return
            }
            if (type.indexOf(".") > -1) {
                namespaces = type.split(".");
                type = namespaces.shift();
                namespaces.sort()
            }
            ontype = type.indexOf(":") < 0 && "on" + type;
            event = event[jQuery.expando] ? event : new jQuery.Event(type,typeof event === "object" && event);
            event.isTrigger = onlyHandlers ? 2 : 3;
            event.namespace = namespaces.join(".");
            event.rnamespace = event.namespace ? new RegExp("(^|\\.)" + namespaces.join("\\.(?:.*\\.|)") + "(\\.|$)") : null;
            event.result = undefined;
            if (!event.target) {
                event.target = elem
            }
            data = data == null ? [event] : jQuery.makeArray(data, [event]);
            special = jQuery.event.special[type] || {};
            if (!onlyHandlers && special.trigger && special.trigger.apply(elem, data) === false) {
                return
            }
            if (!onlyHandlers && !special.noBubble && !jQuery.isWindow(elem)) {
                bubbleType = special.delegateType || type;
                if (!rfocusMorph.test(bubbleType + type)) {
                    cur = cur.parentNode
                }
                for (; cur; cur = cur.parentNode) {
                    eventPath.push(cur);
                    tmp = cur
                }
                if (tmp === (elem.ownerDocument || document)) {
                    eventPath.push(tmp.defaultView || tmp.parentWindow || window)
                }
            }
            i = 0;
            while ((cur = eventPath[i++]) && !event.isPropagationStopped()) {
                event.type = i > 1 ? bubbleType : special.bindType || type;
                handle = (dataPriv.get(cur, "events") || {})[event.type] && dataPriv.get(cur, "handle");
                if (handle) {
                    handle.apply(cur, data)
                }
                handle = ontype && cur[ontype];
                if (handle && handle.apply && acceptData(cur)) {
                    event.result = handle.apply(cur, data);
                    if (event.result === false) {
                        event.preventDefault()
                    }
                }
            }
            event.type = type;
            if (!onlyHandlers && !event.isDefaultPrevented()) {
                if ((!special._default || special._default.apply(eventPath.pop(), data) === false) && acceptData(elem)) {
                    if (ontype && jQuery.isFunction(elem[type]) && !jQuery.isWindow(elem)) {
                        tmp = elem[ontype];
                        if (tmp) {
                            elem[ontype] = null
                        }
                        jQuery.event.triggered = type;
                        elem[type]();
                        jQuery.event.triggered = undefined;
                        if (tmp) {
                            elem[ontype] = tmp
                        }
                    }
                }
            }
            return event.result
        },
        simulate: function(type, elem, event) {
            var e = jQuery.extend(new jQuery.Event, event, {
                type: type,
                isSimulated: true
            });
            jQuery.event.trigger(e, null, elem)
        }
    });
    jQuery.fn.extend({
        trigger: function(type, data) {
            return this.each(function() {
                jQuery.event.trigger(type, data, this)
            })
        },
        triggerHandler: function(type, data) {
            var elem = this[0];
            if (elem) {
                return jQuery.event.trigger(type, data, elem, true)
            }
        }
    });
    jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick " + "mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave " + "change select submit keydown keypress keyup error contextmenu").split(" "), function(i, name) {
        jQuery.fn[name] = function(data, fn) {
            return arguments.length > 0 ? this.on(name, null, data, fn) : this.trigger(name)
        }
    });
    jQuery.fn.extend({
        hover: function(fnOver, fnOut) {
            return this.mouseenter(fnOver).mouseleave(fnOut || fnOver)
        }
    });
    support.focusin = "onfocusin"in window;
    if (!support.focusin) {
        jQuery.each({
            focus: "focusin",
            blur: "focusout"
        }, function(orig, fix) {
            var handler = function(event) {
                jQuery.event.simulate(fix, event.target, jQuery.event.fix(event))
            };
            jQuery.event.special[fix] = {
                setup: function() {
                    var doc = this.ownerDocument || this
                        , attaches = dataPriv.access(doc, fix);
                    if (!attaches) {
                        doc.addEventListener(orig, handler, true)
                    }
                    dataPriv.access(doc, fix, (attaches || 0) + 1)
                },
                teardown: function() {
                    var doc = this.ownerDocument || this
                        , attaches = dataPriv.access(doc, fix) - 1;
                    if (!attaches) {
                        doc.removeEventListener(orig, handler, true);
                        dataPriv.remove(doc, fix)
                    } else {
                        dataPriv.access(doc, fix, attaches)
                    }
                }
            }
        })
    }
    var location = window.location;
    var nonce = jQuery.now();
    var rquery = /\?/;
    jQuery.parseJSON = function(data) {
        return JSON.parse(data + "")
    }
    ;
    jQuery.parseXML = function(data) {
        var xml;
        if (!data || typeof data !== "string") {
            return null
        }
        try {
            xml = (new window.DOMParser).parseFromString(data, "text/xml")
        } catch (e) {
            xml = undefined
        }
        if (!xml || xml.getElementsByTagName("parsererror").length) {
            jQuery.error("Invalid XML: " + data)
        }
        return xml
    }
    ;
    var rhash = /#.*$/
        , rts = /([?&])_=[^&]*/
        , rheaders = /^(.*?):[ \t]*([^\r\n]*)$/gm
        , rlocalProtocol = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/
        , rnoContent = /^(?:GET|HEAD)$/
        , rprotocol = /^\/\//
        , prefilters = {}
        , transports = {}
        , allTypes = "*/".concat("*")
        , originAnchor = document.createElement("a");
    originAnchor.href = location.href;
    function addToPrefiltersOrTransports(structure) {
        return function(dataTypeExpression, func) {
            if (typeof dataTypeExpression !== "string") {
                func = dataTypeExpression;
                dataTypeExpression = "*"
            }
            var dataType, i = 0, dataTypes = dataTypeExpression.toLowerCase().match(rnotwhite) || [];
            if (jQuery.isFunction(func)) {
                while (dataType = dataTypes[i++]) {
                    if (dataType[0] === "+") {
                        dataType = dataType.slice(1) || "*";
                        (structure[dataType] = structure[dataType] || []).unshift(func)
                    } else {
                        (structure[dataType] = structure[dataType] || []).push(func)
                    }
                }
            }
        }
    }
    function inspectPrefiltersOrTransports(structure, options, originalOptions, jqXHR) {
        var inspected = {}
            , seekingTransport = structure === transports;
        function inspect(dataType) {
            var selected;
            inspected[dataType] = true;
            jQuery.each(structure[dataType] || [], function(_, prefilterOrFactory) {
                var dataTypeOrTransport = prefilterOrFactory(options, originalOptions, jqXHR);
                if (typeof dataTypeOrTransport === "string" && !seekingTransport && !inspected[dataTypeOrTransport]) {
                    options.dataTypes.unshift(dataTypeOrTransport);
                    inspect(dataTypeOrTransport);
                    return false
                } else if (seekingTransport) {
                    return !(selected = dataTypeOrTransport)
                }
            });
            return selected
        }
        return inspect(options.dataTypes[0]) || !inspected["*"] && inspect("*")
    }
    function ajaxExtend(target, src) {
        var key, deep, flatOptions = jQuery.ajaxSettings.flatOptions || {};
        for (key in src) {
            if (src[key] !== undefined) {
                (flatOptions[key] ? target : deep || (deep = {}))[key] = src[key]
            }
        }
        if (deep) {
            jQuery.extend(true, target, deep)
        }
        return target
    }
    function ajaxHandleResponses(s, jqXHR, responses) {
        var ct, type, finalDataType, firstDataType, contents = s.contents, dataTypes = s.dataTypes;
        while (dataTypes[0] === "*") {
            dataTypes.shift();
            if (ct === undefined) {
                ct = s.mimeType || jqXHR.getResponseHeader("Content-Type")
            }
        }
        if (ct) {
            for (type in contents) {
                if (contents[type] && contents[type].test(ct)) {
                    dataTypes.unshift(type);
                    break
                }
            }
        }
        if (dataTypes[0]in responses) {
            finalDataType = dataTypes[0]
        } else {
            for (type in responses) {
                if (!dataTypes[0] || s.converters[type + " " + dataTypes[0]]) {
                    finalDataType = type;
                    break
                }
                if (!firstDataType) {
                    firstDataType = type
                }
            }
            finalDataType = finalDataType || firstDataType
        }
        if (finalDataType) {
            if (finalDataType !== dataTypes[0]) {
                dataTypes.unshift(finalDataType)
            }
            return responses[finalDataType]
        }
    }
    function ajaxConvert(s, response, jqXHR, isSuccess) {
        var conv2, current, conv, tmp, prev, converters = {}, dataTypes = s.dataTypes.slice();
        if (dataTypes[1]) {
            for (conv in s.converters) {
                converters[conv.toLowerCase()] = s.converters[conv]
            }
        }
        current = dataTypes.shift();
        while (current) {
            if (s.responseFields[current]) {
                jqXHR[s.responseFields[current]] = response
            }
            if (!prev && isSuccess && s.dataFilter) {
                response = s.dataFilter(response, s.dataType)
            }
            prev = current;
            current = dataTypes.shift();
            if (current) {
                if (current === "*") {
                    current = prev
                } else if (prev !== "*" && prev !== current) {
                    conv = converters[prev + " " + current] || converters["* " + current];
                    if (!conv) {
                        for (conv2 in converters) {
                            tmp = conv2.split(" ");
                            if (tmp[1] === current) {
                                conv = converters[prev + " " + tmp[0]] || converters["* " + tmp[0]];
                                if (conv) {
                                    if (conv === true) {
                                        conv = converters[conv2]
                                    } else if (converters[conv2] !== true) {
                                        current = tmp[0];
                                        dataTypes.unshift(tmp[1])
                                    }
                                    break
                                }
                            }
                        }
                    }
                    if (conv !== true) {
                        if (conv && s.throws) {
                            response = conv(response)
                        } else {
                            try {
                                response = conv(response)
                            } catch (e) {
                                return {
                                    state: "parsererror",
                                    error: conv ? e : "No conversion from " + prev + " to " + current
                                }
                            }
                        }
                    }
                }
            }
        }
        return {
            state: "success",
            data: response
        }
    }
    jQuery.extend({
        active: 0,
        lastModified: {},
        etag: {},
        ajaxSettings: {
            url: location.href,
            type: "GET",
            isLocal: rlocalProtocol.test(location.protocol),
            global: true,
            processData: true,
            async: true,
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            accepts: {
                "*": allTypes,
                text: "text/plain",
                html: "text/html",
                xml: "application/xml, text/xml",
                json: "application/json, text/javascript"
            },
            contents: {
                xml: /\bxml\b/,
                html: /\bhtml/,
                json: /\bjson\b/
            },
            responseFields: {
                xml: "responseXML",
                text: "responseText",
                json: "responseJSON"
            },
            converters: {
                "* text": String,
                "text html": true,
                "text json": jQuery.parseJSON,
                "text xml": jQuery.parseXML
            },
            flatOptions: {
                url: true,
                context: true
            }
        },
        ajaxSetup: function(target, settings) {
            return settings ? ajaxExtend(ajaxExtend(target, jQuery.ajaxSettings), settings) : ajaxExtend(jQuery.ajaxSettings, target)
        },
        ajaxPrefilter: addToPrefiltersOrTransports(prefilters),
        ajaxTransport: addToPrefiltersOrTransports(transports),
        ajax: function(url, options) {
            if (typeof url === "object") {
                options = url;
                url = undefined
            }
            options = options || {};
            var transport, cacheURL, responseHeadersString, responseHeaders, timeoutTimer, urlAnchor, fireGlobals, i, s = jQuery.ajaxSetup({}, options), callbackContext = s.context || s, globalEventContext = s.context && (callbackContext.nodeType || callbackContext.jquery) ? jQuery(callbackContext) : jQuery.event, deferred = jQuery.Deferred(), completeDeferred = jQuery.Callbacks("once memory"), statusCode = s.statusCode || {}, requestHeaders = {}, requestHeadersNames = {}, state = 0, strAbort = "canceled", jqXHR = {
                readyState: 0,
                getResponseHeader: function(key) {
                    var match;
                    if (state === 2) {
                        if (!responseHeaders) {
                            responseHeaders = {};
                            while (match = rheaders.exec(responseHeadersString)) {
                                responseHeaders[match[1].toLowerCase()] = match[2]
                            }
                        }
                        match = responseHeaders[key.toLowerCase()]
                    }
                    return match == null ? null : match
                },
                getAllResponseHeaders: function() {
                    return state === 2 ? responseHeadersString : null
                },
                setRequestHeader: function(name, value) {
                    var lname = name.toLowerCase();
                    if (!state) {
                        name = requestHeadersNames[lname] = requestHeadersNames[lname] || name;
                        requestHeaders[name] = value
                    }
                    return this
                },
                overrideMimeType: function(type) {
                    if (!state) {
                        s.mimeType = type
                    }
                    return this
                },
                statusCode: function(map) {
                    var code;
                    if (map) {
                        if (state < 2) {
                            for (code in map) {
                                statusCode[code] = [statusCode[code], map[code]]
                            }
                        } else {
                            jqXHR.always(map[jqXHR.status])
                        }
                    }
                    return this
                },
                abort: function(statusText) {
                    var finalText = statusText || strAbort;
                    if (transport) {
                        transport.abort(finalText)
                    }
                    done(0, finalText);
                    return this
                }
            };
            deferred.promise(jqXHR).complete = completeDeferred.add;
            jqXHR.success = jqXHR.done;
            jqXHR.error = jqXHR.fail;
            s.url = ((url || s.url || location.href) + "").replace(rhash, "").replace(rprotocol, location.protocol + "//");
            s.type = options.method || options.type || s.method || s.type;
            s.dataTypes = jQuery.trim(s.dataType || "*").toLowerCase().match(rnotwhite) || [""];
            if (s.crossDomain == null) {
                urlAnchor = document.createElement("a");
                try {
                    urlAnchor.href = s.url;
                    urlAnchor.href = urlAnchor.href;
                    s.crossDomain = originAnchor.protocol + "//" + originAnchor.host !== urlAnchor.protocol + "//" + urlAnchor.host
                } catch (e) {
                    s.crossDomain = true
                }
            }
            if (s.data && s.processData && typeof s.data !== "string") {
                s.data = jQuery.param(s.data, s.traditional)
            }
            inspectPrefiltersOrTransports(prefilters, s, options, jqXHR);
            if (state === 2) {
                return jqXHR
            }
            fireGlobals = jQuery.event && s.global;
            if (fireGlobals && jQuery.active++ === 0) {
                jQuery.event.trigger("ajaxStart")
            }
            s.type = s.type.toUpperCase();
            s.hasContent = !rnoContent.test(s.type);
            cacheURL = s.url;
            if (!s.hasContent) {
                if (s.data) {
                    cacheURL = s.url += (rquery.test(cacheURL) ? "&" : "?") + s.data;
                    delete s.data
                }
                if (s.cache === false) {
                    s.url = rts.test(cacheURL) ? cacheURL.replace(rts, "$1_=" + nonce++) : cacheURL + (rquery.test(cacheURL) ? "&" : "?") + "_=" + nonce++
                }
            }
            if (s.ifModified) {
                if (jQuery.lastModified[cacheURL]) {
                    jqXHR.setRequestHeader("If-Modified-Since", jQuery.lastModified[cacheURL])
                }
                if (jQuery.etag[cacheURL]) {
                    jqXHR.setRequestHeader("If-None-Match", jQuery.etag[cacheURL])
                }
            }
            if (s.data && s.hasContent && s.contentType !== false || options.contentType) {
                jqXHR.setRequestHeader("Content-Type", s.contentType)
            }
            jqXHR.setRequestHeader("Accept", s.dataTypes[0] && s.accepts[s.dataTypes[0]] ? s.accepts[s.dataTypes[0]] + (s.dataTypes[0] !== "*" ? ", " + allTypes + "; q=0.01" : "") : s.accepts["*"]);
            for (i in s.headers) {
                jqXHR.setRequestHeader(i, s.headers[i])
            }
            if (s.beforeSend && (s.beforeSend.call(callbackContext, jqXHR, s) === false || state === 2)) {
                return jqXHR.abort()
            }
            strAbort = "abort";
            for (i in {
                success: 1,
                error: 1,
                complete: 1
            }) {
                jqXHR[i](s[i])
            }
            transport = inspectPrefiltersOrTransports(transports, s, options, jqXHR);
            if (!transport) {
                done(-1, "No Transport")
            } else {
                jqXHR.readyState = 1;
                if (fireGlobals) {
                    globalEventContext.trigger("ajaxSend", [jqXHR, s])
                }
                if (state === 2) {
                    return jqXHR
                }
                if (s.async && s.timeout > 0) {
                    timeoutTimer = window.setTimeout(function() {
                        jqXHR.abort("timeout")
                    }, s.timeout)
                }
                try {
                    state = 1;
                    transport.send(requestHeaders, done)
                } catch (e) {
                    if (state < 2) {
                        done(-1, e)
                    } else {
                        throw e
                    }
                }
            }
            function done(status, nativeStatusText, responses, headers) {
                var isSuccess, success, error, response, modified, statusText = nativeStatusText;
                if (state === 2) {
                    return
                }
                state = 2;
                if (timeoutTimer) {
                    window.clearTimeout(timeoutTimer)
                }
                transport = undefined;
                responseHeadersString = headers || "";
                jqXHR.readyState = status > 0 ? 4 : 0;
                isSuccess = status >= 200 && status < 300 || status === 304;
                if (responses) {
                    response = ajaxHandleResponses(s, jqXHR, responses)
                }
                response = ajaxConvert(s, response, jqXHR, isSuccess);
                if (isSuccess) {
                    if (s.ifModified) {
                        modified = jqXHR.getResponseHeader("Last-Modified");
                        if (modified) {
                            jQuery.lastModified[cacheURL] = modified
                        }
                        modified = jqXHR.getResponseHeader("etag");
                        if (modified) {
                            jQuery.etag[cacheURL] = modified
                        }
                    }
                    if (status === 204 || s.type === "HEAD") {
                        statusText = "nocontent"
                    } else if (status === 304) {
                        statusText = "notmodified"
                    } else {
                        statusText = response.state;
                        success = response.data;
                        error = response.error;
                        isSuccess = !error
                    }
                } else {
                    error = statusText;
                    if (status || !statusText) {
                        statusText = "error";
                        if (status < 0) {
                            status = 0
                        }
                    }
                }
                jqXHR.status = status;
                jqXHR.statusText = (nativeStatusText || statusText) + "";
                if (isSuccess) {
                    deferred.resolveWith(callbackContext, [success, statusText, jqXHR])
                } else {
                    deferred.rejectWith(callbackContext, [jqXHR, statusText, error])
                }
                jqXHR.statusCode(statusCode);
                statusCode = undefined;
                if (fireGlobals) {
                    globalEventContext.trigger(isSuccess ? "ajaxSuccess" : "ajaxError", [jqXHR, s, isSuccess ? success : error])
                }
                completeDeferred.fireWith(callbackContext, [jqXHR, statusText]);
                if (fireGlobals) {
                    globalEventContext.trigger("ajaxComplete", [jqXHR, s]);
                    if (!--jQuery.active) {
                        jQuery.event.trigger("ajaxStop")
                    }
                }
            }
            return jqXHR
        },
        getJSON: function(url, data, callback) {
            return jQuery.get(url, data, callback, "json")
        },
        getScript: function(url, callback) {
            return jQuery.get(url, undefined, callback, "script")
        }
    });
    jQuery.each(["get", "post"], function(i, method) {
        jQuery[method] = function(url, data, callback, type) {
            if (jQuery.isFunction(data)) {
                type = type || callback;
                callback = data;
                data = undefined
            }
            return jQuery.ajax(jQuery.extend({
                url: url,
                type: method,
                dataType: type,
                data: data,
                success: callback
            }, jQuery.isPlainObject(url) && url))
        }
    });
    jQuery._evalUrl = function(url) {
        return jQuery.ajax({
            url: url,
            type: "GET",
            dataType: "script",
            async: false,
            global: false,
            throws: true
        })
    }
    ;
    jQuery.fn.extend({
        wrapAll: function(html) {
            var wrap;
            if (jQuery.isFunction(html)) {
                return this.each(function(i) {
                    jQuery(this).wrapAll(html.call(this, i))
                })
            }
            if (this[0]) {
                wrap = jQuery(html, this[0].ownerDocument).eq(0).clone(true);
                if (this[0].parentNode) {
                    wrap.insertBefore(this[0])
                }
                wrap.map(function() {
                    var elem = this;
                    while (elem.firstElementChild) {
                        elem = elem.firstElementChild
                    }
                    return elem
                }).append(this)
            }
            return this
        },
        wrapInner: function(html) {
            if (jQuery.isFunction(html)) {
                return this.each(function(i) {
                    jQuery(this).wrapInner(html.call(this, i))
                })
            }
            return this.each(function() {
                var self = jQuery(this)
                    , contents = self.contents();
                if (contents.length) {
                    contents.wrapAll(html)
                } else {
                    self.append(html)
                }
            })
        },
        wrap: function(html) {
            var isFunction = jQuery.isFunction(html);
            return this.each(function(i) {
                jQuery(this).wrapAll(isFunction ? html.call(this, i) : html)
            })
        },
        unwrap: function() {
            return this.parent().each(function() {
                if (!jQuery.nodeName(this, "body")) {
                    jQuery(this).replaceWith(this.childNodes)
                }
            }).end()
        }
    });
    jQuery.expr.filters.hidden = function(elem) {
        return !jQuery.expr.filters.visible(elem)
    }
    ;
    jQuery.expr.filters.visible = function(elem) {
        return elem.offsetWidth > 0 || elem.offsetHeight > 0 || elem.getClientRects().length > 0
    }
    ;
    var r20 = /%20/g
        , rbracket = /\[\]$/
        , rCRLF = /\r?\n/g
        , rsubmitterTypes = /^(?:submit|button|image|reset|file)$/i
        , rsubmittable = /^(?:input|select|textarea|keygen)/i;
    function buildParams(prefix, obj, traditional, add) {
        var name;
        if (jQuery.isArray(obj)) {
            jQuery.each(obj, function(i, v) {
                if (traditional || rbracket.test(prefix)) {
                    add(prefix, v)
                } else {
                    buildParams(prefix + "[" + (typeof v === "object" && v != null ? i : "") + "]", v, traditional, add)
                }
            })
        } else if (!traditional && jQuery.type(obj) === "object") {
            for (name in obj) {
                buildParams(prefix + "[" + name + "]", obj[name], traditional, add)
            }
        } else {
            add(prefix, obj)
        }
    }
    jQuery.param = function(a, traditional) {
        var prefix, s = [], add = function(key, value) {
            value = jQuery.isFunction(value) ? value() : value == null ? "" : value;
            s[s.length] = encodeURIComponent(key) + "=" + encodeURIComponent(value)
        };
        if (traditional === undefined) {
            traditional = jQuery.ajaxSettings && jQuery.ajaxSettings.traditional
        }
        if (jQuery.isArray(a) || a.jquery && !jQuery.isPlainObject(a)) {
            jQuery.each(a, function() {
                add(this.name, this.value)
            })
        } else {
            for (prefix in a) {
                buildParams(prefix, a[prefix], traditional, add)
            }
        }
        return s.join("&").replace(r20, "+")
    }
    ;
    jQuery.fn.extend({
        serialize: function() {
            return jQuery.param(this.serializeArray())
        },
        serializeArray: function() {
            return this.map(function() {
                var elements = jQuery.prop(this, "elements");
                return elements ? jQuery.makeArray(elements) : this
            }).filter(function() {
                var type = this.type;
                return this.name && !jQuery(this).is(":disabled") && rsubmittable.test(this.nodeName) && !rsubmitterTypes.test(type) && (this.checked || !rcheckableType.test(type))
            }).map(function(i, elem) {
                var val = jQuery(this).val();
                return val == null ? null : jQuery.isArray(val) ? jQuery.map(val, function(val) {
                    return {
                        name: elem.name,
                        value: val.replace(rCRLF, "\r\n")
                    }
                }) : {
                    name: elem.name,
                    value: val.replace(rCRLF, "\r\n")
                }
            }).get()
        }
    });
    jQuery.ajaxSettings.xhr = function() {
        try {
            return new window.XMLHttpRequest
        } catch (e) {}
    }
    ;
    var xhrSuccessStatus = {
        0: 200,
        1223: 204
    }
        , xhrSupported = jQuery.ajaxSettings.xhr();
    support.cors = !!xhrSupported && "withCredentials"in xhrSupported;
    support.ajax = xhrSupported = !!xhrSupported;
    jQuery.ajaxTransport(function(options) {
        var callback, errorCallback;
        if (support.cors || xhrSupported && !options.crossDomain) {
            return {
                send: function(headers, complete) {
                    var i, xhr = options.xhr();
                    xhr.open(options.type, options.url, options.async, options.username, options.password);
                    if (options.xhrFields) {
                        for (i in options.xhrFields) {
                            xhr[i] = options.xhrFields[i]
                        }
                    }
                    if (options.mimeType && xhr.overrideMimeType) {
                        xhr.overrideMimeType(options.mimeType)
                    }
                    if (!options.crossDomain && !headers["X-Requested-With"]) {
                        headers["X-Requested-With"] = "XMLHttpRequest"
                    }
                    for (i in headers) {
                        xhr.setRequestHeader(i, headers[i])
                    }
                    callback = function(type) {
                        return function() {
                            if (callback) {
                                callback = errorCallback = xhr.onload = xhr.onerror = xhr.onabort = xhr.onreadystatechange = null;
                                if (type === "abort") {
                                    xhr.abort()
                                } else if (type === "error") {
                                    if (typeof xhr.status !== "number") {
                                        complete(0, "error")
                                    } else {
                                        complete(xhr.status, xhr.statusText)
                                    }
                                } else {
                                    complete(xhrSuccessStatus[xhr.status] || xhr.status, xhr.statusText, (xhr.responseType || "text") !== "text" || typeof xhr.responseText !== "string" ? {
                                        binary: xhr.response
                                    } : {
                                        text: xhr.responseText
                                    }, xhr.getAllResponseHeaders())
                                }
                            }
                        }
                    }
                    ;
                    xhr.onload = callback();
                    errorCallback = xhr.onerror = callback("error");
                    if (xhr.onabort !== undefined) {
                        xhr.onabort = errorCallback
                    } else {
                        xhr.onreadystatechange = function() {
                            if (xhr.readyState === 4) {
                                window.setTimeout(function() {
                                    if (callback) {
                                        errorCallback()
                                    }
                                })
                            }
                        }
                    }
                    callback = callback("abort");
                    try {
                        xhr.send(options.hasContent && options.data || null)
                    } catch (e) {
                        if (callback) {
                            throw e
                        }
                    }
                },
                abort: function() {
                    if (callback) {
                        callback()
                    }
                }
            }
        }
    });
    jQuery.ajaxSetup({
        accepts: {
            script: "text/javascript, application/javascript, " + "application/ecmascript, application/x-ecmascript"
        },
        contents: {
            script: /\b(?:java|ecma)script\b/
        },
        converters: {
            "text script": function(text) {
                jQuery.globalEval(text);
                return text
            }
        }
    });
    jQuery.ajaxPrefilter("script", function(s) {
        if (s.cache === undefined) {
            s.cache = false
        }
        if (s.crossDomain) {
            s.type = "GET"
        }
    });
    jQuery.ajaxTransport("script", function(s) {
        if (s.crossDomain) {
            var script, callback;
            return {
                send: function(_, complete) {
                    script = jQuery("<script>").prop({
                        charset: s.scriptCharset,
                        src: s.url
                    }).on("load error", callback = function(evt) {
                            script.remove();
                            callback = null;
                            if (evt) {
                                complete(evt.type === "error" ? 404 : 200, evt.type)
                            }
                        }
                    );
                    document.head.appendChild(script[0])
                },
                abort: function() {
                    if (callback) {
                        callback()
                    }
                }
            }
        }
    });
    var oldCallbacks = []
        , rjsonp = /(=)\?(?=&|$)|\?\?/;
    jQuery.ajaxSetup({
        jsonp: "callback",
        jsonpCallback: function() {
            var callback = oldCallbacks.pop() || jQuery.expando + "_" + nonce++;
            this[callback] = true;
            return callback
        }
    });
    jQuery.ajaxPrefilter("json jsonp", function(s, originalSettings, jqXHR) {
        var callbackName, overwritten, responseContainer, jsonProp = s.jsonp !== false && (rjsonp.test(s.url) ? "url" : typeof s.data === "string" && (s.contentType || "").indexOf("application/x-www-form-urlencoded") === 0 && rjsonp.test(s.data) && "data");
        if (jsonProp || s.dataTypes[0] === "jsonp") {
            callbackName = s.jsonpCallback = jQuery.isFunction(s.jsonpCallback) ? s.jsonpCallback() : s.jsonpCallback;
            if (jsonProp) {
                s[jsonProp] = s[jsonProp].replace(rjsonp, "$1" + callbackName)
            } else if (s.jsonp !== false) {
                s.url += (rquery.test(s.url) ? "&" : "?") + s.jsonp + "=" + callbackName
            }
            s.converters["script json"] = function() {
                if (!responseContainer) {
                    jQuery.error(callbackName + " was not called")
                }
                return responseContainer[0]
            }
            ;
            s.dataTypes[0] = "json";
            overwritten = window[callbackName];
            window[callbackName] = function() {
                responseContainer = arguments
            }
            ;
            jqXHR.always(function() {
                if (overwritten === undefined) {
                    jQuery(window).removeProp(callbackName)
                } else {
                    window[callbackName] = overwritten
                }
                if (s[callbackName]) {
                    s.jsonpCallback = originalSettings.jsonpCallback;
                    oldCallbacks.push(callbackName)
                }
                if (responseContainer && jQuery.isFunction(overwritten)) {
                    overwritten(responseContainer[0])
                }
                responseContainer = overwritten = undefined
            });
            return "script"
        }
    });
    jQuery.parseHTML = function(data, context, keepScripts) {
        if (!data || typeof data !== "string") {
            return null
        }
        if (typeof context === "boolean") {
            keepScripts = context;
            context = false
        }
        context = context || document;
        var parsed = rsingleTag.exec(data)
            , scripts = !keepScripts && [];
        if (parsed) {
            return [context.createElement(parsed[1])]
        }
        parsed = buildFragment([data], context, scripts);
        if (scripts && scripts.length) {
            jQuery(scripts).remove()
        }
        return jQuery.merge([], parsed.childNodes)
    }
    ;
    var _load = jQuery.fn.load;
    jQuery.fn.load = function(url, params, callback) {
        if (typeof url !== "string" && _load) {
            return _load.apply(this, arguments)
        }
        var selector, type, response, self = this, off = url.indexOf(" ");
        if (off > -1) {
            selector = jQuery.trim(url.slice(off));
            url = url.slice(0, off)
        }
        if (jQuery.isFunction(params)) {
            callback = params;
            params = undefined
        } else if (params && typeof params === "object") {
            type = "POST"
        }
        if (self.length > 0) {
            jQuery.ajax({
                url: url,
                type: type || "GET",
                dataType: "html",
                data: params
            }).done(function(responseText) {
                response = arguments;
                self.html(selector ? jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector) : responseText)
            }).always(callback && function(jqXHR, status) {
                self.each(function() {
                    callback.apply(this, response || [jqXHR.responseText, status, jqXHR])
                })
            }
            )
        }
        return this
    }
    ;
    jQuery.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function(i, type) {
        jQuery.fn[type] = function(fn) {
            return this.on(type, fn)
        }
    });
    jQuery.expr.filters.animated = function(elem) {
        return jQuery.grep(jQuery.timers, function(fn) {
            return elem === fn.elem
        }).length
    }
    ;
    function getWindow(elem) {
        return jQuery.isWindow(elem) ? elem : elem.nodeType === 9 && elem.defaultView
    }
    jQuery.offset = {
        setOffset: function(elem, options, i) {
            var curPosition, curLeft, curCSSTop, curTop, curOffset, curCSSLeft, calculatePosition, position = jQuery.css(elem, "position"), curElem = jQuery(elem), props = {};
            if (position === "static") {
                elem.style.position = "relative"
            }
            curOffset = curElem.offset();
            curCSSTop = jQuery.css(elem, "top");
            curCSSLeft = jQuery.css(elem, "left");
            calculatePosition = (position === "absolute" || position === "fixed") && (curCSSTop + curCSSLeft).indexOf("auto") > -1;
            if (calculatePosition) {
                curPosition = curElem.position();
                curTop = curPosition.top;
                curLeft = curPosition.left
            } else {
                curTop = parseFloat(curCSSTop) || 0;
                curLeft = parseFloat(curCSSLeft) || 0
            }
            if (jQuery.isFunction(options)) {
                options = options.call(elem, i, jQuery.extend({}, curOffset))
            }
            if (options.top != null) {
                props.top = options.top - curOffset.top + curTop
            }
            if (options.left != null) {
                props.left = options.left - curOffset.left + curLeft
            }
            if ("using"in options) {
                options.using.call(elem, props)
            } else {
                curElem.css(props)
            }
        }
    };
    jQuery.fn.extend({
        offset: function(options) {
            if (arguments.length) {
                return options === undefined ? this : this.each(function(i) {
                    jQuery.offset.setOffset(this, options, i)
                })
            }
            var docElem, win, elem = this[0], box = {
                top: 0,
                left: 0
            }, doc = elem && elem.ownerDocument;
            if (!doc) {
                return
            }
            docElem = doc.documentElement;
            if (!jQuery.contains(docElem, elem)) {
                return box
            }
            box = elem.getBoundingClientRect();
            win = getWindow(doc);
            return {
                top: box.top + win.pageYOffset - docElem.clientTop,
                left: box.left + win.pageXOffset - docElem.clientLeft
            }
        },
        position: function() {
            if (!this[0]) {
                return
            }
            var offsetParent, offset, elem = this[0], parentOffset = {
                top: 0,
                left: 0
            };
            if (jQuery.css(elem, "position") === "fixed") {
                offset = elem.getBoundingClientRect()
            } else {
                offsetParent = this.offsetParent();
                offset = this.offset();
                if (!jQuery.nodeName(offsetParent[0], "html")) {
                    parentOffset = offsetParent.offset()
                }
                parentOffset.top += jQuery.css(offsetParent[0], "borderTopWidth", true);
                parentOffset.left += jQuery.css(offsetParent[0], "borderLeftWidth", true)
            }
            return {
                top: offset.top - parentOffset.top - jQuery.css(elem, "marginTop", true),
                left: offset.left - parentOffset.left - jQuery.css(elem, "marginLeft", true)
            }
        },
        offsetParent: function() {
            return this.map(function() {
                var offsetParent = this.offsetParent;
                while (offsetParent && jQuery.css(offsetParent, "position") === "static") {
                    offsetParent = offsetParent.offsetParent
                }
                return offsetParent || documentElement
            })
        }
    });
    jQuery.each({
        scrollLeft: "pageXOffset",
        scrollTop: "pageYOffset"
    }, function(method, prop) {
        var top = "pageYOffset" === prop;
        jQuery.fn[method] = function(val) {
            return access(this, function(elem, method, val) {
                var win = getWindow(elem);
                if (val === undefined) {
                    return win ? win[prop] : elem[method]
                }
                if (win) {
                    win.scrollTo(!top ? val : win.pageXOffset, top ? val : win.pageYOffset)
                } else {
                    elem[method] = val
                }
            }, method, val, arguments.length)
        }
    });
    jQuery.each(["top", "left"], function(i, prop) {
        jQuery.cssHooks[prop] = addGetHookIf(support.pixelPosition, function(elem, computed) {
            if (computed) {
                computed = curCSS(elem, prop);
                return rnumnonpx.test(computed) ? jQuery(elem).position()[prop] + "px" : computed
            }
        })
    });
    jQuery.each({
        Height: "height",
        Width: "width"
    }, function(name, type) {
        jQuery.each({
            padding: "inner" + name,
            content: type,
            "": "outer" + name
        }, function(defaultExtra, funcName) {
            jQuery.fn[funcName] = function(margin, value) {
                var chainable = arguments.length && (defaultExtra || typeof margin !== "boolean")
                    , extra = defaultExtra || (margin === true || value === true ? "margin" : "border");
                return access(this, function(elem, type, value) {
                    var doc;
                    if (jQuery.isWindow(elem)) {
                        return elem.document.documentElement["client" + name]
                    }
                    if (elem.nodeType === 9) {
                        doc = elem.documentElement;
                        return Math.max(elem.body["scroll" + name], doc["scroll" + name], elem.body["offset" + name], doc["offset" + name], doc["client" + name])
                    }
                    return value === undefined ? jQuery.css(elem, type, extra) : jQuery.style(elem, type, value, extra)
                }, type, chainable ? margin : undefined, chainable, null)
            }
        })
    });
    jQuery.fn.extend({
        bind: function(types, data, fn) {
            return this.on(types, null, data, fn)
        },
        unbind: function(types, fn) {
            return this.off(types, null, fn)
        },
        delegate: function(selector, types, data, fn) {
            return this.on(types, selector, data, fn)
        },
        undelegate: function(selector, types, fn) {
            return arguments.length === 1 ? this.off(selector, "**") : this.off(types, selector || "**", fn)
        },
        size: function() {
            return this.length
        }
    });
    jQuery.fn.andSelf = jQuery.fn.addBack;
    if (typeof define === "function" && define.amd) {
        define("jquery", [], function() {
            return jQuery
        })
    }
    var _jQuery = window.jQuery
        , _$ = window.$;
    jQuery.noConflict = function(deep) {
        if (window.$ === jQuery) {
            window.$ = _$
        }
        if (deep && window.jQuery === jQuery) {
            window.jQuery = _jQuery
        }
        return jQuery
    }
    ;
    if (!noGlobal) {
        window.jQuery = window.$ = jQuery
    }
    return jQuery
});
(function() {
        var root = typeof self === "object" && self.self === self && self || typeof global === "object" && global.global === global && global || this;
        var previousUnderscore = root._;
        var ArrayProto = Array.prototype
            , ObjProto = Object.prototype;
        var push = ArrayProto.push
            , slice = ArrayProto.slice
            , toString = ObjProto.toString
            , hasOwnProperty = ObjProto.hasOwnProperty;
        var nativeIsArray = Array.isArray
            , nativeKeys = Object.keys
            , nativeCreate = Object.create;
        var Ctor = function() {};
        var _ = function(obj) {
            if (obj instanceof _)
                return obj;
            if (!(this instanceof _))
                return new _(obj);
            this._wrapped = obj
        };
        if (typeof exports !== "undefined") {
            if (typeof module !== "undefined" && module.exports) {
                exports = module.exports = _
            }
            exports._ = _
        } else {}
        _.VERSION = "1.8.3";
        var optimizeCb = function(func, context, argCount) {
            if (context === void 0)
                return func;
            switch (argCount == null ? 3 : argCount) {
                case 1:
                    return function(value) {
                        return func.call(context, value)
                    }
                        ;
                case 3:
                    return function(value, index, collection) {
                        return func.call(context, value, index, collection)
                    }
                        ;
                case 4:
                    return function(accumulator, value, index, collection) {
                        return func.call(context, accumulator, value, index, collection)
                    }
            }
            return function() {
                return func.apply(context, arguments)
            }
        };
        var cb = function(value, context, argCount) {
            if (value == null)
                return _.identity;
            if (_.isFunction(value))
                return optimizeCb(value, context, argCount);
            if (_.isObject(value))
                return _.matcher(value);
            return _.property(value)
        };
        _.iteratee = function(value, context) {
            return cb(value, context, Infinity)
        }
        ;
        var restArgs = function(func, startIndex) {
            startIndex = startIndex == null ? func.length - 1 : +startIndex;
            return function() {
                var length = Math.max(arguments.length - startIndex, 0);
                var rest = Array(length);
                for (var index = 0; index < length; index++) {
                    rest[index] = arguments[index + startIndex]
                }
                switch (startIndex) {
                    case 0:
                        return func.call(this, rest);
                    case 1:
                        return func.call(this, arguments[0], rest);
                    case 2:
                        return func.call(this, arguments[0], arguments[1], rest)
                }
                var args = Array(startIndex + 1);
                for (index = 0; index < startIndex; index++) {
                    args[index] = arguments[index]
                }
                args[startIndex] = rest;
                return func.apply(this, args)
            }
        };
        var baseCreate = function(prototype) {
            if (!_.isObject(prototype))
                return {};
            if (nativeCreate)
                return nativeCreate(prototype);
            Ctor.prototype = prototype;
            var result = new Ctor;
            Ctor.prototype = null;
            return result
        };
        var property = function(key) {
            return function(obj) {
                return obj == null ? void 0 : obj[key]
            }
        };
        var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;
        var getLength = property("length");
        var isArrayLike = function(collection) {
            var length = getLength(collection);
            return typeof length == "number" && length >= 0 && length <= MAX_ARRAY_INDEX
        };
        _.each = _.forEach = function(obj, iteratee, context) {
            iteratee = optimizeCb(iteratee, context);
            var i, length;
            if (isArrayLike(obj)) {
                for (i = 0,
                         length = obj.length; i < length; i++) {
                    iteratee(obj[i], i, obj)
                }
            } else {
                var keys = _.keys(obj);
                for (i = 0,
                         length = keys.length; i < length; i++) {
                    iteratee(obj[keys[i]], keys[i], obj)
                }
            }
            return obj
        }
        ;
        _.map = _.collect = function(obj, iteratee, context) {
            iteratee = cb(iteratee, context);
            var keys = !isArrayLike(obj) && _.keys(obj)
                , length = (keys || obj).length
                , results = Array(length);
            for (var index = 0; index < length; index++) {
                var currentKey = keys ? keys[index] : index;
                results[index] = iteratee(obj[currentKey], currentKey, obj)
            }
            return results
        }
        ;
        var createReduce = function(dir) {
            var reducer = function(obj, iteratee, memo, initial) {
                var keys = !isArrayLike(obj) && _.keys(obj)
                    , length = (keys || obj).length
                    , index = dir > 0 ? 0 : length - 1;
                if (!initial) {
                    memo = obj[keys ? keys[index] : index];
                    index += dir
                }
                for (; index >= 0 && index < length; index += dir) {
                    var currentKey = keys ? keys[index] : index;
                    memo = iteratee(memo, obj[currentKey], currentKey, obj)
                }
                return memo
            };
            return function(obj, iteratee, memo, context) {
                var initial = arguments.length >= 3;
                return reducer(obj, optimizeCb(iteratee, context, 4), memo, initial)
            }
        };
        _.reduce = _.foldl = _.inject = createReduce(1);
        _.reduceRight = _.foldr = createReduce(-1);
        _.find = _.detect = function(obj, predicate, context) {
            var key;
            if (isArrayLike(obj)) {
                key = _.findIndex(obj, predicate, context)
            } else {
                key = _.findKey(obj, predicate, context)
            }
            if (key !== void 0 && key !== -1)
                return obj[key]
        }
        ;
        _.filter = _.select = function(obj, predicate, context) {
            var results = [];
            predicate = cb(predicate, context);
            _.each(obj, function(value, index, list) {
                if (predicate(value, index, list))
                    results.push(value)
            });
            return results
        }
        ;
        _.reject = function(obj, predicate, context) {
            return _.filter(obj, _.negate(cb(predicate)), context)
        }
        ;
        _.every = _.all = function(obj, predicate, context) {
            predicate = cb(predicate, context);
            var keys = !isArrayLike(obj) && _.keys(obj)
                , length = (keys || obj).length;
            for (var index = 0; index < length; index++) {
                var currentKey = keys ? keys[index] : index;
                if (!predicate(obj[currentKey], currentKey, obj))
                    return false
            }
            return true
        }
        ;
        _.some = _.any = function(obj, predicate, context) {
            predicate = cb(predicate, context);
            var keys = !isArrayLike(obj) && _.keys(obj)
                , length = (keys || obj).length;
            for (var index = 0; index < length; index++) {
                var currentKey = keys ? keys[index] : index;
                if (predicate(obj[currentKey], currentKey, obj))
                    return true
            }
            return false
        }
        ;
        _.contains = _.includes = _.include = function(obj, item, fromIndex, guard) {
            if (!isArrayLike(obj))
                obj = _.values(obj);
            if (typeof fromIndex != "number" || guard)
                fromIndex = 0;
            return _.indexOf(obj, item, fromIndex) >= 0
        }
        ;
        _.invoke = restArgs(function(obj, method, args) {
            var isFunc = _.isFunction(method);
            return _.map(obj, function(value) {
                var func = isFunc ? method : value[method];
                return func == null ? func : func.apply(value, args)
            })
        });
        _.pluck = function(obj, key) {
            return _.map(obj, _.property(key))
        }
        ;
        _.where = function(obj, attrs) {
            return _.filter(obj, _.matcher(attrs))
        }
        ;
        _.findWhere = function(obj, attrs) {
            return _.find(obj, _.matcher(attrs))
        }
        ;
        _.max = function(obj, iteratee, context) {
            var result = -Infinity, lastComputed = -Infinity, value, computed;
            if (iteratee == null || typeof iteratee == "number" && typeof obj[0] != "object" && obj != null) {
                obj = isArrayLike(obj) ? obj : _.values(obj);
                for (var i = 0, length = obj.length; i < length; i++) {
                    value = obj[i];
                    if (value > result) {
                        result = value
                    }
                }
            } else {
                iteratee = cb(iteratee, context);
                _.each(obj, function(v, index, list) {
                    computed = iteratee(v, index, list);
                    if (computed > lastComputed || computed === -Infinity && result === -Infinity) {
                        result = v;
                        lastComputed = computed
                    }
                })
            }
            return result
        }
        ;
        _.min = function(obj, iteratee, context) {
            var result = Infinity, lastComputed = Infinity, value, computed;
            if (iteratee == null || typeof iteratee == "number" && typeof obj[0] != "object" && obj != null) {
                obj = isArrayLike(obj) ? obj : _.values(obj);
                for (var i = 0, length = obj.length; i < length; i++) {
                    value = obj[i];
                    if (value < result) {
                        result = value
                    }
                }
            } else {
                iteratee = cb(iteratee, context);
                _.each(obj, function(v, index, list) {
                    computed = iteratee(v, index, list);
                    if (computed < lastComputed || computed === Infinity && result === Infinity) {
                        result = v;
                        lastComputed = computed
                    }
                })
            }
            return result
        }
        ;
        _.shuffle = function(obj) {
            return _.sample(obj, Infinity)
        }
        ;
        _.sample = function(obj, n, guard) {
            if (n == null || guard) {
                if (!isArrayLike(obj))
                    obj = _.values(obj);
                return obj[_.random(obj.length - 1)]
            }
            var sample = isArrayLike(obj) ? _.clone(obj) : _.values(obj);
            var length = getLength(sample);
            n = Math.max(Math.min(n, length), 0);
            var last = length - 1;
            for (var index = 0; index < n; index++) {
                var rand = _.random(index, last);
                var temp = sample[index];
                sample[index] = sample[rand];
                sample[rand] = temp
            }
            return sample.slice(0, n)
        }
        ;
        _.sortBy = function(obj, iteratee, context) {
            iteratee = cb(iteratee, context);
            return _.pluck(_.map(obj, function(value, index, list) {
                return {
                    value: value,
                    index: index,
                    criteria: iteratee(value, index, list)
                }
            }).sort(function(left, right) {
                var a = left.criteria;
                var b = right.criteria;
                if (a !== b) {
                    if (a > b || a === void 0)
                        return 1;
                    if (a < b || b === void 0)
                        return -1
                }
                return left.index - right.index
            }), "value")
        }
        ;
        var group = function(behavior, partition) {
            return function(obj, iteratee, context) {
                var result = partition ? [[], []] : {};
                iteratee = cb(iteratee, context);
                _.each(obj, function(value, index) {
                    var key = iteratee(value, index, obj);
                    behavior(result, value, key)
                });
                return result
            }
        };
        _.groupBy = group(function(result, value, key) {
            if (_.has(result, key))
                result[key].push(value);
            else
                result[key] = [value]
        });
        _.indexBy = group(function(result, value, key) {
            result[key] = value
        });
        _.countBy = group(function(result, value, key) {
            if (_.has(result, key))
                result[key]++;
            else
                result[key] = 1
        });
        _.toArray = function(obj) {
            if (!obj)
                return [];
            if (_.isArray(obj))
                return slice.call(obj);
            if (isArrayLike(obj))
                return _.map(obj, _.identity);
            return _.values(obj)
        }
        ;
        _.size = function(obj) {
            if (obj == null)
                return 0;
            return isArrayLike(obj) ? obj.length : _.keys(obj).length
        }
        ;
        _.partition = group(function(result, value, pass) {
            result[pass ? 0 : 1].push(value)
        }, true);
        _.first = _.head = _.take = function(array, n, guard) {
            if (array == null)
                return void 0;
            if (n == null || guard)
                return array[0];
            return _.initial(array, array.length - n)
        }
        ;
        _.initial = function(array, n, guard) {
            return slice.call(array, 0, Math.max(0, array.length - (n == null || guard ? 1 : n)))
        }
        ;
        _.last = function(array, n, guard) {
            if (array == null)
                return void 0;
            if (n == null || guard)
                return array[array.length - 1];
            return _.rest(array, Math.max(0, array.length - n))
        }
        ;
        _.rest = _.tail = _.drop = function(array, n, guard) {
            return slice.call(array, n == null || guard ? 1 : n)
        }
        ;
        _.compact = function(array) {
            return _.filter(array, _.identity)
        }
        ;
        var flatten = function(input, shallow, strict, output) {
            output = output || [];
            var idx = output.length;
            for (var i = 0, length = getLength(input); i < length; i++) {
                var value = input[i];
                if (isArrayLike(value) && (_.isArray(value) || _.isArguments(value))) {
                    if (shallow) {
                        var j = 0
                            , len = value.length;
                        while (j < len)
                            output[idx++] = value[j++]
                    } else {
                        flatten(value, shallow, strict, output);
                        idx = output.length
                    }
                } else if (!strict) {
                    output[idx++] = value
                }
            }
            return output
        };
        _.flatten = function(array, shallow) {
            return flatten(array, shallow, false)
        }
        ;
        _.without = restArgs(function(array, otherArrays) {
            return _.difference(array, otherArrays)
        });
        _.uniq = _.unique = function(array, isSorted, iteratee, context) {
            if (!_.isBoolean(isSorted)) {
                context = iteratee;
                iteratee = isSorted;
                isSorted = false
            }
            if (iteratee != null)
                iteratee = cb(iteratee, context);
            var result = [];
            var seen = [];
            for (var i = 0, length = getLength(array); i < length; i++) {
                var value = array[i]
                    , computed = iteratee ? iteratee(value, i, array) : value;
                if (isSorted) {
                    if (!i || seen !== computed)
                        result.push(value);
                    seen = computed
                } else if (iteratee) {
                    if (!_.contains(seen, computed)) {
                        seen.push(computed);
                        result.push(value)
                    }
                } else if (!_.contains(result, value)) {
                    result.push(value)
                }
            }
            return result
        }
        ;
        _.union = restArgs(function(arrays) {
            return _.uniq(flatten(arrays, true, true))
        });
        _.intersection = function(array) {
            var result = [];
            var argsLength = arguments.length;
            for (var i = 0, length = getLength(array); i < length; i++) {
                var item = array[i];
                if (_.contains(result, item))
                    continue;
                var j;
                for (j = 1; j < argsLength; j++) {
                    if (!_.contains(arguments[j], item))
                        break
                }
                if (j === argsLength)
                    result.push(item)
            }
            return result
        }
        ;
        _.difference = restArgs(function(array, rest) {
            rest = flatten(rest, true, true);
            return _.filter(array, function(value) {
                return !_.contains(rest, value)
            })
        });
        _.unzip = function(array) {
            var length = array && _.max(array, getLength).length || 0;
            var result = Array(length);
            for (var index = 0; index < length; index++) {
                result[index] = _.pluck(array, index)
            }
            return result
        }
        ;
        _.zip = restArgs(_.unzip);
        _.object = function(list, values) {
            var result = {};
            for (var i = 0, length = getLength(list); i < length; i++) {
                if (values) {
                    result[list[i]] = values[i]
                } else {
                    result[list[i][0]] = list[i][1]
                }
            }
            return result
        }
        ;
        var createPredicateIndexFinder = function(dir) {
            return function(array, predicate, context) {
                predicate = cb(predicate, context);
                var length = getLength(array);
                var index = dir > 0 ? 0 : length - 1;
                for (; index >= 0 && index < length; index += dir) {
                    if (predicate(array[index], index, array))
                        return index
                }
                return -1
            }
        };
        _.findIndex = createPredicateIndexFinder(1);
        _.findLastIndex = createPredicateIndexFinder(-1);
        _.sortedIndex = function(array, obj, iteratee, context) {
            iteratee = cb(iteratee, context, 1);
            var value = iteratee(obj);
            var low = 0
                , high = getLength(array);
            while (low < high) {
                var mid = Math.floor((low + high) / 2);
                if (iteratee(array[mid]) < value)
                    low = mid + 1;
                else
                    high = mid
            }
            return low
        }
        ;
        var createIndexFinder = function(dir, predicateFind, sortedIndex) {
            return function(array, item, idx) {
                var i = 0
                    , length = getLength(array);
                if (typeof idx == "number") {
                    if (dir > 0) {
                        i = idx >= 0 ? idx : Math.max(idx + length, i)
                    } else {
                        length = idx >= 0 ? Math.min(idx + 1, length) : idx + length + 1
                    }
                } else if (sortedIndex && idx && length) {
                    idx = sortedIndex(array, item);
                    return array[idx] === item ? idx : -1
                }
                if (item !== item) {
                    idx = predicateFind(slice.call(array, i, length), _.isNaN);
                    return idx >= 0 ? idx + i : -1
                }
                for (idx = dir > 0 ? i : length - 1; idx >= 0 && idx < length; idx += dir) {
                    if (array[idx] === item)
                        return idx
                }
                return -1
            }
        };
        _.indexOf = createIndexFinder(1, _.findIndex, _.sortedIndex);
        _.lastIndexOf = createIndexFinder(-1, _.findLastIndex);
        _.range = function(start, stop, step) {
            if (stop == null) {
                stop = start || 0;
                start = 0
            }
            step = step || 1;
            var length = Math.max(Math.ceil((stop - start) / step), 0);
            var range = Array(length);
            for (var idx = 0; idx < length; idx++,
                start += step) {
                range[idx] = start
            }
            return range
        }
        ;
        var executeBound = function(sourceFunc, boundFunc, context, callingContext, args) {
            if (!(callingContext instanceof boundFunc))
                return sourceFunc.apply(context, args);
            var self = baseCreate(sourceFunc.prototype);
            var result = sourceFunc.apply(self, args);
            if (_.isObject(result))
                return result;
            return self
        };
        _.bind = restArgs(function(func, context, args) {
            if (!_.isFunction(func))
                throw new TypeError("Bind must be called on a function");
            var bound = restArgs(function(callArgs) {
                return executeBound(func, bound, context, this, args.concat(callArgs))
            });
            return bound
        });
        _.partial = restArgs(function(func, boundArgs) {
            var placeholder = _.partial.placeholder;
            var bound = function() {
                var position = 0
                    , length = boundArgs.length;
                var args = Array(length);
                for (var i = 0; i < length; i++) {
                    args[i] = boundArgs[i] === placeholder ? arguments[position++] : boundArgs[i]
                }
                while (position < arguments.length)
                    args.push(arguments[position++]);
                return executeBound(func, bound, this, this, args)
            };
            return bound
        });
        _.partial.placeholder = _;
        _.bindAll = restArgs(function(obj, keys) {
            keys = flatten(keys, false, false);
            var index = keys.length;
            if (index < 1)
                throw new Error("bindAll must be passed function names");
            while (index--) {
                var key = keys[index];
                obj[key] = _.bind(obj[key], obj)
            }
        });
        _.memoize = function(func, hasher) {
            var memoize = function(key) {
                var cache = memoize.cache;
                var address = "" + (hasher ? hasher.apply(this, arguments) : key);
                if (!_.has(cache, address))
                    cache[address] = func.apply(this, arguments);
                return cache[address]
            };
            memoize.cache = {};
            return memoize
        }
        ;
        _.delay = restArgs(function(func, wait, args) {
            return setTimeout(function() {
                return func.apply(null, args)
            }, wait)
        });
        _.defer = _.partial(_.delay, _, 1);
        _.throttle = function(func, wait, options) {
            var context, args, result;
            var timeout = null;
            var previous = 0;
            if (!options)
                options = {};
            var later = function() {
                previous = options.leading === false ? 0 : _.now();
                timeout = null;
                result = func.apply(context, args);
                if (!timeout)
                    context = args = null
            };
            return function() {
                var now = _.now();
                if (!previous && options.leading === false)
                    previous = now;
                var remaining = wait - (now - previous);
                context = this;
                args = arguments;
                if (remaining <= 0 || remaining > wait) {
                    if (timeout) {
                        clearTimeout(timeout);
                        timeout = null
                    }
                    previous = now;
                    result = func.apply(context, args);
                    if (!timeout)
                        context = args = null
                } else if (!timeout && options.trailing !== false) {
                    timeout = setTimeout(later, remaining)
                }
                return result
            }
        }
        ;
        _.debounce = function(func, wait, immediate) {
            var timeout, args, context, timestamp, result;
            var later = function() {
                var last = _.now() - timestamp;
                if (last < wait && last >= 0) {
                    timeout = setTimeout(later, wait - last)
                } else {
                    timeout = null;
                    if (!immediate) {
                        result = func.apply(context, args);
                        if (!timeout)
                            context = args = null
                    }
                }
            };
            return function() {
                context = this;
                args = arguments;
                timestamp = _.now();
                var callNow = immediate && !timeout;
                if (!timeout)
                    timeout = setTimeout(later, wait);
                if (callNow) {
                    result = func.apply(context, args);
                    context = args = null
                }
                return result
            }
        }
        ;
        _.wrap = function(func, wrapper) {
            return _.partial(wrapper, func)
        }
        ;
        _.negate = function(predicate) {
            return function() {
                return !predicate.apply(this, arguments)
            }
        }
        ;
        _.compose = function() {
            var args = arguments;
            var start = args.length - 1;
            return function() {
                var i = start;
                var result = args[start].apply(this, arguments);
                while (i--)
                    result = args[i].call(this, result);
                return result
            }
        }
        ;
        _.after = function(times, func) {
            return function() {
                if (--times < 1) {
                    return func.apply(this, arguments)
                }
            }
        }
        ;
        _.before = function(times, func) {
            var memo;
            return function() {
                if (--times > 0) {
                    memo = func.apply(this, arguments)
                }
                if (times <= 1)
                    func = null;
                return memo
            }
        }
        ;
        _.once = _.partial(_.before, 2);
        _.restArgs = restArgs;
        var hasEnumBug = !{
            toString: null
        }.propertyIsEnumerable("toString");
        var nonEnumerableProps = ["valueOf", "isPrototypeOf", "toString", "propertyIsEnumerable", "hasOwnProperty", "toLocaleString"];
        var collectNonEnumProps = function(obj, keys) {
            var nonEnumIdx = nonEnumerableProps.length;
            var constructor = obj.constructor;
            var proto = _.isFunction(constructor) && constructor.prototype || ObjProto;
            var prop = "constructor";
            if (_.has(obj, prop) && !_.contains(keys, prop))
                keys.push(prop);
            while (nonEnumIdx--) {
                prop = nonEnumerableProps[nonEnumIdx];
                if (prop in obj && obj[prop] !== proto[prop] && !_.contains(keys, prop)) {
                    keys.push(prop)
                }
            }
        };
        _.keys = function(obj) {
            if (!_.isObject(obj))
                return [];
            if (nativeKeys)
                return nativeKeys(obj);
            var keys = [];
            for (var key in obj)
                if (_.has(obj, key))
                    keys.push(key);
            if (hasEnumBug)
                collectNonEnumProps(obj, keys);
            return keys
        }
        ;
        _.allKeys = function(obj) {
            if (!_.isObject(obj))
                return [];
            var keys = [];
            for (var key in obj)
                keys.push(key);
            if (hasEnumBug)
                collectNonEnumProps(obj, keys);
            return keys
        }
        ;
        _.values = function(obj) {
            var keys = _.keys(obj);
            var length = keys.length;
            var values = Array(length);
            for (var i = 0; i < length; i++) {
                values[i] = obj[keys[i]]
            }
            return values
        }
        ;
        _.mapObject = function(obj, iteratee, context) {
            iteratee = cb(iteratee, context);
            var keys = _.keys(obj)
                , length = keys.length
                , results = {};
            for (var index = 0; index < length; index++) {
                var currentKey = keys[index];
                results[currentKey] = iteratee(obj[currentKey], currentKey, obj)
            }
            return results
        }
        ;
        _.pairs = function(obj) {
            var keys = _.keys(obj);
            var length = keys.length;
            var pairs = Array(length);
            for (var i = 0; i < length; i++) {
                pairs[i] = [keys[i], obj[keys[i]]]
            }
            return pairs
        }
        ;
        _.invert = function(obj) {
            var result = {};
            var keys = _.keys(obj);
            for (var i = 0, length = keys.length; i < length; i++) {
                result[obj[keys[i]]] = keys[i]
            }
            return result
        }
        ;
        _.functions = _.methods = function(obj) {
            var names = [];
            for (var key in obj) {
                if (_.isFunction(obj[key]))
                    names.push(key)
            }
            return names.sort()
        }
        ;
        var createAssigner = function(keysFunc, undefinedOnly) {
            return function(obj) {
                var length = arguments.length;
                if (length < 2 || obj == null)
                    return obj;
                for (var index = 1; index < length; index++) {
                    var source = arguments[index]
                        , keys = keysFunc(source)
                        , l = keys.length;
                    for (var i = 0; i < l; i++) {
                        var key = keys[i];
                        if (!undefinedOnly || obj[key] === void 0)
                            obj[key] = source[key]
                    }
                }
                return obj
            }
        };
        _.extend = createAssigner(_.allKeys);
        _.extendOwn = _.assign = createAssigner(_.keys);
        _.findKey = function(obj, predicate, context) {
            predicate = cb(predicate, context);
            var keys = _.keys(obj), key;
            for (var i = 0, length = keys.length; i < length; i++) {
                key = keys[i];
                if (predicate(obj[key], key, obj))
                    return key
            }
        }
        ;
        var keyInObj = function(value, key, obj) {
            return key in obj
        };
        _.pick = restArgs(function(obj, keys) {
            var result = {}
                , iteratee = keys[0];
            if (obj == null)
                return result;
            if (_.isFunction(iteratee)) {
                if (keys.length > 1)
                    iteratee = optimizeCb(iteratee, keys[1]);
                keys = _.allKeys(obj)
            } else {
                iteratee = keyInObj;
                keys = flatten(keys, false, false);
                obj = Object(obj)
            }
            for (var i = 0, length = keys.length; i < length; i++) {
                var key = keys[i];
                var value = obj[key];
                if (iteratee(value, key, obj))
                    result[key] = value
            }
            return result
        });
        _.omit = restArgs(function(obj, keys) {
            var iteratee = keys[0], context;
            if (_.isFunction(iteratee)) {
                iteratee = _.negate(iteratee);
                if (keys.length > 1)
                    context = keys[1]
            } else {
                keys = _.map(flatten(keys, false, false), String);
                iteratee = function(value, key) {
                    return !_.contains(keys, key)
                }
            }
            return _.pick(obj, iteratee, context)
        });
        _.defaults = createAssigner(_.allKeys, true);
        _.create = function(prototype, props) {
            var result = baseCreate(prototype);
            if (props)
                _.extendOwn(result, props);
            return result
        }
        ;
        _.clone = function(obj) {
            if (!_.isObject(obj))
                return obj;
            return _.isArray(obj) ? obj.slice() : _.extend({}, obj)
        }
        ;
        _.tap = function(obj, interceptor) {
            interceptor(obj);
            return obj
        }
        ;
        _.isMatch = function(object, attrs) {
            var keys = _.keys(attrs)
                , length = keys.length;
            if (object == null)
                return !length;
            var obj = Object(object);
            for (var i = 0; i < length; i++) {
                var key = keys[i];
                if (attrs[key] !== obj[key] || !(key in obj))
                    return false
            }
            return true
        }
        ;
        var eq, deepEq;
        eq = function(a, b, aStack, bStack) {
            if (a === b)
                return a !== 0 || 1 / a === 1 / b;
            if (a == null || b == null)
                return a === b;
            if (a !== a)
                return b !== b;
            var type = typeof a;
            if (type !== "function" && type !== "object" && typeof b !== "object")
                return false;
            return deepEq(a, b, aStack, bStack)
        }
        ;
        deepEq = function(a, b, aStack, bStack) {
            if (a instanceof _)
                a = a._wrapped;
            if (b instanceof _)
                b = b._wrapped;
            var className = toString.call(a);
            if (className !== toString.call(b))
                return false;
            switch (className) {
                case "[object RegExp]":
                case "[object String]":
                    return "" + a === "" + b;
                case "[object Number]":
                    if (+a !== +a)
                        return +b !== +b;
                    return +a === 0 ? 1 / +a === 1 / b : +a === +b;
                case "[object Date]":
                case "[object Boolean]":
                    return +a === +b
            }
            var areArrays = className === "[object Array]";
            if (!areArrays) {
                if (typeof a != "object" || typeof b != "object")
                    return false;
                var aCtor = a.constructor
                    , bCtor = b.constructor;
                if (aCtor !== bCtor && !(_.isFunction(aCtor) && aCtor instanceof aCtor && _.isFunction(bCtor) && bCtor instanceof bCtor) && ("constructor"in a && "constructor"in b)) {
                    return false
                }
            }
            aStack = aStack || [];
            bStack = bStack || [];
            var length = aStack.length;
            while (length--) {
                if (aStack[length] === a)
                    return bStack[length] === b
            }
            aStack.push(a);
            bStack.push(b);
            if (areArrays) {
                length = a.length;
                if (length !== b.length)
                    return false;
                while (length--) {
                    if (!eq(a[length], b[length], aStack, bStack))
                        return false
                }
            } else {
                var keys = _.keys(a), key;
                length = keys.length;
                if (_.keys(b).length !== length)
                    return false;
                while (length--) {
                    key = keys[length];
                    if (!(_.has(b, key) && eq(a[key], b[key], aStack, bStack)))
                        return false
                }
            }
            aStack.pop();
            bStack.pop();
            return true
        }
        ;
        _.isEqual = function(a, b) {
            return eq(a, b)
        }
        ;
        _.isEmpty = function(obj) {
            if (obj == null)
                return true;
            if (isArrayLike(obj) && (_.isArray(obj) || _.isString(obj) || _.isArguments(obj)))
                return obj.length === 0;
            return _.keys(obj).length === 0
        }
        ;
        _.isElement = function(obj) {
            return !!(obj && obj.nodeType === 1)
        }
        ;
        _.isArray = nativeIsArray || function(obj) {
            return toString.call(obj) === "[object Array]"
        }
        ;
        _.isObject = function(obj) {
            var type = typeof obj;
            return type === "function" || type === "object" && !!obj
        }
        ;
        _.each(["Arguments", "Function", "String", "Number", "Date", "RegExp", "Error"], function(name) {
            _["is" + name] = function(obj) {
                return toString.call(obj) === "[object " + name + "]"
            }
        });
        if (!_.isArguments(arguments)) {
            _.isArguments = function(obj) {
                return _.has(obj, "callee")
            }
        }
        var nodelist = root.document && root.document.childNodes;
        if (typeof /./ != "function" && typeof Int8Array != "object" && typeof nodelist != "function") {
            _.isFunction = function(obj) {
                return typeof obj == "function" || false
            }
        }
        _.isFinite = function(obj) {
            return isFinite(obj) && !isNaN(parseFloat(obj))
        }
        ;
        _.isNaN = function(obj) {
            return _.isNumber(obj) && obj !== +obj
        }
        ;
        _.isBoolean = function(obj) {
            return obj === true || obj === false || toString.call(obj) === "[object Boolean]"
        }
        ;
        _.isNull = function(obj) {
            return obj === null
        }
        ;
        _.isUndefined = function(obj) {
            return obj === void 0
        }
        ;
        _.has = function(obj, key) {
            return obj != null && hasOwnProperty.call(obj, key)
        }
        ;
        _.noConflict = function() {
            root._ = previousUnderscore;
            return this
        }
        ;
        _.identity = function(value) {
            return value
        }
        ;
        _.constant = function(value) {
            return function() {
                return value
            }
        }
        ;
        _.noop = function() {}
        ;
        _.property = property;
        _.propertyOf = function(obj) {
            return obj == null ? function() {}
                : function(key) {
                    return obj[key]
                }
        }
        ;
        _.matcher = _.matches = function(attrs) {
            attrs = _.extendOwn({}, attrs);
            return function(obj) {
                return _.isMatch(obj, attrs)
            }
        }
        ;
        _.times = function(n, iteratee, context) {
            var accum = Array(Math.max(0, n));
            iteratee = optimizeCb(iteratee, context, 1);
            for (var i = 0; i < n; i++)
                accum[i] = iteratee(i);
            return accum
        }
        ;
        _.random = function(min, max) {
            if (max == null) {
                max = min;
                min = 0
            }
            return min + Math.floor(Math.random() * (max - min + 1))
        }
        ;
        _.now = Date.now || function() {
            return (new Date).getTime()
        }
        ;
        var escapeMap = {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#x27;",
            "`": "&#x60;"
        };
        var unescapeMap = _.invert(escapeMap);
        var createEscaper = function(map) {
            var escaper = function(match) {
                return map[match]
            };
            var source = "(?:" + _.keys(map).join("|") + ")";
            var testRegexp = RegExp(source);
            var replaceRegexp = RegExp(source, "g");
            return function(string) {
                string = string == null ? "" : "" + string;
                return testRegexp.test(string) ? string.replace(replaceRegexp, escaper) : string
            }
        };
        _.escape = createEscaper(escapeMap);
        _.unescape = createEscaper(unescapeMap);
        _.result = function(object, prop, fallback) {
            var value = object == null ? void 0 : object[prop];
            if (value === void 0) {
                value = fallback
            }
            return _.isFunction(value) ? value.call(object) : value
        }
        ;
        var idCounter = 0;
        _.uniqueId = function(prefix) {
            var id = ++idCounter + "";
            return prefix ? prefix + id : id
        }
        ;
        _.templateSettings = {
            evaluate: /<%([\s\S]+?)%>/g,
            interpolate: /<%=([\s\S]+?)%>/g,
            escape: /<%-([\s\S]+?)%>/g
        };
        var noMatch = /(.)^/;
        var escapes = {
            "'": "'",
            "\\": "\\",
            "\r": "r",
            "\n": "n",
            "\u2028": "u2028",
            "\u2029": "u2029"
        };
        var escapeRegExp = /\\|'|\r|\n|\u2028|\u2029/g;
        var escapeChar = function(match) {
            return "\\" + escapes[match]
        };
        _.template = function(text, settings, oldSettings) {
            if (!settings && oldSettings)
                settings = oldSettings;
            settings = _.defaults({}, settings, _.templateSettings);
            var matcher = RegExp([(settings.escape || noMatch).source, (settings.interpolate || noMatch).source, (settings.evaluate || noMatch).source].join("|") + "|$", "g");
            var index = 0;
            var source = "__p+='";
            text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {
                source += text.slice(index, offset).replace(escapeRegExp, escapeChar);
                index = offset + match.length;
                if (escape) {
                    source += "'+\n((__t=(" + escape + "))==null?'':_.escape(__t))+\n'"
                } else if (interpolate) {
                    source += "'+\n((__t=(" + interpolate + "))==null?'':__t)+\n'"
                } else if (evaluate) {
                    source += "';\n" + evaluate + "\n__p+='"
                }
                return match
            });
            source += "';\n";
            if (!settings.variable)
                source = "with(obj||{}){\n" + source + "}\n";
            source = "var __t,__p='',__j=Array.prototype.join," + "print=function(){__p+=__j.call(arguments,'');};\n" + source + "return __p;\n";
            var render;
            try {
                render = new Function(settings.variable || "obj","_",source)
            } catch (e) {
                e.source = source;
                throw e
            }
            var template = function(data) {
                return render.call(this, data, _)
            };
            var argument = settings.variable || "obj";
            template.source = "function(" + argument + "){\n" + source + "}";
            return template
        }
        ;
        _.chain = function(obj) {
            var instance = _(obj);
            instance._chain = true;
            return instance
        }
        ;
        var chainResult = function(instance, obj) {
            return instance._chain ? _(obj).chain() : obj
        };
        _.mixin = function(obj) {
            _.each(_.functions(obj), function(name) {
                var func = _[name] = obj[name];
                _.prototype[name] = function() {
                    var args = [this._wrapped];
                    push.apply(args, arguments);
                    return chainResult(this, func.apply(_, args))
                }
            })
        }
        ;
        _.mixin(_);
        _.each(["pop", "push", "reverse", "shift", "sort", "splice", "unshift"], function(name) {
            var method = ArrayProto[name];
            _.prototype[name] = function() {
                var obj = this._wrapped;
                method.apply(obj, arguments);
                if ((name === "shift" || name === "splice") && obj.length === 0)
                    delete obj[0];
                return chainResult(this, obj)
            }
        });
        _.each(["concat", "join", "slice"], function(name) {
            var method = ArrayProto[name];
            _.prototype[name] = function() {
                return chainResult(this, method.apply(this._wrapped, arguments))
            }
        });
        _.prototype.value = function() {
            return this._wrapped
        }
        ;
        _.prototype.valueOf = _.prototype.toJSON = _.prototype.value;
        _.prototype.toString = function() {
            return "" + this._wrapped
        }
        ;
        if (typeof define === "function" && define.amd) {
            define("underscore", [], function() {
                return _
            })
        }
    }
)();
define("../submodules/dcgview/src/attr-event-handler", [], function() {
    function AttrEventHandler(evnt, data) {
        if (data === null || data === undefined)
            return;
        if (typeof evnt !== "string") {
            throw new Error("Must pass a string for an EventHandler name")
        }
        if (typeof data !== "function") {
            throw new Error("Must pass a function for an EventHandler callback")
        }
        return {
            bindings: {
                onMount: function(node) {
                    node[evnt.toLowerCase()] = function(evt) {
                        if (evt) {
                            data.apply(this, arguments)
                        } else {}
                    }
                }
            }
        }
    }
    return AttrEventHandler
});
define("../submodules/dcgview/src/const", ["require"], function(require) {
    function makeConst(val) {
        var returnFunction = function() {
            return val
        };
        returnFunction.isDCGViewConst = true;
        return returnFunction
    }
    function isConst(val) {
        if (typeof val === "function" && val.isDCGViewConst) {
            return true
        } else {
            return false
        }
    }
    return {
        isConst: isConst,
        makeConst: makeConst
    }
});
define("../submodules/dcgview/src/attr", ["require"], function(require) {
    function update(node, attr, value) {
        if (value === undefined) {
            node.removeAttribute(attr)
        } else {
            node.setAttribute(attr, value + "")
        }
    }
    return {
        update: update
    }
});
define("../submodules/dcgview/src/attr-generic", ["require", "./const", "./attr"], function(require) {
    var Const = require("./const");
    var Attr = require("./attr");
    function AttrGeneric(attrName, attrValue) {
        var val = attrValue();
        var bindings;
        if (!Const.isConst(attrValue)) {
            bindings = {
                onUpdate: function(node) {
                    var newVal = attrValue();
                    if (newVal === val)
                        return;
                    val = newVal;
                    Attr.update(node, attrName, newVal)
                }
            }
        }
        return {
            value: val,
            bindings: bindings
        }
    }
    return AttrGeneric
});
define("../submodules/dcgview/src/is-event-handler", [], function() {
    function isEventHandler(str) {
        return str[0] === "o" && str[1] === "n" && str[2].toUpperCase() === str[2]
    }
    return isEventHandler
});
define("../submodules/dcgview/src/custom-attributes", ["require"], function(require) {
    var customAttributes = {};
    function add(attrName, handler) {
        customAttributes[attrName] = handler
    }
    function isCustomAttribute(attrName) {
        return customAttributes.hasOwnProperty(attrName)
    }
    function parse(attrName, attrValue) {
        var handler = customAttributes[attrName];
        return handler(attrValue)
    }
    return {
        isCustomAttribute: isCustomAttribute,
        add: add,
        parse: parse
    }
});
define("../submodules/dcgview/src/bindings", ["require"], function(require) {
    function add(view, bindingName, func) {
        var bindings = view._bindings[bindingName];
        if (!bindings) {
            view._bindings[bindingName] = [func]
        } else {
            bindings.push(func)
        }
    }
    function invoke(view, bindingName) {
        var bindings = view._bindings[bindingName];
        if (bindings) {
            var len = bindings.length;
            for (var i = 0; i < len; i++) {
                bindings[i]()
            }
        }
    }
    return {
        add: add,
        invoke: invoke
    }
});
define("../submodules/dcgview/src/warnings", ["require"], function(require) {
    var warningHandlers = [];
    function addWarningHandler(cb) {
        warningHandlers.push(cb)
    }
    function removeWarningHandler(cb) {
        var oldHandlers = warningHandlers;
        warningHandlers = [];
        for (var i = 0; i < oldHandlers.length; i++) {
            var handler = oldHandlers[i];
            if (handler !== cb) {
                warningHandlers.push(handler)
            }
        }
    }
    function warn(msg, parentView) {
        try {
            if (parentView && parentView._isDCGView) {
                msg += " [" + parentView._viewName + "]";
                var viewHierarchy = parentView.traceViewHierarchy();
                if (viewHierarchy.ancestors.length > 0) {
                    msg += "\nView Hierarchy:\n" + viewHierarchy.formatted
                }
            }
            throw new Error(msg)
        } catch (warning) {
            console.warn(warning);
            for (var i = 0; i < warningHandlers.length; i++) {
                warningHandlers[i](warning)
            }
        }
    }
    return {
        warn: warn,
        addWarningHandler: addWarningHandler,
        removeWarningHandler: removeWarningHandler
    }
});
define("../submodules/dcgview/src/bind-attrs", ["require", "./attr-event-handler", "./attr-generic", "./is-event-handler", "./custom-attributes", "./bindings", "./warnings"], function(require) {
    var AttrEventHandler = require("./attr-event-handler");
    var AttrGeneric = require("./attr-generic");
    var isEventHandler = require("./is-event-handler");
    var CustomAttributes = require("./custom-attributes");
    var Bindings = require("./bindings");
    var Warnings = require("./warnings");
    var bindingsToPassNode = {
        onMount: true,
        didMount: true,
        willUnmount: true,
        willUpdate: true,
        onUpdate: true,
        didUpdate: true
    };
    var oneTimeBindings = {
        willMount: true,
        onMount: true,
        didMount: true,
        willUnmount: true,
        onUnmount: true,
        didUnmount: true
    };
    function makeOneTimeBinding(bindingName, func, parentView) {
        var hasBeenCalled = false;
        return function() {
            if (hasBeenCalled) {
                Warnings.warn(bindingName + " is a one-time binding but was called multiple times", parentView);
                return
            }
            hasBeenCalled = true;
            func.apply(this, arguments)
        }
    }
    function buildBindings(parentView, node, attrInfo) {
        var bindingDict = attrInfo.bindings;
        if (bindingDict) {
            for (var bindingName in bindingDict) {
                var invokeFunc = bindingDict[bindingName];
                if (bindingName in bindingsToPassNode) {
                    invokeFunc = invokeFunc.bind(null, node)
                }
                if (bindingName in oneTimeBindings) {
                    invokeFunc = makeOneTimeBinding(bindingName, invokeFunc, parentView)
                }
                Bindings.add(parentView, bindingName, invokeFunc)
            }
        }
    }
    function parseAttr(attrName, attrValue) {
        if (typeof attrValue !== "function") {
            throw new Error('The "' + attrName + '" attr must be a function. It is: ' + JSON.stringify(attrValue))
        }
        if (CustomAttributes.isCustomAttribute(attrName)) {
            return CustomAttributes.parse(attrName, attrValue)
        }
        if (isEventHandler(attrName)) {
            return AttrEventHandler(attrName, attrValue)
        }
        return AttrGeneric(attrName, attrValue)
    }
    function bindAttrs(parentView, attrs, node) {
        if (!attrs)
            return;
        for (var key in attrs) {
            var attrInfo = parseAttr(key, attrs[key]);
            if (attrInfo) {
                var val = attrInfo.value;
                if (val !== undefined) {
                    node.setAttribute(key, val)
                }
                if (attrInfo.bindings) {
                    buildBindings(parentView, node, attrInfo)
                }
            }
        }
    }
    return bindAttrs
});
define("../submodules/dcgview/src/bind-text", ["require", "./bindings"], function(require) {
    var Bindings = require("./bindings");
    var spanWrapping = false;
    function enableSpanWrapping() {
        spanWrapping = true
    }
    function bindText(parentView, docFrag, textFn) {
        if (typeof textFn !== "function") {
            throw new Error("bindText expects a function")
        }
        var prevValue = textFn();
        if (prevValue === undefined || prevValue === null) {
            prevValue = ""
        }
        var textNode = document.createTextNode(prevValue);
        if (spanWrapping) {
            var spanWrapper = document.createElement("span");
            spanWrapper.appendChild(textNode);
            docFrag.appendChild(spanWrapper)
        } else {
            docFrag.appendChild(textNode)
        }
        Bindings.add(parentView, "onUpdate", function() {
            var newValue = textFn();
            if (newValue === undefined || newValue === null) {
                newValue = ""
            }
            if (prevValue === newValue)
                return;
            textNode.nodeValue = newValue;
            prevValue = newValue
        })
    }
    return {
        bindText: bindText,
        enableSpanWrapping: enableSpanWrapping
    }
});
define("../submodules/dcgview/src/dcg-element", ["require", "./bind-attrs", "./bind-text", "./const", "./warnings"], function(require) {
    var bindAttrs = require("./bind-attrs");
    var bindText = require("./bind-text").bindText;
    var Const = require("./const");
    var Warnings = require("./warnings");
    function staticText(docFrag, text) {
        var textNode = document.createTextNode(text);
        docFrag.appendChild(textNode)
    }
    function DCGElement(tagName, attrs, children) {
        this.tagName = tagName;
        this.attrs = attrs;
        this.children = children;
        if (Array.isArray(this.children)) {
            for (var i = 0; i < this.children.length; i++) {
                this.children[i]._parentElement = this
            }
        }
    }
    DCGElement.prototype._isDCGElement = true;
    DCGElement.prototype.renderToDocFrag = function(docFrag, parentView) {
        if (this._domNode) {
            throw new Error("Cannot remount a DCGElement")
        }
        var children = this.children;
        var node = document.createElement(this.tagName);
        this._domNode = node;
        bindAttrs(parentView, this.attrs, node);
        docFrag.appendChild(node);
        var len = children.length;
        for (var i = 0; i < len; i++) {
            var child = children[i];
            if (child._isDCGElement) {
                child.renderToDocFrag(node, parentView)
            } else if (Const.isConst(child)) {
                staticText(node, child())
            } else if (typeof child === "function") {
                bindText(parentView, node, child)
            } else {
                Warnings.warn("Text should be a const or a getter: " + JSON.stringify(child), parentView);
                staticText(node, child)
            }
        }
    }
    ;
    return DCGElement
});
define("../submodules/dcgview/src/create-element", ["require", "./dcg-element"], function(require) {
    var DCGElement = require("./dcg-element");
    function flattenChildren(item, pushTo) {
        if (item !== null && item !== undefined) {
            if (Array.isArray(item)) {
                for (var i = 0; i < item.length; i++) {
                    flattenChildren(item[i], pushTo)
                }
            } else {
                pushTo.push(item)
            }
        }
    }
    function createElement(type, props) {
        var children = [];
        var lastChild = arguments.length - 1;
        for (var i = 2; i <= lastChild; i++) {
            flattenChildren(arguments[i], children)
        }
        if (typeof type === "string") {
            return new DCGElement(type,props,children)
        } else if (type && type._isDCGViewClass) {
            return new type(props,children)
        } else {
            throw new Error("createElement expects a String or DCGViewClass")
        }
    }
    return createElement
});
define("../submodules/dcgview/src/mounting", ["require", "./bindings"], function(require) {
    var Bindings = require("./bindings");
    function findRootNode() {
        var elm = this._element;
        while (elm._isDCGView) {
            elm = elm._element
        }
        return elm._domNode
    }
    function renderToDocFrag(docFrag, parentView) {
        if (parentView) {
            parentView._childViews.push(this)
        }
        if (this.__generatedHTMLBefore) {
            throw new Error("Cannot remount a DCGView")
        }
        this.__generatedHTMLBefore = true;
        this._element.renderToDocFrag(docFrag, this)
    }
    function mountToNode(ViewClass, node, props) {
        if (!ViewClass || !ViewClass._isDCGViewClass) {
            throw new Error("Must pass a DCGView class to be mounted")
        }
        if (!node || node.nodeType !== 1) {
            throw new Error("Must pass an HTMLElement for the node")
        }
        if (node._mountedDCGView) {
            throw new Error("This node is already mounted by a view")
        }
        var view = new ViewClass(props);
        var docFrag = document.createDocumentFragment();
        view.renderToDocFrag(docFrag);
        node.innerHTML = "";
        willMount(view);
        node._mountedDCGView = view;
        node.appendChild(docFrag);
        onMount(view);
        didMount(view);
        return view
    }
    function unmountFromNode(node) {
        var view = node._mountedDCGView;
        if (!view) {
            throw new Error("This node is not mounted by a DCGView")
        }
        willUnmount(view);
        node.innerHTML = "";
        delete node._mountedDCGView;
        onUnmount(view);
        didUnmount(view)
    }
    function willMount(view) {
        if (view.willMount)
            view.willMount();
        Bindings.invoke(view, "willMount");
        view._childViews.forEach(willMount)
    }
    function onMount(view) {
        view._isMounted = true;
        if (view.onMount)
            view.onMount();
        Bindings.invoke(view, "onMount");
        view._childViews.forEach(onMount)
    }
    function didMount(view) {
        if (view.didMount)
            view.didMount();
        Bindings.invoke(view, "didMount");
        view._childViews.forEach(didMount)
    }
    function willUnmount(view) {
        if (view.willUnmount)
            view.willUnmount();
        Bindings.invoke(view, "willUnmount");
        view._childViews.forEach(willUnmount)
    }
    function onUnmount(view) {
        view._isMounted = false;
        view._childViews.forEach(onUnmount);
        Bindings.invoke(view, "onUnmount");
        if (view.onUnmount)
            view.onUnmount()
    }
    function didUnmount(view) {
        view._childViews.forEach(didUnmount);
        Bindings.invoke(view, "didUnmount");
        if (view.didUnmount)
            view.didUnmount()
    }
    function createNodeForView(view, parentView) {
        var docFrag = document.createDocumentFragment();
        view.renderToDocFrag(docFrag, parentView);
        return docFrag.firstChild
    }
    return {
        renderToDocFrag: renderToDocFrag,
        findRootNode: findRootNode,
        createNodeForView: createNodeForView,
        willMount: willMount,
        onMount: onMount,
        didMount: didMount,
        willUnmount: willUnmount,
        onUnmount: onUnmount,
        didUnmount: didUnmount,
        mountToNode: mountToNode,
        unmountFromNode: unmountFromNode
    }
});
define("../submodules/dcgview/src/update", ["require", "./bindings", "./warnings"], function(require) {
    var Bindings = require("./bindings");
    var Warnings = require("./warnings");
    function update() {
        if (!this._isMounted) {
            return Warnings.warn("Trying to update view that is not mounted. Ignoring update.", this)
        }
        if (this.shouldUpdate && !this.shouldUpdate()) {
            return
        }
        if (this.willUpdate)
            this.willUpdate();
        Bindings.invoke(this, "willUpdate");
        Bindings.invoke(this, "onUpdate");
        if (this.onUpdate)
            this.onUpdate();
        if (this.overrideChildUpdates) {
            this.overrideChildUpdates()
        } else {
            var views = this._childViews;
            var len = views.length;
            for (var i = 0; i < len; i++) {
                views[i].update()
            }
        }
        Bindings.invoke(this, "didUpdate");
        if (this.didUpdate)
            this.didUpdate()
    }
    return {
        update: update
    }
});
define("../submodules/dcgview/src/spread", ["require"], function(require) {
    function spread(obj) {
        var length = arguments.length;
        if (length < 2)
            return obj;
        for (var index = 1; index < length; index++) {
            var source = arguments[index]
                , keys = Object.keys(source)
                , l = keys.length;
            for (var i = 0; i < l; i++) {
                var key = keys[i];
                obj[key] = source[key]
            }
        }
        return obj
    }
    return spread
});
define("../submodules/dcgview/src/create-class", ["require", "./create-element", "./mounting", "./update", "./const", "./spread"], function(require) {
    var createElement = require("./create-element");
    var mounting = require("./mounting");
    var update = require("./update");
    var Const = require("./const");
    var spread = require("./spread");
    function createClass(spec) {
        if (!spec) {
            throw new Error("must pass a spec to DCGView.createClass")
        }
        if (typeof spec.template !== "function") {
            throw new Error("must pass a template function to DCGView.createClass")
        }
        var DCGViewClass = function(props, children) {
            this._viewName = spec.viewName || (this.constructor ? this.constructor.name : "Anonymous DCGView");
            this._setupProps(props, children);
            if (this.init)
                this.init();
            this._callTemplate()
        };
        DCGViewClass.prototype._setupProps = function(props, children) {
            if (props) {
                for (var p in props) {
                    var v = props[p];
                    if (typeof v !== "function" && v !== undefined) {
                        throw new Error('The "' + p + '" prop must be a function. It is: ' + JSON.stringify(v))
                    }
                }
                this.props = props
            } else {
                this.props = {}
            }
            this.children = children;
            this._childViews = [];
            this._bindings = {}
        }
        ;
        DCGViewClass.prototype._callTemplate = function() {
            this._element = this.template();
            if (!this._element || !this._element._isDCGElement) {
                throw new Error("template() must return a DCGElement")
            }
            this._element._parentElement = this
        }
        ;
        DCGViewClass.prototype.bindFn = function(fn) {
            return fn.bind(this)
        }
        ;
        DCGViewClass.prototype.findRootNode = mounting.findRootNode;
        DCGViewClass.prototype.renderToDocFrag = mounting.renderToDocFrag;
        DCGViewClass.prototype.const = Const.makeConst;
        DCGViewClass.prototype.spread = spread;
        DCGViewClass.prototype.createElement = createElement;
        DCGViewClass.prototype.update = update.update;
        DCGViewClass.prototype.traceViewHierarchy = function() {
            var ancestors = [];
            for (var view = this._parentElement; !!view; view = view._parentElement) {
                ancestors.unshift(view)
            }
            var formatted = ancestors.concat([this]).filter(function(view) {
                if (!view._isDCGView) {
                    return false
                }
                if (view._isDCGSwitch && view._parentElement && view._parentElement._isDCGIf) {
                    return false
                }
                if (view._isDCGIfDefinedWrapper || view._isDCGSwitchWrapper || view._isDCGSwitchUnionWrapper) {
                    return false
                }
                return true
            }).map(function(view, i) {
                var s = "";
                while (i-- > 0)
                    s += "  ";
                return s + "<" + view._viewName + ">"
            }).join("\n");
            return {
                ancestors: ancestors,
                formatted: formatted
            }
        }
        ;
        for (var i in spec) {
            if (spec.hasOwnProperty(i)) {
                if (!DCGViewClass.prototype.hasOwnProperty(i)) {
                    DCGViewClass.prototype[i] = spec[i]
                } else {
                    throw new Error("Cannot override the " + i + "() method")
                }
            }
        }
        DCGViewClass._isDCGViewClass = true;
        DCGViewClass.prototype._isDCGView = true;
        DCGViewClass.prototype._isDCGElement = true;
        return DCGViewClass
    }
    return createClass
});
define("../submodules/dcgview/src/attr-style", ["require", "./const", "./attr"], function(require) {
    var Const = require("./const");
    var Attr = require("./attr");
    function getterToString(getter) {
        var data = getter();
        var type = typeof data;
        if (type === "string") {
            return data
        } else if (!type || type !== "object") {
            throw new Error("Unsupported type returned from style getter: " + type)
        }
        var str = "";
        for (var prop in data) {
            var val = data[prop];
            if (data.hasOwnProperty(prop)) {
                if (val !== null && val !== undefined) {
                    if (str) {
                        str += ";" + prop + ":" + val
                    } else {
                        str = prop + ":" + val
                    }
                }
            }
        }
        return str
    }
    function AttrStyle(getter) {
        var bindings;
        var prevStyles = getterToString(getter);
        if (!Const.isConst(getter)) {
            bindings = {
                onUpdate: function(node) {
                    var newStyles = getterToString(getter);
                    if (prevStyles === newStyles) {
                        return
                    }
                    Attr.update(node, "style", newStyles);
                    prevStyles = newStyles
                }
            }
        }
        return {
            value: prevStyles,
            bindings: bindings
        }
    }
    return AttrStyle
});
define("../submodules/dcgview/src/attr-class", ["require", "./const"], function(require) {
    var Const = require("./const");
    function getterToString(getter) {
        var data = getter();
        var type = typeof data;
        if (type === "string") {
            return data
        } else if (!type || type !== "object") {
            throw new Error("Unsupported type returned from class getter: " + type)
        }
        var str = "";
        for (var prop in data) {
            if (data.hasOwnProperty(prop)) {
                var val = data[prop];
                if (!!val) {
                    if (str) {
                        str += " " + prop
                    } else {
                        str = prop
                    }
                }
            }
        }
        return str
    }
    var classNameRegex = /^\s+|\s+$/g;
    var multiSpaceRegex = /\s+/;
    function computeMergedClasses(node, prevClasses, newClasses) {
        var externalClasses = [];
        var classList = node.className.replace(classNameRegex, "").split(multiSpaceRegex);
        var internalClassList = prevClasses.replace(classNameRegex, "").split(multiSpaceRegex);
        var internalClassMap = {};
        for (var i = internalClassList.length - 1; i >= 0; i--) {
            internalClassMap[internalClassList[i]] = true
        }
        var len = classList.length;
        for (i = 0; i < len; i++) {
            var cls = classList[i];
            if (!internalClassMap.hasOwnProperty(cls)) {
                externalClasses.push(cls)
            }
        }
        if (newClasses) {
            if (externalClasses.length) {
                return newClasses + " " + externalClasses.join(" ")
            } else {
                return newClasses
            }
        } else {
            return externalClasses.join(" ")
        }
    }
    function AttrClass(getter) {
        var bindings;
        var prevClasses = getterToString(getter);
        if (!Const.isConst(getter)) {
            bindings = {
                onUpdate: function(node) {
                    var newClasses = getterToString(getter);
                    if (prevClasses === newClasses) {
                        return
                    }
                    if (node.className === prevClasses) {
                        node.className = newClasses;
                        prevClasses = newClasses
                    } else {
                        node.className = computeMergedClasses(node, prevClasses, newClasses);
                        prevClasses = newClasses
                    }
                }
            }
        }
        return {
            value: prevClasses,
            bindings: bindings
        }
    }
    return AttrClass
});
define("../submodules/dcgview/src/attr-lifecycle", ["require", "./const"], function(require) {
    var Const = require("./const");
    function AttrLifeCycle(lifeCycleEvent) {
        return function(cb) {
            if (typeof cb !== "function") {
                throw new Error("The " + lifeCycleEvent + " attribute expects a function for the value")
            }
            if (Const.isConst(cb)) {
                throw new Error("The " + lifeCycleEvent + " attribute does not expect a const for the value")
            }
            var attrBindingInfo = {
                bindings: {}
            };
            attrBindingInfo.bindings[lifeCycleEvent] = cb;
            return attrBindingInfo
        }
    }
    return AttrLifeCycle
});
define("../submodules/dcgview/src/longest-subsequence", ["require"], function(require) {
    return function(X) {
        var n = X.length;
        var P = new Array(n);
        var M = new Array(n + 1);
        var L = 0;
        var newL;
        var i;
        for (i = 0; i < n; i++) {
            if (X[M[L]] < X[i]) {
                newL = L + 1
            } else {
                var lo = 1;
                var hi = L - 1;
                while (lo <= hi) {
                    var mid = Math.ceil((lo + hi) / 2);
                    if (X[M[mid]] < X[i]) {
                        lo = mid + 1
                    } else {
                        hi = mid - 1
                    }
                }
                newL = lo
            }
            P[i] = M[newL - 1];
            M[newL] = i;
            if (newL > L) {
                L = newL
            }
        }
        var subsequence = new Array(L);
        var k = M[L];
        for (i = L - 1; i >= 0; i--) {
            subsequence[i] = X[k];
            k = P[k]
        }
        return subsequence
    }
});
define("../submodules/dcgview/src/compute-key-mutations", ["require", "./longest-subsequence"], function(require) {
    var LongestSubsequence = require("./longest-subsequence");
    function computeKeyMutations(oldKeys, newKeys) {
        var newKeyMap = {};
        var i, key;
        var removes = [];
        var inserts = [];
        for (i = 0; i < newKeys.length; i++) {
            key = newKeys[i];
            newKeyMap[key] = i
        }
        for (i = 0; i < oldKeys.length; i++) {
            key = oldKeys[i];
            if (newKeyMap[key] === undefined) {
                removes.push(key)
            }
        }
        var sharedIndices = [];
        for (i = 0; i < oldKeys.length; i++) {
            key = oldKeys[i];
            var newIndex = newKeyMap[key];
            if (newIndex !== undefined) {
                sharedIndices.push(newIndex)
            }
        }
        var unmovedIndices = LongestSubsequence(sharedIndices);
        var unmovedMap = {};
        for (i = 0; i < unmovedIndices.length; i++) {
            key = newKeys[unmovedIndices[i]];
            unmovedMap[key] = true
        }
        for (i = newKeys.length - 1; i >= 0; i--) {
            key = newKeys[i];
            if (unmovedMap[key]) {
                continue
            }
            inserts.push({
                key: key,
                beforeKey: newKeys[i + 1]
            })
        }
        return {
            removes: removes,
            inserts: inserts
        }
    }
    return computeKeyMutations
});
define("../submodules/dcgview/src/for", ["require", "./create-class", "./compute-key-mutations", "./const", "./mounting"], function(require) {
    var createClass = require("./create-class");
    var computeKeyMutations = require("./compute-key-mutations");
    var Const = require("./const");
    var Mounting = require("./mounting");
    var Wrapper = createClass({
        viewName: "ForWrapper",
        template: function() {
            return this.children[0]
        }
    });
    var For = createClass({
        viewName: "For",
        _isDCGFor: true,
        getKeys: function() {
            this._keyToItem = {};
            var items = this.props.each();
            if (!Array.isArray(items)) {
                throw new Error("<For each={}> must return an array")
            }
            var keys = this.props.key ? items.map(this.props.key) : items.slice(0);
            if (!this._chosenKeyType && keys.length) {
                this._chosenKeyType = typeof keys[0];
                if (this._chosenKeyType !== "string" && this._chosenKeyType !== "number") {
                    throw new Error("The key: " + JSON.stringify(keys[0]) + " is not a string or number")
                }
            }
            for (var i = 0; i < keys.length; i++) {
                var key = keys[i];
                if (typeof key !== this._chosenKeyType) {
                    throw new Error("Keys must be the same type. " + JSON.stringify(key) + " is not a " + this._chosenKeyType)
                }
                if (key in this._keyToItem) {
                    throw new Error("The key: " + JSON.stringify(key) + " is not unique")
                }
                this._keyToItem[key] = items[i]
            }
            return keys
        },
        createViewForKey: function(key) {
            var item = this._keyToItem[key];
            var element = this._viewFunction.call(this, item, key);
            var view = element;
            if (!view._isDCGView) {
                view = this.createElement(Wrapper, null, element)
            }
            this._keyToView[key] = view;
            return view
        },
        template: function() {
            this._keyToView = {};
            if (typeof this.props.each !== "function") {
                throw new Error("<For each={}> must be a function")
            }
            if (this.children.length !== 1) {
                throw new Error("<For> expects a single child. You passed " + this.children.length)
            }
            var rootNode = this.children[0];
            if (!rootNode || !rootNode._isDCGElement) {
                throw new Error("<For> expects the root node to be a DCGElement. You passed " + JSON.stringify(rootNode))
            }
            if (rootNode._isDCGView) {
                throw new Error("<For> expects the root node to not be a DCGView. Pass in something like <div> or <span>")
            }
            if (rootNode.children.length !== 1) {
                throw new Error("<For> expects a root node with a single child. You passed " + rootNode.children.length)
            }
            this._viewFunction = rootNode.children[0];
            if (this._viewFunction && this._viewFunction._isDCGElement) {
                throw new Error("<For> expects a function that constructs a DCGElement. You passed a DCGElement directly")
            }
            if (typeof this._viewFunction !== "function") {
                var json = JSON.stringify(this._viewFunction);
                throw new Error("<For> expects a function that constructs a DCGElement. You passed " + json)
            }
            if (Const.isConst(this._viewFunction)) {
                throw new Error("<For> expects a function that constructs a DCGElement. You passed a constant")
            }
            this._keys = this.getKeys();
            var listChildren = [];
            for (var i = 0; i < this._keys.length; i++) {
                var key = this._keys[i];
                var child = this.createViewForKey(key);
                child._parentElement = this;
                listChildren.push(child)
            }
            rootNode.children = listChildren;
            return rootNode
        },
        detachAllRemovedViews: function() {
            var childViews = this._childViews;
            var r = 0;
            var numViews = childViews.length;
            var view;
            for (var i = 0; i < numViews; i++) {
                view = childViews[i];
                if (view._will_be_unmounted_) {
                    r++
                } else {
                    childViews[i - r] = view
                }
            }
            childViews.splice(numViews - r, r)
        },
        overrideChildUpdates: function() {
            var oldKeys = this._keys;
            var newKeys = this.getKeys();
            this._keys = newKeys;
            var rootNode = this.findRootNode();
            var i, view, fromNode, beforeNode, insert, key;
            var mutations = computeKeyMutations(oldKeys, newKeys);
            var removedViews = [];
            for (i = mutations.removes.length - 1; i >= 0; i--) {
                key = mutations.removes[i];
                removedViews.push(this._keyToView[key])
            }
            removedViews.forEach(Mounting.willUnmount);
            for (i = 0; i < mutations.removes.length; i++) {
                key = mutations.removes[i];
                view = this._keyToView[key];
                delete this._keyToView[key];
                view._will_be_unmounted_ = true;
                rootNode.removeChild(view.findRootNode())
            }
            if (removedViews.length > 0) {
                this.detachAllRemovedViews()
            }
            removedViews.forEach(Mounting.onUnmount);
            removedViews.forEach(Mounting.didUnmount);
            var newViews = [];
            for (i = mutations.inserts.length - 1; i >= 0; i--) {
                key = mutations.inserts[i].key;
                if (!(key in this._keyToView)) {
                    view = this.createViewForKey(key);
                    newViews.push(view);
                    Mounting.createNodeForView(view, this)
                }
            }
            newViews.forEach(Mounting.willMount);
            for (i = 0; i < mutations.inserts.length; i++) {
                insert = mutations.inserts[i];
                fromNode = this._keyToView[insert.key].findRootNode();
                if (insert.beforeKey !== undefined) {
                    beforeNode = this._keyToView[insert.beforeKey].findRootNode()
                } else {
                    beforeNode = null
                }
                rootNode.insertBefore(fromNode, beforeNode)
            }
            newViews.forEach(Mounting.onMount);
            newViews.forEach(Mounting.didMount);
            var views = this._childViews;
            var viewsToUpdate = views.length - newViews.length;
            for (i = 0; i < viewsToUpdate; i++) {
                views[i].update()
            }
        }
    });
    return For
});
define("../submodules/dcgview/src/switch", ["require", "./create-class", "./const", "./mounting"], function(require) {
    var createClass = require("./create-class");
    var Const = require("./const");
    var Mounting = require("./mounting");
    var Wrapper = createClass({
        viewName: "SwitchWrapper",
        _isDCGSwitchWrapper: true,
        template: function() {
            return this.children[0]
        }
    });
    var Switch = createClass({
        viewName: "Switch",
        _isDCGSwitch: true,
        updateKey: function() {
            this._key = this.props.key()
        },
        createView: function() {
            var child = this._viewFunction(this._key);
            if (child === null || child === undefined) {
                child = this.createElement("div", {
                    style: this.const("display: none")
                })
            }
            var wrapper = this.createElement(Wrapper, null, child);
            wrapper._parentElement = this;
            return wrapper
        },
        template: function() {
            this._key = undefined;
            if (typeof this.props.key !== "function") {
                throw new Error("<Switch key={}> must be a function")
            }
            if (this.children.length !== 1) {
                throw new Error("<Switch> expects a single child. You passed " + this.children.length)
            }
            this._viewFunction = this.children[0];
            if (this._viewFunction && this._viewFunction._isDCGElement) {
                throw new Error("<Switch> expects a function that constructs a DCGElement. You passed a DCGElement directly")
            }
            if (typeof this._viewFunction !== "function") {
                var json = JSON.stringify(this._viewFunction);
                throw new Error("<Switch> expects a function that constructs a DCGElement. You passed " + json)
            }
            if (Const.isConst(this._viewFunction)) {
                throw new Error("<Switch> expects a function that constructs a DCGElement. You passed a constant")
            }
            this.updateKey();
            return this.createView()
        },
        overrideChildUpdates: function() {
            var oldKey = this._key;
            this.updateKey();
            var newKey = this._key;
            if (oldKey === newKey) {
                this._element.update()
            } else {
                var rootNode = this.findRootNode();
                var placeholderNode = document.createTextNode("");
                rootNode.parentNode.insertBefore(placeholderNode, rootNode);
                Mounting.willUnmount(this._element);
                this._childViews = [];
                rootNode.parentNode.removeChild(rootNode);
                Mounting.onUnmount(this._element);
                Mounting.didUnmount(this._element);
                this._element = this.createView();
                var newNode = Mounting.createNodeForView(this._element, this);
                Mounting.willMount(this._element);
                placeholderNode.parentNode.insertBefore(newNode, placeholderNode);
                placeholderNode.parentNode.removeChild(placeholderNode);
                Mounting.onMount(this._element);
                Mounting.didMount(this._element)
            }
        }
    });
    return Switch
});
define("../submodules/dcgview/src/switch-union", ["require", "./create-class", "./mounting", "./create-element"], function(require) {
    var createClass = require("./create-class");
    var Mounting = require("./mounting");
    var createElement = require("./create-element");
    var Wrapper = createClass({
        viewName: "SwitchUnionWrapper",
        _isDCGSwitchUnionWrapper: true,
        template: function() {
            return this.children[0]
        }
    });
    var SwitchUnionClass = createClass({
        viewName: "SwitchUnion",
        _isDCGSwitchUnion: true,
        updateCase: function() {
            this._case = this.props.getCase()
        },
        createView: function() {
            var child = this.props.buildChildView(this._case);
            if (child === null || child === undefined) {
                child = this.createElement("div", {
                    style: this.const("display: none")
                })
            }
            var wrapper = this.createElement(Wrapper, null, child);
            wrapper._parentElement = this;
            return wrapper
        },
        template: function() {
            this._case = undefined;
            this.updateCase();
            return this.createView()
        },
        overrideChildUpdates: function() {
            var oldCase = this._case;
            this.updateCase();
            var newCase = this._case;
            if (oldCase === newCase) {
                this._element.update()
            } else {
                var rootNode = this.findRootNode();
                var placeholderNode = document.createTextNode("");
                rootNode.parentNode.insertBefore(placeholderNode, rootNode);
                Mounting.willUnmount(this._element);
                this._childViews = [];
                rootNode.parentNode.removeChild(rootNode);
                Mounting.onUnmount(this._element);
                Mounting.didUnmount(this._element);
                this._element = this.createView();
                var newNode = Mounting.createNodeForView(this._element, this);
                Mounting.willMount(this._element);
                placeholderNode.parentNode.insertBefore(newNode, placeholderNode);
                placeholderNode.parentNode.removeChild(placeholderNode);
                Mounting.onMount(this._element);
                Mounting.didMount(this._element)
            }
        }
    });
    function SwitchUnion(property, getter, caseMap) {
        return createElement(SwitchUnionClass, {
            getCase: function() {
                var item = getter();
                if (property) {
                    return item && item[property]
                } else {
                    return item
                }
            },
            buildChildView: function(_case) {
                var fn = caseMap[_case];
                if (fn)
                    return fn(getter)
            }
        })
    }
    function SwitchUnionWrapper(property, getter) {
        if (typeof property === "string") {
            return SwitchUnion.bind(this, property, getter)
        } else {
            return SwitchUnion(undefined, property, getter)
        }
    }
    return SwitchUnionWrapper
});
define("../submodules/dcgview/src/if", ["require", "./create-class", "./const", "./switch"], function(require) {
    var createClass = require("./create-class");
    var Const = require("./const");
    var Switch = require("./switch");
    var If = createClass({
        viewName: "If",
        _isDCGIf: true,
        template: function() {
            if (typeof this.props.predicate !== "function") {
                throw new Error("<If predicate={}> must be a function")
            }
            if (this.children.length !== 1) {
                throw new Error("<If> expects a single child. You passed " + this.children.length)
            }
            this._viewFunction = this.children[0];
            if (this._viewFunction && this._viewFunction._isDCGElement) {
                throw new Error("<If> expects a function that constructs a DCGElement. You passed a DCGElement directly")
            }
            if (typeof this._viewFunction !== "function") {
                var json = JSON.stringify(this._viewFunction);
                throw new Error("<If> expects a function that constructs a DCGElement. You passed " + json)
            }
            if (Const.isConst(this._viewFunction)) {
                throw new Error("<If> expects a function that constructs a DCGElement. You passed a constant")
            }
            var keyFn = function() {
                return !!this.props.predicate()
            }
            .bind(this);
            var viewFn = function(predicate) {
                if (predicate) {
                    return this._viewFunction()
                }
            }
            .bind(this);
            return this.createElement(Switch, {
                key: keyFn
            }, viewFn)
        }
    });
    return If
});
define("../submodules/dcgview/src/if-defined", ["require", "./create-class", "./mounting", "./create-element"], function(require) {
    var createClass = require("./create-class");
    var Mounting = require("./mounting");
    var createElement = require("./create-element");
    var Wrapper = createClass({
        viewName: "IfDefinedWrapper",
        _isDCGIfDefinedWrapper: true,
        template: function() {
            return this.children[0]
        }
    });
    var IfDefinedClass = createClass({
        viewName: "IfDefined",
        _isDCGIfDefined: true,
        updateIsDefined: function() {
            this._isDefined = this.props.isDefined()
        },
        createView: function() {
            var child;
            if (this._isDefined) {
                child = this.props.buildChildView()
            }
            if (child === null || child === undefined) {
                child = this.createElement("div", {
                    style: this.const("display: none")
                })
            }
            var wrapper = this.createElement(Wrapper, null, child);
            wrapper._parentElement = this;
            return wrapper
        },
        template: function() {
            this._isDefined = undefined;
            this.updateIsDefined();
            return this.createView()
        },
        overrideChildUpdates: function() {
            var wasDefined = this._isDefined;
            this.updateIsDefined();
            var nowDefined = this._isDefined;
            if (wasDefined === nowDefined) {
                this._element.update()
            } else {
                var rootNode = this.findRootNode();
                var placeholderNode = document.createTextNode("");
                rootNode.parentNode.insertBefore(placeholderNode, rootNode);
                Mounting.willUnmount(this._element);
                this._childViews = [];
                rootNode.parentNode.removeChild(rootNode);
                Mounting.onUnmount(this._element);
                Mounting.didUnmount(this._element);
                this._element = this.createView();
                var newNode = Mounting.createNodeForView(this._element, this);
                Mounting.willMount(this._element);
                placeholderNode.parentNode.insertBefore(newNode, placeholderNode);
                placeholderNode.parentNode.removeChild(placeholderNode);
                Mounting.onMount(this._element);
                Mounting.didMount(this._element)
            }
        }
    });
    function IfDefined(getter, cb) {
        return createElement(IfDefinedClass, {
            isDefined: function() {
                var item = getter();
                return item != null
            },
            buildChildView: function() {
                return cb(getter)
            }
        })
    }
    return IfDefined
});
define("../submodules/dcgview/src/if-else", ["require", "./switch-union"], function(require) {
    var SwitchUnion = require("./switch-union");
    function IfElse(predicate, caseMap) {
        var view = SwitchUnion(function() {
            return predicate() ? "true" : "false"
        }, caseMap);
        view._viewName = "IfElse";
        return view
    }
    return IfElse
});
define("../submodules/dcgview/src/textarea", ["require", "./create-class", "./spread"], function(require) {
    var createClass = require("./create-class");
    var spread = require("./spread");
    return createClass({
        viewName: "Textarea",
        computeValue: function() {
            var value = this.props.value();
            if (value === null || value === undefined) {
                return ""
            } else {
                return value + ""
            }
        },
        template: function() {
            if (!this.props.value) {
                throw new Error('<Textarea> expects a "value={}" prop')
            }
            if (!this.props.onInput) {
                throw new Error('<Textarea> expects an "onInput={}" prop')
            }
            var attrs = spread({}, this.props, {
                onInput: function(evt) {
                    this.props.onInput(evt.target.value);
                    if (this._isMounted)
                        this.update()
                }
                .bind(this)
            });
            if (this.props.disabled) {
                attrs.disabled = function() {
                    if (this.props.disabled()) {
                        return true
                    } else {
                        return undefined
                    }
                }
                .bind(this)
            }
            delete attrs.value;
            return this.createElement("textarea", attrs, this.const(this.computeValue()))
        },
        didUpdate: function() {
            if (!this.rootDOM) {
                this.rootDOM = this.findRootNode()
            }
            var newValue = this.computeValue();
            if (this.rootDOM.value !== newValue) {
                this.rootDOM.value = newValue
            }
        }
    })
});
define("../submodules/dcgview/src/input", ["require", "./create-class", "./spread"], function(require) {
    var createClass = require("./create-class");
    var spread = require("./spread");
    return createClass({
        viewName: "Input",
        computeValue: function() {
            var value = this.props.value();
            if (value === null || value === undefined) {
                return ""
            } else {
                return value + ""
            }
        },
        template: function() {
            if (!this.props.value) {
                throw new Error('<Input> expects a "value={}" prop')
            }
            if (!this.props.onInput) {
                throw new Error('<Input> expects an "onInput={}" prop')
            }
            var attrs = spread({}, this.props, {
                value: this.const(this.computeValue()),
                onInput: function(evt) {
                    this.props.onInput(evt.target.value);
                    if (this._isMounted)
                        this.update()
                }
                .bind(this)
            });
            if (this.props.onEnterPressed) {
                attrs.onKeypress = function(e) {
                    if (e.which === 13)
                        this.props.onEnterPressed()
                }
                .bind(this)
            }
            if (this.props.disabled) {
                attrs.disabled = function() {
                    if (this.props.disabled()) {
                        return true
                    } else {
                        return undefined
                    }
                }
                .bind(this)
            }
            if (!attrs.hasOwnProperty("tabindex")) {
                attrs.tabindex = function() {
                    if (this.props.disabled && this.props.disabled()) {
                        return "-1"
                    } else {
                        return "0"
                    }
                }
                .bind(this)
            }
            return this.createElement("input", attrs)
        },
        didUpdate: function() {
            if (!this.rootDOM) {
                this.rootDOM = this.findRootNode()
            }
            var newValue = this.computeValue();
            if (this.rootDOM.value !== newValue) {
                this.rootDOM.value = newValue
            }
        }
    })
});
define("../submodules/dcgview/src/checkbox", ["require", "./create-class", "./spread"], function(require) {
    var createClass = require("./create-class");
    var spread = require("./spread");
    return createClass({
        viewName: "Checkbox",
        computeChecked: function() {
            return !!this.props.checked()
        },
        template: function() {
            if (!this.props.checked) {
                throw new Error('<Checkbox> expects a "checked={}" prop')
            }
            if (!this.props.onChange) {
                throw new Error('<Checkbox> expects an "onChange={}" prop')
            }
            var props = spread({}, this.props, {
                type: this.const("checkbox"),
                checked: this.const(this.computeChecked() ? "checked" : undefined),
                onChange: function(evt) {
                    this.props.onChange(evt.target.checked);
                    if (this._isMounted)
                        this.update()
                }
                .bind(this)
            });
            return this.createElement("input", props)
        },
        didUpdate: function() {
            if (!this.rootDOM) {
                this.rootDOM = this.findRootNode()
            }
            var newChecked = this.computeChecked();
            if (this.rootDOM.checked !== newChecked) {
                this.rootDOM.checked = newChecked
            }
        }
    })
});
define("../submodules/dcgview/src/components", ["require", "./for", "./switch", "./switch-union", "./if", "./if-defined", "./if-else", "./textarea", "./input", "./checkbox"], function(require) {
    var For = require("./for");
    var Switch = require("./switch");
    var SwitchUnion = require("./switch-union");
    var If = require("./if");
    var IfDefined = require("./if-defined");
    var IfElse = require("./if-else");
    var Textarea = require("./textarea");
    var Input = require("./input");
    var Checkbox = require("./checkbox");
    return {
        For: For,
        Switch: Switch,
        SwitchUnion: SwitchUnion,
        If: If,
        IfDefined: IfDefined,
        IfElse: IfElse,
        Textarea: Textarea,
        Input: Input,
        Checkbox: Checkbox
    }
});
define("../submodules/dcgview/src/class", ["require", "./create-class"], function(require) {
    var createClass = require("./create-class");
    return createClass({
        template: function() {}
    })
});
define("../submodules/dcgview/src/dcg-view", ["require", "./create-element", "./create-class", "./mounting", "./spread", "./const", "./custom-attributes", "./attr-style", "./attr-class", "./attr-lifecycle", "./components", "./warnings", "./bind-text", "./class"], function(require) {
    var createElement = require("./create-element");
    var createClass = require("./create-class");
    var mounting = require("./mounting");
    var spread = require("./spread");
    var Const = require("./const");
    var CustomAttributes = require("./custom-attributes");
    var AttrStyle = require("./attr-style");
    var AttrClass = require("./attr-class");
    var AttrLifeCycle = require("./attr-lifecycle");
    var Components = require("./components");
    var Warnings = require("./warnings");
    var enableSpanWrapping = require("./bind-text").enableSpanWrapping;
    var Class = require("./class");
    var DCGView = {
        createElement: createElement,
        createClass: createClass,
        mountToNode: mounting.mountToNode,
        unmountFromNode: mounting.unmountFromNode,
        spread: spread,
        const: Const.makeConst,
        isConst: Const.isConst,
        addCustomAttribute: CustomAttributes.add,
        Components: Components,
        addWarningHandler: Warnings.addWarningHandler,
        removeWarningHandler: Warnings.removeWarningHandler,
        enableSpanWrapping: enableSpanWrapping,
        Class: Class
    };
    DCGView.addCustomAttribute("style", AttrStyle);
    DCGView.addCustomAttribute("class", AttrClass);
    DCGView.addCustomAttribute("willMount", AttrLifeCycle("willMount"));
    DCGView.addCustomAttribute("onMount", AttrLifeCycle("onMount"));
    DCGView.addCustomAttribute("didMount", AttrLifeCycle("didMount"));
    DCGView.addCustomAttribute("willUnmount", AttrLifeCycle("willUnmount"));
    DCGView.addCustomAttribute("onUnmount", AttrLifeCycle("onUnmount"));
    DCGView.addCustomAttribute("didUnmount", AttrLifeCycle("didUnmount"));
    DCGView.addCustomAttribute("willUpdate", AttrLifeCycle("willUpdate"));
    DCGView.addCustomAttribute("onUpdate", AttrLifeCycle("onUpdate"));
    DCGView.addCustomAttribute("didUpdate", AttrLifeCycle("didUpdate"));
    return DCGView
});
define("../submodules/dcgview/dcgview", ["require", "./src/dcg-view"], function(require) {
    return require("./src/dcg-view")
});
define("text", ["module"], function(module) {
    "use strict";
    var text, fs, Cc, Ci, progIds = ["Msxml2.XMLHTTP", "Microsoft.XMLHTTP", "Msxml2.XMLHTTP.4.0"], xmlRegExp = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im, bodyRegExp = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im, hasLocation = typeof location !== "undefined" && location.href, defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\:/, ""), defaultHostName = hasLocation && location.hostname, defaultPort = hasLocation && (location.port || undefined), buildMap = {}, masterConfig = module.config && module.config() || {};
    text = {
        version: "2.0.7",
        strip: function(content) {
            if (content) {
                content = content.replace(xmlRegExp, "");
                var matches = content.match(bodyRegExp);
                if (matches) {
                    content = matches[1]
                }
            } else {
                content = ""
            }
            return content
        },
        jsEscape: function(content) {
            return content.replace(/(['\\])/g, "\\$1").replace(/[\f]/g, "\\f").replace(/[\b]/g, "\\b").replace(/[\n]/g, "\\n").replace(/[\t]/g, "\\t").replace(/[\r]/g, "\\r").replace(/[\u2028]/g, "\\u2028").replace(/[\u2029]/g, "\\u2029")
        },
        createXhr: masterConfig.createXhr || function() {
            var xhr, i, progId;
            if (typeof XMLHttpRequest !== "undefined") {
                return new XMLHttpRequest
            } else if (typeof ActiveXObject !== "undefined") {
                for (i = 0; i < 3; i += 1) {
                    progId = progIds[i];
                    try {
                        xhr = new ActiveXObject(progId)
                    } catch (e) {}
                    if (xhr) {
                        progIds = [progId];
                        break
                    }
                }
            }
            return xhr
        }
        ,
        parseName: function(name) {
            var modName, ext, temp, strip = false, index = name.indexOf("."), isRelative = name.indexOf("./") === 0 || name.indexOf("../") === 0;
            if (index !== -1 && (!isRelative || index > 1)) {
                modName = name.substring(0, index);
                ext = name.substring(index + 1, name.length)
            } else {
                modName = name
            }
            temp = ext || modName;
            index = temp.indexOf("!");
            if (index !== -1) {
                strip = temp.substring(index + 1) === "strip";
                temp = temp.substring(0, index);
                if (ext) {
                    ext = temp
                } else {
                    modName = temp
                }
            }
            return {
                moduleName: modName,
                ext: ext,
                strip: strip
            }
        },
        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,
        useXhr: function(url, protocol, hostname, port) {
            var uProtocol, uHostName, uPort, match = text.xdRegExp.exec(url);
            if (!match) {
                return true
            }
            uProtocol = match[2];
            uHostName = match[3];
            uHostName = uHostName.split(":");
            uPort = uHostName[1];
            uHostName = uHostName[0];
            return (!uProtocol || uProtocol === protocol) && (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) && (!uPort && !uHostName || uPort === port)
        },
        finishLoad: function(name, strip, content, onLoad) {
            content = strip ? text.strip(content) : content;
            if (masterConfig.isBuild) {
                buildMap[name] = content
            }
            onLoad(content)
        },
        load: function(name, req, onLoad, config) {
            if (config.isBuild && !config.inlineText) {
                onLoad();
                return
            }
            masterConfig.isBuild = config.isBuild;
            var parsed = text.parseName(name)
                , nonStripName = parsed.moduleName + (parsed.ext ? "." + parsed.ext : "")
                , url = req.toUrl(nonStripName)
                , useXhr = masterConfig.useXhr || text.useXhr;
            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {
                text.get(url, function(content) {
                    text.finishLoad(name, parsed.strip, content, onLoad)
                }, function(err) {
                    if (onLoad.error) {
                        onLoad.error(err)
                    }
                })
            } else {
                req([nonStripName], function(content) {
                    text.finishLoad(parsed.moduleName + "." + parsed.ext, parsed.strip, content, onLoad)
                })
            }
        },
        write: function(pluginName, moduleName, write, config) {
            if (buildMap.hasOwnProperty(moduleName)) {
                var content = text.jsEscape(buildMap[moduleName]);
                write.asModule(pluginName + "!" + moduleName, "define(function () { return '" + content + "';});\n")
            }
        },
        writeFile: function(pluginName, moduleName, req, write, config) {
            var parsed = text.parseName(moduleName)
                , extPart = parsed.ext ? "." + parsed.ext : ""
                , nonStripName = parsed.moduleName + extPart
                , fileName = req.toUrl(parsed.moduleName + extPart) + ".js";
            text.load(nonStripName, req, function(value) {
                var textWrite = function(contents) {
                    return write(fileName, contents)
                };
                textWrite.asModule = function(moduleName, contents) {
                    return write.asModule(moduleName, fileName, contents)
                }
                ;
                text.write(pluginName, nonStripName, textWrite, config)
            }, config)
        }
    };
    if (masterConfig.env === "node" || !masterConfig.env && typeof process !== "undefined" && process.versions && !!process.versions.node) {
        fs = require.nodeRequire("fs");
        text.get = function(url, callback, errback) {
            try {
                var file = fs.readFileSync(url, "utf8");
                if (file.indexOf("\ufeff") === 0) {
                    file = file.substring(1)
                }
                callback(file)
            } catch (e) {
                errback(e)
            }
        }
    } else if (masterConfig.env === "xhr" || !masterConfig.env && text.createXhr()) {
        text.get = function(url, callback, errback, headers) {
            var xhr = text.createXhr(), header;
            xhr.open("GET", url, true);
            if (headers) {
                for (header in headers) {
                    if (headers.hasOwnProperty(header)) {
                        xhr.setRequestHeader(header.toLowerCase(), headers[header])
                    }
                }
            }
            if (masterConfig.onXhr) {
                masterConfig.onXhr(xhr, url)
            }
            xhr.onreadystatechange = function(evt) {
                var status, err;
                if (xhr.readyState === 4) {
                    status = xhr.status;
                    if (status > 399 && status < 600) {
                        err = new Error(url + " HTTP status: " + status);
                        err.xhr = xhr;
                        errback(err)
                    } else {
                        callback(xhr.responseText)
                    }
                    if (masterConfig.onXhrComplete) {
                        masterConfig.onXhrComplete(xhr, url)
                    }
                }
            }
            ;
            xhr.send(null)
        }
    } else if (masterConfig.env === "rhino" || !masterConfig.env && typeof Packages !== "undefined" && typeof java !== "undefined") {
        text.get = function(url, callback) {
            var stringBuffer, line, encoding = "utf-8", file = new java.io.File(url), lineSeparator = java.lang.System.getProperty("line.separator"), input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file),encoding)), content = "";
            try {
                stringBuffer = new java.lang.StringBuffer;
                line = input.readLine();
                if (line && line.length() && line.charAt(0) === 65279) {
                    line = line.substring(1)
                }
                if (line !== null) {
                    stringBuffer.append(line)
                }
                while ((line = input.readLine()) !== null) {
                    stringBuffer.append(lineSeparator);
                    stringBuffer.append(line)
                }
                content = String(stringBuffer.toString())
            } finally {
                input.close()
            }
            callback(content)
        }
    } else if (masterConfig.env === "xpconnect" || !masterConfig.env && typeof Components !== "undefined" && Components.classes && Components.interfaces) {
        Cc = Components.classes,
            Ci = Components.interfaces;
        Components.utils["import"]("resource://gre/modules/FileUtils.jsm");
        text.get = function(url, callback) {
            var inStream, convertStream, readData = {}, fileObj = new FileUtils.File(url);
            try {
                inStream = Cc["@mozilla.org/network/file-input-stream;1"].createInstance(Ci.nsIFileInputStream);
                inStream.init(fileObj, 1, 0, false);
                convertStream = Cc["@mozilla.org/intl/converter-input-stream;1"].createInstance(Ci.nsIConverterInputStream);
                convertStream.init(inStream, "utf-8", inStream.available(), Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);
                convertStream.readString(inStream.available(), readData);
                convertStream.close();
                inStream.close();
                callback(readData.value)
            } catch (e) {
                throw new Error((fileObj && fileObj.path || "") + ": " + e)
            }
        }
    }
    return text
});
define("lib/inject-css", ["require", "underscore"], function(require) {
    var _ = require("underscore");
    var styleNodes = {};
    var sortedFilenames = [];
    function injectCSS(filename, css) {
        var styleNode = styleNodes[filename];
        if (!styleNode) {
            styleNode = document.createElement("style");
            styleNodes[filename] = styleNode;
            var index = _.sortedIndex(sortedFilenames, filename);
            var nextNode = styleNodes[sortedFilenames[index]];
            if (nextNode) {
                document.head.insertBefore(styleNode, nextNode)
            } else {
                document.head.appendChild(styleNode)
            }
            sortedFilenames.splice(index, 0, filename)
        }
        styleNode.textContent = css
    }
    return injectCSS
});
define("lib/parse-query-params", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.getQueryParams = function(loc) {
        var query = "";
        if (loc) {
            query = loc.search
        } else if (typeof location !== "undefined") {
            query = location.search
        }
        if (query[0] == "?")
            query = query.slice(1);
        var paramStrings = query.split("&");
        var queryParams = {};
        for (var _i = 0, paramStrings_1 = paramStrings; _i < paramStrings_1.length; _i++) {
            var paramString = paramStrings_1[_i];
            var pair = paramString.split("=");
            if (pair.length == 2) {
                queryParams[pair[0]] = decodeURIComponent(pair[1])
            } else {
                queryParams[pair[0]] = true
            }
        }
        return queryParams
    }
});
define("vendor/css", {});
define("lib/prefix-css", ["require", "vendor/css"], function(require) {
    "use strict";
    var css = require("vendor/css");
    function prefixCSS(cssString, prefix) {
        if (prefix) {
            return prefixSelectors(cssString, prefix)
        } else {
            return cssString
        }
    }
    function prefixSelectors(cssString, prefix) {
        var ast = css.parse(cssString);
        var transformed = Object.assign({}, ast, {
            stylesheet: transformStylesheet(ast.stylesheet, prefix)
        });
        return css.stringify(transformed)
    }
    function transformStylesheet(stylesheet, prefix) {
        return Object.assign({}, stylesheet, {
            rules: transformRules(stylesheet.rules, prefix)
        })
    }
    function transformRules(rules, prefix) {
        return rules.map(function(rule) {
            if (rule.rules)
                return Object.assign({}, rule, {
                    rules: transformRules(rule.rules, prefix)
                });
            if (rule.selectors)
                return Object.assign({}, rule, {
                    selectors: transformSelectors(rule.selectors, prefix)
                });
            return rule
        })
    }
    function transformSelectors(selectors, prefix) {
        var out = [];
        for (var i = 0; i < selectors.length; i++) {
            var selector = selectors[i];
            if (selector === "html") {
                out.push(selector)
            } else if (/dcg(-mq)?-aria-alert/.test(selector)) {
                out.push(selector)
            } else if (/^html body( |$)/.test(selector)) {
                out.push("html" + prefix + " body" + selector.slice("html body".length));
                out.push("html body " + prefix + selector.slice("html body".length))
            } else if (/^html/.test(selector)) {
                throw new Error("Cannot correctly prefix selector " + selector)
            } else if (selector.indexOf(prefix) === -1 && selector.indexOf(".tipsy") !== 0) {
                out.push(prefix + " " + selector)
            } else {
                out.push(selector)
            }
        }
        return out
    }
    return prefixCSS
});
define("loadcss", ["text", "lib/inject-css", "lib/parse-query-params", "lib/prefix-css"], function(text, injectCSS, parseQueryParams, prefixCSS) {
    var moduleMap = {};
    function appendSourceURL(filename, css) {
        absURL = document.location.protocol + "//" + document.location.host + filename;
        return css + "\n/*# sourceURL=" + absURL + "*/"
    }
    var reloadCSSFilter = parseQueryParams.getQueryParams()["reloadcss"];
    var shouldWatchCSSFile = function() {
        return false
    };
    if (reloadCSSFilter) {
        shouldWatchCSSFile = function(fileName) {
            if (reloadCSSFilter === true)
                return true;
            return fileName.indexOf(reloadCSSFilter) !== -1
        }
    }
    return {
        load: function(name, req, onLoad, config) {
            var filename = req.toUrl(name) + ".css";
            if (config.isBuild) {
                text.get(filename, function(css_source) {
                    if (config.apiCssPrefix) {
                        css_source = prefixCSS(css_source, config.apiCssPrefix)
                    }
                    moduleMap[name] = {
                        css: css_source,
                        filename: filename
                    };
                    onLoad()
                }, function(err) {
                    console.log(err)
                })
            } else {
                text.get(filename, function(css_source) {
                    injectCSS(filename, appendSourceURL(filename, css_source));
                    onLoad();
                    if (shouldWatchCSSFile(filename)) {
                        requirejs(["lib/ajaxmanager"], function(AjaxManager) {
                            (new AjaxManager.AjaxManager).GET(filename, {
                                poll: 1e3
                            }).progress(function(new_css_source) {
                                if (css_source !== new_css_source) {
                                    css_source = new_css_source;
                                    injectCSS(filename, appendSourceURL(filename, css_source))
                                }
                            })
                        })
                    }
                }, function(err) {
                    console.log(err)
                })
            }
        },
        write: function(pluginName, moduleName, write) {
            if (moduleName in moduleMap) {
                var module = moduleMap[moduleName];
                encodedCSS = encodeURIComponent(module.css);
                write("define('" + pluginName + "!" + moduleName + "', ['lib/inject-css'], function(injectCSS) {");
                write('  injectCSS("' + module.filename + '", decodeURIComponent("' + encodedCSS + '"));');
                write("});")
            } else {
                console.log("ERROR - failed to find css " + moduleName + " in buildMap")
            }
        }
    }
});
define("loadcss!dcgview", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/lib/dcgview-shim.css", decodeURIComponent("%5Bontap%5D%20%7B%0A%20%20cursor%3A%20pointer%3B%0A%7D%0A"))
});
define("core/lib/log", ["require", "exports", "tslib"], function(require, exports, tslib_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _warn;
    var _err;
    var _log;
    function init(warn, err, log) {
        _warn = warn;
        _err = err;
        _log = log
    }
    exports.init = init;
    function warn(errorName, message) {
        if (_warn) {
            _warn(errorName, message)
        }
    }
    exports.warn = warn;
    function err(errorName, message) {
        if (_err) {
            _err(errorName, message)
        }
    }
    exports.err = err;
    function log(message) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i]
        }
        if (_log) {
            _log.apply(void 0, tslib_1.__spreadArrays([message], args))
        }
    }
    exports.log = log
});
define("bugsnag", ["require", "exports", "tslib", "underscore", "core/lib/log"], function(require, exports, tslib_1, _, log_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var LocalBugsnag = function() {
        function LocalBugsnag() {
            this.subscriptions = {}
        }
        LocalBugsnag.prototype.notify = function(error) {
            for (var token in this.subscriptions) {
                this.subscriptions[token](error)
            }
        }
        ;
        LocalBugsnag.prototype.leaveBreadcrumb = function() {}
        ;
        LocalBugsnag.prototype.subscribe = function(cb) {
            var token = _.uniqueId("local_bugsnag_");
            this.subscriptions[token] = cb;
            return token
        }
        ;
        LocalBugsnag.prototype.unsubscribe = function(token) {
            if (this.subscriptions[token]) {
                delete this.subscriptions[token]
            } else {
                throw new Error("There is no subscription for token " + token + ".")
            }
        }
        ;
        return LocalBugsnag
    }();
    exports.LocalBugsnag = LocalBugsnag;
    var global = typeof self !== "undefined" ? self : {};
    exports.Bugsnag = global.Bugsnag || new LocalBugsnag;
    log_1.init(function(errorName, message) {
        exports.Bugsnag.notify({
            name: errorName,
            message: message
        }, {
            severity: "warning"
        })
    }, function(errorName, message) {
        exports.Bugsnag.notify({
            name: errorName,
            message: message
        })
    }, function(message) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i]
        }
        return console.log.apply(console, tslib_1.__spreadArrays([message], args))
    })
});
define("lib/urlparser", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function getParameter(input, name) {
        var re = new RegExp("[?|&]" + name + "=" + "([^&;]+?)(&|#|;|$)");
        var execArray = re.exec(input);
        if (!execArray)
            return null;
        return decodeURIComponent(execArray[1].replace(/\+/g, "%20"))
    }
    exports.getParameter = getParameter;
    function hasParameter(input, name) {
        var re = new RegExp("[?|&]" + name + "(=|&|;|$)");
        return re.test(input)
    }
    exports.hasParameter = hasParameter;
    function pushParameter(input, name, value) {
        if (name !== encodeURIComponent(name)) {
            throw new Error("Programming error: parameter name should be URL-safe without encoding.")
        }
        var encodedValue = encodeURIComponent(value);
        if (input.length) {
            return /\?/.test(input) ? input + "&" + name + "=" + encodedValue : input + "?" + name + "=" + encodedValue
        } else {
            return "?" + name + "=" + encodedValue
        }
    }
    exports.pushParameter = pushParameter;
    function replaceParameter(input, name, value) {
        var re = new RegExp("([?|&])" + name + "=" + "([^&;]+?)(&|#|;|$)");
        var execArray = re.exec(input);
        if (!execArray)
            return input;
        var separator = execArray[1];
        var currentValue = execArray[2];
        var currentString = "" + separator + name + "=" + currentValue;
        var encodedValue = encodeURIComponent(value);
        var newString = "" + separator + name + "=" + encodedValue;
        return input.replace(currentString, newString)
    }
    exports.replaceParameter = replaceParameter;
    function deleteParameter(input, name) {
        var re = new RegExp("([?|&])" + name + "=" + "([^&;]+?)(&|#|;|$)");
        var execArray = re.exec(input);
        if (!execArray)
            return input;
        var separator = execArray[1];
        var currentValue = execArray[2];
        var currentString = "" + separator + name + "=" + currentValue;
        var out = input.replace(currentString, "");
        if (out[0] === "&")
            return out.replace("&", "?");
        return out
    }
    exports.deleteParameter = deleteParameter;
    function setParameter(input, name, value) {
        if (hasParameter(input, name)) {
            return replaceParameter(input, name, value)
        } else {
            return pushParameter(input, name, value)
        }
    }
    exports.setParameter = setParameter
});
define("shared-types", ["require", "exports", "tslib"], function(require, exports, tslib_1) {
    "use strict";
    var _a;
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.SUBSCRIPTIONS = ["digest", "teacherUpdate"];
    exports.ACCOUNT_STATUS_MAP = {
        ENABLED: true,
        DISABLED: true,
        PENDING_DELETION: true,
        BEING_DELETED: true,
        DISABLED_BY_PARTNER: true
    };
    exports.RESPONSE_LIMIT = 1e4;
    function isGooglePostOption(option) {
        return typeof option === "string" && ["post", "draft", "none"].indexOf(option) !== -1
    }
    exports.isGooglePostOption = isGooglePostOption;
    function isDesmosPostOption(option) {
        return typeof option === "string" && ["post", "none"].indexOf(option) !== -1
    }
    exports.isDesmosPostOption = isDesmosPostOption;
    exports.MAX_ACTIVITY_LIST_SIZE = 400;
    function migrateLegacyTeacherTips(step) {
        if (step.text) {
            var copy = tslib_1.__assign(tslib_1.__assign({}, step), {
                teacherTips: {
                    "teacher-moves": step.text
                }
            });
            delete copy.text;
            return copy
        } else {
            return tslib_1.__assign(tslib_1.__assign({}, step), {
                teacherTips: step.teacherTips || {}
            })
        }
    }
    exports.migrateLegacyTeacherTips = migrateLegacyTeacherTips;
    exports.CODE_LENGTH = 6;
    function isCodeError(str) {
        return typeof str == "string" && (str == "Invalid" || str == "Expired")
    }
    exports.isCodeError = isCodeError;
    exports.productIdMap = {
        "cpm-cc1": true,
        "cpm-cc2": true,
        "cpm-cc3": true,
        "engageny-6": true,
        "engageny-7": true,
        "engageny-8": true,
        "eureka-pilot-7": true,
        "eureka-pilot-8": true,
        "im-pilot": true,
        desmos: true
    };
    exports.supportedLanguagesMap = {
        en: {
            code: "en",
            display_name: "English (US)",
            english_name: "English (US)"
        },
        es: {
            code: "es",
            display_name: "Espaol (LATAM)",
            english_name: "Spanish (LATAM)",
            learn_pages: ["activities-get-started", "distance-learning", "translations"]
        },
        et: {
            code: "et",
            display_name: "Eesti",
            english_name: "Estonian",
            learn_pages: ["activities-get-started", "distance-learning", "translations"]
        },
        fr: {
            code: "fr",
            display_name: "Franais",
            english_name: "French",
            learn_pages: ["activities-get-started", "distance-learning", "translations"]
        },
        it: {
            code: "it",
            display_name: "Italiano",
            english_name: "Italian",
            learn_pages: ["activities-get-started", "distance-learning", "translations"]
        },
        ko: {
            code: "ko",
            display_name: "",
            english_name: "Korean",
            learn_pages: ["activities-get-started", "distance-learning", "translations"]
        },
        nl: {
            code: "nl",
            display_name: "Nederlands",
            english_name: "Dutch",
            learn_pages: ["activities-get-started", "distance-learning", "translations"]
        },
        ru: {
            code: "ru",
            display_name: "P",
            english_name: "Russian",
            learn_pages: ["activities-get-started", "distance-learning", "translations"]
        },
        "zh-CN": {
            code: "zh-CN",
            display_name: "",
            english_name: "Chinese",
            learn_pages: ["activities-get-started", "distance-learning", "translations"]
        }
    };
    function isSupportedLanguage(lang) {
        return !!exports.supportedLanguagesMap[lang]
    }
    exports.isSupportedLanguage = isSupportedLanguage;
    exports.BOOK_7 = "5e751d50d64f7d389f41567d";
    exports.BOOK_8 = "5e751d63d64f7d389f41567e";
    exports.BOOK_ID_MAP = (_a = {},
        _a[exports.BOOK_7] = true,
        _a[exports.BOOK_8] = true,
        _a.test = true,
        _a);
    function isValidBookId(bookId) {
        return !!exports.BOOK_ID_MAP[bookId]
    }
    exports.isValidBookId = isValidBookId;
    exports.BOOK_ID_LIST = ["test", exports.BOOK_7, exports.BOOK_8];
    function isCollectionSectionDivider(a) {
        return typeof a !== "string" && a.type === "collection-section-divider"
    }
    exports.isCollectionSectionDivider = isCollectionSectionDivider;
    function isSubcollection(a) {
        return typeof a !== "string" && a.type === "subcollection"
    }
    exports.isSubcollection = isSubcollection;
    exports.DB_SAMPLE_COLLECTION = "5ecea574c2b0040c1981d5a4";
    exports.STARTER_SCREENS_MAP = {
        en: "5e715a2dc59e631cf6962db1",
        es: "5e878220cdca2b0b2911cf60",
        fr: "5e8fabe28bf7f67dc24a2c78",
        ru: "5e7e7f1c03d4f25aa1ff4539",
        "zh-CN": "5e977584f8b7500730ef2a29",
        it: "5ea89aa6f314270c66ae4649"
    }
});
define("lib/retain-lang", ["require", "exports", "./parse-query-params", "./urlparser", "../shared-types"], function(require, exports, parse_query_params_1, urlparser_1, shared_types_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var reHasLang = /lang=[A-Za-z]+/;
    var reUnsupportedSubdomain = /(cl|support).desmos.com/;
    var reGetDomain = /^(?:https?:)?(?:\/\/)?([^\s\/\?]+)/i;
    var reDomainDesmos = /((^|\.)desmos\.com($|:))/;
    function domainNotDesmos(url) {
        var res = reGetDomain.exec(url);
        if (res) {
            var domain = res[1];
            return !reDomainDesmos.test(domain)
        }
        return false
    }
    exports.domainNotDesmos = domainNotDesmos;
    function getLang() {
        var lang = "";
        if (typeof window !== "undefined" && window.location && window.location.search) {
            var queryParams = parse_query_params_1.getQueryParams();
            lang = queryParams.lang ? "" + queryParams.lang : ""
        }
        return lang
    }
    function retainLang(originalURL, forcedLang) {
        var lang = forcedLang ? forcedLang : getLang();
        if (originalURL === "" || lang === "" || reHasLang.test(originalURL) || reUnsupportedSubdomain.test(originalURL) || domainNotDesmos(originalURL)) {
            return originalURL
        }
        if (/learn.desmos.com/.test(originalURL)) {
            return retainLangForLearnPage(originalURL, lang)
        }
        return urlparser_1.setParameter(originalURL, "lang", lang)
    }
    exports.retainLang = retainLang;
    function retainLangForLearnPage(originalURL, lang) {
        var langDetails = shared_types_1.supportedLanguagesMap[lang];
        if (langDetails && langDetails.learn_pages) {
            for (var _i = 0, _a = langDetails.learn_pages; _i < _a.length; _i++) {
                var page = _a[_i];
                var reLearnPageNoLang = new RegExp("^.*//learn.desmos.com/" + page + "(?=$|/)");
                var res = reLearnPageNoLang.exec(originalURL);
                if (res) {
                    var trailingSlash = originalURL[originalURL.length - 1] === "/" ? "/" : "";
                    return res[0] + "-" + lang.toLowerCase() + trailingSlash
                }
            }
        }
        return originalURL
    }
});
define("core/lib/copydata", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function copydata(data) {
        if (data === undefined) {
            return undefined
        }
        return JSON.parse(JSON.stringify(data))
    }
    exports.copydata = copydata
});
define("shared/models/frontend-version", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.FRONTEND_VERSION = 1
});
define("lib/ajaxmanager", ["require", "exports", "core/lib/copydata", "jquery", "underscore", "shared/models/frontend-version", "lib/parse-query-params"], function(require, exports, copydata_1, $, _, frontend_version_1, parse_query_params_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var params;
    try {
        params = parse_query_params_1.getQueryParams(top.location)
    } catch (e) {
        params = {}
    }
    var DEBUG_LOG = !!params["debuglog"];
    var DEFAULT_TIMEOUT_MS = 30 * 1e3;
    var AjaxManager = function() {
        function AjaxManager() {
            this._requests = []
        }
        AjaxManager.prototype.findRequestByKey = function(key) {
            if (!key) {
                return
            }
            return _.findWhere(this._requests, {
                key: key
            })
        }
        ;
        AjaxManager.prototype.hasOpenRequests = function() {
            return this._requests.length > 0
        }
        ;
        AjaxManager.prototype.abortOpenRequests = function() {
            this._requests.slice().map(function(request) {
                return request.abort()
            })
        }
        ;
        AjaxManager.prototype.poll = function(key) {
            var request = this.findRequestByKey(key);
            if (request && request.poll) {
                request.poll()
            }
        }
        ;
        AjaxManager.prototype.abort = function(key) {
            var request = this.findRequestByKey(key);
            if (request) {
                request.abort()
            }
        }
        ;
        AjaxManager.prototype.rejectPolling = function(key, data) {
            var request = this.findRequestByKey(key);
            if (request) {
                request.reject(data)
            }
        }
        ;
        AjaxManager.prototype.resolvePolling = function(key, data) {
            var request = this.findRequestByKey(key);
            if (request) {
                request.resolve(data)
            }
        }
        ;
        AjaxManager.prototype.GET = function(url, options, body) {
            return this.ajax({
                type: "GET",
                url: url,
                data: copydata_1.copydata(body)
            }, options)
        }
        ;
        AjaxManager.prototype.DELETE = function(url, options, body) {
            return this.ajax({
                type: "DELETE",
                url: url,
                data: copydata_1.copydata(body)
            }, options)
        }
        ;
        AjaxManager.prototype.JSON = function(url, options, body) {
            return this.ajax({
                type: "POST",
                contentType: "application/json",
                url: url,
                data: JSON.stringify(body || {})
            }, options)
        }
        ;
        AjaxManager.prototype.ajax = function(params, options) {
            var _this = this;
            if (options && options.key) {
                var inFlightRequest = this.findRequestByKey(options.key);
                if (inFlightRequest != null) {
                    return inFlightRequest.promiseObj
                }
            }
            var pollTime = options && options.poll;
            var retryTime = options && options.retry;
            var retries = 0;
            var deferred = $.Deferred();
            deferred.promiseObj = deferred.promise();
            deferred.key = options && options.key;
            var sendTimeout;
            var queuedSend = false;
            var currentAjax;
            var aborted = false;
            this._addToRequests(deferred);
            deferred.always(function() {
                _this._removeFromRequests(deferred)
            });
            deferred.abort = function() {
                clearTimeout(sendTimeout);
                queuedSend = false;
                aborted = true;
                if (currentAjax) {
                    currentAjax.abort()
                }
                _this._removeFromRequests(deferred)
            }
            ;
            if (pollTime) {
                deferred.poll = function() {
                    clearTimeout(sendTimeout);
                    send()
                }
            }
            var send = function() {
                var _a, _b;
                var p;
                if (aborted) {
                    return
                }
                if (deferred.state() !== "pending") {
                    return
                }
                if (currentAjax) {
                    queuedSend = true;
                    return
                }
                if (typeof params === "string") {
                    p = {
                        url: params
                    }
                } else {
                    p = params
                }
                p.timeout = (_b = (_a = options) === null || _a === void 0 ? void 0 : _a.timeoutMs,
                    _b !== null && _b !== void 0 ? _b : DEFAULT_TIMEOUT_MS);
                if (p.url && p.url[0] === "/") {
                    _.extend(p, {
                        headers: {
                            "pillow-frontend-version": frontend_version_1.FRONTEND_VERSION
                        }
                    })
                }
                if (DEBUG_LOG) {
                    console.log("AjaxManager " + (p.type || "GET") + " " + p.url + ": " + p.data)
                }
                currentAjax = $.ajax(p);
                currentAjax.always(function() {
                    if (aborted) {
                        return
                    }
                    currentAjax = undefined
                }).fail(function(raw_resp, _statusText) {
                    var _a, _b, _c, _d;
                    var resp;
                    if (aborted) {
                        return
                    }
                    var status = (_c = (_b = (_a = raw_resp) === null || _a === void 0 ? void 0 : _a.status) === null || _b === void 0 ? void 0 : _b.toString(),
                        _c !== null && _c !== void 0 ? _c : "");
                    try {
                        resp = JSON.parse(raw_resp.responseText)
                    } catch (error) {
                        resp = ((_d = raw_resp) === null || _d === void 0 ? void 0 : _d.responseText) || "Unknown Error (status: " + status + ")"
                    }
                    deferred.notify(resp);
                    if (deferred.state() === "pending") {
                        if (queuedSend) {
                            queuedSend = false;
                            send()
                        } else if (retryTime && (status === "0" || status[0] === "5" || status === "408")) {
                            var backOffFactor = Math.pow(2, retries);
                            retries += 1;
                            sendTimeout = setTimeout(send, backOffFactor * retryTime)
                        } else if (pollTime) {
                            sendTimeout = setTimeout(send, pollTime)
                        } else {
                            if (DEBUG_LOG) {
                                console.log("AjaxManager " + p.url + " reject " + status + ": " + resp)
                            }
                            deferred.reject(resp, raw_resp)
                        }
                    }
                }).done(function(resp, textStatus, jqXhr) {
                    if (aborted) {
                        return
                    }
                    if (DEBUG_LOG && pollTime) {
                        console.log("AjaxManager " + p.url + " notify " + JSON.stringify(resp))
                    }
                    deferred.notify(resp);
                    if (pollTime && deferred.state() === "pending") {
                        if (queuedSend) {
                            queuedSend = false;
                            send()
                        } else {
                            sendTimeout = setTimeout(send, pollTime)
                        }
                    }
                    if (!pollTime) {
                        if (DEBUG_LOG) {
                            console.log("AjaxManager " + p.url + " resolve " + JSON.stringify(resp))
                        }
                        deferred.resolve(resp, textStatus, jqXhr)
                    }
                })
            };
            send();
            return deferred.promiseObj
        }
        ;
        AjaxManager.prototype._addToRequests = function(request) {
            this._requests.push(request)
        }
        ;
        AjaxManager.prototype._removeFromRequests = function(request) {
            var index = _.indexOf(this._requests, request);
            if (index !== -1) {
                this._requests.splice(index, 1)
            }
        }
        ;
        return AjaxManager
    }();
    exports.AjaxManager = AjaxManager
});
define("core/lib/uuid", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function uuid() {
        return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
            var r = Math.random() * 16 | 0;
            var v = c === "x" ? r : r & 3 | 8;
            return v.toString(16)
        })
    }
    exports.uuid = uuid
});
(function(global, factory) {
        typeof exports === "object" && typeof module !== "undefined" ? factory(exports) : typeof define === "function" && define.amd ? define("@fluent/bundle", ["exports"], factory) : (global = global || self,
            factory(global.FluentBundle = {}))
    }
)(this, function(exports) {
    "use strict";
    var FluentType = function FluentType(value) {
        this.value = value
    };
    FluentType.prototype.valueOf = function valueOf() {
        return this.value
    }
    ;
    var FluentNone = function(FluentType) {
        function FluentNone(value) {
            if (value === void 0)
                value = "???";
            FluentType.call(this, value)
        }
        if (FluentType)
            FluentNone.__proto__ = FluentType;
        FluentNone.prototype = Object.create(FluentType && FluentType.prototype);
        FluentNone.prototype.constructor = FluentNone;
        FluentNone.prototype.toString = function toString(scope) {
            return "{" + this.value + "}"
        }
        ;
        return FluentNone
    }(FluentType);
    var FluentNumber = function(FluentType) {
        function FluentNumber(value, opts) {
            if (opts === void 0)
                opts = {};
            FluentType.call(this, value);
            this.opts = opts
        }
        if (FluentType)
            FluentNumber.__proto__ = FluentType;
        FluentNumber.prototype = Object.create(FluentType && FluentType.prototype);
        FluentNumber.prototype.constructor = FluentNumber;
        FluentNumber.prototype.toString = function toString(scope) {
            try {
                var nf = scope.memoizeIntlObject(Intl.NumberFormat, this.opts);
                return nf.format(this.value)
            } catch (err) {
                scope.reportError(err);
                return this.value.toString(10)
            }
        }
        ;
        return FluentNumber
    }(FluentType);
    var FluentDateTime = function(FluentType) {
        function FluentDateTime(value, opts) {
            if (opts === void 0)
                opts = {};
            FluentType.call(this, value);
            this.opts = opts
        }
        if (FluentType)
            FluentDateTime.__proto__ = FluentType;
        FluentDateTime.prototype = Object.create(FluentType && FluentType.prototype);
        FluentDateTime.prototype.constructor = FluentDateTime;
        FluentDateTime.prototype.toString = function toString(scope) {
            try {
                var dtf = scope.memoizeIntlObject(Intl.DateTimeFormat, this.opts);
                return dtf.format(this.value)
            } catch (err) {
                scope.reportError(err);
                return new Date(this.value).toISOString()
            }
        }
        ;
        return FluentDateTime
    }(FluentType);
    var MAX_PLACEABLES = 100;
    var FSI = "";
    var PDI = "";
    function match(scope, selector, key) {
        if (key === selector) {
            return true
        }
        if (key instanceof FluentNumber && selector instanceof FluentNumber && key.value === selector.value) {
            return true
        }
        if (selector instanceof FluentNumber && typeof key === "string") {
            var category = scope.memoizeIntlObject(Intl.PluralRules, selector.opts).select(selector.value);
            if (key === category) {
                return true
            }
        }
        return false
    }
    function getDefault(scope, variants, star) {
        if (variants[star]) {
            return resolvePattern(scope, variants[star].value)
        }
        scope.reportError(new RangeError("No default"));
        return new FluentNone
    }
    function getArguments(scope, args) {
        var positional = [];
        var named = Object.create(null);
        for (var i = 0, list = args; i < list.length; i += 1) {
            var arg = list[i];
            if (arg.type === "narg") {
                named[arg.name] = resolveExpression(scope, arg.value)
            } else {
                positional.push(resolveExpression(scope, arg))
            }
        }
        return {
            positional: positional,
            named: named
        }
    }
    function resolveExpression(scope, expr) {
        switch (expr.type) {
            case "str":
                return expr.value;
            case "num":
                return new FluentNumber(expr.value,{
                    minimumFractionDigits: expr.precision
                });
            case "var":
                return resolveVariableReference(scope, expr);
            case "mesg":
                return resolveMessageReference(scope, expr);
            case "term":
                return resolveTermReference(scope, expr);
            case "func":
                return resolveFunctionReference(scope, expr);
            case "select":
                return resolveSelectExpression(scope, expr);
            default:
                return new FluentNone
        }
    }
    function resolveVariableReference(scope, ref) {
        var name = ref.name;
        var arg;
        if (scope.params) {
            if (Object.prototype.hasOwnProperty.call(scope.params, name)) {
                arg = scope.params[name]
            } else {
                return new FluentNone("$" + name)
            }
        } else if (scope.args && Object.prototype.hasOwnProperty.call(scope.args, name)) {
            arg = scope.args[name]
        } else {
            scope.reportError(new ReferenceError("Unknown variable: $" + name));
            return new FluentNone("$" + name)
        }
        if (arg instanceof FluentType) {
            return arg
        }
        switch (typeof arg) {
            case "string":
                return arg;
            case "number":
                return new FluentNumber(arg);
            case "object":
                if (arg instanceof Date) {
                    return new FluentDateTime(arg.getTime())
                }
            default:
                scope.reportError(new TypeError("Variable type not supported: $" + name + ", " + typeof arg));
                return new FluentNone("$" + name)
        }
    }
    function resolveMessageReference(scope, ref) {
        var name = ref.name;
        var attr = ref.attr;
        var message = scope.bundle._messages.get(name);
        if (!message) {
            scope.reportError(new ReferenceError("Unknown message: " + name));
            return new FluentNone(name)
        }
        if (attr) {
            var attribute = message.attributes[attr];
            if (attribute) {
                return resolvePattern(scope, attribute)
            }
            scope.reportError(new ReferenceError("Unknown attribute: " + attr));
            return new FluentNone(name + "." + attr)
        }
        if (message.value) {
            return resolvePattern(scope, message.value)
        }
        scope.reportError(new ReferenceError("No value: " + name));
        return new FluentNone(name)
    }
    function resolveTermReference(scope, ref) {
        var name = ref.name;
        var attr = ref.attr;
        var args = ref.args;
        var id = "-" + name;
        var term = scope.bundle._terms.get(id);
        if (!term) {
            scope.reportError(new ReferenceError("Unknown term: " + id));
            return new FluentNone(id)
        }
        if (attr) {
            var attribute = term.attributes[attr];
            if (attribute) {
                scope.params = getArguments(scope, args).named;
                var resolved$1 = resolvePattern(scope, attribute);
                scope.params = null;
                return resolved$1
            }
            scope.reportError(new ReferenceError("Unknown attribute: " + attr));
            return new FluentNone(id + "." + attr)
        }
        scope.params = getArguments(scope, args).named;
        var resolved = resolvePattern(scope, term.value);
        scope.params = null;
        return resolved
    }
    function resolveFunctionReference(scope, ref) {
        var name = ref.name;
        var args = ref.args;
        var func = scope.bundle._functions[name];
        if (!func) {
            scope.reportError(new ReferenceError("Unknown function: " + name + "()"));
            return new FluentNone(name + "()")
        }
        if (typeof func !== "function") {
            scope.reportError(new TypeError("Function " + name + "() is not callable"));
            return new FluentNone(name + "()")
        }
        try {
            var resolved = getArguments(scope, args);
            return func(resolved.positional, resolved.named)
        } catch (err) {
            scope.reportError(err);
            return new FluentNone(name + "()")
        }
    }
    function resolveSelectExpression(scope, ref) {
        var selector = ref.selector;
        var variants = ref.variants;
        var star = ref.star;
        var sel = resolveExpression(scope, selector);
        if (sel instanceof FluentNone) {
            return getDefault(scope, variants, star)
        }
        for (var i = 0, list = variants; i < list.length; i += 1) {
            var variant = list[i];
            var key = resolveExpression(scope, variant.key);
            if (match(scope, sel, key)) {
                return resolvePattern(scope, variant.value)
            }
        }
        return getDefault(scope, variants, star)
    }
    function resolveComplexPattern(scope, ptn) {
        if (scope.dirty.has(ptn)) {
            scope.reportError(new RangeError("Cyclic reference"));
            return new FluentNone
        }
        scope.dirty.add(ptn);
        var result = [];
        var useIsolating = scope.bundle._useIsolating && ptn.length > 1;
        for (var i = 0, list = ptn; i < list.length; i += 1) {
            var elem = list[i];
            if (typeof elem === "string") {
                result.push(scope.bundle._transform(elem));
                continue
            }
            scope.placeables++;
            if (scope.placeables > MAX_PLACEABLES) {
                scope.dirty.delete(ptn);
                throw new RangeError("Too many placeables expanded: " + scope.placeables + ", " + "max allowed is " + MAX_PLACEABLES)
            }
            if (useIsolating) {
                result.push(FSI)
            }
            result.push(resolveExpression(scope, elem).toString(scope));
            if (useIsolating) {
                result.push(PDI)
            }
        }
        scope.dirty.delete(ptn);
        return result.join("")
    }
    function resolvePattern(scope, value) {
        if (typeof value === "string") {
            return scope.bundle._transform(value)
        }
        return resolveComplexPattern(scope, value)
    }
    var Scope = function Scope(bundle, errors, args) {
        this.dirty = new WeakSet;
        this.params = null;
        this.placeables = 0;
        this.bundle = bundle;
        this.errors = errors;
        this.args = args
    };
    Scope.prototype.reportError = function reportError(error) {
        if (!this.errors) {
            throw error
        }
        this.errors.push(error)
    }
    ;
    Scope.prototype.memoizeIntlObject = function memoizeIntlObject(ctor, opts) {
        var cache = this.bundle._intls.get(ctor);
        if (!cache) {
            cache = {};
            this.bundle._intls.set(ctor, cache)
        }
        var id = JSON.stringify(opts);
        if (!cache[id]) {
            cache[id] = new ctor(this.bundle.locales,opts)
        }
        return cache[id]
    }
    ;
    function values(opts, allowed) {
        var unwrapped = Object.create(null);
        for (var i = 0, list = Object.entries(opts); i < list.length; i += 1) {
            var ref = list[i];
            var name = ref[0];
            var opt = ref[1];
            if (allowed.includes(name)) {
                unwrapped[name] = opt.valueOf()
            }
        }
        return unwrapped
    }
    var NUMBER_ALLOWED = ["unitDisplay", "currencyDisplay", "useGrouping", "minimumIntegerDigits", "minimumFractionDigits", "maximumFractionDigits", "minimumSignificantDigits", "maximumSignificantDigits"];
    function NUMBER(args, opts) {
        var arg = args[0];
        if (arg instanceof FluentNone) {
            return new FluentNone("NUMBER(" + arg.valueOf() + ")")
        }
        if (arg instanceof FluentNumber || arg instanceof FluentDateTime) {
            return new FluentNumber(arg.valueOf(),Object.assign({}, arg.opts, values(opts, NUMBER_ALLOWED)))
        }
        throw new TypeError("Invalid argument to NUMBER")
    }
    var DATETIME_ALLOWED = ["dateStyle", "timeStyle", "fractionalSecondDigits", "dayPeriod", "hour12", "weekday", "era", "year", "month", "day", "hour", "minute", "second", "timeZoneName"];
    function DATETIME(args, opts) {
        var arg = args[0];
        if (arg instanceof FluentNone) {
            return new FluentNone("DATETIME(" + arg.valueOf() + ")")
        }
        if (arg instanceof FluentNumber || arg instanceof FluentDateTime) {
            return new FluentDateTime(arg.valueOf(),Object.assign({}, arg.opts, values(opts, DATETIME_ALLOWED)))
        }
        throw new TypeError("Invalid argument to DATETIME")
    }
    var FluentBundle = function FluentBundle(locales, ref) {
        if (ref === void 0)
            ref = {};
        var functions = ref.functions;
        var useIsolating = ref.useIsolating;
        if (useIsolating === void 0)
            useIsolating = true;
        var transform = ref.transform;
        if (transform === void 0)
            transform = function(v) {
                return v
            }
            ;
        this._terms = new Map;
        this._messages = new Map;
        this._intls = new WeakMap;
        this.locales = Array.isArray(locales) ? locales : [locales];
        this._functions = Object.assign({}, {
            NUMBER: NUMBER,
            DATETIME: DATETIME
        }, functions);
        this._useIsolating = useIsolating;
        this._transform = transform
    };
    FluentBundle.prototype.hasMessage = function hasMessage(id) {
        return this._messages.has(id)
    }
    ;
    FluentBundle.prototype.getMessage = function getMessage(id) {
        return this._messages.get(id)
    }
    ;
    FluentBundle.prototype.addResource = function addResource(res, ref) {
        if (ref === void 0)
            ref = {};
        var allowOverrides = ref.allowOverrides;
        if (allowOverrides === void 0)
            allowOverrides = false;
        var errors = [];
        for (var i = 0; i < res.body.length; i++) {
            var entry = res.body[i];
            if (entry.id.startsWith("-")) {
                if (allowOverrides === false && this._terms.has(entry.id)) {
                    errors.push(new Error('Attempt to override an existing term: "' + entry.id + '"'));
                    continue
                }
                this._terms.set(entry.id, entry)
            } else {
                if (allowOverrides === false && this._messages.has(entry.id)) {
                    errors.push(new Error('Attempt to override an existing message: "' + entry.id + '"'));
                    continue
                }
                this._messages.set(entry.id, entry)
            }
        }
        return errors
    }
    ;
    FluentBundle.prototype.formatPattern = function formatPattern(pattern, args, errors) {
        if (args === void 0)
            args = null;
        if (errors === void 0)
            errors = null;
        if (typeof pattern === "string") {
            return this._transform(pattern)
        }
        var scope = new Scope(this,errors,args);
        try {
            var value = resolveComplexPattern(scope, pattern);
            return value.toString(scope)
        } catch (err) {
            if (scope.errors) {
                scope.errors.push(err);
                return (new FluentNone).toString(scope)
            }
            throw err
        }
    }
    ;
    var RE_MESSAGE_START = /^(-?[a-zA-Z][\w-]*) *= */gm;
    var RE_ATTRIBUTE_START = /\.([a-zA-Z][\w-]*) *= */y;
    var RE_VARIANT_START = /\*?\[/y;
    var RE_NUMBER_LITERAL = /(-?[0-9]+(?:\.([0-9]+))?)/y;
    var RE_IDENTIFIER = /([a-zA-Z][\w-]*)/y;
    var RE_REFERENCE = /([$-])?([a-zA-Z][\w-]*)(?:\.([a-zA-Z][\w-]*))?/y;
    var RE_FUNCTION_NAME = /^[A-Z][A-Z0-9_-]*$/;
    var RE_TEXT_RUN = /([^{}\n\r]+)/y;
    var RE_STRING_RUN = /([^\\"\n\r]*)/y;
    var RE_STRING_ESCAPE = /\\([\\"])/y;
    var RE_UNICODE_ESCAPE = /\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{6})/y;
    var RE_LEADING_NEWLINES = /^\n+/;
    var RE_TRAILING_SPACES = / +$/;
    var RE_BLANK_LINES = / *\r?\n/g;
    var RE_INDENT = /( *)$/;
    var TOKEN_BRACE_OPEN = /{\s*/y;
    var TOKEN_BRACE_CLOSE = /\s*}/y;
    var TOKEN_BRACKET_OPEN = /\[\s*/y;
    var TOKEN_BRACKET_CLOSE = /\s*] */y;
    var TOKEN_PAREN_OPEN = /\s*\(\s*/y;
    var TOKEN_ARROW = /\s*->\s*/y;
    var TOKEN_COLON = /\s*:\s*/y;
    var TOKEN_COMMA = /\s*,?\s*/y;
    var TOKEN_BLANK = /\s+/y;
    var FluentResource = function FluentResource(source) {
        this.body = [];
        RE_MESSAGE_START.lastIndex = 0;
        var cursor = 0;
        while (true) {
            var next = RE_MESSAGE_START.exec(source);
            if (next === null) {
                break
            }
            cursor = RE_MESSAGE_START.lastIndex;
            try {
                this.body.push(parseMessage(next[1]))
            } catch (err) {
                if (err instanceof SyntaxError) {
                    continue
                }
                throw err
            }
        }
        function test(re) {
            re.lastIndex = cursor;
            return re.test(source)
        }
        function consumeChar(char, errorClass) {
            if (source[cursor] === char) {
                cursor++;
                return true
            }
            if (errorClass) {
                throw new errorClass("Expected " + char)
            }
            return false
        }
        function consumeToken(re, errorClass) {
            if (test(re)) {
                cursor = re.lastIndex;
                return true
            }
            if (errorClass) {
                throw new errorClass("Expected " + re.toString())
            }
            return false
        }
        function match(re) {
            re.lastIndex = cursor;
            var result = re.exec(source);
            if (result === null) {
                throw new SyntaxError("Expected " + re.toString())
            }
            cursor = re.lastIndex;
            return result
        }
        function match1(re) {
            return match(re)[1]
        }
        function parseMessage(id) {
            var value = parsePattern();
            var attributes = parseAttributes();
            if (value === null && Object.keys(attributes).length === 0) {
                throw new SyntaxError("Expected message value or attributes")
            }
            return {
                id: id,
                value: value,
                attributes: attributes
            }
        }
        function parseAttributes() {
            var attrs = Object.create(null);
            while (test(RE_ATTRIBUTE_START)) {
                var name = match1(RE_ATTRIBUTE_START);
                var value = parsePattern();
                if (value === null) {
                    throw new SyntaxError("Expected attribute value")
                }
                attrs[name] = value
            }
            return attrs
        }
        function parsePattern() {
            var first;
            if (test(RE_TEXT_RUN)) {
                first = match1(RE_TEXT_RUN)
            }
            if (source[cursor] === "{" || source[cursor] === "}") {
                return parsePatternElements(first ? [first] : [], Infinity)
            }
            var indent = parseIndent();
            if (indent) {
                if (first) {
                    return parsePatternElements([first, indent], indent.length)
                }
                indent.value = trim(indent.value, RE_LEADING_NEWLINES);
                return parsePatternElements([indent], indent.length)
            }
            if (first) {
                return trim(first, RE_TRAILING_SPACES)
            }
            return null
        }
        function parsePatternElements(elements, commonIndent) {
            if (elements === void 0)
                elements = [];
            while (true) {
                if (test(RE_TEXT_RUN)) {
                    elements.push(match1(RE_TEXT_RUN));
                    continue
                }
                if (source[cursor] === "{") {
                    elements.push(parsePlaceable());
                    continue
                }
                if (source[cursor] === "}") {
                    throw new SyntaxError("Unbalanced closing brace")
                }
                var indent = parseIndent();
                if (indent) {
                    elements.push(indent);
                    commonIndent = Math.min(commonIndent, indent.length);
                    continue
                }
                break
            }
            var lastIndex = elements.length - 1;
            var lastElement = elements[lastIndex];
            if (typeof lastElement === "string") {
                elements[lastIndex] = trim(lastElement, RE_TRAILING_SPACES)
            }
            var baked = [];
            for (var i = 0, list = elements; i < list.length; i += 1) {
                var element = list[i];
                if (element instanceof Indent) {
                    element = element.value.slice(0, element.value.length - commonIndent)
                }
                if (element) {
                    baked.push(element)
                }
            }
            return baked
        }
        function parsePlaceable() {
            consumeToken(TOKEN_BRACE_OPEN, SyntaxError);
            var selector = parseInlineExpression();
            if (consumeToken(TOKEN_BRACE_CLOSE)) {
                return selector
            }
            if (consumeToken(TOKEN_ARROW)) {
                var variants = parseVariants();
                consumeToken(TOKEN_BRACE_CLOSE, SyntaxError);
                return Object.assign({}, {
                    type: "select",
                    selector: selector
                }, variants)
            }
            throw new SyntaxError("Unclosed placeable")
        }
        function parseInlineExpression() {
            if (source[cursor] === "{") {
                return parsePlaceable()
            }
            if (test(RE_REFERENCE)) {
                var ref = match(RE_REFERENCE);
                var sigil = ref[1];
                var name = ref[2];
                var attr = ref[3];
                if (attr === void 0)
                    attr = null;
                if (sigil === "$") {
                    return {
                        type: "var",
                        name: name
                    }
                }
                if (consumeToken(TOKEN_PAREN_OPEN)) {
                    var args = parseArguments();
                    if (sigil === "-") {
                        return {
                            type: "term",
                            name: name,
                            attr: attr,
                            args: args
                        }
                    }
                    if (RE_FUNCTION_NAME.test(name)) {
                        return {
                            type: "func",
                            name: name,
                            args: args
                        }
                    }
                    throw new SyntaxError("Function names must be all upper-case")
                }
                if (sigil === "-") {
                    return {
                        type: "term",
                        name: name,
                        attr: attr,
                        args: []
                    }
                }
                return {
                    type: "mesg",
                    name: name,
                    attr: attr
                }
            }
            return parseLiteral()
        }
        function parseArguments() {
            var args = [];
            while (true) {
                switch (source[cursor]) {
                    case ")":
                        cursor++;
                        return args;
                    case undefined:
                        throw new SyntaxError("Unclosed argument list")
                }
                args.push(parseArgument());
                consumeToken(TOKEN_COMMA)
            }
        }
        function parseArgument() {
            var expr = parseInlineExpression();
            if (expr.type !== "mesg") {
                return expr
            }
            if (consumeToken(TOKEN_COLON)) {
                return {
                    type: "narg",
                    name: expr.name,
                    value: parseLiteral()
                }
            }
            return expr
        }
        function parseVariants() {
            var variants = [];
            var count = 0;
            var star;
            while (test(RE_VARIANT_START)) {
                if (consumeChar("*")) {
                    star = count
                }
                var key = parseVariantKey();
                var value = parsePattern();
                if (value === null) {
                    throw new SyntaxError("Expected variant value")
                }
                variants[count++] = {
                    key: key,
                    value: value
                }
            }
            if (count === 0) {
                return null
            }
            if (star === undefined) {
                throw new SyntaxError("Expected default variant")
            }
            return {
                variants: variants,
                star: star
            }
        }
        function parseVariantKey() {
            consumeToken(TOKEN_BRACKET_OPEN, SyntaxError);
            var key;
            if (test(RE_NUMBER_LITERAL)) {
                key = parseNumberLiteral()
            } else {
                key = {
                    type: "str",
                    value: match1(RE_IDENTIFIER)
                }
            }
            consumeToken(TOKEN_BRACKET_CLOSE, SyntaxError);
            return key
        }
        function parseLiteral() {
            if (test(RE_NUMBER_LITERAL)) {
                return parseNumberLiteral()
            }
            if (source[cursor] === '"') {
                return parseStringLiteral()
            }
            throw new SyntaxError("Invalid expression")
        }
        function parseNumberLiteral() {
            var ref = match(RE_NUMBER_LITERAL);
            var value = ref[1];
            var fraction = ref[2];
            if (fraction === void 0)
                fraction = "";
            var precision = fraction.length;
            return {
                type: "num",
                value: parseFloat(value),
                precision: precision
            }
        }
        function parseStringLiteral() {
            consumeChar('"', SyntaxError);
            var value = "";
            while (true) {
                value += match1(RE_STRING_RUN);
                if (source[cursor] === "\\") {
                    value += parseEscapeSequence();
                    continue
                }
                if (consumeChar('"')) {
                    return {
                        type: "str",
                        value: value
                    }
                }
                throw new SyntaxError("Unclosed string literal")
            }
        }
        function parseEscapeSequence() {
            if (test(RE_STRING_ESCAPE)) {
                return match1(RE_STRING_ESCAPE)
            }
            if (test(RE_UNICODE_ESCAPE)) {
                var ref = match(RE_UNICODE_ESCAPE);
                var codepoint4 = ref[1];
                var codepoint6 = ref[2];
                var codepoint = parseInt(codepoint4 || codepoint6, 16);
                return codepoint <= 55295 || 57344 <= codepoint ? String.fromCodePoint(codepoint) : ""
            }
            throw new SyntaxError("Unknown escape sequence")
        }
        function parseIndent() {
            var start = cursor;
            consumeToken(TOKEN_BLANK);
            switch (source[cursor]) {
                case ".":
                case "[":
                case "*":
                case "}":
                case undefined:
                    return false;
                case "{":
                    return makeIndent(source.slice(start, cursor))
            }
            if (source[cursor - 1] === " ") {
                return makeIndent(source.slice(start, cursor))
            }
            return false
        }
        function trim(text, re) {
            return text.replace(re, "")
        }
        function makeIndent(blank) {
            var value = blank.replace(RE_BLANK_LINES, "\n");
            var length = RE_INDENT.exec(blank)[1].length;
            return new Indent(value,length)
        }
    };
    var Indent = function Indent(value, length) {
        this.value = value;
        this.length = length
    };
    exports.FluentBundle = FluentBundle;
    exports.FluentDateTime = FluentDateTime;
    exports.FluentNumber = FluentNumber;
    exports.FluentResource = FluentResource;
    exports.FluentType = FluentType;
    Object.defineProperty(exports, "__esModule", {
        value: true
    })
});
define("core/l10n/fluent-bundle-sequence", ["require", "exports", "@fluent/bundle"], function(require, exports, bundle_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.RTL_LANGUAGES = ["ae", "ar", "arc", "bcc", "bqi", "ckb", "dv", "fa", "glk", "he", "ku", "mzn", "nqo", "pnb", "ps", "sd", "ug", "ur", "yi"];
    var FluentBundleSequence = function() {
        function FluentBundleSequence(bundles, onError) {
            this.bundles = bundles;
            this.onError = onError
        }
        FluentBundleSequence.fromSources = function(ftlSources, onError) {
            var bundles = [];
            for (var _i = 0, ftlSources_1 = ftlSources; _i < ftlSources_1.length; _i++) {
                var _a = ftlSources_1[_i]
                    , lang = _a.lang
                    , source = _a.source;
                var baseLang = lang.split("-")[0];
                var bundle = new bundle_1.FluentBundle(lang,{
                    useIsolating: exports.RTL_LANGUAGES.indexOf(baseLang) >= 0
                });
                bundle.addResource(new bundle_1.FluentResource(source), {
                    allowOverrides: false
                });
                bundle.addResource(new bundle_1.FluentResource('\nl10n-internal-date-day-month-year = {DATETIME($d, month: "short", day: "numeric", year: "numeric")}\nl10n-internal-date-day-month = {DATETIME($d, month: "short", day: "numeric")}\nl10n-internal-time = {DATETIME($d, minute: "numeric", hour: "numeric")}\n      '), {
                    allowOverrides: false
                });
                bundles.push(bundle)
            }
            return new FluentBundleSequence(bundles,onError)
        }
        ;
        FluentBundleSequence.prototype.format = function(key, variables) {
            for (var _i = 0, _a = this.bundles; _i < _a.length; _i++) {
                var bundle = _a[_i];
                if (!bundle.hasMessage(key))
                    continue;
                var message = bundle.getMessage(key);
                if (!message.value) {
                    return undefined
                }
                var errors = [];
                var result = bundle.formatPattern(message.value, variables, errors);
                for (var _b = 0, errors_1 = errors; _b < errors_1.length; _b++) {
                    var error = errors_1[_b];
                    this.onError("Error formatting " + key + " for locale " + bundle.locales.join(",") + ": " + error)
                }
                return result
            }
            this.onError("Couldn't find message for key " + key + " for locales " + this.getLocales().join(","));
            return undefined
        }
        ;
        FluentBundleSequence.prototype.formatDate = function(date, options) {
            return options.showYear ? this.format("l10n-internal-date-day-month-year", {
                d: date
            }) : this.format("l10n-internal-date-day-month", {
                d: date
            })
        }
        ;
        FluentBundleSequence.prototype.formatTime = function(date) {
            var _a;
            var formatted = this.format("l10n-internal-time", {
                d: date
            });
            if (this.getLocales()[0] === "en") {
                return (_a = formatted) === null || _a === void 0 ? void 0 : _a.toLowerCase()
            }
            return formatted
        }
        ;
        FluentBundleSequence.prototype.getLocales = function() {
            return this.bundles.reduce(function(memo, b) {
                return memo.concat(b.locales)
            }, [])
        }
        ;
        return FluentBundleSequence
    }();
    exports.FluentBundleSequence = FluentBundleSequence
});
define("l10n/escape", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function escapeFluentSourceForScriptElement(rawSource) {
        return rawSource.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
    }
    exports.escapeFluentSourceForScriptElement = escapeFluentSourceForScriptElement;
    function unescapeScriptElementFluentSource(scriptElementContent) {
        return scriptElementContent.replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&amp;/g, "&")
    }
    exports.unescapeScriptElementFluentSource = unescapeScriptElementFluentSource
});
define("core/l10n/default-fluent-bundle", [], function() {
    return {
        ftl: '### Strings for the authoring UI\n\n\n### 44 English words, 4 English strings\n\nab-edit-heading-draft-title = <1>Draft</1><2>|</2>\nab-edit-message-about-action-button =\n    Action buttons let you control other components on the screen using Computation\n    Layer.<1>{$v0}</1>\nab-edit-message-upload-image-file = <1>Upload a file</1><2/> to be hosted on Desmos.\nchallenge-edit-section-num-steps =\n    <1>The next</1><numStepsInput/>\n    <2>\n      screens will be part of the challenge creation process, with the final screen\n      being the challenge itself.\n    </2>\n    <numStepsErrorMessage/>\n### Strings for teacher.desmos.com, student.desmos.com\n\n\n### 2261 English words, 145 English strings\n\naccount-message-account-deleted =\n    <1>Your account has been deleted.</1>\n    <2>\n      Your account will be permanently deleted in 30 days. If you change your mind,\n      you can reactivate your account by logging in within 30 days.\n    </2>\naccount-message-account-reenabled =\n    \n    <1>\n      <2>Your account has been reactivated.</2>\n    <3>\n        You previously requested to delete your account, but because you logged\n        back in within 30 days, we will not delete your account. Welcome back!\n    </3>\n    <4>\n        <5>Continue to Desmos</5>\n    </4>\n    </1>\naccount-message-already-logged-in =\n    You are already logged in as {$email}{"."} Please <1>log out</1> first to\n    register as a new user.\naccount-message-confirm-delete =\n    <1>Are you sure you want to delete your account?</1>\n    <2>\n      When you delete your account, <3>we will retain your data for 30 days.</3>You\n      can reactivate your account at any time during those 30 days by logging back\n      in. If there\'s something about Desmos we can improve, please<4>let us\n      know</4><5/>We will send you a link to your email address {$v0} so you can\n      delete your account.,\n    </2>\naccount-message-email-verified = Email verified!<1>Your email address ({$email}) has been verified.</1>\naccount-prompt-create-or-sign-in =\n    \n    <1>\n    \n    <2>\n        <3>Create Account</3>\n    </2>  \n      or<4>Sign In</4>\n    </1>\naccount-prompt-delete-confirmation =\n    <1>Are you sure you want to delete your account?</1>\n    <2>\n      We will retain your data for 30 days and then it will be <3>permanently\n      deleted. </3>You can reactivate your account at any time during those 30 days\n      by logging back in with the email address for this account ({$email}).\n    </2>\naccount-prompt-link-expired =\n    <1>This link is no longer valid.</1><2>Please request a new account deletion\n    link in your account settings.</2>\naccount-prompt-sign-in =\n    \n    <1>\n      <2>Sign In</2>\n    </1>\naccount-prompt-sign-in-google-or-desmos =\n    \n    <1>\n      <2/><3>Sign in with Google</3>\n    </1>\n    <4>\n      <5>or sign in with your Desmos account</5>\n    </4>\naccount-prompt-sign-in-options = <1>Sign In</1>or<2>Create Account</2>\naccount-section-change-email-form =\n    <1>Change your Desmos email address</1>\n    <2>\n      <3/><4>Sign in with Google</4>\n    </2>\n    <5>\n      <6>or sign in with a new email address</6>\n    </5>\naccount-section-signup-or-login =\n    \n    <1>\n      <2>Create Account</2><3>or</3><4>Sign In</4>\n    </1>\naccount-section-signup-or-login-student =\n    \n    <1>\n    \n    <2>\n        <3>Create Account</3>or\n    </2>\n    <4>\n        <5>Sign In</5>to revisit your work later\n    </4>\n    </1>\nalp-label-draft-google = <1>Post as draft</1><2> to Google Classroom</2>\nalp-label-no-post-desmos = <1>Do not post</1><2> on student.desmos.com</2>\nalp-label-no-post-google = <1>Do not post</1><2> to Google Classroom</2>\nalp-label-post-desmos = <1>Post immediately</1><2> on student.desmos.com</2>\nalp-label-post-google = <1>Post immediately</1><2> to Google Classroom</2>\nalp-message-collaborate-description =\n    Collaborators can:\n    <1>\n    \n    <2>\n        Edit <3>or delete</3> the activity.\n    </2>  \n      <4>Add or remove collaborators.</4><5>Find the activity in their Custom\n      section.</5>\n    </1>\n    Only one person can edit the activity at a time.<6>{$v0}</6>\nalp-message-preview-sessions = This is a preview of a lesson in Desmos Middle School Math. <1>Learn more.</1>\nalp-warning-deprecated-feature =\n    \n    <1>\n      <2/><3>Warning! </3>{$v0} <4>{$v1}</4>\n    </1>\ncardsort-instructions-accessibility-notes =\n    <1>Card Sort Accessibility</1>\n    <2>\n      This activity includes a Card Sort. For students using adaptive technologies\n      such as screen readers, we have added the following keyboard shortcuts to\n      enable them to fully participate in the lesson:\n    </2>\n    <3>Keyboard Shortcuts</3>\n    <4>\n    \n    <5>\n        <6>Function</6><7>Windows Shortcut</7><8>Mac Shortcut</8>\n    </5>\n    <9>\n        <10>Move to Next Card</10>\n    <11>\n          <12>TAB</12>\n    </11>\n    <13>\n          <14>TAB</14>\n    </13>\n    </9>\n    <15>\n        <16>Move to Previous Card</16>\n    <17>\n          <18>SHIFT</18>+<19>TAB</19>\n    </17>\n    <20>\n          <21>SHIFT</21>+<22>TAB</22>\n    </20>\n    </15>\n    <23>\n        <24>Mark or Unmark Card</24>\n    <25>\n          <26>M</26>\n    </25>\n    <27>\n          <28>M</28>\n    </27>\n    </23>\n    <29>\n        <30>Join Marked Card with Focused Card</30>\n    <31>\n          <32>J</32>\n    </31>\n    <33>\n          <34>J</34>\n    </33>\n    </29>\n    <35>\n        <36>Unjoin Focused Card from Group</36>\n    <37>\n          <38>U</38>\n    </37>\n    <39>\n          <40>U</40>\n    </39>\n    </35>\n    <41>\n        <42>Expand or Collapse Card</42>\n    <43>\n          <44>ENTER</44>\n    </43>\n    <45>\n          <46>RETURN</46>\n    </45>\n    </41>\n    </4>\ncardsort-prompt-feedback-cardsort-accessibility =\n    We would love to hear your feedback on the accessibility features in Card Sort.\n    Please email us at <1>{$email}</1> with any comments or questions.\nchallenge-label-challenge-author = <1>{$name}</1>\'s Challenge\nchallenge-label-response-author = <1>{$name}</1>\'s Response\nchallenge-label-student-number = <1>{$studentNumber} </1>of {$totalStudents} Students\ncollections-instructions-add-to-collection =\n    Add an activity by pressing the<1>+</1>button on the activity or by editing\n    this collection.\nglobal-error-homepage-link =\n    Don\'t worry, we\'re working on it! You can try again in a little bit or head\n    back to your<1>home page</1>{"."}\nglobal-instructions-upload-drop-box-drag-here =\n    <1>Drag an image or video here.</1>\n    <2>\n      <3>or</3>\n    </2>\n    <4>Choose a file to upload</4>\nglobal-instructions-upload-drop-box-drop-here =\n    <1>Drop an image or video here.</1>\n    <2>\n      <3>or</3>\n    </2>\n    <4>Choose a file to upload</4>\nglobal-message-browser-small-screen-warning =\n    \n    <1>\n      This page works best on a wider screen. Expand your browser window for best\n      results.\n    </1>\n    <2>OK, I\'ll take my chances in this smaller window.</2>\nglobal-message-device-small-screen-warning =\n    <1>This page works best on a wider screen. Try finding a bigger\n    device.</1><2>OK, I\'ll take my chances on this smaller device.</2>\nglobal-message-device-small-screen-warning-student =\n    \n    <1>\n      We recommend doing this activity on a larger device, as not all of the\n      screens will work well on this smaller screen.\n    </1>\n    <2>OK, I\'ll take my chances on this smaller device.</2>\nglobal-message-rotate-ipad =\n    <1>This page will work way better if you rotate your iPad. Give it a\n    try!</1><2>Great suggestion! Let me use it like this.</2>\nglobal-prompt-error-try-again = Error! <1>Try again?</1>\nmarbleslides-instructions-accessibility-notes =\n    <1>Marbleslides Accessibility</1>\n    <2>\n      We have updated all Marbleslides activities to be more screen reader\n      friendly! These updates include verbal prompts to orient the student to the\n      activity, optional sound effects so he or she can hear the marbles move\n      around, and a text-based summary describing what happened after launching the\n      marbles. The text description and audio cues track the first marble only.\n    </2>\n    <3>\n      We have found that Marbleslides is very challenging to complete using screen\n      reader and audio cues alone. Students who rely on a screen reader may wish to\n      work with a sighted peer to complete this activity.\n    </3>\n    <4>Keyboard Shortcuts</4>\n    <5>\n    \n    <6>\n        <7>Function</7><8>Windows Shortcut</8><9>Mac Shortcut</9>\n    </6>\n    <10>\n        <11>Move to Expression List</11>\n    <12>\n          <13>Ctrl</13>+<14>Alt</14>+<15>E</15>\n    </12>\n    <16>\n          <17>Ctrl</17>+<18>Command</18>+<19>E</19>\n    </16>\n    </10>\n    <20>\n        <21>Launch Marbles</21>\n    <22>\n          <23>Alt</23>+<24>L</24>\n    </22>\n    <25>\n          <26>Option</26>+<27>L</27>\n    </25>\n    </20>\n    <28>\n        <29>View Results</29>\n    <30>\n          <31>Alt</31>+<32>R</32>\n    </30>\n    <33>\n          <34>Option</34>+<35>R</35>\n    </33>\n    </28>\n    <36>\n        <37>Toggle Sound Effects</37>\n    <38>\n          <39>Alt</39>+<40>A</40>\n    </38>\n    <41>\n          <42>Option</42>+<43>A</43>\n    </41>\n    </36>\n    <44>\n        <45>Repeat Instructions and Keyboard Shortcuts</45>\n    <46>\n          <47>Alt</47>+<48>P</48>\n    </46>\n    <49>\n          <50>Option</50>+<51>P</51>\n    </49>\n    </44>\n    </5>\nmarbleslides-prompt-accessibility-feedback =\n    We would love to hear your feedback on the accessibility features in\n    Marbleslides. Please email us at <1>{$v0}</1> with any comments or questions.\nordered-list-instructions-accessibility-notes =\n    <1>Ordered List Accessibility</1>\n    <2>\n      This activity includes an Ordered List. For students using adaptive\n      technologies such as screen readers, we have added the following keyboard\n      shortcuts to enable them to fully participate in the lesson (note: the below\n      commands assume the student has pressed <3>{$v0}</3> to focus the list):\n    </2>\n    <4>Keyboard Shortcuts</4>\n    <5>\n    \n    <6>\n        <7>Function</7><8>Windows Shortcut</8><9>Mac Shortcut</9>\n    </6>\n    <10>\n        <11>Move to Previous Item</11>\n    <12>\n          <13>UP ARROW</13>\n    </12>\n    <14>\n          <15>UP ARROW</15>\n    </14>\n    </10>\n    <16>\n        <17>Move to Next Item</17>\n    <18>\n          <19>DOWN ARROW</19>\n    </18>\n    <20>\n          <21>DOWN ARROW</21>\n    </20>\n    </16>\n    <22>\n        <23>Move to First Item</23>\n    <24>\n          <25>HOME</25>\n    </24>\n    <26>\n          <27>FN</27>+<28>LEFT ARROW</28>\n    </26>\n    </22>\n    <29>\n        <30>Move to Last Item</30>\n    <31>\n          <32>END</32>\n    </31>\n    <33>\n          <34>FN</34>+<35>RIGHT ARROW</35>\n    </33>\n    </29>\n    <36>\n        <37>Select Item for Movement</37>\n    <38>\n          <39>SPACEBAR</39>\n    </38>\n    <40>\n          <41>SPACEBAR</41>\n    </40>\n    </36>\n    </5>\n    <42>\n      We would love to hear your feedback on the accessibility features of Ordered\n      List. Please email us at <43>{$v1}</43> with any comments or questions.\n    </42>\nshared-button-accept = Accept\nshared-button-cancel = Cancel\nshared-button-change-email-address = Change Email Address\nshared-button-change-email-and-password = Change Email and Password\nshared-button-close-dialog = Close Dialog\nshared-button-continue-to-desmos = Continue to Desmos\nshared-button-create-account = Create Account\nshared-button-delete-account-question = Delete your Desmos account?\nshared-button-email-address-narrow = Email\nshared-button-email-address-wide = Email Address\nshared-button-external-account-narrow = External\nshared-button-external-account-wide = External Account\nshared-button-go-to-account-settings = Go to Account Settings\nshared-button-google-account-narrow = Google\nshared-button-google-account-wide = Google Account\nshared-button-i-am-not-a-teacher = I am not a teacher.\nshared-button-login = Log in\nshared-button-login-capitalized = Log In\nshared-button-login-with-apple = Log in with Apple\nshared-button-login-with-google = Log in with Google\nshared-button-recover-password = Recover Password\nshared-button-save = Save\nshared-button-send-delete-account-email = Send Delete Account Email\nshared-button-send-email = Send Email\nshared-button-sign-up-as-a-teacher = Sign up as a teacher.\nshared-button-try-again = Didn\'t work? Try again!\nshared-label-email = Email\nshared-label-name = Name\nshared-label-name-or-nickname = Name or Nickname\nshared-label-new-email-address = New Email Address\nshared-label-password = Password\nshared-message-account-reactivated =\n    You previously requested to delete your account, but because you logged back in\n    within 30 days, we will not delete your account. Welcome back!\nshared-message-change-password-email-sent =\n    We will send a link to your email address ({ $emailAddress }) so you can change\n    your password.\nshared-message-check-email-for-delete-link = Please check your email ({ $emailAddress }) for the link to delete your account.\nshared-message-check-email-for-link = Please check { $emailAddress } for the Change Email link.\nshared-message-check-email-for-password-link = Please check your email ({ $emailAddress }) for the link to change your password.\nshared-message-check-email-for-password-recovery-link = Message sent. Please check your email for a password recovery link.\nshared-message-consent-delete-information =\n    If you don\'t want Desmos to hold onto this information, you may delete your\n    account from the Account Settings menu at any time.\nshared-message-consent-information =\n    When you created your Desmos account, you gave us your name, email address, and\n    password (unless you signed in with Google, in which case you gave us access to\n    the name and email address associated with that account). You also gave us\n    access to your saved work. To continue using your Desmos account, please\n    consent below to the collection of this information.\nshared-message-consent-text =\n    I agree to let Desmos store and maintain the information I provide (e.g. login\n    credentials, saved work) in order to provide and improve its service. To\n    withdraw consent, you may delete your account at any time.\nshared-message-cookie-notice =\n    <1>Note:</1> Desmos uses cookies to enable persistence when you are signed in.\n    If you do not wish to use cookies, please use Desmos without logging in.\n    <2>Learn More.</2>\nshared-message-delete-account-notice =\n    When you delete your account, <1>we will retain your data for 30 days.</1> You\n    can reactivate your account at any time during those 30 days by logging back\n    in. If there\'s something about Desmos we can improve, please <2>let us know.</2>\nshared-message-delete-account-will-send-email =\n    We will send you a link to your email address ({ $email }) so you can delete\n    your account.\nshared-message-email-sent = Email sent\nshared-message-email-settings-will-send-email = We will send a Change Email link to { $emailAddress }.\nshared-message-google-login-not-available = Google Login is not available on this device.\nshared-message-information-saved = Saved!\nshared-message-or-login-with-desmos = Or log in with Desmos\nshared-message-privacy-notice =\n    I have read, understand, and accept the <1>Terms of Service</1> and <2>Privacy\n    Policy</2>{"."}\nshared-message-set-new-email-address = Set a new email address and password.\nshared-narration-privacy-policy-agreement =\n    Checkbox to indicate agreement to privacy policy (desmos.com/privacy) and terms\n    of service (desmos.com/terms).\nshared-prompt-already-have-account = Already have a Desmos account?\nshared-prompt-enter-email-for-password-recovery-link = Enter your email address to get a password recovery link.\nshared-prompt-forgot-your-password = Forgot your password?\nshared-prompt-new-to-desmos-sign-up-here = New to Desmos? <1>Sign up</1>{"."}\nshared-prompt-new-to-desmos-teacher-or-student = New to Desmos? Sign up as a <1>teacher</1> or <2>student.</2>\nshared-prompt-please-consent-to-sign-up-with-apple = Please consent above to sign up with Apple\nshared-prompt-please-consent-to-sign-up-with-google = Please consent above to sign up with Google\nshared-prompt-sign-up-with-apple = Sign up with Apple\nshared-prompt-sign-up-with-google = Sign up with Google\nshared-title-account-reactivated = Your account has been reactivated.\nshared-title-account-settings = Account Settings\nshared-title-change-email-address = Change your Desmos email address\nshared-title-change-password-narrow = Password\nshared-title-change-password-wide = Change Password\nshared-title-consent = We value your privacy\nshared-title-delete-account = Are you sure you want to delete your account?\nshared-title-email-settings = Email\nshared-title-language-menu = Language\nshared-title-login = Log In\nshared-title-profile-information-narrow = Profile\nshared-title-profile-information-wide = Profile Information\nshared-title-recover-password = Recover Password\nshared-title-signup = Sign-Up\nshared-title-teacher-signup = Teacher Sign-Up\nstudent-description-greeting-account-info = You are signed in with {$email}{"."} <1>Sign out.</1>\nstudent-label-no-activities = No assigned activities yet!<1/>If you have a code, enter it below.\nstudent-prompt-classcode-sign-in-options =\n    \n    <1>\n      <2/>{$v0}\n    </1>\n    <3>or</3><4>{$v1}</4>\nstudent-prompt-sign-in-options =\n    \n    <1>\n      <2/>Sign in with Google\n    </1>\n    <3>or</3><4>Sign in with Desmos</4>\nstudent-prompt-sign-in-options-header =\n    \n    <1>\n      <2>{$v0}</2><3>or</3>\n    </1>\n    <4>{$v1}</4>\nteacher-button-app-links = Download our apps in the <1>Google Play Store</1> and <2>iOS App Store</2>{"."}\nteacher-description-desmos-labs =\n    Try these labs features before they are fully integrated into the Desmos\n    experience. Feel free to send any questions or feedback to <1>{$v0}</1>{"."}\nteacher-description-labs-computation-layer-with-icon =\n    Computation Layer is now enabled for everyone! Look for the <1/> icon while\n    editing.\nteacher-description-labs-written-feedback-with-icon =\n    Written Feedback is now enabled for everyone! Look for the <1/> icon when\n    viewing a specific students screen.\nteacher-description-site-invite-users =\n    Users will receive an email invitation to join Desmos Middle School Math with\n    <1>{$v0}</1>{"."}<2/><3/><4>They will also be prompted to accept next time they\n    log in to Desmos.</4>\nteacher-heading-import-google-classes = Import your classes from Google Classroom. <1>Learn more.</1>\nteacher-label-author-area-by-author = by <1>{$author}</1>\nteacher-label-draft-google =\n    \n    <1>\n      <2>Post as a draft</2><3> to Google Classroom</3>\n    </1>\nteacher-label-google-classroom-info =\n    Using Google Classroom? Log in with Google to import your classes. <1>Learn\n    more</1>\nteacher-label-no-post-desmos =\n    \n    <1>\n      <2>Do not post</2><3> on student.desmos.com</3>\n    </1>\nteacher-label-no-post-google =\n    \n    <1>\n      <2>Do not post</2><3> to Google Classroom</3>\n    </1>\nteacher-label-post-desmos =\n    \n    <1>\n      <2>Post immediately</2><3> on student.desmos.com</3>\n    </1>\nteacher-label-post-google =\n    \n    <1>\n      <2>Post immediately</2><3> to Google Classroom</3>\n    </1>\nteacher-message-account-co-teachers-disabled =\n    Adding new account co-teachers is no longer supported. Instead, please\n    <1>create or edit a class</1> and add co-teachers to the class.\nteacher-message-inactive-classcode =\n    <1>This code is inactive.</1><2>To protect student privacy, we deactivate old\n    session codes.</2>\n    <3>\n      Students who were logged in to their Desmos account when they used this code\n      can access their work by visiting <4>{$history_url}</4>{"."}\n    </3>\n    <5>You can view student work simply by closing this message.</5>\n    <6>\n      If you want to allow additional students to use this code, you can\n      <7>reactivate it</7> for 14 days.\n    </6>\nteacher-message-share-activiity =\n    \n    <1>\n      <2/>This activity is private - only you can see it.\n    </1>\n    <3>\n      To share your activity with other teachers, <4>mark it as public.</4>\n    </3>\nteacher-message-share-collection =\n    \n    <1>\n      To share your collection with other teachers, <2>update the share setting.</2>\n    </1>\nteacher-message-unassign-description =\n    \n    <1>\n      Unassigning <2>{$activityName}</2> from <3>{$className}</3> will:\n    </1>\n    <4>\n    \n    <5>\n        Remove the activity from student.desmos.com for students who have not yet\n        joined.\n    </5>  \n      <6>Archive your teacher dashboard for this session.</6>\n    </4>\nteacher-prompt-confirm-delete-activity = Are you sure you want to delete <1>{$title}</1>? This cannot be undone!\nteacher-prompt-confirm-publish-searchable-activity =\n    <1>{$title}</1> is in the search pool. Please confirm that you would like to\n    publish this activity and replace the current version everywhere it appears on\n    the site.\nteacher-prompt-confirm-unassign = Are you sure you want to unassign <1>{$lessonName}</1>?\nteacher-prompt-empty-custom-activities =\n    Have an idea for a great Desmos activity?<1>Check out these resources to turn\n    your vision into reality.</1>\nteacher-prompt-google-classroom-posting =\n    Double check your <1>Google Classroom preferences</1> to ensure students can\n    find the assigned activities.\nteacher-prompt-remove-student =\n    \n    <1>\n      Are you sure that you want to remove <2>{$name}</2> from <3>{$block-name}?</3>\n    </1>\nteacher-prompt-students-join =\n    Students enter the Class Code at <1>student.desmos.com</1> to join the class\n    for the term.\nteacher-section-landing-page-content =\n    <1>What We Offer</1>\n    <2>\n    \n    <3>\n        <4/>\n    <5>\n          In this delightful and challenging activity, students click "Launch" to\n          release the marbles, which slide down the curves, through the stars, and\n          off the edge of the screen.\n    </5>\n    </3>\n    <6>\n        <7>Meaningful Feedback</7>\n    <8>\n          We show students what their answers mean, then give them the opportunity\n          to improve their thinking and revise their work.\n    </8>    \n        <tweet/><9>{$v0}</9>\n    </6>\n    </2>\n    <10>\n    \n    <11>\n        <12/>\n    <13>\n          After solving several challenges where they need to graph a parabola that\n          goes through the slalom gates, students design their own parabola slalom\n          courses to challenge their classmates.\n    </13>\n    </11>\n    <14>\n        <15>Collaboration</15>\n    <16>\n          We use devices to connect students, not to isolate them. Students see\n          their classmates\' thinking. They ask each other questions and create\n          challenges for each other.\n    </16>    \n        <tweet-1/><17>{$v1}</17>\n    </14>\n    </10>\n    <18>\n    \n    <19>\n        <20/>\n    <21>\n          Students pair up for vocabulary-rich conversations in Polygraph. One\n          student picks a graph and answers questions; the other student asks\n          questions and tries to identify the chosen graph. Both students discover\n          the need for more precise vocabulary.\n    </21>\n    </19>\n    <22>\n        <23>A Need to Know</23>\n    <24>\n          We invite students to solve challenging problems using the tools they\n          already have. We create a need for new tools before we help students\n          learn how to use them.\n    </24>    \n        <tweet-2/><25>{$v2}</25>\n    </22>\n    </18>\n    <26>\n      <27>Sign up to use all of our activities with your students for\n      free!</27><28>Create Account</28>\n    </26>\n### Strings that are currently not in scope for translation\n\n\n### 2030 English words, 18 English strings\n\nalignment-prompt-confirm-delete = Are you sure you want to delete<1> {$v0}</1>? This cannot be undone!\nalignment-prompt-confirm-publish =\n    Publishing will add a link to<1> {$title}</1>to the home page\n    for{$partnerName}users.\nalignment-prompt-confirm-unpublish-alignment =\n    This will remove the link to<1> {$title}</1>from the home page\n    for{$partnerName}users.\ncl-docs-description-about-cl =\n    <1>About the Computation Layer Language</1>\n    <2>\n      The Computation Layer might not look like other programming languages you\'re\n      used to. Don\'t think of it as a list of commands that run one after another.\n      Instead, think of it more as wiring together different pieces that are always\n      kept consistent. For example, the statement "a=b+c" means "a is always the\n      sum of b+c." If b or c change, that also changes a. It\'s a similar model to\n      the way spreadsheets work. It\'s also similar to how the Desmos calculator\n      works.\n    </2>\n    <3>\n      Computation Layer is also very strict about data types. In Computation Layer\n      scripts, numbers and strings are treated very differently. Every sink expects\n      a specific type, and every source emits a specific type. If you try to pass a\n      string into a sink that expects a number, it will complain. The most common\n      types you\'ll use are:\n    </3>\n    <4>number</4><5>this is a floating point number, like 1, 1.4,\n    -3.</5><6>string</6><7>This is a standard string, like "hello world" or\n    "y=x^2"</7><8>boolean</8><9>This is the core type for conditionals (like a &lt;\n    2)</9>\n    <10>\n      There are also a few advanced data types that you might find yourself using.\n      These include, for example, <11>numberList</11> and <12>sketch</12>{"."}\n      We\'ll save those for later in the docs.\n    </10>\n    <13>General Syntax </13>\n    <14>\n      A script can have a few different things in it. Here\'s a sampling of the\n      types of things that will show up in your Computation Layer scripts.\n    </14>\n    <15>Sinks</15>\n    <16>\n      Sinks are the way of injecting values into components, and always are\n      followed by a \':\'. For example, the "content" sink of a note lets you define\n      what the note says:\n    </16>\n    <code-sample/>\n    <17>\n      Some sinks take a single parameter as an argument. For example, the "number"\n      sink for a graph takes the name of the variable we\'re assigning that number\n      to:\n    </17>\n    <code-sample-1/><18>Variables</18>\n    <19>\n      You can also define variables within a script. These help you avoid repeating\n      the same code over and over. Note that they look very similar to sinks, but\n      they behave really differently. Careful not to confuse them! Example:\n    </19>\n    <code-sample-2/>\n    <20>\n      You can reference variables defined in other components using the "script"\n      keyword.\n    </20>\n    <code-sample-3/><21>Sources</21>\n    <22>\n      A source is something that you can pull out of a component, typically some\n      work a student has done, like something they typed or sketched. To use a\n      source, you need to first name the component. Each component has a different\n      set of sources, which are described in detail below.\n    </22>\n    <23>\n      For example, let\'s say that we have an expression input, and we call it\n      <24>exp5</24>{"."} We can read things off all of its sources. For example:\n    </23>\n    <code-view/><25>Functions</25>\n    <26>\n      We have a few built-in functions for interpreting sources and converting\n      between data types. One common use of a function is to interpret the\n      expression that a student typed and show the appropriate message:\n    </26>\n    <code-sample-4/><27>Conditionals</27>\n    <28>\n      The Computation Layer doesn\'t have "if" "then" or "else." Instead we use a\n      structure similar to a "switch" on other programming languages. We call it\n      "when". It is a list of tests, each followed by what should happen in that\n      situation, and requires a default value ("otherwise") if none of the\n      conditions match.\n    </28>\n    <code-sample-5/>\n    <29>\n      Note that a "when" returns as soon as it finds a matching condition. As a\n      result, when we get to the 4th condition above (n &lt; 30), we already know\n      that n is at least 10 and at most 100. This might help you write shorter\n      &amp; cleaner conditions.\n    </29>\n    <30>Working with Strings</30>\n    <31>\n      Sometimes you want to insert student work or computed values into a note\n      component. We call this "variable interpolation." Inside of any string, you\n      can write ${"{"}variable{"}"} where variable is some defined value, and the\n      Computation Layer swaps in the value of that variable. You can combine this\n      with the equation feature of notes, where LaTeX wrapped in backticks renders\n      as math. Here\'s an example of both:\n    </31>\n    <code-sample-6/><32>Debugging</32>\n    <33>\n      Before we explore what each component can do, let\'s talk about a few visual\n      indicators designed to keep you and your scripts happy.\n    </33>\n    <34>When a component has a script, the gear is teal. Otherwise it\'s gray.</34>\n    <35>\n      <36/><37/>\n    </35>\n    <38>When something goes wrong, we\'ll display a warning.</38>\n    <39>\n      <40/><41/>\n    </39>\n    <42>\n      You can learn more about most errors by opening the script and hovering over\n      the orange triangles, or a bit of underlined text.\n    </42>\n    <43>\n      <44/><45/>\n    </43>\n    <46>\n      Whether you give two components the same name, forget to name a component\n      altogether, or introduce some other error inside the script itself, use these\n      visual indicators to get back on track. If you find yourself making a\n      particular mistake fairly often and it doesnt trigger a helpful error\n      message, let us know.\n    </46>\ncl-docs-description-functions =\n    <1>{$v0}</1>\n    <2>\n       This is a list of available functions. If you have any questions or\n      suggestions, let us know at <3>the CL community board</3>{"."}\n    </2>\ncl-docs-section-advanced-usage =\n    <1>Advanced Usage</1>This section contains examples of using advanced features\n    of Computation Layer. We recommend that you don\'t play with these functions\n    until you\'ve had a little practice with basic sinks and sources.<2>Using the\n    Function Sink</2>\n    <3>\n      One of the nice things about Desmos is that it understands a lot of different\n      forms. A student could type 2*x, f(x)=2*x, y=2*x, or 2x, and we\'d recognize\n      those all as the same function. To take advantage of that flexibility in the\n      computation layer, you\'ll want to use simpleFunction. This takes latex and\n      returns a function which can connect to a graph\'s "function" sink. You can\n      then use that function in all of the ways you\'d want to in the calculator.\n      You can evaluate it at a point, take its derivative, plot it, etc. Here\'s an\n      example:\n    </3>\n    <code-sample/>\n    <4>\n      We assume that the student will write the function in terms of \'x\'. If you\n      want them to write in terms of some other variable, say "t", use\n      simpleFunction(exp1.latex, "t").\n    </4>\n    <5>Aggregating Across Students (Experimental)</5>\n    <6>\n      For any source that returns a "number", you can use the "aggregate" function\n      to turn it into a numberList, where each element is the number from a\n      different student in the class. This is an insanely powerful feature, but\n      still just experimental. Use with caution!\n    </6>\n    <7>\n      For example, you could ask everyone in the class to make a guess. We\'ll have\n      them type it into an input, exp1. We can then take all of their responses\n      create a numberList, which we can send into a graph. The graph could then use\n      all of the list tools of the graphing calculator to display a histogram or\n      scatter plot, or the average value. For example:\n    </7>\n    <code-sample-1/><8>Using Random Numbers</8>\n    <9>\n      Computation Layer supports random numbers. Given a particular student the\n      same random numbers will be produced. This means that page reloads won\'t\n      change the random numbers. However, every student will see a different set of\n      random numbers. You can use this, for example, to give each student a\n      different problem:\n    </9>\n    <code-sample-2/>\n    <10>\n      The randomGenerator can also take an input, called a "seed." This lets you\n      change which random numbers a student sees, for example hooking up a button\n      to produce a series of random problems:\n    </10>\n    <code-sample-3/>\ncl-docs-section-components =\n    <1>{$v0}</1>\n    <2>\n       Components are at the heart of Computation Layer. Scripts are usually\n      attached to a component, through the little gear icon. Scripts can also be\n      attached to an entire step, to control behavior of the step itself.\n      Currently, the only thing you can control this way is via a "title" sink,\n      which sets the title of the step.\n    </2>\n    <3>In order to access the sources of a component, you first need to name it:</3>\n    <4>\n      <5/><6/>\n    </4>\n    <7>\n      To add a script to a component and make use of its sinks, click the gear icon\n      next to the component:\n    </7>\n    <8>\n      <9/><10/>\n    </8>\n    <11>\n      The following is a list of components available to you in Activity Builder\n      with information about what sinks and sources each one supports. If you have\n      any questions or comments let us know on the <12>the CL community\n      board</12>{"."}\n    </11>\ncl-docs-section-overview =\n    <1>{$v0}</1>\n    <2>\n      Computation Layer (CL) is the tissue that connects screens and components in\n      our activities, converting discrete, isolated mathematical moments into a\n      richer, more coherent experience for students. CL lets you connect different\n      mathematical representations, to change what students see later based on\n      their earlier work, and to collect data from an entire class of students.\n    </2>\n    <3>\n      The Activity Builder ecosystem consists of activities (like <4>Picture\n      Perfect</4>), which consist of screens (like <5>this one</5>), which consist\n      of components (like the graph, table, and action button on that screen).\n    </3>\n    <6>\n      With Computation Layer, you can now attach a script to every component. The\n      scripts live in these gear boxes.\n    </6>\n    <7>\n      <8/><9/>\n    </7>\n    <10>\n      With Computation Layer, you can access and alter the <11>sinks</11> and\n      <12>sources</12> for every component.\n    </10>\n    <13>\n      <14>Sinks</14> are the data that you set for a component. The text label on\n      an action button. A variable in a graph. The text a student sees in a note.\n    </13>\n    <15>\n      <16>Sources</16> are the data that you can extract from a component. The\n      number of times the action button has been pressed. The current position of a\n      point in the graph. The text the student typed into an input.\n    </15>\n    <17>\n      Computation Layer lets you connect sinks and sources together and lets\n      components talk to each other.\n    </17>\ncl-docs-section-overview-example =\n    <1>Example: Using a students numeric response in a graph</1>\n    <2>\n      In this example, students will see graph and math input components. When\n      students type a number into the math input, we want a new line with that\n      slope to appear on the graph.\n    </2>\n    <3>\n      To use the output of a component as a source (that is, to get data <4>out</4>\n      of it), you first need to name the component. In this example, we want to get\n      data out of the math input, so well name it <5>exp1</5>{"."} You can name\n      your components anything you\'d like, so long as no two components share a\n      name!\n    </3>\n    <6>\n      <7/><8/>\n    </6>\n    <9>\n      Next we\'ll need to use CL to tell the graph to use the number the student\n      typed into <10>exp1</10>{"."} To add a CL script to a component and define\n      its sinks (the preset options for configuring a component), click the gear.\n    </9>\n    <11>\n      <12/><13/>\n    </11>\n    <14>\n      After clicking the gear, the CL editor will open. Here\'s what we\'d type to\n      take the value from the math input <15>exp1</15> and use it to define a\n      variable <16>exp1</16> in the graph. Press the Try It button to see this code\n      in action!\n    </14>\ncl-docs-section-overview-getting-started =\n    <1>Getting Started</1>\n    <2>\n      To start using Computation Layer to build Desmos activities simply head to\n      <3>teacher.desmos.com/labs</3> and check the box for Computation Layer. Then\n      hit save.\n    </2>\n    <4>\n      <5/><6/>\n    </4>\n    <7>\n      Computation Layer is constantly evolving. If there\'s a sink, a source, data\n      type, or method that would help you, just ask for it on the <8>CL discussion\n      board</8>{"."} Lets go!\n    </7>\ncl-docs-section-types =\n    <1>{$v0}</1>\n    <2>\n      This is a list of available types of objects that you can work with in CL.\n      These objects can be returned by various functions.\n    </2>\npartner-dashboard-instructions-alignment-list =\n    \n    <1>\n    \n    <2>\n        <3/>Published\n    </2>  \n      = linked on the home page for all{$partnerName}users\n    </1>\n    <4>\n    \n    <5>\n        <6/>Not Published\n    </5>  \n      = only visible to{$partnerName-1}admins\n    </4>\n    <7>Note: </7>Only your admins ({$adminList}) can create and edit curriculum\n    alignments.\npartner-dashboard-prompt-confirm-disable-account =\n    Are you sure you want to disable the Desmos account for<1> {$name}</1>? This\n    user will no longer be able to log in to Desmos with this account.\npartner-dashboard-prompt-confirm-reactivate-account =\n    Are you sure you want to re-activate the Desmos account for<1> {$name}</1>?\n    This will restore all of their Desmos classes and work associated with this\n    account.\npartner-dashboard-prompt-invite-partner =\n    Enter an email below to send an invitation to join<1>{$name}{"."} </1>Users who\n    accept the invite will appear under "Users".\nsite-heading-user-invited = You\'re invited to join the<1/>Desmos Middle School Math Program!\nsite-message-invite-contact-single = Accept the invitation below or email <1>{$v0}</1> if you have any questions.\nsite-message-invite-details = <1>{$v0}</1> has invited you to join the Desmos Middle School Math Program.\n### Strings for the teacher dashboard UI\n\n\n### 120 English words, 6 English strings\n\nchallenge-dashboard-heading-student-challenge = <1>{$name}</1>\'s Challenge\ndashboard-error-picture-snapshots-support-link = Please see<1>our support page</1>if you continue to encounter issues.\ndashboard-instructions-snapshots-welcome =\n    <1/><2>Welcome!</2>\n    <3>\n      This is where you can <4>select</4> and <5>sequence</5> student work to\n      facilitate class discussions.\n    </3>\n    <6>\n      To get started, take <7/> <8>snapshots</8> of student work that you want to\n      highlight and discuss.\n    </6>\n    <9>\n      Then return here to organize your snapshots into collections to\n      <10>present</10> to your students.\n    </9>\n    <11>\n      <12>Learn more.</12>\n    </11>\ndashboard-message-welcome =\n    <1>Welcome to your teacher dashboard!</1>\n    <2>\n      This is where you\'ll find student responses as students go through the\n      activity.\n    </2>\ndashboard-prompt-classcode-join-class =\n    \n    <1>\n      <2>Hey, students!</2>\n    <3>\n        <4>Go to</4> <5>{$student_url}</5>\n    </3>  \n      <6>and type in:</6>\n    </1>\nvideo-dashboard-message-no-video =\n    <1>No video uploaded.</1>\n    <2>\n      If you expected to see a video here, try editing this activity and uploading\n      a video.\n    </2>\n### Strings for the "Desbook" curriculum UI\n\n\n### 152 English words, 6 English strings\n\ndesbook-label-attribution =\n    \n    <1>\n    \n    <2>\n         Inspired by and with gratitude to <3>Illustrative Mathematics</3> and\n        OpenUp Resources, which can be downloaded for free at\n        <4>openupresources.org</4>{"."}\n    </2>\n    </1>\ndesbook-teacher-heading-pilot-welcome-intro-narrow =\n    <1>Welcome to</1>\n    <2>\n      <3>Desmos Middle School Math</3>\n    </2>\ndesbook-teacher-heading-pilot-welcome-intro-wide =\n    <1>Welcome to</1>\n    <2>\n      <3>Desmos Middle School Math</3>\n    </2>\ndesbook-teacher-message-intro-banner-feedback =\n    If you have any questions, please dont hesitate to reach out by emailing\n    <1>curriculum@desmos.com</1>{"."}\ndesbook-teacher-prompt-feedback-survey =\n    <1/>Let us know what you thought about this lesson by filling out<2>this\n    survey</2>{"."}\ndesbook-teacher-section-pilot-intro-welcome =\n    \n    <1>\n    \n    <2>\n        <3/>\n    </2>\n    <4>\n    \n    <5>\n          We collaborate with teachers to help their students learn math and love\n          learning math.\n    </5>\n    <6>\n          <7>Teachers</7> bring their deep understanding of math, teaching, and\n          students.\n    </6>\n    <8>\n          <9>Desmos</9> brings some of the most engaging, interactive, and\n          educational math experiences currently available, along with some\n          powerful tools for teaching math.\n    </8>\n    <10>\n          <11>Together</11> we help students learn math with powerful tools,\n          curriculum, and teaching.\n    </10>\n    </4>\n    </1>\n    <12>\n    \n    <13>\n        <14>Explore the curriculum</14><15>Create and manage classes</15>\n    </13>\n    </12>\n## Dictionary of strings for classroom\n\nab-component-button-edit-response = Edit my response\nab-component-button-submit-to-peers = Share with Class\nab-component-description-challenge-creator = Students create and complete challenges for each other\nab-component-error-note-interpolation-lint = Error: CL variable { $variableName } is not defined.\nab-component-message-async-failed = Loading Failed.\nab-component-message-async-loading = Loading...\nab-component-message-async-refresh-message = Try reloading your browser?\nab-component-message-challenge-complete = Challenge Completed\nab-component-message-note-interp-button = Insert a value from Computation Layer\nab-component-message-note-link-disabled = Select text to create a hyperlink\nab-component-message-note-mq-button = Type Math\nab-component-message-note-no-variables = Define a variable in Computation Layer to use it in this note.\nab-component-narration-challenge-check-mark = check mark\nab-component-title-action-button = Button\nab-component-title-cardsort = Card Sort\nab-component-title-challenge = Challenge Creator\nab-component-title-checkboxes = Checkboxes\nab-component-title-expression-input = Math Input\nab-component-title-geometry = Geometry\nab-component-title-graph = Graph\nab-component-title-graphing-calculator = Graphing Calc\nab-component-title-graphing-calculator-full = Graphing Calculator\nab-component-title-image = Image\nab-component-title-marbleslides = Marbleslides\nab-component-title-mc = Choice\nab-component-title-multiple-choice = Multiple Choice\nab-component-title-note = Note\nab-component-title-ordered-list = Ordered List\nab-component-title-penny-widget = Penny Widget\nab-component-title-sketch = Sketch\nab-component-title-student-survey = Student Survey\nab-component-title-table = Table\nab-component-title-text-input = Text Input\nab-component-title-transform = Transformation Golf\nab-component-title-video = Media\nab-edit-button-back-to-alp = Return to the Activity Page\nab-edit-button-calculator-convert-tooltip = Remove all other components on this screen to convert this into a Graphing Calc.\nab-edit-button-component-metadata = Edit component metadata\nab-edit-button-delete-screen = Delete Screen\nab-edit-button-documentation = Documentation\nab-edit-button-duplicate-screen = Duplicate Screen\nab-edit-button-edit-graph = Edit Graph\nab-edit-button-edit-teacher-tip = Edit Teacher Tip\nab-edit-button-get-started = Get started here!\nab-edit-button-learn-more = Learn More\nab-edit-button-leave-editor = Leave Editor\nab-edit-button-metadata = Edit activity metadata\nab-edit-button-more-options-menu = More Options\nab-edit-button-new-screen = New Screen\nab-edit-button-open-script = Open Script\nab-edit-button-preview = Preview\nab-edit-button-remove-standard = Remove { $standardName }\nab-edit-button-screen-metadata = Edit screen metadata\nab-edit-button-scroll-screens-left = Scroll screens to the left\nab-edit-button-scroll-screens-right = Scroll screens to the right\nab-edit-button-start-building = Start Building\nab-edit-button-take-control = Make Yourself the Editor\nab-edit-button-teacher-tips = Teacher Tips\nab-edit-button-upload-media-file = Upload media from a file\nab-edit-description-table-component = Table exhibit or input\nab-edit-description-text-input-component = Ask your students a long-form question.\nab-edit-error-multiple-challenge = This activity already has a challenge creator.\nab-edit-error-paste = Error pasting screen.\nab-edit-error-unexpected =\n    Something went wrong trying to edit this activity. You can reload the page to\n    try again, or return to the landing page by clicking the button below.\nab-edit-heading-modal = Edit Activity Details\nab-edit-heading-non-editable-cover = Unable to edit this component.\nab-edit-heading-share-settings = Share Settings\nab-edit-heading-teacher-tips = Tips for Teachers\nab-edit-label-accessibility-notes = Accessibility Notes\nab-edit-label-activity-category-application = Application\nab-edit-label-activity-category-choose-one = Choose One\nab-edit-label-activity-category-development = Development\nab-edit-label-activity-category-introduction = Introduction\nab-edit-label-activity-category-practice = Practice\nab-edit-label-activity-description = Activity Description\nab-edit-label-activity-subtitle = Activity Subtitle\nab-edit-label-addressing = Addressing\nab-edit-label-advanced-settings = Advanced Settings\nab-edit-label-assessing = Assessing\nab-edit-label-building-on = Building On\nab-edit-label-building-towards = Building Towards\nab-edit-label-category = Category\nab-edit-label-ccss = Common Core Alignment\nab-edit-label-ccss = Common Core State Standards\nab-edit-label-delete-component = Delete Component\nab-edit-label-discard-draft = Discard draft\nab-edit-label-edit-computation-layer = Edit computation layer script\nab-edit-label-edit-computation-layer-for-screen = Edit computation layer for this screen\nab-edit-label-edit-metadata = Edit metadata\nab-edit-label-explain-response = Ask student to explain their answer\nab-edit-label-external-url = Use external asset URL\nab-edit-label-ipad-warning = iPad Warning\nab-edit-label-keywords = Keywords\nab-edit-label-lesson-number = Lesson Number\nab-edit-label-read-only-editor = Read-only Editor\nab-edit-label-save-draft = Save draft\nab-edit-label-scientific-calculator = Enable scientific calculator on student screens\nab-edit-label-scientific-calculator-description =\n    Adds a scientific calculator students can open by clicking the icon at the top\n    of their screen. Teachers can view student calculations in the teacher\n    dashboard.\nab-edit-label-screen-starts-new-section = This screen is the beginning of a new section\nab-edit-label-screen-title-or-instructions = Screen Title or Instructions:\nab-edit-label-show-peer-responses = Show students their classmates responses\nab-edit-label-student-survey-component = Student survey\nab-edit-label-teacher-tips-add = Add Tips for Teachers\nab-edit-label-teacher-tips-edit = Edit Your Tips for Teachers\nab-edit-label-teacher-tips-editing-actions = Teacher Tip Editing Actions\nab-edit-label-time-estimate = Time Estimate\nab-edit-label-time-estimate-15-30 = 15-30 minutes\nab-edit-label-time-estimate-30-45 = 30-45 minutes\nab-edit-label-time-estimate-45-60 = 45-60 minutes\nab-edit-label-time-estimate-60-plus = 60+ minutes\nab-edit-label-time-estimate-choose-one = Choose One\nab-edit-label-unlabeled-component = Unlabeled { $name }\nab-edit-label-vocab = Vocabulary\nab-edit-label-welcome-subtitle = What will you call this activity?\nab-edit-label-welcome-title = Welcome to Activity Builder!\nab-edit-message-blank-cardsort = Welcome to Card Sort! Add a card on the left.\nab-edit-message-cannot-duplicate-cpm-activity-new-editor = This activity can\'t be copied.\nab-edit-message-dashboard-preview-cl-placeholder = Dashboard Preview\nab-edit-message-dashboard-preview-cl-warnings =\n    There are CL warnings, so this might not match the dashboard. Try with fake\n    students.\nab-edit-message-deprecated-cl = This activity can\'t be copied because it contains a deprecated feature.\nab-edit-message-edit-activity-details-link = Edit Activity Details\nab-edit-message-edit-metadata = Edit metadata\nab-edit-message-empty-screen-new-editor = Choose an item on the left to add it to this screen.\nab-edit-message-graph-link = Note: Import any Desmos graph by pasting the URL into an empty expression.\nab-edit-message-locked-table-cell = Students can\'t edit this cell\nab-edit-message-missing-license = This activity can\'t be copied in preview mode.\nab-edit-message-non-editable-cover = The { $componentName } component can\'t be modified yet.\nab-edit-message-starting-session = Starting edit session...\nab-edit-message-woss-preview = Three other students\' responses would show up here.\nab-edit-message-wots-preview = All other teachers\' responses would show up here\nab-edit-narration-component-added = { $component } added\nab-edit-narration-component-removed = { $component } removed\nab-edit-narration-components-column = Components\nab-edit-narration-drag-handle-label = Handle for { $component }. Adjust with Arrow keys.\nab-edit-narration-drag-handle-role-description = drag handle\nab-edit-narration-enable-screen-reader-mode = Press { $command } to enable screen reader mode.\nab-edit-narration-miniscreen-list = Screens List\nab-edit-narration-move-component-above = Moved above { $component }.\nab-edit-narration-move-component-above-left = Moved above and to the left of { $component }.\nab-edit-narration-move-component-above-right = Moved above and to the right of { $component }.\nab-edit-narration-move-component-below = Moved below { $component }.\nab-edit-narration-move-component-below-left = Moved below and to the left of { $component }.\nab-edit-narration-move-component-below-right = Moved below and to the right of { $component }.\nab-edit-narration-move-component-down = Moved down to position { $index }.\nab-edit-narration-move-component-left = Moved to the left of { $component }.\nab-edit-narration-move-component-new-column-left = Moved to new left column.\nab-edit-narration-move-component-new-column-right = Moved to new right column.\nab-edit-narration-move-component-right = Moved to the right of { $component }.\nab-edit-narration-move-component-up = Moved up to position { $index }.\nab-edit-narration-one-column = Now showing one column.\nab-edit-narration-open-documentation = Open documentation\nab-edit-narration-screen-marked-for-swap = { $screenTitle } marked for swap.\nab-edit-narration-screen-reader-mode-on = Screen reader mode is on.\nab-edit-narration-screen-swapped = Swapped with { $screenTitle }.\nab-edit-narration-screen-unmarked-for-swap = { $screenTitle } unmarked.\nab-edit-narration-script-contains-errors = Contains Errors\nab-edit-narration-script-contains-warnings = Contains Warnings\nab-edit-narration-showing-screen-title = Showing { $screenTitle }\nab-edit-narration-two-columns = Now showing two columns.\nab-edit-placeholder-accessibility-notes = Add accessibility notes for teachers\nab-edit-placeholder-add-title = Add a title\nab-edit-placeholder-ccss-add = Add another CCSS\nab-edit-placeholder-ccss-search = Search for CCSS\nab-edit-placeholder-component-name = Unlabeled { $component }\nab-edit-placeholder-ipad-warning = Add a warning if this won\'t work well on iPads.\nab-edit-placeholder-keywords = Add keywords here (comma separated)...\nab-edit-placeholder-screen-title-or-instructions = Add a title or instructions for your students.\nab-edit-placeholder-vocab = Add comma separated vocabulary words\nab-edit-prompt-confirm-delete-screen-long = Are you sure you want to delete this screen?\nab-edit-section-configuration = Configuration\nab-edit-section-convert-to = Convert to\nab-edit-section-dashboard = Dashboard\nab-edit-section-type = Type\nab-edit-title-activity-metadata = Edit activity metadata\nab-edit-title-collaborator-editing = A Collaborator Is Editing\nab-edit-title-component-metadata = Edit component metadata\nab-edit-title-components-basic = Basic\nab-edit-title-components-fullscreen = Fullscreen\nab-edit-title-components-interactive = Interactive\nab-edit-title-custom-image-url = Add image from a custom URL\nab-edit-title-delete-screen = Delete Screen\nab-edit-title-details = Details\nab-edit-title-edit-this-graph = Edit This Graph\nab-edit-title-edit-this-script = Edit This Script\nab-edit-title-new-builder = New to Activity Builder?\nab-edit-title-screen-metadata = Edit screen metadata\nab-edit-title-title = Title\nab-edit-title-untitled-screen = [Untitled Screen]\nab-edit-warning-custom-url-failure = Error loading image. Check the URL?\nab-edit-warning-custom-url-type = Error loading image: not an image or video file.\nab-edit-warning-metadata-version =\n    Warning: this metadata was previously saved with a different version of the\n    schema.\nab-edit-warning-multiple-fullscreen = Create a new blank screen to add a fullscreen component\nab-edit-warning-teacher-tips-unsupported = Tips for Teachers arent supported in Challenge Creator\naccount-button-change-email = Change Email\naccount-button-change-email-password = Change Email and Password\naccount-button-confirm-deletion = Delete your Desmos account?\naccount-button-delete-my-account = Delete my Account\naccount-button-language-preference = Language Preference\naccount-button-menu = Menu\naccount-button-privacy-policy = privacy policy\naccount-button-privacy-policy-titlecase = Privacy Policy\naccount-button-resend-email = Resend Email\naccount-button-reset-password = Reset Password\naccount-button-reset-password-by-email = Reset it by email\naccount-button-send-change-email = Send Email\naccount-button-send-delete-email = Send Delete Account Email\naccount-button-send-feedback = Send Feedback\naccount-button-send-reset-email = Send Email\naccount-button-send-verification = Send Verification Email\naccount-button-sign-in-with-desmos = Sign in with Desmos\naccount-button-sign-in-with-google = Sign in with Google\naccount-button-sign-out = Sign out\naccount-button-sign-out-and-exit = Sign out and exit activity\naccount-button-terms-of-service = terms of service\naccount-button-terms-of-service-titlecase = Terms of Service\naccount-button-title = My Account\naccount-error-could-not-change-password = Error while changing new password.\naccount-error-login-window-blocked =\n    Login window blocked. Please allow popups from desmos.com to sign in with\n    Google.\naccount-error-password-same-as-old = New password cannot match old password.\naccount-error-passwords-do-not-match = Passwords do not match\naccount-error-something-went-wrong = Sorry! Something went wrong. Please try again later.\naccount-heading-admin-dashboard = Admin Dashboard\naccount-heading-change-password-narrow = Password\naccount-heading-change-password-wide = Change Password\naccount-heading-co-teachers = Manage Co-Teachers\naccount-heading-create-account = Create Account\naccount-heading-create-new-password = Create a new password\naccount-heading-edit-name = Name:\naccount-heading-email-settings = Email:\naccount-heading-forgot-password = Forgot your password?\naccount-heading-labs = Desmos Labs\naccount-heading-learn-desmos = Learn Desmos\naccount-heading-new-email = New Email Address\naccount-heading-new-password = New Password\naccount-heading-profile-info-narrow = Profile\naccount-heading-profile-info-wide = Profile Information\naccount-heading-repeat-password = Repeat New Password\naccount-heading-settings = Account Settings\naccount-heading-sign-in = Sign In\naccount-heading-update-password = Update Password\naccount-label-activity-digest-checkbox = Desmos Activity Digest\naccount-label-calculator-digest-checkbox = Desmos Calculator Digest\naccount-label-current-password = Current Password:\naccount-label-email = Email\naccount-label-name = Name\naccount-label-new-password = New Password:\naccount-label-password = Password\naccount-label-reenabled = Account Reenabled\naccount-label-repeat-password = Repeat Password:\naccount-label-settings-modal = Account Settings\naccount-message-activity-digest-detail = Featured activities and teacher.desmos.com updates, delivered monthly\naccount-message-calculator-digest-detail = Featured graphs and calculator updates, delivered monthly\naccount-message-change-email-expired = Change Email Expired\naccount-message-change-email-explanation = We will send a Change Email link to { $emailAddress }.\naccount-message-change-email-sent = Email sent\naccount-message-change-email-sent-explanation = Please check { $emailAddress } for the Change Email link.\naccount-message-check-email-for-delete-link = Please check your email ({ $emailAddress }) for the link to delete your account.\naccount-message-check-email-for-password-change = Please check your email ({ $emailAddress }) for the link to change your password.\naccount-message-cpm-login-for-page = You need to be logged in as a verified CPM user to view this page.\naccount-message-deletion-canceled = Your account deletion has been canceled\naccount-message-deletion-email-sent = Email sent\naccount-message-forgot-password = Forgot your password?\naccount-message-invalid-link = This link is no longer valid.\naccount-message-link-expired =\n    The link you clicked has expired or already been used. Please request a new\n    link in your account settings.\naccount-message-login-for-activity = Please login to view this activity\naccount-message-login-for-alignment = You need to be signed in to view this alignment.\naccount-message-login-for-collection = You must be logged in to see this collection.\naccount-message-login-for-page = You need to be logged in to view this page.\naccount-message-manage-login-password =\n    You can manage your login and password for all Desmos sites through the\n    calculator.\naccount-message-not-verified = Email not verified.\naccount-message-not-you = Not { $user }?\naccount-message-or-create-new-desmos-account = or create a new Desmos account\naccount-message-or-type-your-name = or type your name and create a password\naccount-message-password-reset-email-sent = Email sent\naccount-message-pending-confirmation = Pending confirmation.\naccount-message-request-new-link = Please request a new email verification link in your account settings.\naccount-message-terms-and-privacy-notice = By clicking "Create Account" you are agreeing to our { $terms } and { $privacy }.\naccount-message-unable-to-change-address = We weren\'t able to change your email address.\naccount-message-verification-email-sent-explanation = Verification email sent to { $email }. Please check your email.\naccount-message-will-send-reset-email =\n    We will send a link to your email address ({ $emailAddress }) so you can change\n    your password.\naccount-narration-account-deleted-logo = Account Deleted Logo\naccount-placeholder-email = Email\naccount-placeholder-password = Password\naction-button-edit-label-button-label = Button Label:\naction-button-edit-label-reset-on-navigation = Reset when student navigates away from this screen\naction-button-edit-message-above-graph = Action button will be shown in the top right corner of the graph.\naction-button-edit-message-below-table = Action button will be centered below the table.\naction-button-label-placeholder-try-it = Try It\naction-button-label-try-it = Try It\nalp-button-add-collaborator = Add\nalp-button-assign-to = Assign\nalp-button-collaborate = Collaborate\nalp-button-copy-and-edit = Copy and edit\nalp-button-copy-instance-denied = You need to be signed in to create an activity.\nalp-button-create-class-code = Create Class Code\nalp-button-create-class-denied = You need to be signed in to assign an activity.\nalp-button-create-code = Create Code\nalp-button-create-new-activity = Create New Activity\nalp-button-create-temporary-code = Single Session Code\nalp-button-delete-activity = Delete your activity\nalp-button-edit-activity = Edit your activity\nalp-button-expanding-details-see-less = See Less\nalp-button-manage-class-denied = You need to be signed in to manage classes.\nalp-button-preview = Preview\nalp-button-share-activity = Share activity\nalp-button-student-preview = Student Preview\nalp-error-collaborate-add-error = Error adding collaborator.\nalp-error-collaborate-remove-error = Error removing collaborator.\nalp-heading-accessibility-notes = Accessibility Notes\nalp-heading-add-collaborator = Add a collaborator\nalp-heading-addressing = Addressing\nalp-heading-assessing = Assessing\nalp-heading-building-on = Building On\nalp-heading-building-towards = Building Towards\nalp-heading-classes-section = Activity Sessions\nalp-heading-featured-collections = Looking for more activities like this?\nalp-heading-learning-goals = Learning Goals\nalp-heading-lesson-number = Lesson { $lessonNumber }\nalp-heading-lesson-number-before-subtitle = Lesson { $lessonNumber }:\nalp-heading-lesson-standards = Common Core State Standards\nalp-heading-lesson-summary = Lesson Summary\nalp-heading-new-activity-modal = New Activity\nalp-heading-preview-section = Screens\nalp-heading-vocab = Vocabulary\nalp-label-collaborator-no-email = [no email]\nalp-label-edited-with-love-many-authors = Edited with love by { $authorList }, and { $last }\nalp-label-edited-with-love-one-author = Edited with love by { $author }\nalp-label-edited-with-love-two-authors = Edited with love by { $author1 } and { $author2 }\nalp-label-email-address = Email Address\nalp-label-new-activity-modal = New Activity modal\nalp-message-404-page = We cannot find that activity.\nalp-message-create-activity-error = There was an error creating the activity. Please try again.\nalp-message-own-deprecated-feature =\n    This activity uses "Copy Previous," which is no longer supported. Please edit\n    the activity before using it with students.\nalp-message-share-disabled = This activity is private. Mark it as public to share.\nalp-message-share-social-media = Or share with your friends and followers:\nalp-message-use-this-link = Use This Link:\nalp-placeholder-email-address = Email Address\nalp-placeholder-untitled-activity = Untitled Activity\nalp-prompt-confirm-remove-collaborator-with-email = Are you sure you\'d like to remove { $email }?\nalp-prompt-confirm-remove-collaborator-without-email = Are you sure you\'d like to remove this collaborator?\nalp-title-404-page = 404\nalp-title-collaborate = Collaborate With Colleagues\nalp-title-landing-page = Landing page\nalp-title-share-this-activity = Share This Activity\nalp-warning-title-is-blank = A new activity must have a title.\ncardsort-dashboard-button-show-less = Show less\ncardsort-dashboard-button-show-more = Show more\ncardsort-dashboard-message-no-cards = No cards yet\ncardsort-dashboard-message-no-groups = No groups yet\ncardsort-dashboard-title-preview = Cardsort Preview\ncardsort-edit-button-answer-key = answer key\ncardsort-edit-button-reset-answer-key = Reset answer key\ncardsort-edit-heading-graph-card = Graph Card\ncardsort-edit-heading-image-card = Image Card\ncardsort-edit-heading-text-card = Text Card\ncardsort-edit-label-graph = Graph\ncardsort-edit-label-graph-alt-text = Graph Description:\ncardsort-edit-label-image = Image\ncardsort-edit-label-image-alt-text = Image Description:\ncardsort-edit-label-large-card = Large card\ncardsort-edit-label-remove-graph-card = Remove graph card\ncardsort-edit-label-remove-image-card = Remove image card\ncardsort-edit-label-remove-text-card = Remove text card\ncardsort-edit-label-text = Math or Text\ncardsort-edit-message-click-to-add-graph = Click to add a graph.\ncardsort-edit-message-key-instructions =\n    Group cards to create an answer key. We\'ll use this to check student work in\n    the dashboard.\ncardsort-edit-message-processing = Processing...\ncardsort-edit-title-edit-answer-key = Edit Answer Key\ncardsort-narration-card-joined = Card joined.\ncardsort-narration-card-marked = Card marked.\ncardsort-narration-card-unjoined = Card unjoined.\ncardsort-narration-card-unmarked = Card unmarked.\ncardsort-narration-mark-before-joining = Press M to mark a card before joining.\ncardsort-playground-button-collapse-card = Collapse Card\ncardsort-playground-button-collapse-group = Collapse group of { $numCards } cards\ncardsort-playground-button-expand-group = Expand group of { $numCards } cards\ncardsort-playground-heading-number-cards = { $numCards } cards\ncardsort-playground-instructions-keyboard-interaction =\n    A card sort is on the screen. To start dragging a card, Tab to it and press M\n    to mark it. Next, Tab to the card where you want to drop, and press J to join\n    the two cards together. To unjoin the selected card from a group, press U.\ncardsort-playground-narration-card-role-description = card\ncardsort-title-card = card\ncardsort-title-correct = correct\ncardsort-title-incorrect = incorrect\ncardsort-title-missing = missing\ncarnival-label-graph-screen-scrubber = Animation Position:\nchallenge-dashboard-heading-deleted-challenges = Deleted Challenges\nchallenge-dashboard-heading-submitted-challenges = Submitted Challenges\nchallenge-dashboard-label-no-submitted = No students have submitted challenges.\nchallenge-dashboard-title-incomplete-challenges = Incomplete Challenges\nchallenge-edit-error-too-few-screens =\n    There aren\'t enough screens available for this challenge. Try adding\n    { $suggestedNumber } more first.\nchallenge-edit-error-whole-number-of-steps = Please enter a whole number of steps.\nchallenge-edit-heading-configuration-options = Configuration Options\nchallenge-edit-label-author-skips-response = Author skips the response step\nchallenge-edit-label-number-of-screens = Number of screens in this challenge\nchallenge-edit-label-skip-response-gallery = Skip past other responses after submission (for boring responses...)\nchallenge-playground-button-all-responses = All Responses\nchallenge-playground-button-back-to-gallery = Back to Gallery\nchallenge-playground-button-delete-challenge = Delete Challenge\nchallenge-playground-button-edit-response = Edit Response\nchallenge-playground-button-make-my-challenge = Make My Challenge\nchallenge-playground-button-my-response = My Response\nchallenge-playground-button-resume-editing = Resume Editing My Challenge\nchallenge-playground-button-submit-challenge = Submit Challenge\nchallenge-playground-button-submit-response = Submit Response\nchallenge-playground-error-invalid-configurration =\n    The Challenge is not configured correctly. Make sure there is at least 1\n    creation step, and the necessary number of response steps.\nchallenge-playground-heading-gallery = Class Gallery\nchallenge-playground-heading-my-challenge = My Challenge\nchallenge-playground-heading-other-students = Other Students\' Challenges\nchallenge-playground-label-completed-many = { $count } students completed\nchallenge-playground-label-completed-one = 1 student completed\nchallenge-playground-label-creator = Creator\nchallenge-playground-label-my-challenge = My Challenge\nchallenge-playground-label-submit-in-progress = Your challenge is being submitted...\nchallenge-playground-label-submitted = Submitted\nchallenge-playground-message-no-other-responses = No other responses yet. Check back later!\nchallenge-playground-message-no-responses = No responses yet. Check back later!\nchallenge-playground-message-waiting = Waiting for challenges from your classmates...\nchallenge-playground-prompt-confirm-delete = Are you sure you want to delete your challenge?\nchallenge-playground-title-delete-challenge = Delete Challenge\ncl-docs-button-join-discussion = Join the discussion!\ncl-docs-button-show-deprecated = Show Deprecated\ncl-docs-button-show-internal = Show Internal\ncl-docs-button-try-it = Try It\ncl-docs-button-try-it-preview = Preview\ncl-docs-description-action-button-capture =\n    Sets a variable you want to capture every time the action button is pressed.\n    (Retrieve the history of that variable later using the history source.)\ncl-docs-description-action-button-disabled =\n    Sets a Boolean that determines when the action button is disabled or enabled.\n    (When it\'s disabled, we gray out the button and make it unpressable.)\ncl-docs-description-action-button-label = Sets the text to show on the button. Keep it short.\ncl-docs-description-action-button-press-count = Gets the number of times the action button has been pressed.\ncl-docs-description-action-button-reset-label = Sets the link text we\'ll show that lets the student reset the action button.\ncl-docs-description-action-button-style =\n    Sets the button style. Use "default" for our standard blue style. Red can be\n    used e.g. for a warning or for a confirmatory second click.\ncl-docs-description-action-button-time-since-press =\n    Gets the seconds (plus milliseconds) since the "Submit" button was pressed. It\n    resets to zero if the "reset" link is pressed, or if a component on the same\n    page is focused or edited. By default, it runs to 10 seconds and then stops.\n    Increase that time by passing a parameter, as in timeSincePress(20).\ncl-docs-description-button-history =\n    Gets the last value captured for a variable that was defined using the\n    "capture" sink.\ncl-docs-description-button-last-value = Gets the history of a variable that was defined using the "capture" sink.\ncl-docs-description-button-submit-count = Gets the number of times the input has been submitted.\ncl-docs-description-cardsort-matches-key =\n    Returns whether response matches the answer key. If no answer key provided,\n    returns false\ncl-docs-description-cardsort-total-cards = Number of cards in the Card Sort.\ncl-docs-description-cardsort-total-correct =\n    Number of cards correctly sorted according to the answer key Notes: (1) cards\n    that are supposed to be on their own are marked correct when on their own). (2)\n    cards correctly sorted into an incomplete group count as correct. (3) cards in\n    a group where any card is wrong are all counted as wrong.\ncl-docs-description-challenge-background = specify a thumbnail image of the challenge.\ncl-docs-description-challenge-bounds =\n    Set the bounds of the challengeBackground. Required when challengeBackground is\n    specified!\ncl-docs-description-challenge-prevent-challenge-creation-reason =\n    Has the challenge creator correctly set up their challenge? Warning if not,\n    empty string if so.\ncl-docs-description-challenge-prevent-submission-reason =\n    Can the student submit this challenge? Provide an error message if not, empty\n    string if so.\ncl-docs-description-challenge-repsonse-bounds =\n    Set the bounds of the responseBackground. Required when responseBackground is\n    specified!\ncl-docs-description-challenge-response-background = specify a thumbnail image of the response.\ncl-docs-description-challenge-response-text = specify text to display on a thumbnail of the challenge or response.\ncl-docs-description-challenge-text = specify text to display on a thumbnail of the challenge or response.\ncl-docs-description-correctness-correct =\n    Sets a Boolean value that determines whether or not a gray checkmark is\n    displayed for the student\'s screen in the summary view of the dashboard.\ncl-docs-description-correctness-read-only =\n    Sets a Boolean value that determines whether or not a component will be ignored\n    when determining a screen\'s correctness. If all components have a readOnly\n    value of "true," we display a dash for the student\'s screen in the summary view\n    of the dashboard, indicating teachers can focus their efforts elsewhere.\ncl-docs-description-correctness-warning =\n    Sets a string that is displayed as a tooltip in the teacher dashboard attached\n    to a warning icon.\ncl-docs-description-expression-input-capture =\n    Sets a variable you want to capture every time the expression input is\n    submitted. (Often times this is the numeric value of the expression input.)\n    Retrieve the history of that variable later using the history source.\ncl-docs-description-expression-input-clear-on-reset = If true, when the user goes to edit their expression, we\'ll clear the prior one\ncl-docs-description-expression-input-disable-evaluation = Never show evaluated user-input on student side\ncl-docs-description-expression-input-error-message =\n    An error to show to the student. Note: this will not show up in the teacher\n    dashboard (use the "warning" sink to show warnings to the teacher).\ncl-docs-description-expression-input-explain-content = Content of the "explain" text-box\ncl-docs-description-expression-input-explain-prompt =\n    Sets a string that replaces the generic "Explain your thinking." prompt on the\n    text input when students are asked to explain their answer.\ncl-docs-description-expression-input-initial-latex = Sets the initial value of the expression input. Should be a valid LaTeX string.\ncl-docs-description-expression-input-initial-text =\n    Sets the initial value of the text input when students are asked to explain\n    their thinking.\ncl-docs-description-expression-input-latex =\n    Gets the LaTeX string of the input, which is useful for importing into the\n    graphing calculator, the note, and other components.\ncl-docs-description-expression-input-numeric-value =\n    Gets the evaluated value of an expression input. For example, "2+2" will return\n    the number 4.\ncl-docs-description-expression-input-reset-label = Specify a label for the reset link.\ncl-docs-description-expression-input-show-classmates =\n    Override the "show classmates\' responses" checkbox, and lets you use that\n    feature even when not at the end of a column.\ncl-docs-description-expression-input-show-explain = Should we ask students to explain their answer?\ncl-docs-description-expression-input-show-submit =\n    When true, force show submit button. When false, force hide submit button,\n    unless a source relies on it.\ncl-docs-description-expression-input-submit-disabled =\n    Disable the submit button. Note: even if set to false, the input button will be\n    disabled if the input is empty.\ncl-docs-description-expression-input-submit-label = Specify a label for the submit button.\ncl-docs-description-expression-input-submitted =\n    Gets a Boolean value that indicates whether or not the expression input has\n    been submitted.\ncl-docs-description-expression-input-suffix =\n    Adds a suffix to everything entered by the student. Recommended for inputs that\n    expect a certain unit (e.g. ft) or for percents (use \'%\')\ncl-docs-description-expression-input-time-since-submit =\n    Gets the seconds (plus milliseconds) since the the expression input was\n    submitted. It resets to zero if the student focuses into the input again.\n    Increase that time by passing a parameter, as in timeSincePress(20)\ncl-docs-description-graph-animation-duration =\n    Adds an animation playhead on top of the graph, as if it were a video. This\n    sets the duration for the animation. A non-positive value hides the playhead.\n    Note: only works with graph exhibits.\ncl-docs-description-graph-animation-keyboard-step =\n    Sets the amount of time (in seconds) that an animation moves when its scrubber\n    is adjusted with the Arrow keys. If not specified, the scrubber moves in\n    increments of 1 second. Note: only works with graph exhibits.\ncl-docs-description-graph-animation-time =\n    Gets the position of the animation playhead. Use in conjunction with\n    animationDuration.\ncl-docs-description-graph-audiotrace-reverse =\n    Specifies whether expressions are traversed in reverse order when audio trace\n    is active. This behavior may be desired in situations where the curves you wish\n    a student to examine are declared at the end of the calculator\'s expression\n    list so that they appear in the foreground.\ncl-docs-description-graph-background = Sets the background layer of the graph.\ncl-docs-description-graph-bounds-sink =\n    Sets the bounds of the graph. Commonly used in combination with the\n    "background" sink. This overrides user interaction, so we caution against using\n    it with fullscreen graphs.\ncl-docs-description-graph-bounds-source = Gets the bounds of a graph component.\ncl-docs-description-graph-label-latex = Gets the inner latex content from a point label, based on the name of the point\ncl-docs-description-graph-label-numeric-value = Evaluates to content of a point label, based on the name of the point\ncl-docs-description-graph-label-text = Gets the content from a point label, based on the name of the point\ncl-docs-description-graph-narration =\n    Text which users of screen readers will hear read aloud-- similar to image alt\n    text Narration can be used to describe a graph or sketch, e.g. narration: "The\n    graph shows a plot of time studied (in hours) on the X axis and test scores on\n    the Y axis." One may also include multiple narrations for a graph to separate\n    pieces of information from one another, e.g. narration(1): "A description of\n    the graph\'s main characteristics would go here." narration(2): "The line does\n    not pass through all of the points." In the above example, narration(2) could\n    change as the student interacted with the activity without needing to modify\n    the graph description in narration(1). Separating narrations also minimizes the\n    amount of text a screen reader needs to speak.\ncl-docs-description-graph-number-list-sink =\n    Sets a variable in the calculator to the contents of a list. This will override\n    any existing definitions of that variable.\ncl-docs-description-graph-number-list-source = Gets the list of numbers that was assigned to the variable in the graph.\ncl-docs-description-graph-number-sink =\n    Sets the value of a variable in the calculator. This will override any existing\n    definitions of that variable.\ncl-docs-description-graph-number-source = Gets the numerical value of a variable in the graph.\ncl-docs-description-graph-raw-expression =\n    Adds an expression that\'s exactly the latex provided. Warning: use this with\n    caution! It\'s very brittle.\ncl-docs-description-graph-raw-expression-color =\n    Sets color for an expression, to be used in parallel with rawExpression. Note:\n    this will only work if there is a rawExpression with the same identifier.\n    Warning: use this with caution!!! It`s very brittle.\ncl-docs-description-graph-raw-expression-hidden =\n    Sets the hidden property for an expression, to be used in parallel with\n    rawExpression. Note: this will only work if there is a rawExpression with the\n    same identifier. Warning: use this with caution!!! It\'s very brittle.\ncl-docs-description-graph-raw-expression-point-label =\n    Sets a label for a point. This only works for points defined like A=(1,2), and\n    the identifier needs to match the name given to the point (A in this case).\n    Takes a string. The label next to the point exactly matches the provided\n    string, so the label is turned off if the empty string is provided.\ncl-docs-description-graph-raw-expression-style =\n    Sets the style property for an expression, to be used in parallel with\n    rawExpression. Note: this will only work if there is a rawExpression with the\n    same identifier. For lines, options are: "SOLID", "DOTTED", and "DASHED". For\n    points, options are "POINT", "OPEN", and "CROSS". Warning: use this with\n    caution!!! It\'s very brittle.\ncl-docs-description-graph-trace =\n    Allow tracing curves to inspect coordinates, and showing point coordinates when\n    clicked.\ncl-docs-description-graph-x-axis-label =\n    Sets the string we display along the x-axis. This overrides any user\n    interaction, so we caution against using it with fullscreen graphs.\ncl-docs-description-graph-xmax = Sets xmax for the graph (all four bounds must be set to take effect)\ncl-docs-description-graph-xmin = Sets xmin for the graph (all four bounds must be set to take effect)\ncl-docs-description-graph-y-axis-label =\n    Sets the string we display along the y-axis. This overrides any user\n    interaction, so we caution against using it with fullscreen graphs.\ncl-docs-description-graph-ymax = Sets ymax for the graph (all four bounds must be set to take effect)\ncl-docs-description-graph-ymin = Sets ymin for the graph (all four bounds must be set to take effect)\ncl-docs-description-hidden = When true, this component will not be shown to students\ncl-docs-description-image-alt-text =\n    Sets the string which will be read by screen reading software. Only useful in\n    conjnuction with internalImagePath. Use altText input on the component in other\n    cases.\ncl-docs-description-image-internal-image-path =\n    Hash for an image hosted at https://uploads.desmos.com/activitybuilder/ (just\n    what follows the hash)\ncl-docs-description-lib-and =\n    Takes two booleans and returns true if both are true. Use like "when ___ and\n    ___"\ncl-docs-description-lib-angle-of-line = Returns the angle an xyLine object makes with the x-axis, measured in radians.\ncl-docs-description-lib-bounds-getter = Get the { $name } property from the bounds object\ncl-docs-description-lib-bounds-right = Get the right property from the bounds object\ncl-docs-description-lib-bounds-square =\n    Force the bounds to have a square aspect ratio, while preserving the provided\n    edge.\ncl-docs-description-lib-bounds-stretch = Show the bounds exactly, while allowing the aspect ratio to be non-square.\ncl-docs-description-lib-bounds-top = Get the top property from the bounds object\ncl-docs-description-lib-button-styles =\n    Available styles for a button. "default" is our standard blue button. "red" is\n    our standard red button. "link" is a button that looks like a link\ncl-docs-description-lib-color-list = make a list of colors, e.g. for use in setting available colors in sketch\ncl-docs-description-lib-count-number-usage =\n    Counts numeric constants in a latex string. countNumberUsage(latex) counts all\n    numbers, or if you provide a specific number as an argument, only that number\n    specifically will be counted\ncl-docs-description-lib-difference-function =\n    simpleFunction representing for (lhs) - (rhs) of an equation. Useful for\n    setting equal to zero to test or plot\ncl-docs-description-lib-elementAt =\n    Takes a numberList and an index, and returns the element of the list at that\n    index (starts with 1)\ncl-docs-description-lib-equation-lhs = Latex string for left-hand side of equation\ncl-docs-description-lib-equation-rhs = Latex string for left-hand side of equation\ncl-docs-description-lib-first-defined-value =\n    Takes multiple arguments, all of the same type, and returns the first that\'s\n    valid. Use, for example as "a = firstDefinedValue(exp1.numericValue, 2)". That\n    will return 2 until exp.numericValue is valid.\ncl-docs-description-lib-function = evaluate function with given arguments\ncl-docs-description-lib-graph-layer = Create a layer from a graph. Use it like graphLayer(g.calculatorState)\ncl-docs-description-lib-inequality-difference-function =\n    simpleFunction representing for (greater side) - (lesser side) of an equation.\n    Useful for setting equal to zero to test or plot, with f(x,y)>0\ncl-docs-description-lib-inequality-is-left-greater =\n    Which way does the inequality point? True for "greater than" and "greater than\n    or equal to"\ncl-docs-description-lib-inequality-isStrict = True for strict inequality, False for non-strict inequality\ncl-docs-description-lib-inequality-lhs = Latex string for right-hand side of inequality\ncl-docs-description-lib-inequality-rhs = Latex string for left-hand side of inequality\ncl-docs-description-lib-is-blank = Takes a string and returns a boolean of whether it\'s the empty string.\ncl-docs-description-lib-is-defined =\n    Takes any type and returns a boolean for if it\'s defined. For example, use with\n    the numericValue of an expression input.\ncl-docs-description-lib-is-line-horizontal =\n    Returns a Boolean value given an xyLine object that indicates whether or not\n    the line is horizontal.\ncl-docs-description-lib-is-line-vertical =\n    Returns a Boolean value given an xyLine object that indicates whether or not\n    the line is vertical.\ncl-docs-description-lib-is-undefined =\n    Takes any type and returns a boolean for if it\'s undefined. For example, use\n    with the numericValue of an expression input.\ncl-docs-description-lib-layer-stack = Create a stack of layers from other layers.\ncl-docs-description-lib-length = Takes a numberList and returns its length as a number.\ncl-docs-description-lib-make-bounds =\n    Create a bounds object given left, right, bottom, top. These bounds will have\n    non-square axis, meaning that when applied to a graph/sketch entity, the entity\n    will be stretched to show exactly these bounds.\ncl-docs-description-lib-max = Takes a numberList and returns its largest value as a number.\ncl-docs-description-lib-merge-sketches = Create a sketch from other sketches.\ncl-docs-description-lib-min = Takes a numberList and returns its smallest value as a number.\ncl-docs-description-lib-not = Takes a boolean and returns its opposite. Use like "when not(___)"\ncl-docs-description-lib-numeric-value =\n    Takes a latex string, and evaluates it to a number, if possible. Returns NaN if\n    it fails\ncl-docs-description-lib-or =\n    Takes two booleans and returns true if either one is true. Use like "when ___\n    or ___"\ncl-docs-description-lib-ordered-pair-x = Latex string for first element of pair\ncl-docs-description-lib-ordered-pair-y = Latex string for first element of pair\ncl-docs-description-lib-palette-color-getter = The color { $name } used in the Desmos calculator.\ncl-docs-description-lib-palette-colors = A convenient way to get at colors used by the Desmos calculator.\ncl-docs-description-lib-parse-equation = Takes a latex string, e.g. "2x+y=1" - and returns an equation object\ncl-docs-description-lib-parse-inequality =\n    Takes a latex string, e.g. "2x+y>1" - and returns an inequality object. Does\n    not recognize compound inequalities.\ncl-docs-description-lib-parse-ordered-pair =\n    Takes a latex string - e.g. "(a,2)" - and returns a coordinate pair - e.g. x:\n    "a", y: "2".\ncl-docs-description-lib-pattern-allow-parens =\n    Allow parentheses in this and child patterns (default, unless there is a reject\n    above this point)\ncl-docs-description-lib-pattern-any-of = Match one of several pattern options\ncl-docs-description-lib-pattern-base = Base of the exponent\ncl-docs-description-lib-pattern-contains = Pattern to match any expression that contains given terms somewhere within it\ncl-docs-description-lib-pattern-degree = degree of this nth root\ncl-docs-description-lib-pattern-denominator = denominator of the fraction\ncl-docs-description-lib-pattern-difference = Pattern to parse a difference (subtraction)\ncl-docs-description-lib-pattern-exponent = Pattern to parse an exponent\ncl-docs-description-lib-pattern-expression = Pattern to match any latex expression\ncl-docs-description-lib-pattern-fraction = Pattern to parse an fraction\ncl-docs-description-lib-pattern-integer = Pattern to parse a number, restricted to integers\ncl-docs-description-lib-pattern-literal = Pattern to parse a literal latex string\ncl-docs-description-lib-pattern-match-latex = get the latex that matches this part of the pattern\ncl-docs-description-lib-pattern-matches = Does the provided latex match this pattern?\ncl-docs-description-lib-pattern-minuend = minuend of the difference (a, in a-b)\ncl-docs-description-lib-pattern-mixed-number = Pattern for a mixed number (like 1 1/2)\ncl-docs-description-lib-pattern-mixed-number-denominator = Denominator of fraction portion of mixed number\ncl-docs-description-lib-pattern-mixed-number-numerator = Numerator of fraction portion of mixed number\ncl-docs-description-lib-pattern-mixed-number-numeric-value = Numeric value of this mixed number\ncl-docs-description-lib-pattern-mixed-number-whole = Whole number portion of mixed number\ncl-docs-description-lib-pattern-negated = expression which is negated\ncl-docs-description-lib-pattern-negative = Pattern to match an expression with a negative-sign in front of it\ncl-docs-description-lib-pattern-number = Pattern to parse a number\ncl-docs-description-lib-pattern-number-numeric-value = Numeric value of this number\ncl-docs-description-lib-pattern-numerator = numerator of the fraction\ncl-docs-description-lib-pattern-optional = Allow a term in a sum or product to repeat n times\ncl-docs-description-lib-pattern-parse =\n    Parse latex string and return an a PatternMatch object that matches the\n    structure of this pattern\ncl-docs-description-lib-pattern-power = The exponent that the base is raised to\ncl-docs-description-lib-pattern-product = Pattern to parse product of terms\ncl-docs-description-lib-pattern-radical = Pattern to parse a radical\ncl-docs-description-lib-pattern-radicand = value under the radical sign\ncl-docs-description-lib-pattern-reject-parens = Disallow parentheses in this and child patterns\ncl-docs-description-lib-pattern-repeat = Allow a term in a sum or product to repeat n times\ncl-docs-description-lib-pattern-repeated-n = Number of times this term repeated\ncl-docs-description-lib-pattern-repeated-nth = nth repeated term\ncl-docs-description-lib-pattern-satisfies = Inequality in terms of x which the number must satisfy, e.g. `x>0`\ncl-docs-description-lib-pattern-scientific = Pattern for a number in standard scientific notation\ncl-docs-description-lib-pattern-scientific-coefficient = Numeric value of the coefficient\ncl-docs-description-lib-pattern-scientific-exponent = Numeric value of the coefficient\ncl-docs-description-lib-pattern-scientific-numeric-value = Numeric value of this number\ncl-docs-description-lib-pattern-strict-order = Require terms to be in the order specified\ncl-docs-description-lib-pattern-subtrahend = subtrahend of the difference (b, in a-b)\ncl-docs-description-lib-pattern-sum = Pattern to parse sum of terms\ncl-docs-description-lib-pattern-term-n = The term corresponding to argument { $termNumber } in the pattern\ncl-docs-description-lib-patterns = Patterns for parsing and interpreting equations\ncl-docs-description-lib-random-float =\n    Member function of a random number generator. Takes a and b as inputs\n    arguments, and generates an output float between a and b\ncl-docs-description-lib-random-generator =\n    Create a random number generator. Provide zero or more numeric arguments as\n    seeds (e.g. button.pressCount) if you want the numbers from this generator to\n    re-randomize when those seed values change. See further documentation below.\ncl-docs-description-lib-random-int =\n    Member function of a random number generator. Takes a and b as inputs\n    arguments, and generates an output integer between round(a) and round(b)\n    inclusive. |a| and |b| must both be less than 2^31, or the value will return\n    NaN. That restriction may be relaxed in the future.\ncl-docs-description-lib-rgb = Turns three values between 0 and 255 into a rgb color. Invalid numbers become 0.\ncl-docs-description-lib-set-opacity = set opacity (0 is transparent, 1 is full opacity) of a color\ncl-docs-description-lib-simple-function =\n    Takes a latex string and returns a function which can, for example, be passed\n    into the function sink of a calculator The first argument is the latex string,\n    and additional arguments are The names of the variables to treat as input\n    variables (defaults to one-variable function in terms of x if not specified\ncl-docs-description-lib-skech-layer = Create a layer from a sketch.\ncl-docs-description-lib-sketch-filter-by-color =\n    Filter a sketch to only the strokes and points that match the given color. Note\n    that opacity does not affect this filtering.\ncl-docs-description-lib-sketch-point-count = Takes a sketch and returns the number of points as a number.\ncl-docs-description-lib-sketch-set-color = flatten all strokes and points in this sketch to the provided color\ncl-docs-description-lib-sketch-set-opacity =\n    Change opacity of all strokes and points in the sketch to the provided alpha\n    value. 0 is transparent, 1 is full opacity. Note that using `setColor` after\n    `setOpacity` will override the provided alpha value\ncl-docs-description-lib-sketch-stroke-count = Takes a sketch and returns the number of strokes as a number.\ncl-docs-description-lib-sketch-tool-eraser = The eraser sketch tool.\ncl-docs-description-lib-sketch-tool-line = The line sketch tool.\ncl-docs-description-lib-sketch-tool-pencil = The pencil sketch tool.\ncl-docs-description-lib-sketch-tools = Tools available while sketching\ncl-docs-description-lib-sketch-total-stroke-length =\n    Takes a sketch and returns a number the aggregate length of all strokes as a\n    number.\ncl-docs-description-lib-sketch-transform = Apply an arbitrary transformation to a sketch, by specifying functions\ncl-docs-description-lib-sketch-x-values =\n    Returns a numberList of all x-values that the sketch passes through at a given\n    y value\ncl-docs-description-lib-sketch-y-values =\n    Returns a numberList of all y-values that the sketch passes through at a given\n    x value\ncl-docs-description-lib-slope-of-line = Returns the slope of an xyLine object.\ncl-docs-description-lib-style-getter = The { $styleName } style button.\ncl-docs-description-lib-x-intercept-of-line = Returns the x-intercept of an xyLine object.\ncl-docs-description-lib-xy-line = Create a new xyLine object from the provided latex string.\ncl-docs-description-lib-y-intercept-of-line = Returns the y-intercept of an xyLine object.\ncl-docs-description-mc-choice-content =\n    Sets the content for a given multiple choice option, indexed starting with 1.\n    (This only works if the multiple choice option at this index includes some\n    content already.)\ncl-docs-description-mc-choice-content-source = Gets the string content for choice with the provided index.\ncl-docs-description-mc-explain-content = Content of the "explain" text-box\ncl-docs-description-mc-explain-prompt =\n    Sets a string that replaces the generic "Explain your thinking." prompt on\n    "explain" multiple choice components.\ncl-docs-description-mc-initial-text = Sets the initial value of the text input for explain type multiple choice.\ncl-docs-description-mc-is-selected =\n    Gets a Boolean that describes whether or not a particular multiple choice\n    option has been selected, given the index of that option, starting with 1. This\n    works for explain, simple, or multi-select multiple choice components.\ncl-docs-description-mc-multi-select-heading =\n    Sets the prompt at the beginning of multiSelect. If blank, no prompt will show\n    up. If this sink is unused, we\'ll use the default text: "(Select all that\n    apply)"\ncl-docs-description-mc-prompt =\n    Sets the small italicized prompt above the choices. If blank, no prompt will\n    show up. If this sink is unused and the choice type is multi-select, we will\n    use the default text: "(Select all that apply)"\ncl-docs-description-mc-submit-count = Gets the number of times the multiple choice component has been submitted.\ncl-docs-description-mc-submit-label = Specify a label for the submit button.\ncl-docs-description-mc-submitted =\n    Gets a Boolean value that indicates whether or not the multiple choice\n    component has been submitted.\ncl-docs-description-mc-time-since-submit = Gets the seconds (plus milliseconds) since the "Submit" button was pressed.\ncl-docs-description-mc-wots = Configure WOSS as WOTS for teachers in PD activities\ncl-docs-description-note-content =\n    Sets the content of a note, which is very useful for creating dynamic elements\n    in the note. This also overwrites any text you enter in the note itself. (We\n    will display THAT text in the teacher dashboard, in the thumbnails, and in the\n    teacher guide.)\ncl-docs-description-ordered-list-index-of-item =\n    Returns the sorted index of the item that started with the given index (indexed\n    starting with 1)\ncl-docs-description-ordered-list-initial-order =\n    Takes a numberList of where each item should start. Accepts any numberList as\n    an order (with ties leaving two items in order). e.g. [3, 1, 2] would mean that\n    the first authored item should go last, the 2nd in the first slot, and the 3rd\n    in the middle slot. [.25, 0, .25] would mean that the 2nd item goes first, the\n    1st goes right after, and the 3rd stays 3rd. As soon as a student reorders, the\n    response is locked in and this sink is ignored.\ncl-docs-description-ordered-list-item-at-index =\n    Returns the starting item index of the item that\'s at the given index (indexed\n    starting with 1)\ncl-docs-description-ordered-list-item-content =\n    Sets the content for a given item, indexed starting with 1. (This only works if\n    the item at this index exists.)\ncl-docs-description-ordered-list-matches-key = Returns whether this matches the key (if provided).\ncl-docs-description-ordered-list-order = Returns a numberList of where each item currently is (indexOfItem).\ncl-docs-description-ordered-list-text-at-index =\n    Returns the string for the item that\'s at the given index (indexed starting\n    with 1)\ncl-docs-description-penny-widget-count = Gets the number of pennies currently in the penny dragger circle.\ncl-docs-description-penny-widget-size = Gets the diameter (in inches) of the current penny dragger circle.\ncl-docs-description-reset-on-change = Specify a string value. If that value changes, the component resets.\ncl-docs-description-sketch-allow-eraser =\n    Sometimes you only want students to be able to clear, not erase. Set this to\n    false if that\'s the mood you\'re in.\ncl-docs-description-sketch-audiotrace-reverse =\n    If the sketch has a graph background, specifies whether expressions are\n    traversed in reverse order when audio trace is active. This behavior may be\n    desired in situations where the curves you wish a student to examine are\n    declared at the end of the calculator\'s expression list so that they appear in\n    the foreground.\ncl-docs-description-sketch-available-colors = Configures the available colors in sketch\ncl-docs-description-sketch-background = Sets the background of the sketch.\ncl-docs-description-sketch-bounds-sink =\n    Sets the bounds of this sketch. If the sketch has a graph background, it will\n    be updated to match.\ncl-docs-description-sketch-bounds-source = Gets the bounds of a sketch component.\ncl-docs-description-sketch-current-stroke = Get a sketch object which represents the current stroke in progress.\ncl-docs-description-sketch-current-x =\n    Get the current x-coordinate of the mouse. Works on hover with a mouse and\n    while depressed for touch.\ncl-docs-description-sketch-current-y =\n    Get the current y-coordinate of the mouse. Works on hover with a mouse and\n    while depressed for touch.\ncl-docs-description-sketch-disable-sketch = Sets whether drawing on a sketch is permitted.\ncl-docs-description-sketch-hide-sketch =\n    Hides the student\'s sketch. Also disables sketching, since anything sketched\n    would be hidden.\ncl-docs-description-sketch-initial-color = Sets the starting color.\ncl-docs-description-sketch-initial-tool = Sets the starting tool.\ncl-docs-description-sketch-label-latex =\n    If the sketch has a graph background, gets the inner latex content from a point\n    label in the graph, based on the name of the point\ncl-docs-description-sketch-label-numeric-value =\n    If the sketch has a graph background, evaluates to content of a point label in\n    the graph, based on the name of the point\ncl-docs-description-sketch-label-text =\n    If the sketch has a graph background, gets the text content from a point label\n    in the graph, based on the name of the point\ncl-docs-description-sketch-number-list-sink =\n    If the sketch has a graph background, sets a variable in the calculator to the\n    contents of a list. This will override any existing definitions of that\n    variable.\ncl-docs-description-sketch-number-list-source =\n    If the sketch has a graph background, gets the list of numbers that was\n    assigned to the variable in the graph.\ncl-docs-description-sketch-number-sink =\n    If the sketch has a graph background, sets the value of a variable in the\n    calculator. This will override any existing definitions of that variable.\ncl-docs-description-sketch-number-source =\n    If the sketch has a graph background, gets the numerical value of a variable in\n    the graph.\ncl-docs-description-sketch-object = Get a sketch object which represents everything drawn on this sketch.\ncl-docs-description-sketch-preview-current-stroke =\n    Renders the currentStroke as a thin gray line while drawing, and then performs\n    mutations on mouseup (line smoothing, removes nearby points, joins with other\n    curves). Defaults to true, which is recommended in general. Set to false to\n    render in full color as sketching and disable mutations.\ncl-docs-description-sketch-raw-expression-point-label =\n    If the sketch has a graph background, sets a label for a point on the graph.\n    This only works for points defined like A=(1,2), and the identifier needs to\n    match the name given to the point (A in this case). Takes a string. The label\n    next to the point exactly matches the provided string, so the label is turned\n    off if the empty string is provided.\ncl-docs-description-sketch-trace =\n    If the sketch has a graph background, allow tracing curves to inspect\n    coordinates, and showing point coordinates when clicked.\ncl-docs-description-sketch-x-axis-label =\n    If the sketch has a graph background, sets the string we display along the\n    x-axis.\ncl-docs-description-sketch-y-axis-label =\n    If the sketch has a graph background, sets the string we display along the\n    x-axis.\ncl-docs-description-step-subtitle = Adds a subtitle, centered and under the title for a screen.\ncl-docs-description-step-title =\n    Overrides the provided title with a string value. You can use string\n    interpolation (e.g. "hello ${ name }") and conditionals to build rich text to\n    show to the user. Note: We recommend including placeholder text as the display\n    content, which will appear in the miniscreen, teacher dashboard, and teacher\n    guide.\ncl-docs-description-table-capture = Specify a number to capture. Retrieve all such numbers with the history source.\ncl-docs-description-table-cell-content-sink =\n    Sets the contents of a cell, given the row index and column index of the cell.\n    (Row index 1 is the first row underneath the header.)\ncl-docs-description-table-cell-content-source =\n    Gets the contents of a cell, given a row index and column index. (Row index 1\n    is the first row underneath the header.)\ncl-docs-description-table-cell-disable-evaluation =\n    Disable the evaluation of math typed by the student in this cell. Only affects\n    cells in math type columns.\ncl-docs-description-table-cell-editable =\n    Overrides all other mechanisms of deciding whether the student can edit this\n    cell\ncl-docs-description-table-cell-error-message =\n    An error to show to the student. Note: this will not show up in the teacher\n    dashboard (use the "warning" sink to show warnings to the teacher).\ncl-docs-description-table-cell-has-focus =\n    Gets a Boolean value that indicates whether or not the student is editing a\n    cell, given the row index and column index of the cell. (Row index 1 is the\n    first row underneath the header.)\ncl-docs-description-table-cell-numeric-value =\n    Gets the evaluated numeric value of that cell, given a row index and column\n    index. (Row index 1 is the first row underneath the header.) If a student types\n    "2 + 2" we will return "4".\ncl-docs-description-table-cell-suffix =\n    Adds a suffix to everything entered by the student. Recommended for inputs that\n    expect a certain unit (e.g. ft) or for percents (use \'%\'). Only shows up for\n    expression types of cells!\ncl-docs-description-table-column-numeric-value =\n    Gets the evaluated contents of each cell in a column and return it as a number\n    list, given the column\'s index.\ncl-docs-description-table-disable-row-changes =\n    Sets a Boolean value that indicates whether or not the student can add or\n    remove rows. Similar to fill-in-the-blank mode, but allows for existing cells\n    to be edited. Highly recommended for usage with any cell specific sources.\n    (e.g. cellContent or cellNumericValue.)\ncl-docs-description-table-initial-cell-content =\n    Sets the initial value of the cell at the row index and column index provided.\n    This will unlock the cell and students can override the initial value. Note:\n    should be a valid latex string if setting for a math type of cell (default)\ncl-docs-description-table-max-rows = Sets the number of rows the table will display.\ncl-docs-description-table-submit-button-disabled = Must be used in conjunction with submitButtonText. Disables the submit button.\ncl-docs-description-table-submit-button-text =\n    When set, adds a submit button with this text. Gives a timeSinceSubmit and\n    submitted source. Resets automatically if the student focuses back into the\n    table.\ncl-docs-description-table-submitted =\n    Gets a Boolean value that indicates whether or not the table component has been\n    submitted.\ncl-docs-description-table-time-since-submit = Gets the seconds (plus milliseconds) since the "Submit" button was pressed.\ncl-docs-description-text-input-content = Gets the student input value as a string.\ncl-docs-description-text-input-initial-text = Sets the initial value of the text input.\ncl-docs-description-text-input-show-submit =\n    When true, force show submit button. When false, force hide submit button,\n    unless a source relies on it.\ncl-docs-description-text-input-submit-label = Specify a label for the submit button.\ncl-docs-description-text-input-submitted = Gets a Boolean value indicating whether or not the input has been submitted.\ncl-docs-description-text-input-time-since-submit = Gets the seconds (plus milliseconds) since the "submit" button was pressed.\ncl-docs-description-text-input-wots = Configure WOSS as WOTS for teachers in PD activities\ncl-docs-description-transform-read-only =\n    Sets a Boolean value that determines whether or not a component will be ignored\n    when determining a screen\'s correctness. If all components have a readOnly\n    value of "true," we display a dash for the student\'s screen in the summary view\n    of the dashboard, indicating teachers can focus their efforts elsewhere.\ncl-docs-description-video-time-sink = Sets the playhead time of the video (seconds).\ncl-docs-description-video-time-source = Gets the current playhead time of the video (seconds).\ncl-docs-error-code-sample-not-found = Could not find this code sample.\ncl-docs-heading-component-sinks = Sinks:\ncl-docs-heading-component-sources = Sources:\ncl-docs-heading-component-sources-sample-code = Sample Code:\ncl-docs-heading-functions-table = Functions:\ncl-docs-heading-overview = Overview\ncl-docs-heading-sinks = sinks\ncl-docs-heading-sources = sources\ncl-docs-heading-type-attributes = Attributes:\ncl-docs-label-component-sinks = { $component } Sinks\ncl-docs-label-component-sources = { $component } Sources\ncl-docs-label-deprecated = deprecated\ncl-docs-label-internal = internal\ncl-docs-label-no-sinks = No sinks.\ncl-docs-label-no-sources = No sources.\ncl-docs-label-search-count = Results\ncl-docs-message-complete-prop = Access the variables defined in this component.\ncl-docs-message-mc-multi-select-heading-deprecation = Use prompt instead.\ncl-docs-placeholder-searchbox = Search CL documentation\ncl-docs-title-cl-playground = Computation Layer Playground\ncl-docs-title-component-graph = Graph and Graphing Calc\ncl-docs-title-component-mc = Multiple Choice and Checkboxes\ncl-docs-title-main = Computation Layer Documentation\ncl-docs-title-section-about-cl = About CL\ncl-docs-title-section-advanced = Advanced\ncl-docs-title-section-components = Components\ncl-docs-title-section-functions = Functions\ncl-docs-title-section-overview = Overview\ncl-docs-title-section-patterns = Patterns\ncl-docs-title-section-screen = Screen\ncl-docs-title-section-types = Types\ncl-docs-warning-bounds-strategy-deprecation-notice = Use bounds.squareLeft, bounds.squareRight, etc. instead.\ncl-docs-warning-deprecation-angle-of-line = Use line.angle\ncl-docs-warning-deprecation-is-line-horizontal = Use line.isHorizontal\ncl-docs-warning-deprecation-is-line-vertical = Use line.isVertical\ncl-docs-warning-deprecation-slope-of-line = Use line.slope\ncl-docs-warning-deprecation-x-intercept-of-line = Use line.xIntercept\ncl-docs-warning-deprecation-y-intercept-of-line = Use line.yIntercept\ncl-docs-warning-graph-bounds-deprecation = Try using bounds instead.\ncl-docs-warning-graph-function = Sets the output of simpleFunction() to a variable defined in the graph.\ncl-docs-warning-graph-raw-expression-deprecation = Unsafe! Try using simpleFunction, or parseOrderedPair instead.\ncl-docs-warning-sketch-stroke-count-deprecation = Use sketch.strokeCount instead\ncl-docs-warning-sketch-stroke-point-deprecation = Use sketch.pointCount instead\ncl-docs-warning-sketch-stroke-total-stroke-length-deprecation = Use sketch.totalStrokeLength instead\ncl-docs-warning-sketch-x-values-deprecation = Use sketch.xValuesAt instead\ncl-docs-warning-sketch-y-values-deprecation = Use sketch.yValuesAt instead\ncl-docs-warning-table-submit-button-deprecation = Use an action button instead.\ndashboard-button-add-photo = Add Photo\ndashboard-button-anonymize = Anonymize\ndashboard-button-back-to-dashboard = Back to Dashboard\ndashboard-button-delete-snapshot = Delete\ndashboard-button-download-csv-summary = Download CSV Summary\ndashboard-button-duplicate-snapshot = Duplicate\ndashboard-button-edit-picture-contrast = B&W\ndashboard-button-edit-picture-rotate = Rotate\ndashboard-button-edit-picture-snapshot = Edit\ndashboard-button-hide-student = Hide Student\ndashboard-button-make-data-public = Make this data public\ndashboard-button-overlay = Overlay\ndashboard-button-overview = Overview\ndashboard-button-pacing = Pacing\ndashboard-button-pause = Pause\ndashboard-button-present-snapshot-collection = Present\ndashboard-button-reshuffle = Re-shuffle\ndashboard-button-responses = Responses\ndashboard-button-send-magic-link = Email yourself a magic link!\ndashboard-button-show-answer-key = Show Answer Key\ndashboard-button-shuffle = Shuffle\ndashboard-button-shuffle-name = Shuffle name\ndashboard-button-sort-by-name = Sort by name\ndashboard-button-sort-by-time = Sort by time\ndashboard-button-stop-pacing = Stop Pacing\ndashboard-button-summary = Summary\ndashboard-button-take-photo = Take Photo\ndashboard-button-unhide-student = Unhide Student\ndashboard-button-upload-photo = Upload a File\ndashboard-error-loading-snapshot = Error loading snapshot.\ndashboard-error-snapshot-check-wifi = Error. Check your WiFi?\ndashboard-heading-allow-sample-copies = Allow Sample Copies of This Dashboard\ndashboard-heading-allow-sample-copies-subheader =\n    This makes student data public. Only allow copies of this dashboard when\n    students in this class are adults who have given their permission to share\n    their responses publicly.\ndashboard-heading-link-to-sample-copies = Link to Create Sample Copies\ndashboard-heading-link-to-sample-copies-subheader =\n    Teachers who use this link will get a copy of this dashboard saved to their\n    account.\ndashboard-heading-magic-link = To add photos from another device, open this dashboard there.\ndashboard-instructions-drag-snapshot-to-start-collection = Drag a snapshot here to start a new collection.\ndashboard-label-additional-students = +{ $additionalStudentCount } more\ndashboard-label-answer-key = Answer Key\ndashboard-label-back-to-collection = Back to collection\ndashboard-label-cardsort-summary-most-common-groups = Most Common Groups\ndashboard-label-cardsort-summary-most-common-incorrect-cards = Most Common Incorrect Cards\ndashboard-label-cardsort-summary-most-common-incorrect-groups = Most Common Incorrect Groups\ndashboard-label-go-to-student-screen = Go to student screen\ndashboard-label-hide-from-dashboard = Hide from dashboard\ndashboard-label-hide-responses = Hide Responses\ndashboard-label-no-responses = No responses yet...\ndashboard-label-pace-to-range = Restrict to Screens { $start }  { $end }\ndashboard-label-pace-to-screen = Restrict to Screen { $screenNumber }\ndashboard-label-periscope-student-number = Student { $studentNumber } of { $studentCount }\ndashboard-label-shuffled = Shuffled\ndashboard-label-snapshot-collection-number = Collection { $collectionNumber }\ndashboard-label-snapshot-taken-at = Taken at { $time }\ndashboard-label-snapshots = Snapshots\ndashboard-label-snapshots-disabled = Admins can\'t snapshot\ndashboard-label-sorted-by-name = Name\ndashboard-label-sorted-by-time = Time Entered\ndashboard-label-student = Student\ndashboard-label-student-not-signed-in = Not signed in\ndashboard-label-student-not-signed-in-warning =\n    Note: { $studentName } is not signed in. Feedback will be lost if they leave the\n    activity.\ndashboard-label-student-not-signed-in-warning-anonymous =\n    Note: This student is not signed in. Feedback will be lost if they leave the\n    activity.\ndashboard-label-summary = Summary\ndashboard-label-teacher = Teacher\ndashboard-label-thumb-column-empty-state = Syncing...\ndashboard-label-view-photo = View photo\ndashboard-message-class-management-disabled-for-non-owner = Only the dashboard owner can use Anonymize, Pacing, and Pause.\ndashboard-message-classcode-link = You can also share this link with your students:\ndashboard-message-loading-periscope = Loading { $name }...\ndashboard-message-magic-link-sent = Sent!\ndashboard-message-pacing-restrict-to-single-screen = Restrict to this screen, or select another screen to set a range.\ndashboard-message-pacing-select-screen-to-change-pacing = Select a screen to change pacing for your class.\ndashboard-message-pacing-select-screen-to-change-range = Select a new screen to change your range.\ndashboard-message-pacing-select-screen-to-start-pacing = Select a screen to start pacing your class.\ndashboard-message-photo-snapshots-disabled-for-non-owner =\n    Only the dashboard owner can take photos. Snapshots and collections will be\n    available to everyone with access to the dashboard.\ndashboard-message-request-camera-permission = Please grant the browser permission to access your camera.\ndashboard-message-sample-dashboard = Sample Dashboard\ndashboard-message-sending-feedback-disabled-for-admins = Note: admins can\'t send feedback messages.\ndashboard-message-sending-magic-link = Sending link...\ndashboard-message-snapshot-captured = Snapshot captured!\ndashboard-message-student-hidden = Student Hidden\ndashboard-message-student-not-joined = Student has not started the activity.\ndashboard-message-summary-view-not-implemented = SUMMARY VIEW NOT YET IMPLEMENTED\ndashboard-message-uploading-picture-snapshot = Uploading...\ndashboard-narration-decorator-correct = Correct\ndashboard-narration-decorator-incorrect = Incorrect\ndashboard-narration-decorator-no-input = No Input\ndashboard-narration-decorator-work-submitted = Submitted\ndashboard-narration-next-screen = Next Screen\ndashboard-narration-periscope-next-student = Next Student\ndashboard-narration-periscope-previous-student = Previous Student\ndashboard-narration-picture-controls = Picture Controls\ndashboard-narration-previous-screen = Previous Screen\ndashboard-narration-sample-dashboard-link = Sample Dashboard Link\ndashboard-narration-sample-dashboards = Sample dashboards\ndashboard-narration-screens-list = Screens List\ndashboard-narration-take-snapshot = Take Snapshot\ndashboard-placeholder-comments = Send feedback to { $studentName }\ndashboard-placeholder-snapshot-ask-a-question = Ask a question (optional)\ndashboard-title-sequencing-presentation = Sequencing Presentation\ndashboard-title-snapshot-section-photos = Photos\ndashboard-title-student-periscope = Student Periscope\ndesbook-button-back-to-all-units = Back to All Units\ndesbook-edit-label-about-lesson-plan = About & Lesson Plan\ndesbook-edit-label-learning-goals = Learning Goals\ndesbook-edit-label-overview = Overview\ndesbook-edit-label-student-materials = Student Book\ndesbook-edit-label-video = Lesson Video\ndesbook-error-loading-book = Error loading book. Try reloading the page.\ndesbook-heading-lesson = Lesson { $lessonNumber }\ndesbook-heading-resources = Resources\ndesbook-heading-unit = Unit { $displayUnitId }\ndesbook-heading-unit-lesson = Unit { $displayUnitId }, Lesson { $lessonNumber }\ndesbook-label-activity-long-name-activity = Lesson { $lessonNumber }\ndesbook-label-activity-long-name-activity-no-lesson-number = Lesson\ndesbook-label-activity-long-name-assessment = Assessment\ndesbook-label-activity-long-name-part-one = Lesson { $lessonNumber }, Part 1\ndesbook-label-activity-long-name-part-one-no-lesson-number = Lesson, Part 1\ndesbook-label-activity-long-name-part-two = Lesson { $lessonNumber }, Part 2\ndesbook-label-activity-long-name-part-two-no-lesson-number = Lesson, Part 2\ndesbook-label-activity-long-name-practice-with-lesson-number = Lesson { $lessonNumber } Practice\ndesbook-label-activity-long-name-practice-without-lesson-number = Lesson Practice\ndesbook-label-activity-short-name-activity = Lesson\ndesbook-label-activity-short-name-assessment = Assessment\ndesbook-label-activity-short-name-part-one = Part 1\ndesbook-label-activity-short-name-part-two = Part 2\ndesbook-label-activity-short-name-practice = Practice\ndesbook-label-unassign-lesson-part-one = { $shortName }, Part 1\ndesbook-label-unassign-lesson-part-two = { $shortName }, Part 2\ndesbook-label-unassign-lesson-practice = { $shortName } Practice\ndesbook-message-error-wrong-email-for-invite =\n    This invite is for { $correct-email }, but you logged in as { $your-email }. If\n    you want to continue with Google, please log in with the account that received\n    the invite.\ndesbook-message-lesson-not-found = Unit { $unitId } has no lesson { $lessonId }\ndesbook-message-unit-not-found = Unit { $unitId } not found\ndesbook-teacher-button-activity-dashboard = { $lessonName } Dashboard\ndesbook-teacher-button-add-your-first-classes = Add Your First Class\ndesbook-teacher-button-assign-activity = Assign { $lessonName }\ndesbook-teacher-button-back-to-unit = Back to Unit\ndesbook-teacher-button-hide-inactive-classes = Hide Inactive Classes\ndesbook-teacher-button-lesson-video = Lesson Video\ndesbook-teacher-button-material-copy-edit = Copy and edit\ndesbook-teacher-button-show-inactive-classes = Show Inactive Classes\ndesbook-teacher-button-unassign = Unassign\ndesbook-teacher-button-unassign-activity = Unassign { $name }\ndesbook-teacher-button-view-external = View in { $serviceName }\ndesbook-teacher-error-loading-activity = An error occured while loading this activity. Try reloading the page.\ndesbook-teacher-error-loading-block = Error loading block...\ndesbook-teacher-heading-activity-accessibility-notes = Accessibility Notes for { $activity }\ndesbook-teacher-heading-class-name = Class Name\ndesbook-teacher-heading-materials = Materials\ndesbook-teacher-heading-planning = Planning\ndesbook-teacher-heading-unassign-activity = Unassign Activity\ndesbook-teacher-label-activity = Activity\ndesbook-teacher-label-activity-one = Activity 1\ndesbook-teacher-label-activity-practice = Practice\ndesbook-teacher-label-activity-two = Activity 2\ndesbook-teacher-label-book = Book\ndesbook-teacher-label-book-7 = Math 7\ndesbook-teacher-label-book-8 = Math 8\ndesbook-teacher-label-lesson-guide = Lesson Guide\ndesbook-teacher-label-practice-guide = Practice Guide\ndesbook-teacher-message-error-coteacher-unlicensed =\n    Cannot add { $email } as a coteacher because they do not have permission to\n    access the Desmos Math Curriculum.\ndesbook-teacher-message-no-dashboard = No Dashboard\ndesbook-teacher-message-paper-lesson = This is a paper lesson\ndesbook-teacher-message-warning-coteacher-unlicensed = { $email } does not have access to Desmos Middle School Math content. They will be able to view dashboards, but will not be able to assign lessons or view support materials. If you would like grant them more access, please email curriculum@desmos.com.\ndesbook-teacher-prompt-confirm-unassign-lesson-many =\n    { $studentCount ->\n        [one]\n            { $studentCount } student has already joined this activity and will still be able to access their work from\n            student.desmos.com.\n       *[other]\n            { $studentCount } students have already joined this activity and will still be able to access their work from\n            student.desmos.com.\n    }\ndesbook-teacher-prompt-intro-banner-get-started = Get started with Desmos Middle School Math\ndesbook-teacher-title-old-unit = Unit { $unit } (archived)\ndesbook-teacher-title-unit = Unit { $unit }\ndesbook-title-desmos-math = Desmos Math\nexpression-input-dashboard-heading-expression = Expression\nexpression-input-dashboard-heading-students = Students\nexpression-input-edit-label-math-answer-box = Math answer box\nexpression-input-error-cannot-evaluate = Cannot evaluate expression.\nexpression-input-prompt-explain = Explain your thinking.\nfeedback-description-check-again-reaction = Updated my work! Resubmit to teacher.\nfeedback-description-question-reaction = I have a question.\nfeedback-label-confirm-delete = Are you sure you want to delete this feedback?\nfeedback-label-delete = Delete Feedback\nfeedback-label-delete-feedback = Delete feedback\nfeedback-label-edit-feedback = Edit feedback\nfeedback-label-edited = Edited\nfeedback-label-new-feedback = New Feedback\nfeedback-label-unread-feedback = Unread by Student\nfeedback-label-update = Update\nfeedback-narration-unread-comment-count =\n    { $count ->\n        [one] One unread comment\n       *[other] { $count } unread comments\n    }\nglobal-button-accessibility = Accessibility\nglobal-button-add = Add\nglobal-button-add-class = Add class\nglobal-button-assessments = Assessments\nglobal-button-back = Back\nglobal-button-blog = Blog\nglobal-button-cancel = Cancel\nglobal-button-clear = Clear\nglobal-button-close = Close\nglobal-button-close-dialog = Close Dialog\nglobal-button-continue-to-desmos = Continue to Desmos\nglobal-button-copy = Copy\nglobal-button-delete = Delete\nglobal-button-discard-changes = Discard Changes\nglobal-button-done = Done\nglobal-button-edit = Edit\nglobal-button-enter-fullscreen = Enter Fullscreen\nglobal-button-exit-fullscreen = Exit Fullscreen\nglobal-button-keypad-close = Close Keypad\nglobal-button-keypad-open = Open Keypad\nglobal-button-learn-more = Learn more.\nglobal-button-learn-more-capitalized = Learn More\nglobal-button-learn-more-lowercase = Learn more\nglobal-button-newsletter = Newsletter\nglobal-button-next = Next\nglobal-button-ok = OK\nglobal-button-previous = Previous\nglobal-button-privacy = Privacy\nglobal-button-publish = Publish\nglobal-button-redo = Redo\nglobal-button-reload-page = Reload Page\nglobal-button-remove = Remove\nglobal-button-save = Save\nglobal-button-send = Send\nglobal-button-share = Share\nglobal-button-skip-to-content = Skip to Main Content\nglobal-button-stop = Stop\nglobal-button-submit = Submit\nglobal-button-terms = Terms\nglobal-button-undo = Undo\nglobal-button-view = View\nglobal-description-share-setting-link = Anyone with the link can view\nglobal-description-share-setting-private = Only you can view\nglobal-error-loading-blocks = Error loading classes. Try reloading the page.\nglobal-error-uh-oh = Uh-oh! { $msg }\nglobal-error-unexpected-try-reloading = Unexpected Error. Try reloading the page.\nglobal-heading-actions = Actions\nglobal-heading-lesson-feedback = Lesson Feedback\nglobal-heading-rotate-ipad = Rotate your iPad!\nglobal-heading-scientific-calculator = Scientific Calculator\nglobal-heading-share-settings = Share Settings\nglobal-heading-small-screen-warning = Small screen warning!\nglobal-label-activity-page = Activity Page\nglobal-label-add-description = Add a description for screen readers.\nglobal-label-add-image-drag-or-click-upload = Add an image by dragging it here or clicking to upload.\nglobal-label-at-time = at { $time }\nglobal-label-beta = Beta\nglobal-label-copy = Copy\nglobal-label-copy-error = Unable to copy link\nglobal-label-copy-success = Link copied\nglobal-label-date-at-time = { $date } at { $time }\nglobal-label-drop-image-here = Drop Image Here\nglobal-label-filter = Filter by\nglobal-label-go-to-screen-number = Go to screen { $screenNumber }\nglobal-label-google-classroom = Google Classroom\nglobal-label-language = Language\nglobal-label-math-tools = Math Tools\nglobal-label-none-selected = None selected\nglobal-label-options = Options\nglobal-label-polygraph = Polygraph\nglobal-label-required = required\nglobal-label-resources = Resources\nglobal-label-screen-number = Screen { $screenNumber }\nglobal-label-screen-number-with-total = Screen { $screenNumber } of { $screenCount }\nglobal-label-share-dashboard-link = Share this link with any co-teacher\nglobal-label-share-setting-link = Link\nglobal-label-share-setting-private = Private\nglobal-label-timeago-days-ago =\n    { $d ->\n        [one] a day ago\n       *[other] { $d } days ago\n    }\nglobal-label-timeago-hours-ago =\n    { $h ->\n        [one] an hour ago\n       *[other] { $h } hours ago\n    }\nglobal-label-timeago-in-days =\n    { $d ->\n        [one] in a day\n       *[other] in { $d } days\n    }\nglobal-label-timeago-in-hours =\n    { $h ->\n        [one] in a hour\n       *[other] in { $h } hours\n    }\nglobal-label-timeago-in-minutes =\n    { $m ->\n        [one] in a minute\n       *[other] in { $m } minutes\n    }\nglobal-label-timeago-in-months =\n    { $m ->\n        [one] in a month\n       *[other] in { $m } months\n    }\nglobal-label-timeago-in-seconds = in a few seconds\nglobal-label-timeago-in-weeks =\n    { $w ->\n        [one] in a week\n       *[other] in { $w } weeks\n    }\nglobal-label-timeago-in-years =\n    { $y ->\n        [one] in a year\n       *[other] in { $y } years\n    }\nglobal-label-timeago-minutes-ago =\n    { $m ->\n        [one] a minute ago\n       *[other] { $m } minutes ago\n    }\nglobal-label-timeago-months-ago =\n    { $m ->\n        [one] a month ago\n       *[other] { $m } months ago\n    }\nglobal-label-timeago-seconds-ago = a few seconds ago\nglobal-label-timeago-weeks-ago =\n    { $w ->\n        [one] a week ago\n       *[other] { $w } weeks ago\n    }\nglobal-label-timeago-years-ago =\n    { $y ->\n        [one] a year ago\n       *[other] { $y } years ago\n    }\nglobal-label-today = Today\nglobal-label-uploading-your-image = Uploading your image...\nglobal-label-yesterday-at-time = Yesterday at { $time }\nglobal-message-copied-to-clipboard = Copied to clipboard!\nglobal-message-error = Error\nglobal-message-error-loading = Error loading, please try reloading the page.\nglobal-message-error-loading-simple = Error loading.\nglobal-message-error-saving = Error saving. Try reloading the page.\nglobal-message-error-saving-1-minute = Your work was last saved 1 minute ago. Retrying...\nglobal-message-error-saving-several-minutes = Your work was last saved { $minutes } minutes ago. Retrying...\nglobal-message-error-unknown = Unknown Error\nglobal-message-have-new-feedback = You have new feedback\nglobal-message-intentionally-blank = This area intentionally left blank.\nglobal-message-loading = Loading...\nglobal-message-publishing = Publishing...\nglobal-message-saved = Saved!\nglobal-message-saving = Saving...\nglobal-message-screen-intentionally-blank = This screen intentionally left blank.\nglobal-message-try-again = Try again.\nglobal-narration-back = Back\nglobal-narration-desmos-logo = Desmos Logo\nglobal-narration-forward = Forward\nglobal-narration-screen-number = Showing screen { $screenNumber }\nglobal-prompt-choose-one = Choose One\nglobal-term-classcode = class code\nglobal-term-code = code\nglobal-term-session-code = session code\nglobal-term-session-name = sessions\nglobal-title-error-saving = Error Saving\nglobal-title-scientific-calculator = Scientific Calculator\nglobal-title-screen-reader-preview = Screen Reader Preview\ngraph-button-pause = Pause\ngraph-button-play = Play\ngraph-dashboard-title-graph-show-original = Show Original\ngraph-edit-button-cancel-copy = No, thanks. Make this a blank graph.\ngraph-edit-button-insert-external-image = Insert image from external URL\ngraph-edit-label-copy-previous = Copy Previous\ngraph-edit-message-copy-exhibit-mode =\n    We\'ll make a copy of your students\' last graph so you can ask them questions\n    about it.\ngraph-edit-message-copy-input-mode = We\'ll make a copy of your students\' last graph so they can add to it.\ngraph-label-scrubber = Animation Position:\nimage-edit-button-edit-url = Edit Image URL\nimage-edit-instructions-description = Describe this image for students who are visually impaired.\nimage-edit-label-allow-fullscreen = Allow Fullscreen\nimage-edit-label-custom-url = Enter a URL from which to load the image.\nimage-edit-label-description = Image Description:\nimage-edit-label-show-border = Show Border\nimage-edit-placeholder-enter-url = Enter URL...\nimage-edit-title-media-upload = Media Upload\nimage-edit-warning-video-found = Expected an image, but found a video instead.\nmarbleslides-button-launch = Launch\nmarbleslides-edit-label-ball = Ball:\nmarbleslides-edit-label-ball-start = Ball start\nmarbleslides-edit-label-stars = Stars\nmarbleslides-edit-label-stars-colon = Stars:\nmarbleslides-edit-label-start = Start\nmarbleslides-narration-captured-star = Captured star at { $position }\nmarbleslides-narration-details-hotkey = For details, press ALT+R.\nmarbleslides-narration-details-hotkey-apple = For details, press OPTION+R.\nmarbleslides-narration-launch = To launch the marbles, press ALT+L.\nmarbleslides-narration-launch-apple = To launch the marbles, press OPTION+L.\nmarbleslides-narration-launching = launching\nmarbleslides-narration-log-hit-curve-at = Hit { $curve } at { $position }\nmarbleslides-narration-log-hit-star-index-at = Hit star { $index } at { $position }\nmarbleslides-narration-log-marble-at-position = Marble at { $position }\nmarbleslides-narration-log-marble-fell-off-screen = Marble fell off screen\nmarbleslides-narration-log-marble-started-at = Started at { $position }\nmarbleslides-narration-log-marble-stopped = Marble came to a stop\nmarbleslides-narration-log-star-position = Star { $num } at { $position }\nmarbleslides-narration-marble-at-position = Marble at { $position }\nmarbleslides-narration-marbleslides-is-ready = Marbleslides is ready.\nmarbleslides-narration-move = To move to the expression list, press CTRL+ALT+E.\nmarbleslides-narration-move-apple = To move to the expression list, press CTRL+COMMAND+E.\nmarbleslides-narration-not-started-yet = Nothing has happened yet. Try launching the marble.\nmarbleslides-narration-repeat-message = Press ALT+P to hear this message again.\nmarbleslides-narration-repeat-message-apple = Press OPTION+P to hear this message again.\nmarbleslides-narration-resetting = resetting\nmarbleslides-narration-sound-effects-off = Sound effects off.\nmarbleslides-narration-sound-effects-on = Sound effects on.\nmarbleslides-narration-sound-off = Sound effects are on. Press ALT+A to turn them off.\nmarbleslides-narration-sound-off-apple = Sound effects are on. Press OPTION+A to turn them off.\nmarbleslides-narration-sound-on = Sound effects are off. Press ALT+A to turn them on.\nmarbleslides-narration-sound-on-apple = Sound effects are off. Press OPTION+A to turn them on.\nmarbleslides-narration-star-at-position = Star { $index } at { $position }\nmarbleslides-narration-star-count = This screen has { $count } stars.\nmarbleslides-narration-success = Success!\nmarbleslides-narration-summary-hit-all-stars = You hit all the stars!\nmarbleslides-narration-summary-hit-no-stars = You didn\'t hit any stars.\nmarbleslides-narration-summary-hit-some-stars = You hit { $count } out of { $total } stars.\nmarbleslides-narration-unable-to-launch = Unable to launch\nmc-dashboard-label-no-choices-selected = Nothing selected\nmc-edit-button-add-new-choice = Add an option\nmc-edit-button-layout-buttons = buttons\nmc-edit-button-layout-default = default\nmc-edit-button-layout-grid = grid\nmc-edit-button-layout-list = list\nmc-edit-button-layout-segment = segment\nmc-edit-button-mark-as-correct = Mark as Correct\nmc-edit-error-upload-error = An error occurred while uploading\nmc-edit-instructions-choice-label = Type here. e.g. "y=x^2" or "option 1"\nmc-edit-instructions-image-description = Describe this image for students who are visually impaired.\nmc-edit-label-card-label = Label (optional)\nmc-edit-label-correct-answer = Correct Answer\nmc-edit-label-enforce-option-selected = Always have a selected option\nmc-edit-label-image-description = Image Description:\nmc-edit-label-layout = Layout:\nmc-edit-label-randomize-choices = Randomize choices\nmc-edit-label-remove = Remove Choice\nmc-edit-label-show-explain-at-end = Explain at end of layout\nmc-edit-message-explain-prompt-default = After picking a choice, we\'ll ask students: "{ $defaultPrompt }"\nmc-edit-message-explain-prompt-from-cl = After picking a choice, we\'ll show students a prompt set by CL.\nmc-edit-message-loading-graph = Loading graph...\nmc-prompt-explain-your-thinking = Explain your thinking.\nmc-prompt-select-all-that-apply = (Select all that apply.)\nordered-list-edit-button-add-item = Add an item\nordered-list-edit-instructions-item-text = Type here. e.g. "y=x^2" or "option 1"\nordered-list-edit-label-has-answer-key = Use Order as Answer Key\nordered-list-edit-label-order-from = Order from:\nordered-list-edit-label-order-to = To:\nordered-list-edit-label-randomize-items = Randomize Items\nordered-list-edit-label-remove-item = Remove Item\nordered-list-edit-placeholder-bottom-label = bottom label (optional)\nordered-list-edit-placeholder-top-label = top label (optional)\nordered-list-instructions-bottom-only =\n    A reorderable list of { $itemCount } items is on the screen. Arrange items so\n    that { $bottomLabel } is at the bottom. Tab to the listbox, and press the Up and\n    Down Arrow keys to move, and the Spacebar to select or unselect an item.\nordered-list-instructions-no-labels =\n    A reorderable list of { $itemCount } items is on the screen. Tab to the listbox,\n    and press the Up and Down Arrow keys to move, and the Spacebar to select or\n    unselect an item.\nordered-list-instructions-top-and-bottom =\n    A reorderable list of { $itemCount } items is on the screen. Arrange items so\n    that { $topLabel } is at the top and { $bottomLabel } is at the bottom. Tab to\n    the listbox, and press the Up and Down Arrow keys to move, and the Spacebar to\n    select or unselect an item.\nordered-list-instructions-top-only =\n    A reorderable list of { $itemCount } items is on the screen. Arrange items so\n    that { $topLabel } is at the top. Tab to the listbox, and press the Up and Down\n    Arrow keys to move, and the Spacebar to select or unselect an item.\nordered-list-narration-moved-down = Moved below { $item }.\nordered-list-narration-moved-up = Moved above { $item }.\nordered-list-narration-moving-item = Moving { $item }.\nordered-list-narration-stop-moving-item = Stop moving { $item }.\npartner-dashboard-button-disable-account = Disable Account\npartner-dashboard-button-reactivate-account = Re-activate Account\npartner-dashboard-label-remove-user = Remove User\npenny-widget-label-diameter = Diameter: { $size }"\nplayground-button-close-image = Close Image\nplayground-button-previous-screen = Previous Screen\nplayground-button-sketch-eraser-tool = Eraser\nplayground-button-sketch-line-tool = Line\nplayground-button-sketch-pencil-tool = Pencil\nplayground-button-sketch-points-tool = Points\nplayground-error-could-not-start-activity = Uh oh! We could not start this activity\nplayground-error-forbidden = You are logged in as the wrong user.\nplayground-error-try-reloading = Try reloading the page.\nplayground-error-unauthorized = You must be logged in to see this page.\nplayground-label-math-helper = Learn how to type math.\nplayground-label-next-screen = Next Screen\nplayground-label-step-number = { $stepNumber } of { $stepCount }\nplayground-message-activity-paused = Activity Paused\nplayground-message-fetching-class-status = Fetching class status...\nplayground-message-initializing-activity = Initializing activity...\nplayground-message-nav-disabled = Wait for your teacher to allow access to this screen.\nplayground-message-paused-cover-nice-try = Nice try... :) your activity will be back when your teacher unpauses.\nplayground-message-woss-waiting-for-responses = Wait here for 3 of your classmates\' responses, or go on whenever you\'re ready.\nplayground-message-wots-waiting-for-responses = Other teachers\' responses will show up here as they do this activity\nplayground-title-woss = Other students answered:\nplayground-title-wots = Other teachers answered:\nprosemirror-button-remove-link = Remove Link\nprosemirror-button-update-link = Update Link\nprosemirror-label-enter-link = Enter link\nprosemirror-label-image = image\nprosemirror-label-interp = Interpolation\nprosemirror-label-link = link\nprosemirror-label-list = list\nprosemirror-label-math = math\nprosemirror-label-math-edit-button = Type Math\nprosemirror-label-upload-image = Upload an image\nprosemirror-placeholder-enter-link = Link to URL address\nprosemirror-title-edit-link = Edit Link\nsite-button-edit-access = Edit Access\nsite-button-invite-accept = Accept\nsite-button-invite-decline = Decline\nsite-button-invite-new-users = Invite new users\nsite-error-invalid-email-address = { $email } is not a valid email address.\nsite-error-invite-expired = This invitation has expired. Please contact your site administrator.\nsite-error-invite-not-found = We couldn\'t find the invitation to join the curriculum. Please contact your site administrator.\nsite-error-invite-re-send = Failed to re-send invitation.\nsite-error-make-admin = Failed to make { $email } an admin.\nsite-error-remove-admin = Failed to remove admin permissions from { $email }.\nsite-label-access-site-contact = Site Contact\nsite-label-access-teacher = Teacher\nsite-label-account-not-created = Account Not Yet Created\nsite-label-cancel-invitation = Cancel Invitation\nsite-label-column-actions = Actions\nsite-label-column-email = Email\nsite-label-column-roles = Role(s)\nsite-label-column-status = Status\nsite-label-column-user-name = User name\nsite-label-curriculum-access-accepted = Accepted\nsite-label-curriculum-access-declined = Declined\nsite-label-curriculum-access-deleted = Deleted\nsite-label-curriculum-access-pending = Pending\nsite-label-invite-again = Invite Again\nsite-label-make-admin = Make Site Contact\nsite-label-remove-admin = Remove Site Contact Permissions\nsite-label-remove-from-site = Remove from Site\nsite-label-resend-email = Resend Invitation Email\nsite-message-access-expiration = Desmos Middle School Math access will expire { $expirationDate }\nsite-message-invite-cancelled = The invitation to { $email } was cancelled.\nsite-message-invite-contact-multiple = Accept the invitation below or email one of the following site contacts if you have any questions:\nsite-message-invite-re-sent = Email invitation re-sent.\nsite-message-user-removed = { $email } was removed from { $siteName }.\nsite-narration-copy-invite-link = Curriculum invite link for { $email }\nsketch-dashboard-label-show-background = Show Background\nsketch-edit-button-background = Background\nsketch-edit-button-blank-background = Blank Background\nsketch-edit-button-custom-image = Custom Image\nsketch-edit-button-editable-graph = Editable Graph\nsketch-edit-button-pattern = Pattern\nsketch-edit-label-points-mode = Points Mode\nsketch-edit-message-sketch-area-below = Students will be able to sketch below. Preview to try it out!\nsketch-edit-prompt-customize-background = Try customizing the background!\nsketch-label-aria-color-black = black\nsketch-label-aria-color-blue = blue\nsketch-label-aria-color-green = green\nsketch-label-aria-color-orange = orange\nsketch-label-aria-color-purple = purple\nsketch-label-aria-color-red = red\nsketch-label-aria-color-unknown = color unknown\nsketch-label-change-color = Change Color\nsketch-label-colors-aria = Colors\nsketch-label-tools-aria = Sketch Tools\nstudent-button-back-home = Back Home\nstudent-button-back-to-challenge-gallery = Back to Gallery\nstudent-button-back-to-home = Back to Home\nstudent-button-back-to-sign-in = Back to sign-in options\nstudent-button-begin-activity = Begin { $activityName }\nstudent-button-close-video = Close Video\nstudent-button-create-an-account = Create an account.\nstudent-button-enter-classcode = Enter a { $classcode }\nstudent-button-go = Go!\nstudent-button-history = History\nstudent-button-history-open = Open\nstudent-button-history-see-all = See All\nstudent-button-join-class = Join\nstudent-button-join-with-google-classroom = Join with Google Classroom\nstudent-button-start-activity = Start\nstudent-button-submit-and-explain = Submit and Explain\nstudent-description-google-classroom-login =\n    Your teacher is using Google Classroom. Please join with your Google Classroom\n    account.\nstudent-error-activity-requires-login = This activity requires you to be logged in\nstudent-error-class-code-external = This class cannot be joined with a class code.\nstudent-error-class-code-inactive = That code is inactive. Ask your teacher to refresh the code.\nstudent-error-could-not-find-class-code = Sorry! We couldn\'t find that code.\nstudent-error-google-classroom-login = Please log in with your Google Classroom account\nstudent-error-internal-server = Internal Server Error\nstudent-error-not-in-external-class =\n    Sorry, it looks like { $email } is not part of this { $serviceName } class. Try\n    signing in with another account or ask your teacher for help.\nstudent-error-something-went-wrong = Sorry! Something went wrong!\nstudent-error-wrong-domain-many = Please log in to one of the following email accounts using Google: { $domains }\nstudent-error-wrong-domain-one = Please log in to your { $domain } account using Google\nstudent-heading-greeting-sign-in = Sign in to your account\nstudent-heading-history-activity-name = activity name\nstudent-heading-history-date = date assigned\nstudent-heading-homepage-class = class\nstudent-heading-join-activity = Link to Join Activity\nstudent-heading-learn-together = Let\'s learn together.\nstudent-heading-recent-activites = Recent Activities\nstudent-heading-welcome = Welcome!\nstudent-heading-welcome-back-user = Welcome back, { $user }!\nstudent-heading-your-activities = Your activities\nstudent-label-activity-thumbnail = Thumbnail image for { $activityName }\nstudent-label-create-an-account = Create an Account\nstudent-label-enter-your-name = Enter your name:\nstudent-message-continue-activity = Continue the activity, { $user }!\nstudent-message-continue-without-signing-in = Continue without signing in\nstudent-message-greeting-create-account = Don\'t have an account yet? Ask your teacher for a code and enter it above.\nstudent-message-history-no-saved-activities = You don\'t have any saved activities yet.\nstudent-message-no-recent-activities = You don\'t have any recent activities yet.\nstudent-message-sign-in = Please sign in to join this class.\nstudent-message-welcome = Welcome!\nstudent-message-welcome-to-activity = Welcome to\nstudent-narration-student-welcome-logo = Student Welcome Logo\nstudent-prompt-enter-a-class-code = Enter a { $classcode }\nstudent-prompt-enter-class-code = Enter your code\nstudent-prompt-enter-code-join = Enter a Code to Join\nstudent-prompt-enter-name-to-begin = Enter your name(s) to begin:\nstudent-prompt-history-enter-code = Enter a code to begin an activity:\nstudent-prompt-want-to-sign-up = Want to sign up for Desmos?\nstudent-survey-label-feel-about-learning-max = I liked it.\nstudent-survey-label-feel-about-learning-mid = It was okay.\nstudent-survey-label-feel-about-learning-min = I didn\'t like it.\nstudent-survey-label-understanding-max = I can work on my own now.\nstudent-survey-label-understanding-mid = I think I get it.\nstudent-survey-label-understanding-min = I need help.\nstudent-survey-prompt-feel-about-learning = How did you feel about learning math in this lesson?\nstudent-survey-prompt-understanding = How well did you understand the math in this lesson?\nstudent-title-account-settings = Account Settings\ntable-dashboard-heading-original = Original\ntable-dashboard-label-extra-rows = + { $additionalRows } rows\ntable-edit-button-delete-column = Delete column\ntable-edit-button-format-as-math = Format as math\ntable-edit-button-format-as-text = Format as text\ntable-edit-button-insert-column-left = Insert column left\ntable-edit-button-insert-column-right = Insert column right\ntable-edit-heading-headers = Headers\ntable-edit-label-allow-adding-rows = Allow students to add rows\ntable-edit-label-column-headers = Top\ntable-edit-label-lock-filled = Lock filled cells\ntable-edit-label-row-headers = Left\ntable-edit-label-show-math-helper = Show math helper link below table\nteacher-button-about-us = About Us\nteacher-button-activity-history = Activity History\nteacher-button-activity-seesion-actions = Activity session actions\nteacher-button-add-a-block = Add a Class\nteacher-button-add-activity-to-collection = Add to Collection\nteacher-button-add-block = Add New Class\nteacher-button-add-collection = Add Collection\nteacher-button-archive-instance = Archive\nteacher-button-browse-other-activities = Browse other activities\nteacher-button-browse-your-collections = Browse your collections\nteacher-button-careers = Careers\nteacher-button-class-roster = Class Roster\nteacher-button-close-block-error = Close error message\nteacher-button-collection-add-activity = Add Activity\nteacher-button-collection-add-content = Add Activity or Collection\nteacher-button-collection-add-section = Add Section\nteacher-button-collection-back-to-view = Back to Your Collection\nteacher-button-collection-take-control = Take Control\nteacher-button-collections = Collections\nteacher-button-computation-layer-docs = Computation Layer Documentation\nteacher-button-copy-apple = Copy This Screen (cmd+c)\nteacher-button-copy-windows = Copy This Screen (ctrl+c)\nteacher-button-create-new-collection = Create New Collection\nteacher-button-custom = Custom\nteacher-button-deactivate-block = Deactivate Class\nteacher-button-delete-block = Delete Class\nteacher-button-delete-collection = Delete Collection\nteacher-button-discard-draft = Discard\nteacher-button-distance-learning = Distance Learning\nteacher-button-edit-block-name = Edit Class Name\nteacher-button-edit-collection = Edit Collection\nteacher-button-edit-desmos-activity = Edit This Activity\nteacher-button-edit-draft = Edit Draft\nteacher-button-email = Email\nteacher-button-equity-principles = Equity Principles\nteacher-button-explore-activity = Explore This Activity\nteacher-button-featured-collections = Featured Collections\nteacher-button-four-function = Four Function Calculator\nteacher-button-geometry = Geometry Tool\nteacher-button-get-started = Get Started\nteacher-button-graphing = Graphing Calculator\nteacher-button-history-back-to-sessions = Back to active sessions\nteacher-button-history-view-archived = View archived sessions\nteacher-button-home = Home\nteacher-button-import-external-class =\n    { $classCount ->\n        [one] Add 1 class\n       *[other] Add { $classCount } classes\n    }\nteacher-button-import-from-google = Import from Google Classroom\nteacher-button-landing-watch-video = Watch the video\nteacher-button-learn-more = Learn more\nteacher-button-load-more = Load more\nteacher-button-manage-classes = Manage Classes\nteacher-button-manage-coteachers = Manage Co-teachers\nteacher-button-matrix = Matrix Calculator\nteacher-button-new-activity = New Activity\nteacher-button-new-collection = New Collection\nteacher-button-new-polygraph = New Polygraph\nteacher-button-partner-featured = Featured\nteacher-button-partner-popular = Most Popular\nteacher-button-popular = Most Popular\nteacher-button-privacy-policy = Privacy Policy\nteacher-button-reactivate = Reactivate\nteacher-button-reactivate-block = Reactivate Class\nteacher-button-reassign = Reassign\nteacher-button-remove-collection = Remove Collection\nteacher-button-remove-from-collection = Remove from collection\nteacher-button-remove-student = Remove Student\nteacher-button-restore = Restore\nteacher-button-roster-options = More options for class { $className }\nteacher-button-save-draft = Save Draft\nteacher-button-scientific = Scientific Calculator\nteacher-button-searchbox-search = Search\nteacher-button-send-invitations = Send Invitations\nteacher-button-share-collection = Share Collection\nteacher-button-student-link = Student Link\nteacher-button-sync-with-google = Sync with Google Classroom\nteacher-button-terms-of-service = Terms of Service\nteacher-button-test-practice = Test Practice\nteacher-button-unassign = Unassign\nteacher-button-view-all-classes = View All Classes\nteacher-button-view-all-collections = View All\nteacher-button-view-all-featured-collections = View All\nteacher-button-view-dashboard = View Dashboard\nteacher-button-view-dashboard-short = Dashboard\nteacher-button-view-external = View in { $serviceName }\nteacher-button-view-external-draft = View Draft in { $serviceName }\nteacher-button-your-activities = Your Activities\nteacher-button-your-classes = Your Classes\nteacher-checkbox-collection-share-settings-desmos = Team Desmos Collection\nteacher-description-collection-share-setting-featured = On the Featured Collections page\nteacher-description-collection-share-setting-link = Anyone with the link can view\nteacher-description-collection-share-setting-private = Only you can view\nteacher-description-collection-share-setting-sidebar = On the Featured page + in the Sidebar\nteacher-description-draft-google = Save as a draft for you to edit in Google Classroom.\nteacher-description-empty-custom-activities-learn-more = Video tutorials, sample activities, and more!\nteacher-description-google-preferences = Manage how assigned activities show up to students. Changes will only apply to subsequent assignments.\nteacher-description-labs-beta-warning = Note: Beta features might be changed or removed.\nteacher-description-labs-geometry = Use the Geometry Tool in Activity Builder.\nteacher-description-labs-marbleslides = Make your own Marbleslides in Activity Builder.\nteacher-description-no-post-desmos =\n    Students will not see assigned activities on student.desmos.com until they begin the activity\n    from a student link.\nteacher-description-no-post-google = You can still manually post the student link.\nteacher-description-post-desmos = Assigned activities will appear on student.desmos.com for students to join.\nteacher-description-title-computation-layer = Computation Layer\nteacher-description-title-written-feedback = Written Feedback\nteacher-description-view-external-disabled = This activity was not posted to { $serviceName }.\nteacher-error-activity-invalid-cl =\n    Your activity has Computation Layer errors and cant be published. Fix the\n    errors or save as draft.\nteacher-error-add-to-multiple-collections-while-editing-many =\n    Error saving { $count } collections. It looks like they\'re currently being\n    edited.\nteacher-error-add-to-multiple-collections-while-editing-one = Error saving 1 collection. It looks like it\'s currently being edited.\nteacher-error-add-to-single-collection-while-editing = Error saving. It looks like this collection is currently being edited.\nteacher-error-co-teacher-add-error = Error adding co-teacher.\nteacher-error-co-teacher-remove-error = Error removing co-teacher.\nteacher-error-collaborate-no-existing-user = Sorry - we couldn\'t find an account with that email address.\nteacher-error-collection-add-activity-duplicate = This activity is already in the collection\nteacher-error-collection-add-activity-invalid-url = Please enter a valid activity URL.\nteacher-error-collection-add-content-invalid-url = Please enter a valid activity or collection URL.\nteacher-error-collection-add-subcollection-duplicate = This collection is already in the collection.\nteacher-error-collection-add-subcollection-self = You can\'t add a collection to itself.\nteacher-error-collection-not-found = Collection Not Found\nteacher-error-deleting-activity = Error deleting activity. Please try again later.\nteacher-error-deleting-collection = Error: { $msg } - Please try again\nteacher-error-google-api-disabled =\n    The Google Classroom API is disabled for your domain.  Please contact your\n    Google administrator.\nteacher-error-google-classroom-disabled =\n    Google Classroom is disabled for your domain.  Please contact your Google\n    administrator.\nteacher-error-google-course-not-found = Google Classroom course not found.\nteacher-error-google-forbidden =\n    You do not have access to this Google Classroom course.  Please contact the\n    course\'s teacher\nteacher-error-google-internal =\n    An unexpected error occurred contacting Google Classroom servers.  Please try\n    again in a few minutes.\nteacher-error-google-usage-limit = Google Classroom usage limit exceeded.  Please try again in a few minutes.\nteacher-error-history-load = Error loading activity history. Please try again.\nteacher-error-no-classes-found = No classes found to import.\nteacher-error-remove-student = Error removing student\nteacher-error-unable-to-load-preferences = Unable to load assignment preferences.  Please try again later.\nteacher-error-unable-to-save-preferences = Unable to save assignment preferences.  Please try again later.\nteacher-heading-activity-history = Activity History\nteacher-heading-activity-history-archived = Activity History: Archived\nteacher-heading-add-block = Add New Class\nteacher-heading-add-google-classroom-classes = Import Classes from Google Classroom\nteacher-heading-assign-to-classes = Assign to Your Classes\nteacher-heading-block-code = Class Code\nteacher-heading-block-coteachers = Co-teacher(s)\nteacher-heading-block-name = Class Name\nteacher-heading-block-roster = Class Roster\nteacher-heading-class-date = date\nteacher-heading-class-student-count = students\nteacher-heading-collection-share-settings = Share Settings\nteacher-heading-company = Company\nteacher-heading-custom-activities = Custom Activities\nteacher-heading-delete-block = Delete Class\nteacher-heading-discard-draft = Discard Draft\nteacher-heading-edit-activity = Editing a Desmos Activity\nteacher-heading-edit-block-name = Edit Class Name\nteacher-heading-edit-collection = Edit Collection\nteacher-heading-featured-activities = Featured Activities\nteacher-heading-featured-collections = Featured Collections\nteacher-heading-four-function-calculator = Four Function Calculator\nteacher-heading-geometry-tool = Geometry Tool\nteacher-heading-history-actions-heading = actions\nteacher-heading-history-activity = activity\nteacher-heading-history-classcode = class\nteacher-heading-history-date = date\nteacher-heading-import-google-class = Select classes below to import from Google Classroom.\nteacher-heading-inactive-blocks = Inactive Classes\nteacher-heading-invite-new-users = Invite New Users\nteacher-heading-lesson-feedback-tooltip-mac = Lesson Feedback (Option + F)\nteacher-heading-lesson-feedback-tooltip-windows = Lesson Feedback (Alt + F)\nteacher-heading-manage = Manage\nteacher-heading-manage-accounts = Manage Accounts\nteacher-heading-manage-blocks = Manage Your Classes\nteacher-heading-manage-blocks-and-preferences = Manage Your Classes and Posting Preferences\nteacher-heading-manage-coteachers = Manage Co-teachers\nteacher-heading-matrix-calculator = Matrix Calculator\nteacher-heading-middle-school-math = Desmos Middle School Math\nteacher-heading-popular-activities = Popular Activities\nteacher-heading-products = Products\nteacher-heading-publish-activity = Publish Activity\nteacher-heading-search-results = Search results for { $searchString }\nteacher-heading-searchbox-from-community = From The Community\nteacher-heading-searchbox-from-desmos = From Desmos\nteacher-heading-share-collection-setting = Share Setting\nteacher-heading-student-email = Email\nteacher-heading-student-name = Name\nteacher-heading-student-screen-preview = Student Screen Preview\nteacher-heading-student-screen-preview-shortened = Preview\nteacher-heading-student-signed-in = Joined Desmos\nteacher-heading-test-practice = Test Practice\nteacher-heading-video-edit-caption = Video Captions\nteacher-heading-your-classes = Your classes\nteacher-instructions-collections-add-activity-url =\n    You can find the activity URL in the Share menu or the URL bar on the activity\n    page.\nteacher-instructions-collections-add-content-url =\n    You can find the activity or collection URL in the Share menu or the URL bar on the activity\n    page.\nteacher-label-activity-history = View Activity History\nteacher-label-activity-section-activity = Activity\nteacher-label-activity-tag = This activity is only available to { $tag } teachers.\nteacher-label-activity-tag-by-cpm = by CPM\nteacher-label-activity-tag-searchable = Searchable\nteacher-label-add-coteacher = Add a co-teacher to your account\nteacher-label-alp-menu-activity-data = Activity data\nteacher-label-alp-menu-authorship-settings = Authorship settings\nteacher-label-alp-menu-permissions = Permissions\nteacher-label-alp-menu-view-original = View original\nteacher-label-already-imported = Already Imported\nteacher-label-archived = Archived\nteacher-label-block-inactive = { $blockName } (Inactive)\nteacher-label-block-name = Class Name\nteacher-label-block-name-placeholder = Enter class name\nteacher-label-block-student-count =\n    { $studentCount ->\n        [one] { $studentCount } student\n       *[other] { $studentCount } students\n    }\nteacher-label-by-author = By { $author }\nteacher-label-by-desmos = By Desmos\nteacher-label-by-you = by you\nteacher-label-class-code = Class Code:\nteacher-label-class-link-info = Share this link with your students.\nteacher-label-collection-about = About This Collection\nteacher-label-collection-activity-count-many = { $count } Activities\nteacher-label-collection-activity-count-one = 1 Activity\nteacher-label-collection-aria-color-blue = blue\nteacher-label-collection-aria-color-coral = coral\nteacher-label-collection-aria-color-green = green\nteacher-label-collection-aria-color-orange = orange\nteacher-label-collection-aria-color-pink = pink\nteacher-label-collection-aria-color-purple = purple\nteacher-label-collection-aria-color-teal = teal\nteacher-label-collection-aria-color-unknown = unknown color\nteacher-label-collection-created-by-you = Created by you\nteacher-label-collection-description = Collection Description\nteacher-label-collection-private = Private\nteacher-label-collection-share-setting-featured = Featured\nteacher-label-collection-share-setting-link = Link\nteacher-label-collection-title = Collection Title\nteacher-label-collection-unit = Unit { $unit }\nteacher-label-collection-unit-prefix = Unit { $unit }: { $title }\nteacher-label-coteacher-title = Co-teachers:\nteacher-label-create-class-detail = Students will join your class by entering a code.\nteacher-label-created-by-you = Created by you\nteacher-label-dashboards-from-previous-activity-version = Dashboards below are for earlier versions of this activity.\nteacher-description-no-post-desmos\n    Students will not see assigned activities on student.desmos.com until they begin the activity\n    from a student link.\nteacher-label-desmos-posting = Desmos Posting\nteacher-label-draft-publish = Publish\nteacher-label-draft-publish-draft = Discard Draft\nteacher-label-draft-run-sample-classes = Run Sample Class\nteacher-label-edited-by-you = Edited by you\nteacher-label-empty-collection = No activities\nteacher-label-enabled-labs-features = enabled features\nteacher-label-expires-at = Expires { $date }\nteacher-label-google-posting-preferences = Posting Preferences\nteacher-label-history-filter-by-class = Filter by Class\nteacher-label-history-student-count-block = { $studentCount } of { $totalCount } students\nteacher-label-inactive-block = Inactive\nteacher-label-inactive-classcode = Inactive Code\nteacher-label-invite-students = Invite your students to join this activity.\nteacher-label-laptop = Laptop\nteacher-label-last-sync = Last Synced\nteacher-label-link-to-dashboard = Link to this dashboard\nteacher-label-manage-coteachers = Manage co-teachers\nteacher-label-middle-school-math = Desmos Middle School Math\nteacher-label-mobile = Mobile\nteacher-label-mobile-friendly = Mobile Friendly\nteacher-label-mobile-warning = We do not recommend this activity for phones.\nteacher-label-no-collections = No collections\nteacher-label-open-readonly-editor = Open Readonly Editor\nteacher-label-or-create-class = or Create a Class\nteacher-label-owner = Owner\nteacher-label-posted-assignment = Posted to { $serviceName }\nteacher-label-posting-assignment = Posting to { $serviceName }...\nteacher-label-posting-draft = Posting draft to { $serviceName }...\nteacher-label-preview-activity = Preview\nteacher-label-primary-coteacher = Primary teacher\nteacher-label-private-activity = Private\nteacher-label-remove-from-collection = Remove From Collection\nteacher-label-sample-responses = Sample Responses\nteacher-label-school-year = School Year or Semester\nteacher-label-screen-reader-friendly = Screen Reader Friendly\nteacher-label-service-posting = { $serviceName } Posting\nteacher-label-sidebar-lesson-number = { $lessonNumber }.\nteacher-label-student-count-many = { $studentCount } students\nteacher-label-student-count-one = 1 student\nteacher-label-student-join-link = Student link\nteacher-label-student-joined-false = Not Yet\nteacher-label-student-joined-true = Yes\nteacher-label-student-link = Student link\nteacher-label-student-support = Student Supports\nteacher-label-students-of-total = { $studentJoinedCount } of { $totalStudentCount }\nteacher-label-syncing = Syncing\nteacher-label-tablet = Tablet\nteacher-label-teacher-moves = Teacher Moves\nteacher-label-try-it-activity = Try It!\nteacher-label-unassigned = Unassigned\nteacher-label-you-tag = (You)\nteacher-message-activity-deleted = This activity has been deleted.\nteacher-message-activity-list-current-range = Showing { $from }-{ $to } of { $count } activities\nteacher-message-activity-posted-desmos = This activity was also posted to students in this class on student.desmos.com\nteacher-message-add-co-teacher =\n    Your co-teachers can view and manage activities. You can revoke their\n    access at any time.\nteacher-message-add-to-collection-saving = Saving\nteacher-message-added-collection = Added!\nteacher-message-already-assigned = Already Assigned\nteacher-message-already-assigned-classes = Already assigned to all classes.\nteacher-message-assign-activity = Assign an Activity\nteacher-message-assign-modal-no-blocks = You haven\'t added any classes yet.\nteacher-message-author-you = you\nteacher-message-co-teacher-classroom-instructions = Add your teachers in Google Classroom and then Sync to add them to this class.\nteacher-message-co-teacher-warning =\n    Only add co-teachers who are authorized to view your students\' personally\n    identifiable information (PII).\nteacher-message-collection-description-read-more = Read More\nteacher-message-collection-private = This collection is private. Choose "Edit Collection" to mark it as shared.\nteacher-message-collection-private-activity-warning =\n    Some of the activities in this collection are private and\n    will not be visible to other teachers.\nteacher-message-collection-private-only-you-can-see-it = This collection is private - only you can see it.\nteacher-message-delete-draft-confirmation = Are you sure you want to discard this draft? This cannot be undone!\nteacher-message-deleted = Deleted\nteacher-message-deleting-collection = Deleting collection...\nteacher-message-draft-last-edited = Last edited { $date }.\nteacher-message-draft-last-edited-with-author = Last edited by { $author } { $date }.\nteacher-message-draft-last-published = Last published { $time }.\nteacher-message-draft-last-published-with-author = Last published by { $author } { $time }.\nteacher-message-draft-on-desmos-activity-part-1 =\n    There is a draft of this activity that was last edited by { $draftAuthorName }\n    { $date }.\nteacher-message-draft-on-desmos-activity-part-2 =\n    Before making any new edits, please connect with { $draftAuthorName } to learn\n    whether the unpublished draft should be discarded, reviewed, and/or published.\nteacher-message-empty-collection = This collection doesn\'t have any activities yet.\nteacher-message-error-coteacher-not-found = Cannot add { $email } as a coteacher because they do not have a Desmos account.\nteacher-message-external-roster-sync-error = Failed to sync roster with Google Classroom for class { $blockName }\nteacher-message-external-roster-synced = Roster was synced with Google Classroom for class { $blockName }\nteacher-message-get-started-with-classes = Get Started With Desmos Classes\nteacher-message-google-classroom-posting = Choose Where to Post\nteacher-message-history-loading = Loading your sessions...\nteacher-message-history-no-archived-block-sessions =\n    { $blockCount ->\n        [one] You don\'t have any archived sessions in the selected class.\n       *[other] You don\'t have any archived sessions in the selected classes.\n    }\nteacher-message-history-no-archived-sessions = You don\'t have any archived sessions.\nteacher-message-history-no-block-sessions =\n    { $blockCount ->\n        [one]\n            You haven\'t run any sessions in the selected class yet. Try one of the\n            most popular activities or an activity from a bundle!\n       *[other]\n            You haven\'t run any sessions in the selected classes yet. Try one of\n            the most popular activities or an activity from a bundle!\n    }\nteacher-message-history-no-sessions =\n    You haven\'t run any sessions yet. Try one of the most popular activities or an\n    activity from a bundle!\nteacher-message-landing-page-intro =\n    At Desmos, our mission is to help every student learn math and love learning\n    math. Explore and enjoy our collection of free digital math activities for you\n    and your students.\nteacher-message-love-to-hear-from-you-social-media = We\'d love to hear from you!\nteacher-message-no-activities-create-classes = Assign this activity to one of your classes or create a single session code.\nteacher-message-no-blocks = Add your classes to get started.\nteacher-message-no-collections = No collections yet. Add a new collection below.\nteacher-message-no-students =\n    No students have joined this class yet. Invite students to join using the code\n    { $code }.\nteacher-message-no-students-external =\n    No students have joined this class yet. Invite students to your class in\n    { $serviceName }.\nteacher-message-not-showing-anon = Students who haven\'t started the activity are not shown. Turn Anonymize off to see your full roster.\nteacher-message-posting-to-google = Posting assignment to Google Classroom...\nteacher-message-private-activity = This activity is private.\nteacher-message-private-activity-long =\n    Bummer  it looks like the author marked this activity private. If you have a\n    way to contact the author, give them a nudge to change the share setting.\nteacher-message-screen-copy-success = Copied! Now paste into Activity Builder.\nteacher-message-search-featured-collections = Try searching for "functions" or check out a featured collection!\nteacher-message-search-no-results = There aren\'t any results for { $searchString } yet.\nteacher-message-search-subset-activities =\n    For now, we only search through a subset of activities that the Desmos Teaching\n    Faculty has selected, reviewed, and polished. Stay tuned  we will keep adding\n    to the search results!\nteacher-message-share-collection-link = Share this link to let other teachers view this collection:\nteacher-message-sign-in-to-see-sessions = Sign in to see your activity sessions and assign this activity to your classes.\nteacher-message-student-activity-link =\n    This link will take students directly to the activity. Students who are not\n    already in { $className } will be added to the class.\nteacher-message-student-activity-link-google =\n    This link will take students directly to the activity. Students must be part\n    of { $className } in Google Classroom to join the activity.\nteacher-message-students-join = Share the Class Code with Students.\nteacher-message-using-languages = Learn more about using Desmos Activities in your language.\nteacher-narration-capture-image = Capture Image\nteacher-narration-duplicate-dashboard = Duplicate Dashboard\nteacher-narration-pace-to-next-screen = Pace to Next Screen\nteacher-narration-pace-to-previous-screen = Pace to Previous Screen\nteacher-narration-search-nothing-selected = Nothing selected\nteacher-narration-search-suggestion-count = { $count } suggestions\nteacher-narration-search-suggestion-position = { $index } of { $count }\nteacher-narration-share-dashboard = Share Dashboard\nteacher-placeholder-add-block-coteacher-email = Email address\nteacher-placeholder-collection-add-activity-url = Paste activity URL\nteacher-placeholder-collection-add-content-url = Paste activity or collection URL\nteacher-placeholder-searchbox = Search for an activity\nteacher-placeholder-untitled-collection = Untitled\nteacher-prompt-add-block =\n    Click Add New Class in the top right corner to create your classes for the\n    school year. You can edit the names later if you need to!\nteacher-prompt-add-collection-description = Add collection description (optional)\nteacher-prompt-confirm-delete-block = Are you sure you want to delete the class { $name }?\nteacher-prompt-confirm-delete-collection = Are you sure you want to delete this collection?\nteacher-prompt-edit-desmos-activity-warning =\n    Please be careful as you edit this activity to not accidentally save or publish\n    unintended changes.\nteacher-prompt-no-collections-create-one = You don\'t have any collections yet. Click "New Collection" to get started!\nteacher-prompt-students-activity =\n    Students can view, start, or return to all of the activities you assign to the\n    class.\nteacher-section-description-placeholder = Section Description (optional)\nteacher-section-header-placeholder = Add Section Header\nteacher-title-activity-section-activity = Activity { $activityNumber }\nteacher-title-activity-section-cool-down = Cool-Down\nteacher-title-activity-section-synthesis = Synthesis\nteacher-title-activity-section-warm-up = Warm-Up\nteacher-title-add-to-collections = Add to Collections\nteacher-title-authorize-google-classroom = Please grant Desmos access to Google Classroom to continue.\nteacher-title-collection-add-activity-modal = Add Activity\nteacher-title-collection-add-content-modal = Add Activity or Collection\nteacher-title-collection-edit-claim-lost = Warning\nteacher-title-collections = Collections\nteacher-title-delete-activity = Delete Activity\nteacher-title-delete-collection = Delete Collection\nteacher-title-desmos-labs = Desmos Labs\nteacher-title-labs-geometry-beta = Geometry\nteacher-title-labs-marbleslides = Marbleslides\nteacher-title-landing-page = Desmos Classroom Activities\nteacher-title-language-menu = Language\nteacher-title-share-dashboard = Share With a Co-Teacher\nteacher-title-untitled-lesson = [Untitled] { $lesson_name }\nteacher-title-your-coteachers = Your co-teachers\nteacher-warning-no-curriculum-access = Does not have full Desmos Middle School Math access.\nteacherguide-button-print-guide = Print this Teacher Guide\nteacherguide-heading-activity-check-list = Activity Checklist\nteacherguide-heading-activity-screens = Activity Screens\nteacherguide-heading-class-code = Session Code\nteacherguide-heading-lesson-check-list = Lesson Checklist\nteacherguide-heading-my-learning-targets = My Learning Targets:\nteacherguide-heading-my-notes = My Notes:\nteacherguide-heading-practice-activity-screens = Practice Activity Screens\nteacherguide-heading-required-preparation = Required Preparation\nteacherguide-heading-summary-notes = Summary Notes:\nteacherguide-heading-teacher-pacing-and-pause = Activity Screens: Teacher Pacing and Pause Class\nteacherguide-instructions-anticipate-struggle-prepare-response = Anticipate screens where students will struggle, then plan your response.\nteacherguide-instructions-anticipate-struggles = Anticipate screens where students will struggle, then plan your response.\nteacherguide-instructions-complete-student-preview = Complete the activity using student preview.\nteacherguide-instructions-complete-using-student-preview = Complete the lesson using the student preview.\nteacherguide-instructions-consider-snapshots =\n    Consider how to use snapshots to select and present student thinking for class\n    discussion.\nteacherguide-instructions-consider-which-simultaneous-screens = Which screen(s) should everyone work on at the same time? Why?\nteacherguide-instructions-determine-pause-pacing =\n    Determine the screens where youll bring the class together using Teacher\n    Pacing and Pause Class. What will you discuss on those screens?\nteacherguide-instructions-identify-learning-targets = Identify your learning targets for the activity.\nteacherguide-instructions-identify-lesson-extends-learning =\n    Identify how this lesson extends the learning from previous lessons, and how it\n    prepares students for future lessons.\nteacherguide-instructions-make-yourself-available =\n    Make yourself available during the activity to students for individual help and\n    questions when appropriate.\nteacherguide-instructions-new-section-maintain-focus =\n    Think about how you will introduce each new section within the lesson to engage\n    students in the task and maintain focus on the learning goals.\nteacherguide-instructions-plan-a-challenge = Plan a challenge for students who finish the activity quickly and successfully.\nteacherguide-instructions-plan-pacing =\n    Use this page to plan your use of Teacher Pacing and Pause Class. Teacher\n    Pacing lets you restrict students to a single screen or a range of screens.\n    Pause Class keeps students from interacting with whatever screens they are\n    currently viewing. Use these two tools to create conversations in your\n    classroom.\nteacherguide-instructions-think-about-cool-downs =\n    Think about how you will use the results of previous Cool-Downs and student\n    surveys to inform your approach to this lesson.\nteacherguide-instructions-which-screens-no-student-play =\n    Are there any points in the lesson where you will want to make sure students\n    arent playing with the screens while you discuss something as a class?\nteacherguide-instructions-which-screens-to-pause =\n    Determine the screens where youll use Pacing and Pause to bring the class\n    together. What questions will you ask on those screens?\nteacherguide-instructions-which-screens-withheld =\n    Which screen(s) do you want to keep students from seeing until you\'re ready for\n    the class to see them together? (Perhaps because they reveal answers or require\n    a whole class conversation for introduction.)\nteacherguide-instructions-write-summary =\n    Write out your summary of the activity\'s main ideas. How will you pull student\n    work into that summary? Which parts of the activity can you skip to ensure that\n    summary receives sufficient time?\nteacherguide-message-error-loading = Error loading teacher materials: { $msg }\nteacherguide-message-print-first = We recommend printing this guide and completing it before you run the activity.\nteacherguide-title-consider-questions = Consider these questions as you plan:\nteacherguide-title-teacher-guide = Teacher Guide\nteacherguide-title-teacher-tips = Teacher Tips:\ntext-input-edit-label-answer-box = Text answer box\ntext-input-edit-message-show-classmates-responses-checkbox = Show students their classmates\' responses\ntransform-button-cancel-transformation = Cancel Transformation\ntransform-button-edit-transformation = Edit Transformation\ntransform-button-line = Line\ntransform-button-play-all = Play All\ntransform-button-rectangle = Rectangle\ntransform-button-remove-transformation = Remove Transformation\ntransform-dashboard-label-more-transforms = +{ $additional } more\ntransform-edit-button-add-obstacle = Add obstacle\ntransform-edit-label-hide-target = Hide Target\ntransform-edit-label-select-tools = Select tools:\ntransform-label-add-transformation = Add Transformation\ntransform-label-angle = Angle:\ntransform-label-angle-aria = Angle in degrees\ntransform-label-clockwise = Clockwise\ntransform-label-counterclockwise = Counterclockwise\ntransform-label-dilate = Dilate\ntransform-label-direction = Direction:\ntransform-label-reflect = Reflect\ntransform-label-rotate = Rotate\ntransform-label-scale-factor = Scale factor:\ntransform-label-scale-factor-aria = Scale factor\ntransform-label-translate = Translate\ntransform-message-transform-failure = That didn\'t work. Please try again.\ntransform-message-transform-success = Success!\ntransform-title-previous-transformations = Previous Transformations\ntranslation-edit-heading-translating-to = Translating to { $language }\ntranslation-edit-label-activity-details = Activity Details\nvideo-edit-button-cancel-upload = Cancel Upload\nvideo-edit-button-edit-url = Edit Video URL\nvideo-edit-error-max-size = Maximum accepted file size is 100MB.\nvideo-edit-error-upload-captions-error = Error uploading captions file.\nvideo-edit-error-upload-error = Error Uploading File. Check your internet connection?\nvideo-edit-instructions-caption-description = Add a Video Text Track (vtt) file with captions.\nvideo-edit-instructions-choose-caption = Upload video captions\nvideo-edit-instructions-description = Describe this video for students who are visually impaired.\nvideo-edit-label-custom-url = Enter a URL from which to load the video.\nvideo-edit-label-description = Video Description:\nvideo-edit-message-checking-size = Checking video size...\nvideo-edit-message-upload-progress = Uploading... { $percent }% complete\nvideo-edit-message-uploading = Uploading...\nvideo-edit-message-uploading-image = Uploading your image...\n'
    }
});
define("l10n/context", ["require", "exports", "core/l10n/fluent-bundle-sequence", "../lib/parse-query-params", "./escape", "core/l10n/default-fluent-bundle", "bugsnag"], function(require, exports, fluent_bundle_sequence_1, parse_query_params_1, escape_1, default_fluent_bundle_1, bugsnag_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var BrowserLocalizationContext = function() {
        function BrowserLocalizationContext() {}
        BrowserLocalizationContext.prototype.getLocale = function() {
            var queryParams = parse_query_params_1.getQueryParams();
            return typeof queryParams.lang === "string" ? queryParams.lang : "en"
        }
        ;
        BrowserLocalizationContext.prototype.getFluentBundleSequence = function() {
            if (!this.fluentBundleSequence) {
                this.fluentBundleSequence = this.createFluentBundleSequence()
            }
            return this.fluentBundleSequence
        }
        ;
        BrowserLocalizationContext.prototype.createFluentBundleSequence = function() {
            var ftlSources = getFtlSources();
            return fluent_bundle_sequence_1.FluentBundleSequence.fromSources(ftlSources, function(err) {
                return bugsnag_1.Bugsnag.notify(err)
            })
        }
        ;
        BrowserLocalizationContext.prototype.getEnvironment = function() {
            return /local.desmos.com$/.test(window.location.hostname) ? "development" : "production"
        }
        ;
        return BrowserLocalizationContext
    }();
    exports.BrowserLocalizationContext = BrowserLocalizationContext;
    function getCurrentLang() {
        var context = new BrowserLocalizationContext;
        return context.getLocale()
    }
    exports.getCurrentLang = getCurrentLang;
    function getFtlSources() {
        var ftlSourceScriptElements = document.querySelectorAll('script[type="text/mozilla-fluent-bundle"]');
        var ftlSources = [];
        for (var i = 0; i < ftlSourceScriptElements.length; i++) {
            var el = ftlSourceScriptElements.item(i);
            var lang = el.getAttribute("lang");
            if (!lang) {
                throw new Error('Expected fluent bundle <script> element to have a "lang" attribute, but it had none.')
            }
            ftlSources.push({
                lang: lang,
                source: escape_1.unescapeScriptElementFluentSource(el.innerHTML)
            })
        }
        ftlSources.push({
            lang: "en",
            source: default_fluent_bundle_1.ftl
        });
        return ftlSources
    }
    exports.getFtlSources = getFtlSources
});
define("lib/looker", ["require", "exports", "tslib", "underscore", "lib/ajaxmanager", "core/lib/uuid", "l10n/context"], function(require, exports, tslib_1, _, ajaxmanager_1, uuid_1, context_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var MAXIMUM_LOGS_PER_REQUEST = 50;
    var API_URL = "https://g2sm0kahkl.execute-api.us-east-1.amazonaws.com/prod";
    var staticData = {
        pageLoadId: window.pageLoadId || uuid_1.uuid(),
        source: "browser",
        app: "pillow",
        userAgent: navigator.userAgent
    };
    var batchedLogs = [];
    var ajax = new ajaxmanager_1.AjaxManager;
    function getPageLoadId() {
        return staticData.pageLoadId
    }
    exports.getPageLoadId = getPageLoadId;
    function getStaticData() {
        return staticData
    }
    exports.getStaticData = getStaticData;
    function log(data) {
        return new Promise(function(resolve, reject) {
                batchedLogs.push({
                    message: tslib_1.__assign(tslib_1.__assign(tslib_1.__assign({}, staticData), {
                        url: document.location.href
                    }), data),
                    resolve: resolve,
                    reject: reject
                });
                throttledFlushBatchedLogs()
            }
        )
    }
    exports.log = log;
    function logNumber(eventType, payloadNumber) {
        log({
            eventType: eventType,
            payloadNumber: payloadNumber
        })
    }
    exports.logNumber = logNumber;
    function logJSON(eventType, payloadJSON, staticData) {
        return log(tslib_1.__assign({
            eventType: eventType,
            payloadJSON: JSON.stringify(payloadJSON)
        }, staticData))
    }
    exports.logJSON = logJSON;
    var lastPageLoadURL;
    var isFirstPageLoad = true;
    function logPageLoad(data) {
        var url = document.location.href;
        var productionHostnames = ["student.desmos.com", "teacher.desmos.com"];
        if (productionHostnames.indexOf(document.location.hostname) === -1)
            return;
        var localeContext = new context_1.BrowserLocalizationContext;
        var desmosLang = localeContext.getLocale();
        var browserLang = navigator.userLanguage || navigator.language;
        var referrer = document.referrer;
        var newPageLoadEvent = tslib_1.__assign({
            browserLang: browserLang,
            desmosLang: desmosLang,
            referrer: referrer
        }, data);
        if (lastPageLoadURL === url)
            return;
        lastPageLoadURL = url;
        if (isFirstPageLoad) {
            logJSON("page-load", newPageLoadEvent);
            isFirstPageLoad = false
        } else {
            delete newPageLoadEvent.referrer;
            logJSON("page-spa-load", newPageLoadEvent)
        }
    }
    exports.logPageLoad = logPageLoad;
    var throttledFlushBatchedLogs = _.throttle(function() {
        if (ajax.findRequestByKey("logs") || batchedLogs.length === 0) {
            return
        }
        var logs = batchedLogs.splice(0, MAXIMUM_LOGS_PER_REQUEST);
        var events = logs.map(function(l) {
            return l.message
        });
        ajax.JSON(API_URL, {
            retry: 1e3,
            key: "logs"
        }, {
            events: events
        }).done(function() {
            for (var _i = 0, logs_1 = logs; _i < logs_1.length; _i++) {
                var log_1 = logs_1[_i];
                log_1.resolve()
            }
            throttledFlushBatchedLogs()
        }).fail(function() {
            for (var _i = 0, logs_2 = logs; _i < logs_2.length; _i++) {
                var log_2 = logs_2[_i];
                log_2.reject()
            }
        })
    }, 1e3, {
        leading: false
    })
});
(function() {
        define("dcgview", ["require", "jquery", "underscore", "../submodules/dcgview/dcgview", "loadcss!./dcgview", "../submodules/dcgview/src/const", "bugsnag", "lib/retain-lang", "lib/looker"], function(require) {
            var $, Bugsnag, Const, DCGView, _, didLogDCGViewWarning, logJSON, retainLang, urlChangeCallbacks;
            $ = require("jquery");
            _ = require("underscore");
            DCGView = require("../submodules/dcgview/dcgview");
            require("loadcss!./dcgview");
            Const = require("../submodules/dcgview/src/const");
            Bugsnag = require("bugsnag").Bugsnag;
            retainLang = require("lib/retain-lang").retainLang;
            logJSON = require("lib/looker").logJSON;
            DCGView.enableSpanWrapping();
            didLogDCGViewWarning = false;
            DCGView.addWarningHandler(function(warning) {
                var _line, firstLine, message, ref, viewHierarchy, viewName;
                if (didLogDCGViewWarning) {
                    return
                }
                firstLine = warning.message.split("\n")[0] || "";
                ref = firstLine.match(/(.*) \[([a-zA-Z]*)\]/),
                    _line = ref[0],
                    message = ref[1],
                    viewName = ref[2];
                viewHierarchy = warning.message.split("\n").slice(2);
                logJSON("MonitoredEvent:DCGViewWarning", {
                    message: message,
                    viewName: viewName,
                    viewHierarchy: viewHierarchy
                });
                return didLogDCGViewWarning = true
            });
            urlChangeCallbacks = [];
            DCGView.onUrlChange = function(cb) {
                return urlChangeCallbacks.push(cb)
            }
            ;
            DCGView.addCustomAttribute("href", function(getter) {
                var lastGetterValue, out;
                lastGetterValue = retainLang(getter());
                out = {
                    value: "" + retainLang(getter()),
                    bindings: {
                        onMount: function(node) {
                            var ignoreNextClick;
                            if (!($(node).is("a") || $(node).is("use"))) {
                                throw new Error("Cannot have an href on a non-link element.")
                            }
                            if ($(node).attr("target")) {
                                return
                            }
                            ignoreNextClick = false;
                            $(node).on("dcg-tap", function(evt) {
                                var url, urlHandled;
                                if (!evt.metaKey) {
                                    ignoreNextClick = false;
                                    url = retainLang(getter());
                                    urlHandled = _.any(urlChangeCallbacks.map(function(cb) {
                                        return cb(url, evt)
                                    }));
                                    if (urlHandled) {
                                        return ignoreNextClick = true
                                    }
                                }
                            });
                            return $(node).on("click", function(evt) {
                                if (ignoreNextClick) {
                                    ignoreNextClick = false;
                                    return evt.preventDefault()
                                }
                            })
                        }
                    }
                };
                out.bindings.onUpdate = function(node) {
                    var href;
                    href = retainLang(getter());
                    if (lastGetterValue === href) {
                        return
                    }
                    lastGetterValue = href;
                    return node.setAttribute("href", href)
                }
                ;
                return out
            });
            DCGView.addCustomAttribute("onTap", function(cb) {
                return {
                    value: "",
                    bindings: {
                        onMount: function(node) {
                            return $(node).on("dcg-tap", cb)
                        }
                    }
                }
            });
            DCGView.addCustomAttribute("ignoreRealClick", function(cond) {
                return {
                    bindings: {
                        onMount: function(node) {
                            return $(node).on("click", function(e) {
                                if (cond()) {
                                    return e.preventDefault()
                                }
                            })
                        }
                    }
                }
            });
            DCGView.addCustomAttribute("onTapStart", function(cb) {
                return {
                    bindings: {
                        onMount: function(node) {
                            return $(node).on("dcg-tapstart", cb)
                        }
                    }
                }
            });
            DCGView.addCustomAttribute("onTapMove", function(cb) {
                return {
                    bindings: {
                        onMount: function(node) {
                            return $(node).on("dcg-tapmove", cb)
                        }
                    }
                }
            });
            DCGView.addCustomAttribute("onTapEnd", function(cb) {
                return {
                    bindings: {
                        onMount: function(node) {
                            return $(node).on("dcg-tapend", cb)
                        }
                    }
                }
            });
            DCGView.addCustomAttribute("onLongHold", function(cb) {
                return {
                    bindings: {
                        onMount: function(node) {
                            return $(node).on("dcg-longhold", cb)
                        }
                    }
                }
            });
            return DCGView
        })
    }
).call(this);
define("orderedmap", ["require", "exports", "module"], function(require, exports, module) {
    function OrderedMap(content) {
        this.content = content
    }
    OrderedMap.prototype = {
        constructor: OrderedMap,
        find: function(key) {
            for (var i = 0; i < this.content.length; i += 2)
                if (this.content[i] === key)
                    return i;
            return -1
        },
        get: function(key) {
            var found = this.find(key);
            return found == -1 ? undefined : this.content[found + 1]
        },
        update: function(key, value, newKey) {
            var self = newKey && newKey != key ? this.remove(newKey) : this;
            var found = self.find(key)
                , content = self.content.slice();
            if (found == -1) {
                content.push(newKey || key, value)
            } else {
                content[found + 1] = value;
                if (newKey)
                    content[found] = newKey
            }
            return new OrderedMap(content)
        },
        remove: function(key) {
            var found = this.find(key);
            if (found == -1)
                return this;
            var content = this.content.slice();
            content.splice(found, 2);
            return new OrderedMap(content)
        },
        addToStart: function(key, value) {
            return new OrderedMap([key, value].concat(this.remove(key).content))
        },
        addToEnd: function(key, value) {
            var content = this.remove(key).content.slice();
            content.push(key, value);
            return new OrderedMap(content)
        },
        addBefore: function(place, key, value) {
            var without = this.remove(key)
                , content = without.content.slice();
            var found = without.find(place);
            content.splice(found == -1 ? content.length : found, 0, key, value);
            return new OrderedMap(content)
        },
        forEach: function(f) {
            for (var i = 0; i < this.content.length; i += 2)
                f(this.content[i], this.content[i + 1])
        },
        prepend: function(map) {
            map = OrderedMap.from(map);
            if (!map.size)
                return this;
            return new OrderedMap(map.content.concat(this.subtract(map).content))
        },
        append: function(map) {
            map = OrderedMap.from(map);
            if (!map.size)
                return this;
            return new OrderedMap(this.subtract(map).content.concat(map.content))
        },
        subtract: function(map) {
            var result = this;
            map = OrderedMap.from(map);
            for (var i = 0; i < map.content.length; i += 2)
                result = result.remove(map.content[i]);
            return result
        },
        get size() {
            return this.content.length >> 1
        }
    };
    OrderedMap.from = function(value) {
        if (value instanceof OrderedMap)
            return value;
        var content = [];
        if (value)
            for (var prop in value)
                content.push(prop, value[prop]);
        return new OrderedMap(content)
    }
    ;
    module.exports = OrderedMap
});
define("prosemirror-model/index", ["require", "exports", "module", "orderedmap"], function(require, exports, module) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function _interopDefault(ex) {
        return ex && typeof ex === "object" && "default"in ex ? ex["default"] : ex
    }
    var OrderedMap = _interopDefault(require("orderedmap"));
    function findDiffStart(a, b, pos) {
        for (var i = 0; ; i++) {
            if (i == a.childCount || i == b.childCount) {
                return a.childCount == b.childCount ? null : pos
            }
            var childA = a.child(i)
                , childB = b.child(i);
            if (childA == childB) {
                pos += childA.nodeSize;
                continue
            }
            if (!childA.sameMarkup(childB)) {
                return pos
            }
            if (childA.isText && childA.text != childB.text) {
                for (var j = 0; childA.text[j] == childB.text[j]; j++) {
                    pos++
                }
                return pos
            }
            if (childA.content.size || childB.content.size) {
                var inner = findDiffStart(childA.content, childB.content, pos + 1);
                if (inner != null) {
                    return inner
                }
            }
            pos += childA.nodeSize
        }
    }
    function findDiffEnd(a, b, posA, posB) {
        for (var iA = a.childCount, iB = b.childCount; ; ) {
            if (iA == 0 || iB == 0) {
                return iA == iB ? null : {
                    a: posA,
                    b: posB
                }
            }
            var childA = a.child(--iA)
                , childB = b.child(--iB)
                , size = childA.nodeSize;
            if (childA == childB) {
                posA -= size;
                posB -= size;
                continue
            }
            if (!childA.sameMarkup(childB)) {
                return {
                    a: posA,
                    b: posB
                }
            }
            if (childA.isText && childA.text != childB.text) {
                var same = 0
                    , minSize = Math.min(childA.text.length, childB.text.length);
                while (same < minSize && childA.text[childA.text.length - same - 1] == childB.text[childB.text.length - same - 1]) {
                    same++;
                    posA--;
                    posB--
                }
                return {
                    a: posA,
                    b: posB
                }
            }
            if (childA.content.size || childB.content.size) {
                var inner = findDiffEnd(childA.content, childB.content, posA - 1, posB - 1);
                if (inner) {
                    return inner
                }
            }
            posA -= size;
            posB -= size
        }
    }
    var Fragment = function Fragment(content, size) {
        this.content = content;
        this.size = size || 0;
        if (size == null) {
            for (var i = 0; i < content.length; i++) {
                this.size += content[i].nodeSize
            }
        }
    };
    var prototypeAccessors = {
        firstChild: {
            configurable: true
        },
        lastChild: {
            configurable: true
        },
        childCount: {
            configurable: true
        }
    };
    Fragment.prototype.nodesBetween = function nodesBetween(from, to, f, nodeStart, parent) {
        if (nodeStart === void 0)
            nodeStart = 0;
        for (var i = 0, pos = 0; pos < to; i++) {
            var child = this.content[i]
                , end = pos + child.nodeSize;
            if (end > from && f(child, nodeStart + pos, parent, i) !== false && child.content.size) {
                var start = pos + 1;
                child.nodesBetween(Math.max(0, from - start), Math.min(child.content.size, to - start), f, nodeStart + start)
            }
            pos = end
        }
    }
    ;
    Fragment.prototype.descendants = function descendants(f) {
        this.nodesBetween(0, this.size, f)
    }
    ;
    Fragment.prototype.textBetween = function textBetween(from, to, blockSeparator, leafText) {
        var text = ""
            , separated = true;
        this.nodesBetween(from, to, function(node, pos) {
            if (node.isText) {
                text += node.text.slice(Math.max(from, pos) - pos, to - pos);
                separated = !blockSeparator
            } else if (node.isLeaf && leafText) {
                text += leafText;
                separated = !blockSeparator
            } else if (!separated && node.isBlock) {
                text += blockSeparator;
                separated = true
            }
        }, 0);
        return text
    }
    ;
    Fragment.prototype.append = function append(other) {
        if (!other.size) {
            return this
        }
        if (!this.size) {
            return other
        }
        var last = this.lastChild
            , first = other.firstChild
            , content = this.content.slice()
            , i = 0;
        if (last.isText && last.sameMarkup(first)) {
            content[content.length - 1] = last.withText(last.text + first.text);
            i = 1
        }
        for (; i < other.content.length; i++) {
            content.push(other.content[i])
        }
        return new Fragment(content,this.size + other.size)
    }
    ;
    Fragment.prototype.cut = function cut(from, to) {
        if (to == null) {
            to = this.size
        }
        if (from == 0 && to == this.size) {
            return this
        }
        var result = []
            , size = 0;
        if (to > from) {
            for (var i = 0, pos = 0; pos < to; i++) {
                var child = this.content[i]
                    , end = pos + child.nodeSize;
                if (end > from) {
                    if (pos < from || end > to) {
                        if (child.isText) {
                            child = child.cut(Math.max(0, from - pos), Math.min(child.text.length, to - pos))
                        } else {
                            child = child.cut(Math.max(0, from - pos - 1), Math.min(child.content.size, to - pos - 1))
                        }
                    }
                    result.push(child);
                    size += child.nodeSize
                }
                pos = end
            }
        }
        return new Fragment(result,size)
    }
    ;
    Fragment.prototype.cutByIndex = function cutByIndex(from, to) {
        if (from == to) {
            return Fragment.empty
        }
        if (from == 0 && to == this.content.length) {
            return this
        }
        return new Fragment(this.content.slice(from, to))
    }
    ;
    Fragment.prototype.replaceChild = function replaceChild(index, node) {
        var current = this.content[index];
        if (current == node) {
            return this
        }
        var copy = this.content.slice();
        var size = this.size + node.nodeSize - current.nodeSize;
        copy[index] = node;
        return new Fragment(copy,size)
    }
    ;
    Fragment.prototype.addToStart = function addToStart(node) {
        return new Fragment([node].concat(this.content),this.size + node.nodeSize)
    }
    ;
    Fragment.prototype.addToEnd = function addToEnd(node) {
        return new Fragment(this.content.concat(node),this.size + node.nodeSize)
    }
    ;
    Fragment.prototype.eq = function eq(other) {
        if (this.content.length != other.content.length) {
            return false
        }
        for (var i = 0; i < this.content.length; i++) {
            if (!this.content[i].eq(other.content[i])) {
                return false
            }
        }
        return true
    }
    ;
    prototypeAccessors.firstChild.get = function() {
        return this.content.length ? this.content[0] : null
    }
    ;
    prototypeAccessors.lastChild.get = function() {
        return this.content.length ? this.content[this.content.length - 1] : null
    }
    ;
    prototypeAccessors.childCount.get = function() {
        return this.content.length
    }
    ;
    Fragment.prototype.child = function child(index) {
        var found = this.content[index];
        if (!found) {
            throw new RangeError("Index " + index + " out of range for " + this)
        }
        return found
    }
    ;
    Fragment.prototype.maybeChild = function maybeChild(index) {
        return this.content[index]
    }
    ;
    Fragment.prototype.forEach = function forEach(f) {
        for (var i = 0, p = 0; i < this.content.length; i++) {
            var child = this.content[i];
            f(child, p, i);
            p += child.nodeSize
        }
    }
    ;
    Fragment.prototype.findDiffStart = function findDiffStart$1(other, pos) {
        if (pos === void 0)
            pos = 0;
        return findDiffStart(this, other, pos)
    }
    ;
    Fragment.prototype.findDiffEnd = function findDiffEnd$1(other, pos, otherPos) {
        if (pos === void 0)
            pos = this.size;
        if (otherPos === void 0)
            otherPos = other.size;
        return findDiffEnd(this, other, pos, otherPos)
    }
    ;
    Fragment.prototype.findIndex = function findIndex(pos, round) {
        if (round === void 0)
            round = -1;
        if (pos == 0) {
            return retIndex(0, pos)
        }
        if (pos == this.size) {
            return retIndex(this.content.length, pos)
        }
        if (pos > this.size || pos < 0) {
            throw new RangeError("Position " + pos + " outside of fragment (" + this + ")")
        }
        for (var i = 0, curPos = 0; ; i++) {
            var cur = this.child(i)
                , end = curPos + cur.nodeSize;
            if (end >= pos) {
                if (end == pos || round > 0) {
                    return retIndex(i + 1, end)
                }
                return retIndex(i, curPos)
            }
            curPos = end
        }
    }
    ;
    Fragment.prototype.toString = function toString() {
        return "<" + this.toStringInner() + ">"
    }
    ;
    Fragment.prototype.toStringInner = function toStringInner() {
        return this.content.join(", ")
    }
    ;
    Fragment.prototype.toJSON = function toJSON() {
        return this.content.length ? this.content.map(function(n) {
            return n.toJSON()
        }) : null
    }
    ;
    Fragment.fromJSON = function fromJSON(schema, value) {
        if (!value) {
            return Fragment.empty
        }
        if (!Array.isArray(value)) {
            throw new RangeError("Invalid input for Fragment.fromJSON")
        }
        return new Fragment(value.map(schema.nodeFromJSON))
    }
    ;
    Fragment.fromArray = function fromArray(array) {
        if (!array.length) {
            return Fragment.empty
        }
        var joined, size = 0;
        for (var i = 0; i < array.length; i++) {
            var node = array[i];
            size += node.nodeSize;
            if (i && node.isText && array[i - 1].sameMarkup(node)) {
                if (!joined) {
                    joined = array.slice(0, i)
                }
                joined[joined.length - 1] = node.withText(joined[joined.length - 1].text + node.text)
            } else if (joined) {
                joined.push(node)
            }
        }
        return new Fragment(joined || array,size)
    }
    ;
    Fragment.from = function from(nodes) {
        if (!nodes) {
            return Fragment.empty
        }
        if (nodes instanceof Fragment) {
            return nodes
        }
        if (Array.isArray(nodes)) {
            return this.fromArray(nodes)
        }
        if (nodes.attrs) {
            return new Fragment([nodes],nodes.nodeSize)
        }
        throw new RangeError("Can not convert " + nodes + " to a Fragment" + (nodes.nodesBetween ? " (looks like multiple versions of prosemirror-model were loaded)" : ""))
    }
    ;
    Object.defineProperties(Fragment.prototype, prototypeAccessors);
    var found = {
        index: 0,
        offset: 0
    };
    function retIndex(index, offset) {
        found.index = index;
        found.offset = offset;
        return found
    }
    Fragment.empty = new Fragment([],0);
    function compareDeep(a, b) {
        if (a === b) {
            return true
        }
        if (!(a && typeof a == "object") || !(b && typeof b == "object")) {
            return false
        }
        var array = Array.isArray(a);
        if (Array.isArray(b) != array) {
            return false
        }
        if (array) {
            if (a.length != b.length) {
                return false
            }
            for (var i = 0; i < a.length; i++) {
                if (!compareDeep(a[i], b[i])) {
                    return false
                }
            }
        } else {
            for (var p in a) {
                if (!(p in b) || !compareDeep(a[p], b[p])) {
                    return false
                }
            }
            for (var p$1 in b) {
                if (!(p$1 in a)) {
                    return false
                }
            }
        }
        return true
    }
    var Mark = function Mark(type, attrs) {
        this.type = type;
        this.attrs = attrs
    };
    Mark.prototype.addToSet = function addToSet(set) {
        var copy, placed = false;
        for (var i = 0; i < set.length; i++) {
            var other = set[i];
            if (this.eq(other)) {
                return set
            }
            if (this.type.excludes(other.type)) {
                if (!copy) {
                    copy = set.slice(0, i)
                }
            } else if (other.type.excludes(this.type)) {
                return set
            } else {
                if (!placed && other.type.rank > this.type.rank) {
                    if (!copy) {
                        copy = set.slice(0, i)
                    }
                    copy.push(this);
                    placed = true
                }
                if (copy) {
                    copy.push(other)
                }
            }
        }
        if (!copy) {
            copy = set.slice()
        }
        if (!placed) {
            copy.push(this)
        }
        return copy
    }
    ;
    Mark.prototype.removeFromSet = function removeFromSet(set) {
        for (var i = 0; i < set.length; i++) {
            if (this.eq(set[i])) {
                return set.slice(0, i).concat(set.slice(i + 1))
            }
        }
        return set
    }
    ;
    Mark.prototype.isInSet = function isInSet(set) {
        for (var i = 0; i < set.length; i++) {
            if (this.eq(set[i])) {
                return true
            }
        }
        return false
    }
    ;
    Mark.prototype.eq = function eq(other) {
        return this == other || this.type == other.type && compareDeep(this.attrs, other.attrs)
    }
    ;
    Mark.prototype.toJSON = function toJSON() {
        var obj = {
            type: this.type.name
        };
        for (var _ in this.attrs) {
            obj.attrs = this.attrs;
            break
        }
        return obj
    }
    ;
    Mark.fromJSON = function fromJSON(schema, json) {
        if (!json) {
            throw new RangeError("Invalid input for Mark.fromJSON")
        }
        var type = schema.marks[json.type];
        if (!type) {
            throw new RangeError("There is no mark type " + json.type + " in this schema")
        }
        return type.create(json.attrs)
    }
    ;
    Mark.sameSet = function sameSet(a, b) {
        if (a == b) {
            return true
        }
        if (a.length != b.length) {
            return false
        }
        for (var i = 0; i < a.length; i++) {
            if (!a[i].eq(b[i])) {
                return false
            }
        }
        return true
    }
    ;
    Mark.setFrom = function setFrom(marks) {
        if (!marks || marks.length == 0) {
            return Mark.none
        }
        if (marks instanceof Mark) {
            return [marks]
        }
        var copy = marks.slice();
        copy.sort(function(a, b) {
            return a.type.rank - b.type.rank
        });
        return copy
    }
    ;
    Mark.none = [];
    function ReplaceError(message) {
        var err = Error.call(this, message);
        err.__proto__ = ReplaceError.prototype;
        return err
    }
    ReplaceError.prototype = Object.create(Error.prototype);
    ReplaceError.prototype.constructor = ReplaceError;
    ReplaceError.prototype.name = "ReplaceError";
    var Slice = function Slice(content, openStart, openEnd) {
        this.content = content;
        this.openStart = openStart;
        this.openEnd = openEnd
    };
    var prototypeAccessors$1 = {
        size: {
            configurable: true
        }
    };
    prototypeAccessors$1.size.get = function() {
        return this.content.size - this.openStart - this.openEnd
    }
    ;
    Slice.prototype.insertAt = function insertAt(pos, fragment) {
        var content = insertInto(this.content, pos + this.openStart, fragment, null);
        return content && new Slice(content,this.openStart,this.openEnd)
    }
    ;
    Slice.prototype.removeBetween = function removeBetween(from, to) {
        return new Slice(removeRange(this.content, from + this.openStart, to + this.openStart),this.openStart,this.openEnd)
    }
    ;
    Slice.prototype.eq = function eq(other) {
        return this.content.eq(other.content) && this.openStart == other.openStart && this.openEnd == other.openEnd
    }
    ;
    Slice.prototype.toString = function toString() {
        return this.content + "(" + this.openStart + "," + this.openEnd + ")"
    }
    ;
    Slice.prototype.toJSON = function toJSON() {
        if (!this.content.size) {
            return null
        }
        var json = {
            content: this.content.toJSON()
        };
        if (this.openStart > 0) {
            json.openStart = this.openStart
        }
        if (this.openEnd > 0) {
            json.openEnd = this.openEnd
        }
        return json
    }
    ;
    Slice.fromJSON = function fromJSON(schema, json) {
        if (!json) {
            return Slice.empty
        }
        var openStart = json.openStart || 0
            , openEnd = json.openEnd || 0;
        if (typeof openStart != "number" || typeof openEnd != "number") {
            throw new RangeError("Invalid input for Slice.fromJSON")
        }
        return new Slice(Fragment.fromJSON(schema, json.content),json.openStart || 0,json.openEnd || 0)
    }
    ;
    Slice.maxOpen = function maxOpen(fragment, openIsolating) {
        if (openIsolating === void 0)
            openIsolating = true;
        var openStart = 0
            , openEnd = 0;
        for (var n = fragment.firstChild; n && !n.isLeaf && (openIsolating || !n.type.spec.isolating); n = n.firstChild) {
            openStart++
        }
        for (var n$1 = fragment.lastChild; n$1 && !n$1.isLeaf && (openIsolating || !n$1.type.spec.isolating); n$1 = n$1.lastChild) {
            openEnd++
        }
        return new Slice(fragment,openStart,openEnd)
    }
    ;
    Object.defineProperties(Slice.prototype, prototypeAccessors$1);
    function removeRange(content, from, to) {
        var ref = content.findIndex(from);
        var index = ref.index;
        var offset = ref.offset;
        var child = content.maybeChild(index);
        var ref$1 = content.findIndex(to);
        var indexTo = ref$1.index;
        var offsetTo = ref$1.offset;
        if (offset == from || child.isText) {
            if (offsetTo != to && !content.child(indexTo).isText) {
                throw new RangeError("Removing non-flat range")
            }
            return content.cut(0, from).append(content.cut(to))
        }
        if (index != indexTo) {
            throw new RangeError("Removing non-flat range")
        }
        return content.replaceChild(index, child.copy(removeRange(child.content, from - offset - 1, to - offset - 1)))
    }
    function insertInto(content, dist, insert, parent) {
        var ref = content.findIndex(dist);
        var index = ref.index;
        var offset = ref.offset;
        var child = content.maybeChild(index);
        if (offset == dist || child.isText) {
            if (parent && !parent.canReplace(index, index, insert)) {
                return null
            }
            return content.cut(0, dist).append(insert).append(content.cut(dist))
        }
        var inner = insertInto(child.content, dist - offset - 1, insert);
        return inner && content.replaceChild(index, child.copy(inner))
    }
    Slice.empty = new Slice(Fragment.empty,0,0);
    function replace($from, $to, slice) {
        if (slice.openStart > $from.depth) {
            throw new ReplaceError("Inserted content deeper than insertion position")
        }
        if ($from.depth - slice.openStart != $to.depth - slice.openEnd) {
            throw new ReplaceError("Inconsistent open depths")
        }
        return replaceOuter($from, $to, slice, 0)
    }
    function replaceOuter($from, $to, slice, depth) {
        var index = $from.index(depth)
            , node = $from.node(depth);
        if (index == $to.index(depth) && depth < $from.depth - slice.openStart) {
            var inner = replaceOuter($from, $to, slice, depth + 1);
            return node.copy(node.content.replaceChild(index, inner))
        } else if (!slice.content.size) {
            return close(node, replaceTwoWay($from, $to, depth))
        } else if (!slice.openStart && !slice.openEnd && $from.depth == depth && $to.depth == depth) {
            var parent = $from.parent
                , content = parent.content;
            return close(parent, content.cut(0, $from.parentOffset).append(slice.content).append(content.cut($to.parentOffset)))
        } else {
            var ref = prepareSliceForReplace(slice, $from);
            var start = ref.start;
            var end = ref.end;
            return close(node, replaceThreeWay($from, start, end, $to, depth))
        }
    }
    function checkJoin(main, sub) {
        if (!sub.type.compatibleContent(main.type)) {
            throw new ReplaceError("Cannot join " + sub.type.name + " onto " + main.type.name)
        }
    }
    function joinable($before, $after, depth) {
        var node = $before.node(depth);
        checkJoin(node, $after.node(depth));
        return node
    }
    function addNode(child, target) {
        var last = target.length - 1;
        if (last >= 0 && child.isText && child.sameMarkup(target[last])) {
            target[last] = child.withText(target[last].text + child.text)
        } else {
            target.push(child)
        }
    }
    function addRange($start, $end, depth, target) {
        var node = ($end || $start).node(depth);
        var startIndex = 0
            , endIndex = $end ? $end.index(depth) : node.childCount;
        if ($start) {
            startIndex = $start.index(depth);
            if ($start.depth > depth) {
                startIndex++
            } else if ($start.textOffset) {
                addNode($start.nodeAfter, target);
                startIndex++
            }
        }
        for (var i = startIndex; i < endIndex; i++) {
            addNode(node.child(i), target)
        }
        if ($end && $end.depth == depth && $end.textOffset) {
            addNode($end.nodeBefore, target)
        }
    }
    function close(node, content) {
        if (!node.type.validContent(content)) {
            throw new ReplaceError("Invalid content for node " + node.type.name)
        }
        return node.copy(content)
    }
    function replaceThreeWay($from, $start, $end, $to, depth) {
        var openStart = $from.depth > depth && joinable($from, $start, depth + 1);
        var openEnd = $to.depth > depth && joinable($end, $to, depth + 1);
        var content = [];
        addRange(null, $from, depth, content);
        if (openStart && openEnd && $start.index(depth) == $end.index(depth)) {
            checkJoin(openStart, openEnd);
            addNode(close(openStart, replaceThreeWay($from, $start, $end, $to, depth + 1)), content)
        } else {
            if (openStart) {
                addNode(close(openStart, replaceTwoWay($from, $start, depth + 1)), content)
            }
            addRange($start, $end, depth, content);
            if (openEnd) {
                addNode(close(openEnd, replaceTwoWay($end, $to, depth + 1)), content)
            }
        }
        addRange($to, null, depth, content);
        return new Fragment(content)
    }
    function replaceTwoWay($from, $to, depth) {
        var content = [];
        addRange(null, $from, depth, content);
        if ($from.depth > depth) {
            var type = joinable($from, $to, depth + 1);
            addNode(close(type, replaceTwoWay($from, $to, depth + 1)), content)
        }
        addRange($to, null, depth, content);
        return new Fragment(content)
    }
    function prepareSliceForReplace(slice, $along) {
        var extra = $along.depth - slice.openStart
            , parent = $along.node(extra);
        var node = parent.copy(slice.content);
        for (var i = extra - 1; i >= 0; i--) {
            node = $along.node(i).copy(Fragment.from(node))
        }
        return {
            start: node.resolveNoCache(slice.openStart + extra),
            end: node.resolveNoCache(node.content.size - slice.openEnd - extra)
        }
    }
    var ResolvedPos = function ResolvedPos(pos, path, parentOffset) {
        this.pos = pos;
        this.path = path;
        this.depth = path.length / 3 - 1;
        this.parentOffset = parentOffset
    };
    var prototypeAccessors$2 = {
        parent: {
            configurable: true
        },
        doc: {
            configurable: true
        },
        textOffset: {
            configurable: true
        },
        nodeAfter: {
            configurable: true
        },
        nodeBefore: {
            configurable: true
        }
    };
    ResolvedPos.prototype.resolveDepth = function resolveDepth(val) {
        if (val == null) {
            return this.depth
        }
        if (val < 0) {
            return this.depth + val
        }
        return val
    }
    ;
    prototypeAccessors$2.parent.get = function() {
        return this.node(this.depth)
    }
    ;
    prototypeAccessors$2.doc.get = function() {
        return this.node(0)
    }
    ;
    ResolvedPos.prototype.node = function node(depth) {
        return this.path[this.resolveDepth(depth) * 3]
    }
    ;
    ResolvedPos.prototype.index = function index(depth) {
        return this.path[this.resolveDepth(depth) * 3 + 1]
    }
    ;
    ResolvedPos.prototype.indexAfter = function indexAfter(depth) {
        depth = this.resolveDepth(depth);
        return this.index(depth) + (depth == this.depth && !this.textOffset ? 0 : 1)
    }
    ;
    ResolvedPos.prototype.start = function start(depth) {
        depth = this.resolveDepth(depth);
        return depth == 0 ? 0 : this.path[depth * 3 - 1] + 1
    }
    ;
    ResolvedPos.prototype.end = function end(depth) {
        depth = this.resolveDepth(depth);
        return this.start(depth) + this.node(depth).content.size
    }
    ;
    ResolvedPos.prototype.before = function before(depth) {
        depth = this.resolveDepth(depth);
        if (!depth) {
            throw new RangeError("There is no position before the top-level node")
        }
        return depth == this.depth + 1 ? this.pos : this.path[depth * 3 - 1]
    }
    ;
    ResolvedPos.prototype.after = function after(depth) {
        depth = this.resolveDepth(depth);
        if (!depth) {
            throw new RangeError("There is no position after the top-level node")
        }
        return depth == this.depth + 1 ? this.pos : this.path[depth * 3 - 1] + this.path[depth * 3].nodeSize
    }
    ;
    prototypeAccessors$2.textOffset.get = function() {
        return this.pos - this.path[this.path.length - 1]
    }
    ;
    prototypeAccessors$2.nodeAfter.get = function() {
        var parent = this.parent
            , index = this.index(this.depth);
        if (index == parent.childCount) {
            return null
        }
        var dOff = this.pos - this.path[this.path.length - 1]
            , child = parent.child(index);
        return dOff ? parent.child(index).cut(dOff) : child
    }
    ;
    prototypeAccessors$2.nodeBefore.get = function() {
        var index = this.index(this.depth);
        var dOff = this.pos - this.path[this.path.length - 1];
        if (dOff) {
            return this.parent.child(index).cut(0, dOff)
        }
        return index == 0 ? null : this.parent.child(index - 1)
    }
    ;
    ResolvedPos.prototype.marks = function marks() {
        var parent = this.parent
            , index = this.index();
        if (parent.content.size == 0) {
            return Mark.none
        }
        if (this.textOffset) {
            return parent.child(index).marks
        }
        var main = parent.maybeChild(index - 1)
            , other = parent.maybeChild(index);
        if (!main) {
            var tmp = main;
            main = other;
            other = tmp
        }
        var marks = main.marks;
        for (var i = 0; i < marks.length; i++) {
            if (marks[i].type.spec.inclusive === false && (!other || !marks[i].isInSet(other.marks))) {
                marks = marks[i--].removeFromSet(marks)
            }
        }
        return marks
    }
    ;
    ResolvedPos.prototype.marksAcross = function marksAcross($end) {
        var after = this.parent.maybeChild(this.index());
        if (!after || !after.isInline) {
            return null
        }
        var marks = after.marks
            , next = $end.parent.maybeChild($end.index());
        for (var i = 0; i < marks.length; i++) {
            if (marks[i].type.spec.inclusive === false && (!next || !marks[i].isInSet(next.marks))) {
                marks = marks[i--].removeFromSet(marks)
            }
        }
        return marks
    }
    ;
    ResolvedPos.prototype.sharedDepth = function sharedDepth(pos) {
        for (var depth = this.depth; depth > 0; depth--) {
            if (this.start(depth) <= pos && this.end(depth) >= pos) {
                return depth
            }
        }
        return 0
    }
    ;
    ResolvedPos.prototype.blockRange = function blockRange(other, pred) {
        if (other === void 0)
            other = this;
        if (other.pos < this.pos) {
            return other.blockRange(this)
        }
        for (var d = this.depth - (this.parent.inlineContent || this.pos == other.pos ? 1 : 0); d >= 0; d--) {
            if (other.pos <= this.end(d) && (!pred || pred(this.node(d)))) {
                return new NodeRange(this,other,d)
            }
        }
    }
    ;
    ResolvedPos.prototype.sameParent = function sameParent(other) {
        return this.pos - this.parentOffset == other.pos - other.parentOffset
    }
    ;
    ResolvedPos.prototype.max = function max(other) {
        return other.pos > this.pos ? other : this
    }
    ;
    ResolvedPos.prototype.min = function min(other) {
        return other.pos < this.pos ? other : this
    }
    ;
    ResolvedPos.prototype.toString = function toString() {
        var str = "";
        for (var i = 1; i <= this.depth; i++) {
            str += (str ? "/" : "") + this.node(i).type.name + "_" + this.index(i - 1)
        }
        return str + ":" + this.parentOffset
    }
    ;
    ResolvedPos.resolve = function resolve(doc, pos) {
        if (!(pos >= 0 && pos <= doc.content.size)) {
            throw new RangeError("Position " + pos + " out of range")
        }
        var path = [];
        var start = 0
            , parentOffset = pos;
        for (var node = doc; ; ) {
            var ref = node.content.findIndex(parentOffset);
            var index = ref.index;
            var offset = ref.offset;
            var rem = parentOffset - offset;
            path.push(node, index, start + offset);
            if (!rem) {
                break
            }
            node = node.child(index);
            if (node.isText) {
                break
            }
            parentOffset = rem - 1;
            start += offset + 1
        }
        return new ResolvedPos(pos,path,parentOffset)
    }
    ;
    ResolvedPos.resolveCached = function resolveCached(doc, pos) {
        for (var i = 0; i < resolveCache.length; i++) {
            var cached = resolveCache[i];
            if (cached.pos == pos && cached.doc == doc) {
                return cached
            }
        }
        var result = resolveCache[resolveCachePos] = ResolvedPos.resolve(doc, pos);
        resolveCachePos = (resolveCachePos + 1) % resolveCacheSize;
        return result
    }
    ;
    Object.defineProperties(ResolvedPos.prototype, prototypeAccessors$2);
    var resolveCache = []
        , resolveCachePos = 0
        , resolveCacheSize = 12;
    var NodeRange = function NodeRange($from, $to, depth) {
        this.$from = $from;
        this.$to = $to;
        this.depth = depth
    };
    var prototypeAccessors$1$1 = {
        start: {
            configurable: true
        },
        end: {
            configurable: true
        },
        parent: {
            configurable: true
        },
        startIndex: {
            configurable: true
        },
        endIndex: {
            configurable: true
        }
    };
    prototypeAccessors$1$1.start.get = function() {
        return this.$from.before(this.depth + 1)
    }
    ;
    prototypeAccessors$1$1.end.get = function() {
        return this.$to.after(this.depth + 1)
    }
    ;
    prototypeAccessors$1$1.parent.get = function() {
        return this.$from.node(this.depth)
    }
    ;
    prototypeAccessors$1$1.startIndex.get = function() {
        return this.$from.index(this.depth)
    }
    ;
    prototypeAccessors$1$1.endIndex.get = function() {
        return this.$to.indexAfter(this.depth)
    }
    ;
    Object.defineProperties(NodeRange.prototype, prototypeAccessors$1$1);
    var emptyAttrs = Object.create(null);
    var Node = function Node(type, attrs, content, marks) {
        this.type = type;
        this.attrs = attrs;
        this.content = content || Fragment.empty;
        this.marks = marks || Mark.none
    };
    var prototypeAccessors$3 = {
        nodeSize: {
            configurable: true
        },
        childCount: {
            configurable: true
        },
        textContent: {
            configurable: true
        },
        firstChild: {
            configurable: true
        },
        lastChild: {
            configurable: true
        },
        isBlock: {
            configurable: true
        },
        isTextblock: {
            configurable: true
        },
        inlineContent: {
            configurable: true
        },
        isInline: {
            configurable: true
        },
        isText: {
            configurable: true
        },
        isLeaf: {
            configurable: true
        },
        isAtom: {
            configurable: true
        }
    };
    prototypeAccessors$3.nodeSize.get = function() {
        return this.isLeaf ? 1 : 2 + this.content.size
    }
    ;
    prototypeAccessors$3.childCount.get = function() {
        return this.content.childCount
    }
    ;
    Node.prototype.child = function child(index) {
        return this.content.child(index)
    }
    ;
    Node.prototype.maybeChild = function maybeChild(index) {
        return this.content.maybeChild(index)
    }
    ;
    Node.prototype.forEach = function forEach(f) {
        this.content.forEach(f)
    }
    ;
    Node.prototype.nodesBetween = function nodesBetween(from, to, f, startPos) {
        if (startPos === void 0)
            startPos = 0;
        this.content.nodesBetween(from, to, f, startPos, this)
    }
    ;
    Node.prototype.descendants = function descendants(f) {
        this.nodesBetween(0, this.content.size, f)
    }
    ;
    prototypeAccessors$3.textContent.get = function() {
        return this.textBetween(0, this.content.size, "")
    }
    ;
    Node.prototype.textBetween = function textBetween(from, to, blockSeparator, leafText) {
        return this.content.textBetween(from, to, blockSeparator, leafText)
    }
    ;
    prototypeAccessors$3.firstChild.get = function() {
        return this.content.firstChild
    }
    ;
    prototypeAccessors$3.lastChild.get = function() {
        return this.content.lastChild
    }
    ;
    Node.prototype.eq = function eq(other) {
        return this == other || this.sameMarkup(other) && this.content.eq(other.content)
    }
    ;
    Node.prototype.sameMarkup = function sameMarkup(other) {
        return this.hasMarkup(other.type, other.attrs, other.marks)
    }
    ;
    Node.prototype.hasMarkup = function hasMarkup(type, attrs, marks) {
        return this.type == type && compareDeep(this.attrs, attrs || type.defaultAttrs || emptyAttrs) && Mark.sameSet(this.marks, marks || Mark.none)
    }
    ;
    Node.prototype.copy = function copy(content) {
        if (content === void 0)
            content = null;
        if (content == this.content) {
            return this
        }
        return new this.constructor(this.type,this.attrs,content,this.marks)
    }
    ;
    Node.prototype.mark = function mark(marks) {
        return marks == this.marks ? this : new this.constructor(this.type,this.attrs,this.content,marks)
    }
    ;
    Node.prototype.cut = function cut(from, to) {
        if (from == 0 && to == this.content.size) {
            return this
        }
        return this.copy(this.content.cut(from, to))
    }
    ;
    Node.prototype.slice = function slice(from, to, includeParents) {
        if (to === void 0)
            to = this.content.size;
        if (includeParents === void 0)
            includeParents = false;
        if (from == to) {
            return Slice.empty
        }
        var $from = this.resolve(from)
            , $to = this.resolve(to);
        var depth = includeParents ? 0 : $from.sharedDepth(to);
        var start = $from.start(depth)
            , node = $from.node(depth);
        var content = node.content.cut($from.pos - start, $to.pos - start);
        return new Slice(content,$from.depth - depth,$to.depth - depth)
    }
    ;
    Node.prototype.replace = function replace$1(from, to, slice) {
        return replace(this.resolve(from), this.resolve(to), slice)
    }
    ;
    Node.prototype.nodeAt = function nodeAt(pos) {
        for (var node = this; ; ) {
            var ref = node.content.findIndex(pos);
            var index = ref.index;
            var offset = ref.offset;
            node = node.maybeChild(index);
            if (!node) {
                return null
            }
            if (offset == pos || node.isText) {
                return node
            }
            pos -= offset + 1
        }
    }
    ;
    Node.prototype.childAfter = function childAfter(pos) {
        var ref = this.content.findIndex(pos);
        var index = ref.index;
        var offset = ref.offset;
        return {
            node: this.content.maybeChild(index),
            index: index,
            offset: offset
        }
    }
    ;
    Node.prototype.childBefore = function childBefore(pos) {
        if (pos == 0) {
            return {
                node: null,
                index: 0,
                offset: 0
            }
        }
        var ref = this.content.findIndex(pos);
        var index = ref.index;
        var offset = ref.offset;
        if (offset < pos) {
            return {
                node: this.content.child(index),
                index: index,
                offset: offset
            }
        }
        var node = this.content.child(index - 1);
        return {
            node: node,
            index: index - 1,
            offset: offset - node.nodeSize
        }
    }
    ;
    Node.prototype.resolve = function resolve(pos) {
        return ResolvedPos.resolveCached(this, pos)
    }
    ;
    Node.prototype.resolveNoCache = function resolveNoCache(pos) {
        return ResolvedPos.resolve(this, pos)
    }
    ;
    Node.prototype.rangeHasMark = function rangeHasMark(from, to, type) {
        var found = false;
        if (to > from) {
            this.nodesBetween(from, to, function(node) {
                if (type.isInSet(node.marks)) {
                    found = true
                }
                return !found
            })
        }
        return found
    }
    ;
    prototypeAccessors$3.isBlock.get = function() {
        return this.type.isBlock
    }
    ;
    prototypeAccessors$3.isTextblock.get = function() {
        return this.type.isTextblock
    }
    ;
    prototypeAccessors$3.inlineContent.get = function() {
        return this.type.inlineContent
    }
    ;
    prototypeAccessors$3.isInline.get = function() {
        return this.type.isInline
    }
    ;
    prototypeAccessors$3.isText.get = function() {
        return this.type.isText
    }
    ;
    prototypeAccessors$3.isLeaf.get = function() {
        return this.type.isLeaf
    }
    ;
    prototypeAccessors$3.isAtom.get = function() {
        return this.type.isAtom
    }
    ;
    Node.prototype.toString = function toString() {
        if (this.type.spec.toDebugString) {
            return this.type.spec.toDebugString(this)
        }
        var name = this.type.name;
        if (this.content.size) {
            name += "(" + this.content.toStringInner() + ")"
        }
        return wrapMarks(this.marks, name)
    }
    ;
    Node.prototype.contentMatchAt = function contentMatchAt(index) {
        var match = this.type.contentMatch.matchFragment(this.content, 0, index);
        if (!match) {
            throw new Error("Called contentMatchAt on a node with invalid content")
        }
        return match
    }
    ;
    Node.prototype.canReplace = function canReplace(from, to, replacement, start, end) {
        if (replacement === void 0)
            replacement = Fragment.empty;
        if (start === void 0)
            start = 0;
        if (end === void 0)
            end = replacement.childCount;
        var one = this.contentMatchAt(from).matchFragment(replacement, start, end);
        var two = one && one.matchFragment(this.content, to);
        if (!two || !two.validEnd) {
            return false
        }
        for (var i = start; i < end; i++) {
            if (!this.type.allowsMarks(replacement.child(i).marks)) {
                return false
            }
        }
        return true
    }
    ;
    Node.prototype.canReplaceWith = function canReplaceWith(from, to, type, marks) {
        if (marks && !this.type.allowsMarks(marks)) {
            return false
        }
        var start = this.contentMatchAt(from).matchType(type);
        var end = start && start.matchFragment(this.content, to);
        return end ? end.validEnd : false
    }
    ;
    Node.prototype.canAppend = function canAppend(other) {
        if (other.content.size) {
            return this.canReplace(this.childCount, this.childCount, other.content)
        } else {
            return this.type.compatibleContent(other.type)
        }
    }
    ;
    Node.prototype.check = function check() {
        if (!this.type.validContent(this.content)) {
            throw new RangeError("Invalid content for node " + this.type.name + ": " + this.content.toString().slice(0, 50))
        }
        this.content.forEach(function(node) {
            return node.check()
        })
    }
    ;
    Node.prototype.toJSON = function toJSON() {
        var obj = {
            type: this.type.name
        };
        for (var _ in this.attrs) {
            obj.attrs = this.attrs;
            break
        }
        if (this.content.size) {
            obj.content = this.content.toJSON()
        }
        if (this.marks.length) {
            obj.marks = this.marks.map(function(n) {
                return n.toJSON()
            })
        }
        return obj
    }
    ;
    Node.fromJSON = function fromJSON(schema, json) {
        if (!json) {
            throw new RangeError("Invalid input for Node.fromJSON")
        }
        var marks = null;
        if (json.marks) {
            if (!Array.isArray(json.marks)) {
                throw new RangeError("Invalid mark data for Node.fromJSON")
            }
            marks = json.marks.map(schema.markFromJSON)
        }
        if (json.type == "text") {
            if (typeof json.text != "string") {
                throw new RangeError("Invalid text node in JSON")
            }
            return schema.text(json.text, marks)
        }
        var content = Fragment.fromJSON(schema, json.content);
        return schema.nodeType(json.type).create(json.attrs, content, marks)
    }
    ;
    Object.defineProperties(Node.prototype, prototypeAccessors$3);
    var TextNode = function(Node) {
        function TextNode(type, attrs, content, marks) {
            Node.call(this, type, attrs, null, marks);
            if (!content) {
                throw new RangeError("Empty text nodes are not allowed")
            }
            this.text = content
        }
        if (Node)
            TextNode.__proto__ = Node;
        TextNode.prototype = Object.create(Node && Node.prototype);
        TextNode.prototype.constructor = TextNode;
        var prototypeAccessors$1 = {
            textContent: {
                configurable: true
            },
            nodeSize: {
                configurable: true
            }
        };
        TextNode.prototype.toString = function toString() {
            if (this.type.spec.toDebugString) {
                return this.type.spec.toDebugString(this)
            }
            return wrapMarks(this.marks, JSON.stringify(this.text))
        }
        ;
        prototypeAccessors$1.textContent.get = function() {
            return this.text
        }
        ;
        TextNode.prototype.textBetween = function textBetween(from, to) {
            return this.text.slice(from, to)
        }
        ;
        prototypeAccessors$1.nodeSize.get = function() {
            return this.text.length
        }
        ;
        TextNode.prototype.mark = function mark(marks) {
            return marks == this.marks ? this : new TextNode(this.type,this.attrs,this.text,marks)
        }
        ;
        TextNode.prototype.withText = function withText(text) {
            if (text == this.text) {
                return this
            }
            return new TextNode(this.type,this.attrs,text,this.marks)
        }
        ;
        TextNode.prototype.cut = function cut(from, to) {
            if (from === void 0)
                from = 0;
            if (to === void 0)
                to = this.text.length;
            if (from == 0 && to == this.text.length) {
                return this
            }
            return this.withText(this.text.slice(from, to))
        }
        ;
        TextNode.prototype.eq = function eq(other) {
            return this.sameMarkup(other) && this.text == other.text
        }
        ;
        TextNode.prototype.toJSON = function toJSON() {
            var base = Node.prototype.toJSON.call(this);
            base.text = this.text;
            return base
        }
        ;
        Object.defineProperties(TextNode.prototype, prototypeAccessors$1);
        return TextNode
    }(Node);
    function wrapMarks(marks, str) {
        for (var i = marks.length - 1; i >= 0; i--) {
            str = marks[i].type.name + "(" + str + ")"
        }
        return str
    }
    var ContentMatch = function ContentMatch(validEnd) {
        this.validEnd = validEnd;
        this.next = [];
        this.wrapCache = []
    };
    var prototypeAccessors$4 = {
        inlineContent: {
            configurable: true
        },
        defaultType: {
            configurable: true
        },
        edgeCount: {
            configurable: true
        }
    };
    ContentMatch.parse = function parse(string, nodeTypes) {
        var stream = new TokenStream(string,nodeTypes);
        if (stream.next == null) {
            return ContentMatch.empty
        }
        var expr = parseExpr(stream);
        if (stream.next) {
            stream.err("Unexpected trailing text")
        }
        var match = dfa(nfa(expr));
        checkForDeadEnds(match, stream);
        return match
    }
    ;
    ContentMatch.prototype.matchType = function matchType(type) {
        for (var i = 0; i < this.next.length; i += 2) {
            if (this.next[i] == type) {
                return this.next[i + 1]
            }
        }
        return null
    }
    ;
    ContentMatch.prototype.matchFragment = function matchFragment(frag, start, end) {
        if (start === void 0)
            start = 0;
        if (end === void 0)
            end = frag.childCount;
        var cur = this;
        for (var i = start; cur && i < end; i++) {
            cur = cur.matchType(frag.child(i).type)
        }
        return cur
    }
    ;
    prototypeAccessors$4.inlineContent.get = function() {
        var first = this.next[0];
        return first ? first.isInline : false
    }
    ;
    prototypeAccessors$4.defaultType.get = function() {
        for (var i = 0; i < this.next.length; i += 2) {
            var type = this.next[i];
            if (!(type.isText || type.hasRequiredAttrs())) {
                return type
            }
        }
    }
    ;
    ContentMatch.prototype.compatible = function compatible(other) {
        for (var i = 0; i < this.next.length; i += 2) {
            for (var j = 0; j < other.next.length; j += 2) {
                if (this.next[i] == other.next[j]) {
                    return true
                }
            }
        }
        return false
    }
    ;
    ContentMatch.prototype.fillBefore = function fillBefore(after, toEnd, startIndex) {
        if (toEnd === void 0)
            toEnd = false;
        if (startIndex === void 0)
            startIndex = 0;
        var seen = [this];
        function search(match, types) {
            var finished = match.matchFragment(after, startIndex);
            if (finished && (!toEnd || finished.validEnd)) {
                return Fragment.from(types.map(function(tp) {
                    return tp.createAndFill()
                }))
            }
            for (var i = 0; i < match.next.length; i += 2) {
                var type = match.next[i]
                    , next = match.next[i + 1];
                if (!(type.isText || type.hasRequiredAttrs()) && seen.indexOf(next) == -1) {
                    seen.push(next);
                    var found = search(next, types.concat(type));
                    if (found) {
                        return found
                    }
                }
            }
        }
        return search(this, [])
    }
    ;
    ContentMatch.prototype.findWrapping = function findWrapping(target) {
        for (var i = 0; i < this.wrapCache.length; i += 2) {
            if (this.wrapCache[i] == target) {
                return this.wrapCache[i + 1]
            }
        }
        var computed = this.computeWrapping(target);
        this.wrapCache.push(target, computed);
        return computed
    }
    ;
    ContentMatch.prototype.computeWrapping = function computeWrapping(target) {
        var seen = Object.create(null)
            , active = [{
            match: this,
            type: null,
            via: null
        }];
        while (active.length) {
            var current = active.shift()
                , match = current.match;
            if (match.matchType(target)) {
                var result = [];
                for (var obj = current; obj.type; obj = obj.via) {
                    result.push(obj.type)
                }
                return result.reverse()
            }
            for (var i = 0; i < match.next.length; i += 2) {
                var type = match.next[i];
                if (!type.isLeaf && !type.hasRequiredAttrs() && !(type.name in seen) && (!current.type || match.next[i + 1].validEnd)) {
                    active.push({
                        match: type.contentMatch,
                        type: type,
                        via: current
                    });
                    seen[type.name] = true
                }
            }
        }
    }
    ;
    prototypeAccessors$4.edgeCount.get = function() {
        return this.next.length >> 1
    }
    ;
    ContentMatch.prototype.edge = function edge(n) {
        var i = n << 1;
        if (i >= this.next.length) {
            throw new RangeError("There's no " + n + "th edge in this content match")
        }
        return {
            type: this.next[i],
            next: this.next[i + 1]
        }
    }
    ;
    ContentMatch.prototype.toString = function toString() {
        var seen = [];
        function scan(m) {
            seen.push(m);
            for (var i = 1; i < m.next.length; i += 2) {
                if (seen.indexOf(m.next[i]) == -1) {
                    scan(m.next[i])
                }
            }
        }
        scan(this);
        return seen.map(function(m, i) {
            var out = i + (m.validEnd ? "*" : " ") + " ";
            for (var i$1 = 0; i$1 < m.next.length; i$1 += 2) {
                out += (i$1 ? ", " : "") + m.next[i$1].name + "->" + seen.indexOf(m.next[i$1 + 1])
            }
            return out
        }).join("\n")
    }
    ;
    Object.defineProperties(ContentMatch.prototype, prototypeAccessors$4);
    ContentMatch.empty = new ContentMatch(true);
    var TokenStream = function TokenStream(string, nodeTypes) {
        this.string = string;
        this.nodeTypes = nodeTypes;
        this.inline = null;
        this.pos = 0;
        this.tokens = string.split(/\s*(?=\b|\W|$)/);
        if (this.tokens[this.tokens.length - 1] == "") {
            this.tokens.pop()
        }
        if (this.tokens[0] == "") {
            this.tokens.unshift()
        }
    };
    var prototypeAccessors$1$2 = {
        next: {
            configurable: true
        }
    };
    prototypeAccessors$1$2.next.get = function() {
        return this.tokens[this.pos]
    }
    ;
    TokenStream.prototype.eat = function eat(tok) {
        return this.next == tok && (this.pos++ || true)
    }
    ;
    TokenStream.prototype.err = function err(str) {
        throw new SyntaxError(str + " (in content expression '" + this.string + "')")
    }
    ;
    Object.defineProperties(TokenStream.prototype, prototypeAccessors$1$2);
    function parseExpr(stream) {
        var exprs = [];
        do {
            exprs.push(parseExprSeq(stream))
        } while (stream.eat("|"));return exprs.length == 1 ? exprs[0] : {
            type: "choice",
            exprs: exprs
        }
    }
    function parseExprSeq(stream) {
        var exprs = [];
        do {
            exprs.push(parseExprSubscript(stream))
        } while (stream.next && stream.next != ")" && stream.next != "|");return exprs.length == 1 ? exprs[0] : {
            type: "seq",
            exprs: exprs
        }
    }
    function parseExprSubscript(stream) {
        var expr = parseExprAtom(stream);
        for (; ; ) {
            if (stream.eat("+")) {
                expr = {
                    type: "plus",
                    expr: expr
                }
            } else if (stream.eat("*")) {
                expr = {
                    type: "star",
                    expr: expr
                }
            } else if (stream.eat("?")) {
                expr = {
                    type: "opt",
                    expr: expr
                }
            } else if (stream.eat("{")) {
                expr = parseExprRange(stream, expr)
            } else {
                break
            }
        }
        return expr
    }
    function parseNum(stream) {
        if (/\D/.test(stream.next)) {
            stream.err("Expected number, got '" + stream.next + "'")
        }
        var result = Number(stream.next);
        stream.pos++;
        return result
    }
    function parseExprRange(stream, expr) {
        var min = parseNum(stream)
            , max = min;
        if (stream.eat(",")) {
            if (stream.next != "}") {
                max = parseNum(stream)
            } else {
                max = -1
            }
        }
        if (!stream.eat("}")) {
            stream.err("Unclosed braced range")
        }
        return {
            type: "range",
            min: min,
            max: max,
            expr: expr
        }
    }
    function resolveName(stream, name) {
        var types = stream.nodeTypes
            , type = types[name];
        if (type) {
            return [type]
        }
        var result = [];
        for (var typeName in types) {
            var type$1 = types[typeName];
            if (type$1.groups.indexOf(name) > -1) {
                result.push(type$1)
            }
        }
        if (result.length == 0) {
            stream.err("No node type or group '" + name + "' found")
        }
        return result
    }
    function parseExprAtom(stream) {
        if (stream.eat("(")) {
            var expr = parseExpr(stream);
            if (!stream.eat(")")) {
                stream.err("Missing closing paren")
            }
            return expr
        } else if (!/\W/.test(stream.next)) {
            var exprs = resolveName(stream, stream.next).map(function(type) {
                if (stream.inline == null) {
                    stream.inline = type.isInline
                } else if (stream.inline != type.isInline) {
                    stream.err("Mixing inline and block content")
                }
                return {
                    type: "name",
                    value: type
                }
            });
            stream.pos++;
            return exprs.length == 1 ? exprs[0] : {
                type: "choice",
                exprs: exprs
            }
        } else {
            stream.err("Unexpected token '" + stream.next + "'")
        }
    }
    function nfa(expr) {
        var nfa = [[]];
        connect(compile(expr, 0), node());
        return nfa;
        function node() {
            return nfa.push([]) - 1
        }
        function edge(from, to, term) {
            var edge = {
                term: term,
                to: to
            };
            nfa[from].push(edge);
            return edge
        }
        function connect(edges, to) {
            edges.forEach(function(edge) {
                return edge.to = to
            })
        }
        function compile(expr, from) {
            if (expr.type == "choice") {
                return expr.exprs.reduce(function(out, expr) {
                    return out.concat(compile(expr, from))
                }, [])
            } else if (expr.type == "seq") {
                for (var i = 0; ; i++) {
                    var next = compile(expr.exprs[i], from);
                    if (i == expr.exprs.length - 1) {
                        return next
                    }
                    connect(next, from = node())
                }
            } else if (expr.type == "star") {
                var loop = node();
                edge(from, loop);
                connect(compile(expr.expr, loop), loop);
                return [edge(loop)]
            } else if (expr.type == "plus") {
                var loop$1 = node();
                connect(compile(expr.expr, from), loop$1);
                connect(compile(expr.expr, loop$1), loop$1);
                return [edge(loop$1)]
            } else if (expr.type == "opt") {
                return [edge(from)].concat(compile(expr.expr, from))
            } else if (expr.type == "range") {
                var cur = from;
                for (var i$1 = 0; i$1 < expr.min; i$1++) {
                    var next$1 = node();
                    connect(compile(expr.expr, cur), next$1);
                    cur = next$1
                }
                if (expr.max == -1) {
                    connect(compile(expr.expr, cur), cur)
                } else {
                    for (var i$2 = expr.min; i$2 < expr.max; i$2++) {
                        var next$2 = node();
                        edge(cur, next$2);
                        connect(compile(expr.expr, cur), next$2);
                        cur = next$2
                    }
                }
                return [edge(cur)]
            } else if (expr.type == "name") {
                return [edge(from, null, expr.value)]
            }
        }
    }
    function cmp(a, b) {
        return b - a
    }
    function nullFrom(nfa, node) {
        var result = [];
        scan(node);
        return result.sort(cmp);
        function scan(node) {
            var edges = nfa[node];
            if (edges.length == 1 && !edges[0].term) {
                return scan(edges[0].to)
            }
            result.push(node);
            for (var i = 0; i < edges.length; i++) {
                var ref = edges[i];
                var term = ref.term;
                var to = ref.to;
                if (!term && result.indexOf(to) == -1) {
                    scan(to)
                }
            }
        }
    }
    function dfa(nfa) {
        var labeled = Object.create(null);
        return explore(nullFrom(nfa, 0));
        function explore(states) {
            var out = [];
            states.forEach(function(node) {
                nfa[node].forEach(function(ref) {
                    var term = ref.term;
                    var to = ref.to;
                    if (!term) {
                        return
                    }
                    var known = out.indexOf(term)
                        , set = known > -1 && out[known + 1];
                    nullFrom(nfa, to).forEach(function(node) {
                        if (!set) {
                            out.push(term, set = [])
                        }
                        if (set.indexOf(node) == -1) {
                            set.push(node)
                        }
                    })
                })
            });
            var state = labeled[states.join(",")] = new ContentMatch(states.indexOf(nfa.length - 1) > -1);
            for (var i = 0; i < out.length; i += 2) {
                var states$1 = out[i + 1].sort(cmp);
                state.next.push(out[i], labeled[states$1.join(",")] || explore(states$1))
            }
            return state
        }
    }
    function checkForDeadEnds(match, stream) {
        for (var i = 0, work = [match]; i < work.length; i++) {
            var state = work[i]
                , dead = !state.validEnd
                , nodes = [];
            for (var j = 0; j < state.next.length; j += 2) {
                var node = state.next[j]
                    , next = state.next[j + 1];
                nodes.push(node.name);
                if (dead && !(node.isText || node.hasRequiredAttrs())) {
                    dead = false
                }
                if (work.indexOf(next) == -1) {
                    work.push(next)
                }
            }
            if (dead) {
                stream.err("Only non-generatable nodes (" + nodes.join(", ") + ") in a required position")
            }
        }
    }
    function defaultAttrs(attrs) {
        var defaults = Object.create(null);
        for (var attrName in attrs) {
            var attr = attrs[attrName];
            if (!attr.hasDefault) {
                return null
            }
            defaults[attrName] = attr.default
        }
        return defaults
    }
    function computeAttrs(attrs, value) {
        var built = Object.create(null);
        for (var name in attrs) {
            var given = value && value[name];
            if (given === undefined) {
                var attr = attrs[name];
                if (attr.hasDefault) {
                    given = attr.default
                } else {
                    throw new RangeError("No value supplied for attribute " + name)
                }
            }
            built[name] = given
        }
        return built
    }
    function initAttrs(attrs) {
        var result = Object.create(null);
        if (attrs) {
            for (var name in attrs) {
                result[name] = new Attribute(attrs[name])
            }
        }
        return result
    }
    var NodeType = function NodeType(name, schema, spec) {
        this.name = name;
        this.schema = schema;
        this.spec = spec;
        this.groups = spec.group ? spec.group.split(" ") : [];
        this.attrs = initAttrs(spec.attrs);
        this.defaultAttrs = defaultAttrs(this.attrs);
        this.contentMatch = null;
        this.markSet = null;
        this.inlineContent = null;
        this.isBlock = !(spec.inline || name == "text");
        this.isText = name == "text"
    };
    var prototypeAccessors$5 = {
        isInline: {
            configurable: true
        },
        isTextblock: {
            configurable: true
        },
        isLeaf: {
            configurable: true
        },
        isAtom: {
            configurable: true
        }
    };
    prototypeAccessors$5.isInline.get = function() {
        return !this.isBlock
    }
    ;
    prototypeAccessors$5.isTextblock.get = function() {
        return this.isBlock && this.inlineContent
    }
    ;
    prototypeAccessors$5.isLeaf.get = function() {
        return this.contentMatch == ContentMatch.empty
    }
    ;
    prototypeAccessors$5.isAtom.get = function() {
        return this.isLeaf || this.spec.atom
    }
    ;
    NodeType.prototype.hasRequiredAttrs = function hasRequiredAttrs() {
        for (var n in this.attrs) {
            if (this.attrs[n].isRequired) {
                return true
            }
        }
        return false
    }
    ;
    NodeType.prototype.compatibleContent = function compatibleContent(other) {
        return this == other || this.contentMatch.compatible(other.contentMatch)
    }
    ;
    NodeType.prototype.computeAttrs = function computeAttrs$1(attrs) {
        if (!attrs && this.defaultAttrs) {
            return this.defaultAttrs
        } else {
            return computeAttrs(this.attrs, attrs)
        }
    }
    ;
    NodeType.prototype.create = function create(attrs, content, marks) {
        if (this.isText) {
            throw new Error("NodeType.create can't construct text nodes")
        }
        return new Node(this,this.computeAttrs(attrs),Fragment.from(content),Mark.setFrom(marks))
    }
    ;
    NodeType.prototype.createChecked = function createChecked(attrs, content, marks) {
        content = Fragment.from(content);
        if (!this.validContent(content)) {
            throw new RangeError("Invalid content for node " + this.name)
        }
        return new Node(this,this.computeAttrs(attrs),content,Mark.setFrom(marks))
    }
    ;
    NodeType.prototype.createAndFill = function createAndFill(attrs, content, marks) {
        attrs = this.computeAttrs(attrs);
        content = Fragment.from(content);
        if (content.size) {
            var before = this.contentMatch.fillBefore(content);
            if (!before) {
                return null
            }
            content = before.append(content)
        }
        var after = this.contentMatch.matchFragment(content).fillBefore(Fragment.empty, true);
        if (!after) {
            return null
        }
        return new Node(this,attrs,content.append(after),Mark.setFrom(marks))
    }
    ;
    NodeType.prototype.validContent = function validContent(content) {
        var result = this.contentMatch.matchFragment(content);
        if (!result || !result.validEnd) {
            return false
        }
        for (var i = 0; i < content.childCount; i++) {
            if (!this.allowsMarks(content.child(i).marks)) {
                return false
            }
        }
        return true
    }
    ;
    NodeType.prototype.allowsMarkType = function allowsMarkType(markType) {
        return this.markSet == null || this.markSet.indexOf(markType) > -1
    }
    ;
    NodeType.prototype.allowsMarks = function allowsMarks(marks) {
        if (this.markSet == null) {
            return true
        }
        for (var i = 0; i < marks.length; i++) {
            if (!this.allowsMarkType(marks[i].type)) {
                return false
            }
        }
        return true
    }
    ;
    NodeType.prototype.allowedMarks = function allowedMarks(marks) {
        if (this.markSet == null) {
            return marks
        }
        var copy;
        for (var i = 0; i < marks.length; i++) {
            if (!this.allowsMarkType(marks[i].type)) {
                if (!copy) {
                    copy = marks.slice(0, i)
                }
            } else if (copy) {
                copy.push(marks[i])
            }
        }
        return !copy ? marks : copy.length ? copy : Mark.empty
    }
    ;
    NodeType.compile = function compile(nodes, schema) {
        var result = Object.create(null);
        nodes.forEach(function(name, spec) {
            return result[name] = new NodeType(name,schema,spec)
        });
        var topType = schema.spec.topNode || "doc";
        if (!result[topType]) {
            throw new RangeError("Schema is missing its top node type ('" + topType + "')")
        }
        if (!result.text) {
            throw new RangeError("Every schema needs a 'text' type")
        }
        for (var _ in result.text.attrs) {
            throw new RangeError("The text node type should not have attributes")
        }
        return result
    }
    ;
    Object.defineProperties(NodeType.prototype, prototypeAccessors$5);
    var Attribute = function Attribute(options) {
        this.hasDefault = Object.prototype.hasOwnProperty.call(options, "default");
        this.default = options.default
    };
    var prototypeAccessors$1$3 = {
        isRequired: {
            configurable: true
        }
    };
    prototypeAccessors$1$3.isRequired.get = function() {
        return !this.hasDefault
    }
    ;
    Object.defineProperties(Attribute.prototype, prototypeAccessors$1$3);
    var MarkType = function MarkType(name, rank, schema, spec) {
        this.name = name;
        this.schema = schema;
        this.spec = spec;
        this.attrs = initAttrs(spec.attrs);
        this.rank = rank;
        this.excluded = null;
        var defaults = defaultAttrs(this.attrs);
        this.instance = defaults && new Mark(this,defaults)
    };
    MarkType.prototype.create = function create(attrs) {
        if (!attrs && this.instance) {
            return this.instance
        }
        return new Mark(this,computeAttrs(this.attrs, attrs))
    }
    ;
    MarkType.compile = function compile(marks, schema) {
        var result = Object.create(null)
            , rank = 0;
        marks.forEach(function(name, spec) {
            return result[name] = new MarkType(name,rank++,schema,spec)
        });
        return result
    }
    ;
    MarkType.prototype.removeFromSet = function removeFromSet(set) {
        for (var i = 0; i < set.length; i++) {
            if (set[i].type == this) {
                return set.slice(0, i).concat(set.slice(i + 1))
            }
        }
        return set
    }
    ;
    MarkType.prototype.isInSet = function isInSet(set) {
        for (var i = 0; i < set.length; i++) {
            if (set[i].type == this) {
                return set[i]
            }
        }
    }
    ;
    MarkType.prototype.excludes = function excludes(other) {
        return this.excluded.indexOf(other) > -1
    }
    ;
    var Schema = function Schema(spec) {
        this.spec = {};
        for (var prop in spec) {
            this.spec[prop] = spec[prop]
        }
        this.spec.nodes = OrderedMap.from(spec.nodes);
        this.spec.marks = OrderedMap.from(spec.marks);
        this.nodes = NodeType.compile(this.spec.nodes, this);
        this.marks = MarkType.compile(this.spec.marks, this);
        var contentExprCache = Object.create(null);
        for (var prop$1 in this.nodes) {
            if (prop$1 in this.marks) {
                throw new RangeError(prop$1 + " can not be both a node and a mark")
            }
            var type = this.nodes[prop$1]
                , contentExpr = type.spec.content || ""
                , markExpr = type.spec.marks;
            type.contentMatch = contentExprCache[contentExpr] || (contentExprCache[contentExpr] = ContentMatch.parse(contentExpr, this.nodes));
            type.inlineContent = type.contentMatch.inlineContent;
            type.markSet = markExpr == "_" ? null : markExpr ? gatherMarks(this, markExpr.split(" ")) : markExpr == "" || !type.inlineContent ? [] : null
        }
        for (var prop$2 in this.marks) {
            var type$1 = this.marks[prop$2]
                , excl = type$1.spec.excludes;
            type$1.excluded = excl == null ? [type$1] : excl == "" ? [] : gatherMarks(this, excl.split(" "))
        }
        this.nodeFromJSON = this.nodeFromJSON.bind(this);
        this.markFromJSON = this.markFromJSON.bind(this);
        this.topNodeType = this.nodes[this.spec.topNode || "doc"];
        this.cached = Object.create(null);
        this.cached.wrappings = Object.create(null)
    };
    Schema.prototype.node = function node(type, attrs, content, marks) {
        if (typeof type == "string") {
            type = this.nodeType(type)
        } else if (!(type instanceof NodeType)) {
            throw new RangeError("Invalid node type: " + type)
        } else if (type.schema != this) {
            throw new RangeError("Node type from different schema used (" + type.name + ")")
        }
        return type.createChecked(attrs, content, marks)
    }
    ;
    Schema.prototype.text = function text(text$1, marks) {
        var type = this.nodes.text;
        return new TextNode(type,type.defaultAttrs,text$1,Mark.setFrom(marks))
    }
    ;
    Schema.prototype.mark = function mark(type, attrs) {
        if (typeof type == "string") {
            type = this.marks[type]
        }
        return type.create(attrs)
    }
    ;
    Schema.prototype.nodeFromJSON = function nodeFromJSON(json) {
        return Node.fromJSON(this, json)
    }
    ;
    Schema.prototype.markFromJSON = function markFromJSON(json) {
        return Mark.fromJSON(this, json)
    }
    ;
    Schema.prototype.nodeType = function nodeType(name) {
        var found = this.nodes[name];
        if (!found) {
            throw new RangeError("Unknown node type: " + name)
        }
        return found
    }
    ;
    function gatherMarks(schema, marks) {
        var found = [];
        for (var i = 0; i < marks.length; i++) {
            var name = marks[i]
                , mark = schema.marks[name]
                , ok = mark;
            if (mark) {
                found.push(mark)
            } else {
                for (var prop in schema.marks) {
                    var mark$1 = schema.marks[prop];
                    if (name == "_" || mark$1.spec.group && mark$1.spec.group.split(" ").indexOf(name) > -1) {
                        found.push(ok = mark$1)
                    }
                }
            }
            if (!ok) {
                throw new SyntaxError("Unknown mark type: '" + marks[i] + "'")
            }
        }
        return found
    }
    var DOMParser = function DOMParser(schema, rules) {
        var this$1 = this;
        this.schema = schema;
        this.rules = rules;
        this.tags = [];
        this.styles = [];
        rules.forEach(function(rule) {
            if (rule.tag) {
                this$1.tags.push(rule)
            } else if (rule.style) {
                this$1.styles.push(rule)
            }
        })
    };
    DOMParser.prototype.parse = function parse(dom, options) {
        if (options === void 0)
            options = {};
        var context = new ParseContext(this,options,false);
        context.addAll(dom, null, options.from, options.to);
        return context.finish()
    }
    ;
    DOMParser.prototype.parseSlice = function parseSlice(dom, options) {
        if (options === void 0)
            options = {};
        var context = new ParseContext(this,options,true);
        context.addAll(dom, null, options.from, options.to);
        return Slice.maxOpen(context.finish())
    }
    ;
    DOMParser.prototype.matchTag = function matchTag(dom, context) {
        for (var i = 0; i < this.tags.length; i++) {
            var rule = this.tags[i];
            if (matches(dom, rule.tag) && (rule.namespace === undefined || dom.namespaceURI == rule.namespace) && (!rule.context || context.matchesContext(rule.context))) {
                if (rule.getAttrs) {
                    var result = rule.getAttrs(dom);
                    if (result === false) {
                        continue
                    }
                    rule.attrs = result
                }
                return rule
            }
        }
    }
    ;
    DOMParser.prototype.matchStyle = function matchStyle(prop, value, context) {
        for (var i = 0; i < this.styles.length; i++) {
            var rule = this.styles[i];
            if (rule.style.indexOf(prop) != 0 || rule.context && !context.matchesContext(rule.context) || rule.style.length > prop.length && (rule.style.charCodeAt(prop.length) != 61 || rule.style.slice(prop.length + 1) != value)) {
                continue
            }
            if (rule.getAttrs) {
                var result = rule.getAttrs(value);
                if (result === false) {
                    continue
                }
                rule.attrs = result
            }
            return rule
        }
    }
    ;
    DOMParser.schemaRules = function schemaRules(schema) {
        var result = [];
        function insert(rule) {
            var priority = rule.priority == null ? 50 : rule.priority
                , i = 0;
            for (; i < result.length; i++) {
                var next = result[i]
                    , nextPriority = next.priority == null ? 50 : next.priority;
                if (nextPriority < priority) {
                    break
                }
            }
            result.splice(i, 0, rule)
        }
        var loop = function(name) {
            var rules = schema.marks[name].spec.parseDOM;
            if (rules) {
                rules.forEach(function(rule) {
                    insert(rule = copy(rule));
                    rule.mark = name
                })
            }
        };
        for (var name in schema.marks)
            loop(name);
        var loop$1 = function(name) {
            var rules$1 = schema.nodes[name$1].spec.parseDOM;
            if (rules$1) {
                rules$1.forEach(function(rule) {
                    insert(rule = copy(rule));
                    rule.node = name$1
                })
            }
        };
        for (var name$1 in schema.nodes)
            loop$1();
        return result
    }
    ;
    DOMParser.fromSchema = function fromSchema(schema) {
        return schema.cached.domParser || (schema.cached.domParser = new DOMParser(schema,DOMParser.schemaRules(schema)))
    }
    ;
    var blockTags = {
        address: true,
        article: true,
        aside: true,
        blockquote: true,
        canvas: true,
        dd: true,
        div: true,
        dl: true,
        fieldset: true,
        figcaption: true,
        figure: true,
        footer: true,
        form: true,
        h1: true,
        h2: true,
        h3: true,
        h4: true,
        h5: true,
        h6: true,
        header: true,
        hgroup: true,
        hr: true,
        li: true,
        noscript: true,
        ol: true,
        output: true,
        p: true,
        pre: true,
        section: true,
        table: true,
        tfoot: true,
        ul: true
    };
    var ignoreTags = {
        head: true,
        noscript: true,
        object: true,
        script: true,
        style: true,
        title: true
    };
    var listTags = {
        ol: true,
        ul: true
    };
    var OPT_PRESERVE_WS = 1
        , OPT_PRESERVE_WS_FULL = 2
        , OPT_OPEN_LEFT = 4;
    function wsOptionsFor(preserveWhitespace) {
        return (preserveWhitespace ? OPT_PRESERVE_WS : 0) | (preserveWhitespace === "full" ? OPT_PRESERVE_WS_FULL : 0)
    }
    var NodeContext = function NodeContext(type, attrs, marks, pendingMarks, solid, match, options) {
        this.type = type;
        this.attrs = attrs;
        this.solid = solid;
        this.match = match || (options & OPT_OPEN_LEFT ? null : type.contentMatch);
        this.options = options;
        this.content = [];
        this.marks = marks;
        this.activeMarks = Mark.none;
        this.pendingMarks = pendingMarks
    };
    NodeContext.prototype.findWrapping = function findWrapping(node) {
        if (!this.match) {
            if (!this.type) {
                return []
            }
            var fill = this.type.contentMatch.fillBefore(Fragment.from(node));
            if (fill) {
                this.match = this.type.contentMatch.matchFragment(fill)
            } else {
                var start = this.type.contentMatch, wrap;
                if (wrap = start.findWrapping(node.type)) {
                    this.match = start;
                    return wrap
                } else {
                    return null
                }
            }
        }
        return this.match.findWrapping(node.type)
    }
    ;
    NodeContext.prototype.finish = function finish(openEnd) {
        if (!(this.options & OPT_PRESERVE_WS)) {
            var last = this.content[this.content.length - 1], m;
            if (last && last.isText && (m = /[ \t\r\n\u000c]+$/.exec(last.text))) {
                if (last.text.length == m[0].length) {
                    this.content.pop()
                } else {
                    this.content[this.content.length - 1] = last.withText(last.text.slice(0, last.text.length - m[0].length))
                }
            }
        }
        var content = Fragment.from(this.content);
        if (!openEnd && this.match) {
            content = content.append(this.match.fillBefore(Fragment.empty, true))
        }
        return this.type ? this.type.create(this.attrs, content, this.marks) : content
    }
    ;
    NodeContext.prototype.applyPending = function applyPending(nextType) {
        for (var i = 0, pending = this.pendingMarks; i < pending.length; i++) {
            var mark = pending[i];
            if ((this.type ? this.type.allowsMarkType(mark.type) : markMayApply(mark.type, nextType)) && !mark.isInSet(this.activeMarks)) {
                this.activeMarks = mark.addToSet(this.activeMarks);
                this.pendingMarks = mark.removeFromSet(this.pendingMarks)
            }
        }
    }
    ;
    var ParseContext = function ParseContext(parser, options, open) {
        this.parser = parser;
        this.options = options;
        this.isOpen = open;
        var topNode = options.topNode, topContext;
        var topOptions = wsOptionsFor(options.preserveWhitespace) | (open ? OPT_OPEN_LEFT : 0);
        if (topNode) {
            topContext = new NodeContext(topNode.type,topNode.attrs,Mark.none,Mark.none,true,options.topMatch || topNode.type.contentMatch,topOptions)
        } else if (open) {
            topContext = new NodeContext(null,null,Mark.none,Mark.none,true,null,topOptions)
        } else {
            topContext = new NodeContext(parser.schema.topNodeType,null,Mark.none,Mark.none,true,null,topOptions)
        }
        this.nodes = [topContext];
        this.open = 0;
        this.find = options.findPositions;
        this.needsBlock = false
    };
    var prototypeAccessors$6 = {
        top: {
            configurable: true
        },
        currentPos: {
            configurable: true
        }
    };
    prototypeAccessors$6.top.get = function() {
        return this.nodes[this.open]
    }
    ;
    ParseContext.prototype.addDOM = function addDOM(dom) {
        if (dom.nodeType == 3) {
            this.addTextNode(dom)
        } else if (dom.nodeType == 1) {
            var style = dom.getAttribute("style");
            var marks = style ? this.readStyles(parseStyles(style)) : null
                , top = this.top;
            if (marks != null) {
                for (var i = 0; i < marks.length; i++) {
                    this.addPendingMark(marks[i])
                }
            }
            this.addElement(dom);
            if (marks != null) {
                for (var i$1 = 0; i$1 < marks.length; i$1++) {
                    this.removePendingMark(marks[i$1], top)
                }
            }
        }
    }
    ;
    ParseContext.prototype.addTextNode = function addTextNode(dom) {
        var value = dom.nodeValue;
        var top = this.top;
        if ((top.type ? top.type.inlineContent : top.content.length && top.content[0].isInline) || /[^ \t\r\n\u000c]/.test(value)) {
            if (!(top.options & OPT_PRESERVE_WS)) {
                value = value.replace(/[ \t\r\n\u000c]+/g, " ");
                if (/^[ \t\r\n\u000c]/.test(value) && this.open == this.nodes.length - 1) {
                    var nodeBefore = top.content[top.content.length - 1];
                    var domNodeBefore = dom.previousSibling;
                    if (!nodeBefore || domNodeBefore && domNodeBefore.nodeName == "BR" || nodeBefore.isText && /[ \t\r\n\u000c]$/.test(nodeBefore.text)) {
                        value = value.slice(1)
                    }
                }
            } else if (!(top.options & OPT_PRESERVE_WS_FULL)) {
                value = value.replace(/\r?\n|\r/g, " ")
            }
            if (value) {
                this.insertNode(this.parser.schema.text(value))
            }
            this.findInText(dom)
        } else {
            this.findInside(dom)
        }
    }
    ;
    ParseContext.prototype.addElement = function addElement(dom) {
        var name = dom.nodeName.toLowerCase();
        if (listTags.hasOwnProperty(name)) {
            normalizeList(dom)
        }
        var rule = this.options.ruleFromNode && this.options.ruleFromNode(dom) || this.parser.matchTag(dom, this);
        if (rule ? rule.ignore : ignoreTags.hasOwnProperty(name)) {
            this.findInside(dom)
        } else if (!rule || rule.skip) {
            if (rule && rule.skip.nodeType) {
                dom = rule.skip
            }
            var sync, top = this.top, oldNeedsBlock = this.needsBlock;
            if (blockTags.hasOwnProperty(name)) {
                sync = true;
                if (!top.type) {
                    this.needsBlock = true
                }
            } else if (!dom.firstChild) {
                this.leafFallback(dom);
                return
            }
            this.addAll(dom);
            if (sync) {
                this.sync(top)
            }
            this.needsBlock = oldNeedsBlock
        } else {
            this.addElementByRule(dom, rule)
        }
    }
    ;
    ParseContext.prototype.leafFallback = function leafFallback(dom) {
        if (dom.nodeName == "BR" && this.top.type && this.top.type.inlineContent) {
            this.addTextNode(dom.ownerDocument.createTextNode("\n"))
        }
    }
    ;
    ParseContext.prototype.readStyles = function readStyles(styles) {
        var marks = Mark.none;
        for (var i = 0; i < styles.length; i += 2) {
            var rule = this.parser.matchStyle(styles[i], styles[i + 1], this);
            if (!rule) {
                continue
            }
            if (rule.ignore) {
                return null
            }
            marks = this.parser.schema.marks[rule.mark].create(rule.attrs).addToSet(marks)
        }
        return marks
    }
    ;
    ParseContext.prototype.addElementByRule = function addElementByRule(dom, rule) {
        var this$1 = this;
        var sync, nodeType, markType, mark;
        if (rule.node) {
            nodeType = this.parser.schema.nodes[rule.node];
            if (!nodeType.isLeaf) {
                sync = this.enter(nodeType, rule.attrs, rule.preserveWhitespace)
            } else if (!this.insertNode(nodeType.create(rule.attrs))) {
                this.leafFallback(dom)
            }
        } else {
            markType = this.parser.schema.marks[rule.mark];
            mark = markType.create(rule.attrs);
            this.addPendingMark(mark)
        }
        var startIn = this.top;
        if (nodeType && nodeType.isLeaf) {
            this.findInside(dom)
        } else if (rule.getContent) {
            this.findInside(dom);
            rule.getContent(dom, this.parser.schema).forEach(function(node) {
                return this$1.insertNode(node)
            })
        } else {
            var contentDOM = rule.contentElement;
            if (typeof contentDOM == "string") {
                contentDOM = dom.querySelector(contentDOM)
            } else if (typeof contentDOM == "function") {
                contentDOM = contentDOM(dom)
            }
            if (!contentDOM) {
                contentDOM = dom
            }
            this.findAround(dom, contentDOM, true);
            this.addAll(contentDOM, sync)
        }
        if (sync) {
            this.sync(startIn);
            this.open--
        }
        if (mark) {
            this.removePendingMark(mark, startIn)
        }
    }
    ;
    ParseContext.prototype.addAll = function addAll(parent, sync, startIndex, endIndex) {
        var index = startIndex || 0;
        for (var dom = startIndex ? parent.childNodes[startIndex] : parent.firstChild, end = endIndex == null ? null : parent.childNodes[endIndex]; dom != end; dom = dom.nextSibling,
            ++index) {
            this.findAtPoint(parent, index);
            this.addDOM(dom);
            if (sync && blockTags.hasOwnProperty(dom.nodeName.toLowerCase())) {
                this.sync(sync)
            }
        }
        this.findAtPoint(parent, index)
    }
    ;
    ParseContext.prototype.findPlace = function findPlace(node) {
        var route, sync;
        for (var depth = this.open; depth >= 0; depth--) {
            var cx = this.nodes[depth];
            var found = cx.findWrapping(node);
            if (found && (!route || route.length > found.length)) {
                route = found;
                sync = cx;
                if (!found.length) {
                    break
                }
            }
            if (cx.solid) {
                break
            }
        }
        if (!route) {
            return false
        }
        this.sync(sync);
        for (var i = 0; i < route.length; i++) {
            this.enterInner(route[i], null, false)
        }
        return true
    }
    ;
    ParseContext.prototype.insertNode = function insertNode(node) {
        if (node.isInline && this.needsBlock && !this.top.type) {
            var block = this.textblockFromContext();
            if (block) {
                this.enterInner(block)
            }
        }
        if (this.findPlace(node)) {
            this.closeExtra();
            var top = this.top;
            top.applyPending(node.type);
            if (top.match) {
                top.match = top.match.matchType(node.type)
            }
            var marks = top.activeMarks;
            for (var i = 0; i < node.marks.length; i++) {
                if (!top.type || top.type.allowsMarkType(node.marks[i].type)) {
                    marks = node.marks[i].addToSet(marks)
                }
            }
            top.content.push(node.mark(marks));
            return true
        }
        return false
    }
    ;
    ParseContext.prototype.enter = function enter(type, attrs, preserveWS) {
        var ok = this.findPlace(type.create(attrs));
        if (ok) {
            this.enterInner(type, attrs, true, preserveWS)
        }
        return ok
    }
    ;
    ParseContext.prototype.enterInner = function enterInner(type, attrs, solid, preserveWS) {
        this.closeExtra();
        var top = this.top;
        top.applyPending(type);
        top.match = top.match && top.match.matchType(type, attrs);
        var options = preserveWS == null ? top.options & ~OPT_OPEN_LEFT : wsOptionsFor(preserveWS);
        if (top.options & OPT_OPEN_LEFT && top.content.length == 0) {
            options |= OPT_OPEN_LEFT
        }
        this.nodes.push(new NodeContext(type,attrs,top.activeMarks,top.pendingMarks,solid,null,options));
        this.open++
    }
    ;
    ParseContext.prototype.closeExtra = function closeExtra(openEnd) {
        var i = this.nodes.length - 1;
        if (i > this.open) {
            for (; i > this.open; i--) {
                this.nodes[i - 1].content.push(this.nodes[i].finish(openEnd))
            }
            this.nodes.length = this.open + 1
        }
    }
    ;
    ParseContext.prototype.finish = function finish() {
        this.open = 0;
        this.closeExtra(this.isOpen);
        return this.nodes[0].finish(this.isOpen || this.options.topOpen)
    }
    ;
    ParseContext.prototype.sync = function sync(to) {
        for (var i = this.open; i >= 0; i--) {
            if (this.nodes[i] == to) {
                this.open = i;
                return
            }
        }
    }
    ;
    prototypeAccessors$6.currentPos.get = function() {
        this.closeExtra();
        var pos = 0;
        for (var i = this.open; i >= 0; i--) {
            var content = this.nodes[i].content;
            for (var j = content.length - 1; j >= 0; j--) {
                pos += content[j].nodeSize
            }
            if (i) {
                pos++
            }
        }
        return pos
    }
    ;
    ParseContext.prototype.findAtPoint = function findAtPoint(parent, offset) {
        if (this.find) {
            for (var i = 0; i < this.find.length; i++) {
                if (this.find[i].node == parent && this.find[i].offset == offset) {
                    this.find[i].pos = this.currentPos
                }
            }
        }
    }
    ;
    ParseContext.prototype.findInside = function findInside(parent) {
        if (this.find) {
            for (var i = 0; i < this.find.length; i++) {
                if (this.find[i].pos == null && parent.nodeType == 1 && parent.contains(this.find[i].node)) {
                    this.find[i].pos = this.currentPos
                }
            }
        }
    }
    ;
    ParseContext.prototype.findAround = function findAround(parent, content, before) {
        if (parent != content && this.find) {
            for (var i = 0; i < this.find.length; i++) {
                if (this.find[i].pos == null && parent.nodeType == 1 && parent.contains(this.find[i].node)) {
                    var pos = content.compareDocumentPosition(this.find[i].node);
                    if (pos & (before ? 2 : 4)) {
                        this.find[i].pos = this.currentPos
                    }
                }
            }
        }
    }
    ;
    ParseContext.prototype.findInText = function findInText(textNode) {
        if (this.find) {
            for (var i = 0; i < this.find.length; i++) {
                if (this.find[i].node == textNode) {
                    this.find[i].pos = this.currentPos - (textNode.nodeValue.length - this.find[i].offset)
                }
            }
        }
    }
    ;
    ParseContext.prototype.matchesContext = function matchesContext(context) {
        var this$1 = this;
        if (context.indexOf("|") > -1) {
            return context.split(/\s*\|\s*/).some(this.matchesContext, this)
        }
        var parts = context.split("/");
        var option = this.options.context;
        var useRoot = !this.isOpen && (!option || option.parent.type == this.nodes[0].type);
        var minDepth = -(option ? option.depth + 1 : 0) + (useRoot ? 0 : 1);
        var match = function(i, depth) {
            for (; i >= 0; i--) {
                var part = parts[i];
                if (part == "") {
                    if (i == parts.length - 1 || i == 0) {
                        continue
                    }
                    for (; depth >= minDepth; depth--) {
                        if (match(i - 1, depth)) {
                            return true
                        }
                    }
                    return false
                } else {
                    var next = depth > 0 || depth == 0 && useRoot ? this$1.nodes[depth].type : option && depth >= minDepth ? option.node(depth - minDepth).type : null;
                    if (!next || next.name != part && next.groups.indexOf(part) == -1) {
                        return false
                    }
                    depth--
                }
            }
            return true
        };
        return match(parts.length - 1, this.open)
    }
    ;
    ParseContext.prototype.textblockFromContext = function textblockFromContext() {
        var $context = this.options.context;
        if ($context) {
            for (var d = $context.depth; d >= 0; d--) {
                var deflt = $context.node(d).contentMatchAt($context.indexAfter(d)).defaultType;
                if (deflt && deflt.isTextblock && deflt.defaultAttrs) {
                    return deflt
                }
            }
        }
        for (var name in this.parser.schema.nodes) {
            var type = this.parser.schema.nodes[name];
            if (type.isTextblock && type.defaultAttrs) {
                return type
            }
        }
    }
    ;
    ParseContext.prototype.addPendingMark = function addPendingMark(mark) {
        this.top.pendingMarks = mark.addToSet(this.top.pendingMarks)
    }
    ;
    ParseContext.prototype.removePendingMark = function removePendingMark(mark, upto) {
        for (var depth = this.open; depth >= 0; depth--) {
            var level = this.nodes[depth];
            var found = level.pendingMarks.lastIndexOf(mark);
            if (found > -1) {
                level.pendingMarks = mark.removeFromSet(level.pendingMarks)
            } else {
                level.activeMarks = mark.removeFromSet(level.activeMarks)
            }
            if (level == upto) {
                break
            }
        }
    }
    ;
    Object.defineProperties(ParseContext.prototype, prototypeAccessors$6);
    function normalizeList(dom) {
        for (var child = dom.firstChild, prevItem = null; child; child = child.nextSibling) {
            var name = child.nodeType == 1 ? child.nodeName.toLowerCase() : null;
            if (name && listTags.hasOwnProperty(name) && prevItem) {
                prevItem.appendChild(child);
                child = prevItem
            } else if (name == "li") {
                prevItem = child
            } else if (name) {
                prevItem = null
            }
        }
    }
    function matches(dom, selector) {
        return (dom.matches || dom.msMatchesSelector || dom.webkitMatchesSelector || dom.mozMatchesSelector).call(dom, selector)
    }
    function parseStyles(style) {
        var re = /\s*([\w-]+)\s*:\s*([^;]+)/g, m, result = [];
        while (m = re.exec(style)) {
            result.push(m[1], m[2].trim())
        }
        return result
    }
    function copy(obj) {
        var copy = {};
        for (var prop in obj) {
            copy[prop] = obj[prop]
        }
        return copy
    }
    function markMayApply(markType, nodeType) {
        var nodes = nodeType.schema.nodes;
        var loop = function(name) {
            var parent = nodes[name];
            if (!parent.allowsMarkType(markType)) {
                return
            }
            var seen = []
                , scan = function(match) {
                seen.push(match);
                for (var i = 0; i < match.edgeCount; i++) {
                    var ref = match.edge(i);
                    var type = ref.type;
                    var next = ref.next;
                    if (type == nodeType) {
                        return true
                    }
                    if (seen.indexOf(next) < 0 && scan(next)) {
                        return true
                    }
                }
            };
            if (scan(parent.contentMatch)) {
                return {
                    v: true
                }
            }
        };
        for (var name in nodes) {
            var returned = loop(name);
            if (returned)
                return returned.v
        }
    }
    var DOMSerializer = function DOMSerializer(nodes, marks) {
        this.nodes = nodes || {};
        this.marks = marks || {}
    };
    DOMSerializer.prototype.serializeFragment = function serializeFragment(fragment, options, target) {
        var this$1 = this;
        if (options === void 0)
            options = {};
        if (!target) {
            target = doc(options).createDocumentFragment()
        }
        var top = target
            , active = null;
        fragment.forEach(function(node) {
            if (active || node.marks.length) {
                if (!active) {
                    active = []
                }
                var keep = 0
                    , rendered = 0;
                while (keep < active.length && rendered < node.marks.length) {
                    var next = node.marks[rendered];
                    if (!this$1.marks[next.type.name]) {
                        rendered++;
                        continue
                    }
                    if (!next.eq(active[keep]) || next.type.spec.spanning === false) {
                        break
                    }
                    keep += 2;
                    rendered++
                }
                while (keep < active.length) {
                    top = active.pop();
                    active.pop()
                }
                while (rendered < node.marks.length) {
                    var add = node.marks[rendered++];
                    var markDOM = this$1.serializeMark(add, node.isInline, options);
                    if (markDOM) {
                        active.push(add, top);
                        top.appendChild(markDOM.dom);
                        top = markDOM.contentDOM || markDOM.dom
                    }
                }
            }
            top.appendChild(this$1.serializeNode(node, options))
        });
        return target
    }
    ;
    DOMSerializer.prototype.serializeNode = function serializeNode(node, options) {
        if (options === void 0)
            options = {};
        var ref = DOMSerializer.renderSpec(doc(options), this.nodes[node.type.name](node));
        var dom = ref.dom;
        var contentDOM = ref.contentDOM;
        if (contentDOM) {
            if (node.isLeaf) {
                throw new RangeError("Content hole not allowed in a leaf node spec")
            }
            if (options.onContent) {
                options.onContent(node, contentDOM, options)
            } else {
                this.serializeFragment(node.content, options, contentDOM)
            }
        }
        return dom
    }
    ;
    DOMSerializer.prototype.serializeNodeAndMarks = function serializeNodeAndMarks(node, options) {
        if (options === void 0)
            options = {};
        var dom = this.serializeNode(node, options);
        for (var i = node.marks.length - 1; i >= 0; i--) {
            var wrap = this.serializeMark(node.marks[i], node.isInline, options);
            if (wrap) {
                (wrap.contentDOM || wrap.dom).appendChild(dom);
                dom = wrap.dom
            }
        }
        return dom
    }
    ;
    DOMSerializer.prototype.serializeMark = function serializeMark(mark, inline, options) {
        if (options === void 0)
            options = {};
        var toDOM = this.marks[mark.type.name];
        return toDOM && DOMSerializer.renderSpec(doc(options), toDOM(mark, inline))
    }
    ;
    DOMSerializer.renderSpec = function renderSpec(doc, structure, xmlNS) {
        if (xmlNS === void 0)
            xmlNS = null;
        if (typeof structure == "string") {
            return {
                dom: doc.createTextNode(structure)
            }
        }
        if (structure.nodeType != null) {
            return {
                dom: structure
            }
        }
        var tagName = structure[0]
            , space = tagName.indexOf(" ");
        if (space > 0) {
            xmlNS = tagName.slice(0, space);
            tagName = tagName.slice(space + 1)
        }
        var contentDOM = null
            , dom = xmlNS ? doc.createElementNS(xmlNS, tagName) : doc.createElement(tagName);
        var attrs = structure[1]
            , start = 1;
        if (attrs && typeof attrs == "object" && attrs.nodeType == null && !Array.isArray(attrs)) {
            start = 2;
            for (var name in attrs) {
                if (attrs[name] != null) {
                    var space$1 = name.indexOf(" ");
                    if (space$1 > 0) {
                        dom.setAttributeNS(name.slice(0, space$1), name.slice(space$1 + 1), attrs[name])
                    } else {
                        dom.setAttribute(name, attrs[name])
                    }
                }
            }
        }
        for (var i = start; i < structure.length; i++) {
            var child = structure[i];
            if (child === 0) {
                if (i < structure.length - 1 || i > start) {
                    throw new RangeError("Content hole must be the only child of its parent node")
                }
                return {
                    dom: dom,
                    contentDOM: dom
                }
            } else {
                var ref = DOMSerializer.renderSpec(doc, child, xmlNS);
                var inner = ref.dom;
                var innerContent = ref.contentDOM;
                dom.appendChild(inner);
                if (innerContent) {
                    if (contentDOM) {
                        throw new RangeError("Multiple content holes")
                    }
                    contentDOM = innerContent
                }
            }
        }
        return {
            dom: dom,
            contentDOM: contentDOM
        }
    }
    ;
    DOMSerializer.fromSchema = function fromSchema(schema) {
        return schema.cached.domSerializer || (schema.cached.domSerializer = new DOMSerializer(this.nodesFromSchema(schema),this.marksFromSchema(schema)))
    }
    ;
    DOMSerializer.nodesFromSchema = function nodesFromSchema(schema) {
        var result = gatherToDOM(schema.nodes);
        if (!result.text) {
            result.text = function(node) {
                return node.text
            }
        }
        return result
    }
    ;
    DOMSerializer.marksFromSchema = function marksFromSchema(schema) {
        return gatherToDOM(schema.marks)
    }
    ;
    function gatherToDOM(obj) {
        var result = {};
        for (var name in obj) {
            var toDOM = obj[name].spec.toDOM;
            if (toDOM) {
                result[name] = toDOM
            }
        }
        return result
    }
    function doc(options) {
        return options.document || window.document
    }
    exports.ContentMatch = ContentMatch;
    exports.DOMParser = DOMParser;
    exports.DOMSerializer = DOMSerializer;
    exports.Fragment = Fragment;
    exports.Mark = Mark;
    exports.MarkType = MarkType;
    exports.Node = Node;
    exports.NodeRange = NodeRange;
    exports.NodeType = NodeType;
    exports.ReplaceError = ReplaceError;
    exports.ResolvedPos = ResolvedPos;
    exports.Schema = Schema;
    exports.Slice = Slice
});
define("prosemirror-model", ["prosemirror-model/index"], function(main) {
    return main
});
define("prosemirror-transform/index", ["require", "exports", "module", "prosemirror-model"], function(require, exports, module) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var prosemirrorModel = require("prosemirror-model");
    var lower16 = 65535;
    var factor16 = Math.pow(2, 16);
    function makeRecover(index, offset) {
        return index + offset * factor16
    }
    function recoverIndex(value) {
        return value & lower16
    }
    function recoverOffset(value) {
        return (value - (value & lower16)) / factor16
    }
    var MapResult = function MapResult(pos, deleted, recover) {
        if (deleted === void 0)
            deleted = false;
        if (recover === void 0)
            recover = null;
        this.pos = pos;
        this.deleted = deleted;
        this.recover = recover
    };
    var StepMap = function StepMap(ranges, inverted) {
        if (inverted === void 0)
            inverted = false;
        this.ranges = ranges;
        this.inverted = inverted
    };
    StepMap.prototype.recover = function recover(value) {
        var diff = 0
            , index = recoverIndex(value);
        if (!this.inverted) {
            for (var i = 0; i < index; i++) {
                diff += this.ranges[i * 3 + 2] - this.ranges[i * 3 + 1]
            }
        }
        return this.ranges[index * 3] + diff + recoverOffset(value)
    }
    ;
    StepMap.prototype.mapResult = function mapResult(pos, assoc) {
        if (assoc === void 0)
            assoc = 1;
        return this._map(pos, assoc, false)
    }
    ;
    StepMap.prototype.map = function map(pos, assoc) {
        if (assoc === void 0)
            assoc = 1;
        return this._map(pos, assoc, true)
    }
    ;
    StepMap.prototype._map = function _map(pos, assoc, simple) {
        var diff = 0
            , oldIndex = this.inverted ? 2 : 1
            , newIndex = this.inverted ? 1 : 2;
        for (var i = 0; i < this.ranges.length; i += 3) {
            var start = this.ranges[i] - (this.inverted ? diff : 0);
            if (start > pos) {
                break
            }
            var oldSize = this.ranges[i + oldIndex]
                , newSize = this.ranges[i + newIndex]
                , end = start + oldSize;
            if (pos <= end) {
                var side = !oldSize ? assoc : pos == start ? -1 : pos == end ? 1 : assoc;
                var result = start + diff + (side < 0 ? 0 : newSize);
                if (simple) {
                    return result
                }
                var recover = makeRecover(i / 3, pos - start);
                return new MapResult(result,assoc < 0 ? pos != start : pos != end,recover)
            }
            diff += newSize - oldSize
        }
        return simple ? pos + diff : new MapResult(pos + diff)
    }
    ;
    StepMap.prototype.touches = function touches(pos, recover) {
        var diff = 0
            , index = recoverIndex(recover);
        var oldIndex = this.inverted ? 2 : 1
            , newIndex = this.inverted ? 1 : 2;
        for (var i = 0; i < this.ranges.length; i += 3) {
            var start = this.ranges[i] - (this.inverted ? diff : 0);
            if (start > pos) {
                break
            }
            var oldSize = this.ranges[i + oldIndex]
                , end = start + oldSize;
            if (pos <= end && i == index * 3) {
                return true
            }
            diff += this.ranges[i + newIndex] - oldSize
        }
        return false
    }
    ;
    StepMap.prototype.forEach = function forEach(f) {
        var oldIndex = this.inverted ? 2 : 1
            , newIndex = this.inverted ? 1 : 2;
        for (var i = 0, diff = 0; i < this.ranges.length; i += 3) {
            var start = this.ranges[i]
                , oldStart = start - (this.inverted ? diff : 0)
                , newStart = start + (this.inverted ? 0 : diff);
            var oldSize = this.ranges[i + oldIndex]
                , newSize = this.ranges[i + newIndex];
            f(oldStart, oldStart + oldSize, newStart, newStart + newSize);
            diff += newSize - oldSize
        }
    }
    ;
    StepMap.prototype.invert = function invert() {
        return new StepMap(this.ranges,!this.inverted)
    }
    ;
    StepMap.prototype.toString = function toString() {
        return (this.inverted ? "-" : "") + JSON.stringify(this.ranges)
    }
    ;
    StepMap.offset = function offset(n) {
        return n == 0 ? StepMap.empty : new StepMap(n < 0 ? [0, -n, 0] : [0, 0, n])
    }
    ;
    StepMap.empty = new StepMap([]);
    var Mapping = function Mapping(maps, mirror, from, to) {
        this.maps = maps || [];
        this.from = from || 0;
        this.to = to == null ? this.maps.length : to;
        this.mirror = mirror
    };
    Mapping.prototype.slice = function slice(from, to) {
        if (from === void 0)
            from = 0;
        if (to === void 0)
            to = this.maps.length;
        return new Mapping(this.maps,this.mirror,from,to)
    }
    ;
    Mapping.prototype.copy = function copy() {
        return new Mapping(this.maps.slice(),this.mirror && this.mirror.slice(),this.from,this.to)
    }
    ;
    Mapping.prototype.appendMap = function appendMap(map, mirrors) {
        this.to = this.maps.push(map);
        if (mirrors != null) {
            this.setMirror(this.maps.length - 1, mirrors)
        }
    }
    ;
    Mapping.prototype.appendMapping = function appendMapping(mapping) {
        for (var i = 0, startSize = this.maps.length; i < mapping.maps.length; i++) {
            var mirr = mapping.getMirror(i);
            this.appendMap(mapping.maps[i], mirr != null && mirr < i ? startSize + mirr : null)
        }
    }
    ;
    Mapping.prototype.getMirror = function getMirror(n) {
        if (this.mirror) {
            for (var i = 0; i < this.mirror.length; i++) {
                if (this.mirror[i] == n) {
                    return this.mirror[i + (i % 2 ? -1 : 1)]
                }
            }
        }
    }
    ;
    Mapping.prototype.setMirror = function setMirror(n, m) {
        if (!this.mirror) {
            this.mirror = []
        }
        this.mirror.push(n, m)
    }
    ;
    Mapping.prototype.appendMappingInverted = function appendMappingInverted(mapping) {
        for (var i = mapping.maps.length - 1, totalSize = this.maps.length + mapping.maps.length; i >= 0; i--) {
            var mirr = mapping.getMirror(i);
            this.appendMap(mapping.maps[i].invert(), mirr != null && mirr > i ? totalSize - mirr - 1 : null)
        }
    }
    ;
    Mapping.prototype.invert = function invert() {
        var inverse = new Mapping;
        inverse.appendMappingInverted(this);
        return inverse
    }
    ;
    Mapping.prototype.map = function map(pos, assoc) {
        if (assoc === void 0)
            assoc = 1;
        if (this.mirror) {
            return this._map(pos, assoc, true)
        }
        for (var i = this.from; i < this.to; i++) {
            pos = this.maps[i].map(pos, assoc)
        }
        return pos
    }
    ;
    Mapping.prototype.mapResult = function mapResult(pos, assoc) {
        if (assoc === void 0)
            assoc = 1;
        return this._map(pos, assoc, false)
    }
    ;
    Mapping.prototype._map = function _map(pos, assoc, simple) {
        var deleted = false
            , recoverables = null;
        for (var i = this.from; i < this.to; i++) {
            var map = this.maps[i]
                , rec = recoverables && recoverables[i];
            if (rec != null && map.touches(pos, rec)) {
                pos = map.recover(rec);
                continue
            }
            var result = map.mapResult(pos, assoc);
            if (result.recover != null) {
                var corr = this.getMirror(i);
                if (corr != null && corr > i && corr < this.to) {
                    if (result.deleted) {
                        i = corr;
                        pos = this.maps[corr].recover(result.recover);
                        continue
                    } else {
                        (recoverables || (recoverables = Object.create(null)))[corr] = result.recover
                    }
                }
            }
            if (result.deleted) {
                deleted = true
            }
            pos = result.pos
        }
        return simple ? pos : new MapResult(pos,deleted)
    }
    ;
    function TransformError(message) {
        var err = Error.call(this, message);
        err.__proto__ = TransformError.prototype;
        return err
    }
    TransformError.prototype = Object.create(Error.prototype);
    TransformError.prototype.constructor = TransformError;
    TransformError.prototype.name = "TransformError";
    var Transform = function Transform(doc) {
        this.doc = doc;
        this.steps = [];
        this.docs = [];
        this.mapping = new Mapping
    };
    var prototypeAccessors = {
        before: {
            configurable: true
        },
        docChanged: {
            configurable: true
        }
    };
    prototypeAccessors.before.get = function() {
        return this.docs.length ? this.docs[0] : this.doc
    }
    ;
    Transform.prototype.step = function step(object) {
        var result = this.maybeStep(object);
        if (result.failed) {
            throw new TransformError(result.failed)
        }
        return this
    }
    ;
    Transform.prototype.maybeStep = function maybeStep(step) {
        var result = step.apply(this.doc);
        if (!result.failed) {
            this.addStep(step, result.doc)
        }
        return result
    }
    ;
    prototypeAccessors.docChanged.get = function() {
        return this.steps.length > 0
    }
    ;
    Transform.prototype.addStep = function addStep(step, doc) {
        this.docs.push(this.doc);
        this.steps.push(step);
        this.mapping.appendMap(step.getMap());
        this.doc = doc
    }
    ;
    Object.defineProperties(Transform.prototype, prototypeAccessors);
    function mustOverride() {
        throw new Error("Override me")
    }
    var stepsByID = Object.create(null);
    var Step = function Step() {};
    Step.prototype.apply = function apply(_doc) {
        return mustOverride()
    }
    ;
    Step.prototype.getMap = function getMap() {
        return StepMap.empty
    }
    ;
    Step.prototype.invert = function invert(_doc) {
        return mustOverride()
    }
    ;
    Step.prototype.map = function map(_mapping) {
        return mustOverride()
    }
    ;
    Step.prototype.merge = function merge(_other) {
        return null
    }
    ;
    Step.prototype.toJSON = function toJSON() {
        return mustOverride()
    }
    ;
    Step.fromJSON = function fromJSON(schema, json) {
        if (!json || !json.stepType) {
            throw new RangeError("Invalid input for Step.fromJSON")
        }
        var type = stepsByID[json.stepType];
        if (!type) {
            throw new RangeError("No step type " + json.stepType + " defined")
        }
        return type.fromJSON(schema, json)
    }
    ;
    Step.jsonID = function jsonID(id, stepClass) {
        if (id in stepsByID) {
            throw new RangeError("Duplicate use of step JSON ID " + id)
        }
        stepsByID[id] = stepClass;
        stepClass.prototype.jsonID = id;
        return stepClass
    }
    ;
    var StepResult = function StepResult(doc, failed) {
        this.doc = doc;
        this.failed = failed
    };
    StepResult.ok = function ok(doc) {
        return new StepResult(doc,null)
    }
    ;
    StepResult.fail = function fail(message) {
        return new StepResult(null,message)
    }
    ;
    StepResult.fromReplace = function fromReplace(doc, from, to, slice) {
        try {
            return StepResult.ok(doc.replace(from, to, slice))
        } catch (e) {
            if (e instanceof prosemirrorModel.ReplaceError) {
                return StepResult.fail(e.message)
            }
            throw e
        }
    }
    ;
    var ReplaceStep = function(Step) {
        function ReplaceStep(from, to, slice, structure) {
            Step.call(this);
            this.from = from;
            this.to = to;
            this.slice = slice;
            this.structure = !!structure
        }
        if (Step)
            ReplaceStep.__proto__ = Step;
        ReplaceStep.prototype = Object.create(Step && Step.prototype);
        ReplaceStep.prototype.constructor = ReplaceStep;
        ReplaceStep.prototype.apply = function apply(doc) {
            if (this.structure && contentBetween(doc, this.from, this.to)) {
                return StepResult.fail("Structure replace would overwrite content")
            }
            return StepResult.fromReplace(doc, this.from, this.to, this.slice)
        }
        ;
        ReplaceStep.prototype.getMap = function getMap() {
            return new StepMap([this.from, this.to - this.from, this.slice.size])
        }
        ;
        ReplaceStep.prototype.invert = function invert(doc) {
            return new ReplaceStep(this.from,this.from + this.slice.size,doc.slice(this.from, this.to))
        }
        ;
        ReplaceStep.prototype.map = function map(mapping) {
            var from = mapping.mapResult(this.from, 1)
                , to = mapping.mapResult(this.to, -1);
            if (from.deleted && to.deleted) {
                return null
            }
            return new ReplaceStep(from.pos,Math.max(from.pos, to.pos),this.slice)
        }
        ;
        ReplaceStep.prototype.merge = function merge(other) {
            if (!(other instanceof ReplaceStep) || other.structure != this.structure) {
                return null
            }
            if (this.from + this.slice.size == other.from && !this.slice.openEnd && !other.slice.openStart) {
                var slice = this.slice.size + other.slice.size == 0 ? prosemirrorModel.Slice.empty : new prosemirrorModel.Slice(this.slice.content.append(other.slice.content),this.slice.openStart,other.slice.openEnd);
                return new ReplaceStep(this.from,this.to + (other.to - other.from),slice,this.structure)
            } else if (other.to == this.from && !this.slice.openStart && !other.slice.openEnd) {
                var slice$1 = this.slice.size + other.slice.size == 0 ? prosemirrorModel.Slice.empty : new prosemirrorModel.Slice(other.slice.content.append(this.slice.content),other.slice.openStart,this.slice.openEnd);
                return new ReplaceStep(other.from,this.to,slice$1,this.structure)
            } else {
                return null
            }
        }
        ;
        ReplaceStep.prototype.toJSON = function toJSON() {
            var json = {
                stepType: "replace",
                from: this.from,
                to: this.to
            };
            if (this.slice.size) {
                json.slice = this.slice.toJSON()
            }
            if (this.structure) {
                json.structure = true
            }
            return json
        }
        ;
        ReplaceStep.fromJSON = function fromJSON(schema, json) {
            if (typeof json.from != "number" || typeof json.to != "number") {
                throw new RangeError("Invalid input for ReplaceStep.fromJSON")
            }
            return new ReplaceStep(json.from,json.to,prosemirrorModel.Slice.fromJSON(schema, json.slice),!!json.structure)
        }
        ;
        return ReplaceStep
    }(Step);
    Step.jsonID("replace", ReplaceStep);
    var ReplaceAroundStep = function(Step) {
        function ReplaceAroundStep(from, to, gapFrom, gapTo, slice, insert, structure) {
            Step.call(this);
            this.from = from;
            this.to = to;
            this.gapFrom = gapFrom;
            this.gapTo = gapTo;
            this.slice = slice;
            this.insert = insert;
            this.structure = !!structure
        }
        if (Step)
            ReplaceAroundStep.__proto__ = Step;
        ReplaceAroundStep.prototype = Object.create(Step && Step.prototype);
        ReplaceAroundStep.prototype.constructor = ReplaceAroundStep;
        ReplaceAroundStep.prototype.apply = function apply(doc) {
            if (this.structure && (contentBetween(doc, this.from, this.gapFrom) || contentBetween(doc, this.gapTo, this.to))) {
                return StepResult.fail("Structure gap-replace would overwrite content")
            }
            var gap = doc.slice(this.gapFrom, this.gapTo);
            if (gap.openStart || gap.openEnd) {
                return StepResult.fail("Gap is not a flat range")
            }
            var inserted = this.slice.insertAt(this.insert, gap.content);
            if (!inserted) {
                return StepResult.fail("Content does not fit in gap")
            }
            return StepResult.fromReplace(doc, this.from, this.to, inserted)
        }
        ;
        ReplaceAroundStep.prototype.getMap = function getMap() {
            return new StepMap([this.from, this.gapFrom - this.from, this.insert, this.gapTo, this.to - this.gapTo, this.slice.size - this.insert])
        }
        ;
        ReplaceAroundStep.prototype.invert = function invert(doc) {
            var gap = this.gapTo - this.gapFrom;
            return new ReplaceAroundStep(this.from,this.from + this.slice.size + gap,this.from + this.insert,this.from + this.insert + gap,doc.slice(this.from, this.to).removeBetween(this.gapFrom - this.from, this.gapTo - this.from),this.gapFrom - this.from,this.structure)
        }
        ;
        ReplaceAroundStep.prototype.map = function map(mapping) {
            var from = mapping.mapResult(this.from, 1)
                , to = mapping.mapResult(this.to, -1);
            var gapFrom = mapping.map(this.gapFrom, -1)
                , gapTo = mapping.map(this.gapTo, 1);
            if (from.deleted && to.deleted || gapFrom < from.pos || gapTo > to.pos) {
                return null
            }
            return new ReplaceAroundStep(from.pos,to.pos,gapFrom,gapTo,this.slice,this.insert,this.structure)
        }
        ;
        ReplaceAroundStep.prototype.toJSON = function toJSON() {
            var json = {
                stepType: "replaceAround",
                from: this.from,
                to: this.to,
                gapFrom: this.gapFrom,
                gapTo: this.gapTo,
                insert: this.insert
            };
            if (this.slice.size) {
                json.slice = this.slice.toJSON()
            }
            if (this.structure) {
                json.structure = true
            }
            return json
        }
        ;
        ReplaceAroundStep.fromJSON = function fromJSON(schema, json) {
            if (typeof json.from != "number" || typeof json.to != "number" || typeof json.gapFrom != "number" || typeof json.gapTo != "number" || typeof json.insert != "number") {
                throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON")
            }
            return new ReplaceAroundStep(json.from,json.to,json.gapFrom,json.gapTo,prosemirrorModel.Slice.fromJSON(schema, json.slice),json.insert,!!json.structure)
        }
        ;
        return ReplaceAroundStep
    }(Step);
    Step.jsonID("replaceAround", ReplaceAroundStep);
    function contentBetween(doc, from, to) {
        var $from = doc.resolve(from)
            , dist = to - from
            , depth = $from.depth;
        while (dist > 0 && depth > 0 && $from.indexAfter(depth) == $from.node(depth).childCount) {
            depth--;
            dist--
        }
        if (dist > 0) {
            var next = $from.node(depth).maybeChild($from.indexAfter(depth));
            while (dist > 0) {
                if (!next || next.isLeaf) {
                    return true
                }
                next = next.firstChild;
                dist--
            }
        }
        return false
    }
    function canCut(node, start, end) {
        return (start == 0 || node.canReplace(start, node.childCount)) && (end == node.childCount || node.canReplace(0, end))
    }
    function liftTarget(range) {
        var parent = range.parent;
        var content = parent.content.cutByIndex(range.startIndex, range.endIndex);
        for (var depth = range.depth; ; --depth) {
            var node = range.$from.node(depth);
            var index = range.$from.index(depth)
                , endIndex = range.$to.indexAfter(depth);
            if (depth < range.depth && node.canReplace(index, endIndex, content)) {
                return depth
            }
            if (depth == 0 || node.type.spec.isolating || !canCut(node, index, endIndex)) {
                break
            }
        }
    }
    Transform.prototype.lift = function(range, target) {
        var $from = range.$from;
        var $to = range.$to;
        var depth = range.depth;
        var gapStart = $from.before(depth + 1)
            , gapEnd = $to.after(depth + 1);
        var start = gapStart
            , end = gapEnd;
        var before = prosemirrorModel.Fragment.empty
            , openStart = 0;
        for (var d = depth, splitting = false; d > target; d--) {
            if (splitting || $from.index(d) > 0) {
                splitting = true;
                before = prosemirrorModel.Fragment.from($from.node(d).copy(before));
                openStart++
            } else {
                start--
            }
        }
        var after = prosemirrorModel.Fragment.empty
            , openEnd = 0;
        for (var d$1 = depth, splitting$1 = false; d$1 > target; d$1--) {
            if (splitting$1 || $to.after(d$1 + 1) < $to.end(d$1)) {
                splitting$1 = true;
                after = prosemirrorModel.Fragment.from($to.node(d$1).copy(after));
                openEnd++
            } else {
                end++
            }
        }
        return this.step(new ReplaceAroundStep(start,end,gapStart,gapEnd,new prosemirrorModel.Slice(before.append(after),openStart,openEnd),before.size - openStart,true))
    }
    ;
    function findWrapping(range, nodeType, attrs, innerRange) {
        if (innerRange === void 0)
            innerRange = range;
        var around = findWrappingOutside(range, nodeType);
        var inner = around && findWrappingInside(innerRange, nodeType);
        if (!inner) {
            return null
        }
        return around.map(withAttrs).concat({
            type: nodeType,
            attrs: attrs
        }).concat(inner.map(withAttrs))
    }
    function withAttrs(type) {
        return {
            type: type,
            attrs: null
        }
    }
    function findWrappingOutside(range, type) {
        var parent = range.parent;
        var startIndex = range.startIndex;
        var endIndex = range.endIndex;
        var around = parent.contentMatchAt(startIndex).findWrapping(type);
        if (!around) {
            return null
        }
        var outer = around.length ? around[0] : type;
        return parent.canReplaceWith(startIndex, endIndex, outer) ? around : null
    }
    function findWrappingInside(range, type) {
        var parent = range.parent;
        var startIndex = range.startIndex;
        var endIndex = range.endIndex;
        var inner = parent.child(startIndex);
        var inside = type.contentMatch.findWrapping(inner.type);
        if (!inside) {
            return null
        }
        var lastType = inside.length ? inside[inside.length - 1] : type;
        var innerMatch = lastType.contentMatch;
        for (var i = startIndex; innerMatch && i < endIndex; i++) {
            innerMatch = innerMatch.matchType(parent.child(i).type)
        }
        if (!innerMatch || !innerMatch.validEnd) {
            return null
        }
        return inside
    }
    Transform.prototype.wrap = function(range, wrappers) {
        var content = prosemirrorModel.Fragment.empty;
        for (var i = wrappers.length - 1; i >= 0; i--) {
            content = prosemirrorModel.Fragment.from(wrappers[i].type.create(wrappers[i].attrs, content))
        }
        var start = range.start
            , end = range.end;
        return this.step(new ReplaceAroundStep(start,end,start,end,new prosemirrorModel.Slice(content,0,0),wrappers.length,true))
    }
    ;
    Transform.prototype.setBlockType = function(from, to, type, attrs) {
        var this$1 = this;
        if (to === void 0)
            to = from;
        if (!type.isTextblock) {
            throw new RangeError("Type given to setBlockType should be a textblock")
        }
        var mapFrom = this.steps.length;
        this.doc.nodesBetween(from, to, function(node, pos) {
            if (node.isTextblock && !node.hasMarkup(type, attrs) && canChangeType(this$1.doc, this$1.mapping.slice(mapFrom).map(pos), type)) {
                this$1.clearIncompatible(this$1.mapping.slice(mapFrom).map(pos, 1), type);
                var mapping = this$1.mapping.slice(mapFrom);
                var startM = mapping.map(pos, 1)
                    , endM = mapping.map(pos + node.nodeSize, 1);
                this$1.step(new ReplaceAroundStep(startM,endM,startM + 1,endM - 1,new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(type.create(attrs, null, node.marks)),0,0),1,true));
                return false
            }
        });
        return this
    }
    ;
    function canChangeType(doc, pos, type) {
        var $pos = doc.resolve(pos)
            , index = $pos.index();
        return $pos.parent.canReplaceWith(index, index + 1, type)
    }
    Transform.prototype.setNodeMarkup = function(pos, type, attrs, marks) {
        var node = this.doc.nodeAt(pos);
        if (!node) {
            throw new RangeError("No node at given position")
        }
        if (!type) {
            type = node.type
        }
        var newNode = type.create(attrs, null, marks || node.marks);
        if (node.isLeaf) {
            return this.replaceWith(pos, pos + node.nodeSize, newNode)
        }
        if (!type.validContent(node.content)) {
            throw new RangeError("Invalid content for node type " + type.name)
        }
        return this.step(new ReplaceAroundStep(pos,pos + node.nodeSize,pos + 1,pos + node.nodeSize - 1,new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(newNode),0,0),1,true))
    }
    ;
    function canSplit(doc, pos, depth, typesAfter) {
        if (depth === void 0)
            depth = 1;
        var $pos = doc.resolve(pos)
            , base = $pos.depth - depth;
        var innerType = typesAfter && typesAfter[typesAfter.length - 1] || $pos.parent;
        if (base < 0 || $pos.parent.type.spec.isolating || !$pos.parent.canReplace($pos.index(), $pos.parent.childCount) || !innerType.type.validContent($pos.parent.content.cutByIndex($pos.index(), $pos.parent.childCount))) {
            return false
        }
        for (var d = $pos.depth - 1, i = depth - 2; d > base; d--,
            i--) {
            var node = $pos.node(d)
                , index$1 = $pos.index(d);
            if (node.type.spec.isolating) {
                return false
            }
            var rest = node.content.cutByIndex(index$1, node.childCount);
            var after = typesAfter && typesAfter[i] || node;
            if (after != node) {
                rest = rest.replaceChild(0, after.type.create(after.attrs))
            }
            if (!node.canReplace(index$1 + 1, node.childCount) || !after.type.validContent(rest)) {
                return false
            }
        }
        var index = $pos.indexAfter(base);
        var baseType = typesAfter && typesAfter[0];
        return $pos.node(base).canReplaceWith(index, index, baseType ? baseType.type : $pos.node(base + 1).type)
    }
    Transform.prototype.split = function(pos, depth, typesAfter) {
        if (depth === void 0)
            depth = 1;
        var $pos = this.doc.resolve(pos)
            , before = prosemirrorModel.Fragment.empty
            , after = prosemirrorModel.Fragment.empty;
        for (var d = $pos.depth, e = $pos.depth - depth, i = depth - 1; d > e; d--,
            i--) {
            before = prosemirrorModel.Fragment.from($pos.node(d).copy(before));
            var typeAfter = typesAfter && typesAfter[i];
            after = prosemirrorModel.Fragment.from(typeAfter ? typeAfter.type.create(typeAfter.attrs, after) : $pos.node(d).copy(after))
        }
        return this.step(new ReplaceStep(pos,pos,new prosemirrorModel.Slice(before.append(after),depth,depth),true))
    }
    ;
    function canJoin(doc, pos) {
        var $pos = doc.resolve(pos)
            , index = $pos.index();
        return joinable($pos.nodeBefore, $pos.nodeAfter) && $pos.parent.canReplace(index, index + 1)
    }
    function joinable(a, b) {
        return a && b && !a.isLeaf && a.canAppend(b)
    }
    function joinPoint(doc, pos, dir) {
        if (dir === void 0)
            dir = -1;
        var $pos = doc.resolve(pos);
        for (var d = $pos.depth; ; d--) {
            var before = void 0
                , after = void 0
                , index = $pos.index(d);
            if (d == $pos.depth) {
                before = $pos.nodeBefore;
                after = $pos.nodeAfter
            } else if (dir > 0) {
                before = $pos.node(d + 1);
                index++;
                after = $pos.node(d).maybeChild(index)
            } else {
                before = $pos.node(d).maybeChild(index - 1);
                after = $pos.node(d + 1)
            }
            if (before && !before.isTextblock && joinable(before, after) && $pos.node(d).canReplace(index, index + 1)) {
                return pos
            }
            if (d == 0) {
                break
            }
            pos = dir < 0 ? $pos.before(d) : $pos.after(d)
        }
    }
    Transform.prototype.join = function(pos, depth) {
        if (depth === void 0)
            depth = 1;
        var step = new ReplaceStep(pos - depth,pos + depth,prosemirrorModel.Slice.empty,true);
        return this.step(step)
    }
    ;
    function insertPoint(doc, pos, nodeType) {
        var $pos = doc.resolve(pos);
        if ($pos.parent.canReplaceWith($pos.index(), $pos.index(), nodeType)) {
            return pos
        }
        if ($pos.parentOffset == 0) {
            for (var d = $pos.depth - 1; d >= 0; d--) {
                var index = $pos.index(d);
                if ($pos.node(d).canReplaceWith(index, index, nodeType)) {
                    return $pos.before(d + 1)
                }
                if (index > 0) {
                    return null
                }
            }
        }
        if ($pos.parentOffset == $pos.parent.content.size) {
            for (var d$1 = $pos.depth - 1; d$1 >= 0; d$1--) {
                var index$1 = $pos.indexAfter(d$1);
                if ($pos.node(d$1).canReplaceWith(index$1, index$1, nodeType)) {
                    return $pos.after(d$1 + 1)
                }
                if (index$1 < $pos.node(d$1).childCount) {
                    return null
                }
            }
        }
    }
    function dropPoint(doc, pos, slice) {
        var $pos = doc.resolve(pos);
        if (!slice.content.size) {
            return pos
        }
        var content = slice.content;
        for (var i = 0; i < slice.openStart; i++) {
            content = content.firstChild.content
        }
        for (var pass = 1; pass <= (slice.openStart == 0 && slice.size ? 2 : 1); pass++) {
            for (var d = $pos.depth; d >= 0; d--) {
                var bias = d == $pos.depth ? 0 : $pos.pos <= ($pos.start(d + 1) + $pos.end(d + 1)) / 2 ? -1 : 1;
                var insertPos = $pos.index(d) + (bias > 0 ? 1 : 0);
                if (pass == 1 ? $pos.node(d).canReplace(insertPos, insertPos, content) : $pos.node(d).contentMatchAt(insertPos).findWrapping(content.firstChild.type)) {
                    return bias == 0 ? $pos.pos : bias < 0 ? $pos.before(d + 1) : $pos.after(d + 1)
                }
            }
        }
        return null
    }
    function mapFragment(fragment, f, parent) {
        var mapped = [];
        for (var i = 0; i < fragment.childCount; i++) {
            var child = fragment.child(i);
            if (child.content.size) {
                child = child.copy(mapFragment(child.content, f, child))
            }
            if (child.isInline) {
                child = f(child, parent, i)
            }
            mapped.push(child)
        }
        return prosemirrorModel.Fragment.fromArray(mapped)
    }
    var AddMarkStep = function(Step) {
        function AddMarkStep(from, to, mark) {
            Step.call(this);
            this.from = from;
            this.to = to;
            this.mark = mark
        }
        if (Step)
            AddMarkStep.__proto__ = Step;
        AddMarkStep.prototype = Object.create(Step && Step.prototype);
        AddMarkStep.prototype.constructor = AddMarkStep;
        AddMarkStep.prototype.apply = function apply(doc) {
            var this$1 = this;
            var oldSlice = doc.slice(this.from, this.to)
                , $from = doc.resolve(this.from);
            var parent = $from.node($from.sharedDepth(this.to));
            var slice = new prosemirrorModel.Slice(mapFragment(oldSlice.content, function(node, parent) {
                if (!parent.type.allowsMarkType(this$1.mark.type)) {
                    return node
                }
                return node.mark(this$1.mark.addToSet(node.marks))
            }, parent),oldSlice.openStart,oldSlice.openEnd);
            return StepResult.fromReplace(doc, this.from, this.to, slice)
        }
        ;
        AddMarkStep.prototype.invert = function invert() {
            return new RemoveMarkStep(this.from,this.to,this.mark)
        }
        ;
        AddMarkStep.prototype.map = function map(mapping) {
            var from = mapping.mapResult(this.from, 1)
                , to = mapping.mapResult(this.to, -1);
            if (from.deleted && to.deleted || from.pos >= to.pos) {
                return null
            }
            return new AddMarkStep(from.pos,to.pos,this.mark)
        }
        ;
        AddMarkStep.prototype.merge = function merge(other) {
            if (other instanceof AddMarkStep && other.mark.eq(this.mark) && this.from <= other.to && this.to >= other.from) {
                return new AddMarkStep(Math.min(this.from, other.from),Math.max(this.to, other.to),this.mark)
            }
        }
        ;
        AddMarkStep.prototype.toJSON = function toJSON() {
            return {
                stepType: "addMark",
                mark: this.mark.toJSON(),
                from: this.from,
                to: this.to
            }
        }
        ;
        AddMarkStep.fromJSON = function fromJSON(schema, json) {
            if (typeof json.from != "number" || typeof json.to != "number") {
                throw new RangeError("Invalid input for AddMarkStep.fromJSON")
            }
            return new AddMarkStep(json.from,json.to,schema.markFromJSON(json.mark))
        }
        ;
        return AddMarkStep
    }(Step);
    Step.jsonID("addMark", AddMarkStep);
    var RemoveMarkStep = function(Step) {
        function RemoveMarkStep(from, to, mark) {
            Step.call(this);
            this.from = from;
            this.to = to;
            this.mark = mark
        }
        if (Step)
            RemoveMarkStep.__proto__ = Step;
        RemoveMarkStep.prototype = Object.create(Step && Step.prototype);
        RemoveMarkStep.prototype.constructor = RemoveMarkStep;
        RemoveMarkStep.prototype.apply = function apply(doc) {
            var this$1 = this;
            var oldSlice = doc.slice(this.from, this.to);
            var slice = new prosemirrorModel.Slice(mapFragment(oldSlice.content, function(node) {
                return node.mark(this$1.mark.removeFromSet(node.marks))
            }),oldSlice.openStart,oldSlice.openEnd);
            return StepResult.fromReplace(doc, this.from, this.to, slice)
        }
        ;
        RemoveMarkStep.prototype.invert = function invert() {
            return new AddMarkStep(this.from,this.to,this.mark)
        }
        ;
        RemoveMarkStep.prototype.map = function map(mapping) {
            var from = mapping.mapResult(this.from, 1)
                , to = mapping.mapResult(this.to, -1);
            if (from.deleted && to.deleted || from.pos >= to.pos) {
                return null
            }
            return new RemoveMarkStep(from.pos,to.pos,this.mark)
        }
        ;
        RemoveMarkStep.prototype.merge = function merge(other) {
            if (other instanceof RemoveMarkStep && other.mark.eq(this.mark) && this.from <= other.to && this.to >= other.from) {
                return new RemoveMarkStep(Math.min(this.from, other.from),Math.max(this.to, other.to),this.mark)
            }
        }
        ;
        RemoveMarkStep.prototype.toJSON = function toJSON() {
            return {
                stepType: "removeMark",
                mark: this.mark.toJSON(),
                from: this.from,
                to: this.to
            }
        }
        ;
        RemoveMarkStep.fromJSON = function fromJSON(schema, json) {
            if (typeof json.from != "number" || typeof json.to != "number") {
                throw new RangeError("Invalid input for RemoveMarkStep.fromJSON")
            }
            return new RemoveMarkStep(json.from,json.to,schema.markFromJSON(json.mark))
        }
        ;
        return RemoveMarkStep
    }(Step);
    Step.jsonID("removeMark", RemoveMarkStep);
    Transform.prototype.addMark = function(from, to, mark) {
        var this$1 = this;
        var removed = []
            , added = []
            , removing = null
            , adding = null;
        this.doc.nodesBetween(from, to, function(node, pos, parent) {
            if (!node.isInline) {
                return
            }
            var marks = node.marks;
            if (!mark.isInSet(marks) && parent.type.allowsMarkType(mark.type)) {
                var start = Math.max(pos, from)
                    , end = Math.min(pos + node.nodeSize, to);
                var newSet = mark.addToSet(marks);
                for (var i = 0; i < marks.length; i++) {
                    if (!marks[i].isInSet(newSet)) {
                        if (removing && removing.to == start && removing.mark.eq(marks[i])) {
                            removing.to = end
                        } else {
                            removed.push(removing = new RemoveMarkStep(start,end,marks[i]))
                        }
                    }
                }
                if (adding && adding.to == start) {
                    adding.to = end
                } else {
                    added.push(adding = new AddMarkStep(start,end,mark))
                }
            }
        });
        removed.forEach(function(s) {
            return this$1.step(s)
        });
        added.forEach(function(s) {
            return this$1.step(s)
        });
        return this
    }
    ;
    Transform.prototype.removeMark = function(from, to, mark) {
        var this$1 = this;
        if (mark === void 0)
            mark = null;
        var matched = []
            , step = 0;
        this.doc.nodesBetween(from, to, function(node, pos) {
            if (!node.isInline) {
                return
            }
            step++;
            var toRemove = null;
            if (mark instanceof prosemirrorModel.MarkType) {
                var found = mark.isInSet(node.marks);
                if (found) {
                    toRemove = [found]
                }
            } else if (mark) {
                if (mark.isInSet(node.marks)) {
                    toRemove = [mark]
                }
            } else {
                toRemove = node.marks
            }
            if (toRemove && toRemove.length) {
                var end = Math.min(pos + node.nodeSize, to);
                for (var i = 0; i < toRemove.length; i++) {
                    var style = toRemove[i]
                        , found$1 = void 0;
                    for (var j = 0; j < matched.length; j++) {
                        var m = matched[j];
                        if (m.step == step - 1 && style.eq(matched[j].style)) {
                            found$1 = m
                        }
                    }
                    if (found$1) {
                        found$1.to = end;
                        found$1.step = step
                    } else {
                        matched.push({
                            style: style,
                            from: Math.max(pos, from),
                            to: end,
                            step: step
                        })
                    }
                }
            }
        });
        matched.forEach(function(m) {
            return this$1.step(new RemoveMarkStep(m.from,m.to,m.style))
        });
        return this
    }
    ;
    Transform.prototype.clearIncompatible = function(pos, parentType, match) {
        if (match === void 0)
            match = parentType.contentMatch;
        var node = this.doc.nodeAt(pos);
        var delSteps = []
            , cur = pos + 1;
        for (var i = 0; i < node.childCount; i++) {
            var child = node.child(i)
                , end = cur + child.nodeSize;
            var allowed = match.matchType(child.type, child.attrs);
            if (!allowed) {
                delSteps.push(new ReplaceStep(cur,end,prosemirrorModel.Slice.empty))
            } else {
                match = allowed;
                for (var j = 0; j < child.marks.length; j++) {
                    if (!parentType.allowsMarkType(child.marks[j].type)) {
                        this.step(new RemoveMarkStep(cur,end,child.marks[j]))
                    }
                }
            }
            cur = end
        }
        if (!match.validEnd) {
            var fill = match.fillBefore(prosemirrorModel.Fragment.empty, true);
            this.replace(cur, cur, new prosemirrorModel.Slice(fill,0,0))
        }
        for (var i$1 = delSteps.length - 1; i$1 >= 0; i$1--) {
            this.step(delSteps[i$1])
        }
        return this
    }
    ;
    function replaceStep(doc, from, to, slice) {
        if (to === void 0)
            to = from;
        if (slice === void 0)
            slice = prosemirrorModel.Slice.empty;
        if (from == to && !slice.size) {
            return null
        }
        var $from = doc.resolve(from)
            , $to = doc.resolve(to);
        if (fitsTrivially($from, $to, slice)) {
            return new ReplaceStep(from,to,slice)
        }
        return new Fitter($from,$to,slice).fit()
    }
    Transform.prototype.replace = function(from, to, slice) {
        if (to === void 0)
            to = from;
        if (slice === void 0)
            slice = prosemirrorModel.Slice.empty;
        var step = replaceStep(this.doc, from, to, slice);
        if (step) {
            this.step(step)
        }
        return this
    }
    ;
    Transform.prototype.replaceWith = function(from, to, content) {
        return this.replace(from, to, new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(content),0,0))
    }
    ;
    Transform.prototype.delete = function(from, to) {
        return this.replace(from, to, prosemirrorModel.Slice.empty)
    }
    ;
    Transform.prototype.insert = function(pos, content) {
        return this.replaceWith(pos, pos, content)
    }
    ;
    function fitsTrivially($from, $to, slice) {
        return !slice.openStart && !slice.openEnd && $from.start() == $to.start() && $from.parent.canReplace($from.index(), $to.index(), slice.content)
    }
    var Fitter = function Fitter($from, $to, slice) {
        this.$to = $to;
        this.$from = $from;
        this.unplaced = slice;
        this.frontier = [];
        for (var i = 0; i <= $from.depth; i++) {
            var node = $from.node(i);
            this.frontier.push({
                type: node.type,
                match: node.contentMatchAt($from.indexAfter(i))
            })
        }
        this.placed = prosemirrorModel.Fragment.empty;
        for (var i$1 = $from.depth; i$1 > 0; i$1--) {
            this.placed = prosemirrorModel.Fragment.from($from.node(i$1).copy(this.placed))
        }
    };
    var prototypeAccessors$1 = {
        depth: {
            configurable: true
        }
    };
    prototypeAccessors$1.depth.get = function() {
        return this.frontier.length - 1
    }
    ;
    Fitter.prototype.fit = function fit() {
        while (this.unplaced.size) {
            var fit = this.findFittable();
            if (fit) {
                this.placeNodes(fit)
            } else {
                this.openMore() || this.dropNode()
            }
        }
        var moveInline = this.mustMoveInline()
            , placedSize = this.placed.size - this.depth - this.$from.depth;
        var $from = this.$from
            , $to = moveInline < 0 ? this.$to : $from.doc.resolve(moveInline);
        if (this.close($to)) {
            var content = this.placed
                , openStart = $from.depth
                , openEnd = $to.depth;
            while (openStart && openEnd && content.childCount == 1) {
                content = content.firstChild.content;
                openStart--;
                openEnd--
            }
            var slice = new prosemirrorModel.Slice(content,openStart,openEnd);
            if (moveInline > -1) {
                return new ReplaceAroundStep($from.pos,moveInline,this.$to.pos,this.$to.end(),slice,placedSize)
            }
            if (slice.size || $from.pos != this.$to.pos) {
                return new ReplaceStep($from.pos,$to.pos,slice)
            }
        }
        return null
    }
    ;
    Fitter.prototype.findFittable = function findFittable() {
        for (var pass = 1; pass <= 2; pass++) {
            for (var sliceDepth = this.unplaced.openStart; sliceDepth >= 0; sliceDepth--) {
                var fragment = void 0
                    , parent = void 0;
                if (sliceDepth) {
                    parent = contentAt(this.unplaced.content, sliceDepth - 1).firstChild;
                    fragment = parent.content
                } else {
                    fragment = this.unplaced.content
                }
                var first = fragment.firstChild;
                for (var frontierDepth = this.depth; frontierDepth >= 0; frontierDepth--) {
                    var ref = this.frontier[frontierDepth];
                    var type = ref.type;
                    var match = ref.match;
                    var wrap = void 0
                        , inject = void 0;
                    if (pass == 1 && (first ? match.matchType(first.type) || (inject = match.fillBefore(prosemirrorModel.Fragment.from(first), false)) : type.compatibleContent(parent.type))) {
                        return {
                            sliceDepth: sliceDepth,
                            frontierDepth: frontierDepth,
                            parent: parent,
                            inject: inject
                        }
                    } else if (pass == 2 && first && (wrap = match.findWrapping(first.type))) {
                        return {
                            sliceDepth: sliceDepth,
                            frontierDepth: frontierDepth,
                            parent: parent,
                            wrap: wrap
                        }
                    }
                    if (parent && match.matchType(parent.type)) {
                        break
                    }
                }
            }
        }
    }
    ;
    Fitter.prototype.openMore = function openMore() {
        var ref = this.unplaced;
        var content = ref.content;
        var openStart = ref.openStart;
        var openEnd = ref.openEnd;
        var inner = contentAt(content, openStart);
        if (!inner.childCount || inner.firstChild.isLeaf) {
            return false
        }
        this.unplaced = new prosemirrorModel.Slice(content,openStart + 1,Math.max(openEnd, inner.size + openStart >= content.size - openEnd ? openStart + 1 : 0));
        return true
    }
    ;
    Fitter.prototype.dropNode = function dropNode() {
        var ref = this.unplaced;
        var content = ref.content;
        var openStart = ref.openStart;
        var openEnd = ref.openEnd;
        var inner = contentAt(content, openStart);
        if (inner.childCount <= 1 && openStart > 0) {
            var openAtEnd = content.size - openStart <= openStart + inner.size;
            this.unplaced = new prosemirrorModel.Slice(dropFromFragment(content, openStart - 1, 1),openStart - 1,openAtEnd ? openStart - 1 : openEnd)
        } else {
            this.unplaced = new prosemirrorModel.Slice(dropFromFragment(content, openStart, 1),openStart,openEnd)
        }
    }
    ;
    Fitter.prototype.placeNodes = function placeNodes(ref) {
        var sliceDepth = ref.sliceDepth;
        var frontierDepth = ref.frontierDepth;
        var parent = ref.parent;
        var inject = ref.inject;
        var wrap = ref.wrap;
        while (this.depth > frontierDepth) {
            this.closeFrontierNode()
        }
        if (wrap) {
            for (var i = 0; i < wrap.length; i++) {
                this.openFrontierNode(wrap[i])
            }
        }
        var slice = this.unplaced
            , fragment = parent ? parent.content : slice.content;
        var openStart = slice.openStart - sliceDepth;
        var taken = 0
            , add = [];
        var ref$1 = this.frontier[frontierDepth];
        var match = ref$1.match;
        var type = ref$1.type;
        if (inject) {
            for (var i$1 = 0; i$1 < inject.childCount; i$1++) {
                add.push(inject.child(i$1))
            }
            match = match.matchFragment(inject)
        }
        var openEndCount = fragment.size + sliceDepth - (slice.content.size - slice.openEnd);
        while (taken < fragment.childCount) {
            var next = fragment.child(taken)
                , matches = match.matchType(next.type);
            if (!matches) {
                break
            }
            taken++;
            if (taken > 1 || openStart == 0 || next.content.size) {
                match = matches;
                add.push(closeNodeStart(next.mark(type.allowedMarks(next.marks)), taken == 1 ? openStart : 0, taken == fragment.childCount ? openEndCount : -1))
            }
        }
        var toEnd = taken == fragment.childCount;
        if (!toEnd) {
            openEndCount = -1
        }
        if (toEnd && openEndCount < 0 && parent && parent.type == this.frontier[this.depth].type) {
            this.closeFrontierNode()
        } else {
            this.frontier[frontierDepth].match = match
        }
        for (var i$2 = 0, cur = fragment; i$2 < openEndCount; i$2++) {
            var node = cur.lastChild;
            this.frontier.push({
                type: node.type,
                match: node.contentMatchAt(node.childCount)
            });
            cur = node.content
        }
        this.unplaced = !toEnd ? new prosemirrorModel.Slice(dropFromFragment(slice.content, sliceDepth, taken),slice.openStart,slice.openEnd) : sliceDepth == 0 ? prosemirrorModel.Slice.empty : new prosemirrorModel.Slice(dropFromFragment(slice.content, sliceDepth - 1, 1),sliceDepth - 1,openEndCount < 0 ? slice.openEnd : sliceDepth - 1);
        this.placed = addToFragment(this.placed, frontierDepth, prosemirrorModel.Fragment.from(add))
    }
    ;
    Fitter.prototype.mustMoveInline = function mustMoveInline() {
        if (!this.$to.parent.isTextblock) {
            return -1
        }
        var top = this.frontier[this.depth], level;
        if (!top.type.isTextblock || !contentAfterFits(this.$to, this.$to.depth, top.type, top.match, false) || this.$to.depth == this.depth && (level = this.findCloseLevel(this.$to)) && level.depth == this.depth) {
            return -1
        }
        var ref = this.$to;
        var depth = ref.depth;
        var after = this.$to.after(depth);
        while (depth > 1 && after == this.$to.end(--depth)) {
            ++after
        }
        return after
    }
    ;
    Fitter.prototype.findCloseLevel = function findCloseLevel($to) {
        scan: for (var i = Math.min(this.depth, $to.depth); i >= 0; i--) {
            var ref = this.frontier[i];
            var match = ref.match;
            var type = ref.type;
            var fit = contentAfterFits($to, i, type, match, false);
            if (!fit) {
                continue
            }
            for (var d = i - 1; d >= 0; d--) {
                var ref$1 = this.frontier[d];
                var match$1 = ref$1.match;
                var type$1 = ref$1.type;
                var matches = contentAfterFits($to, d, type$1, match$1, true);
                if (!matches || matches.childCount) {
                    continue scan
                }
            }
            return {
                depth: i,
                fit: fit
            }
        }
    }
    ;
    Fitter.prototype.close = function close($to) {
        var close = this.findCloseLevel($to);
        if (!close) {
            return false
        }
        while (this.depth > close.depth) {
            this.closeFrontierNode()
        }
        if (close.fit.childCount) {
            this.placed = addToFragment(this.placed, close.depth, close.fit)
        }
        for (var d = close.depth + 1; d <= $to.depth; d++) {
            var node = $to.node(d)
                , add = node.type.contentMatch.fillBefore(node.content, true, $to.index(d));
            this.openFrontierNode(node.type, node.attrs, add)
        }
        return true
    }
    ;
    Fitter.prototype.openFrontierNode = function openFrontierNode(type, attrs, content) {
        var top = this.frontier[this.depth];
        top.match = top.match.matchType(type);
        this.placed = addToFragment(this.placed, this.depth, prosemirrorModel.Fragment.from(type.create(attrs, content)));
        this.frontier.push({
            type: type,
            match: type.contentMatch
        })
    }
    ;
    Fitter.prototype.closeFrontierNode = function closeFrontierNode() {
        var open = this.frontier.pop();
        var add = open.match.fillBefore(prosemirrorModel.Fragment.empty, true);
        if (add.childCount) {
            this.placed = addToFragment(this.placed, this.frontier.length, add)
        }
    }
    ;
    Object.defineProperties(Fitter.prototype, prototypeAccessors$1);
    function dropFromFragment(fragment, depth, count) {
        if (depth == 0) {
            return fragment.cutByIndex(count)
        }
        return fragment.replaceChild(0, fragment.firstChild.copy(dropFromFragment(fragment.firstChild.content, depth - 1, count)))
    }
    function addToFragment(fragment, depth, content) {
        if (depth == 0) {
            return fragment.append(content)
        }
        return fragment.replaceChild(fragment.childCount - 1, fragment.lastChild.copy(addToFragment(fragment.lastChild.content, depth - 1, content)))
    }
    function contentAt(fragment, depth) {
        for (var i = 0; i < depth; i++) {
            fragment = fragment.firstChild.content
        }
        return fragment
    }
    function closeNodeStart(node, openStart, openEnd) {
        if (openStart <= 0) {
            return node
        }
        var frag = node.content;
        if (openStart > 1) {
            frag = frag.replaceChild(0, closeNodeStart(frag.firstChild, openStart - 1, frag.childCount == 1 ? openEnd - 1 : 0))
        }
        if (openStart > 0) {
            frag = node.type.contentMatch.fillBefore(frag).append(frag);
            if (openEnd <= 0) {
                frag = frag.append(node.type.contentMatch.matchFragment(frag).fillBefore(prosemirrorModel.Fragment.empty, true))
            }
        }
        return node.copy(frag)
    }
    function contentAfterFits($to, depth, type, match, open) {
        var node = $to.node(depth)
            , index = open ? $to.indexAfter(depth) : $to.index(depth);
        if (index == node.childCount && !type.compatibleContent(node.type)) {
            return null
        }
        var fit = match.fillBefore(node.content, true, index);
        return fit && !invalidMarks(type, node.content, index) ? fit : null
    }
    function invalidMarks(type, fragment, start) {
        for (var i = start; i < fragment.childCount; i++) {
            if (!type.allowsMarks(fragment.child(i).marks)) {
                return true
            }
        }
        return false
    }
    Transform.prototype.replaceRange = function(from, to, slice) {
        if (!slice.size) {
            return this.deleteRange(from, to)
        }
        var $from = this.doc.resolve(from)
            , $to = this.doc.resolve(to);
        if (fitsTrivially($from, $to, slice)) {
            return this.step(new ReplaceStep(from,to,slice))
        }
        var targetDepths = coveredDepths($from, this.doc.resolve(to));
        if (targetDepths[targetDepths.length - 1] == 0) {
            targetDepths.pop()
        }
        var preferredTarget = -($from.depth + 1);
        targetDepths.unshift(preferredTarget);
        for (var d = $from.depth, pos = $from.pos - 1; d > 0; d--,
            pos--) {
            var spec = $from.node(d).type.spec;
            if (spec.defining || spec.isolating) {
                break
            }
            if (targetDepths.indexOf(d) > -1) {
                preferredTarget = d
            } else if ($from.before(d) == pos) {
                targetDepths.splice(1, 0, -d)
            }
        }
        var preferredTargetIndex = targetDepths.indexOf(preferredTarget);
        var leftNodes = []
            , preferredDepth = slice.openStart;
        for (var content = slice.content, i = 0; ; i++) {
            var node = content.firstChild;
            leftNodes.push(node);
            if (i == slice.openStart) {
                break
            }
            content = node.content
        }
        if (preferredDepth > 0 && leftNodes[preferredDepth - 1].type.spec.defining && $from.node(preferredTargetIndex).type != leftNodes[preferredDepth - 1].type) {
            preferredDepth -= 1
        } else if (preferredDepth >= 2 && leftNodes[preferredDepth - 1].isTextblock && leftNodes[preferredDepth - 2].type.spec.defining && $from.node(preferredTargetIndex).type != leftNodes[preferredDepth - 2].type) {
            preferredDepth -= 2
        }
        for (var j = slice.openStart; j >= 0; j--) {
            var openDepth = (j + preferredDepth + 1) % (slice.openStart + 1);
            var insert = leftNodes[openDepth];
            if (!insert) {
                continue
            }
            for (var i$1 = 0; i$1 < targetDepths.length; i$1++) {
                var targetDepth = targetDepths[(i$1 + preferredTargetIndex) % targetDepths.length]
                    , expand = true;
                if (targetDepth < 0) {
                    expand = false;
                    targetDepth = -targetDepth
                }
                var parent = $from.node(targetDepth - 1)
                    , index = $from.index(targetDepth - 1);
                if (parent.canReplaceWith(index, index, insert.type, insert.marks)) {
                    return this.replace($from.before(targetDepth), expand ? $to.after(targetDepth) : to, new prosemirrorModel.Slice(closeFragment(slice.content, 0, slice.openStart, openDepth),openDepth,slice.openEnd))
                }
            }
        }
        var startSteps = this.steps.length;
        for (var i$2 = targetDepths.length - 1; i$2 >= 0; i$2--) {
            this.replace(from, to, slice);
            if (this.steps.length > startSteps) {
                break
            }
            var depth = targetDepths[i$2];
            if (i$2 < 0) {
                continue
            }
            from = $from.before(depth);
            to = $to.after(depth)
        }
        return this
    }
    ;
    function closeFragment(fragment, depth, oldOpen, newOpen, parent) {
        if (depth < oldOpen) {
            var first = fragment.firstChild;
            fragment = fragment.replaceChild(0, first.copy(closeFragment(first.content, depth + 1, oldOpen, newOpen, first)))
        }
        if (depth > newOpen) {
            var match = parent.contentMatchAt(0);
            var start = match.fillBefore(fragment).append(fragment);
            fragment = start.append(match.matchFragment(start).fillBefore(prosemirrorModel.Fragment.empty, true))
        }
        return fragment
    }
    Transform.prototype.replaceRangeWith = function(from, to, node) {
        if (!node.isInline && from == to && this.doc.resolve(from).parent.content.size) {
            var point = insertPoint(this.doc, from, node.type);
            if (point != null) {
                from = to = point
            }
        }
        return this.replaceRange(from, to, new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(node),0,0))
    }
    ;
    Transform.prototype.deleteRange = function(from, to) {
        var $from = this.doc.resolve(from)
            , $to = this.doc.resolve(to);
        var covered = coveredDepths($from, $to);
        for (var i = 0; i < covered.length; i++) {
            var depth = covered[i]
                , last = i == covered.length - 1;
            if (last && depth == 0 || $from.node(depth).type.contentMatch.validEnd) {
                return this.delete($from.start(depth), $to.end(depth))
            }
            if (depth > 0 && (last || $from.node(depth - 1).canReplace($from.index(depth - 1), $to.indexAfter(depth - 1)))) {
                return this.delete($from.before(depth), $to.after(depth))
            }
        }
        for (var d = 1; d <= $from.depth && d <= $to.depth; d++) {
            if (from - $from.start(d) == $from.depth - d && to > $from.end(d) && $to.end(d) - to != $to.depth - d) {
                return this.delete($from.before(d), to)
            }
        }
        return this.delete(from, to)
    }
    ;
    function coveredDepths($from, $to) {
        var result = []
            , minDepth = Math.min($from.depth, $to.depth);
        for (var d = minDepth; d >= 0; d--) {
            var start = $from.start(d);
            if (start < $from.pos - ($from.depth - d) || $to.end(d) > $to.pos + ($to.depth - d) || $from.node(d).type.spec.isolating || $to.node(d).type.spec.isolating) {
                break
            }
            if (start == $to.start(d)) {
                result.push(d)
            }
        }
        return result
    }
    exports.AddMarkStep = AddMarkStep;
    exports.MapResult = MapResult;
    exports.Mapping = Mapping;
    exports.RemoveMarkStep = RemoveMarkStep;
    exports.ReplaceAroundStep = ReplaceAroundStep;
    exports.ReplaceStep = ReplaceStep;
    exports.Step = Step;
    exports.StepMap = StepMap;
    exports.StepResult = StepResult;
    exports.Transform = Transform;
    exports.TransformError = TransformError;
    exports.canJoin = canJoin;
    exports.canSplit = canSplit;
    exports.dropPoint = dropPoint;
    exports.findWrapping = findWrapping;
    exports.insertPoint = insertPoint;
    exports.joinPoint = joinPoint;
    exports.liftTarget = liftTarget;
    exports.replaceStep = replaceStep
});
define("prosemirror-transform", ["prosemirror-transform/index"], function(main) {
    return main
});
define("prosemirror-state/index", ["require", "exports", "module", "prosemirror-model", "prosemirror-transform"], function(require, exports, module) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var prosemirrorModel = require("prosemirror-model");
    var prosemirrorTransform = require("prosemirror-transform");
    var classesById = Object.create(null);
    var Selection = function Selection($anchor, $head, ranges) {
        this.ranges = ranges || [new SelectionRange($anchor.min($head),$anchor.max($head))];
        this.$anchor = $anchor;
        this.$head = $head
    };
    var prototypeAccessors = {
        anchor: {
            configurable: true
        },
        head: {
            configurable: true
        },
        from: {
            configurable: true
        },
        to: {
            configurable: true
        },
        $from: {
            configurable: true
        },
        $to: {
            configurable: true
        },
        empty: {
            configurable: true
        }
    };
    prototypeAccessors.anchor.get = function() {
        return this.$anchor.pos
    }
    ;
    prototypeAccessors.head.get = function() {
        return this.$head.pos
    }
    ;
    prototypeAccessors.from.get = function() {
        return this.$from.pos
    }
    ;
    prototypeAccessors.to.get = function() {
        return this.$to.pos
    }
    ;
    prototypeAccessors.$from.get = function() {
        return this.ranges[0].$from
    }
    ;
    prototypeAccessors.$to.get = function() {
        return this.ranges[0].$to
    }
    ;
    prototypeAccessors.empty.get = function() {
        var ranges = this.ranges;
        for (var i = 0; i < ranges.length; i++) {
            if (ranges[i].$from.pos != ranges[i].$to.pos) {
                return false
            }
        }
        return true
    }
    ;
    Selection.prototype.content = function content() {
        return this.$from.node(0).slice(this.from, this.to, true)
    }
    ;
    Selection.prototype.replace = function replace(tr, content) {
        if (content === void 0)
            content = prosemirrorModel.Slice.empty;
        var lastNode = content.content.lastChild
            , lastParent = null;
        for (var i = 0; i < content.openEnd; i++) {
            lastParent = lastNode;
            lastNode = lastNode.lastChild
        }
        var mapFrom = tr.steps.length
            , ranges = this.ranges;
        for (var i$1 = 0; i$1 < ranges.length; i$1++) {
            var ref = ranges[i$1];
            var $from = ref.$from;
            var $to = ref.$to;
            var mapping = tr.mapping.slice(mapFrom);
            tr.replaceRange(mapping.map($from.pos), mapping.map($to.pos), i$1 ? prosemirrorModel.Slice.empty : content);
            if (i$1 == 0) {
                selectionToInsertionEnd(tr, mapFrom, (lastNode ? lastNode.isInline : lastParent && lastParent.isTextblock) ? -1 : 1)
            }
        }
    }
    ;
    Selection.prototype.replaceWith = function replaceWith(tr, node) {
        var mapFrom = tr.steps.length
            , ranges = this.ranges;
        for (var i = 0; i < ranges.length; i++) {
            var ref = ranges[i];
            var $from = ref.$from;
            var $to = ref.$to;
            var mapping = tr.mapping.slice(mapFrom);
            var from = mapping.map($from.pos)
                , to = mapping.map($to.pos);
            if (i) {
                tr.deleteRange(from, to)
            } else {
                tr.replaceRangeWith(from, to, node);
                selectionToInsertionEnd(tr, mapFrom, node.isInline ? -1 : 1)
            }
        }
    }
    ;
    Selection.findFrom = function findFrom($pos, dir, textOnly) {
        var inner = $pos.parent.inlineContent ? new TextSelection($pos) : findSelectionIn($pos.node(0), $pos.parent, $pos.pos, $pos.index(), dir, textOnly);
        if (inner) {
            return inner
        }
        for (var depth = $pos.depth - 1; depth >= 0; depth--) {
            var found = dir < 0 ? findSelectionIn($pos.node(0), $pos.node(depth), $pos.before(depth + 1), $pos.index(depth), dir, textOnly) : findSelectionIn($pos.node(0), $pos.node(depth), $pos.after(depth + 1), $pos.index(depth) + 1, dir, textOnly);
            if (found) {
                return found
            }
        }
    }
    ;
    Selection.near = function near($pos, bias) {
        if (bias === void 0)
            bias = 1;
        return this.findFrom($pos, bias) || this.findFrom($pos, -bias) || new AllSelection($pos.node(0))
    }
    ;
    Selection.atStart = function atStart(doc) {
        return findSelectionIn(doc, doc, 0, 0, 1) || new AllSelection(doc)
    }
    ;
    Selection.atEnd = function atEnd(doc) {
        return findSelectionIn(doc, doc, doc.content.size, doc.childCount, -1) || new AllSelection(doc)
    }
    ;
    Selection.fromJSON = function fromJSON(doc, json) {
        if (!json || !json.type) {
            throw new RangeError("Invalid input for Selection.fromJSON")
        }
        var cls = classesById[json.type];
        if (!cls) {
            throw new RangeError("No selection type " + json.type + " defined")
        }
        return cls.fromJSON(doc, json)
    }
    ;
    Selection.jsonID = function jsonID(id, selectionClass) {
        if (id in classesById) {
            throw new RangeError("Duplicate use of selection JSON ID " + id)
        }
        classesById[id] = selectionClass;
        selectionClass.prototype.jsonID = id;
        return selectionClass
    }
    ;
    Selection.prototype.getBookmark = function getBookmark() {
        return TextSelection.between(this.$anchor, this.$head).getBookmark()
    }
    ;
    Object.defineProperties(Selection.prototype, prototypeAccessors);
    Selection.prototype.visible = true;
    var SelectionRange = function SelectionRange($from, $to) {
        this.$from = $from;
        this.$to = $to
    };
    var TextSelection = function(Selection) {
        function TextSelection($anchor, $head) {
            if ($head === void 0)
                $head = $anchor;
            Selection.call(this, $anchor, $head)
        }
        if (Selection)
            TextSelection.__proto__ = Selection;
        TextSelection.prototype = Object.create(Selection && Selection.prototype);
        TextSelection.prototype.constructor = TextSelection;
        var prototypeAccessors$1 = {
            $cursor: {
                configurable: true
            }
        };
        prototypeAccessors$1.$cursor.get = function() {
            return this.$anchor.pos == this.$head.pos ? this.$head : null
        }
        ;
        TextSelection.prototype.map = function map(doc, mapping) {
            var $head = doc.resolve(mapping.map(this.head));
            if (!$head.parent.inlineContent) {
                return Selection.near($head)
            }
            var $anchor = doc.resolve(mapping.map(this.anchor));
            return new TextSelection($anchor.parent.inlineContent ? $anchor : $head,$head)
        }
        ;
        TextSelection.prototype.replace = function replace(tr, content) {
            if (content === void 0)
                content = prosemirrorModel.Slice.empty;
            Selection.prototype.replace.call(this, tr, content);
            if (content == prosemirrorModel.Slice.empty) {
                var marks = this.$from.marksAcross(this.$to);
                if (marks) {
                    tr.ensureMarks(marks)
                }
            }
        }
        ;
        TextSelection.prototype.eq = function eq(other) {
            return other instanceof TextSelection && other.anchor == this.anchor && other.head == this.head
        }
        ;
        TextSelection.prototype.getBookmark = function getBookmark() {
            return new TextBookmark(this.anchor,this.head)
        }
        ;
        TextSelection.prototype.toJSON = function toJSON() {
            return {
                type: "text",
                anchor: this.anchor,
                head: this.head
            }
        }
        ;
        TextSelection.fromJSON = function fromJSON(doc, json) {
            if (typeof json.anchor != "number" || typeof json.head != "number") {
                throw new RangeError("Invalid input for TextSelection.fromJSON")
            }
            return new TextSelection(doc.resolve(json.anchor),doc.resolve(json.head))
        }
        ;
        TextSelection.create = function create(doc, anchor, head) {
            if (head === void 0)
                head = anchor;
            var $anchor = doc.resolve(anchor);
            return new this($anchor,head == anchor ? $anchor : doc.resolve(head))
        }
        ;
        TextSelection.between = function between($anchor, $head, bias) {
            var dPos = $anchor.pos - $head.pos;
            if (!bias || dPos) {
                bias = dPos >= 0 ? 1 : -1
            }
            if (!$head.parent.inlineContent) {
                var found = Selection.findFrom($head, bias, true) || Selection.findFrom($head, -bias, true);
                if (found) {
                    $head = found.$head
                } else {
                    return Selection.near($head, bias)
                }
            }
            if (!$anchor.parent.inlineContent) {
                if (dPos == 0) {
                    $anchor = $head
                } else {
                    $anchor = (Selection.findFrom($anchor, -bias, true) || Selection.findFrom($anchor, bias, true)).$anchor;
                    if ($anchor.pos < $head.pos != dPos < 0) {
                        $anchor = $head
                    }
                }
            }
            return new TextSelection($anchor,$head)
        }
        ;
        Object.defineProperties(TextSelection.prototype, prototypeAccessors$1);
        return TextSelection
    }(Selection);
    Selection.jsonID("text", TextSelection);
    var TextBookmark = function TextBookmark(anchor, head) {
        this.anchor = anchor;
        this.head = head
    };
    TextBookmark.prototype.map = function map(mapping) {
        return new TextBookmark(mapping.map(this.anchor),mapping.map(this.head))
    }
    ;
    TextBookmark.prototype.resolve = function resolve(doc) {
        return TextSelection.between(doc.resolve(this.anchor), doc.resolve(this.head))
    }
    ;
    var NodeSelection = function(Selection) {
        function NodeSelection($pos) {
            var node = $pos.nodeAfter;
            var $end = $pos.node(0).resolve($pos.pos + node.nodeSize);
            Selection.call(this, $pos, $end);
            this.node = node
        }
        if (Selection)
            NodeSelection.__proto__ = Selection;
        NodeSelection.prototype = Object.create(Selection && Selection.prototype);
        NodeSelection.prototype.constructor = NodeSelection;
        NodeSelection.prototype.map = function map(doc, mapping) {
            var ref = mapping.mapResult(this.anchor);
            var deleted = ref.deleted;
            var pos = ref.pos;
            var $pos = doc.resolve(pos);
            if (deleted) {
                return Selection.near($pos)
            }
            return new NodeSelection($pos)
        }
        ;
        NodeSelection.prototype.content = function content() {
            return new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(this.node),0,0)
        }
        ;
        NodeSelection.prototype.eq = function eq(other) {
            return other instanceof NodeSelection && other.anchor == this.anchor
        }
        ;
        NodeSelection.prototype.toJSON = function toJSON() {
            return {
                type: "node",
                anchor: this.anchor
            }
        }
        ;
        NodeSelection.prototype.getBookmark = function getBookmark() {
            return new NodeBookmark(this.anchor)
        }
        ;
        NodeSelection.fromJSON = function fromJSON(doc, json) {
            if (typeof json.anchor != "number") {
                throw new RangeError("Invalid input for NodeSelection.fromJSON")
            }
            return new NodeSelection(doc.resolve(json.anchor))
        }
        ;
        NodeSelection.create = function create(doc, from) {
            return new this(doc.resolve(from))
        }
        ;
        NodeSelection.isSelectable = function isSelectable(node) {
            return !node.isText && node.type.spec.selectable !== false
        }
        ;
        return NodeSelection
    }(Selection);
    NodeSelection.prototype.visible = false;
    Selection.jsonID("node", NodeSelection);
    var NodeBookmark = function NodeBookmark(anchor) {
        this.anchor = anchor
    };
    NodeBookmark.prototype.map = function map(mapping) {
        var ref = mapping.mapResult(this.anchor);
        var deleted = ref.deleted;
        var pos = ref.pos;
        return deleted ? new TextBookmark(pos,pos) : new NodeBookmark(pos)
    }
    ;
    NodeBookmark.prototype.resolve = function resolve(doc) {
        var $pos = doc.resolve(this.anchor)
            , node = $pos.nodeAfter;
        if (node && NodeSelection.isSelectable(node)) {
            return new NodeSelection($pos)
        }
        return Selection.near($pos)
    }
    ;
    var AllSelection = function(Selection) {
        function AllSelection(doc) {
            Selection.call(this, doc.resolve(0), doc.resolve(doc.content.size))
        }
        if (Selection)
            AllSelection.__proto__ = Selection;
        AllSelection.prototype = Object.create(Selection && Selection.prototype);
        AllSelection.prototype.constructor = AllSelection;
        AllSelection.prototype.replace = function replace(tr, content) {
            if (content === void 0)
                content = prosemirrorModel.Slice.empty;
            if (content == prosemirrorModel.Slice.empty) {
                tr.delete(0, tr.doc.content.size);
                var sel = Selection.atStart(tr.doc);
                if (!sel.eq(tr.selection)) {
                    tr.setSelection(sel)
                }
            } else {
                Selection.prototype.replace.call(this, tr, content)
            }
        }
        ;
        AllSelection.prototype.toJSON = function toJSON() {
            return {
                type: "all"
            }
        }
        ;
        AllSelection.fromJSON = function fromJSON(doc) {
            return new AllSelection(doc)
        }
        ;
        AllSelection.prototype.map = function map(doc) {
            return new AllSelection(doc)
        }
        ;
        AllSelection.prototype.eq = function eq(other) {
            return other instanceof AllSelection
        }
        ;
        AllSelection.prototype.getBookmark = function getBookmark() {
            return AllBookmark
        }
        ;
        return AllSelection
    }(Selection);
    Selection.jsonID("all", AllSelection);
    var AllBookmark = {
        map: function map() {
            return this
        },
        resolve: function resolve(doc) {
            return new AllSelection(doc)
        }
    };
    function findSelectionIn(doc, node, pos, index, dir, text) {
        if (node.inlineContent) {
            return TextSelection.create(doc, pos)
        }
        for (var i = index - (dir > 0 ? 0 : 1); dir > 0 ? i < node.childCount : i >= 0; i += dir) {
            var child = node.child(i);
            if (!child.isAtom) {
                var inner = findSelectionIn(doc, child, pos + dir, dir < 0 ? child.childCount : 0, dir, text);
                if (inner) {
                    return inner
                }
            } else if (!text && NodeSelection.isSelectable(child)) {
                return NodeSelection.create(doc, pos - (dir < 0 ? child.nodeSize : 0))
            }
            pos += child.nodeSize * dir
        }
    }
    function selectionToInsertionEnd(tr, startLen, bias) {
        var last = tr.steps.length - 1;
        if (last < startLen) {
            return
        }
        var step = tr.steps[last];
        if (!(step instanceof prosemirrorTransform.ReplaceStep || step instanceof prosemirrorTransform.ReplaceAroundStep)) {
            return
        }
        var map = tr.mapping.maps[last], end;
        map.forEach(function(_from, _to, _newFrom, newTo) {
            if (end == null) {
                end = newTo
            }
        });
        tr.setSelection(Selection.near(tr.doc.resolve(end), bias))
    }
    var UPDATED_SEL = 1
        , UPDATED_MARKS = 2
        , UPDATED_SCROLL = 4;
    var Transaction = function(Transform) {
        function Transaction(state) {
            Transform.call(this, state.doc);
            this.time = Date.now();
            this.curSelection = state.selection;
            this.curSelectionFor = 0;
            this.storedMarks = state.storedMarks;
            this.updated = 0;
            this.meta = Object.create(null)
        }
        if (Transform)
            Transaction.__proto__ = Transform;
        Transaction.prototype = Object.create(Transform && Transform.prototype);
        Transaction.prototype.constructor = Transaction;
        var prototypeAccessors = {
            selection: {
                configurable: true
            },
            selectionSet: {
                configurable: true
            },
            storedMarksSet: {
                configurable: true
            },
            isGeneric: {
                configurable: true
            },
            scrolledIntoView: {
                configurable: true
            }
        };
        prototypeAccessors.selection.get = function() {
            if (this.curSelectionFor < this.steps.length) {
                this.curSelection = this.curSelection.map(this.doc, this.mapping.slice(this.curSelectionFor));
                this.curSelectionFor = this.steps.length
            }
            return this.curSelection
        }
        ;
        Transaction.prototype.setSelection = function setSelection(selection) {
            if (selection.$from.doc != this.doc) {
                throw new RangeError("Selection passed to setSelection must point at the current document")
            }
            this.curSelection = selection;
            this.curSelectionFor = this.steps.length;
            this.updated = (this.updated | UPDATED_SEL) & ~UPDATED_MARKS;
            this.storedMarks = null;
            return this
        }
        ;
        prototypeAccessors.selectionSet.get = function() {
            return (this.updated & UPDATED_SEL) > 0
        }
        ;
        Transaction.prototype.setStoredMarks = function setStoredMarks(marks) {
            this.storedMarks = marks;
            this.updated |= UPDATED_MARKS;
            return this
        }
        ;
        Transaction.prototype.ensureMarks = function ensureMarks(marks) {
            if (!prosemirrorModel.Mark.sameSet(this.storedMarks || this.selection.$from.marks(), marks)) {
                this.setStoredMarks(marks)
            }
            return this
        }
        ;
        Transaction.prototype.addStoredMark = function addStoredMark(mark) {
            return this.ensureMarks(mark.addToSet(this.storedMarks || this.selection.$head.marks()))
        }
        ;
        Transaction.prototype.removeStoredMark = function removeStoredMark(mark) {
            return this.ensureMarks(mark.removeFromSet(this.storedMarks || this.selection.$head.marks()))
        }
        ;
        prototypeAccessors.storedMarksSet.get = function() {
            return (this.updated & UPDATED_MARKS) > 0
        }
        ;
        Transaction.prototype.addStep = function addStep(step, doc) {
            Transform.prototype.addStep.call(this, step, doc);
            this.updated = this.updated & ~UPDATED_MARKS;
            this.storedMarks = null
        }
        ;
        Transaction.prototype.setTime = function setTime(time) {
            this.time = time;
            return this
        }
        ;
        Transaction.prototype.replaceSelection = function replaceSelection(slice) {
            this.selection.replace(this, slice);
            return this
        }
        ;
        Transaction.prototype.replaceSelectionWith = function replaceSelectionWith(node, inheritMarks) {
            var selection = this.selection;
            if (inheritMarks !== false) {
                node = node.mark(this.storedMarks || (selection.empty ? selection.$from.marks() : selection.$from.marksAcross(selection.$to) || prosemirrorModel.Mark.none))
            }
            selection.replaceWith(this, node);
            return this
        }
        ;
        Transaction.prototype.deleteSelection = function deleteSelection() {
            this.selection.replace(this);
            return this
        }
        ;
        Transaction.prototype.insertText = function insertText(text, from, to) {
            if (to === void 0)
                to = from;
            var schema = this.doc.type.schema;
            if (from == null) {
                if (!text) {
                    return this.deleteSelection()
                }
                return this.replaceSelectionWith(schema.text(text), true)
            } else {
                if (!text) {
                    return this.deleteRange(from, to)
                }
                var marks = this.storedMarks;
                if (!marks) {
                    var $from = this.doc.resolve(from);
                    marks = to == from ? $from.marks() : $from.marksAcross(this.doc.resolve(to))
                }
                this.replaceRangeWith(from, to, schema.text(text, marks));
                if (!this.selection.empty) {
                    this.setSelection(Selection.near(this.selection.$to))
                }
                return this
            }
        }
        ;
        Transaction.prototype.setMeta = function setMeta(key, value) {
            this.meta[typeof key == "string" ? key : key.key] = value;
            return this
        }
        ;
        Transaction.prototype.getMeta = function getMeta(key) {
            return this.meta[typeof key == "string" ? key : key.key]
        }
        ;
        prototypeAccessors.isGeneric.get = function() {
            for (var _ in this.meta) {
                return false
            }
            return true
        }
        ;
        Transaction.prototype.scrollIntoView = function scrollIntoView() {
            this.updated |= UPDATED_SCROLL;
            return this
        }
        ;
        prototypeAccessors.scrolledIntoView.get = function() {
            return (this.updated & UPDATED_SCROLL) > 0
        }
        ;
        Object.defineProperties(Transaction.prototype, prototypeAccessors);
        return Transaction
    }(prosemirrorTransform.Transform);
    function bind(f, self) {
        return !self || !f ? f : f.bind(self)
    }
    var FieldDesc = function FieldDesc(name, desc, self) {
        this.name = name;
        this.init = bind(desc.init, self);
        this.apply = bind(desc.apply, self)
    };
    var baseFields = [new FieldDesc("doc",{
        init: function init(config) {
            return config.doc || config.schema.topNodeType.createAndFill()
        },
        apply: function apply(tr) {
            return tr.doc
        }
    }), new FieldDesc("selection",{
        init: function init(config, instance) {
            return config.selection || Selection.atStart(instance.doc)
        },
        apply: function apply(tr) {
            return tr.selection
        }
    }), new FieldDesc("storedMarks",{
        init: function init(config) {
            return config.storedMarks || null
        },
        apply: function apply(tr, _marks, _old, state) {
            return state.selection.$cursor ? tr.storedMarks : null
        }
    }), new FieldDesc("scrollToSelection",{
        init: function init() {
            return 0
        },
        apply: function apply(tr, prev) {
            return tr.scrolledIntoView ? prev + 1 : prev
        }
    })];
    var Configuration = function Configuration(schema, plugins) {
        var this$1 = this;
        this.schema = schema;
        this.fields = baseFields.concat();
        this.plugins = [];
        this.pluginsByKey = Object.create(null);
        if (plugins) {
            plugins.forEach(function(plugin) {
                if (this$1.pluginsByKey[plugin.key]) {
                    throw new RangeError("Adding different instances of a keyed plugin (" + plugin.key + ")")
                }
                this$1.plugins.push(plugin);
                this$1.pluginsByKey[plugin.key] = plugin;
                if (plugin.spec.state) {
                    this$1.fields.push(new FieldDesc(plugin.key,plugin.spec.state,plugin))
                }
            })
        }
    };
    var EditorState = function EditorState(config) {
        this.config = config
    };
    var prototypeAccessors$1 = {
        schema: {
            configurable: true
        },
        plugins: {
            configurable: true
        },
        tr: {
            configurable: true
        }
    };
    prototypeAccessors$1.schema.get = function() {
        return this.config.schema
    }
    ;
    prototypeAccessors$1.plugins.get = function() {
        return this.config.plugins
    }
    ;
    EditorState.prototype.apply = function apply(tr) {
        return this.applyTransaction(tr).state
    }
    ;
    EditorState.prototype.filterTransaction = function filterTransaction(tr, ignore) {
        if (ignore === void 0)
            ignore = -1;
        for (var i = 0; i < this.config.plugins.length; i++) {
            if (i != ignore) {
                var plugin = this.config.plugins[i];
                if (plugin.spec.filterTransaction && !plugin.spec.filterTransaction.call(plugin, tr, this)) {
                    return false
                }
            }
        }
        return true
    }
    ;
    EditorState.prototype.applyTransaction = function applyTransaction(rootTr) {
        if (!this.filterTransaction(rootTr)) {
            return {
                state: this,
                transactions: []
            }
        }
        var trs = [rootTr]
            , newState = this.applyInner(rootTr)
            , seen = null;
        for (; ; ) {
            var haveNew = false;
            for (var i = 0; i < this.config.plugins.length; i++) {
                var plugin = this.config.plugins[i];
                if (plugin.spec.appendTransaction) {
                    var n = seen ? seen[i].n : 0
                        , oldState = seen ? seen[i].state : this;
                    var tr = n < trs.length && plugin.spec.appendTransaction.call(plugin, n ? trs.slice(n) : trs, oldState, newState);
                    if (tr && newState.filterTransaction(tr, i)) {
                        tr.setMeta("appendedTransaction", rootTr);
                        if (!seen) {
                            seen = [];
                            for (var j = 0; j < this.config.plugins.length; j++) {
                                seen.push(j < i ? {
                                    state: newState,
                                    n: trs.length
                                } : {
                                    state: this,
                                    n: 0
                                })
                            }
                        }
                        trs.push(tr);
                        newState = newState.applyInner(tr);
                        haveNew = true
                    }
                    if (seen) {
                        seen[i] = {
                            state: newState,
                            n: trs.length
                        }
                    }
                }
            }
            if (!haveNew) {
                return {
                    state: newState,
                    transactions: trs
                }
            }
        }
    }
    ;
    EditorState.prototype.applyInner = function applyInner(tr) {
        if (!tr.before.eq(this.doc)) {
            throw new RangeError("Applying a mismatched transaction")
        }
        var newInstance = new EditorState(this.config)
            , fields = this.config.fields;
        for (var i = 0; i < fields.length; i++) {
            var field = fields[i];
            newInstance[field.name] = field.apply(tr, this[field.name], this, newInstance)
        }
        for (var i$1 = 0; i$1 < applyListeners.length; i$1++) {
            applyListeners[i$1](this, tr, newInstance)
        }
        return newInstance
    }
    ;
    prototypeAccessors$1.tr.get = function() {
        return new Transaction(this)
    }
    ;
    EditorState.create = function create(config) {
        var $config = new Configuration(config.schema || config.doc.type.schema,config.plugins);
        var instance = new EditorState($config);
        for (var i = 0; i < $config.fields.length; i++) {
            instance[$config.fields[i].name] = $config.fields[i].init(config, instance)
        }
        return instance
    }
    ;
    EditorState.prototype.reconfigure = function reconfigure(config) {
        var $config = new Configuration(config.schema || this.schema,config.plugins);
        var fields = $config.fields
            , instance = new EditorState($config);
        for (var i = 0; i < fields.length; i++) {
            var name = fields[i].name;
            instance[name] = this.hasOwnProperty(name) ? this[name] : fields[i].init(config, instance)
        }
        return instance
    }
    ;
    EditorState.prototype.toJSON = function toJSON(pluginFields) {
        var result = {
            doc: this.doc.toJSON(),
            selection: this.selection.toJSON()
        };
        if (this.storedMarks) {
            result.storedMarks = this.storedMarks.map(function(m) {
                return m.toJSON()
            })
        }
        if (pluginFields && typeof pluginFields == "object") {
            for (var prop in pluginFields) {
                if (prop == "doc" || prop == "selection") {
                    throw new RangeError("The JSON fields `doc` and `selection` are reserved")
                }
                var plugin = pluginFields[prop]
                    , state = plugin.spec.state;
                if (state && state.toJSON) {
                    result[prop] = state.toJSON.call(plugin, this[plugin.key])
                }
            }
        }
        return result
    }
    ;
    EditorState.fromJSON = function fromJSON(config, json, pluginFields) {
        if (!json) {
            throw new RangeError("Invalid input for EditorState.fromJSON")
        }
        if (!config.schema) {
            throw new RangeError("Required config field 'schema' missing")
        }
        var $config = new Configuration(config.schema,config.plugins);
        var instance = new EditorState($config);
        $config.fields.forEach(function(field) {
            if (field.name == "doc") {
                instance.doc = prosemirrorModel.Node.fromJSON(config.schema, json.doc)
            } else if (field.name == "selection") {
                instance.selection = Selection.fromJSON(instance.doc, json.selection)
            } else if (field.name == "storedMarks") {
                if (json.storedMarks) {
                    instance.storedMarks = json.storedMarks.map(config.schema.markFromJSON)
                }
            } else {
                if (pluginFields) {
                    for (var prop in pluginFields) {
                        var plugin = pluginFields[prop]
                            , state = plugin.spec.state;
                        if (plugin.key == field.name && state && state.fromJSON && Object.prototype.hasOwnProperty.call(json, prop)) {
                            instance[field.name] = state.fromJSON.call(plugin, config, json[prop], instance);
                            return
                        }
                    }
                }
                instance[field.name] = field.init(config, instance)
            }
        });
        return instance
    }
    ;
    EditorState.addApplyListener = function addApplyListener(f) {
        applyListeners.push(f)
    }
    ;
    EditorState.removeApplyListener = function removeApplyListener(f) {
        var found = applyListeners.indexOf(f);
        if (found > -1) {
            applyListeners.splice(found, 1)
        }
    }
    ;
    Object.defineProperties(EditorState.prototype, prototypeAccessors$1);
    var applyListeners = [];
    function bindProps(obj, self, target) {
        for (var prop in obj) {
            var val = obj[prop];
            if (val instanceof Function) {
                val = val.bind(self)
            } else if (prop == "handleDOMEvents") {
                val = bindProps(val, self, {})
            }
            target[prop] = val
        }
        return target
    }
    var Plugin = function Plugin(spec) {
        this.props = {};
        if (spec.props) {
            bindProps(spec.props, this, this.props)
        }
        this.spec = spec;
        this.key = spec.key ? spec.key.key : createKey("plugin")
    };
    Plugin.prototype.getState = function getState(state) {
        return state[this.key]
    }
    ;
    var keys = Object.create(null);
    function createKey(name) {
        if (name in keys) {
            return name + "$" + ++keys[name]
        }
        keys[name] = 0;
        return name + "$"
    }
    var PluginKey = function PluginKey(name) {
        if (name === void 0)
            name = "key";
        this.key = createKey(name)
    };
    PluginKey.prototype.get = function get(state) {
        return state.config.pluginsByKey[this.key]
    }
    ;
    PluginKey.prototype.getState = function getState(state) {
        return state[this.key]
    }
    ;
    exports.AllSelection = AllSelection;
    exports.EditorState = EditorState;
    exports.NodeSelection = NodeSelection;
    exports.Plugin = Plugin;
    exports.PluginKey = PluginKey;
    exports.Selection = Selection;
    exports.SelectionRange = SelectionRange;
    exports.TextSelection = TextSelection;
    exports.Transaction = Transaction
});
define("prosemirror-state", ["prosemirror-state/index"], function(main) {
    return main
});
define("prosemirror-view/index", ["require", "exports", "module", "prosemirror-state", "prosemirror-model", "prosemirror-transform"], function(require, exports, module) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var prosemirrorState = require("prosemirror-state");
    var prosemirrorModel = require("prosemirror-model");
    var prosemirrorTransform = require("prosemirror-transform");
    var result = {};
    if (typeof navigator != "undefined" && typeof document != "undefined") {
        var ie_edge = /Edge\/(\d+)/.exec(navigator.userAgent);
        var ie_upto10 = /MSIE \d/.test(navigator.userAgent);
        var ie_11up = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);
        result.mac = /Mac/.test(navigator.platform);
        var ie = result.ie = !!(ie_upto10 || ie_11up || ie_edge);
        result.ie_version = ie_upto10 ? document.documentMode || 6 : ie_11up ? +ie_11up[1] : ie_edge ? +ie_edge[1] : null;
        result.gecko = !ie && /gecko\/(\d+)/i.test(navigator.userAgent);
        result.gecko_version = result.gecko && +(/Firefox\/(\d+)/.exec(navigator.userAgent) || [0, 0])[1];
        var chrome = !ie && /Chrome\/(\d+)/.exec(navigator.userAgent);
        result.chrome = !!chrome;
        result.chrome_version = chrome && +chrome[1];
        result.ios = !ie && /AppleWebKit/.test(navigator.userAgent) && /Mobile\/\w+/.test(navigator.userAgent);
        result.android = /Android \d/.test(navigator.userAgent);
        result.webkit = "webkitFontSmoothing"in document.documentElement.style;
        result.safari = /Apple Computer/.test(navigator.vendor);
        result.webkit_version = result.webkit && +(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent) || [0, 0])[1]
    }
    var domIndex = function(node) {
        for (var index = 0; ; index++) {
            node = node.previousSibling;
            if (!node) {
                return index
            }
        }
    };
    var parentNode = function(node) {
        var parent = node.parentNode;
        return parent && parent.nodeType == 11 ? parent.host : parent
    };
    var textRange = function(node, from, to) {
        var range = document.createRange();
        range.setEnd(node, to == null ? node.nodeValue.length : to);
        range.setStart(node, from || 0);
        return range
    };
    var isEquivalentPosition = function(node, off, targetNode, targetOff) {
        return targetNode && (scanFor(node, off, targetNode, targetOff, -1) || scanFor(node, off, targetNode, targetOff, 1))
    };
    var atomElements = /^(img|br|input|textarea|hr)$/i;
    function scanFor(node, off, targetNode, targetOff, dir) {
        for (; ; ) {
            if (node == targetNode && off == targetOff) {
                return true
            }
            if (off == (dir < 0 ? 0 : nodeSize(node))) {
                var parent = node.parentNode;
                if (parent.nodeType != 1 || hasBlockDesc(node) || atomElements.test(node.nodeName) || node.contentEditable == "false") {
                    return false
                }
                off = domIndex(node) + (dir < 0 ? 0 : 1);
                node = parent
            } else if (node.nodeType == 1) {
                node = node.childNodes[off + (dir < 0 ? -1 : 0)];
                if (node.contentEditable == "false") {
                    return false
                }
                off = dir < 0 ? nodeSize(node) : 0
            } else {
                return false
            }
        }
    }
    function nodeSize(node) {
        return node.nodeType == 3 ? node.nodeValue.length : node.childNodes.length
    }
    function isOnEdge(node, offset, parent) {
        for (var atStart = offset == 0, atEnd = offset == nodeSize(node); atStart || atEnd; ) {
            if (node == parent) {
                return true
            }
            var index = domIndex(node);
            node = node.parentNode;
            if (!node) {
                return false
            }
            atStart = atStart && index == 0;
            atEnd = atEnd && index == nodeSize(node)
        }
    }
    function hasBlockDesc(dom) {
        var desc;
        for (var cur = dom; cur; cur = cur.parentNode) {
            if (desc = cur.pmViewDesc) {
                break
            }
        }
        return desc && desc.node && desc.node.isBlock && (desc.dom == dom || desc.contentDOM == dom)
    }
    var selectionCollapsed = function(domSel) {
        var collapsed = domSel.isCollapsed;
        if (collapsed && result.chrome && domSel.rangeCount && !domSel.getRangeAt(0).collapsed) {
            collapsed = false
        }
        return collapsed
    };
    function keyEvent(keyCode, key) {
        var event = document.createEvent("Event");
        event.initEvent("keydown", true, true);
        event.keyCode = keyCode;
        event.key = event.code = key;
        return event
    }
    function windowRect(win) {
        return {
            left: 0,
            right: win.innerWidth,
            top: 0,
            bottom: win.innerHeight
        }
    }
    function getSide(value, side) {
        return typeof value == "number" ? value : value[side]
    }
    function scrollRectIntoView(view, rect, startDOM) {
        var scrollThreshold = view.someProp("scrollThreshold") || 0
            , scrollMargin = view.someProp("scrollMargin") || 5;
        var doc = view.dom.ownerDocument
            , win = doc.defaultView;
        for (var parent = startDOM || view.dom; ; parent = parentNode(parent)) {
            if (!parent) {
                break
            }
            if (parent.nodeType != 1) {
                continue
            }
            var atTop = parent == doc.body || parent.nodeType != 1;
            var bounding = atTop ? windowRect(win) : parent.getBoundingClientRect();
            var moveX = 0
                , moveY = 0;
            if (rect.top < bounding.top + getSide(scrollThreshold, "top")) {
                moveY = -(bounding.top - rect.top + getSide(scrollMargin, "top"))
            } else if (rect.bottom > bounding.bottom - getSide(scrollThreshold, "bottom")) {
                moveY = rect.bottom - bounding.bottom + getSide(scrollMargin, "bottom")
            }
            if (rect.left < bounding.left + getSide(scrollThreshold, "left")) {
                moveX = -(bounding.left - rect.left + getSide(scrollMargin, "left"))
            } else if (rect.right > bounding.right - getSide(scrollThreshold, "right")) {
                moveX = rect.right - bounding.right + getSide(scrollMargin, "right")
            }
            if (moveX || moveY) {
                if (atTop) {
                    win.scrollBy(moveX, moveY)
                } else {
                    var startX = parent.scrollLeft
                        , startY = parent.scrollTop;
                    if (moveY) {
                        parent.scrollTop += moveY
                    }
                    if (moveX) {
                        parent.scrollLeft += moveX
                    }
                    var dX = parent.scrollLeft - startX
                        , dY = parent.scrollTop - startY;
                    rect = {
                        left: rect.left - dX,
                        top: rect.top - dY,
                        right: rect.right - dX,
                        bottom: rect.bottom - dY
                    }
                }
            }
            if (atTop) {
                break
            }
        }
    }
    function storeScrollPos(view) {
        var rect = view.dom.getBoundingClientRect()
            , startY = Math.max(0, rect.top);
        var refDOM, refTop;
        for (var x = (rect.left + rect.right) / 2, y = startY + 1; y < Math.min(innerHeight, rect.bottom); y += 5) {
            var dom = view.root.elementFromPoint(x, y);
            if (dom == view.dom || !view.dom.contains(dom)) {
                continue
            }
            var localRect = dom.getBoundingClientRect();
            if (localRect.top >= startY - 20) {
                refDOM = dom;
                refTop = localRect.top;
                break
            }
        }
        return {
            refDOM: refDOM,
            refTop: refTop,
            stack: scrollStack(view.dom)
        }
    }
    function scrollStack(dom) {
        var stack = []
            , doc = dom.ownerDocument;
        for (; dom; dom = parentNode(dom)) {
            stack.push({
                dom: dom,
                top: dom.scrollTop,
                left: dom.scrollLeft
            });
            if (dom == doc) {
                break
            }
        }
        return stack
    }
    function resetScrollPos(ref) {
        var refDOM = ref.refDOM;
        var refTop = ref.refTop;
        var stack = ref.stack;
        var newRefTop = refDOM ? refDOM.getBoundingClientRect().top : 0;
        restoreScrollStack(stack, newRefTop == 0 ? 0 : newRefTop - refTop)
    }
    function restoreScrollStack(stack, dTop) {
        for (var i = 0; i < stack.length; i++) {
            var ref = stack[i];
            var dom = ref.dom;
            var top = ref.top;
            var left = ref.left;
            if (dom.scrollTop != top + dTop) {
                dom.scrollTop = top + dTop
            }
            if (dom.scrollLeft != left) {
                dom.scrollLeft = left
            }
        }
    }
    var preventScrollSupported = null;
    function focusPreventScroll(dom) {
        if (dom.setActive) {
            return dom.setActive()
        }
        if (preventScrollSupported) {
            return dom.focus(preventScrollSupported)
        }
        var stored = scrollStack(dom);
        dom.focus(preventScrollSupported == null ? {
            get preventScroll() {
                preventScrollSupported = {
                    preventScroll: true
                };
                return true
            }
        } : undefined);
        if (!preventScrollSupported) {
            preventScrollSupported = false;
            restoreScrollStack(stored, 0)
        }
    }
    function findOffsetInNode(node, coords) {
        var closest, dxClosest = 2e8, coordsClosest, offset = 0;
        var rowBot = coords.top
            , rowTop = coords.top;
        for (var child = node.firstChild, childIndex = 0; child; child = child.nextSibling,
            childIndex++) {
            var rects = void 0;
            if (child.nodeType == 1) {
                rects = child.getClientRects()
            } else if (child.nodeType == 3) {
                rects = textRange(child).getClientRects()
            } else {
                continue
            }
            for (var i = 0; i < rects.length; i++) {
                var rect = rects[i];
                if (rect.top <= rowBot && rect.bottom >= rowTop) {
                    rowBot = Math.max(rect.bottom, rowBot);
                    rowTop = Math.min(rect.top, rowTop);
                    var dx = rect.left > coords.left ? rect.left - coords.left : rect.right < coords.left ? coords.left - rect.right : 0;
                    if (dx < dxClosest) {
                        closest = child;
                        dxClosest = dx;
                        coordsClosest = dx && closest.nodeType == 3 ? {
                            left: rect.right < coords.left ? rect.right : rect.left,
                            top: coords.top
                        } : coords;
                        if (child.nodeType == 1 && dx) {
                            offset = childIndex + (coords.left >= (rect.left + rect.right) / 2 ? 1 : 0)
                        }
                        continue
                    }
                }
                if (!closest && (coords.left >= rect.right && coords.top >= rect.top || coords.left >= rect.left && coords.top >= rect.bottom)) {
                    offset = childIndex + 1
                }
            }
        }
        if (closest && closest.nodeType == 3) {
            return findOffsetInText(closest, coordsClosest)
        }
        if (!closest || dxClosest && closest.nodeType == 1) {
            return {
                node: node,
                offset: offset
            }
        }
        return findOffsetInNode(closest, coordsClosest)
    }
    function findOffsetInText(node, coords) {
        var len = node.nodeValue.length;
        var range = document.createRange();
        for (var i = 0; i < len; i++) {
            range.setEnd(node, i + 1);
            range.setStart(node, i);
            var rect = singleRect(range, 1);
            if (rect.top == rect.bottom) {
                continue
            }
            if (inRect(coords, rect)) {
                return {
                    node: node,
                    offset: i + (coords.left >= (rect.left + rect.right) / 2 ? 1 : 0)
                }
            }
        }
        return {
            node: node,
            offset: 0
        }
    }
    function inRect(coords, rect) {
        return coords.left >= rect.left - 1 && coords.left <= rect.right + 1 && coords.top >= rect.top - 1 && coords.top <= rect.bottom + 1
    }
    function targetKludge(dom, coords) {
        var parent = dom.parentNode;
        if (parent && /^li$/i.test(parent.nodeName) && coords.left < dom.getBoundingClientRect().left) {
            return parent
        }
        return dom
    }
    function posFromElement(view, elt, coords) {
        var ref = findOffsetInNode(elt, coords);
        var node = ref.node;
        var offset = ref.offset;
        var bias = -1;
        if (node.nodeType == 1 && !node.firstChild) {
            var rect = node.getBoundingClientRect();
            bias = rect.left != rect.right && coords.left > (rect.left + rect.right) / 2 ? 1 : -1
        }
        return view.docView.posFromDOM(node, offset, bias)
    }
    function posFromCaret(view, node, offset, coords) {
        var outside = -1;
        for (var cur = node; ; ) {
            if (cur == view.dom) {
                break
            }
            var desc = view.docView.nearestDesc(cur, true);
            if (!desc) {
                return null
            }
            if (desc.node.isBlock && desc.parent) {
                var rect = desc.dom.getBoundingClientRect();
                if (rect.left > coords.left || rect.top > coords.top) {
                    outside = desc.posBefore
                } else if (rect.right < coords.left || rect.bottom < coords.top) {
                    outside = desc.posAfter
                } else {
                    break
                }
            }
            cur = desc.dom.parentNode
        }
        return outside > -1 ? outside : view.docView.posFromDOM(node, offset)
    }
    function elementFromPoint(element, coords, box) {
        var len = element.childNodes.length;
        if (len && box.top < box.bottom) {
            for (var startI = Math.max(0, Math.min(len - 1, Math.floor(len * (coords.top - box.top) / (box.bottom - box.top)) - 2)), i = startI; ; ) {
                var child = element.childNodes[i];
                if (child.nodeType == 1) {
                    var rects = child.getClientRects();
                    for (var j = 0; j < rects.length; j++) {
                        var rect = rects[j];
                        if (inRect(coords, rect)) {
                            return elementFromPoint(child, coords, rect)
                        }
                    }
                }
                if ((i = (i + 1) % len) == startI) {
                    break
                }
            }
        }
        return element
    }
    function posAtCoords(view, coords) {
        var assign, assign$1;
        var root = view.root, node, offset;
        if (root.caretPositionFromPoint) {
            try {
                var pos$1 = root.caretPositionFromPoint(coords.left, coords.top);
                if (pos$1) {
                    assign = pos$1,
                        node = assign.offsetNode,
                        offset = assign.offset
                }
            } catch (_) {}
        }
        if (!node && root.caretRangeFromPoint) {
            var range = root.caretRangeFromPoint(coords.left, coords.top);
            if (range) {
                assign$1 = range,
                    node = assign$1.startContainer,
                    offset = assign$1.startOffset
            }
        }
        var elt = root.elementFromPoint(coords.left, coords.top + 1), pos;
        if (!elt || !view.dom.contains(elt.nodeType != 1 ? elt.parentNode : elt)) {
            var box = view.dom.getBoundingClientRect();
            if (!inRect(coords, box)) {
                return null
            }
            elt = elementFromPoint(view.dom, coords, box);
            if (!elt) {
                return null
            }
        }
        elt = targetKludge(elt, coords);
        if (node) {
            if (result.gecko && node.nodeType == 1) {
                offset = Math.min(offset, node.childNodes.length);
                if (offset < node.childNodes.length) {
                    var next = node.childNodes[offset], box$1;
                    if (next.nodeName == "IMG" && (box$1 = next.getBoundingClientRect()).right <= coords.left && box$1.bottom > coords.top) {
                        offset++
                    }
                }
            }
            if (node == view.dom && offset == node.childNodes.length - 1 && node.lastChild.nodeType == 1 && coords.top > node.lastChild.getBoundingClientRect().bottom) {
                pos = view.state.doc.content.size
            } else if (offset == 0 || node.nodeType != 1 || node.childNodes[offset - 1].nodeName != "BR") {
                pos = posFromCaret(view, node, offset, coords)
            }
        }
        if (pos == null) {
            pos = posFromElement(view, elt, coords)
        }
        var desc = view.docView.nearestDesc(elt, true);
        return {
            pos: pos,
            inside: desc ? desc.posAtStart - desc.border : -1
        }
    }
    function singleRect(object, bias) {
        var rects = object.getClientRects();
        return !rects.length ? object.getBoundingClientRect() : rects[bias < 0 ? 0 : rects.length - 1]
    }
    function coordsAtPos(view, pos) {
        var ref = view.docView.domFromPos(pos);
        var node = ref.node;
        var offset = ref.offset;
        if (node.nodeType == 3 && (result.webkit || result.gecko)) {
            var rect = singleRect(textRange(node, offset, offset), 0);
            if (result.gecko && offset && /\s/.test(node.nodeValue[offset - 1]) && offset < node.nodeValue.length) {
                var rectBefore = singleRect(textRange(node, offset - 1, offset - 1), -1);
                if (rectBefore.top == rect.top) {
                    var rectAfter = singleRect(textRange(node, offset, offset + 1), -1);
                    if (rectAfter.top != rect.top) {
                        return flattenV(rectAfter, rectAfter.left < rectBefore.left)
                    }
                }
            }
            return rect
        }
        if (node.nodeType == 1 && !view.state.doc.resolve(pos).parent.inlineContent) {
            var top = true, rect$1;
            if (offset < node.childNodes.length) {
                var after = node.childNodes[offset];
                if (after.nodeType == 1) {
                    rect$1 = after.getBoundingClientRect()
                }
            }
            if (!rect$1 && offset) {
                var before = node.childNodes[offset - 1];
                if (before.nodeType == 1) {
                    rect$1 = before.getBoundingClientRect();
                    top = false
                }
            }
            return flattenH(rect$1 || node.getBoundingClientRect(), top)
        }
        for (var dir = -1; dir < 2; dir += 2) {
            if (dir < 0 && offset) {
                var prev = void 0
                    , target = node.nodeType == 3 ? textRange(node, offset - 1, offset) : (prev = node.childNodes[offset - 1]).nodeType == 3 ? textRange(prev) : prev.nodeType == 1 && prev.nodeName != "BR" ? prev : null;
                if (target) {
                    var rect$2 = singleRect(target, 1);
                    if (rect$2.top < rect$2.bottom) {
                        return flattenV(rect$2, false)
                    }
                }
            } else if (dir > 0 && offset < nodeSize(node)) {
                var next = void 0
                    , target$1 = node.nodeType == 3 ? textRange(node, offset, offset + 1) : (next = node.childNodes[offset]).nodeType == 3 ? textRange(next) : next.nodeType == 1 ? next : null;
                if (target$1) {
                    var rect$3 = singleRect(target$1, -1);
                    if (rect$3.top < rect$3.bottom) {
                        return flattenV(rect$3, true)
                    }
                }
            }
        }
        return flattenV(singleRect(node.nodeType == 3 ? textRange(node) : node, 0), false)
    }
    function flattenV(rect, left) {
        if (rect.width == 0) {
            return rect
        }
        var x = left ? rect.left : rect.right;
        return {
            top: rect.top,
            bottom: rect.bottom,
            left: x,
            right: x
        }
    }
    function flattenH(rect, top) {
        if (rect.height == 0) {
            return rect
        }
        var y = top ? rect.top : rect.bottom;
        return {
            top: y,
            bottom: y,
            left: rect.left,
            right: rect.right
        }
    }
    function withFlushedState(view, state, f) {
        var viewState = view.state
            , active = view.root.activeElement;
        if (viewState != state) {
            view.updateState(state)
        }
        if (active != view.dom) {
            view.focus()
        }
        try {
            return f()
        } finally {
            if (viewState != state) {
                view.updateState(viewState)
            }
            if (active != view.dom) {
                active.focus()
            }
        }
    }
    function endOfTextblockVertical(view, state, dir) {
        var sel = state.selection;
        var $pos = dir == "up" ? sel.$anchor.min(sel.$head) : sel.$anchor.max(sel.$head);
        return withFlushedState(view, state, function() {
            var ref = view.docView.domFromPos($pos.pos);
            var dom = ref.node;
            for (; ; ) {
                var nearest = view.docView.nearestDesc(dom, true);
                if (!nearest) {
                    break
                }
                if (nearest.node.isBlock) {
                    dom = nearest.dom;
                    break
                }
                dom = nearest.dom.parentNode
            }
            var coords = coordsAtPos(view, $pos.pos);
            for (var child = dom.firstChild; child; child = child.nextSibling) {
                var boxes = void 0;
                if (child.nodeType == 1) {
                    boxes = child.getClientRects()
                } else if (child.nodeType == 3) {
                    boxes = textRange(child, 0, child.nodeValue.length).getClientRects()
                } else {
                    continue
                }
                for (var i = 0; i < boxes.length; i++) {
                    var box = boxes[i];
                    if (box.bottom > box.top && (dir == "up" ? box.bottom < coords.top + 1 : box.top > coords.bottom - 1)) {
                        return false
                    }
                }
            }
            return true
        })
    }
    var maybeRTL = /[\u0590-\u08ac]/;
    function endOfTextblockHorizontal(view, state, dir) {
        var ref = state.selection;
        var $head = ref.$head;
        if (!$head.parent.isTextblock) {
            return false
        }
        var offset = $head.parentOffset
            , atStart = !offset
            , atEnd = offset == $head.parent.content.size;
        var sel = getSelection();
        if (!maybeRTL.test($head.parent.textContent) || !sel.modify) {
            return dir == "left" || dir == "backward" ? atStart : atEnd
        }
        return withFlushedState(view, state, function() {
            var oldRange = sel.getRangeAt(0)
                , oldNode = sel.focusNode
                , oldOff = sel.focusOffset;
            var oldBidiLevel = sel.caretBidiLevel;
            sel.modify("move", dir, "character");
            var parentDOM = $head.depth ? view.docView.domAfterPos($head.before()) : view.dom;
            var result = !parentDOM.contains(sel.focusNode.nodeType == 1 ? sel.focusNode : sel.focusNode.parentNode) || oldNode == sel.focusNode && oldOff == sel.focusOffset;
            sel.removeAllRanges();
            sel.addRange(oldRange);
            if (oldBidiLevel != null) {
                sel.caretBidiLevel = oldBidiLevel
            }
            return result
        })
    }
    var cachedState = null
        , cachedDir = null
        , cachedResult = false;
    function endOfTextblock(view, state, dir) {
        if (cachedState == state && cachedDir == dir) {
            return cachedResult
        }
        cachedState = state;
        cachedDir = dir;
        return cachedResult = dir == "up" || dir == "down" ? endOfTextblockVertical(view, state, dir) : endOfTextblockHorizontal(view, state, dir)
    }
    var NOT_DIRTY = 0
        , CHILD_DIRTY = 1
        , CONTENT_DIRTY = 2
        , NODE_DIRTY = 3;
    var ViewDesc = function ViewDesc(parent, children, dom, contentDOM) {
        this.parent = parent;
        this.children = children;
        this.dom = dom;
        dom.pmViewDesc = this;
        this.contentDOM = contentDOM;
        this.dirty = NOT_DIRTY
    };
    var prototypeAccessors = {
        beforePosition: {
            configurable: true
        },
        size: {
            configurable: true
        },
        border: {
            configurable: true
        },
        posBefore: {
            configurable: true
        },
        posAtStart: {
            configurable: true
        },
        posAfter: {
            configurable: true
        },
        posAtEnd: {
            configurable: true
        },
        contentLost: {
            configurable: true
        }
    };
    ViewDesc.prototype.matchesWidget = function matchesWidget() {
        return false
    }
    ;
    ViewDesc.prototype.matchesMark = function matchesMark() {
        return false
    }
    ;
    ViewDesc.prototype.matchesNode = function matchesNode() {
        return false
    }
    ;
    ViewDesc.prototype.matchesHack = function matchesHack() {
        return false
    }
    ;
    prototypeAccessors.beforePosition.get = function() {
        return false
    }
    ;
    ViewDesc.prototype.parseRule = function parseRule() {
        return null
    }
    ;
    ViewDesc.prototype.stopEvent = function stopEvent() {
        return false
    }
    ;
    prototypeAccessors.size.get = function() {
        var size = 0;
        for (var i = 0; i < this.children.length; i++) {
            size += this.children[i].size
        }
        return size
    }
    ;
    prototypeAccessors.border.get = function() {
        return 0
    }
    ;
    ViewDesc.prototype.destroy = function destroy() {
        this.parent = null;
        if (this.dom.pmViewDesc == this) {
            this.dom.pmViewDesc = null
        }
        for (var i = 0; i < this.children.length; i++) {
            this.children[i].destroy()
        }
    }
    ;
    ViewDesc.prototype.posBeforeChild = function posBeforeChild(child) {
        for (var i = 0, pos = this.posAtStart; i < this.children.length; i++) {
            var cur = this.children[i];
            if (cur == child) {
                return pos
            }
            pos += cur.size
        }
    }
    ;
    prototypeAccessors.posBefore.get = function() {
        return this.parent.posBeforeChild(this)
    }
    ;
    prototypeAccessors.posAtStart.get = function() {
        return this.parent ? this.parent.posBeforeChild(this) + this.border : 0
    }
    ;
    prototypeAccessors.posAfter.get = function() {
        return this.posBefore + this.size
    }
    ;
    prototypeAccessors.posAtEnd.get = function() {
        return this.posAtStart + this.size - 2 * this.border
    }
    ;
    ViewDesc.prototype.localPosFromDOM = function localPosFromDOM(dom, offset, bias) {
        if (this.contentDOM && this.contentDOM.contains(dom.nodeType == 1 ? dom : dom.parentNode)) {
            if (bias < 0) {
                var domBefore, desc;
                if (dom == this.contentDOM) {
                    domBefore = dom.childNodes[offset - 1]
                } else {
                    while (dom.parentNode != this.contentDOM) {
                        dom = dom.parentNode
                    }
                    domBefore = dom.previousSibling
                }
                while (domBefore && !((desc = domBefore.pmViewDesc) && desc.parent == this)) {
                    domBefore = domBefore.previousSibling
                }
                return domBefore ? this.posBeforeChild(desc) + desc.size : this.posAtStart
            } else {
                var domAfter, desc$1;
                if (dom == this.contentDOM) {
                    domAfter = dom.childNodes[offset]
                } else {
                    while (dom.parentNode != this.contentDOM) {
                        dom = dom.parentNode
                    }
                    domAfter = dom.nextSibling
                }
                while (domAfter && !((desc$1 = domAfter.pmViewDesc) && desc$1.parent == this)) {
                    domAfter = domAfter.nextSibling
                }
                return domAfter ? this.posBeforeChild(desc$1) : this.posAtEnd
            }
        }
        var atEnd;
        if (this.contentDOM && this.contentDOM != this.dom && this.dom.contains(this.contentDOM)) {
            atEnd = dom.compareDocumentPosition(this.contentDOM) & 2
        } else if (this.dom.firstChild) {
            if (offset == 0) {
                for (var search = dom; ; search = search.parentNode) {
                    if (search == this.dom) {
                        atEnd = false;
                        break
                    }
                    if (search.parentNode.firstChild != search) {
                        break
                    }
                }
            }
            if (atEnd == null && offset == dom.childNodes.length) {
                for (var search$1 = dom; ; search$1 = search$1.parentNode) {
                    if (search$1 == this.dom) {
                        atEnd = true;
                        break
                    }
                    if (search$1.parentNode.lastChild != search$1) {
                        break
                    }
                }
            }
        }
        return (atEnd == null ? bias > 0 : atEnd) ? this.posAtEnd : this.posAtStart
    }
    ;
    ViewDesc.prototype.nearestDesc = function nearestDesc(dom, onlyNodes) {
        for (var first = true, cur = dom; cur; cur = cur.parentNode) {
            var desc = this.getDesc(cur);
            if (desc && (!onlyNodes || desc.node)) {
                if (first && desc.nodeDOM && !(desc.nodeDOM.nodeType == 1 ? desc.nodeDOM.contains(dom.nodeType == 1 ? dom : dom.parentNode) : desc.nodeDOM == dom)) {
                    first = false
                } else {
                    return desc
                }
            }
        }
    }
    ;
    ViewDesc.prototype.getDesc = function getDesc(dom) {
        var desc = dom.pmViewDesc;
        for (var cur = desc; cur; cur = cur.parent) {
            if (cur == this) {
                return desc
            }
        }
    }
    ;
    ViewDesc.prototype.posFromDOM = function posFromDOM(dom, offset, bias) {
        for (var scan = dom; ; scan = scan.parentNode) {
            var desc = this.getDesc(scan);
            if (desc) {
                return desc.localPosFromDOM(dom, offset, bias)
            }
        }
    }
    ;
    ViewDesc.prototype.descAt = function descAt(pos) {
        for (var i = 0, offset = 0; i < this.children.length; i++) {
            var child = this.children[i]
                , end = offset + child.size;
            if (offset == pos && end != offset) {
                while (!child.border && child.children.length) {
                    child = child.children[0]
                }
                return child
            }
            if (pos < end) {
                return child.descAt(pos - offset - child.border)
            }
            offset = end
        }
    }
    ;
    ViewDesc.prototype.domFromPos = function domFromPos(pos) {
        if (!this.contentDOM) {
            return {
                node: this.dom,
                offset: 0
            }
        }
        for (var offset = 0, i = 0; ; i++) {
            if (offset == pos) {
                while (i < this.children.length && (this.children[i].beforePosition || this.children[i].dom.parentNode != this.contentDOM)) {
                    i++
                }
                return {
                    node: this.contentDOM,
                    offset: i == this.children.length ? this.contentDOM.childNodes.length : domIndex(this.children[i].dom)
                }
            }
            if (i == this.children.length) {
                throw new Error("Invalid position " + pos)
            }
            var child = this.children[i]
                , end = offset + child.size;
            if (pos < end) {
                return child.domFromPos(pos - offset - child.border)
            }
            offset = end
        }
    }
    ;
    ViewDesc.prototype.parseRange = function parseRange(from, to, base) {
        if (base === void 0)
            base = 0;
        if (this.children.length == 0) {
            return {
                node: this.contentDOM,
                from: from,
                to: to,
                fromOffset: 0,
                toOffset: this.contentDOM.childNodes.length
            }
        }
        var fromOffset = -1
            , toOffset = -1;
        for (var offset = base, i = 0; ; i++) {
            var child = this.children[i]
                , end = offset + child.size;
            if (fromOffset == -1 && from <= end) {
                var childBase = offset + child.border;
                if (from >= childBase && to <= end - child.border && child.node && child.contentDOM && this.contentDOM.contains(child.contentDOM)) {
                    return child.parseRange(from, to, childBase)
                }
                from = offset;
                for (var j = i; j > 0; j--) {
                    var prev = this.children[j - 1];
                    if (prev.size && prev.dom.parentNode == this.contentDOM && !prev.emptyChildAt(1)) {
                        fromOffset = domIndex(prev.dom) + 1;
                        break
                    }
                    from -= prev.size
                }
                if (fromOffset == -1) {
                    fromOffset = 0
                }
            }
            if (fromOffset > -1 && to <= end) {
                to = end;
                for (var j$1 = i + 1; j$1 < this.children.length; j$1++) {
                    var next = this.children[j$1];
                    if (next.size && next.dom.parentNode == this.contentDOM && !next.emptyChildAt(-1)) {
                        toOffset = domIndex(next.dom);
                        break
                    }
                    to += next.size
                }
                if (toOffset == -1) {
                    toOffset = this.contentDOM.childNodes.length
                }
                break
            }
            offset = end
        }
        return {
            node: this.contentDOM,
            from: from,
            to: to,
            fromOffset: fromOffset,
            toOffset: toOffset
        }
    }
    ;
    ViewDesc.prototype.emptyChildAt = function emptyChildAt(side) {
        if (this.border || !this.contentDOM || !this.children.length) {
            return false
        }
        var child = this.children[side < 0 ? 0 : this.children.length - 1];
        return child.size == 0 || child.emptyChildAt(side)
    }
    ;
    ViewDesc.prototype.domAfterPos = function domAfterPos(pos) {
        var ref = this.domFromPos(pos);
        var node = ref.node;
        var offset = ref.offset;
        if (node.nodeType != 1 || offset == node.childNodes.length) {
            throw new RangeError("No node after pos " + pos)
        }
        return node.childNodes[offset]
    }
    ;
    ViewDesc.prototype.setSelection = function setSelection(anchor, head, root, force) {
        var from = Math.min(anchor, head)
            , to = Math.max(anchor, head);
        for (var i = 0, offset = 0; i < this.children.length; i++) {
            var child = this.children[i]
                , end = offset + child.size;
            if (from > offset && to < end) {
                return child.setSelection(anchor - offset - child.border, head - offset - child.border, root, force)
            }
            offset = end
        }
        var anchorDOM = this.domFromPos(anchor)
            , headDOM = this.domFromPos(head);
        var domSel = root.getSelection();
        if (!force && isEquivalentPosition(anchorDOM.node, anchorDOM.offset, domSel.anchorNode, domSel.anchorOffset) && isEquivalentPosition(headDOM.node, headDOM.offset, domSel.focusNode, domSel.focusOffset)) {
            return
        }
        var domSelExtended = false;
        if (domSel.extend || anchor == head) {
            domSel.collapse(anchorDOM.node, anchorDOM.offset);
            try {
                if (anchor != head) {
                    domSel.extend(headDOM.node, headDOM.offset)
                }
                domSelExtended = true
            } catch (err) {
                if (!(err instanceof DOMException)) {
                    throw err
                }
            }
        }
        if (!domSelExtended) {
            if (anchor > head) {
                var tmp = anchorDOM;
                anchorDOM = headDOM;
                headDOM = tmp
            }
            var range = document.createRange();
            range.setEnd(headDOM.node, headDOM.offset);
            range.setStart(anchorDOM.node, anchorDOM.offset);
            domSel.removeAllRanges();
            domSel.addRange(range)
        }
    }
    ;
    ViewDesc.prototype.ignoreMutation = function ignoreMutation(mutation) {
        return !this.contentDOM && mutation.type != "selection"
    }
    ;
    prototypeAccessors.contentLost.get = function() {
        return this.contentDOM && this.contentDOM != this.dom && !this.dom.contains(this.contentDOM)
    }
    ;
    ViewDesc.prototype.markDirty = function markDirty(from, to) {
        for (var offset = 0, i = 0; i < this.children.length; i++) {
            var child = this.children[i]
                , end = offset + child.size;
            if (offset == end ? from <= end && to >= offset : from < end && to > offset) {
                var startInside = offset + child.border
                    , endInside = end - child.border;
                if (from >= startInside && to <= endInside) {
                    this.dirty = from == offset || to == end ? CONTENT_DIRTY : CHILD_DIRTY;
                    if (from == startInside && to == endInside && (child.contentLost || child.dom.parentNode != this.contentDOM)) {
                        child.dirty = NODE_DIRTY
                    } else {
                        child.markDirty(from - startInside, to - startInside)
                    }
                    return
                } else {
                    child.dirty = NODE_DIRTY
                }
            }
            offset = end
        }
        this.dirty = CONTENT_DIRTY
    }
    ;
    ViewDesc.prototype.markParentsDirty = function markParentsDirty() {
        var level = 1;
        for (var node = this.parent; node; node = node.parent,
            level++) {
            var dirty = level == 1 ? CONTENT_DIRTY : CHILD_DIRTY;
            if (node.dirty < dirty) {
                node.dirty = dirty
            }
        }
    }
    ;
    Object.defineProperties(ViewDesc.prototype, prototypeAccessors);
    var nothing = [];
    var WidgetViewDesc = function(ViewDesc) {
        function WidgetViewDesc(parent, widget, view, pos) {
            var self, dom = widget.type.toDOM;
            if (typeof dom == "function") {
                dom = dom(view, function() {
                    if (!self) {
                        return pos
                    }
                    if (self.parent) {
                        return self.parent.posBeforeChild(self)
                    }
                })
            }
            if (!widget.type.spec.raw) {
                if (dom.nodeType != 1) {
                    var wrap = document.createElement("span");
                    wrap.appendChild(dom);
                    dom = wrap
                }
                dom.contentEditable = false;
                dom.classList.add("ProseMirror-widget")
            }
            ViewDesc.call(this, parent, nothing, dom, null);
            this.widget = widget;
            self = this
        }
        if (ViewDesc)
            WidgetViewDesc.__proto__ = ViewDesc;
        WidgetViewDesc.prototype = Object.create(ViewDesc && ViewDesc.prototype);
        WidgetViewDesc.prototype.constructor = WidgetViewDesc;
        var prototypeAccessors$1 = {
            beforePosition: {
                configurable: true
            }
        };
        prototypeAccessors$1.beforePosition.get = function() {
            return this.widget.type.side < 0
        }
        ;
        WidgetViewDesc.prototype.matchesWidget = function matchesWidget(widget) {
            return this.dirty == NOT_DIRTY && widget.type.eq(this.widget.type)
        }
        ;
        WidgetViewDesc.prototype.parseRule = function parseRule() {
            return {
                ignore: true
            }
        }
        ;
        WidgetViewDesc.prototype.stopEvent = function stopEvent(event) {
            var stop = this.widget.spec.stopEvent;
            return stop ? stop(event) : false
        }
        ;
        WidgetViewDesc.prototype.ignoreMutation = function ignoreMutation(mutation) {
            return mutation.type != "selection" || this.widget.spec.ignoreSelection
        }
        ;
        Object.defineProperties(WidgetViewDesc.prototype, prototypeAccessors$1);
        return WidgetViewDesc
    }(ViewDesc);
    var CompositionViewDesc = function(ViewDesc) {
        function CompositionViewDesc(parent, dom, textDOM, text) {
            ViewDesc.call(this, parent, nothing, dom, null);
            this.textDOM = textDOM;
            this.text = text
        }
        if (ViewDesc)
            CompositionViewDesc.__proto__ = ViewDesc;
        CompositionViewDesc.prototype = Object.create(ViewDesc && ViewDesc.prototype);
        CompositionViewDesc.prototype.constructor = CompositionViewDesc;
        var prototypeAccessors$2 = {
            size: {
                configurable: true
            }
        };
        prototypeAccessors$2.size.get = function() {
            return this.text.length
        }
        ;
        CompositionViewDesc.prototype.localPosFromDOM = function localPosFromDOM(dom, offset) {
            if (dom != this.textDOM) {
                return this.posAtStart + (offset ? this.size : 0)
            }
            return this.posAtStart + offset
        }
        ;
        CompositionViewDesc.prototype.domFromPos = function domFromPos(pos) {
            return {
                node: this.textDOM,
                offset: pos
            }
        }
        ;
        CompositionViewDesc.prototype.ignoreMutation = function ignoreMutation(mut) {
            return mut.type === "characterData" && mut.target.nodeValue == mut.oldValue
        }
        ;
        Object.defineProperties(CompositionViewDesc.prototype, prototypeAccessors$2);
        return CompositionViewDesc
    }(ViewDesc);
    var MarkViewDesc = function(ViewDesc) {
        function MarkViewDesc(parent, mark, dom, contentDOM) {
            ViewDesc.call(this, parent, [], dom, contentDOM);
            this.mark = mark
        }
        if (ViewDesc)
            MarkViewDesc.__proto__ = ViewDesc;
        MarkViewDesc.prototype = Object.create(ViewDesc && ViewDesc.prototype);
        MarkViewDesc.prototype.constructor = MarkViewDesc;
        MarkViewDesc.create = function create(parent, mark, inline, view) {
            var custom = view.nodeViews[mark.type.name];
            var spec = custom && custom(mark, view, inline);
            if (!spec || !spec.dom) {
                spec = prosemirrorModel.DOMSerializer.renderSpec(document, mark.type.spec.toDOM(mark, inline))
            }
            return new MarkViewDesc(parent,mark,spec.dom,spec.contentDOM || spec.dom)
        }
        ;
        MarkViewDesc.prototype.parseRule = function parseRule() {
            return {
                mark: this.mark.type.name,
                attrs: this.mark.attrs,
                contentElement: this.contentDOM
            }
        }
        ;
        MarkViewDesc.prototype.matchesMark = function matchesMark(mark) {
            return this.dirty != NODE_DIRTY && this.mark.eq(mark)
        }
        ;
        MarkViewDesc.prototype.markDirty = function markDirty(from, to) {
            ViewDesc.prototype.markDirty.call(this, from, to);
            if (this.dirty != NOT_DIRTY) {
                var parent = this.parent;
                while (!parent.node) {
                    parent = parent.parent
                }
                if (parent.dirty < this.dirty) {
                    parent.dirty = this.dirty
                }
                this.dirty = NOT_DIRTY
            }
        }
        ;
        MarkViewDesc.prototype.slice = function slice(from, to, view) {
            var copy = MarkViewDesc.create(this.parent, this.mark, true, view);
            var nodes = this.children
                , size = this.size;
            if (to < size) {
                nodes = replaceNodes(nodes, to, size, view)
            }
            if (from > 0) {
                nodes = replaceNodes(nodes, 0, from, view)
            }
            for (var i = 0; i < nodes.length; i++) {
                nodes[i].parent = copy
            }
            copy.children = nodes;
            return copy
        }
        ;
        return MarkViewDesc
    }(ViewDesc);
    var NodeViewDesc = function(ViewDesc) {
        function NodeViewDesc(parent, node, outerDeco, innerDeco, dom, contentDOM, nodeDOM, view, pos) {
            ViewDesc.call(this, parent, node.isLeaf ? nothing : [], dom, contentDOM);
            this.nodeDOM = nodeDOM;
            this.node = node;
            this.outerDeco = outerDeco;
            this.innerDeco = innerDeco;
            if (contentDOM) {
                this.updateChildren(view, pos)
            }
        }
        if (ViewDesc)
            NodeViewDesc.__proto__ = ViewDesc;
        NodeViewDesc.prototype = Object.create(ViewDesc && ViewDesc.prototype);
        NodeViewDesc.prototype.constructor = NodeViewDesc;
        var prototypeAccessors$3 = {
            size: {
                configurable: true
            },
            border: {
                configurable: true
            }
        };
        NodeViewDesc.create = function create(parent, node, outerDeco, innerDeco, view, pos) {
            var assign;
            var custom = view.nodeViews[node.type.name], descObj;
            var spec = custom && custom(node, view, function() {
                if (!descObj) {
                    return pos
                }
                if (descObj.parent) {
                    return descObj.parent.posBeforeChild(descObj)
                }
            }, outerDeco);
            var dom = spec && spec.dom
                , contentDOM = spec && spec.contentDOM;
            if (node.isText) {
                if (!dom) {
                    dom = document.createTextNode(node.text)
                } else if (dom.nodeType != 3) {
                    throw new RangeError("Text must be rendered as a DOM text node")
                }
            } else if (!dom) {
                assign = prosemirrorModel.DOMSerializer.renderSpec(document, node.type.spec.toDOM(node)),
                    dom = assign.dom,
                    contentDOM = assign.contentDOM
            }
            if (!contentDOM && !node.isText && dom.nodeName != "BR") {
                if (!dom.hasAttribute("contenteditable")) {
                    dom.contentEditable = false
                }
                if (node.type.spec.draggable) {
                    dom.draggable = true
                }
            }
            var nodeDOM = dom;
            dom = applyOuterDeco(dom, outerDeco, node);
            if (spec) {
                return descObj = new CustomNodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,spec,view,pos + 1)
            } else if (node.isText) {
                return new TextViewDesc(parent,node,outerDeco,innerDeco,dom,nodeDOM,view)
            } else {
                return new NodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,view,pos + 1)
            }
        }
        ;
        NodeViewDesc.prototype.parseRule = function parseRule() {
            var this$1 = this;
            if (this.node.type.spec.reparseInView) {
                return null
            }
            var rule = {
                node: this.node.type.name,
                attrs: this.node.attrs
            };
            if (this.node.type.spec.code) {
                rule.preserveWhitespace = "full"
            }
            if (this.contentDOM && !this.contentLost) {
                rule.contentElement = this.contentDOM
            } else {
                rule.getContent = function() {
                    return this$1.contentDOM ? prosemirrorModel.Fragment.empty : this$1.node.content
                }
            }
            return rule
        }
        ;
        NodeViewDesc.prototype.matchesNode = function matchesNode(node, outerDeco, innerDeco) {
            return this.dirty == NOT_DIRTY && node.eq(this.node) && sameOuterDeco(outerDeco, this.outerDeco) && innerDeco.eq(this.innerDeco)
        }
        ;
        prototypeAccessors$3.size.get = function() {
            return this.node.nodeSize
        }
        ;
        prototypeAccessors$3.border.get = function() {
            return this.node.isLeaf ? 0 : 1
        }
        ;
        NodeViewDesc.prototype.updateChildren = function updateChildren(view, pos) {
            var this$1 = this;
            var inline = this.node.inlineContent
                , off = pos;
            var composition = inline && view.composing && this.localCompositionNode(view, pos);
            var updater = new ViewTreeUpdater(this,composition && composition.node);
            iterDeco(this.node, this.innerDeco, function(widget, i, insideNode) {
                if (widget.spec.marks) {
                    updater.syncToMarks(widget.spec.marks, inline, view)
                } else if (widget.type.side >= 0 && !insideNode) {
                    updater.syncToMarks(i == this$1.node.childCount ? prosemirrorModel.Mark.none : this$1.node.child(i).marks, inline, view)
                }
                updater.placeWidget(widget, view, off)
            }, function(child, outerDeco, innerDeco, i) {
                updater.syncToMarks(child.marks, inline, view);
                updater.findNodeMatch(child, outerDeco, innerDeco, i) || updater.updateNextNode(child, outerDeco, innerDeco, view, i) || updater.addNode(child, outerDeco, innerDeco, view, off);
                off += child.nodeSize
            });
            updater.syncToMarks(nothing, inline, view);
            if (this.node.isTextblock) {
                updater.addTextblockHacks()
            }
            updater.destroyRest();
            if (updater.changed || this.dirty == CONTENT_DIRTY) {
                if (composition) {
                    this.protectLocalComposition(view, composition)
                }
                this.renderChildren()
            }
        }
        ;
        NodeViewDesc.prototype.renderChildren = function renderChildren() {
            renderDescs(this.contentDOM, this.children);
            if (result.ios) {
                iosHacks(this.dom)
            }
        }
        ;
        NodeViewDesc.prototype.localCompositionNode = function localCompositionNode(view, pos) {
            var ref = view.state.selection;
            var from = ref.from;
            var to = ref.to;
            if (!(view.state.selection instanceof prosemirrorState.TextSelection) || from < pos || to > pos + this.node.content.size) {
                return
            }
            var sel = view.root.getSelection();
            var textNode = nearbyTextNode(sel.focusNode, sel.focusOffset);
            if (!textNode || !this.dom.contains(textNode.parentNode)) {
                return
            }
            var text = textNode.nodeValue;
            var textPos = findTextInFragment(this.node.content, text, from - pos, to - pos);
            return textPos < 0 ? null : {
                node: textNode,
                pos: textPos,
                text: text
            }
        }
        ;
        NodeViewDesc.prototype.protectLocalComposition = function protectLocalComposition(view, ref) {
            var node = ref.node;
            var pos = ref.pos;
            var text = ref.text;
            if (this.getDesc(node)) {
                return
            }
            var topNode = node;
            for (; ; topNode = topNode.parentNode) {
                if (topNode.parentNode == this.contentDOM) {
                    break
                }
                while (topNode.previousSibling) {
                    topNode.parentNode.removeChild(topNode.previousSibling)
                }
                while (topNode.nextSibling) {
                    topNode.parentNode.removeChild(topNode.nextSibling)
                }
                if (topNode.pmViewDesc) {
                    topNode.pmViewDesc = null
                }
            }
            var desc = new CompositionViewDesc(this,topNode,node,text);
            view.compositionNodes.push(desc);
            this.children = replaceNodes(this.children, pos, pos + text.length, view, desc)
        }
        ;
        NodeViewDesc.prototype.update = function update(node, outerDeco, innerDeco, view) {
            if (this.dirty == NODE_DIRTY || !node.sameMarkup(this.node)) {
                return false
            }
            this.updateInner(node, outerDeco, innerDeco, view);
            return true
        }
        ;
        NodeViewDesc.prototype.updateInner = function updateInner(node, outerDeco, innerDeco, view) {
            this.updateOuterDeco(outerDeco);
            this.node = node;
            this.innerDeco = innerDeco;
            if (this.contentDOM) {
                this.updateChildren(view, this.posAtStart)
            }
            this.dirty = NOT_DIRTY
        }
        ;
        NodeViewDesc.prototype.updateOuterDeco = function updateOuterDeco(outerDeco) {
            if (sameOuterDeco(outerDeco, this.outerDeco)) {
                return
            }
            var needsWrap = this.nodeDOM.nodeType != 1;
            var oldDOM = this.dom;
            this.dom = patchOuterDeco(this.dom, this.nodeDOM, computeOuterDeco(this.outerDeco, this.node, needsWrap), computeOuterDeco(outerDeco, this.node, needsWrap));
            if (this.dom != oldDOM) {
                oldDOM.pmViewDesc = null;
                this.dom.pmViewDesc = this
            }
            this.outerDeco = outerDeco
        }
        ;
        NodeViewDesc.prototype.selectNode = function selectNode() {
            this.nodeDOM.classList.add("ProseMirror-selectednode");
            if (this.contentDOM || !this.node.type.spec.draggable) {
                this.dom.draggable = true
            }
        }
        ;
        NodeViewDesc.prototype.deselectNode = function deselectNode() {
            this.nodeDOM.classList.remove("ProseMirror-selectednode");
            if (this.contentDOM || !this.node.type.spec.draggable) {
                this.dom.removeAttribute("draggable")
            }
        }
        ;
        Object.defineProperties(NodeViewDesc.prototype, prototypeAccessors$3);
        return NodeViewDesc
    }(ViewDesc);
    function docViewDesc(doc, outerDeco, innerDeco, dom, view) {
        applyOuterDeco(dom, outerDeco, doc);
        return new NodeViewDesc(null,doc,outerDeco,innerDeco,dom,dom,dom,view,0)
    }
    var TextViewDesc = function(NodeViewDesc) {
        function TextViewDesc(parent, node, outerDeco, innerDeco, dom, nodeDOM, view) {
            NodeViewDesc.call(this, parent, node, outerDeco, innerDeco, dom, null, nodeDOM, view)
        }
        if (NodeViewDesc)
            TextViewDesc.__proto__ = NodeViewDesc;
        TextViewDesc.prototype = Object.create(NodeViewDesc && NodeViewDesc.prototype);
        TextViewDesc.prototype.constructor = TextViewDesc;
        TextViewDesc.prototype.parseRule = function parseRule() {
            return {
                skip: this.nodeDOM.parentNode || true
            }
        }
        ;
        TextViewDesc.prototype.update = function update(node, outerDeco) {
            if (this.dirty == NODE_DIRTY || this.dirty != NOT_DIRTY && !this.inParent() || !node.sameMarkup(this.node)) {
                return false
            }
            this.updateOuterDeco(outerDeco);
            if ((this.dirty != NOT_DIRTY || node.text != this.node.text) && node.text != this.nodeDOM.nodeValue) {
                this.nodeDOM.nodeValue = node.text
            }
            this.node = node;
            this.dirty = NOT_DIRTY;
            return true
        }
        ;
        TextViewDesc.prototype.inParent = function inParent() {
            var parentDOM = this.parent.contentDOM;
            for (var n = this.nodeDOM; n; n = n.parentNode) {
                if (n == parentDOM) {
                    return true
                }
            }
            return false
        }
        ;
        TextViewDesc.prototype.domFromPos = function domFromPos(pos) {
            return {
                node: this.nodeDOM,
                offset: pos
            }
        }
        ;
        TextViewDesc.prototype.localPosFromDOM = function localPosFromDOM(dom, offset, bias) {
            if (dom == this.nodeDOM) {
                return this.posAtStart + Math.min(offset, this.node.text.length)
            }
            return NodeViewDesc.prototype.localPosFromDOM.call(this, dom, offset, bias)
        }
        ;
        TextViewDesc.prototype.ignoreMutation = function ignoreMutation(mutation) {
            return mutation.type != "characterData" && mutation.type != "selection"
        }
        ;
        TextViewDesc.prototype.slice = function slice(from, to, view) {
            var node = this.node.cut(from, to)
                , dom = document.createTextNode(node.text);
            return new TextViewDesc(this.parent,node,this.outerDeco,this.innerDeco,dom,dom,view)
        }
        ;
        return TextViewDesc
    }(NodeViewDesc);
    var BRHackViewDesc = function(ViewDesc) {
        function BRHackViewDesc() {
            ViewDesc.apply(this, arguments)
        }
        if (ViewDesc)
            BRHackViewDesc.__proto__ = ViewDesc;
        BRHackViewDesc.prototype = Object.create(ViewDesc && ViewDesc.prototype);
        BRHackViewDesc.prototype.constructor = BRHackViewDesc;
        BRHackViewDesc.prototype.parseRule = function parseRule() {
            return {
                ignore: true
            }
        }
        ;
        BRHackViewDesc.prototype.matchesHack = function matchesHack() {
            return this.dirty == NOT_DIRTY
        }
        ;
        return BRHackViewDesc
    }(ViewDesc);
    var CustomNodeViewDesc = function(NodeViewDesc) {
        function CustomNodeViewDesc(parent, node, outerDeco, innerDeco, dom, contentDOM, nodeDOM, spec, view, pos) {
            NodeViewDesc.call(this, parent, node, outerDeco, innerDeco, dom, contentDOM, nodeDOM, view, pos);
            this.spec = spec
        }
        if (NodeViewDesc)
            CustomNodeViewDesc.__proto__ = NodeViewDesc;
        CustomNodeViewDesc.prototype = Object.create(NodeViewDesc && NodeViewDesc.prototype);
        CustomNodeViewDesc.prototype.constructor = CustomNodeViewDesc;
        CustomNodeViewDesc.prototype.update = function update(node, outerDeco, innerDeco, view) {
            if (this.dirty == NODE_DIRTY) {
                return false
            }
            if (this.spec.update) {
                var result = this.spec.update(node, outerDeco);
                if (result) {
                    this.updateInner(node, outerDeco, innerDeco, view)
                }
                return result
            } else if (!this.contentDOM && !node.isLeaf) {
                return false
            } else {
                return NodeViewDesc.prototype.update.call(this, node, outerDeco, innerDeco, view)
            }
        }
        ;
        CustomNodeViewDesc.prototype.selectNode = function selectNode() {
            this.spec.selectNode ? this.spec.selectNode() : NodeViewDesc.prototype.selectNode.call(this)
        }
        ;
        CustomNodeViewDesc.prototype.deselectNode = function deselectNode() {
            this.spec.deselectNode ? this.spec.deselectNode() : NodeViewDesc.prototype.deselectNode.call(this)
        }
        ;
        CustomNodeViewDesc.prototype.setSelection = function setSelection(anchor, head, root, force) {
            this.spec.setSelection ? this.spec.setSelection(anchor, head, root) : NodeViewDesc.prototype.setSelection.call(this, anchor, head, root, force)
        }
        ;
        CustomNodeViewDesc.prototype.destroy = function destroy() {
            if (this.spec.destroy) {
                this.spec.destroy()
            }
            NodeViewDesc.prototype.destroy.call(this)
        }
        ;
        CustomNodeViewDesc.prototype.stopEvent = function stopEvent(event) {
            return this.spec.stopEvent ? this.spec.stopEvent(event) : false
        }
        ;
        CustomNodeViewDesc.prototype.ignoreMutation = function ignoreMutation(mutation) {
            return this.spec.ignoreMutation ? this.spec.ignoreMutation(mutation) : NodeViewDesc.prototype.ignoreMutation.call(this, mutation)
        }
        ;
        return CustomNodeViewDesc
    }(NodeViewDesc);
    function renderDescs(parentDOM, descs) {
        var dom = parentDOM.firstChild;
        for (var i = 0; i < descs.length; i++) {
            var desc = descs[i]
                , childDOM = desc.dom;
            if (childDOM.parentNode == parentDOM) {
                while (childDOM != dom) {
                    dom = rm(dom)
                }
                dom = dom.nextSibling
            } else {
                parentDOM.insertBefore(childDOM, dom)
            }
            if (desc instanceof MarkViewDesc) {
                var pos = dom ? dom.previousSibling : parentDOM.lastChild;
                renderDescs(desc.contentDOM, desc.children);
                dom = pos ? pos.nextSibling : parentDOM.firstChild
            }
        }
        while (dom) {
            dom = rm(dom)
        }
    }
    function OuterDecoLevel(nodeName) {
        if (nodeName) {
            this.nodeName = nodeName
        }
    }
    OuterDecoLevel.prototype = Object.create(null);
    var noDeco = [new OuterDecoLevel];
    function computeOuterDeco(outerDeco, node, needsWrap) {
        if (outerDeco.length == 0) {
            return noDeco
        }
        var top = needsWrap ? noDeco[0] : new OuterDecoLevel
            , result = [top];
        for (var i = 0; i < outerDeco.length; i++) {
            var attrs = outerDeco[i].type.attrs
                , cur = top;
            if (!attrs) {
                continue
            }
            if (attrs.nodeName) {
                result.push(cur = new OuterDecoLevel(attrs.nodeName))
            }
            for (var name in attrs) {
                var val = attrs[name];
                if (val == null) {
                    continue
                }
                if (needsWrap && result.length == 1) {
                    result.push(cur = top = new OuterDecoLevel(node.isInline ? "span" : "div"))
                }
                if (name == "class") {
                    cur.class = (cur.class ? cur.class + " " : "") + val
                } else if (name == "style") {
                    cur.style = (cur.style ? cur.style + ";" : "") + val
                } else if (name != "nodeName") {
                    cur[name] = val
                }
            }
        }
        return result
    }
    function patchOuterDeco(outerDOM, nodeDOM, prevComputed, curComputed) {
        if (prevComputed == noDeco && curComputed == noDeco) {
            return nodeDOM
        }
        var curDOM = nodeDOM;
        for (var i = 0; i < curComputed.length; i++) {
            var deco = curComputed[i]
                , prev = prevComputed[i];
            if (i) {
                var parent = void 0;
                if (prev && prev.nodeName == deco.nodeName && curDOM != outerDOM && (parent = curDOM.parentNode) && parent.tagName.toLowerCase() == deco.nodeName) {
                    curDOM = parent
                } else {
                    parent = document.createElement(deco.nodeName);
                    parent.appendChild(curDOM);
                    prev = noDeco[0];
                    curDOM = parent
                }
            }
            patchAttributes(curDOM, prev || noDeco[0], deco)
        }
        return curDOM
    }
    function patchAttributes(dom, prev, cur) {
        for (var name in prev) {
            if (name != "class" && name != "style" && name != "nodeName" && !(name in cur)) {
                dom.removeAttribute(name)
            }
        }
        for (var name$1 in cur) {
            if (name$1 != "class" && name$1 != "style" && name$1 != "nodeName" && cur[name$1] != prev[name$1]) {
                dom.setAttribute(name$1, cur[name$1])
            }
        }
        if (prev.class != cur.class) {
            var prevList = prev.class ? prev.class.split(" ") : nothing;
            var curList = cur.class ? cur.class.split(" ") : nothing;
            for (var i = 0; i < prevList.length; i++) {
                if (curList.indexOf(prevList[i]) == -1) {
                    dom.classList.remove(prevList[i])
                }
            }
            for (var i$1 = 0; i$1 < curList.length; i$1++) {
                if (prevList.indexOf(curList[i$1]) == -1) {
                    dom.classList.add(curList[i$1])
                }
            }
        }
        if (prev.style != cur.style) {
            if (prev.style) {
                var prop = /\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g, m;
                while (m = prop.exec(prev.style)) {
                    dom.style.removeProperty(m[1])
                }
            }
            if (cur.style) {
                dom.style.cssText += cur.style
            }
        }
    }
    function applyOuterDeco(dom, deco, node) {
        return patchOuterDeco(dom, dom, noDeco, computeOuterDeco(deco, node, dom.nodeType != 1))
    }
    function sameOuterDeco(a, b) {
        if (a.length != b.length) {
            return false
        }
        for (var i = 0; i < a.length; i++) {
            if (!a[i].type.eq(b[i].type)) {
                return false
            }
        }
        return true
    }
    function rm(dom) {
        var next = dom.nextSibling;
        dom.parentNode.removeChild(dom);
        return next
    }
    var ViewTreeUpdater = function ViewTreeUpdater(top, lockedNode) {
        this.top = top;
        this.lock = lockedNode;
        this.index = 0;
        this.stack = [];
        this.changed = false;
        var pre = preMatch(top.node.content, top.children);
        this.preMatched = pre.nodes;
        this.preMatchOffset = pre.offset
    };
    ViewTreeUpdater.prototype.getPreMatch = function getPreMatch(index) {
        return index >= this.preMatchOffset ? this.preMatched[index - this.preMatchOffset] : null
    }
    ;
    ViewTreeUpdater.prototype.destroyBetween = function destroyBetween(start, end) {
        if (start == end) {
            return
        }
        for (var i = start; i < end; i++) {
            this.top.children[i].destroy()
        }
        this.top.children.splice(start, end - start);
        this.changed = true
    }
    ;
    ViewTreeUpdater.prototype.destroyRest = function destroyRest() {
        this.destroyBetween(this.index, this.top.children.length)
    }
    ;
    ViewTreeUpdater.prototype.syncToMarks = function syncToMarks(marks, inline, view) {
        var keep = 0
            , depth = this.stack.length >> 1;
        var maxKeep = Math.min(depth, marks.length);
        while (keep < maxKeep && (keep == depth - 1 ? this.top : this.stack[keep + 1 << 1]).matchesMark(marks[keep]) && marks[keep].type.spec.spanning !== false) {
            keep++
        }
        while (keep < depth) {
            this.destroyRest();
            this.top.dirty = NOT_DIRTY;
            this.index = this.stack.pop();
            this.top = this.stack.pop();
            depth--
        }
        while (depth < marks.length) {
            this.stack.push(this.top, this.index + 1);
            var found = -1;
            for (var i = this.index; i < Math.min(this.index + 3, this.top.children.length); i++) {
                if (this.top.children[i].matchesMark(marks[depth])) {
                    found = i;
                    break
                }
            }
            if (found > -1) {
                if (found > this.index) {
                    this.changed = true;
                    this.destroyBetween(this.index, found)
                }
                this.top = this.top.children[this.index]
            } else {
                var markDesc = MarkViewDesc.create(this.top, marks[depth], inline, view);
                this.top.children.splice(this.index, 0, markDesc);
                this.top = markDesc;
                this.changed = true
            }
            this.index = 0;
            depth++
        }
    }
    ;
    ViewTreeUpdater.prototype.findNodeMatch = function findNodeMatch(node, outerDeco, innerDeco, index) {
        var found = -1
            , preMatch = index < 0 ? undefined : this.getPreMatch(index)
            , children = this.top.children;
        if (preMatch && preMatch.matchesNode(node, outerDeco, innerDeco)) {
            found = children.indexOf(preMatch)
        } else {
            for (var i = this.index, e = Math.min(children.length, i + 5); i < e; i++) {
                var child = children[i];
                if (child.matchesNode(node, outerDeco, innerDeco) && this.preMatched.indexOf(child) < 0) {
                    found = i;
                    break
                }
            }
        }
        if (found < 0) {
            return false
        }
        this.destroyBetween(this.index, found);
        this.index++;
        return true
    }
    ;
    ViewTreeUpdater.prototype.updateNextNode = function updateNextNode(node, outerDeco, innerDeco, view, index) {
        for (var i = this.index; i < this.top.children.length; i++) {
            var next = this.top.children[i];
            if (next instanceof NodeViewDesc) {
                var preMatch = this.preMatched.indexOf(next);
                if (preMatch > -1 && preMatch + this.preMatchOffset != index) {
                    return false
                }
                var nextDOM = next.dom;
                var locked = this.lock && (nextDOM == this.lock || nextDOM.nodeType == 1 && nextDOM.contains(this.lock.parentNode)) && !(node.isText && next.node && next.node.isText && next.nodeDOM.nodeValue == node.text && next.dirty != NODE_DIRTY && sameOuterDeco(outerDeco, next.outerDeco));
                if (!locked && next.update(node, outerDeco, innerDeco, view)) {
                    this.destroyBetween(this.index, i);
                    if (next.dom != nextDOM) {
                        this.changed = true
                    }
                    this.index++;
                    return true
                }
                break
            }
        }
        return false
    }
    ;
    ViewTreeUpdater.prototype.addNode = function addNode(node, outerDeco, innerDeco, view, pos) {
        this.top.children.splice(this.index++, 0, NodeViewDesc.create(this.top, node, outerDeco, innerDeco, view, pos));
        this.changed = true
    }
    ;
    ViewTreeUpdater.prototype.placeWidget = function placeWidget(widget, view, pos) {
        if (this.index < this.top.children.length && this.top.children[this.index].matchesWidget(widget)) {
            this.index++
        } else {
            var desc = new WidgetViewDesc(this.top,widget,view,pos);
            this.top.children.splice(this.index++, 0, desc);
            this.changed = true
        }
    }
    ;
    ViewTreeUpdater.prototype.addTextblockHacks = function addTextblockHacks() {
        var lastChild = this.top.children[this.index - 1];
        while (lastChild instanceof MarkViewDesc) {
            lastChild = lastChild.children[lastChild.children.length - 1]
        }
        if (!lastChild || !(lastChild instanceof TextViewDesc) || /\n$/.test(lastChild.node.text)) {
            if (this.index < this.top.children.length && this.top.children[this.index].matchesHack()) {
                this.index++
            } else {
                var dom = document.createElement("br");
                this.top.children.splice(this.index++, 0, new BRHackViewDesc(this.top,nothing,dom,null));
                this.changed = true
            }
        }
    }
    ;
    function preMatch(frag, descs) {
        var result = []
            , end = frag.childCount;
        for (var i = descs.length - 1; end > 0 && i >= 0; i--) {
            var desc = descs[i]
                , node = desc.node;
            if (!node) {
                continue
            }
            if (node != frag.child(end - 1)) {
                break
            }
            result.push(desc);
            --end
        }
        return {
            nodes: result.reverse(),
            offset: end
        }
    }
    function compareSide(a, b) {
        return a.type.side - b.type.side
    }
    function iterDeco(parent, deco, onWidget, onNode) {
        var locals = deco.locals(parent)
            , offset = 0;
        if (locals.length == 0) {
            for (var i = 0; i < parent.childCount; i++) {
                var child = parent.child(i);
                onNode(child, locals, deco.forChild(offset, child), i);
                offset += child.nodeSize
            }
            return
        }
        var decoIndex = 0
            , active = []
            , restNode = null;
        for (var parentIndex = 0; ; ) {
            if (decoIndex < locals.length && locals[decoIndex].to == offset) {
                var widget = locals[decoIndex++]
                    , widgets = void 0;
                while (decoIndex < locals.length && locals[decoIndex].to == offset) {
                    (widgets || (widgets = [widget])).push(locals[decoIndex++])
                }
                if (widgets) {
                    widgets.sort(compareSide);
                    for (var i$1 = 0; i$1 < widgets.length; i$1++) {
                        onWidget(widgets[i$1], parentIndex, !!restNode)
                    }
                } else {
                    onWidget(widget, parentIndex, !!restNode)
                }
            }
            var child$1 = void 0
                , index = void 0;
            if (restNode) {
                index = -1;
                child$1 = restNode;
                restNode = null
            } else if (parentIndex < parent.childCount) {
                index = parentIndex;
                child$1 = parent.child(parentIndex++)
            } else {
                break
            }
            for (var i$2 = 0; i$2 < active.length; i$2++) {
                if (active[i$2].to <= offset) {
                    active.splice(i$2--, 1)
                }
            }
            while (decoIndex < locals.length && locals[decoIndex].from == offset) {
                active.push(locals[decoIndex++])
            }
            var end = offset + child$1.nodeSize;
            if (child$1.isText) {
                var cutAt = end;
                if (decoIndex < locals.length && locals[decoIndex].from < cutAt) {
                    cutAt = locals[decoIndex].from
                }
                for (var i$3 = 0; i$3 < active.length; i$3++) {
                    if (active[i$3].to < cutAt) {
                        cutAt = active[i$3].to
                    }
                }
                if (cutAt < end) {
                    restNode = child$1.cut(cutAt - offset);
                    child$1 = child$1.cut(0, cutAt - offset);
                    end = cutAt;
                    index = -1
                }
            }
            onNode(child$1, active.length ? active.slice() : nothing, deco.forChild(offset, child$1), index);
            offset = end
        }
    }
    function iosHacks(dom) {
        if (dom.nodeName == "UL" || dom.nodeName == "OL") {
            var oldCSS = dom.style.cssText;
            dom.style.cssText = oldCSS + "; list-style: square !important";
            window.getComputedStyle(dom).listStyle;
            dom.style.cssText = oldCSS
        }
    }
    function nearbyTextNode(node, offset) {
        for (; ; ) {
            if (node.nodeType == 3) {
                return node
            }
            if (node.nodeType == 1 && offset > 0) {
                if (node.childNodes.length > offset && node.childNodes[offset].nodeType == 3) {
                    return node.childNodes[offset]
                }
                node = node.childNodes[offset - 1];
                offset = nodeSize(node)
            } else if (node.nodeType == 1 && offset < node.childNodes.length) {
                node = node.childNodes[offset];
                offset = 0
            } else {
                return null
            }
        }
    }
    function findTextInFragment(frag, text, from, to) {
        for (var i = 0, pos = 0; i < frag.childCount && pos <= to; ) {
            var child = frag.child(i++)
                , childStart = pos;
            pos += child.nodeSize;
            if (!child.isText) {
                continue
            }
            var str = child.text;
            while (i < frag.childCount) {
                var next = frag.child(i++);
                pos += next.nodeSize;
                if (!next.isText) {
                    break
                }
                str += next.text
            }
            if (pos >= from) {
                var found = str.lastIndexOf(text, to - childStart);
                if (found >= 0 && found + text.length + childStart >= from) {
                    return childStart + found
                }
            }
        }
        return -1
    }
    function replaceNodes(nodes, from, to, view, replacement) {
        var result = [];
        for (var i = 0, off = 0; i < nodes.length; i++) {
            var child = nodes[i]
                , start = off
                , end = off += child.size;
            if (start >= to || end <= from) {
                result.push(child)
            } else {
                if (start < from) {
                    result.push(child.slice(0, from - start, view))
                }
                if (replacement) {
                    result.push(replacement);
                    replacement = null
                }
                if (end > to) {
                    result.push(child.slice(to - start, child.size, view))
                }
            }
        }
        return result
    }
    function moveSelectionBlock(state, dir) {
        var ref = state.selection;
        var $anchor = ref.$anchor;
        var $head = ref.$head;
        var $side = dir > 0 ? $anchor.max($head) : $anchor.min($head);
        var $start = !$side.parent.inlineContent ? $side : $side.depth ? state.doc.resolve(dir > 0 ? $side.after() : $side.before()) : null;
        return $start && prosemirrorState.Selection.findFrom($start, dir)
    }
    function apply(view, sel) {
        view.dispatch(view.state.tr.setSelection(sel).scrollIntoView());
        return true
    }
    function selectHorizontally(view, dir, mods) {
        var sel = view.state.selection;
        if (sel instanceof prosemirrorState.TextSelection) {
            if (!sel.empty || mods.indexOf("s") > -1) {
                return false
            } else if (view.endOfTextblock(dir > 0 ? "right" : "left")) {
                var next = moveSelectionBlock(view.state, dir);
                if (next && next instanceof prosemirrorState.NodeSelection) {
                    return apply(view, next)
                }
                return false
            } else {
                var $head = sel.$head, node = $head.textOffset ? null : dir < 0 ? $head.nodeBefore : $head.nodeAfter, desc;
                if (!node || node.isText) {
                    return false
                }
                var nodePos = dir < 0 ? $head.pos - node.nodeSize : $head.pos;
                if (!(node.isAtom || (desc = view.docView.descAt(nodePos)) && !desc.contentDOM)) {
                    return false
                }
                if (prosemirrorState.NodeSelection.isSelectable(node)) {
                    return apply(view, new prosemirrorState.NodeSelection(dir < 0 ? view.state.doc.resolve($head.pos - node.nodeSize) : $head))
                } else if (result.webkit) {
                    return apply(view, new prosemirrorState.TextSelection(view.state.doc.resolve(dir < 0 ? nodePos : nodePos + node.nodeSize)))
                } else {
                    return false
                }
            }
        } else if (sel instanceof prosemirrorState.NodeSelection && sel.node.isInline) {
            return apply(view, new prosemirrorState.TextSelection(dir > 0 ? sel.$to : sel.$from))
        } else {
            var next$1 = moveSelectionBlock(view.state, dir);
            if (next$1) {
                return apply(view, next$1)
            }
            return false
        }
    }
    function nodeLen(node) {
        return node.nodeType == 3 ? node.nodeValue.length : node.childNodes.length
    }
    function isIgnorable(dom) {
        var desc = dom.pmViewDesc;
        return desc && desc.size == 0 && (dom.nextSibling || dom.nodeName != "BR")
    }
    function skipIgnoredNodesLeft(view) {
        var sel = view.root.getSelection();
        var node = sel.focusNode
            , offset = sel.focusOffset;
        if (!node) {
            return
        }
        var moveNode, moveOffset, force = false;
        if (result.gecko && node.nodeType == 1 && offset < nodeLen(node) && isIgnorable(node.childNodes[offset])) {
            force = true
        }
        for (; ; ) {
            if (offset > 0) {
                if (node.nodeType != 1) {
                    break
                } else {
                    var before = node.childNodes[offset - 1];
                    if (isIgnorable(before)) {
                        moveNode = node;
                        moveOffset = --offset
                    } else if (before.nodeType == 3) {
                        node = before;
                        offset = node.nodeValue.length
                    } else {
                        break
                    }
                }
            } else if (isBlockNode(node)) {
                break
            } else {
                var prev = node.previousSibling;
                while (prev && isIgnorable(prev)) {
                    moveNode = node.parentNode;
                    moveOffset = domIndex(prev);
                    prev = prev.previousSibling
                }
                if (!prev) {
                    node = node.parentNode;
                    if (node == view.dom) {
                        break
                    }
                    offset = 0
                } else {
                    node = prev;
                    offset = nodeLen(node)
                }
            }
        }
        if (force) {
            setSelFocus(view, sel, node, offset)
        } else if (moveNode) {
            setSelFocus(view, sel, moveNode, moveOffset)
        }
    }
    function skipIgnoredNodesRight(view) {
        var sel = view.root.getSelection();
        var node = sel.focusNode
            , offset = sel.focusOffset;
        if (!node) {
            return
        }
        var len = nodeLen(node);
        var moveNode, moveOffset;
        for (; ; ) {
            if (offset < len) {
                if (node.nodeType != 1) {
                    break
                }
                var after = node.childNodes[offset];
                if (isIgnorable(after)) {
                    moveNode = node;
                    moveOffset = ++offset
                } else {
                    break
                }
            } else if (isBlockNode(node)) {
                break
            } else {
                var next = node.nextSibling;
                while (next && isIgnorable(next)) {
                    moveNode = next.parentNode;
                    moveOffset = domIndex(next) + 1;
                    next = next.nextSibling
                }
                if (!next) {
                    node = node.parentNode;
                    if (node == view.dom) {
                        break
                    }
                    offset = len = 0
                } else {
                    node = next;
                    offset = 0;
                    len = nodeLen(node)
                }
            }
        }
        if (moveNode) {
            setSelFocus(view, sel, moveNode, moveOffset)
        }
    }
    function isBlockNode(dom) {
        var desc = dom.pmViewDesc;
        return desc && desc.node && desc.node.isBlock
    }
    function setSelFocus(view, sel, node, offset) {
        if (selectionCollapsed(sel)) {
            var range = document.createRange();
            range.setEnd(node, offset);
            range.setStart(node, offset);
            sel.removeAllRanges();
            sel.addRange(range)
        } else if (sel.extend) {
            sel.extend(node, offset)
        }
        view.domObserver.setCurSelection()
    }
    function selectVertically(view, dir, mods) {
        var sel = view.state.selection;
        if (sel instanceof prosemirrorState.TextSelection && !sel.empty || mods.indexOf("s") > -1) {
            return false
        }
        var $from = sel.$from;
        var $to = sel.$to;
        if (!$from.parent.inlineContent || view.endOfTextblock(dir < 0 ? "up" : "down")) {
            var next = moveSelectionBlock(view.state, dir);
            if (next && next instanceof prosemirrorState.NodeSelection) {
                return apply(view, next)
            }
        }
        if (!$from.parent.inlineContent) {
            var beyond = prosemirrorState.Selection.findFrom(dir < 0 ? $from : $to, dir);
            return beyond ? apply(view, beyond) : true
        }
        return false
    }
    function stopNativeHorizontalDelete(view, dir) {
        if (!(view.state.selection instanceof prosemirrorState.TextSelection)) {
            return true
        }
        var ref = view.state.selection;
        var $head = ref.$head;
        var $anchor = ref.$anchor;
        var empty = ref.empty;
        if (!$head.sameParent($anchor)) {
            return true
        }
        if (!empty) {
            return false
        }
        if (view.endOfTextblock(dir > 0 ? "forward" : "backward")) {
            return true
        }
        var nextNode = !$head.textOffset && (dir < 0 ? $head.nodeBefore : $head.nodeAfter);
        if (nextNode && !nextNode.isText) {
            var tr = view.state.tr;
            if (dir < 0) {
                tr.delete($head.pos - nextNode.nodeSize, $head.pos)
            } else {
                tr.delete($head.pos, $head.pos + nextNode.nodeSize)
            }
            view.dispatch(tr);
            return true
        }
        return false
    }
    function switchEditable(view, node, state) {
        view.domObserver.stop();
        node.contentEditable = state;
        view.domObserver.start()
    }
    function chromeDownArrowBug(view) {
        if (!result.chrome || view.state.selection.$head.parentOffset > 0) {
            return
        }
        var ref = view.root.getSelection();
        var focusNode = ref.focusNode;
        var focusOffset = ref.focusOffset;
        if (focusNode && focusNode.nodeType == 1 && focusOffset == 0 && focusNode.firstChild && focusNode.firstChild.contentEditable == "false") {
            var child = focusNode.firstChild;
            switchEditable(view, child, true);
            setTimeout(function() {
                return switchEditable(view, child, false)
            }, 20)
        }
    }
    function getMods(event) {
        var result = "";
        if (event.ctrlKey) {
            result += "c"
        }
        if (event.metaKey) {
            result += "m"
        }
        if (event.altKey) {
            result += "a"
        }
        if (event.shiftKey) {
            result += "s"
        }
        return result
    }
    function captureKeyDown(view, event) {
        var code = event.keyCode
            , mods = getMods(event);
        if (code == 8 || result.mac && code == 72 && mods == "c") {
            return stopNativeHorizontalDelete(view, -1) || skipIgnoredNodesLeft(view)
        } else if (code == 46 || result.mac && code == 68 && mods == "c") {
            return stopNativeHorizontalDelete(view, 1) || skipIgnoredNodesRight(view)
        } else if (code == 13 || code == 27) {
            return true
        } else if (code == 37) {
            return selectHorizontally(view, -1, mods) || skipIgnoredNodesLeft(view)
        } else if (code == 39) {
            return selectHorizontally(view, 1, mods) || skipIgnoredNodesRight(view)
        } else if (code == 38) {
            return selectVertically(view, -1, mods) || skipIgnoredNodesLeft(view)
        } else if (code == 40) {
            return chromeDownArrowBug(view) || selectVertically(view, 1, mods) || skipIgnoredNodesRight(view)
        } else if (mods == (result.mac ? "m" : "c") && (code == 66 || code == 73 || code == 89 || code == 90)) {
            return true
        }
        return false
    }
    function selectionFromDOM(view, origin) {
        var domSel = view.root.getSelection()
            , doc = view.state.doc;
        var nearestDesc = view.docView.nearestDesc(domSel.focusNode)
            , inWidget = nearestDesc && nearestDesc.size == 0;
        var head = view.docView.posFromDOM(domSel.focusNode, domSel.focusOffset);
        var $head = doc.resolve(head), $anchor, selection;
        if (selectionCollapsed(domSel)) {
            $anchor = $head;
            while (nearestDesc && !nearestDesc.node) {
                nearestDesc = nearestDesc.parent
            }
            if (nearestDesc && nearestDesc.node.isAtom && prosemirrorState.NodeSelection.isSelectable(nearestDesc.node) && nearestDesc.parent && !(nearestDesc.node.isInline && isOnEdge(domSel.focusNode, domSel.focusOffset, nearestDesc.dom))) {
                var pos = nearestDesc.posBefore;
                selection = new prosemirrorState.NodeSelection(head == pos ? $head : doc.resolve(pos))
            }
        } else {
            $anchor = doc.resolve(view.docView.posFromDOM(domSel.anchorNode, domSel.anchorOffset))
        }
        if (!selection) {
            var bias = origin == "pointer" || view.state.selection.head < $head.pos && !inWidget ? 1 : -1;
            selection = selectionBetween(view, $anchor, $head, bias)
        }
        return selection
    }
    function selectionToDOM(view, force) {
        var sel = view.state.selection;
        syncNodeSelection(view, sel);
        if (view.editable ? !view.hasFocus() : !(hasSelection(view) && document.activeElement.contains(view.dom))) {
            return
        }
        view.domObserver.disconnectSelection();
        if (view.cursorWrapper) {
            selectCursorWrapper(view)
        } else {
            var anchor = sel.anchor;
            var head = sel.head;
            var resetEditableFrom, resetEditableTo;
            if (brokenSelectBetweenUneditable && !(sel instanceof prosemirrorState.TextSelection)) {
                if (!sel.$from.parent.inlineContent) {
                    resetEditableFrom = temporarilyEditableNear(view, sel.from)
                }
                if (!sel.empty && !sel.$from.parent.inlineContent) {
                    resetEditableTo = temporarilyEditableNear(view, sel.to)
                }
            }
            view.docView.setSelection(anchor, head, view.root, force);
            if (brokenSelectBetweenUneditable) {
                if (resetEditableFrom) {
                    resetEditable(resetEditableFrom)
                }
                if (resetEditableTo) {
                    resetEditable(resetEditableTo)
                }
            }
            if (sel.visible) {
                view.dom.classList.remove("ProseMirror-hideselection")
            } else {
                view.dom.classList.add("ProseMirror-hideselection");
                if ("onselectionchange"in document) {
                    removeClassOnSelectionChange(view)
                }
            }
        }
        view.domObserver.setCurSelection();
        view.domObserver.connectSelection()
    }
    var brokenSelectBetweenUneditable = result.safari || result.chrome && result.chrome_version < 63;
    function temporarilyEditableNear(view, pos) {
        var ref = view.docView.domFromPos(pos);
        var node = ref.node;
        var offset = ref.offset;
        var after = offset < node.childNodes.length ? node.childNodes[offset] : null;
        var before = offset ? node.childNodes[offset - 1] : null;
        if (result.safari && after && after.contentEditable == "false") {
            return setEditable(after)
        }
        if ((!after || after.contentEditable == "false") && (!before || before.contentEditable == "false")) {
            if (after) {
                return setEditable(after)
            } else if (before) {
                return setEditable(before)
            }
        }
    }
    function setEditable(element) {
        element.contentEditable = "true";
        if (result.safari && element.draggable) {
            element.draggable = false;
            element.wasDraggable = true
        }
        return element
    }
    function resetEditable(element) {
        element.contentEditable = "false";
        if (element.wasDraggable) {
            element.draggable = true;
            element.wasDraggable = null
        }
    }
    function removeClassOnSelectionChange(view) {
        var doc = view.dom.ownerDocument;
        doc.removeEventListener("selectionchange", view.hideSelectionGuard);
        var domSel = view.root.getSelection();
        var node = domSel.anchorNode
            , offset = domSel.anchorOffset;
        doc.addEventListener("selectionchange", view.hideSelectionGuard = function() {
                if (domSel.anchorNode != node || domSel.anchorOffset != offset) {
                    doc.removeEventListener("selectionchange", view.hideSelectionGuard);
                    view.dom.classList.remove("ProseMirror-hideselection")
                }
            }
        )
    }
    function selectCursorWrapper(view) {
        var domSel = view.root.getSelection()
            , range = document.createRange();
        var node = view.cursorWrapper.dom
            , img = node.nodeName == "IMG";
        if (img) {
            range.setEnd(node.parentNode, domIndex(node) + 1)
        } else {
            range.setEnd(node, 0)
        }
        range.collapse(false);
        domSel.removeAllRanges();
        domSel.addRange(range);
        if (!img && !view.state.selection.visible && result.ie && result.ie_version <= 11) {
            node.disabled = true;
            node.disabled = false
        }
    }
    function syncNodeSelection(view, sel) {
        if (sel instanceof prosemirrorState.NodeSelection) {
            var desc = view.docView.descAt(sel.from);
            if (desc != view.lastSelectedViewDesc) {
                clearNodeSelection(view);
                if (desc) {
                    desc.selectNode()
                }
                view.lastSelectedViewDesc = desc
            }
        } else {
            clearNodeSelection(view)
        }
    }
    function clearNodeSelection(view) {
        if (view.lastSelectedViewDesc) {
            if (view.lastSelectedViewDesc.parent) {
                view.lastSelectedViewDesc.deselectNode()
            }
            view.lastSelectedViewDesc = null
        }
    }
    function selectionBetween(view, $anchor, $head, bias) {
        return view.someProp("createSelectionBetween", function(f) {
            return f(view, $anchor, $head)
        }) || prosemirrorState.TextSelection.between($anchor, $head, bias)
    }
    function hasFocusAndSelection(view) {
        if (view.editable && view.root.activeElement != view.dom) {
            return false
        }
        return hasSelection(view)
    }
    function hasSelection(view) {
        var sel = view.root.getSelection();
        if (!sel.anchorNode) {
            return false
        }
        try {
            return view.dom.contains(sel.anchorNode.nodeType == 3 ? sel.anchorNode.parentNode : sel.anchorNode) && (view.editable || view.dom.contains(sel.focusNode.nodeType == 3 ? sel.focusNode.parentNode : sel.focusNode))
        } catch (_) {
            return false
        }
    }
    function anchorInRightPlace(view) {
        var anchorDOM = view.docView.domFromPos(view.state.selection.anchor);
        var domSel = view.root.getSelection();
        return isEquivalentPosition(anchorDOM.node, anchorDOM.offset, domSel.anchorNode, domSel.anchorOffset)
    }
    function parseBetween(view, from_, to_) {
        var ref = view.docView.parseRange(from_, to_);
        var parent = ref.node;
        var fromOffset = ref.fromOffset;
        var toOffset = ref.toOffset;
        var from = ref.from;
        var to = ref.to;
        var domSel = view.root.getSelection()
            , find = null
            , anchor = domSel.anchorNode;
        if (anchor && view.dom.contains(anchor.nodeType == 1 ? anchor : anchor.parentNode)) {
            find = [{
                node: anchor,
                offset: domSel.anchorOffset
            }];
            if (!selectionCollapsed(domSel)) {
                find.push({
                    node: domSel.focusNode,
                    offset: domSel.focusOffset
                })
            }
        }
        if (result.chrome && view.lastKeyCode === 8) {
            for (var off = toOffset; off > fromOffset; off--) {
                var node = parent.childNodes[off - 1]
                    , desc = node.pmViewDesc;
                if (node.nodeType == "BR" && !desc) {
                    toOffset = off;
                    break
                }
                if (!desc || desc.size) {
                    break
                }
            }
        }
        var startDoc = view.state.doc;
        var parser = view.someProp("domParser") || prosemirrorModel.DOMParser.fromSchema(view.state.schema);
        var $from = startDoc.resolve(from);
        var sel = null
            , doc = parser.parse(parent, {
            topNode: $from.parent,
            topMatch: $from.parent.contentMatchAt($from.index()),
            topOpen: true,
            from: fromOffset,
            to: toOffset,
            preserveWhitespace: $from.parent.type.spec.code ? "full" : true,
            editableContent: true,
            findPositions: find,
            ruleFromNode: ruleFromNode,
            context: $from
        });
        if (find && find[0].pos != null) {
            var anchor$1 = find[0].pos
                , head = find[1] && find[1].pos;
            if (head == null) {
                head = anchor$1
            }
            sel = {
                anchor: anchor$1 + from,
                head: head + from
            }
        }
        return {
            doc: doc,
            sel: sel,
            from: from,
            to: to
        }
    }
    function ruleFromNode(dom) {
        var desc = dom.pmViewDesc;
        if (desc) {
            return desc.parseRule()
        } else if (dom.nodeName == "BR" && dom.parentNode) {
            if (result.safari && /^(ul|ol)$/i.test(dom.parentNode.nodeName)) {
                var skip = document.createElement("div");
                skip.appendChild(document.createElement("li"));
                return {
                    skip: skip
                }
            } else if (dom.parentNode.lastChild == dom || result.safari && /^(tr|table)$/i.test(dom.parentNode.nodeName)) {
                return {
                    ignore: true
                }
            }
        } else if (dom.nodeName == "IMG" && dom.getAttribute("mark-placeholder")) {
            return {
                ignore: true
            }
        }
    }
    function readDOMChange(view, from, to, typeOver, addedNodes) {
        if (from < 0) {
            var origin = view.lastSelectionTime > Date.now() - 50 ? view.lastSelectionOrigin : null;
            var newSel = selectionFromDOM(view, origin);
            if (!view.state.selection.eq(newSel)) {
                var tr$1 = view.state.tr.setSelection(newSel);
                if (origin == "pointer") {
                    tr$1.setMeta("pointer", true)
                } else if (origin == "key") {
                    tr$1.scrollIntoView()
                }
                view.dispatch(tr$1)
            }
            return
        }
        var $before = view.state.doc.resolve(from);
        var shared = $before.sharedDepth(to);
        from = $before.before(shared + 1);
        to = view.state.doc.resolve(to).after(shared + 1);
        var sel = view.state.selection;
        var parse = parseBetween(view, from, to);
        var doc = view.state.doc
            , compare = doc.slice(parse.from, parse.to);
        var preferredPos, preferredSide;
        if (view.lastKeyCode === 8 && Date.now() - 100 < view.lastKeyCodeTime) {
            preferredPos = view.state.selection.to;
            preferredSide = "end"
        } else {
            preferredPos = view.state.selection.from;
            preferredSide = "start"
        }
        view.lastKeyCode = null;
        var change = findDiff(compare.content, parse.doc.content, parse.from, preferredPos, preferredSide);
        if (!change) {
            if (typeOver && sel instanceof prosemirrorState.TextSelection && !sel.empty && sel.$head.sameParent(sel.$anchor) && !view.composing && !(parse.sel && parse.sel.anchor != parse.sel.head)) {
                change = {
                    start: sel.from,
                    endA: sel.to,
                    endB: sel.to
                }
            } else {
                if (parse.sel) {
                    var sel$1 = resolveSelection(view, view.state.doc, parse.sel);
                    if (sel$1 && !sel$1.eq(view.state.selection)) {
                        view.dispatch(view.state.tr.setSelection(sel$1))
                    }
                }
                return
            }
        }
        view.domChangeCount++;
        if (view.state.selection.from < view.state.selection.to && change.start == change.endB && view.state.selection instanceof prosemirrorState.TextSelection) {
            if (change.start > view.state.selection.from && change.start <= view.state.selection.from + 2) {
                change.start = view.state.selection.from
            } else if (change.endA < view.state.selection.to && change.endA >= view.state.selection.to - 2) {
                change.endB += view.state.selection.to - change.endA;
                change.endA = view.state.selection.to
            }
        }
        if (result.ie && result.ie_version <= 11 && change.endB == change.start + 1 && change.endA == change.start && change.start > parse.from && parse.doc.textBetween(change.start - parse.from - 1, change.start - parse.from + 1) == " ") {
            change.start--;
            change.endA--;
            change.endB--
        }
        var $from = parse.doc.resolveNoCache(change.start - parse.from);
        var $to = parse.doc.resolveNoCache(change.endB - parse.from);
        var nextSel;
        if ((result.ios && view.lastIOSEnter > Date.now() - 100 && (!$from.sameParent($to) || addedNodes.some(function(n) {
            return n.nodeName == "DIV"
        })) || !$from.sameParent($to) && $from.pos < parse.doc.content.size && (nextSel = prosemirrorState.Selection.findFrom(parse.doc.resolve($from.pos + 1), 1, true)) && nextSel.head == $to.pos) && view.someProp("handleKeyDown", function(f) {
            return f(view, keyEvent(13, "Enter"))
        })) {
            view.lastIOSEnter = 0;
            return
        }
        if (view.state.selection.anchor > change.start && looksLikeJoin(doc, change.start, change.endA, $from, $to) && view.someProp("handleKeyDown", function(f) {
            return f(view, keyEvent(8, "Backspace"))
        })) {
            if (result.android && result.chrome) {
                view.domObserver.suppressSelectionUpdates()
            }
            return
        }
        var chFrom = change.start
            , chTo = change.endA;
        var tr, storedMarks, markChange, $from1;
        if ($from.sameParent($to) && $from.parent.inlineContent) {
            if ($from.pos == $to.pos) {
                if (result.ie && result.ie_version <= 11 && $from.parentOffset == 0) {
                    view.domObserver.suppressSelectionUpdates();
                    setTimeout(function() {
                        return selectionToDOM(view)
                    }, 20)
                }
                tr = view.state.tr.delete(chFrom, chTo);
                storedMarks = doc.resolve(change.start).marksAcross(doc.resolve(change.endA))
            } else if (change.endA == change.endB && ($from1 = doc.resolve(change.start)) && (markChange = isMarkChange($from.parent.content.cut($from.parentOffset, $to.parentOffset), $from1.parent.content.cut($from1.parentOffset, change.endA - $from1.start())))) {
                tr = view.state.tr;
                if (markChange.type == "add") {
                    tr.addMark(chFrom, chTo, markChange.mark)
                } else {
                    tr.removeMark(chFrom, chTo, markChange.mark)
                }
            } else if ($from.parent.child($from.index()).isText && $from.index() == $to.index() - ($to.textOffset ? 0 : 1)) {
                var text = $from.parent.textBetween($from.parentOffset, $to.parentOffset);
                if (view.someProp("handleTextInput", function(f) {
                    return f(view, chFrom, chTo, text)
                })) {
                    return
                }
                tr = view.state.tr.insertText(text, chFrom, chTo)
            }
        }
        if (!tr) {
            tr = view.state.tr.replace(chFrom, chTo, parse.doc.slice(change.start - parse.from, change.endB - parse.from))
        }
        if (parse.sel) {
            var sel$2 = resolveSelection(view, tr.doc, parse.sel);
            if (sel$2 && !(result.chrome && result.android && view.composing && sel$2.empty && (sel$2.head == chFrom || sel$2.head == tr.mapping.map(chTo) - 1) || result.ie && sel$2.empty && sel$2.head == chFrom)) {
                tr.setSelection(sel$2)
            }
        }
        if (storedMarks) {
            tr.ensureMarks(storedMarks)
        }
        view.dispatch(tr.scrollIntoView())
    }
    function resolveSelection(view, doc, parsedSel) {
        if (Math.max(parsedSel.anchor, parsedSel.head) > doc.content.size) {
            return null
        }
        return selectionBetween(view, doc.resolve(parsedSel.anchor), doc.resolve(parsedSel.head))
    }
    function isMarkChange(cur, prev) {
        var curMarks = cur.firstChild.marks
            , prevMarks = prev.firstChild.marks;
        var added = curMarks, removed = prevMarks, type, mark, update;
        for (var i = 0; i < prevMarks.length; i++) {
            added = prevMarks[i].removeFromSet(added)
        }
        for (var i$1 = 0; i$1 < curMarks.length; i$1++) {
            removed = curMarks[i$1].removeFromSet(removed)
        }
        if (added.length == 1 && removed.length == 0) {
            mark = added[0];
            type = "add";
            update = function(node) {
                return node.mark(mark.addToSet(node.marks))
            }
        } else if (added.length == 0 && removed.length == 1) {
            mark = removed[0];
            type = "remove";
            update = function(node) {
                return node.mark(mark.removeFromSet(node.marks))
            }
        } else {
            return null
        }
        var updated = [];
        for (var i$2 = 0; i$2 < prev.childCount; i$2++) {
            updated.push(update(prev.child(i$2)))
        }
        if (prosemirrorModel.Fragment.from(updated).eq(cur)) {
            return {
                mark: mark,
                type: type
            }
        }
    }
    function looksLikeJoin(old, start, end, $newStart, $newEnd) {
        if (!$newStart.parent.isTextblock || end - start <= $newEnd.pos - $newStart.pos || skipClosingAndOpening($newStart, true, false) < $newEnd.pos) {
            return false
        }
        var $start = old.resolve(start);
        if ($start.parentOffset < $start.parent.content.size || !$start.parent.isTextblock) {
            return false
        }
        var $next = old.resolve(skipClosingAndOpening($start, true, true));
        if (!$next.parent.isTextblock || $next.pos > end || skipClosingAndOpening($next, true, false) < end) {
            return false
        }
        return $newStart.parent.content.cut($newStart.parentOffset).eq($next.parent.content)
    }
    function skipClosingAndOpening($pos, fromEnd, mayOpen) {
        var depth = $pos.depth
            , end = fromEnd ? $pos.end() : $pos.pos;
        while (depth > 0 && (fromEnd || $pos.indexAfter(depth) == $pos.node(depth).childCount)) {
            depth--;
            end++;
            fromEnd = false
        }
        if (mayOpen) {
            var next = $pos.node(depth).maybeChild($pos.indexAfter(depth));
            while (next && !next.isLeaf) {
                next = next.firstChild;
                end++
            }
        }
        return end
    }
    function findDiff(a, b, pos, preferredPos, preferredSide) {
        var start = a.findDiffStart(b, pos);
        if (start == null) {
            return null
        }
        var ref = a.findDiffEnd(b, pos + a.size, pos + b.size);
        var endA = ref.a;
        var endB = ref.b;
        if (preferredSide == "end") {
            var adjust = Math.max(0, start - Math.min(endA, endB));
            preferredPos -= endA + adjust - start
        }
        if (endA < start && a.size < b.size) {
            var move = preferredPos <= start && preferredPos >= endA ? start - preferredPos : 0;
            start -= move;
            endB = start + (endB - endA);
            endA = start
        } else if (endB < start) {
            var move$1 = preferredPos <= start && preferredPos >= endB ? start - preferredPos : 0;
            start -= move$1;
            endA = start + (endA - endB);
            endB = start
        }
        return {
            start: start,
            endA: endA,
            endB: endB
        }
    }
    function serializeForClipboard(view, slice) {
        var context = [];
        var content = slice.content;
        var openStart = slice.openStart;
        var openEnd = slice.openEnd;
        while (openStart > 1 && openEnd > 1 && content.childCount == 1 && content.firstChild.childCount == 1) {
            openStart--;
            openEnd--;
            var node = content.firstChild;
            context.push(node.type.name, node.type.hasRequiredAttrs() ? node.attrs : null);
            content = node.content
        }
        var serializer = view.someProp("clipboardSerializer") || prosemirrorModel.DOMSerializer.fromSchema(view.state.schema);
        var doc = detachedDoc()
            , wrap = doc.createElement("div");
        wrap.appendChild(serializer.serializeFragment(content, {
            document: doc
        }));
        var firstChild = wrap.firstChild, needsWrap;
        while (firstChild && firstChild.nodeType == 1 && (needsWrap = wrapMap[firstChild.nodeName.toLowerCase()])) {
            for (var i = needsWrap.length - 1; i >= 0; i--) {
                var wrapper = doc.createElement(needsWrap[i]);
                while (wrap.firstChild) {
                    wrapper.appendChild(wrap.firstChild)
                }
                wrap.appendChild(wrapper)
            }
            firstChild = wrap.firstChild
        }
        if (firstChild && firstChild.nodeType == 1) {
            firstChild.setAttribute("data-pm-slice", openStart + " " + openEnd + " " + JSON.stringify(context))
        }
        var text = view.someProp("clipboardTextSerializer", function(f) {
            return f(slice)
        }) || slice.content.textBetween(0, slice.content.size, "\n\n");
        return {
            dom: wrap,
            text: text
        }
    }
    function parseFromClipboard(view, text, html, plainText, $context) {
        var dom, inCode = $context.parent.type.spec.code, slice;
        if (!html && !text) {
            return null
        }
        var asText = text && (plainText || inCode || !html);
        if (asText) {
            view.someProp("transformPastedText", function(f) {
                text = f(text)
            });
            if (inCode) {
                return new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(view.state.schema.text(text)),0,0)
            }
            var parsed = view.someProp("clipboardTextParser", function(f) {
                return f(text, $context)
            });
            if (parsed) {
                slice = parsed
            } else {
                dom = document.createElement("div");
                text.trim().split(/(?:\r\n?|\n)+/).forEach(function(block) {
                    dom.appendChild(document.createElement("p")).textContent = block
                })
            }
        } else {
            view.someProp("transformPastedHTML", function(f) {
                html = f(html)
            });
            dom = readHTML(html)
        }
        var contextNode = dom && dom.querySelector("[data-pm-slice]");
        var sliceData = contextNode && /^(\d+) (\d+) (.*)/.exec(contextNode.getAttribute("data-pm-slice"));
        if (!slice) {
            var parser = view.someProp("clipboardParser") || view.someProp("domParser") || prosemirrorModel.DOMParser.fromSchema(view.state.schema);
            slice = parser.parseSlice(dom, {
                preserveWhitespace: !!(asText || sliceData),
                context: $context
            })
        }
        if (sliceData) {
            slice = addContext(closeSlice(slice, +sliceData[1], +sliceData[2]), sliceData[3])
        } else {
            slice = prosemirrorModel.Slice.maxOpen(normalizeSiblings(slice.content, $context), false)
        }
        view.someProp("transformPasted", function(f) {
            slice = f(slice)
        });
        return slice
    }
    function normalizeSiblings(fragment, $context) {
        if (fragment.childCount < 2) {
            return fragment
        }
        var loop = function(d) {
            var parent = $context.node(d);
            var match = parent.contentMatchAt($context.index(d));
            var lastWrap = void 0
                , result = [];
            fragment.forEach(function(node) {
                if (!result) {
                    return
                }
                var wrap = match.findWrapping(node.type), inLast;
                if (!wrap) {
                    return result = null
                }
                if (inLast = result.length && lastWrap.length && addToSibling(wrap, lastWrap, node, result[result.length - 1], 0)) {
                    result[result.length - 1] = inLast
                } else {
                    if (result.length) {
                        result[result.length - 1] = closeRight(result[result.length - 1], lastWrap.length)
                    }
                    var wrapped = withWrappers(node, wrap);
                    result.push(wrapped);
                    match = match.matchType(wrapped.type, wrapped.attrs);
                    lastWrap = wrap
                }
            });
            if (result) {
                return {
                    v: prosemirrorModel.Fragment.from(result)
                }
            }
        };
        for (var d = $context.depth; d >= 0; d--) {
            var returned = loop(d);
            if (returned)
                return returned.v
        }
        return fragment
    }
    function withWrappers(node, wrap, from) {
        if (from === void 0)
            from = 0;
        for (var i = wrap.length - 1; i >= from; i--) {
            node = wrap[i].create(null, prosemirrorModel.Fragment.from(node))
        }
        return node
    }
    function addToSibling(wrap, lastWrap, node, sibling, depth) {
        if (depth < wrap.length && depth < lastWrap.length && wrap[depth] == lastWrap[depth]) {
            var inner = addToSibling(wrap, lastWrap, node, sibling.lastChild, depth + 1);
            if (inner) {
                return sibling.copy(sibling.content.replaceChild(sibling.childCount - 1, inner))
            }
            var match = sibling.contentMatchAt(sibling.childCount);
            if (match.matchType(depth == wrap.length - 1 ? node.type : wrap[depth + 1])) {
                return sibling.copy(sibling.content.append(prosemirrorModel.Fragment.from(withWrappers(node, wrap, depth + 1))))
            }
        }
    }
    function closeRight(node, depth) {
        if (depth == 0) {
            return node
        }
        var fragment = node.content.replaceChild(node.childCount - 1, closeRight(node.lastChild, depth - 1));
        var fill = node.contentMatchAt(node.childCount).fillBefore(prosemirrorModel.Fragment.empty, true);
        return node.copy(fragment.append(fill))
    }
    function closeRange(fragment, side, from, to, depth, openEnd) {
        var node = side < 0 ? fragment.firstChild : fragment.lastChild
            , inner = node.content;
        if (depth < to - 1) {
            inner = closeRange(inner, side, from, to, depth + 1, openEnd)
        }
        if (depth >= from) {
            inner = side < 0 ? node.contentMatchAt(0).fillBefore(inner, fragment.childCount > 1 || openEnd <= depth).append(inner) : inner.append(node.contentMatchAt(node.childCount).fillBefore(prosemirrorModel.Fragment.empty, true))
        }
        return fragment.replaceChild(side < 0 ? 0 : fragment.childCount - 1, node.copy(inner))
    }
    function closeSlice(slice, openStart, openEnd) {
        if (openStart < slice.openStart) {
            slice = new prosemirrorModel.Slice(closeRange(slice.content, -1, openStart, slice.openStart, 0, slice.openEnd),openStart,slice.openEnd)
        }
        if (openEnd < slice.openEnd) {
            slice = new prosemirrorModel.Slice(closeRange(slice.content, 1, openEnd, slice.openEnd, 0, 0),slice.openStart,openEnd)
        }
        return slice
    }
    var wrapMap = {
        thead: ["table"],
        tbody: ["table"],
        tfoot: ["table"],
        caption: ["table"],
        colgroup: ["table"],
        col: ["table", "colgroup"],
        tr: ["table", "tbody"],
        td: ["table", "tbody", "tr"],
        th: ["table", "tbody", "tr"]
    };
    var _detachedDoc = null;
    function detachedDoc() {
        return _detachedDoc || (_detachedDoc = document.implementation.createHTMLDocument("title"))
    }
    function readHTML(html) {
        var metas = /(\s*<meta [^>]*>)*/.exec(html);
        if (metas) {
            html = html.slice(metas[0].length)
        }
        var elt = detachedDoc().createElement("div");
        var firstTag = /(?:<meta [^>]*>)*<([a-z][^>\s]+)/i.exec(html), wrap, depth = 0;
        if (wrap = firstTag && wrapMap[firstTag[1].toLowerCase()]) {
            html = wrap.map(function(n) {
                return "<" + n + ">"
            }).join("") + html + wrap.map(function(n) {
                return "</" + n + ">"
            }).reverse().join("");
            depth = wrap.length
        }
        elt.innerHTML = html;
        for (var i = 0; i < depth; i++) {
            elt = elt.firstChild
        }
        return elt
    }
    function addContext(slice, context) {
        if (!slice.size) {
            return slice
        }
        var schema = slice.content.firstChild.type.schema, array;
        try {
            array = JSON.parse(context)
        } catch (e) {
            return slice
        }
        var content = slice.content;
        var openStart = slice.openStart;
        var openEnd = slice.openEnd;
        for (var i = array.length - 2; i >= 0; i -= 2) {
            var type = schema.nodes[array[i]];
            if (!type || type.hasRequiredAttrs()) {
                break
            }
            content = prosemirrorModel.Fragment.from(type.create(array[i + 1], content));
            openStart++;
            openEnd++
        }
        return new prosemirrorModel.Slice(content,openStart,openEnd)
    }
    var observeOptions = {
        childList: true,
        characterData: true,
        characterDataOldValue: true,
        attributes: true,
        attributeOldValue: true,
        subtree: true
    };
    var useCharData = result.ie && result.ie_version <= 11;
    var SelectionState = function SelectionState() {
        this.anchorNode = this.anchorOffset = this.focusNode = this.focusOffset = null
    };
    SelectionState.prototype.set = function set(sel) {
        this.anchorNode = sel.anchorNode;
        this.anchorOffset = sel.anchorOffset;
        this.focusNode = sel.focusNode;
        this.focusOffset = sel.focusOffset
    }
    ;
    SelectionState.prototype.eq = function eq(sel) {
        return sel.anchorNode == this.anchorNode && sel.anchorOffset == this.anchorOffset && sel.focusNode == this.focusNode && sel.focusOffset == this.focusOffset
    }
    ;
    var DOMObserver = function DOMObserver(view, handleDOMChange) {
        var this$1 = this;
        this.view = view;
        this.handleDOMChange = handleDOMChange;
        this.queue = [];
        this.flushingSoon = -1;
        this.observer = window.MutationObserver && new window.MutationObserver(function(mutations) {
                for (var i = 0; i < mutations.length; i++) {
                    this$1.queue.push(mutations[i])
                }
                if (result.ie && result.ie_version <= 11 && mutations.some(function(m) {
                    return m.type == "childList" && m.removedNodes.length || m.type == "characterData" && m.oldValue.length > m.target.nodeValue.length
                })) {
                    this$1.flushSoon()
                } else {
                    this$1.flush()
                }
            }
        );
        this.currentSelection = new SelectionState;
        if (useCharData) {
            this.onCharData = function(e) {
                this$1.queue.push({
                    target: e.target,
                    type: "characterData",
                    oldValue: e.prevValue
                });
                this$1.flushSoon()
            }
        }
        this.onSelectionChange = this.onSelectionChange.bind(this);
        this.suppressingSelectionUpdates = false
    };
    DOMObserver.prototype.flushSoon = function flushSoon() {
        var this$1 = this;
        if (this.flushingSoon < 0) {
            this.flushingSoon = window.setTimeout(function() {
                this$1.flushingSoon = -1;
                this$1.flush()
            }, 20)
        }
    }
    ;
    DOMObserver.prototype.forceFlush = function forceFlush() {
        if (this.flushingSoon > -1) {
            window.clearTimeout(this.flushingSoon);
            this.flushingSoon = -1;
            this.flush()
        }
    }
    ;
    DOMObserver.prototype.start = function start() {
        if (this.observer) {
            this.observer.observe(this.view.dom, observeOptions)
        }
        if (useCharData) {
            this.view.dom.addEventListener("DOMCharacterDataModified", this.onCharData)
        }
        this.connectSelection()
    }
    ;
    DOMObserver.prototype.stop = function stop() {
        var this$1 = this;
        if (this.observer) {
            var take = this.observer.takeRecords();
            if (take.length) {
                for (var i = 0; i < take.length; i++) {
                    this.queue.push(take[i])
                }
                window.setTimeout(function() {
                    return this$1.flush()
                }, 20)
            }
            this.observer.disconnect()
        }
        if (useCharData) {
            this.view.dom.removeEventListener("DOMCharacterDataModified", this.onCharData)
        }
        this.disconnectSelection()
    }
    ;
    DOMObserver.prototype.connectSelection = function connectSelection() {
        this.view.dom.ownerDocument.addEventListener("selectionchange", this.onSelectionChange)
    }
    ;
    DOMObserver.prototype.disconnectSelection = function disconnectSelection() {
        this.view.dom.ownerDocument.removeEventListener("selectionchange", this.onSelectionChange)
    }
    ;
    DOMObserver.prototype.suppressSelectionUpdates = function suppressSelectionUpdates() {
        var this$1 = this;
        this.suppressingSelectionUpdates = true;
        setTimeout(function() {
            return this$1.suppressingSelectionUpdates = false
        }, 50)
    }
    ;
    DOMObserver.prototype.onSelectionChange = function onSelectionChange() {
        if (!hasFocusAndSelection(this.view)) {
            return
        }
        if (this.suppressingSelectionUpdates) {
            return selectionToDOM(this.view)
        }
        if (result.ie && result.ie_version <= 11 && !this.view.state.selection.empty) {
            var sel = this.view.root.getSelection();
            if (sel.focusNode && isEquivalentPosition(sel.focusNode, sel.focusOffset, sel.anchorNode, sel.anchorOffset)) {
                return this.flushSoon()
            }
        }
        this.flush()
    }
    ;
    DOMObserver.prototype.setCurSelection = function setCurSelection() {
        this.currentSelection.set(this.view.root.getSelection())
    }
    ;
    DOMObserver.prototype.ignoreSelectionChange = function ignoreSelectionChange(sel) {
        if (sel.rangeCount == 0) {
            return true
        }
        var container = sel.getRangeAt(0).commonAncestorContainer;
        var desc = this.view.docView.nearestDesc(container);
        if (desc && desc.ignoreMutation({
            type: "selection",
            target: container.nodeType == 3 ? container.parentNode : container
        })) {
            this.setCurSelection();
            return true
        }
    }
    ;
    DOMObserver.prototype.flush = function flush() {
        if (!this.view.docView || this.flushingSoon > -1) {
            return
        }
        var mutations = this.observer ? this.observer.takeRecords() : [];
        if (this.queue.length) {
            mutations = this.queue.concat(mutations);
            this.queue.length = 0
        }
        var sel = this.view.root.getSelection();
        var newSel = !this.suppressingSelectionUpdates && !this.currentSelection.eq(sel) && hasSelection(this.view) && !this.ignoreSelectionChange(sel);
        var from = -1
            , to = -1
            , typeOver = false
            , added = [];
        if (this.view.editable) {
            for (var i = 0; i < mutations.length; i++) {
                var result$1 = this.registerMutation(mutations[i], added);
                if (result$1) {
                    from = from < 0 ? result$1.from : Math.min(result$1.from, from);
                    to = to < 0 ? result$1.to : Math.max(result$1.to, to);
                    if (result$1.typeOver) {
                        typeOver = true
                    }
                }
            }
        }
        if (result.gecko && added.length > 1) {
            var brs = added.filter(function(n) {
                return n.nodeName == "BR"
            });
            if (brs.length == 2) {
                var a = brs[0];
                var b = brs[1];
                if (a.parentNode && a.parentNode.parentNode == b.parentNode) {
                    b.remove()
                } else {
                    a.remove()
                }
            }
        }
        if (from > -1 || newSel) {
            if (from > -1) {
                this.view.docView.markDirty(from, to);
                checkCSS(this.view)
            }
            this.handleDOMChange(from, to, typeOver, added);
            if (this.view.docView.dirty) {
                this.view.updateState(this.view.state)
            } else if (!this.currentSelection.eq(sel)) {
                selectionToDOM(this.view)
            }
        }
    }
    ;
    DOMObserver.prototype.registerMutation = function registerMutation(mut, added) {
        if (added.indexOf(mut.target) > -1) {
            return null
        }
        var desc = this.view.docView.nearestDesc(mut.target);
        if (mut.type == "attributes" && (desc == this.view.docView || mut.attributeName == "contenteditable" || mut.attributeName == "style" && !mut.oldValue && !mut.target.getAttribute("style"))) {
            return null
        }
        if (!desc || desc.ignoreMutation(mut)) {
            return null
        }
        if (mut.type == "childList") {
            var prev = mut.previousSibling
                , next = mut.nextSibling;
            if (result.ie && result.ie_version <= 11 && mut.addedNodes.length) {
                for (var i = 0; i < mut.addedNodes.length; i++) {
                    var ref = mut.addedNodes[i];
                    var previousSibling = ref.previousSibling;
                    var nextSibling = ref.nextSibling;
                    if (!previousSibling || Array.prototype.indexOf.call(mut.addedNodes, previousSibling) < 0) {
                        prev = previousSibling
                    }
                    if (!nextSibling || Array.prototype.indexOf.call(mut.addedNodes, nextSibling) < 0) {
                        next = nextSibling
                    }
                }
            }
            var fromOffset = prev && prev.parentNode == mut.target ? domIndex(prev) + 1 : 0;
            var from = desc.localPosFromDOM(mut.target, fromOffset, -1);
            var toOffset = next && next.parentNode == mut.target ? domIndex(next) : mut.target.childNodes.length;
            for (var i$1 = 0; i$1 < mut.addedNodes.length; i$1++) {
                added.push(mut.addedNodes[i$1])
            }
            var to = desc.localPosFromDOM(mut.target, toOffset, 1);
            return {
                from: from,
                to: to
            }
        } else if (mut.type == "attributes") {
            return {
                from: desc.posAtStart - desc.border,
                to: desc.posAtEnd + desc.border
            }
        } else {
            return {
                from: desc.posAtStart,
                to: desc.posAtEnd,
                typeOver: mut.target.nodeValue == mut.oldValue
            }
        }
    }
    ;
    var cssChecked = false;
    function checkCSS(view) {
        if (cssChecked) {
            return
        }
        cssChecked = true;
        if (getComputedStyle(view.dom).whiteSpace == "normal") {
            console["warn"]("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package.")
        }
    }
    var handlers = {}
        , editHandlers = {};
    function initInput(view) {
        view.shiftKey = false;
        view.mouseDown = null;
        view.lastKeyCode = null;
        view.lastKeyCodeTime = 0;
        view.lastClick = {
            time: 0,
            x: 0,
            y: 0,
            type: ""
        };
        view.lastSelectionOrigin = null;
        view.lastSelectionTime = 0;
        view.lastIOSEnter = 0;
        view.composing = false;
        view.composingTimeout = null;
        view.compositionNodes = [];
        view.compositionEndedAt = -2e8;
        view.domObserver = new DOMObserver(view,function(from, to, typeOver, added) {
                return readDOMChange(view, from, to, typeOver, added)
            }
        );
        view.domObserver.start();
        view.domChangeCount = 0;
        view.eventHandlers = Object.create(null);
        var loop = function(event) {
            var handler = handlers[event];
            view.dom.addEventListener(event, view.eventHandlers[event] = function(event) {
                    if (eventBelongsToView(view, event) && !runCustomHandler(view, event) && (view.editable || !(event.type in editHandlers))) {
                        handler(view, event)
                    }
                }
            )
        };
        for (var event in handlers)
            loop(event);
        if (result.safari) {
            view.dom.addEventListener("input", function() {
                return null
            })
        }
        ensureListeners(view)
    }
    function setSelectionOrigin(view, origin) {
        view.lastSelectionOrigin = origin;
        view.lastSelectionTime = Date.now()
    }
    function destroyInput(view) {
        view.domObserver.stop();
        for (var type in view.eventHandlers) {
            view.dom.removeEventListener(type, view.eventHandlers[type])
        }
        clearTimeout(view.composingTimeout)
    }
    function ensureListeners(view) {
        view.someProp("handleDOMEvents", function(currentHandlers) {
            for (var type in currentHandlers) {
                if (!view.eventHandlers[type]) {
                    view.dom.addEventListener(type, view.eventHandlers[type] = function(event) {
                            return runCustomHandler(view, event)
                        }
                    )
                }
            }
        })
    }
    function runCustomHandler(view, event) {
        return view.someProp("handleDOMEvents", function(handlers) {
            var handler = handlers[event.type];
            return handler ? handler(view, event) || event.defaultPrevented : false
        })
    }
    function eventBelongsToView(view, event) {
        if (!event.bubbles) {
            return true
        }
        if (event.defaultPrevented) {
            return false
        }
        for (var node = event.target; node != view.dom; node = node.parentNode) {
            if (!node || node.nodeType == 11 || node.pmViewDesc && node.pmViewDesc.stopEvent(event)) {
                return false
            }
        }
        return true
    }
    function dispatchEvent(view, event) {
        if (!runCustomHandler(view, event) && handlers[event.type] && (view.editable || !(event.type in editHandlers))) {
            handlers[event.type](view, event)
        }
    }
    editHandlers.keydown = function(view, event) {
        view.shiftKey = event.keyCode == 16 || event.shiftKey;
        if (inOrNearComposition(view, event)) {
            return
        }
        view.domObserver.forceFlush();
        view.lastKeyCode = event.keyCode;
        view.lastKeyCodeTime = Date.now();
        if (result.ios && event.keyCode == 13 && !event.ctrlKey && !event.altKey && !event.metaKey) {
            var now = Date.now();
            view.lastIOSEnter = now;
            setTimeout(function() {
                if (view.lastIOSEnter == now) {
                    view.someProp("handleKeyDown", function(f) {
                        return f(view, keyEvent(13, "Enter"))
                    });
                    view.lastIOSEnter = 0
                }
            }, 50)
        } else if (view.someProp("handleKeyDown", function(f) {
            return f(view, event)
        }) || captureKeyDown(view, event)) {
            event.preventDefault()
        } else {
            setSelectionOrigin(view, "key")
        }
    }
    ;
    editHandlers.keyup = function(view, e) {
        if (e.keyCode == 16) {
            view.shiftKey = false
        }
    }
    ;
    editHandlers.keypress = function(view, event) {
        if (inOrNearComposition(view, event) || !event.charCode || event.ctrlKey && !event.altKey || result.mac && event.metaKey) {
            return
        }
        if (view.someProp("handleKeyPress", function(f) {
            return f(view, event)
        })) {
            event.preventDefault();
            return
        }
        var sel = view.state.selection;
        if (!(sel instanceof prosemirrorState.TextSelection) || !sel.$from.sameParent(sel.$to)) {
            var text = String.fromCharCode(event.charCode);
            if (!view.someProp("handleTextInput", function(f) {
                return f(view, sel.$from.pos, sel.$to.pos, text)
            })) {
                view.dispatch(view.state.tr.insertText(text).scrollIntoView())
            }
            event.preventDefault()
        }
    }
    ;
    function eventCoords(event) {
        return {
            left: event.clientX,
            top: event.clientY
        }
    }
    function isNear(event, click) {
        var dx = click.x - event.clientX
            , dy = click.y - event.clientY;
        return dx * dx + dy * dy < 100
    }
    function runHandlerOnContext(view, propName, pos, inside, event) {
        if (inside == -1) {
            return false
        }
        var $pos = view.state.doc.resolve(inside);
        var loop = function(i) {
            if (view.someProp(propName, function(f) {
                return i > $pos.depth ? f(view, pos, $pos.nodeAfter, $pos.before(i), event, true) : f(view, pos, $pos.node(i), $pos.before(i), event, false)
            })) {
                return {
                    v: true
                }
            }
        };
        for (var i = $pos.depth + 1; i > 0; i--) {
            var returned = loop(i);
            if (returned)
                return returned.v
        }
        return false
    }
    function updateSelection(view, selection, origin) {
        if (!view.focused) {
            view.focus()
        }
        var tr = view.state.tr.setSelection(selection);
        if (origin == "pointer") {
            tr.setMeta("pointer", true)
        }
        view.dispatch(tr)
    }
    function selectClickedLeaf(view, inside) {
        if (inside == -1) {
            return false
        }
        var $pos = view.state.doc.resolve(inside)
            , node = $pos.nodeAfter;
        if (node && node.isAtom && prosemirrorState.NodeSelection.isSelectable(node)) {
            updateSelection(view, new prosemirrorState.NodeSelection($pos), "pointer");
            return true
        }
        return false
    }
    function selectClickedNode(view, inside) {
        if (inside == -1) {
            return false
        }
        var sel = view.state.selection, selectedNode, selectAt;
        if (sel instanceof prosemirrorState.NodeSelection) {
            selectedNode = sel.node
        }
        var $pos = view.state.doc.resolve(inside);
        for (var i = $pos.depth + 1; i > 0; i--) {
            var node = i > $pos.depth ? $pos.nodeAfter : $pos.node(i);
            if (prosemirrorState.NodeSelection.isSelectable(node)) {
                if (selectedNode && sel.$from.depth > 0 && i >= sel.$from.depth && $pos.before(sel.$from.depth + 1) == sel.$from.pos) {
                    selectAt = $pos.before(sel.$from.depth)
                } else {
                    selectAt = $pos.before(i)
                }
                break
            }
        }
        if (selectAt != null) {
            updateSelection(view, prosemirrorState.NodeSelection.create(view.state.doc, selectAt), "pointer");
            return true
        } else {
            return false
        }
    }
    function handleSingleClick(view, pos, inside, event, selectNode) {
        return runHandlerOnContext(view, "handleClickOn", pos, inside, event) || view.someProp("handleClick", function(f) {
            return f(view, pos, event)
        }) || (selectNode ? selectClickedNode(view, inside) : selectClickedLeaf(view, inside))
    }
    function handleDoubleClick(view, pos, inside, event) {
        return runHandlerOnContext(view, "handleDoubleClickOn", pos, inside, event) || view.someProp("handleDoubleClick", function(f) {
            return f(view, pos, event)
        })
    }
    function handleTripleClick(view, pos, inside, event) {
        return runHandlerOnContext(view, "handleTripleClickOn", pos, inside, event) || view.someProp("handleTripleClick", function(f) {
            return f(view, pos, event)
        }) || defaultTripleClick(view, inside)
    }
    function defaultTripleClick(view, inside) {
        var doc = view.state.doc;
        if (inside == -1) {
            if (doc.inlineContent) {
                updateSelection(view, prosemirrorState.TextSelection.create(doc, 0, doc.content.size), "pointer");
                return true
            }
            return false
        }
        var $pos = doc.resolve(inside);
        for (var i = $pos.depth + 1; i > 0; i--) {
            var node = i > $pos.depth ? $pos.nodeAfter : $pos.node(i);
            var nodePos = $pos.before(i);
            if (node.inlineContent) {
                updateSelection(view, prosemirrorState.TextSelection.create(doc, nodePos + 1, nodePos + 1 + node.content.size), "pointer")
            } else if (prosemirrorState.NodeSelection.isSelectable(node)) {
                updateSelection(view, prosemirrorState.NodeSelection.create(doc, nodePos), "pointer")
            } else {
                continue
            }
            return true
        }
    }
    function forceDOMFlush(view) {
        return endComposition(view)
    }
    var selectNodeModifier = result.mac ? "metaKey" : "ctrlKey";
    handlers.mousedown = function(view, event) {
        view.shiftKey = event.shiftKey;
        var flushed = forceDOMFlush(view);
        var now = Date.now()
            , type = "singleClick";
        if (now - view.lastClick.time < 500 && isNear(event, view.lastClick) && !event[selectNodeModifier]) {
            if (view.lastClick.type == "singleClick") {
                type = "doubleClick"
            } else if (view.lastClick.type == "doubleClick") {
                type = "tripleClick"
            }
        }
        view.lastClick = {
            time: now,
            x: event.clientX,
            y: event.clientY,
            type: type
        };
        var pos = view.posAtCoords(eventCoords(event));
        if (!pos) {
            return
        }
        if (type == "singleClick") {
            view.mouseDown = new MouseDown(view,pos,event,flushed)
        } else if ((type == "doubleClick" ? handleDoubleClick : handleTripleClick)(view, pos.pos, pos.inside, event)) {
            event.preventDefault()
        } else {
            setSelectionOrigin(view, "pointer")
        }
    }
    ;
    var MouseDown = function MouseDown(view, pos, event, flushed) {
        var this$1 = this;
        this.view = view;
        this.startDoc = view.state.doc;
        this.pos = pos;
        this.event = event;
        this.flushed = flushed;
        this.selectNode = event[selectNodeModifier];
        this.allowDefault = event.shiftKey;
        var targetNode, targetPos;
        if (pos.inside > -1) {
            targetNode = view.state.doc.nodeAt(pos.inside);
            targetPos = pos.inside
        } else {
            var $pos = view.state.doc.resolve(pos.pos);
            targetNode = $pos.parent;
            targetPos = $pos.depth ? $pos.before() : 0
        }
        this.mightDrag = null;
        var target = flushed ? null : event.target;
        var targetDesc = target ? view.docView.nearestDesc(target, true) : null;
        this.target = targetDesc ? targetDesc.dom : null;
        if (targetNode.type.spec.draggable && targetNode.type.spec.selectable !== false || view.state.selection instanceof prosemirrorState.NodeSelection && targetPos == view.state.selection.from) {
            this.mightDrag = {
                node: targetNode,
                pos: targetPos,
                addAttr: this.target && !this.target.draggable,
                setUneditable: this.target && result.gecko && !this.target.hasAttribute("contentEditable")
            }
        }
        if (this.target && this.mightDrag && (this.mightDrag.addAttr || this.mightDrag.setUneditable)) {
            this.view.domObserver.stop();
            if (this.mightDrag.addAttr) {
                this.target.draggable = true
            }
            if (this.mightDrag.setUneditable) {
                setTimeout(function() {
                    return this$1.target.setAttribute("contentEditable", "false")
                }, 20)
            }
            this.view.domObserver.start()
        }
        view.root.addEventListener("mouseup", this.up = this.up.bind(this));
        view.root.addEventListener("mousemove", this.move = this.move.bind(this));
        setSelectionOrigin(view, "pointer")
    };
    MouseDown.prototype.done = function done() {
        this.view.root.removeEventListener("mouseup", this.up);
        this.view.root.removeEventListener("mousemove", this.move);
        if (this.mightDrag && this.target) {
            this.view.domObserver.stop();
            if (this.mightDrag.addAttr) {
                this.target.removeAttribute("draggable")
            }
            if (this.mightDrag.setUneditable) {
                this.target.removeAttribute("contentEditable")
            }
            this.view.domObserver.start()
        }
        this.view.mouseDown = null
    }
    ;
    MouseDown.prototype.up = function up(event) {
        this.done();
        if (!this.view.dom.contains(event.target.nodeType == 3 ? event.target.parentNode : event.target)) {
            return
        }
        var pos = this.pos;
        if (this.view.state.doc != this.startDoc) {
            pos = this.view.posAtCoords(eventCoords(event))
        }
        if (this.allowDefault || !pos) {
            setSelectionOrigin(this.view, "pointer")
        } else if (handleSingleClick(this.view, pos.pos, pos.inside, event, this.selectNode)) {
            event.preventDefault()
        } else if (this.flushed || result.chrome && !(this.view.state.selection instanceof prosemirrorState.TextSelection) && (pos.pos == this.view.state.selection.from || pos.pos == this.view.state.selection.to)) {
            updateSelection(this.view, prosemirrorState.Selection.near(this.view.state.doc.resolve(pos.pos)), "pointer");
            event.preventDefault()
        } else {
            setSelectionOrigin(this.view, "pointer")
        }
    }
    ;
    MouseDown.prototype.move = function move(event) {
        if (!this.allowDefault && (Math.abs(this.event.x - event.clientX) > 4 || Math.abs(this.event.y - event.clientY) > 4)) {
            this.allowDefault = true
        }
        setSelectionOrigin(this.view, "pointer")
    }
    ;
    handlers.touchdown = function(view) {
        forceDOMFlush(view);
        setSelectionOrigin(view, "pointer")
    }
    ;
    handlers.contextmenu = function(view) {
        return forceDOMFlush(view)
    }
    ;
    function inOrNearComposition(view, event) {
        if (view.composing) {
            return true
        }
        if (result.safari && Math.abs(event.timeStamp - view.compositionEndedAt) < 500) {
            view.compositionEndedAt = -2e8;
            return true
        }
        return false
    }
    var timeoutComposition = result.android ? 5e3 : -1;
    editHandlers.compositionstart = editHandlers.compositionupdate = function(view) {
        if (!view.composing) {
            view.domObserver.flush();
            var state = view.state;
            var $pos = state.selection.$from;
            if (state.selection.empty && (state.storedMarks || !$pos.textOffset && $pos.parentOffset && $pos.nodeBefore.marks.some(function(m) {
                return m.type.spec.inclusive === false
            }))) {
                view.markCursor = view.state.storedMarks || $pos.marks();
                endComposition(view, true);
                view.markCursor = null
            } else {
                endComposition(view);
                if (result.gecko && state.selection.empty && $pos.parentOffset && !$pos.textOffset && $pos.nodeBefore.marks.length) {
                    var sel = view.root.getSelection();
                    for (var node = sel.focusNode, offset = sel.focusOffset; node && node.nodeType == 1 && offset != 0; ) {
                        var before = offset < 0 ? node.lastChild : node.childNodes[offset - 1];
                        if (!before) {
                            break
                        }
                        if (before.nodeType == 3) {
                            sel.collapse(before, before.nodeValue.length);
                            break
                        } else {
                            node = before;
                            offset = -1
                        }
                    }
                }
            }
            view.composing = true
        }
        scheduleComposeEnd(view, timeoutComposition)
    }
    ;
    editHandlers.compositionend = function(view, event) {
        if (view.composing) {
            view.composing = false;
            view.compositionEndedAt = event.timeStamp;
            scheduleComposeEnd(view, 20)
        }
    }
    ;
    function scheduleComposeEnd(view, delay) {
        clearTimeout(view.composingTimeout);
        if (delay > -1) {
            view.composingTimeout = setTimeout(function() {
                return endComposition(view)
            }, delay)
        }
    }
    function endComposition(view, forceUpdate) {
        view.domObserver.forceFlush();
        view.composing = false;
        while (view.compositionNodes.length > 0) {
            view.compositionNodes.pop().markParentsDirty()
        }
        if (forceUpdate || view.docView.dirty) {
            var sel = selectionFromDOM(view);
            if (!sel.eq(view.state.selection)) {
                view.dispatch(view.state.tr.setSelection(sel))
            } else {
                view.updateState(view.state)
            }
            return true
        }
        return false
    }
    function captureCopy(view, dom) {
        var doc = view.dom.ownerDocument;
        var wrap = doc.body.appendChild(doc.createElement("div"));
        wrap.appendChild(dom);
        wrap.style.cssText = "position: fixed; left: -10000px; top: 10px";
        var sel = getSelection()
            , range = doc.createRange();
        range.selectNodeContents(dom);
        view.dom.blur();
        sel.removeAllRanges();
        sel.addRange(range);
        setTimeout(function() {
            doc.body.removeChild(wrap);
            view.focus()
        }, 50)
    }
    var brokenClipboardAPI = result.ie && result.ie_version < 15 || result.ios && result.webkit_version < 604;
    handlers.copy = editHandlers.cut = function(view, e) {
        var sel = view.state.selection
            , cut = e.type == "cut";
        if (sel.empty) {
            return
        }
        var data = brokenClipboardAPI ? null : e.clipboardData;
        var slice = sel.content();
        var ref = serializeForClipboard(view, slice);
        var dom = ref.dom;
        var text = ref.text;
        if (data) {
            e.preventDefault();
            data.clearData();
            data.setData("text/html", dom.innerHTML);
            data.setData("text/plain", text)
        } else {
            captureCopy(view, dom)
        }
        if (cut) {
            view.dispatch(view.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent", "cut"))
        }
    }
    ;
    function sliceSingleNode(slice) {
        return slice.openStart == 0 && slice.openEnd == 0 && slice.content.childCount == 1 ? slice.content.firstChild : null
    }
    function capturePaste(view, e) {
        var doc = view.dom.ownerDocument;
        var plainText = view.shiftKey || view.state.selection.$from.parent.type.spec.code;
        var target = doc.body.appendChild(doc.createElement(plainText ? "textarea" : "div"));
        if (!plainText) {
            target.contentEditable = "true"
        }
        target.style.cssText = "position: fixed; left: -10000px; top: 10px";
        target.focus();
        setTimeout(function() {
            view.focus();
            doc.body.removeChild(target);
            if (plainText) {
                doPaste(view, target.value, null, e)
            } else {
                doPaste(view, target.textContent, target.innerHTML, e)
            }
        }, 50)
    }
    function doPaste(view, text, html, e) {
        var slice = parseFromClipboard(view, text, html, view.shiftKey, view.state.selection.$from);
        if (view.someProp("handlePaste", function(f) {
            return f(view, e, slice || prosemirrorModel.Slice.empty)
        }) || !slice) {
            return
        }
        var singleNode = sliceSingleNode(slice);
        var tr = singleNode ? view.state.tr.replaceSelectionWith(singleNode, view.shiftKey) : view.state.tr.replaceSelection(slice);
        view.dispatch(tr.scrollIntoView().setMeta("paste", true).setMeta("uiEvent", "paste"))
    }
    editHandlers.paste = function(view, e) {
        var data = brokenClipboardAPI ? null : e.clipboardData;
        var html = data && data.getData("text/html")
            , text = data && data.getData("text/plain");
        if (data && (html || text || data.files.length)) {
            doPaste(view, text, html, e);
            e.preventDefault()
        } else {
            capturePaste(view, e)
        }
    }
    ;
    var Dragging = function Dragging(slice, move) {
        this.slice = slice;
        this.move = move
    };
    var dragCopyModifier = result.mac ? "altKey" : "ctrlKey";
    handlers.dragstart = function(view, e) {
        var mouseDown = view.mouseDown;
        if (mouseDown) {
            mouseDown.done()
        }
        if (!e.dataTransfer) {
            return
        }
        var sel = view.state.selection;
        var pos = sel.empty ? null : view.posAtCoords(eventCoords(e));
        if (pos && pos.pos >= sel.from && pos.pos <= (sel instanceof prosemirrorState.NodeSelection ? sel.to - 1 : sel.to))
            ;
        else if (mouseDown && mouseDown.mightDrag) {
            view.dispatch(view.state.tr.setSelection(prosemirrorState.NodeSelection.create(view.state.doc, mouseDown.mightDrag.pos)))
        } else if (e.target && e.target.nodeType == 1) {
            var desc = view.docView.nearestDesc(e.target, true);
            if (!desc || !desc.node.type.spec.draggable || desc == view.docView) {
                return
            }
            view.dispatch(view.state.tr.setSelection(prosemirrorState.NodeSelection.create(view.state.doc, desc.posBefore)))
        }
        var slice = view.state.selection.content();
        var ref = serializeForClipboard(view, slice);
        var dom = ref.dom;
        var text = ref.text;
        e.dataTransfer.clearData();
        e.dataTransfer.setData(brokenClipboardAPI ? "Text" : "text/html", dom.innerHTML);
        if (!brokenClipboardAPI) {
            e.dataTransfer.setData("text/plain", text)
        }
        view.dragging = new Dragging(slice,!e[dragCopyModifier])
    }
    ;
    handlers.dragend = function(view) {
        window.setTimeout(function() {
            return view.dragging = null
        }, 50)
    }
    ;
    editHandlers.dragover = editHandlers.dragenter = function(_, e) {
        return e.preventDefault()
    }
    ;
    editHandlers.drop = function(view, e) {
        var dragging = view.dragging;
        view.dragging = null;
        if (!e.dataTransfer) {
            return
        }
        var eventPos = view.posAtCoords(eventCoords(e));
        if (!eventPos) {
            return
        }
        var $mouse = view.state.doc.resolve(eventPos.pos);
        if (!$mouse) {
            return
        }
        var slice = dragging && dragging.slice || parseFromClipboard(view, e.dataTransfer.getData(brokenClipboardAPI ? "Text" : "text/plain"), brokenClipboardAPI ? null : e.dataTransfer.getData("text/html"), false, $mouse);
        if (view.someProp("handleDrop", function(f) {
            return f(view, e, slice || prosemirrorModel.Slice.empty, dragging && dragging.move)
        })) {
            e.preventDefault();
            return
        }
        if (!slice) {
            return
        }
        e.preventDefault();
        var insertPos = slice ? prosemirrorTransform.dropPoint(view.state.doc, $mouse.pos, slice) : $mouse.pos;
        if (insertPos == null) {
            insertPos = $mouse.pos
        }
        var tr = view.state.tr;
        if (dragging && dragging.move) {
            tr.deleteSelection()
        }
        var pos = tr.mapping.map(insertPos);
        var isNode = slice.openStart == 0 && slice.openEnd == 0 && slice.content.childCount == 1;
        var beforeInsert = tr.doc;
        if (isNode) {
            tr.replaceRangeWith(pos, pos, slice.content.firstChild)
        } else {
            tr.replaceRange(pos, pos, slice)
        }
        if (tr.doc.eq(beforeInsert)) {
            return
        }
        var $pos = tr.doc.resolve(pos);
        if (isNode && prosemirrorState.NodeSelection.isSelectable(slice.content.firstChild) && $pos.nodeAfter && $pos.nodeAfter.sameMarkup(slice.content.firstChild)) {
            tr.setSelection(new prosemirrorState.NodeSelection($pos))
        } else {
            tr.setSelection(selectionBetween(view, $pos, tr.doc.resolve(tr.mapping.map(insertPos))))
        }
        view.focus();
        view.dispatch(tr.setMeta("uiEvent", "drop"))
    }
    ;
    handlers.focus = function(view) {
        if (!view.focused) {
            view.domObserver.stop();
            view.dom.classList.add("ProseMirror-focused");
            view.domObserver.start();
            view.focused = true;
            setTimeout(function() {
                if (view.docView && view.hasFocus() && !view.domObserver.currentSelection.eq(view.root.getSelection())) {
                    selectionToDOM(view)
                }
            }, 20)
        }
    }
    ;
    handlers.blur = function(view) {
        if (view.focused) {
            view.domObserver.stop();
            view.dom.classList.remove("ProseMirror-focused");
            view.domObserver.start();
            view.domObserver.currentSelection.set({});
            view.focused = false
        }
    }
    ;
    handlers.beforeinput = function(view, event) {
        if (result.chrome && result.android && event.inputType == "deleteContentBackward") {
            var domChangeCount = view.domChangeCount;
            setTimeout(function() {
                if (view.domChangeCount != domChangeCount) {
                    return
                }
                view.dom.blur();
                view.focus();
                if (view.someProp("handleKeyDown", function(f) {
                    return f(view, keyEvent(8, "Backspace"))
                })) {
                    return
                }
                var ref = view.state.selection;
                var $cursor = ref.$cursor;
                if ($cursor && $cursor.pos > 0) {
                    view.dispatch(view.state.tr.delete($cursor.pos - 1, $cursor.pos).scrollIntoView())
                }
            }, 50)
        }
    }
    ;
    for (var prop in editHandlers) {
        handlers[prop] = editHandlers[prop]
    }
    function compareObjs(a, b) {
        if (a == b) {
            return true
        }
        for (var p in a) {
            if (a[p] !== b[p]) {
                return false
            }
        }
        for (var p$1 in b) {
            if (!(p$1 in a)) {
                return false
            }
        }
        return true
    }
    var WidgetType = function WidgetType(toDOM, spec) {
        this.spec = spec || noSpec;
        this.side = this.spec.side || 0;
        this.toDOM = toDOM
    };
    WidgetType.prototype.map = function map(mapping, span, offset, oldOffset) {
        var ref = mapping.mapResult(span.from + oldOffset, this.side < 0 ? -1 : 1);
        var pos = ref.pos;
        var deleted = ref.deleted;
        return deleted ? null : new Decoration(pos - offset,pos - offset,this)
    }
    ;
    WidgetType.prototype.valid = function valid() {
        return true
    }
    ;
    WidgetType.prototype.eq = function eq(other) {
        return this == other || other instanceof WidgetType && (this.spec.key && this.spec.key == other.spec.key || this.toDOM == other.toDOM && compareObjs(this.spec, other.spec))
    }
    ;
    var InlineType = function InlineType(attrs, spec) {
        this.spec = spec || noSpec;
        this.attrs = attrs
    };
    InlineType.prototype.map = function map(mapping, span, offset, oldOffset) {
        var from = mapping.map(span.from + oldOffset, this.spec.inclusiveStart ? -1 : 1) - offset;
        var to = mapping.map(span.to + oldOffset, this.spec.inclusiveEnd ? 1 : -1) - offset;
        return from >= to ? null : new Decoration(from,to,this)
    }
    ;
    InlineType.prototype.valid = function valid(_, span) {
        return span.from < span.to
    }
    ;
    InlineType.prototype.eq = function eq(other) {
        return this == other || other instanceof InlineType && compareObjs(this.attrs, other.attrs) && compareObjs(this.spec, other.spec)
    }
    ;
    InlineType.is = function is(span) {
        return span.type instanceof InlineType
    }
    ;
    var NodeType = function NodeType(attrs, spec) {
        this.spec = spec || noSpec;
        this.attrs = attrs
    };
    NodeType.prototype.map = function map(mapping, span, offset, oldOffset) {
        var from = mapping.mapResult(span.from + oldOffset, 1);
        if (from.deleted) {
            return null
        }
        var to = mapping.mapResult(span.to + oldOffset, -1);
        if (to.deleted || to.pos <= from.pos) {
            return null
        }
        return new Decoration(from.pos - offset,to.pos - offset,this)
    }
    ;
    NodeType.prototype.valid = function valid(node, span) {
        var ref = node.content.findIndex(span.from);
        var index = ref.index;
        var offset = ref.offset;
        return offset == span.from && offset + node.child(index).nodeSize == span.to
    }
    ;
    NodeType.prototype.eq = function eq(other) {
        return this == other || other instanceof NodeType && compareObjs(this.attrs, other.attrs) && compareObjs(this.spec, other.spec)
    }
    ;
    var Decoration = function Decoration(from, to, type) {
        this.from = from;
        this.to = to;
        this.type = type
    };
    var prototypeAccessors$1 = {
        spec: {
            configurable: true
        }
    };
    Decoration.prototype.copy = function copy(from, to) {
        return new Decoration(from,to,this.type)
    }
    ;
    Decoration.prototype.eq = function eq(other, offset) {
        if (offset === void 0)
            offset = 0;
        return this.type.eq(other.type) && this.from + offset == other.from && this.to + offset == other.to
    }
    ;
    Decoration.prototype.map = function map(mapping, offset, oldOffset) {
        return this.type.map(mapping, this, offset, oldOffset)
    }
    ;
    Decoration.widget = function widget(pos, toDOM, spec) {
        return new Decoration(pos,pos,new WidgetType(toDOM,spec))
    }
    ;
    Decoration.inline = function inline(from, to, attrs, spec) {
        return new Decoration(from,to,new InlineType(attrs,spec))
    }
    ;
    Decoration.node = function node(from, to, attrs, spec) {
        return new Decoration(from,to,new NodeType(attrs,spec))
    }
    ;
    prototypeAccessors$1.spec.get = function() {
        return this.type.spec
    }
    ;
    Object.defineProperties(Decoration.prototype, prototypeAccessors$1);
    var none = []
        , noSpec = {};
    var DecorationSet = function DecorationSet(local, children) {
        this.local = local && local.length ? local : none;
        this.children = children && children.length ? children : none
    };
    DecorationSet.create = function create(doc, decorations) {
        return decorations.length ? buildTree(decorations, doc, 0, noSpec) : empty
    }
    ;
    DecorationSet.prototype.find = function find(start, end, predicate) {
        var result = [];
        this.findInner(start == null ? 0 : start, end == null ? 1e9 : end, result, 0, predicate);
        return result
    }
    ;
    DecorationSet.prototype.findInner = function findInner(start, end, result, offset, predicate) {
        for (var i = 0; i < this.local.length; i++) {
            var span = this.local[i];
            if (span.from <= end && span.to >= start && (!predicate || predicate(span.spec))) {
                result.push(span.copy(span.from + offset, span.to + offset))
            }
        }
        for (var i$1 = 0; i$1 < this.children.length; i$1 += 3) {
            if (this.children[i$1] < end && this.children[i$1 + 1] > start) {
                var childOff = this.children[i$1] + 1;
                this.children[i$1 + 2].findInner(start - childOff, end - childOff, result, offset + childOff, predicate)
            }
        }
    }
    ;
    DecorationSet.prototype.map = function map(mapping, doc, options) {
        if (this == empty || mapping.maps.length == 0) {
            return this
        }
        return this.mapInner(mapping, doc, 0, 0, options || noSpec)
    }
    ;
    DecorationSet.prototype.mapInner = function mapInner(mapping, node, offset, oldOffset, options) {
        var newLocal;
        for (var i = 0; i < this.local.length; i++) {
            var mapped = this.local[i].map(mapping, offset, oldOffset);
            if (mapped && mapped.type.valid(node, mapped)) {
                (newLocal || (newLocal = [])).push(mapped)
            } else if (options.onRemove) {
                options.onRemove(this.local[i].spec)
            }
        }
        if (this.children.length) {
            return mapChildren(this.children, newLocal, mapping, node, offset, oldOffset, options)
        } else {
            return newLocal ? new DecorationSet(newLocal.sort(byPos)) : empty
        }
    }
    ;
    DecorationSet.prototype.add = function add(doc, decorations) {
        if (!decorations.length) {
            return this
        }
        if (this == empty) {
            return DecorationSet.create(doc, decorations)
        }
        return this.addInner(doc, decorations, 0)
    }
    ;
    DecorationSet.prototype.addInner = function addInner(doc, decorations, offset) {
        var this$1 = this;
        var children, childIndex = 0;
        doc.forEach(function(childNode, childOffset) {
            var baseOffset = childOffset + offset, found;
            if (!(found = takeSpansForNode(decorations, childNode, baseOffset))) {
                return
            }
            if (!children) {
                children = this$1.children.slice()
            }
            while (childIndex < children.length && children[childIndex] < childOffset) {
                childIndex += 3
            }
            if (children[childIndex] == childOffset) {
                children[childIndex + 2] = children[childIndex + 2].addInner(childNode, found, baseOffset + 1)
            } else {
                children.splice(childIndex, 0, childOffset, childOffset + childNode.nodeSize, buildTree(found, childNode, baseOffset + 1, noSpec))
            }
            childIndex += 3
        });
        var local = moveSpans(childIndex ? withoutNulls(decorations) : decorations, -offset);
        return new DecorationSet(local.length ? this.local.concat(local).sort(byPos) : this.local,children || this.children)
    }
    ;
    DecorationSet.prototype.remove = function remove(decorations) {
        if (decorations.length == 0 || this == empty) {
            return this
        }
        return this.removeInner(decorations, 0)
    }
    ;
    DecorationSet.prototype.removeInner = function removeInner(decorations, offset) {
        var children = this.children
            , local = this.local;
        for (var i = 0; i < children.length; i += 3) {
            var found = void 0
                , from = children[i] + offset
                , to = children[i + 1] + offset;
            for (var j = 0, span = void 0; j < decorations.length; j++) {
                if (span = decorations[j]) {
                    if (span.from > from && span.to < to) {
                        decorations[j] = null;
                        (found || (found = [])).push(span)
                    }
                }
            }
            if (!found) {
                continue
            }
            if (children == this.children) {
                children = this.children.slice()
            }
            var removed = children[i + 2].removeInner(found, from + 1);
            if (removed != empty) {
                children[i + 2] = removed
            } else {
                children.splice(i, 3);
                i -= 3
            }
        }
        if (local.length) {
            for (var i$1 = 0, span$1 = void 0; i$1 < decorations.length; i$1++) {
                if (span$1 = decorations[i$1]) {
                    for (var j$1 = 0; j$1 < local.length; j$1++) {
                        if (local[j$1].eq(span$1, offset)) {
                            if (local == this.local) {
                                local = this.local.slice()
                            }
                            local.splice(j$1--, 1)
                        }
                    }
                }
            }
        }
        if (children == this.children && local == this.local) {
            return this
        }
        return local.length || children.length ? new DecorationSet(local,children) : empty
    }
    ;
    DecorationSet.prototype.forChild = function forChild(offset, node) {
        if (this == empty) {
            return this
        }
        if (node.isLeaf) {
            return DecorationSet.empty
        }
        var child, local;
        for (var i = 0; i < this.children.length; i += 3) {
            if (this.children[i] >= offset) {
                if (this.children[i] == offset) {
                    child = this.children[i + 2]
                }
                break
            }
        }
        var start = offset + 1
            , end = start + node.content.size;
        for (var i$1 = 0; i$1 < this.local.length; i$1++) {
            var dec = this.local[i$1];
            if (dec.from < end && dec.to > start && dec.type instanceof InlineType) {
                var from = Math.max(start, dec.from) - start
                    , to = Math.min(end, dec.to) - start;
                if (from < to) {
                    (local || (local = [])).push(dec.copy(from, to))
                }
            }
        }
        if (local) {
            var localSet = new DecorationSet(local.sort(byPos));
            return child ? new DecorationGroup([localSet, child]) : localSet
        }
        return child || empty
    }
    ;
    DecorationSet.prototype.eq = function eq(other) {
        if (this == other) {
            return true
        }
        if (!(other instanceof DecorationSet) || this.local.length != other.local.length || this.children.length != other.children.length) {
            return false
        }
        for (var i = 0; i < this.local.length; i++) {
            if (!this.local[i].eq(other.local[i])) {
                return false
            }
        }
        for (var i$1 = 0; i$1 < this.children.length; i$1 += 3) {
            if (this.children[i$1] != other.children[i$1] || this.children[i$1 + 1] != other.children[i$1 + 1] || !this.children[i$1 + 2].eq(other.children[i$1 + 2])) {
                return false
            }
        }
        return true
    }
    ;
    DecorationSet.prototype.locals = function locals(node) {
        return removeOverlap(this.localsInner(node))
    }
    ;
    DecorationSet.prototype.localsInner = function localsInner(node) {
        if (this == empty) {
            return none
        }
        if (node.inlineContent || !this.local.some(InlineType.is)) {
            return this.local
        }
        var result = [];
        for (var i = 0; i < this.local.length; i++) {
            if (!(this.local[i].type instanceof InlineType)) {
                result.push(this.local[i])
            }
        }
        return result
    }
    ;
    var empty = new DecorationSet;
    DecorationSet.empty = empty;
    DecorationSet.removeOverlap = removeOverlap;
    var DecorationGroup = function DecorationGroup(members) {
        this.members = members
    };
    DecorationGroup.prototype.forChild = function forChild(offset, child) {
        if (child.isLeaf) {
            return DecorationSet.empty
        }
        var found = [];
        for (var i = 0; i < this.members.length; i++) {
            var result = this.members[i].forChild(offset, child);
            if (result == empty) {
                continue
            }
            if (result instanceof DecorationGroup) {
                found = found.concat(result.members)
            } else {
                found.push(result)
            }
        }
        return DecorationGroup.from(found)
    }
    ;
    DecorationGroup.prototype.eq = function eq(other) {
        if (!(other instanceof DecorationGroup) || other.members.length != this.members.length) {
            return false
        }
        for (var i = 0; i < this.members.length; i++) {
            if (!this.members[i].eq(other.members[i])) {
                return false
            }
        }
        return true
    }
    ;
    DecorationGroup.prototype.locals = function locals(node) {
        var result, sorted = true;
        for (var i = 0; i < this.members.length; i++) {
            var locals = this.members[i].localsInner(node);
            if (!locals.length) {
                continue
            }
            if (!result) {
                result = locals
            } else {
                if (sorted) {
                    result = result.slice();
                    sorted = false
                }
                for (var j = 0; j < locals.length; j++) {
                    result.push(locals[j])
                }
            }
        }
        return result ? removeOverlap(sorted ? result : result.sort(byPos)) : none
    }
    ;
    DecorationGroup.from = function from(members) {
        switch (members.length) {
            case 0:
                return empty;
            case 1:
                return members[0];
            default:
                return new DecorationGroup(members)
        }
    }
    ;
    function mapChildren(oldChildren, newLocal, mapping, node, offset, oldOffset, options) {
        var children = oldChildren.slice();
        var shift = function(oldStart, oldEnd, newStart, newEnd) {
            for (var i = 0; i < children.length; i += 3) {
                var end = children[i + 1]
                    , dSize = void 0;
                if (end == -1 || oldStart > end + oldOffset) {
                    continue
                }
                if (oldEnd >= children[i] + oldOffset) {
                    children[i + 1] = -1
                } else if (newStart >= offset && (dSize = newEnd - newStart - (oldEnd - oldStart))) {
                    children[i] += dSize;
                    children[i + 1] += dSize
                }
            }
        };
        for (var i = 0; i < mapping.maps.length; i++) {
            mapping.maps[i].forEach(shift)
        }
        var mustRebuild = false;
        for (var i$1 = 0; i$1 < children.length; i$1 += 3) {
            if (children[i$1 + 1] == -1) {
                var from = mapping.map(children[i$1] + oldOffset)
                    , fromLocal = from - offset;
                if (fromLocal < 0 || fromLocal >= node.content.size) {
                    mustRebuild = true;
                    continue
                }
                var to = mapping.map(oldChildren[i$1 + 1] + oldOffset, -1)
                    , toLocal = to - offset;
                var ref = node.content.findIndex(fromLocal);
                var index = ref.index;
                var childOffset = ref.offset;
                var childNode = node.maybeChild(index);
                if (childNode && childOffset == fromLocal && childOffset + childNode.nodeSize == toLocal) {
                    var mapped = children[i$1 + 2].mapInner(mapping, childNode, from + 1, children[i$1] + oldOffset + 1, options);
                    if (mapped != empty) {
                        children[i$1] = fromLocal;
                        children[i$1 + 1] = toLocal;
                        children[i$1 + 2] = mapped
                    } else {
                        children[i$1 + 1] = -2;
                        mustRebuild = true
                    }
                } else {
                    mustRebuild = true
                }
            }
        }
        if (mustRebuild) {
            var decorations = mapAndGatherRemainingDecorations(children, oldChildren, newLocal || [], mapping, offset, oldOffset, options);
            var built = buildTree(decorations, node, 0, options);
            newLocal = built.local;
            for (var i$2 = 0; i$2 < children.length; i$2 += 3) {
                if (children[i$2 + 1] < 0) {
                    children.splice(i$2, 3);
                    i$2 -= 3
                }
            }
            for (var i$3 = 0, j = 0; i$3 < built.children.length; i$3 += 3) {
                var from$1 = built.children[i$3];
                while (j < children.length && children[j] < from$1) {
                    j += 3
                }
                children.splice(j, 0, built.children[i$3], built.children[i$3 + 1], built.children[i$3 + 2])
            }
        }
        return new DecorationSet(newLocal && newLocal.sort(byPos),children)
    }
    function moveSpans(spans, offset) {
        if (!offset || !spans.length) {
            return spans
        }
        var result = [];
        for (var i = 0; i < spans.length; i++) {
            var span = spans[i];
            result.push(new Decoration(span.from + offset,span.to + offset,span.type))
        }
        return result
    }
    function mapAndGatherRemainingDecorations(children, oldChildren, decorations, mapping, offset, oldOffset, options) {
        function gather(set, oldOffset) {
            for (var i = 0; i < set.local.length; i++) {
                var mapped = set.local[i].map(mapping, offset, oldOffset);
                if (mapped) {
                    decorations.push(mapped)
                } else if (options.onRemove) {
                    options.onRemove(set.local[i].spec)
                }
            }
            for (var i$1 = 0; i$1 < set.children.length; i$1 += 3) {
                gather(set.children[i$1 + 2], set.children[i$1] + oldOffset + 1)
            }
        }
        for (var i = 0; i < children.length; i += 3) {
            if (children[i + 1] == -1) {
                gather(children[i + 2], oldChildren[i] + oldOffset + 1)
            }
        }
        return decorations
    }
    function takeSpansForNode(spans, node, offset) {
        if (node.isLeaf) {
            return null
        }
        var end = offset + node.nodeSize
            , found = null;
        for (var i = 0, span = void 0; i < spans.length; i++) {
            if ((span = spans[i]) && span.from > offset && span.to < end) {
                (found || (found = [])).push(span);
                spans[i] = null
            }
        }
        return found
    }
    function withoutNulls(array) {
        var result = [];
        for (var i = 0; i < array.length; i++) {
            if (array[i] != null) {
                result.push(array[i])
            }
        }
        return result
    }
    function buildTree(spans, node, offset, options) {
        var children = []
            , hasNulls = false;
        node.forEach(function(childNode, localStart) {
            var found = takeSpansForNode(spans, childNode, localStart + offset);
            if (found) {
                hasNulls = true;
                var subtree = buildTree(found, childNode, offset + localStart + 1, options);
                if (subtree != empty) {
                    children.push(localStart, localStart + childNode.nodeSize, subtree)
                }
            }
        });
        var locals = moveSpans(hasNulls ? withoutNulls(spans) : spans, -offset).sort(byPos);
        for (var i = 0; i < locals.length; i++) {
            if (!locals[i].type.valid(node, locals[i])) {
                if (options.onRemove) {
                    options.onRemove(locals[i].spec)
                }
                locals.splice(i--, 1)
            }
        }
        return locals.length || children.length ? new DecorationSet(locals,children) : empty
    }
    function byPos(a, b) {
        return a.from - b.from || a.to - b.to
    }
    function removeOverlap(spans) {
        var working = spans;
        for (var i = 0; i < working.length - 1; i++) {
            var span = working[i];
            if (span.from != span.to) {
                for (var j = i + 1; j < working.length; j++) {
                    var next = working[j];
                    if (next.from == span.from) {
                        if (next.to != span.to) {
                            if (working == spans) {
                                working = spans.slice()
                            }
                            working[j] = next.copy(next.from, span.to);
                            insertAhead(working, j + 1, next.copy(span.to, next.to))
                        }
                        continue
                    } else {
                        if (next.from < span.to) {
                            if (working == spans) {
                                working = spans.slice()
                            }
                            working[i] = span.copy(span.from, next.from);
                            insertAhead(working, j, span.copy(next.from, span.to))
                        }
                        break
                    }
                }
            }
        }
        return working
    }
    function insertAhead(array, i, deco) {
        while (i < array.length && byPos(deco, array[i]) > 0) {
            i++
        }
        array.splice(i, 0, deco)
    }
    function viewDecorations(view) {
        var found = [];
        view.someProp("decorations", function(f) {
            var result = f(view.state);
            if (result && result != empty) {
                found.push(result)
            }
        });
        if (view.cursorWrapper) {
            found.push(DecorationSet.create(view.state.doc, [view.cursorWrapper.deco]))
        }
        return DecorationGroup.from(found)
    }
    var EditorView = function EditorView(place, props) {
        this._props = props;
        this.state = props.state;
        this.dispatch = this.dispatch.bind(this);
        this._root = null;
        this.focused = false;
        this.dom = place && place.mount || document.createElement("div");
        if (place) {
            if (place.appendChild) {
                place.appendChild(this.dom)
            } else if (place.apply) {
                place(this.dom)
            } else if (place.mount) {
                this.mounted = true
            }
        }
        this.editable = getEditable(this);
        this.markCursor = null;
        this.cursorWrapper = null;
        updateCursorWrapper(this);
        this.nodeViews = buildNodeViews(this);
        this.docView = docViewDesc(this.state.doc, computeDocDeco(this), viewDecorations(this), this.dom, this);
        this.lastSelectedViewDesc = null;
        this.dragging = null;
        initInput(this);
        this.pluginViews = [];
        this.updatePluginViews()
    };
    var prototypeAccessors$2 = {
        props: {
            configurable: true
        },
        root: {
            configurable: true
        }
    };
    prototypeAccessors$2.props.get = function() {
        if (this._props.state != this.state) {
            var prev = this._props;
            this._props = {};
            for (var name in prev) {
                this._props[name] = prev[name]
            }
            this._props.state = this.state
        }
        return this._props
    }
    ;
    EditorView.prototype.update = function update(props) {
        if (props.handleDOMEvents != this._props.handleDOMEvents) {
            ensureListeners(this)
        }
        this._props = props;
        this.updateStateInner(props.state, true)
    }
    ;
    EditorView.prototype.setProps = function setProps(props) {
        var updated = {};
        for (var name in this._props) {
            updated[name] = this._props[name]
        }
        updated.state = this.state;
        for (var name$1 in props) {
            updated[name$1] = props[name$1]
        }
        this.update(updated)
    }
    ;
    EditorView.prototype.updateState = function updateState(state) {
        this.updateStateInner(state, this.state.plugins != state.plugins)
    }
    ;
    EditorView.prototype.updateStateInner = function updateStateInner(state, reconfigured) {
        var this$1 = this;
        var prev = this.state
            , redraw = false;
        this.state = state;
        if (reconfigured) {
            var nodeViews = buildNodeViews(this);
            if (changedNodeViews(nodeViews, this.nodeViews)) {
                this.nodeViews = nodeViews;
                redraw = true
            }
            ensureListeners(this)
        }
        this.editable = getEditable(this);
        updateCursorWrapper(this);
        var innerDeco = viewDecorations(this)
            , outerDeco = computeDocDeco(this);
        var scroll = reconfigured ? "reset" : state.scrollToSelection > prev.scrollToSelection ? "to selection" : "preserve";
        var updateDoc = redraw || !this.docView.matchesNode(state.doc, outerDeco, innerDeco);
        var updateSel = updateDoc || !state.selection.eq(prev.selection);
        var oldScrollPos = scroll == "preserve" && updateSel && this.dom.style.overflowAnchor == null && storeScrollPos(this);
        if (updateSel) {
            this.domObserver.stop();
            var forceSelUpdate = updateDoc && (result.ie || result.chrome) && !this.composing && !prev.selection.empty && !state.selection.empty && selectionContextChanged(prev.selection, state.selection);
            if (updateDoc) {
                var selContext = result.chrome && selectionContext(this.root);
                if (redraw || !this.docView.update(state.doc, outerDeco, innerDeco, this)) {
                    this.docView.updateOuterDeco([]);
                    this.docView.destroy();
                    this.docView = docViewDesc(state.doc, outerDeco, innerDeco, this.dom, this)
                }
                if (selContext && needChromeSelectionReset(selContext, this.root)) {
                    forceSelUpdate = true
                }
            }
            if (forceSelUpdate || !(this.mouseDown && this.domObserver.currentSelection.eq(this.root.getSelection()) && anchorInRightPlace(this))) {
                selectionToDOM(this, forceSelUpdate)
            } else {
                syncNodeSelection(this, state.selection);
                this.domObserver.setCurSelection()
            }
            this.domObserver.start()
        }
        this.updatePluginViews(prev);
        if (scroll == "reset") {
            this.dom.scrollTop = 0
        } else if (scroll == "to selection") {
            var startDOM = this.root.getSelection().focusNode;
            if (this.someProp("handleScrollToSelection", function(f) {
                return f(this$1)
            }))
                ;
            else if (state.selection instanceof prosemirrorState.NodeSelection) {
                scrollRectIntoView(this, this.docView.domAfterPos(state.selection.from).getBoundingClientRect(), startDOM)
            } else {
                scrollRectIntoView(this, this.coordsAtPos(state.selection.head), startDOM)
            }
        } else if (oldScrollPos) {
            resetScrollPos(oldScrollPos)
        }
    }
    ;
    EditorView.prototype.destroyPluginViews = function destroyPluginViews() {
        var view;
        while (view = this.pluginViews.pop()) {
            if (view.destroy) {
                view.destroy()
            }
        }
    }
    ;
    EditorView.prototype.updatePluginViews = function updatePluginViews(prevState) {
        if (!prevState || prevState.plugins != this.state.plugins) {
            this.destroyPluginViews();
            for (var i = 0; i < this.state.plugins.length; i++) {
                var plugin = this.state.plugins[i];
                if (plugin.spec.view) {
                    this.pluginViews.push(plugin.spec.view(this))
                }
            }
        } else {
            for (var i$1 = 0; i$1 < this.pluginViews.length; i$1++) {
                var pluginView = this.pluginViews[i$1];
                if (pluginView.update) {
                    pluginView.update(this, prevState)
                }
            }
        }
    }
    ;
    EditorView.prototype.someProp = function someProp(propName, f) {
        var prop = this._props && this._props[propName], value;
        if (prop != null && (value = f ? f(prop) : prop)) {
            return value
        }
        var plugins = this.state.plugins;
        if (plugins) {
            for (var i = 0; i < plugins.length; i++) {
                var prop$1 = plugins[i].props[propName];
                if (prop$1 != null && (value = f ? f(prop$1) : prop$1)) {
                    return value
                }
            }
        }
    }
    ;
    EditorView.prototype.hasFocus = function hasFocus() {
        return this.root.activeElement == this.dom
    }
    ;
    EditorView.prototype.focus = function focus() {
        this.domObserver.stop();
        if (this.editable) {
            focusPreventScroll(this.dom)
        }
        selectionToDOM(this);
        this.domObserver.start()
    }
    ;
    prototypeAccessors$2.root.get = function() {
        var cached = this._root;
        if (cached == null) {
            for (var search = this.dom.parentNode; search; search = search.parentNode) {
                if (search.nodeType == 9 || search.nodeType == 11 && search.host) {
                    if (!search.getSelection) {
                        Object.getPrototypeOf(search).getSelection = function() {
                            return document.getSelection()
                        }
                    }
                    return this._root = search
                }
            }
        }
        return cached || document
    }
    ;
    EditorView.prototype.posAtCoords = function posAtCoords$1(coords) {
        return posAtCoords(this, coords)
    }
    ;
    EditorView.prototype.coordsAtPos = function coordsAtPos$1(pos) {
        return coordsAtPos(this, pos)
    }
    ;
    EditorView.prototype.domAtPos = function domAtPos(pos) {
        return this.docView.domFromPos(pos)
    }
    ;
    EditorView.prototype.nodeDOM = function nodeDOM(pos) {
        var desc = this.docView.descAt(pos);
        return desc ? desc.nodeDOM : null
    }
    ;
    EditorView.prototype.posAtDOM = function posAtDOM(node, offset, bias) {
        if (bias === void 0)
            bias = -1;
        var pos = this.docView.posFromDOM(node, offset, bias);
        if (pos == null) {
            throw new RangeError("DOM position not inside the editor")
        }
        return pos
    }
    ;
    EditorView.prototype.endOfTextblock = function endOfTextblock$1(dir, state) {
        return endOfTextblock(this, state || this.state, dir)
    }
    ;
    EditorView.prototype.destroy = function destroy() {
        if (!this.docView) {
            return
        }
        destroyInput(this);
        this.destroyPluginViews();
        if (this.mounted) {
            this.docView.update(this.state.doc, [], viewDecorations(this), this);
            this.dom.textContent = ""
        } else if (this.dom.parentNode) {
            this.dom.parentNode.removeChild(this.dom)
        }
        this.docView.destroy();
        this.docView = null
    }
    ;
    EditorView.prototype.dispatchEvent = function dispatchEvent$1(event) {
        return dispatchEvent(this, event)
    }
    ;
    EditorView.prototype.dispatch = function dispatch(tr) {
        var dispatchTransaction = this._props.dispatchTransaction;
        if (dispatchTransaction) {
            dispatchTransaction.call(this, tr)
        } else {
            this.updateState(this.state.apply(tr))
        }
    }
    ;
    Object.defineProperties(EditorView.prototype, prototypeAccessors$2);
    function computeDocDeco(view) {
        var attrs = Object.create(null);
        attrs.class = "ProseMirror";
        attrs.contenteditable = String(view.editable);
        view.someProp("attributes", function(value) {
            if (typeof value == "function") {
                value = value(view.state)
            }
            if (value) {
                for (var attr in value) {
                    if (attr == "class") {
                        attrs.class += " " + value[attr]
                    } else if (!attrs[attr] && attr != "contenteditable" && attr != "nodeName") {
                        attrs[attr] = String(value[attr])
                    }
                }
            }
        });
        return [Decoration.node(0, view.state.doc.content.size, attrs)]
    }
    function updateCursorWrapper(view) {
        if (view.markCursor) {
            var dom = document.createElement("img");
            dom.setAttribute("mark-placeholder", "true");
            view.cursorWrapper = {
                dom: dom,
                deco: Decoration.widget(view.state.selection.head, dom, {
                    raw: true,
                    marks: view.markCursor
                })
            }
        } else {
            view.cursorWrapper = null
        }
    }
    function getEditable(view) {
        return !view.someProp("editable", function(value) {
            return value(view.state) === false
        })
    }
    function selectionContextChanged(sel1, sel2) {
        var depth = Math.min(sel1.$anchor.sharedDepth(sel1.head), sel2.$anchor.sharedDepth(sel2.head));
        return sel1.$anchor.start(depth) != sel2.$anchor.start(depth)
    }
    function buildNodeViews(view) {
        var result = {};
        view.someProp("nodeViews", function(obj) {
            for (var prop in obj) {
                if (!Object.prototype.hasOwnProperty.call(result, prop)) {
                    result[prop] = obj[prop]
                }
            }
        });
        return result
    }
    function changedNodeViews(a, b) {
        var nA = 0
            , nB = 0;
        for (var prop in a) {
            if (a[prop] != b[prop]) {
                return true
            }
            nA++
        }
        for (var _ in b) {
            nB++
        }
        return nA != nB
    }
    function selectionContext(root) {
        var ref = root.getSelection();
        var offset = ref.focusOffset;
        var node = ref.focusNode;
        return node && node.nodeType == 1 ? [node, offset, node.childNodes[offset - 1], node.childNodes[offset]] : null
    }
    function needChromeSelectionReset(context, root) {
        var newContext = selectionContext(root);
        if (!newContext || newContext[0].nodeType == 3) {
            return false
        }
        for (var i = 0; i < context.length; i++) {
            if (newContext[i] != context[i]) {
                return true
            }
        }
        return false
    }
    exports.Decoration = Decoration;
    exports.DecorationSet = DecorationSet;
    exports.EditorView = EditorView;
    exports.__endComposition = endComposition;
    exports.__parseFromClipboard = parseFromClipboard;
    exports.__serializeForClipboard = serializeForClipboard
});
define("prosemirror-view", ["prosemirror-view/index"], function(main) {
    return main
});
define("w3c-keyname", ["require", "exports", "module"], function(require, exports, module) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var base = {
        8: "Backspace",
        9: "Tab",
        10: "Enter",
        12: "NumLock",
        13: "Enter",
        16: "Shift",
        17: "Control",
        18: "Alt",
        20: "CapsLock",
        27: "Escape",
        32: " ",
        33: "PageUp",
        34: "PageDown",
        35: "End",
        36: "Home",
        37: "ArrowLeft",
        38: "ArrowUp",
        39: "ArrowRight",
        40: "ArrowDown",
        44: "PrintScreen",
        45: "Insert",
        46: "Delete",
        59: ";",
        61: "=",
        91: "Meta",
        92: "Meta",
        106: "*",
        107: "+",
        108: ",",
        109: "-",
        110: ".",
        111: "/",
        144: "NumLock",
        145: "ScrollLock",
        160: "Shift",
        161: "Shift",
        162: "Control",
        163: "Control",
        164: "Alt",
        165: "Alt",
        173: "-",
        186: ";",
        187: "=",
        188: ",",
        189: "-",
        190: ".",
        191: "/",
        192: "`",
        219: "[",
        220: "\\",
        221: "]",
        222: "'",
        229: "q"
    };
    var shift = {
        48: ")",
        49: "!",
        50: "@",
        51: "#",
        52: "$",
        53: "%",
        54: "^",
        55: "&",
        56: "*",
        57: "(",
        59: ":",
        61: "+",
        173: "_",
        186: ":",
        187: "+",
        188: "<",
        189: "_",
        190: ">",
        191: "?",
        192: "~",
        219: "{",
        220: "|",
        221: "}",
        222: '"',
        229: "Q"
    };
    var chrome = typeof navigator != "undefined" && /Chrome\/(\d+)/.exec(navigator.userAgent);
    var safari = typeof navigator != "undefined" && /Apple Computer/.test(navigator.vendor);
    var gecko = typeof navigator != "undefined" && /Gecko\/\d+/.test(navigator.userAgent);
    var mac = typeof navigator != "undefined" && /Mac/.test(navigator.platform);
    var ie = typeof navigator != "undefined" && /MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);
    var brokenModifierNames = chrome && (mac || +chrome[1] < 57) || gecko && mac;
    for (var i = 0; i < 10; i++)
        base[48 + i] = base[96 + i] = String(i);
    for (var i = 1; i <= 24; i++)
        base[i + 111] = "F" + i;
    for (var i = 65; i <= 90; i++) {
        base[i] = String.fromCharCode(i + 32);
        shift[i] = String.fromCharCode(i)
    }
    for (var code in base)
        if (!shift.hasOwnProperty(code))
            shift[code] = base[code];
    function keyName(event) {
        var ignoreKey = brokenModifierNames && (event.ctrlKey || event.altKey || event.metaKey) || (safari || ie) && event.shiftKey && event.key && event.key.length == 1;
        var name = !ignoreKey && event.key || (event.shiftKey ? shift : base)[event.keyCode] || event.key || "Unidentified";
        if (name == "Esc")
            name = "Escape";
        if (name == "Del")
            name = "Delete";
        if (name == "Left")
            name = "ArrowLeft";
        if (name == "Up")
            name = "ArrowUp";
        if (name == "Right")
            name = "ArrowRight";
        if (name == "Down")
            name = "ArrowDown";
        return name
    }
    exports.base = base;
    exports.keyName = keyName;
    exports.shift = shift
});
define("prosemirror-keymap/index", ["require", "exports", "module", "w3c-keyname", "prosemirror-state"], function(require, exports, module) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var w3cKeyname = require("w3c-keyname");
    var prosemirrorState = require("prosemirror-state");
    var mac = typeof navigator != "undefined" ? /Mac/.test(navigator.platform) : false;
    function normalizeKeyName(name) {
        var parts = name.split(/-(?!$)/)
            , result = parts[parts.length - 1];
        if (result == "Space") {
            result = " "
        }
        var alt, ctrl, shift, meta;
        for (var i = 0; i < parts.length - 1; i++) {
            var mod = parts[i];
            if (/^(cmd|meta|m)$/i.test(mod)) {
                meta = true
            } else if (/^a(lt)?$/i.test(mod)) {
                alt = true
            } else if (/^(c|ctrl|control)$/i.test(mod)) {
                ctrl = true
            } else if (/^s(hift)?$/i.test(mod)) {
                shift = true
            } else if (/^mod$/i.test(mod)) {
                if (mac) {
                    meta = true
                } else {
                    ctrl = true
                }
            } else {
                throw new Error("Unrecognized modifier name: " + mod)
            }
        }
        if (alt) {
            result = "Alt-" + result
        }
        if (ctrl) {
            result = "Ctrl-" + result
        }
        if (meta) {
            result = "Meta-" + result
        }
        if (shift) {
            result = "Shift-" + result
        }
        return result
    }
    function normalize(map) {
        var copy = Object.create(null);
        for (var prop in map) {
            copy[normalizeKeyName(prop)] = map[prop]
        }
        return copy
    }
    function modifiers(name, event, shift) {
        if (event.altKey) {
            name = "Alt-" + name
        }
        if (event.ctrlKey) {
            name = "Ctrl-" + name
        }
        if (event.metaKey) {
            name = "Meta-" + name
        }
        if (shift !== false && event.shiftKey) {
            name = "Shift-" + name
        }
        return name
    }
    function keymap(bindings) {
        return new prosemirrorState.Plugin({
            props: {
                handleKeyDown: keydownHandler(bindings)
            }
        })
    }
    function keydownHandler(bindings) {
        var map = normalize(bindings);
        return function(view, event) {
            var name = w3cKeyname.keyName(event), isChar = name.length == 1 && name != " ", baseName;
            var direct = map[modifiers(name, event, !isChar)];
            if (direct && direct(view.state, view.dispatch, view)) {
                return true
            }
            if (isChar && (event.shiftKey || event.altKey || event.metaKey) && (baseName = w3cKeyname.base[event.keyCode]) && baseName != name) {
                var fromCode = map[modifiers(baseName, event, true)];
                if (fromCode && fromCode(view.state, view.dispatch, view)) {
                    return true
                }
            } else if (isChar && event.shiftKey) {
                var withShift = map[modifiers(name, event, true)];
                if (withShift && withShift(view.state, view.dispatch, view)) {
                    return true
                }
            }
            return false
        }
    }
    exports.keydownHandler = keydownHandler;
    exports.keymap = keymap
});
define("prosemirror-keymap", ["prosemirror-keymap/index"], function(main) {
    return main
});
define("prosemirror-commands/index", ["require", "exports", "module", "prosemirror-transform", "prosemirror-model", "prosemirror-state"], function(require, exports, module) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var prosemirrorTransform = require("prosemirror-transform");
    var prosemirrorModel = require("prosemirror-model");
    var prosemirrorState = require("prosemirror-state");
    function deleteSelection(state, dispatch) {
        if (state.selection.empty) {
            return false
        }
        if (dispatch) {
            dispatch(state.tr.deleteSelection().scrollIntoView())
        }
        return true
    }
    function joinBackward(state, dispatch, view) {
        var ref = state.selection;
        var $cursor = ref.$cursor;
        if (!$cursor || (view ? !view.endOfTextblock("backward", state) : $cursor.parentOffset > 0)) {
            return false
        }
        var $cut = findCutBefore($cursor);
        if (!$cut) {
            var range = $cursor.blockRange()
                , target = range && prosemirrorTransform.liftTarget(range);
            if (target == null) {
                return false
            }
            if (dispatch) {
                dispatch(state.tr.lift(range, target).scrollIntoView())
            }
            return true
        }
        var before = $cut.nodeBefore;
        if (!before.type.spec.isolating && deleteBarrier(state, $cut, dispatch)) {
            return true
        }
        if ($cursor.parent.content.size == 0 && (textblockAt(before, "end") || prosemirrorState.NodeSelection.isSelectable(before))) {
            if (dispatch) {
                var tr = state.tr.deleteRange($cursor.before(), $cursor.after());
                tr.setSelection(textblockAt(before, "end") ? prosemirrorState.Selection.findFrom(tr.doc.resolve(tr.mapping.map($cut.pos, -1)), -1) : prosemirrorState.NodeSelection.create(tr.doc, $cut.pos - before.nodeSize));
                dispatch(tr.scrollIntoView())
            }
            return true
        }
        if (before.isAtom && $cut.depth == $cursor.depth - 1) {
            if (dispatch) {
                dispatch(state.tr.delete($cut.pos - before.nodeSize, $cut.pos).scrollIntoView())
            }
            return true
        }
        return false
    }
    function textblockAt(node, side) {
        for (; node; node = side == "start" ? node.firstChild : node.lastChild) {
            if (node.isTextblock) {
                return true
            }
        }
        return false
    }
    function selectNodeBackward(state, dispatch, view) {
        var ref = state.selection;
        var $head = ref.$head;
        var empty = ref.empty;
        var $cut = $head;
        if (!empty) {
            return false
        }
        if ($head.parent.isTextblock) {
            if (view ? !view.endOfTextblock("backward", state) : $head.parentOffset > 0) {
                return false
            }
            $cut = findCutBefore($head)
        }
        var node = $cut && $cut.nodeBefore;
        if (!node || !prosemirrorState.NodeSelection.isSelectable(node)) {
            return false
        }
        if (dispatch) {
            dispatch(state.tr.setSelection(prosemirrorState.NodeSelection.create(state.doc, $cut.pos - node.nodeSize)).scrollIntoView())
        }
        return true
    }
    function findCutBefore($pos) {
        if (!$pos.parent.type.spec.isolating) {
            for (var i = $pos.depth - 1; i >= 0; i--) {
                if ($pos.index(i) > 0) {
                    return $pos.doc.resolve($pos.before(i + 1))
                }
                if ($pos.node(i).type.spec.isolating) {
                    break
                }
            }
        }
        return null
    }
    function joinForward(state, dispatch, view) {
        var ref = state.selection;
        var $cursor = ref.$cursor;
        if (!$cursor || (view ? !view.endOfTextblock("forward", state) : $cursor.parentOffset < $cursor.parent.content.size)) {
            return false
        }
        var $cut = findCutAfter($cursor);
        if (!$cut) {
            return false
        }
        var after = $cut.nodeAfter;
        if (deleteBarrier(state, $cut, dispatch)) {
            return true
        }
        if ($cursor.parent.content.size == 0 && (textblockAt(after, "start") || prosemirrorState.NodeSelection.isSelectable(after))) {
            if (dispatch) {
                var tr = state.tr.deleteRange($cursor.before(), $cursor.after());
                tr.setSelection(textblockAt(after, "start") ? prosemirrorState.Selection.findFrom(tr.doc.resolve(tr.mapping.map($cut.pos)), 1) : prosemirrorState.NodeSelection.create(tr.doc, tr.mapping.map($cut.pos)));
                dispatch(tr.scrollIntoView())
            }
            return true
        }
        if (after.isAtom && $cut.depth == $cursor.depth - 1) {
            if (dispatch) {
                dispatch(state.tr.delete($cut.pos, $cut.pos + after.nodeSize).scrollIntoView())
            }
            return true
        }
        return false
    }
    function selectNodeForward(state, dispatch, view) {
        var ref = state.selection;
        var $head = ref.$head;
        var empty = ref.empty;
        var $cut = $head;
        if (!empty) {
            return false
        }
        if ($head.parent.isTextblock) {
            if (view ? !view.endOfTextblock("forward", state) : $head.parentOffset < $head.parent.content.size) {
                return false
            }
            $cut = findCutAfter($head)
        }
        var node = $cut && $cut.nodeAfter;
        if (!node || !prosemirrorState.NodeSelection.isSelectable(node)) {
            return false
        }
        if (dispatch) {
            dispatch(state.tr.setSelection(prosemirrorState.NodeSelection.create(state.doc, $cut.pos)).scrollIntoView())
        }
        return true
    }
    function findCutAfter($pos) {
        if (!$pos.parent.type.spec.isolating) {
            for (var i = $pos.depth - 1; i >= 0; i--) {
                var parent = $pos.node(i);
                if ($pos.index(i) + 1 < parent.childCount) {
                    return $pos.doc.resolve($pos.after(i + 1))
                }
                if (parent.type.spec.isolating) {
                    break
                }
            }
        }
        return null
    }
    function joinUp(state, dispatch) {
        var sel = state.selection, nodeSel = sel instanceof prosemirrorState.NodeSelection, point;
        if (nodeSel) {
            if (sel.node.isTextblock || !prosemirrorTransform.canJoin(state.doc, sel.from)) {
                return false
            }
            point = sel.from
        } else {
            point = prosemirrorTransform.joinPoint(state.doc, sel.from, -1);
            if (point == null) {
                return false
            }
        }
        if (dispatch) {
            var tr = state.tr.join(point);
            if (nodeSel) {
                tr.setSelection(prosemirrorState.NodeSelection.create(tr.doc, point - state.doc.resolve(point).nodeBefore.nodeSize))
            }
            dispatch(tr.scrollIntoView())
        }
        return true
    }
    function joinDown(state, dispatch) {
        var sel = state.selection, point;
        if (sel instanceof prosemirrorState.NodeSelection) {
            if (sel.node.isTextblock || !prosemirrorTransform.canJoin(state.doc, sel.to)) {
                return false
            }
            point = sel.to
        } else {
            point = prosemirrorTransform.joinPoint(state.doc, sel.to, 1);
            if (point == null) {
                return false
            }
        }
        if (dispatch) {
            dispatch(state.tr.join(point).scrollIntoView())
        }
        return true
    }
    function lift(state, dispatch) {
        var ref = state.selection;
        var $from = ref.$from;
        var $to = ref.$to;
        var range = $from.blockRange($to)
            , target = range && prosemirrorTransform.liftTarget(range);
        if (target == null) {
            return false
        }
        if (dispatch) {
            dispatch(state.tr.lift(range, target).scrollIntoView())
        }
        return true
    }
    function newlineInCode(state, dispatch) {
        var ref = state.selection;
        var $head = ref.$head;
        var $anchor = ref.$anchor;
        if (!$head.parent.type.spec.code || !$head.sameParent($anchor)) {
            return false
        }
        if (dispatch) {
            dispatch(state.tr.insertText("\n").scrollIntoView())
        }
        return true
    }
    function defaultBlockAt(match) {
        for (var i = 0; i < match.edgeCount; i++) {
            var ref = match.edge(i);
            var type = ref.type;
            if (type.isTextblock && !type.hasRequiredAttrs()) {
                return type
            }
        }
        return null
    }
    function exitCode(state, dispatch) {
        var ref = state.selection;
        var $head = ref.$head;
        var $anchor = ref.$anchor;
        if (!$head.parent.type.spec.code || !$head.sameParent($anchor)) {
            return false
        }
        var above = $head.node(-1)
            , after = $head.indexAfter(-1)
            , type = defaultBlockAt(above.contentMatchAt(after));
        if (!above.canReplaceWith(after, after, type)) {
            return false
        }
        if (dispatch) {
            var pos = $head.after()
                , tr = state.tr.replaceWith(pos, pos, type.createAndFill());
            tr.setSelection(prosemirrorState.Selection.near(tr.doc.resolve(pos), 1));
            dispatch(tr.scrollIntoView())
        }
        return true
    }
    function createParagraphNear(state, dispatch) {
        var ref = state.selection;
        var $from = ref.$from;
        var $to = ref.$to;
        if ($from.parent.inlineContent || $to.parent.inlineContent) {
            return false
        }
        var type = defaultBlockAt($from.parent.contentMatchAt($to.indexAfter()));
        if (!type || !type.isTextblock) {
            return false
        }
        if (dispatch) {
            var side = (!$from.parentOffset && $to.index() < $to.parent.childCount ? $from : $to).pos;
            var tr = state.tr.insert(side, type.createAndFill());
            tr.setSelection(prosemirrorState.TextSelection.create(tr.doc, side + 1));
            dispatch(tr.scrollIntoView())
        }
        return true
    }
    function liftEmptyBlock(state, dispatch) {
        var ref = state.selection;
        var $cursor = ref.$cursor;
        if (!$cursor || $cursor.parent.content.size) {
            return false
        }
        if ($cursor.depth > 1 && $cursor.after() != $cursor.end(-1)) {
            var before = $cursor.before();
            if (prosemirrorTransform.canSplit(state.doc, before)) {
                if (dispatch) {
                    dispatch(state.tr.split(before).scrollIntoView())
                }
                return true
            }
        }
        var range = $cursor.blockRange()
            , target = range && prosemirrorTransform.liftTarget(range);
        if (target == null) {
            return false
        }
        if (dispatch) {
            dispatch(state.tr.lift(range, target).scrollIntoView())
        }
        return true
    }
    function splitBlock(state, dispatch) {
        var ref = state.selection;
        var $from = ref.$from;
        var $to = ref.$to;
        if (state.selection instanceof prosemirrorState.NodeSelection && state.selection.node.isBlock) {
            if (!$from.parentOffset || !prosemirrorTransform.canSplit(state.doc, $from.pos)) {
                return false
            }
            if (dispatch) {
                dispatch(state.tr.split($from.pos).scrollIntoView())
            }
            return true
        }
        if (!$from.parent.isBlock) {
            return false
        }
        if (dispatch) {
            var atEnd = $to.parentOffset == $to.parent.content.size;
            var tr = state.tr;
            if (state.selection instanceof prosemirrorState.TextSelection) {
                tr.deleteSelection()
            }
            var deflt = $from.depth == 0 ? null : defaultBlockAt($from.node(-1).contentMatchAt($from.indexAfter(-1)));
            var types = atEnd && deflt ? [{
                type: deflt
            }] : null;
            var can = prosemirrorTransform.canSplit(tr.doc, tr.mapping.map($from.pos), 1, types);
            if (!types && !can && prosemirrorTransform.canSplit(tr.doc, tr.mapping.map($from.pos), 1, deflt && [{
                type: deflt
            }])) {
                types = [{
                    type: deflt
                }];
                can = true
            }
            if (can) {
                tr.split(tr.mapping.map($from.pos), 1, types);
                if (!atEnd && !$from.parentOffset && $from.parent.type != deflt && $from.node(-1).canReplace($from.index(-1), $from.indexAfter(-1), prosemirrorModel.Fragment.from(deflt.create(), $from.parent))) {
                    tr.setNodeMarkup(tr.mapping.map($from.before()), deflt)
                }
            }
            dispatch(tr.scrollIntoView())
        }
        return true
    }
    function splitBlockKeepMarks(state, dispatch) {
        return splitBlock(state, dispatch && function(tr) {
            var marks = state.storedMarks || state.selection.$to.parentOffset && state.selection.$from.marks();
            if (marks) {
                tr.ensureMarks(marks)
            }
            dispatch(tr)
        }
        )
    }
    function selectParentNode(state, dispatch) {
        var ref = state.selection;
        var $from = ref.$from;
        var to = ref.to;
        var pos;
        var same = $from.sharedDepth(to);
        if (same == 0) {
            return false
        }
        pos = $from.before(same);
        if (dispatch) {
            dispatch(state.tr.setSelection(prosemirrorState.NodeSelection.create(state.doc, pos)))
        }
        return true
    }
    function selectAll(state, dispatch) {
        if (dispatch) {
            dispatch(state.tr.setSelection(new prosemirrorState.AllSelection(state.doc)))
        }
        return true
    }
    function joinMaybeClear(state, $pos, dispatch) {
        var before = $pos.nodeBefore
            , after = $pos.nodeAfter
            , index = $pos.index();
        if (!before || !after || !before.type.compatibleContent(after.type)) {
            return false
        }
        if (!before.content.size && $pos.parent.canReplace(index - 1, index)) {
            if (dispatch) {
                dispatch(state.tr.delete($pos.pos - before.nodeSize, $pos.pos).scrollIntoView())
            }
            return true
        }
        if (!$pos.parent.canReplace(index, index + 1) || !(after.isTextblock || prosemirrorTransform.canJoin(state.doc, $pos.pos))) {
            return false
        }
        if (dispatch) {
            dispatch(state.tr.clearIncompatible($pos.pos, before.type, before.contentMatchAt(before.childCount)).join($pos.pos).scrollIntoView())
        }
        return true
    }
    function deleteBarrier(state, $cut, dispatch) {
        var before = $cut.nodeBefore, after = $cut.nodeAfter, conn, match;
        if (before.type.spec.isolating || after.type.spec.isolating) {
            return false
        }
        if (joinMaybeClear(state, $cut, dispatch)) {
            return true
        }
        if ($cut.parent.canReplace($cut.index(), $cut.index() + 1) && (conn = (match = before.contentMatchAt(before.childCount)).findWrapping(after.type)) && match.matchType(conn[0] || after.type).validEnd) {
            if (dispatch) {
                var end = $cut.pos + after.nodeSize
                    , wrap = prosemirrorModel.Fragment.empty;
                for (var i = conn.length - 1; i >= 0; i--) {
                    wrap = prosemirrorModel.Fragment.from(conn[i].create(null, wrap))
                }
                wrap = prosemirrorModel.Fragment.from(before.copy(wrap));
                var tr = state.tr.step(new prosemirrorTransform.ReplaceAroundStep($cut.pos - 1,end,$cut.pos,end,new prosemirrorModel.Slice(wrap,1,0),conn.length,true));
                var joinAt = end + 2 * conn.length;
                if (prosemirrorTransform.canJoin(tr.doc, joinAt)) {
                    tr.join(joinAt)
                }
                dispatch(tr.scrollIntoView())
            }
            return true
        }
        var selAfter = prosemirrorState.Selection.findFrom($cut, 1);
        var range = selAfter && selAfter.$from.blockRange(selAfter.$to)
            , target = range && prosemirrorTransform.liftTarget(range);
        if (target != null && target >= $cut.depth) {
            if (dispatch) {
                dispatch(state.tr.lift(range, target).scrollIntoView())
            }
            return true
        }
        return false
    }
    function wrapIn(nodeType, attrs) {
        return function(state, dispatch) {
            var ref = state.selection;
            var $from = ref.$from;
            var $to = ref.$to;
            var range = $from.blockRange($to)
                , wrapping = range && prosemirrorTransform.findWrapping(range, nodeType, attrs);
            if (!wrapping) {
                return false
            }
            if (dispatch) {
                dispatch(state.tr.wrap(range, wrapping).scrollIntoView())
            }
            return true
        }
    }
    function setBlockType(nodeType, attrs) {
        return function(state, dispatch) {
            var ref = state.selection;
            var from = ref.from;
            var to = ref.to;
            var applicable = false;
            state.doc.nodesBetween(from, to, function(node, pos) {
                if (applicable) {
                    return false
                }
                if (!node.isTextblock || node.hasMarkup(nodeType, attrs)) {
                    return
                }
                if (node.type == nodeType) {
                    applicable = true
                } else {
                    var $pos = state.doc.resolve(pos)
                        , index = $pos.index();
                    applicable = $pos.parent.canReplaceWith(index, index + 1, nodeType)
                }
            });
            if (!applicable) {
                return false
            }
            if (dispatch) {
                dispatch(state.tr.setBlockType(from, to, nodeType, attrs).scrollIntoView())
            }
            return true
        }
    }
    function markApplies(doc, ranges, type) {
        var loop = function(i) {
            var ref = ranges[i];
            var $from = ref.$from;
            var $to = ref.$to;
            var can = $from.depth == 0 ? doc.type.allowsMarkType(type) : false;
            doc.nodesBetween($from.pos, $to.pos, function(node) {
                if (can) {
                    return false
                }
                can = node.inlineContent && node.type.allowsMarkType(type)
            });
            if (can) {
                return {
                    v: true
                }
            }
        };
        for (var i = 0; i < ranges.length; i++) {
            var returned = loop(i);
            if (returned)
                return returned.v
        }
        return false
    }
    function toggleMark(markType, attrs) {
        return function(state, dispatch) {
            var ref = state.selection;
            var empty = ref.empty;
            var $cursor = ref.$cursor;
            var ranges = ref.ranges;
            if (empty && !$cursor || !markApplies(state.doc, ranges, markType)) {
                return false
            }
            if (dispatch) {
                if ($cursor) {
                    if (markType.isInSet(state.storedMarks || $cursor.marks())) {
                        dispatch(state.tr.removeStoredMark(markType))
                    } else {
                        dispatch(state.tr.addStoredMark(markType.create(attrs)))
                    }
                } else {
                    var has = false
                        , tr = state.tr;
                    for (var i = 0; !has && i < ranges.length; i++) {
                        var ref$1 = ranges[i];
                        var $from = ref$1.$from;
                        var $to = ref$1.$to;
                        has = state.doc.rangeHasMark($from.pos, $to.pos, markType)
                    }
                    for (var i$1 = 0; i$1 < ranges.length; i$1++) {
                        var ref$2 = ranges[i$1];
                        var $from$1 = ref$2.$from;
                        var $to$1 = ref$2.$to;
                        if (has) {
                            tr.removeMark($from$1.pos, $to$1.pos, markType)
                        } else {
                            tr.addMark($from$1.pos, $to$1.pos, markType.create(attrs))
                        }
                    }
                    dispatch(tr.scrollIntoView())
                }
            }
            return true
        }
    }
    function wrapDispatchForJoin(dispatch, isJoinable) {
        return function(tr) {
            if (!tr.isGeneric) {
                return dispatch(tr)
            }
            var ranges = [];
            for (var i = 0; i < tr.mapping.maps.length; i++) {
                var map = tr.mapping.maps[i];
                for (var j = 0; j < ranges.length; j++) {
                    ranges[j] = map.map(ranges[j])
                }
                map.forEach(function(_s, _e, from, to) {
                    return ranges.push(from, to)
                })
            }
            var joinable = [];
            for (var i$1 = 0; i$1 < ranges.length; i$1 += 2) {
                var from = ranges[i$1]
                    , to = ranges[i$1 + 1];
                var $from = tr.doc.resolve(from)
                    , depth = $from.sharedDepth(to)
                    , parent = $from.node(depth);
                for (var index = $from.indexAfter(depth), pos = $from.after(depth + 1); pos <= to; ++index) {
                    var after = parent.maybeChild(index);
                    if (!after) {
                        break
                    }
                    if (index && joinable.indexOf(pos) == -1) {
                        var before = parent.child(index - 1);
                        if (before.type == after.type && isJoinable(before, after)) {
                            joinable.push(pos)
                        }
                    }
                    pos += after.nodeSize
                }
            }
            joinable.sort(function(a, b) {
                return a - b
            });
            for (var i$2 = joinable.length - 1; i$2 >= 0; i$2--) {
                if (prosemirrorTransform.canJoin(tr.doc, joinable[i$2])) {
                    tr.join(joinable[i$2])
                }
            }
            dispatch(tr)
        }
    }
    function autoJoin(command, isJoinable) {
        if (Array.isArray(isJoinable)) {
            var types = isJoinable;
            isJoinable = function(node) {
                return types.indexOf(node.type.name) > -1
            }
        }
        return function(state, dispatch) {
            return command(state, dispatch && wrapDispatchForJoin(dispatch, isJoinable))
        }
    }
    function chainCommands() {
        var commands = []
            , len = arguments.length;
        while (len--)
            commands[len] = arguments[len];
        return function(state, dispatch, view) {
            for (var i = 0; i < commands.length; i++) {
                if (commands[i](state, dispatch, view)) {
                    return true
                }
            }
            return false
        }
    }
    var backspace = chainCommands(deleteSelection, joinBackward, selectNodeBackward);
    var del = chainCommands(deleteSelection, joinForward, selectNodeForward);
    var pcBaseKeymap = {
        Enter: chainCommands(newlineInCode, createParagraphNear, liftEmptyBlock, splitBlock),
        "Mod-Enter": exitCode,
        Backspace: backspace,
        "Mod-Backspace": backspace,
        Delete: del,
        "Mod-Delete": del,
        "Mod-a": selectAll
    };
    var macBaseKeymap = {
        "Ctrl-h": pcBaseKeymap["Backspace"],
        "Alt-Backspace": pcBaseKeymap["Mod-Backspace"],
        "Ctrl-d": pcBaseKeymap["Delete"],
        "Ctrl-Alt-Backspace": pcBaseKeymap["Mod-Delete"],
        "Alt-Delete": pcBaseKeymap["Mod-Delete"],
        "Alt-d": pcBaseKeymap["Mod-Delete"]
    };
    for (var key in pcBaseKeymap) {
        macBaseKeymap[key] = pcBaseKeymap[key]
    }
    var mac = typeof navigator != "undefined" ? /Mac/.test(navigator.platform) : typeof os != "undefined" ? os.platform() == "darwin" : false;
    var baseKeymap = mac ? macBaseKeymap : pcBaseKeymap;
    exports.autoJoin = autoJoin;
    exports.baseKeymap = baseKeymap;
    exports.chainCommands = chainCommands;
    exports.createParagraphNear = createParagraphNear;
    exports.deleteSelection = deleteSelection;
    exports.exitCode = exitCode;
    exports.joinBackward = joinBackward;
    exports.joinDown = joinDown;
    exports.joinForward = joinForward;
    exports.joinUp = joinUp;
    exports.lift = lift;
    exports.liftEmptyBlock = liftEmptyBlock;
    exports.macBaseKeymap = macBaseKeymap;
    exports.newlineInCode = newlineInCode;
    exports.pcBaseKeymap = pcBaseKeymap;
    exports.selectAll = selectAll;
    exports.selectNodeBackward = selectNodeBackward;
    exports.selectNodeForward = selectNodeForward;
    exports.selectParentNode = selectParentNode;
    exports.setBlockType = setBlockType;
    exports.splitBlock = splitBlock;
    exports.splitBlockKeepMarks = splitBlockKeepMarks;
    exports.toggleMark = toggleMark;
    exports.wrapIn = wrapIn
});
define("prosemirror-commands", ["prosemirror-commands/index"], function(main) {
    return main
});
define("prosemirror-schema-list/index", ["require", "exports", "module", "prosemirror-transform", "prosemirror-model"], function(require, exports, module) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var prosemirrorTransform = require("prosemirror-transform");
    var prosemirrorModel = require("prosemirror-model");
    var olDOM = ["ol", 0]
        , ulDOM = ["ul", 0]
        , liDOM = ["li", 0];
    var orderedList = {
        attrs: {
            order: {
                default: 1
            }
        },
        parseDOM: [{
            tag: "ol",
            getAttrs: function getAttrs(dom) {
                return {
                    order: dom.hasAttribute("start") ? +dom.getAttribute("start") : 1
                }
            }
        }],
        toDOM: function toDOM(node) {
            return node.attrs.order == 1 ? olDOM : ["ol", {
                start: node.attrs.order
            }, 0]
        }
    };
    var bulletList = {
        parseDOM: [{
            tag: "ul"
        }],
        toDOM: function toDOM() {
            return ulDOM
        }
    };
    var listItem = {
        parseDOM: [{
            tag: "li"
        }],
        toDOM: function toDOM() {
            return liDOM
        },
        defining: true
    };
    function add(obj, props) {
        var copy = {};
        for (var prop in obj) {
            copy[prop] = obj[prop]
        }
        for (var prop$1 in props) {
            copy[prop$1] = props[prop$1]
        }
        return copy
    }
    function addListNodes(nodes, itemContent, listGroup) {
        return nodes.append({
            ordered_list: add(orderedList, {
                content: "list_item+",
                group: listGroup
            }),
            bullet_list: add(bulletList, {
                content: "list_item+",
                group: listGroup
            }),
            list_item: add(listItem, {
                content: itemContent
            })
        })
    }
    function wrapInList(listType, attrs) {
        return function(state, dispatch) {
            var ref = state.selection;
            var $from = ref.$from;
            var $to = ref.$to;
            var range = $from.blockRange($to)
                , doJoin = false
                , outerRange = range;
            if (!range) {
                return false
            }
            if (range.depth >= 2 && $from.node(range.depth - 1).type.compatibleContent(listType) && range.startIndex == 0) {
                if ($from.index(range.depth - 1) == 0) {
                    return false
                }
                var $insert = state.doc.resolve(range.start - 2);
                outerRange = new prosemirrorModel.NodeRange($insert,$insert,range.depth);
                if (range.endIndex < range.parent.childCount) {
                    range = new prosemirrorModel.NodeRange($from,state.doc.resolve($to.end(range.depth)),range.depth)
                }
                doJoin = true
            }
            var wrap = prosemirrorTransform.findWrapping(outerRange, listType, attrs, range);
            if (!wrap) {
                return false
            }
            if (dispatch) {
                dispatch(doWrapInList(state.tr, range, wrap, doJoin, listType).scrollIntoView())
            }
            return true
        }
    }
    function doWrapInList(tr, range, wrappers, joinBefore, listType) {
        var content = prosemirrorModel.Fragment.empty;
        for (var i = wrappers.length - 1; i >= 0; i--) {
            content = prosemirrorModel.Fragment.from(wrappers[i].type.create(wrappers[i].attrs, content))
        }
        tr.step(new prosemirrorTransform.ReplaceAroundStep(range.start - (joinBefore ? 2 : 0),range.end,range.start,range.end,new prosemirrorModel.Slice(content,0,0),wrappers.length,true));
        var found = 0;
        for (var i$1 = 0; i$1 < wrappers.length; i$1++) {
            if (wrappers[i$1].type == listType) {
                found = i$1 + 1
            }
        }
        var splitDepth = wrappers.length - found;
        var splitPos = range.start + wrappers.length - (joinBefore ? 2 : 0)
            , parent = range.parent;
        for (var i$2 = range.startIndex, e = range.endIndex, first = true; i$2 < e; i$2++,
            first = false) {
            if (!first && prosemirrorTransform.canSplit(tr.doc, splitPos, splitDepth)) {
                tr.split(splitPos, splitDepth);
                splitPos += 2 * splitDepth
            }
            splitPos += parent.child(i$2).nodeSize
        }
        return tr
    }
    function splitListItem(itemType) {
        return function(state, dispatch) {
            var ref = state.selection;
            var $from = ref.$from;
            var $to = ref.$to;
            var node = ref.node;
            if (node && node.isBlock || $from.depth < 2 || !$from.sameParent($to)) {
                return false
            }
            var grandParent = $from.node(-1);
            if (grandParent.type != itemType) {
                return false
            }
            if ($from.parent.content.size == 0) {
                if ($from.depth == 2 || $from.node(-3).type != itemType || $from.index(-2) != $from.node(-2).childCount - 1) {
                    return false
                }
                if (dispatch) {
                    var wrap = prosemirrorModel.Fragment.empty
                        , keepItem = $from.index(-1) > 0;
                    for (var d = $from.depth - (keepItem ? 1 : 2); d >= $from.depth - 3; d--) {
                        wrap = prosemirrorModel.Fragment.from($from.node(d).copy(wrap))
                    }
                    wrap = wrap.append(prosemirrorModel.Fragment.from(itemType.createAndFill()));
                    var tr$1 = state.tr.replace($from.before(keepItem ? null : -1), $from.after(-3), new prosemirrorModel.Slice(wrap,keepItem ? 3 : 2,2));
                    tr$1.setSelection(state.selection.constructor.near(tr$1.doc.resolve($from.pos + (keepItem ? 3 : 2))));
                    dispatch(tr$1.scrollIntoView())
                }
                return true
            }
            var nextType = $to.pos == $from.end() ? grandParent.contentMatchAt(0).defaultType : null;
            var tr = state.tr.delete($from.pos, $to.pos);
            var types = nextType && [null, {
                type: nextType
            }];
            if (!prosemirrorTransform.canSplit(tr.doc, $from.pos, 2, types)) {
                return false
            }
            if (dispatch) {
                dispatch(tr.split($from.pos, 2, types).scrollIntoView())
            }
            return true
        }
    }
    function liftListItem(itemType) {
        return function(state, dispatch) {
            var ref = state.selection;
            var $from = ref.$from;
            var $to = ref.$to;
            var range = $from.blockRange($to, function(node) {
                return node.childCount && node.firstChild.type == itemType
            });
            if (!range) {
                return false
            }
            if (!dispatch) {
                return true
            }
            if ($from.node(range.depth - 1).type == itemType) {
                return liftToOuterList(state, dispatch, itemType, range)
            } else {
                return liftOutOfList(state, dispatch, range)
            }
        }
    }
    function liftToOuterList(state, dispatch, itemType, range) {
        var tr = state.tr
            , end = range.end
            , endOfList = range.$to.end(range.depth);
        if (end < endOfList) {
            tr.step(new prosemirrorTransform.ReplaceAroundStep(end - 1,endOfList,end,endOfList,new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(itemType.create(null, range.parent.copy())),1,0),1,true));
            range = new prosemirrorModel.NodeRange(tr.doc.resolve(range.$from.pos),tr.doc.resolve(endOfList),range.depth)
        }
        dispatch(tr.lift(range, prosemirrorTransform.liftTarget(range)).scrollIntoView());
        return true
    }
    function liftOutOfList(state, dispatch, range) {
        var tr = state.tr
            , list = range.parent;
        for (var pos = range.end, i = range.endIndex - 1, e = range.startIndex; i > e; i--) {
            pos -= list.child(i).nodeSize;
            tr.delete(pos - 1, pos + 1)
        }
        var $start = tr.doc.resolve(range.start)
            , item = $start.nodeAfter;
        var atStart = range.startIndex == 0
            , atEnd = range.endIndex == list.childCount;
        var parent = $start.node(-1)
            , indexBefore = $start.index(-1);
        if (!parent.canReplace(indexBefore + (atStart ? 0 : 1), indexBefore + 1, item.content.append(atEnd ? prosemirrorModel.Fragment.empty : prosemirrorModel.Fragment.from(list)))) {
            return false
        }
        var start = $start.pos
            , end = start + item.nodeSize;
        tr.step(new prosemirrorTransform.ReplaceAroundStep(start - (atStart ? 1 : 0),end + (atEnd ? 1 : 0),start + 1,end - 1,new prosemirrorModel.Slice((atStart ? prosemirrorModel.Fragment.empty : prosemirrorModel.Fragment.from(list.copy(prosemirrorModel.Fragment.empty))).append(atEnd ? prosemirrorModel.Fragment.empty : prosemirrorModel.Fragment.from(list.copy(prosemirrorModel.Fragment.empty))),atStart ? 0 : 1,atEnd ? 0 : 1),atStart ? 0 : 1));
        dispatch(tr.scrollIntoView());
        return true
    }
    function sinkListItem(itemType) {
        return function(state, dispatch) {
            var ref = state.selection;
            var $from = ref.$from;
            var $to = ref.$to;
            var range = $from.blockRange($to, function(node) {
                return node.childCount && node.firstChild.type == itemType
            });
            if (!range) {
                return false
            }
            var startIndex = range.startIndex;
            if (startIndex == 0) {
                return false
            }
            var parent = range.parent
                , nodeBefore = parent.child(startIndex - 1);
            if (nodeBefore.type != itemType) {
                return false
            }
            if (dispatch) {
                var nestedBefore = nodeBefore.lastChild && nodeBefore.lastChild.type == parent.type;
                var inner = prosemirrorModel.Fragment.from(nestedBefore ? itemType.create() : null);
                var slice = new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(itemType.create(null, prosemirrorModel.Fragment.from(parent.type.create(null, inner)))),nestedBefore ? 3 : 1,0);
                var before = range.start
                    , after = range.end;
                dispatch(state.tr.step(new prosemirrorTransform.ReplaceAroundStep(before - (nestedBefore ? 3 : 1),after,before,after,slice,1,true)).scrollIntoView())
            }
            return true
        }
    }
    exports.addListNodes = addListNodes;
    exports.bulletList = bulletList;
    exports.liftListItem = liftListItem;
    exports.listItem = listItem;
    exports.orderedList = orderedList;
    exports.sinkListItem = sinkListItem;
    exports.splitListItem = splitListItem;
    exports.wrapInList = wrapInList
});
define("prosemirror-schema-list", ["prosemirror-schema-list/index"], function(main) {
    return main
});
define("ipad.ghostevents", ["require"], function(require) {
    var inGhostEventMode = false;
    var startingActiveElement = null;
    function stopGhostEvent(evt) {
        if (inGhostEventMode && touchTrackingCallbacks.evtInScope(evt)) {
            evt.stopPropagation();
            evt.stopImmediatePropagation()
        }
    }
    function stopAndPreventGhostEvent(evt) {
        if (inGhostEventMode && touchTrackingCallbacks.evtInScope(evt)) {
            evt.preventDefault();
            evt.stopPropagation();
            evt.stopImmediatePropagation()
        }
    }
    var touchTrackingCallbacks = {
        isGhostEvent: function(evt) {
            return false
        },
        evtInScope: function(evt) {
            return false
        }
    };
    document.addEventListener("mousedown", function(evt) {
        if (!touchTrackingCallbacks.evtInScope(evt))
            return;
        startingActiveElement = document.activeElement;
        inGhostEventMode = touchTrackingCallbacks.isGhostEvent(evt);
        stopGhostEvent(evt)
    }, true);
    document.addEventListener("mouseup", stopGhostEvent, true);
    document.addEventListener("click", function(evt) {
        stopAndPreventGhostEvent(evt);
        if (inGhostEventMode && document.activeElement !== startingActiveElement) {
            if (document.activeElement)
                document.activeElement.blur();
            if (startingActiveElement)
                startingActiveElement.focus()
        }
        inGhostEventMode = false
    }, true);
    document.addEventListener("focus", stopAndPreventGhostEvent, true);
    document.addEventListener("blur", stopAndPreventGhostEvent, true);
    return touchTrackingCallbacks
});
define("keys", ["require"], function(require) {
    var Keys = function() {
        var table = {
            8: this.BACKSPACE = "Backspace",
            9: this.TAB = "Tab",
            13: this.ENTER = "Enter",
            16: this.SHIFT = "Shift",
            17: this.CONTROL = "Control",
            18: this.ALT = "Alt",
            20: this.CAPSLOCK = "CapsLock",
            27: this.ESCAPE = "Esc",
            32: this.SPACEBAR = "Space",
            33: this.PAGEUP = "PageUp",
            34: this.PAGEDOWN = "PageDown",
            35: this.END = "End",
            36: this.HOME = "Home",
            37: this.LEFT = "Left",
            38: this.UP = "Up",
            39: this.RIGHT = "Right",
            40: this.DOWN = "Down",
            46: this.DELETE = "Del"
        };
        var iosTable = {
            UIKeyInputUpArrow: this.UP,
            UIKeyInputDownArrow: this.DOWN,
            UIKeyInputLeftArrow: this.LEFT,
            UIKeyInputRightArrow: this.RIGHT,
            UIKeyInputEscape: this.ESCAPE,
            UIKeyInputPageUp: this.PAGEUP,
            UIKeyInputPageDown: this.PAGEDOWN
        };
        this.isUndo = function(evt) {
            return !evt.altKey && (evt.ctrlKey || evt.metaKey) && evt.which == 90 && !evt.shiftKey
        }
        ;
        this.isRedo = function(evt) {
            return !evt.altKey && (evt.ctrlKey || evt.metaKey) && (evt.which == 89 || evt.which == 90 && evt.shiftKey)
        }
        ;
        this.isSelectAll = function(evt) {
            return !evt.altKey && (evt.ctrlKey || evt.metaKey) && evt.which == 65
        }
        ;
        this.isBacktick = function(evt) {
            return !evt.altKey && !evt.ctrlKey && !evt.metaKey && !evt.shiftKey && evt.which == 192
        }
        ;
        this.isHelp = function(evt) {
            return !evt.altKey && (evt.ctrlKey || evt.metaKey) && evt.which == 191
        }
        ;
        this.lookup = function(evt) {
            return table[evt.which] || iosTable[evt.key]
        }
        ;
        this.lookupChar = function(evt) {
            return String.fromCharCode(evt.which)
        }
    };
    return new Keys
});
define("loadcss!touchtracking", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/submodules/albany/touchtracking.css", decodeURIComponent("%0A%2F*%0A%20%20we%20want%20to%20position%20things%20relative%20to%20the%20dcg-tap-container%2C%20e.g.%20tooltips.%0A%20%20but%20putting%20position%3Arelative%20on%20body%20breaks%20layout.%20if%20it's%20the%20whole%20body%2C%0A%20%20then%20we%20don't%20need%20to%20worry%20about%20absolute%20positioning%20of%20a%20child%20relative%20to%0A%20%20the%20element%20anyhow%0A*%2F%0A.dcg-tap-container%3Anot(body)%20%7B%0A%20%20position%3A%20relative%3B%20%2F*so%20that%20we%20can%20absolutely%20position%20e.g.%20tooltips%20inside%20of%20our%20API*%2F%0A%7D%0A%0A.dcg-focus-by-tap%3Afocus%20%7B%0A%20%20outline%3A%20none%3B%0A%7D"))
});
define("touchtracking", ["require", "jquery", "ipad.ghostevents", "keys", "loadcss!./touchtracking"], function(require) {
    var $ = require("jquery");
    var GhostEvents = require("ipad.ghostevents");
    var Keys = require("keys");
    require("loadcss!./touchtracking");
    if (window._touchtracking_id_counter == undefined) {
        window._touchtracking_id_counter = 0
    }
    window._touchtracking_id_counter += 1;
    var namespace = "touchtracking_id_" + window._touchtracking_id_counter;
    var monitor = function(tapContainer) {
        $(tapContainer).addClass("dcg-tap-container");
        $(tapContainer).addClass(namespace)
    };
    var ignore = function(element) {
        $(element).addClass("dcg-no-touchtracking")
    };
    GhostEvents.evtInScope = function(evt) {
        return elIsInScope(evt.target)
    }
    ;
    GhostEvents.isGhostEvent = function(evt) {
        if (window.PointerEvent) {
            return false
        }
        if (mode !== TOUCH_MODE && mode !== POINTER_MODE && !hasRecentlyEndedTouchMode()) {
            return false
        }
        if (evt.target === lastTarget)
            return false;
        if (evt.target && $.contains(evt.target, lastTarget))
            return false;
        if (lastTarget && $.contains(lastTarget, evt.target))
            return false;
        return true
    }
    ;
    var NO_MODE = 0;
    var TOUCH_MODE = 1;
    var MOUSE_MODE = 2;
    var KEYBOARD_MODE = 3;
    var POINTER_MODE = 4;
    var mode = NO_MODE;
    var identifierLocation = {};
    var modeEvents = {};
    var modeTargets = [];
    var endTouchModeTime = 0;
    var endTouchModeTimeout = null;
    var lastTarget = null;
    var longholdTimeout = null;
    var pointerTouches = [];
    var getAncestors = function(node) {
        var nodes = [];
        while (node) {
            nodes.push(node);
            node = node.parentNode
        }
        return nodes
    };
    var filterSortedNodesWithinScope = function(sortedNodes) {
        var filtered = [];
        for (var i = 0; i < sortedNodes.length; i++) {
            var node = sortedNodes[i];
            filtered.push(node);
            if ($(node).is(".dcg-tap-container, .dcg-no-touchtracking")) {
                if ($(node).is(".dcg-tap-container." + namespace)) {
                    return filtered
                } else {
                    return []
                }
            }
        }
        return []
    };
    var beginMode = function(_mode, evnt) {
        lastTarget = null;
        mode = _mode;
        if (mode === TOUCH_MODE) {
            modeTargets = getAncestors(evnt.originalEvent.touches[0].target)
        } else {
            modeTargets = getAncestors(evnt.target)
        }
        $(filterSortedNodesWithinScope(modeTargets)).addClass("dcg-depressed").each(function() {
            var elm = $(this);
            if (shouldOverrideFocusOnEl(elm)) {
                elm.addClass("dcg-focus-by-tap")
            }
        });
        $(modeTargets).each(function() {
            var elm = $(this);
            elm.data({
                originalScrollTop: elm.scrollTop(),
                originalScrollLeft: elm.scrollLeft()
            })
        });
        modeEvents = {}
    };
    var elIsFocusable = function(el) {
        return el.is("input, textarea, select") || el.hasClass("dcg-mathquill-input-span") || el.is("[contenteditable=true]")
    };
    var elIsInScope = function(el) {
        return !!$(el).closest(".dcg-tap-container, .dcg-no-touchtracking").is(".dcg-tap-container." + namespace)
    };
    var shouldOverrideFocusOnEl = function(el) {
        return mode !== KEYBOARD_MODE && !elIsFocusable(el) && elIsInScope(el)
    };
    var endMode = function(evnt) {
        lastTarget = null;
        $(".dcg-depressed").removeClass("dcg-depressed");
        var focusedEl = $(document.activeElement);
        if (shouldOverrideFocusOnEl(focusedEl)) {
            try {
                focusedEl.blur()
            } catch (ex) {}
        }
        $(".dcg-focus-by-tap").removeClass("dcg-focus-by-tap");
        $(modeTargets).each(function() {
            var elm = $(this);
            var verticalOffset = elm.data("originalScrollTop") - elm.scrollTop();
            var horizontalOffset = elm.data("originalScrollLeft") - elm.scrollLeft();
            if (verticalOffset || horizontalOffset) {
                modeEvents.scroll = true
            }
        });
        if (modeEvents["dcg-tapstart"] === 1 && modeEvents["dcg-tapend"] === 1 && !modeEvents["dcg-tapcancel"] && !modeEvents.scroll) {
            var x = evnt.device === "mouse" ? evnt.clientX : evnt.originalEvent.changedTouches[0].clientX;
            var y = evnt.device === "mouse" ? evnt.clientY : evnt.originalEvent.changedTouches[0].clientY;
            if (evnt && !evnt.device && x === 0 && y === 0) {
                var rect = evnt.target.getBoundingClientRect();
                x = (rect.left + rect.right) / 2;
                y = (rect.top + rect.bottom) / 2;
                evnt.device = "keyboard"
            }
            var tap_escaped_boundary = false;
            for (var i = 0; i < modeTargets.length && !tap_escaped_boundary; i++) {
                var target = $(modeTargets[i]);
                var offset;
                if (typeof target[0].getBoundingClientRect === "function") {
                    offset = target[0].getBoundingClientRect()
                }
                if (target.attr("tapboundary") === "true") {
                    tap_escaped_boundary = true
                }
                if (offset) {
                    if (x < offset.left || y < offset.top)
                        continue;
                    if (x > offset.right)
                        continue;
                    if (y > offset.bottom)
                        continue
                }
                lastTarget = target[0];
                dispatchEvent("dcg-tap", evnt, lastTarget);
                break
            }
        }
        if (mode === TOUCH_MODE || mode === POINTER_MODE) {
            endTouchModeTimeout = setTimeout(function() {
                endTouchModeTimeout = null;
                endTouchModeTime = (new Date).getTime()
            }, 1e3)
        }
        modeTargets = [];
        mode = NO_MODE
    };
    var hasRecentlyEndedTouchMode = function() {
        return endTouchModeTimeout || (new Date).getTime() - endTouchModeTime < 500
    };
    var clone = function(touches) {
        var cloned = [];
        for (var i = 0; i < touches.length; i++) {
            var touch = touches[i];
            cloned.push({
                identifier: touch.identifier,
                x: touch.pageX,
                y: touch.pageY,
                screenX: touch.screenX,
                screenY: touch.screenY,
                pageX: touch.pageX,
                pageY: touch.pageY,
                clientX: touch.clientX,
                clientY: touch.clientY
            })
        }
        return cloned
    };
    var dispatchEvent = function(type, evnt, differentTarget) {
        if (type === "dcg-tapstart") {
            identifierLocation[evnt.identifier] = {
                type: type,
                pageX: evnt.originalEvent.changedTouches[0].pageX,
                pageY: evnt.originalEvent.changedTouches[0].pageY
            }
        } else if (type === "dcg-tapmove") {
            var thisEvnt = evnt.originalEvent.changedTouches[0];
            var lastEvnt = identifierLocation[evnt.identifier];
            if (lastEvnt && thisEvnt.pageX === lastEvnt.pageX && thisEvnt.pageY === lastEvnt.pageY) {
                return
            }
            if ((mode === TOUCH_MODE || mode === POINTER_MODE) && lastEvnt && lastEvnt.type === "dcg-tapstart" && Math.abs(lastEvnt.pageX - thisEvnt.pageX) + Math.abs(lastEvnt.pageY - thisEvnt.pageY) < 2) {
                return
            }
            identifierLocation[evnt.identifier] = {
                type: type,
                pageX: evnt.originalEvent.changedTouches[0].pageX,
                pageY: evnt.originalEvent.changedTouches[0].pageY
            }
        }
        if (modeEvents[type.toLowerCase()] === undefined) {
            modeEvents[type.toLowerCase()] = 1
        } else {
            modeEvents[type.toLowerCase()]++
        }
        var newEvnt = $.event.fix(evnt.originalEvent);
        newEvnt.type = type;
        newEvnt.device = mode === TOUCH_MODE || mode === POINTER_MODE ? "touch" : mode === KEYBOARD_MODE ? "keyboard" : "mouse";
        newEvnt.touches = clone(evnt.originalEvent.touches);
        newEvnt.changedTouches = clone(evnt.originalEvent.changedTouches);
        newEvnt.target = differentTarget ? differentTarget : evnt.target;
        var wasLongheld = newEvnt.device !== "keyboard" && modeEvents["dcg-longhold"] > 0;
        newEvnt.wasLongheld = function() {
            return wasLongheld
        }
        ;
        newEvnt.preventTap = function() {
            modeEvents["dcg-tapcancel"] = 1
        }
        ;
        clearTimeout(longholdTimeout);
        if (newEvnt.type === "dcg-tapstart" && newEvnt.device !== "keyboard" && newEvnt.touches.length === 1) {
            longholdTimeout = setTimeout(function() {
                dispatchEvent("dcg-longhold", evnt, differentTarget)
            }, 500)
        }
        if (newEvnt.target && $.nodeName(newEvnt.target, "a") && newEvnt.type === "dcg-tap" && newEvnt.device === "keyboard" && newEvnt.target.click) {
            newEvnt.target.click()
        }
        $(newEvnt.target).trigger(newEvnt)
    };
    var setHoveredNode = function(node) {
        var hoverableNodes = modeTargets;
        var checkIfNodeIsHoverable = !!modeTargets.length;
        var allHovered = $(".dcg-tap-container." + namespace + " .dcg-hovered");
        var hoveredBefore = $.makeArray(allHovered.filter(function() {
            return elIsInScope(this)
        }));
        var hoveredNow = [];
        var lostHover = [];
        var gainedHover = [];
        filterSortedNodesWithinScope(getAncestors(node)).forEach(function(node) {
            if (!checkIfNodeIsHoverable || hoverableNodes.indexOf(node) !== -1) {
                if (hoveredBefore.indexOf(node) === -1) {
                    gainedHover.push(node)
                }
                hoveredNow.push(node)
            }
        });
        for (var i = 0; i < hoveredBefore.length; i++) {
            node = hoveredBefore[i];
            if (hoveredNow.indexOf(node) === -1) {
                lostHover.push(node)
            }
        }
        $(lostHover).removeClass("dcg-hovered").trigger("tipsyhide");
        $(gainedHover).addClass("dcg-hovered").trigger("tipsyshow")
    };
    var doesPointerIdAlreadyExist = function(id) {
        for (var i = 0; i < pointerTouches.length; i++) {
            if (pointerTouches[i].pointerId === id) {
                return true
            }
        }
        return false
    };
    var removePointerEventById = function(id) {
        for (var i = 0; i < pointerTouches.length; i++) {
            if (pointerTouches[i].pointerId === id) {
                return pointerTouches.splice(i, 1)[0]
            }
        }
    };
    var handlePointerDownEvent = function(evnt) {
        if (mode === NO_MODE) {
            beginMode(POINTER_MODE, evnt)
        }
        setHoveredNode(null);
        pointerTouches.push(evnt.originalEvent);
        evnt.originalEvent.identifier = evnt.originalEvent.pointerId;
        evnt.originalEvent.touches = pointerTouches;
        evnt.originalEvent.changedTouches = [evnt.originalEvent];
        dispatchEvent("dcg-tapstart", evnt)
    };
    var handlePointerCancelEvent = function(evnt) {
        removePointerEventById(evnt.originalEvent.pointerId);
        evnt.originalEvent.identifier = evnt.originalEvent.pointerId;
        evnt.originalEvent.touches = pointerTouches;
        evnt.originalEvent.changedTouches = [evnt.originalEvent];
        dispatchEvent("dcg-tapcancel", evnt);
        if (pointerTouches.length === 0) {
            endMode(evnt)
        }
    };
    var handlePointerUpEvent = function(evnt) {
        removePointerEventById(evnt.originalEvent.pointerId);
        evnt.originalEvent.identifier = evnt.originalEvent.pointerId;
        evnt.originalEvent.touches = pointerTouches;
        evnt.originalEvent.changedTouches = [evnt.originalEvent];
        dispatchEvent("dcg-tapend", evnt);
        if (pointerTouches.length === 0) {
            endMode(evnt)
        }
    };
    var isMSPointerEvent = function(evnt) {
        return evnt.originalEvent.pointerType === "touch" || evnt.originalEvent.pointerType === 2
    };
    $(document).on("pointerdown MSPointerDown", function(evnt) {
        if (mode === MOUSE_MODE || mode === TOUCH_MODE || !isMSPointerEvent(evnt))
            return;
        if (doesPointerIdAlreadyExist(evnt.originalEvent.pointerId))
            return;
        handlePointerDownEvent(evnt)
    });
    $(document).on("pointermove MSPointerMove", function(evnt) {
        if (mode === MOUSE_MODE || mode === TOUCH_MODE || !isMSPointerEvent(evnt))
            return;
        if (!doesPointerIdAlreadyExist(evnt.originalEvent.pointerId)) {
            handlePointerDownEvent(evnt)
        }
        removePointerEventById(evnt.originalEvent.pointerId);
        pointerTouches.push(evnt.originalEvent);
        evnt.originalEvent.identifier = evnt.originalEvent.pointerId;
        evnt.originalEvent.touches = pointerTouches;
        evnt.originalEvent.changedTouches = [evnt.originalEvent];
        dispatchEvent("dcg-tapmove", evnt)
    });
    $(document).on("pointercancel MSPointerCancel", function(evnt) {
        if (mode !== POINTER_MODE || !isMSPointerEvent(evnt))
            return;
        if (!doesPointerIdAlreadyExist(evnt.originalEvent.pointerId))
            return;
        handlePointerCancelEvent(evnt);
        var pointerTouch;
        while (pointerTouch = pointerTouches.pop()) {
            var evnt = $.Event(pointerTouch, {
                originalEvent: pointerTouch
            });
            handlePointerCancelEvent(evnt)
        }
    });
    $(document).on("pointerup MSPointerUp", function(evnt) {
        if (mode !== POINTER_MODE || !isMSPointerEvent(evnt))
            return;
        if (!doesPointerIdAlreadyExist(evnt.originalEvent.pointerId))
            return;
        handlePointerUpEvent(evnt);
        var pointerTouch;
        while (pointerTouch = pointerTouches.pop()) {
            var evnt = $.Event(pointerTouch, {
                originalEvent: pointerTouch
            });
            handlePointerUpEvent(evnt)
        }
    });
    var arePassiveEventsSupported = function() {
        var supported = false;
        try {
            var opts = Object.defineProperty({}, "passive", {
                get: function() {
                    supported = true
                }
            });
            window.addEventListener("test", function() {}, opts);
            window.removeEventListener("test", function() {}, opts)
        } catch (e) {}
        return supported
    }();
    function addGlobalNonPassiveListener(evntName, handler) {
        var nonPassiveOpts = arePassiveEventsSupported ? {
            passive: false
        } : undefined;
        document.addEventListener(evntName, function(evt) {
            handler($.event.fix(evt))
        }, nonPassiveOpts)
    }
    addGlobalNonPassiveListener("touchstart", function(evnt) {
        if (mode === MOUSE_MODE || mode === POINTER_MODE)
            return;
        if (mode === NO_MODE) {
            beginMode(TOUCH_MODE, evnt)
        }
        setHoveredNode(null);
        dispatchEvent("dcg-tapstart", evnt)
    });
    addGlobalNonPassiveListener("touchmove", function(evnt) {
        if (mode !== TOUCH_MODE)
            return;
        dispatchEvent("dcg-tapmove", evnt)
    });
    addGlobalNonPassiveListener("touchcancel", function(evnt) {
        if (mode !== TOUCH_MODE)
            return;
        dispatchEvent("dcg-tapcancel", evnt);
        if (evnt.originalEvent.touches.length === 0) {
            endMode(evnt)
        }
    });
    addGlobalNonPassiveListener("touchend", function(evnt) {
        if (mode !== TOUCH_MODE)
            return;
        dispatchEvent("dcg-tapend", evnt);
        if (evnt.originalEvent.touches.length === 0) {
            endMode(evnt)
        }
    });
    $(document).on("mousedown", function(evnt) {
        if (evnt.button === 1 || evnt.button === 2)
            return;
        if (mode === TOUCH_MODE || mode === POINTER_MODE || hasRecentlyEndedTouchMode()) {
            if (!$(evnt.target).is("input, textarea, select") && elIsInScope(evnt.target)) {
                evnt.preventDefault()
            }
            return
        }
        beginMode(MOUSE_MODE, evnt);
        evnt.originalEvent.touches = [evnt];
        evnt.originalEvent.changedTouches = [evnt];
        dispatchEvent("dcg-tapstart", evnt)
    });
    $(document).ready(function() {
        $(document).on("mousedown", function(e) {
            var doNotBlur = !!$(e.target).closest(".dcg-do-not-blur").length;
            var doBlur = !!$(e.target).closest(".dcg-do-blur").length;
            if (!doNotBlur || doBlur || !elIsInScope(e.target))
                return;
            e.preventDefault();
            try {
                var selection = window.getSelection();
                if (selection.rangeCount === 1) {
                    var range = selection.getRangeAt(0);
                    if (range.startContainer === range.endContainer && $(range.startContainer).closest(".dcg-text-selectable").length) {
                        selection.removeAllRanges()
                    }
                }
            } catch (err) {}
        })
    });
    $(document).on("mouseleave", function(evnt) {
        if (mode !== NO_MODE)
            return;
        if (hasRecentlyEndedTouchMode())
            return;
        setHoveredNode(null)
    });
    $(document).on("mousemove", function(evnt) {
        if (evnt.button === 1 || evnt.button === 2)
            return;
        if (mode === TOUCH_MODE || mode === POINTER_MODE)
            return;
        if (hasRecentlyEndedTouchMode())
            return;
        setHoveredNode(evnt.target);
        evnt.originalEvent.touches = [evnt];
        evnt.originalEvent.changedTouches = [evnt];
        dispatchEvent("dcg-tapmove", evnt)
    });
    $(document).on("mouseup", function(evnt) {
        if (evnt.button === 1 || evnt.button === 2)
            return;
        if (mode !== MOUSE_MODE)
            return;
        evnt.originalEvent.touches = [];
        evnt.originalEvent.changedTouches = [evnt];
        dispatchEvent("dcg-tapend", evnt);
        endMode(evnt)
    });
    $(document).on("keydown", function(evnt) {
        if (Keys.lookup(evnt) !== Keys.ENTER && Keys.lookup(evnt) !== Keys.SPACEBAR || !elIsInScope(evnt.target))
            return;
        if (mode !== KEYBOARD_MODE) {
            if ($(evnt.target).is('a:not([ontap]), button, input, textarea, select, [contenteditable="true"]'))
                return;
            evnt.preventDefault();
            beginMode(KEYBOARD_MODE, evnt);
            evnt.originalEvent.touches = [evnt];
            evnt.originalEvent.changedTouches = [evnt];
            dispatchEvent("dcg-tapstart", evnt)
        }
    });
    $(document).on("keyup", function(evnt) {
        if (Keys.lookup(evnt) !== Keys.ENTER && Keys.lookup(evnt) !== Keys.SPACEBAR || !elIsInScope(evnt.target))
            return;
        if (mode !== KEYBOARD_MODE)
            return;
        evnt.originalEvent.touches = [];
        evnt.originalEvent.changedTouches = [evnt];
        dispatchEvent("dcg-tapend", evnt);
        endMode(evnt)
    });
    return {
        monitor: monitor,
        ignore: ignore,
        isTapActive: function() {
            return mode !== NO_MODE
        },
        elIsFocusable: elIsFocusable
    }
});
define("activitybuilder/components/shared/prosemirror/sub-manager", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var SubManager = function() {
        function SubManager() {
            this.counter = 0;
            this.callbacks = {}
        }
        SubManager.prototype.add = function(fn) {
            var _this = this;
            var token = this.counter;
            this.callbacks[token] = fn;
            this.counter += 1;
            return function() {
                delete _this.callbacks[token]
            }
        }
        ;
        SubManager.prototype.invoke = function(tr) {
            for (var key in this.callbacks) {
                this.callbacks[key](tr)
            }
        }
        ;
        return SubManager
    }();
    exports.SubManager = SubManager
});
define("desmos-api", ["require", "exports"], function(require, exports) {
    "use strict";
    var Desmos = window.Desmos;
    if (Desmos == undefined) {
        throw new Error("Desmos failed to load!")
    }
    return Desmos
});
define("desmos", ["require", "exports", "tslib", "desmos-api"], function(require, exports, tslib_1, _Desmos) {
    "use strict";
    var Desmos = _Desmos;
    var DesmosAugmented = tslib_1.__assign(tslib_1.__assign({}, Desmos), {
        CalculatorPure: Desmos.Calculator,
        Calculator: function Calculator() {
            var elt = arguments[0];
            var calc = Desmos.Calculator.apply(this, arguments);
            if (elt) {
                DesmosAugmented._calcElementPairs.push({
                    calc: calc,
                    elt: elt
                })
            }
            return calc
        },
        getCalcByElement: function(elt) {
            if (!elt) {
                throw new Error("No element provided to getCalcByElement.")
            }
            var pairs = DesmosAugmented._calcElementPairs;
            for (var i = 0; i < pairs.length; i++) {
                if (pairs[i].elt === elt)
                    return pairs[i].calc
            }
            throw new Error("Cannot find a calculator that was attached to this element: " + elt)
        },
        destroyCalc: function(calc) {
            DesmosAugmented._calcElementPairs = DesmosAugmented._calcElementPairs.filter(function(pair) {
                return pair.calc !== calc
            });
            calc.destroy()
        },
        _calcElementPairs: []
    });
    var global = typeof window !== "undefined" ? window : {};
    if (global.Desmos === Desmos) {
        global.Desmos = DesmosAugmented
    }
    return DesmosAugmented
});
define("mathquill-api", ["require", "exports", "desmos"], function(require, exports, Desmos) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var MathQuill = Desmos.MathQuill;
    exports.MathQuill = MathQuill;
    if (MathQuill == undefined) {
        throw new Error("Unable to init MathQuill - Desmos was " + JSON.stringify(Desmos))
    }
});
define("mathquill", ["require", "exports", "underscore", "mathquill-api"], function(require, exports, _, mathquill_api_1) {
    "use strict";
    mathquill_api_1.MathQuill.DO_NOT_WRAP_API_CONTAINER = false;
    function wrapInCalculatorAPI(el) {
        if (mathquill_api_1.MathQuill.DO_NOT_WRAP_API_CONTAINER) {
            return el
        }
        var apiContainer = document.createElement("span");
        apiContainer.className = "dcg-calculator-api-container";
        el.appendChild(apiContainer);
        var childContainer = document.createElement("span");
        apiContainer.appendChild(childContainer);
        return childContainer
    }
    mathquill_api_1.MathQuill.SystemKeyboardMathField = function(element, config) {
        if (config === void 0) {
            config = {}
        }
        config = _.extend(config, {
            substituteTextarea: function() {
                var textarea = document.createElement("textarea");
                textarea.className = "system-keyboard-math-field";
                return textarea
            }
        });
        return mathquill_api_1.MathQuill.MathField(wrapInCalculatorAPI(element), config)
    }
    ;
    var _StaticMath = mathquill_api_1.MathQuill.StaticMath;
    mathquill_api_1.MathQuill.StaticMath = function(el) {
        return _StaticMath(wrapInCalculatorAPI(el))
    }
    ;
    var _MathField = mathquill_api_1.MathQuill.MathField;
    mathquill_api_1.MathQuill.MathField = function(el, config) {
        return _MathField(wrapInCalculatorAPI(el), config)
    }
    ;
    return mathquill_api_1.MathQuill
});
define("rope-sequence", ["require", "exports", "module"], function(require, exports, module) {
    "use strict";
    var GOOD_LEAF_SIZE = 200;
    var RopeSequence = function RopeSequence() {};
    RopeSequence.prototype.append = function append(other) {
        if (!other.length) {
            return this
        }
        other = RopeSequence.from(other);
        return !this.length && other || other.length < GOOD_LEAF_SIZE && this.leafAppend(other) || this.length < GOOD_LEAF_SIZE && other.leafPrepend(this) || this.appendInner(other)
    }
    ;
    RopeSequence.prototype.prepend = function prepend(other) {
        if (!other.length) {
            return this
        }
        return RopeSequence.from(other).append(this)
    }
    ;
    RopeSequence.prototype.appendInner = function appendInner(other) {
        return new Append(this,other)
    }
    ;
    RopeSequence.prototype.slice = function slice(from, to) {
        if (from === void 0)
            from = 0;
        if (to === void 0)
            to = this.length;
        if (from >= to) {
            return RopeSequence.empty
        }
        return this.sliceInner(Math.max(0, from), Math.min(this.length, to))
    }
    ;
    RopeSequence.prototype.get = function get(i) {
        if (i < 0 || i >= this.length) {
            return undefined
        }
        return this.getInner(i)
    }
    ;
    RopeSequence.prototype.forEach = function forEach(f, from, to) {
        if (from === void 0)
            from = 0;
        if (to === void 0)
            to = this.length;
        if (from <= to) {
            this.forEachInner(f, from, to, 0)
        } else {
            this.forEachInvertedInner(f, from, to, 0)
        }
    }
    ;
    RopeSequence.prototype.map = function map(f, from, to) {
        if (from === void 0)
            from = 0;
        if (to === void 0)
            to = this.length;
        var result = [];
        this.forEach(function(elt, i) {
            return result.push(f(elt, i))
        }, from, to);
        return result
    }
    ;
    RopeSequence.from = function from(values) {
        if (values instanceof RopeSequence) {
            return values
        }
        return values && values.length ? new Leaf(values) : RopeSequence.empty
    }
    ;
    var Leaf = function(RopeSequence) {
        function Leaf(values) {
            RopeSequence.call(this);
            this.values = values
        }
        if (RopeSequence)
            Leaf.__proto__ = RopeSequence;
        Leaf.prototype = Object.create(RopeSequence && RopeSequence.prototype);
        Leaf.prototype.constructor = Leaf;
        var prototypeAccessors = {
            length: {
                configurable: true
            },
            depth: {
                configurable: true
            }
        };
        Leaf.prototype.flatten = function flatten() {
            return this.values
        }
        ;
        Leaf.prototype.sliceInner = function sliceInner(from, to) {
            if (from == 0 && to == this.length) {
                return this
            }
            return new Leaf(this.values.slice(from, to))
        }
        ;
        Leaf.prototype.getInner = function getInner(i) {
            return this.values[i]
        }
        ;
        Leaf.prototype.forEachInner = function forEachInner(f, from, to, start) {
            for (var i = from; i < to; i++) {
                if (f(this.values[i], start + i) === false) {
                    return false
                }
            }
        }
        ;
        Leaf.prototype.forEachInvertedInner = function forEachInvertedInner(f, from, to, start) {
            for (var i = from - 1; i >= to; i--) {
                if (f(this.values[i], start + i) === false) {
                    return false
                }
            }
        }
        ;
        Leaf.prototype.leafAppend = function leafAppend(other) {
            if (this.length + other.length <= GOOD_LEAF_SIZE) {
                return new Leaf(this.values.concat(other.flatten()))
            }
        }
        ;
        Leaf.prototype.leafPrepend = function leafPrepend(other) {
            if (this.length + other.length <= GOOD_LEAF_SIZE) {
                return new Leaf(other.flatten().concat(this.values))
            }
        }
        ;
        prototypeAccessors.length.get = function() {
            return this.values.length
        }
        ;
        prototypeAccessors.depth.get = function() {
            return 0
        }
        ;
        Object.defineProperties(Leaf.prototype, prototypeAccessors);
        return Leaf
    }(RopeSequence);
    RopeSequence.empty = new Leaf([]);
    var Append = function(RopeSequence) {
        function Append(left, right) {
            RopeSequence.call(this);
            this.left = left;
            this.right = right;
            this.length = left.length + right.length;
            this.depth = Math.max(left.depth, right.depth) + 1
        }
        if (RopeSequence)
            Append.__proto__ = RopeSequence;
        Append.prototype = Object.create(RopeSequence && RopeSequence.prototype);
        Append.prototype.constructor = Append;
        Append.prototype.flatten = function flatten() {
            return this.left.flatten().concat(this.right.flatten())
        }
        ;
        Append.prototype.getInner = function getInner(i) {
            return i < this.left.length ? this.left.get(i) : this.right.get(i - this.left.length)
        }
        ;
        Append.prototype.forEachInner = function forEachInner(f, from, to, start) {
            var leftLen = this.left.length;
            if (from < leftLen && this.left.forEachInner(f, from, Math.min(to, leftLen), start) === false) {
                return false
            }
            if (to > leftLen && this.right.forEachInner(f, Math.max(from - leftLen, 0), Math.min(this.length, to) - leftLen, start + leftLen) === false) {
                return false
            }
        }
        ;
        Append.prototype.forEachInvertedInner = function forEachInvertedInner(f, from, to, start) {
            var leftLen = this.left.length;
            if (from > leftLen && this.right.forEachInvertedInner(f, from - leftLen, Math.max(to, leftLen) - leftLen, start + leftLen) === false) {
                return false
            }
            if (to < leftLen && this.left.forEachInvertedInner(f, Math.min(from, leftLen), to, start) === false) {
                return false
            }
        }
        ;
        Append.prototype.sliceInner = function sliceInner(from, to) {
            if (from == 0 && to == this.length) {
                return this
            }
            var leftLen = this.left.length;
            if (to <= leftLen) {
                return this.left.slice(from, to)
            }
            if (from >= leftLen) {
                return this.right.slice(from - leftLen, to - leftLen)
            }
            return this.left.slice(from, leftLen).append(this.right.slice(0, to - leftLen))
        }
        ;
        Append.prototype.leafAppend = function leafAppend(other) {
            var inner = this.right.leafAppend(other);
            if (inner) {
                return new Append(this.left,inner)
            }
        }
        ;
        Append.prototype.leafPrepend = function leafPrepend(other) {
            var inner = this.left.leafPrepend(other);
            if (inner) {
                return new Append(inner,this.right)
            }
        }
        ;
        Append.prototype.appendInner = function appendInner(other) {
            if (this.left.depth >= Math.max(this.right.depth, other.depth) + 1) {
                return new Append(this.left,new Append(this.right,other))
            }
            return new Append(this,other)
        }
        ;
        return Append
    }(RopeSequence);
    var ropeSequence = RopeSequence;
    module.exports = ropeSequence
});
define("prosemirror-history/index", ["require", "exports", "module", "rope-sequence", "prosemirror-transform", "prosemirror-state"], function(require, exports, module) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function _interopDefault(ex) {
        return ex && typeof ex === "object" && "default"in ex ? ex["default"] : ex
    }
    var RopeSequence = _interopDefault(require("rope-sequence"));
    var prosemirrorTransform = require("prosemirror-transform");
    var prosemirrorState = require("prosemirror-state");
    var max_empty_items = 500;
    var Branch = function Branch(items, eventCount) {
        this.items = items;
        this.eventCount = eventCount
    };
    Branch.prototype.popEvent = function popEvent(state, preserveItems) {
        var this$1 = this;
        if (this.eventCount == 0) {
            return null
        }
        var end = this.items.length;
        for (; ; end--) {
            var next = this.items.get(end - 1);
            if (next.selection) {
                --end;
                break
            }
        }
        var remap, mapFrom;
        if (preserveItems) {
            remap = this.remapping(end, this.items.length);
            mapFrom = remap.maps.length
        }
        var transform = state.tr;
        var selection, remaining;
        var addAfter = []
            , addBefore = [];
        this.items.forEach(function(item, i) {
            if (!item.step) {
                if (!remap) {
                    remap = this$1.remapping(end, i + 1);
                    mapFrom = remap.maps.length
                }
                mapFrom--;
                addBefore.push(item);
                return
            }
            if (remap) {
                addBefore.push(new Item(item.map));
                var step = item.step.map(remap.slice(mapFrom)), map;
                if (step && transform.maybeStep(step).doc) {
                    map = transform.mapping.maps[transform.mapping.maps.length - 1];
                    addAfter.push(new Item(map,null,null,addAfter.length + addBefore.length))
                }
                mapFrom--;
                if (map) {
                    remap.appendMap(map, mapFrom)
                }
            } else {
                transform.maybeStep(item.step)
            }
            if (item.selection) {
                selection = remap ? item.selection.map(remap.slice(mapFrom)) : item.selection;
                remaining = new Branch(this$1.items.slice(0, end).append(addBefore.reverse().concat(addAfter)),this$1.eventCount - 1);
                return false
            }
        }, this.items.length, 0);
        return {
            remaining: remaining,
            transform: transform,
            selection: selection
        }
    }
    ;
    Branch.prototype.addTransform = function addTransform(transform, selection, histOptions, preserveItems) {
        var newItems = []
            , eventCount = this.eventCount;
        var oldItems = this.items
            , lastItem = !preserveItems && oldItems.length ? oldItems.get(oldItems.length - 1) : null;
        for (var i = 0; i < transform.steps.length; i++) {
            var step = transform.steps[i].invert(transform.docs[i]);
            var item = new Item(transform.mapping.maps[i],step,selection)
                , merged = void 0;
            if (merged = lastItem && lastItem.merge(item)) {
                item = merged;
                if (i) {
                    newItems.pop()
                } else {
                    oldItems = oldItems.slice(0, oldItems.length - 1)
                }
            }
            newItems.push(item);
            if (selection) {
                eventCount++;
                selection = null
            }
            if (!preserveItems) {
                lastItem = item
            }
        }
        var overflow = eventCount - histOptions.depth;
        if (overflow > DEPTH_OVERFLOW) {
            oldItems = cutOffEvents(oldItems, overflow);
            eventCount -= overflow
        }
        return new Branch(oldItems.append(newItems),eventCount)
    }
    ;
    Branch.prototype.remapping = function remapping(from, to) {
        var maps = new prosemirrorTransform.Mapping;
        this.items.forEach(function(item, i) {
            var mirrorPos = item.mirrorOffset != null && i - item.mirrorOffset >= from ? maps.maps.length - item.mirrorOffset : null;
            maps.appendMap(item.map, mirrorPos)
        }, from, to);
        return maps
    }
    ;
    Branch.prototype.addMaps = function addMaps(array) {
        if (this.eventCount == 0) {
            return this
        }
        return new Branch(this.items.append(array.map(function(map) {
            return new Item(map)
        })),this.eventCount)
    }
    ;
    Branch.prototype.rebased = function rebased(rebasedTransform, rebasedCount) {
        if (!this.eventCount) {
            return this
        }
        var rebasedItems = []
            , start = Math.max(0, this.items.length - rebasedCount);
        var mapping = rebasedTransform.mapping;
        var newUntil = rebasedTransform.steps.length;
        var eventCount = this.eventCount;
        this.items.forEach(function(item) {
            if (item.selection) {
                eventCount--
            }
        }, start);
        var iRebased = rebasedCount;
        this.items.forEach(function(item) {
            var pos = mapping.getMirror(--iRebased);
            if (pos == null) {
                return
            }
            newUntil = Math.min(newUntil, pos);
            var map = mapping.maps[pos];
            if (item.step) {
                var step = rebasedTransform.steps[pos].invert(rebasedTransform.docs[pos]);
                var selection = item.selection && item.selection.map(mapping.slice(iRebased + 1, pos));
                if (selection) {
                    eventCount++
                }
                rebasedItems.push(new Item(map,step,selection))
            } else {
                rebasedItems.push(new Item(map))
            }
        }, start);
        var newMaps = [];
        for (var i = rebasedCount; i < newUntil; i++) {
            newMaps.push(new Item(mapping.maps[i]))
        }
        var items = this.items.slice(0, start).append(newMaps).append(rebasedItems);
        var branch = new Branch(items,eventCount);
        if (branch.emptyItemCount() > max_empty_items) {
            branch = branch.compress(this.items.length - rebasedItems.length)
        }
        return branch
    }
    ;
    Branch.prototype.emptyItemCount = function emptyItemCount() {
        var count = 0;
        this.items.forEach(function(item) {
            if (!item.step) {
                count++
            }
        });
        return count
    }
    ;
    Branch.prototype.compress = function compress(upto) {
        if (upto === void 0)
            upto = this.items.length;
        var remap = this.remapping(0, upto)
            , mapFrom = remap.maps.length;
        var items = []
            , events = 0;
        this.items.forEach(function(item, i) {
            if (i >= upto) {
                items.push(item);
                if (item.selection) {
                    events++
                }
            } else if (item.step) {
                var step = item.step.map(remap.slice(mapFrom))
                    , map = step && step.getMap();
                mapFrom--;
                if (map) {
                    remap.appendMap(map, mapFrom)
                }
                if (step) {
                    var selection = item.selection && item.selection.map(remap.slice(mapFrom));
                    if (selection) {
                        events++
                    }
                    var newItem = new Item(map.invert(),step,selection), merged, last = items.length - 1;
                    if (merged = items.length && items[last].merge(newItem)) {
                        items[last] = merged
                    } else {
                        items.push(newItem)
                    }
                }
            } else if (item.map) {
                mapFrom--
            }
        }, this.items.length, 0);
        return new Branch(RopeSequence.from(items.reverse()),events)
    }
    ;
    Branch.empty = new Branch(RopeSequence.empty,0);
    function cutOffEvents(items, n) {
        var cutPoint;
        items.forEach(function(item, i) {
            if (item.selection && n-- == 0) {
                cutPoint = i;
                return false
            }
        });
        return items.slice(cutPoint)
    }
    var Item = function Item(map, step, selection, mirrorOffset) {
        this.map = map;
        this.step = step;
        this.selection = selection;
        this.mirrorOffset = mirrorOffset
    };
    Item.prototype.merge = function merge(other) {
        if (this.step && other.step && !other.selection) {
            var step = other.step.merge(this.step);
            if (step) {
                return new Item(step.getMap().invert(),step,this.selection)
            }
        }
    }
    ;
    var HistoryState = function HistoryState(done, undone, prevRanges, prevTime) {
        this.done = done;
        this.undone = undone;
        this.prevRanges = prevRanges;
        this.prevTime = prevTime
    };
    var DEPTH_OVERFLOW = 20;
    function applyTransaction(history, state, tr, options) {
        var historyTr = tr.getMeta(historyKey), rebased;
        if (historyTr) {
            return historyTr.historyState
        }
        if (tr.getMeta(closeHistoryKey)) {
            history = new HistoryState(history.done,history.undone,null,0)
        }
        var appended = tr.getMeta("appendedTransaction");
        if (tr.steps.length == 0) {
            return history
        } else if (appended && appended.getMeta(historyKey)) {
            if (appended.getMeta(historyKey).redo) {
                return new HistoryState(history.done.addTransform(tr, null, options, mustPreserveItems(state)),history.undone,rangesFor(tr.mapping.maps[tr.steps.length - 1]),history.prevTime)
            } else {
                return new HistoryState(history.done,history.undone.addTransform(tr, null, options, mustPreserveItems(state)),null,history.prevTime)
            }
        } else if (tr.getMeta("addToHistory") !== false && !(appended && appended.getMeta("addToHistory") === false)) {
            var newGroup = history.prevTime == 0 || !appended && (history.prevTime < (tr.time || 0) - options.newGroupDelay || !isAdjacentTo(tr, history.prevRanges));
            var prevRanges = appended ? mapRanges(history.prevRanges, tr.mapping) : rangesFor(tr.mapping.maps[tr.steps.length - 1]);
            return new HistoryState(history.done.addTransform(tr, newGroup ? state.selection.getBookmark() : null, options, mustPreserveItems(state)),Branch.empty,prevRanges,tr.time)
        } else if (rebased = tr.getMeta("rebased")) {
            return new HistoryState(history.done.rebased(tr, rebased),history.undone.rebased(tr, rebased),mapRanges(history.prevRanges, tr.mapping),history.prevTime)
        } else {
            return new HistoryState(history.done.addMaps(tr.mapping.maps),history.undone.addMaps(tr.mapping.maps),mapRanges(history.prevRanges, tr.mapping),history.prevTime)
        }
    }
    function isAdjacentTo(transform, prevRanges) {
        if (!prevRanges) {
            return false
        }
        if (!transform.docChanged) {
            return true
        }
        var adjacent = false;
        transform.mapping.maps[0].forEach(function(start, end) {
            for (var i = 0; i < prevRanges.length; i += 2) {
                if (start <= prevRanges[i + 1] && end >= prevRanges[i]) {
                    adjacent = true
                }
            }
        });
        return adjacent
    }
    function rangesFor(map) {
        var result = [];
        map.forEach(function(_from, _to, from, to) {
            return result.push(from, to)
        });
        return result
    }
    function mapRanges(ranges, mapping) {
        if (!ranges) {
            return null
        }
        var result = [];
        for (var i = 0; i < ranges.length; i += 2) {
            var from = mapping.map(ranges[i], 1)
                , to = mapping.map(ranges[i + 1], -1);
            if (from <= to) {
                result.push(from, to)
            }
        }
        return result
    }
    function histTransaction(history, state, dispatch, redo) {
        var preserveItems = mustPreserveItems(state)
            , histOptions = historyKey.get(state).spec.config;
        var pop = (redo ? history.undone : history.done).popEvent(state, preserveItems);
        if (!pop) {
            return
        }
        var selection = pop.selection.resolve(pop.transform.doc);
        var added = (redo ? history.done : history.undone).addTransform(pop.transform, state.selection.getBookmark(), histOptions, preserveItems);
        var newHist = new HistoryState(redo ? added : pop.remaining,redo ? pop.remaining : added,null,0);
        dispatch(pop.transform.setSelection(selection).setMeta(historyKey, {
            redo: redo,
            historyState: newHist
        }).scrollIntoView())
    }
    var cachedPreserveItems = false
        , cachedPreserveItemsPlugins = null;
    function mustPreserveItems(state) {
        var plugins = state.plugins;
        if (cachedPreserveItemsPlugins != plugins) {
            cachedPreserveItems = false;
            cachedPreserveItemsPlugins = plugins;
            for (var i = 0; i < plugins.length; i++) {
                if (plugins[i].spec.historyPreserveItems) {
                    cachedPreserveItems = true;
                    break
                }
            }
        }
        return cachedPreserveItems
    }
    function closeHistory(tr) {
        return tr.setMeta(closeHistoryKey, true)
    }
    var historyKey = new prosemirrorState.PluginKey("history");
    var closeHistoryKey = new prosemirrorState.PluginKey("closeHistory");
    function history(config) {
        config = {
            depth: config && config.depth || 100,
            newGroupDelay: config && config.newGroupDelay || 500
        };
        return new prosemirrorState.Plugin({
            key: historyKey,
            state: {
                init: function init() {
                    return new HistoryState(Branch.empty,Branch.empty,null,0)
                },
                apply: function apply(tr, hist, state) {
                    return applyTransaction(hist, state, tr, config)
                }
            },
            config: config
        })
    }
    function undo(state, dispatch) {
        var hist = historyKey.getState(state);
        if (!hist || hist.done.eventCount == 0) {
            return false
        }
        if (dispatch) {
            histTransaction(hist, state, dispatch, false)
        }
        return true
    }
    function redo(state, dispatch) {
        var hist = historyKey.getState(state);
        if (!hist || hist.undone.eventCount == 0) {
            return false
        }
        if (dispatch) {
            histTransaction(hist, state, dispatch, true)
        }
        return true
    }
    function undoDepth(state) {
        var hist = historyKey.getState(state);
        return hist ? hist.done.eventCount : 0
    }
    function redoDepth(state) {
        var hist = historyKey.getState(state);
        return hist ? hist.undone.eventCount : 0
    }
    exports.HistoryState = HistoryState;
    exports.closeHistory = closeHistory;
    exports.history = history;
    exports.redo = redo;
    exports.redoDepth = redoDepth;
    exports.undo = undo;
    exports.undoDepth = undoDepth
});
define("prosemirror-history", ["prosemirror-history/index"], function(main) {
    return main
});
define("loadcss!activitybuilder/components/shared/prosemirror/mq-node", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/activitybuilder/components/shared/prosemirror/mq-node.css", decodeURIComponent(".dcg-mq-node%20%7B%0A%20%20position%3A%20relative%3B%0A%20%20-webkit-user-select%3A%20all%3B%0A%20%20-moz-user-select%3A%20all%3B%0A%20%20-ms-user-select%3A%20all%3B%0A%20%20user-select%3A%20all%3B%0A%20%20display%3A%20inline-block%3B%0A%7D%0A.dcg-mq-node%20.dcg-calculator-api-container%20.dcg-mq-math-mode%20%7B%0A%20%20border%3A%201px%20solid%20transparent%3B%0A%7D%0A.dcg-mq-node%20.dcg-calculator-api-container%20.dcg-mq-math-mode%20.dcg-mq-root-block%20%7B%0A%20%20overflow%3A%20visible%3B%0A%20%20vertical-align%3A%20baseline%3B%0A%7D%0A.dcg-mq-node%20.dcg-calculator-api-container%20.dcg-mq-math-mode.dcg-mq-focused%20%7B%0A%20%20-webkit-box-shadow%3A%20none%3B%0A%20%20box-shadow%3A%20none%3B%0A%20%20border%3A%201px%20dotted%20%23999%3B%0A%7D%0A.dcg-mq-node%20.dcg-calculator-api-container%20.dcg-mq-math-mode%20*%20%7B%0A%20%20-webkit-user-select%3A%20all%3B%0A%20%20-moz-user-select%3A%20all%3B%0A%20%20-ms-user-select%3A%20all%3B%0A%20%20user-select%3A%20all%3B%0A%7D%0A.dcg-mq-node%20.dcg-calculator-api-container%20.dcg-mq-math-mode%20*%20%3A%3Aselection%20%7B%0A%20%20background%3A%20rgba(0%2C0%2C0%2C0)%3B%0A%7D%0A.dcg-mq-node%20.dcg-calculator-api-container%20.dcg-mq-math-mode%20*%20%3A%3A-moz-selection%20%7B%0A%20%20background%3A%20rgba(0%2C0%2C0%2C0)%3B%0A%7D%0A.dcg-mq-node%20.dcg-mq-bg%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%200%3B%0A%20%20left%3A%200%3B%0A%20%20width%3A%20100%25%3B%0A%20%20height%3A%20100%25%3B%0A%20%20z-index%3A%20-1%3B%0A%20%20border%3A%200%3B%0A%20%20-webkit-user-select%3A%20all%3B%0A%20%20-moz-user-select%3A%20all%3B%0A%20%20-ms-user-select%3A%20all%3B%0A%20%20user-select%3A%20all%3B%0A%7D%0A"))
});
define("activitybuilder/components/shared/prosemirror/mq-node", ["require", "exports", "touchtracking", "jquery", "keys", "mathquill", "prosemirror-state", "prosemirror-history", "loadcss!./mq-node"], function(require, exports, touchtracking, $, Keys, MathQuill, prosemirror_state_1, prosemirror_history_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var computeChange = function(oldVal, newVal) {
        var start = 0
            , oldEnd = oldVal.length
            , newEnd = newVal.length;
        while (start < oldEnd && oldVal.charCodeAt(start) == newVal.charCodeAt(start))
            ++start;
        while (oldEnd > start && newEnd > start && oldVal.charCodeAt(oldEnd - 1) == newVal.charCodeAt(newEnd - 1)) {
            oldEnd--;
            newEnd--
        }
        return {
            from: start,
            to: oldEnd,
            text: newVal.slice(start, newEnd)
        }
    };
    var MqEditableNodeView = function() {
        function MqEditableNodeView(node, view, getPos, subManager, scientificKeypadController) {
            var _this = this;
            this.node = node;
            this.view = view;
            this.getPos = getPos;
            this.dom = $('<span class="dcg-mq-node">').get(0);
            this.value = node.textContent;
            touchtracking.monitor(this.dom);
            $(this.dom).on("focusin.mq-node", function() {
                _this.view.dispatch(_this.view.state.tr.setSelection(prosemirror_state_1.NodeSelection.create(_this.view.state.doc, _this.getPos())))
            });
            $(this.dom).on("focusout.mq-node", function() {
                if (!(document.activeElement && $(document.activeElement).closest(_this.dom).length)) {
                    if (_this.mathquill.latex().length == 0) {
                        _this.view.dispatch(_this.view.state.tr.deleteSelection())
                    }
                    scientificKeypadController.dispatch({
                        type: "render"
                    })
                }
            });
            this.updating = true;
            var MathFieldConstructor = scientificKeypadController.isEnabled() ? MathQuill.MathField : MathQuill.SystemKeyboardMathField;
            this.mathquill = MathFieldConstructor(this.dom, {
                typingPercentWritesPercentOf: false,
                handlers: {
                    deleteOutOf: function(d, m) {
                        _this.exitHandler(d, m)
                    },
                    moveOutOf: function(d, m) {
                        _this.exitHandler(d, m)
                    },
                    reflow: function() {
                        _this.onChange()
                    },
                    enter: function(m) {
                        _this.exitHandler(1, m)
                    }
                },
                overrideKeystroke: function(key, e) {
                    if (Keys.isUndo(e)) {
                        if (prosemirror_history_1.undo(_this.view.state, _this.view.dispatch)) {
                            e.preventDefault()
                        }
                    } else if (Keys.isRedo(e)) {
                        if (prosemirror_history_1.redo(_this.view.state, _this.view.dispatch)) {
                            e.preventDefault()
                        }
                    } else if (Keys.isBacktick(e)) {
                        e.preventDefault();
                        _this.exitHandler(1, _this.mathquill)
                    } else {
                        var k = Keys.lookup(e);
                        if (k == Keys.BACKSPACE || k == Keys.DELETE || k == Keys.LEFT || k == Keys.RIGHT) {
                            e.preventDefault()
                        }
                        _this.mathquill.keystroke(key)
                    }
                }
            });
            this.rafToken = requestAnimationFrame(function() {
                return _this.mathquill.reflow()
            });
            this.mathquill.latex(node.textContent);
            this.updating = false;
            this.removeToken = subManager.add(function(_tr) {
                _this.setCursorPos(_this.view.state)
            });
            var img = $('<img class="dcg-mq-bg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAAAtJREFUCB1jYAACAAAFAAGNu5vzAAAAAElFTkSuQmCC">').get(0);
            $(img).appendTo(this.dom)
        }
        MqEditableNodeView.prototype.setCursorPos = function(state) {
            var pos = this.getPos();
            var size = this.node.nodeSize;
            var inPmSelection = state.selection.from < pos + size && pos < state.selection.to;
            if (!inPmSelection) {
                if (pos < state.selection.from) {
                    this.cursorPos = "end"
                } else {
                    this.cursorPos = "start"
                }
            }
        }
        ;
        MqEditableNodeView.prototype.exitHandler = function(dir, mathField) {
            if (mathField.latex().length == 0) {
                this.view.dispatch(this.view.state.tr.deleteSelection());
                this.view.focus()
            } else {
                if (dir == -1) {
                    this.selectBefore()
                } else if (dir == 1) {
                    this.selectAfter()
                }
            }
        }
        ;
        MqEditableNodeView.prototype.selectAfter = function() {
            this.view.focus();
            this.view.dispatch(this.view.state.tr.setSelection(new prosemirror_state_1.TextSelection(this.view.state.doc.resolve(this.getPos() + this.node.nodeSize))))
        }
        ;
        MqEditableNodeView.prototype.selectBefore = function() {
            this.view.focus();
            this.view.dispatch(this.view.state.tr.setSelection(new prosemirror_state_1.TextSelection(this.view.state.doc.resolve(this.getPos()))))
        }
        ;
        MqEditableNodeView.prototype.onChange = function() {
            if (this.updating) {
                return
            }
            var newLatex = this.mathquill.latex();
            if (newLatex != this.value) {
                var change = computeChange(this.value, newLatex);
                var start = this.getPos() + 1;
                this.value = newLatex;
                var tr = this.view.state.tr.replaceWith(start + change.from, start + change.to, change.text ? this.view.state.schema.text(change.text) : null);
                this.view.dispatch(tr)
            }
        }
        ;
        MqEditableNodeView.prototype.update = function(node) {
            if (node.type != this.node.type) {
                return false
            }
            this.node = node;
            var value = node.textContent;
            if (value != this.value) {
                this.value = value;
                this.updating = true;
                this.mathquill.latex(value);
                this.updating = false
            }
            return true
        }
        ;
        MqEditableNodeView.prototype.selectNode = function() {
            if (this.cursorPos == "start") {
                this.mathquill.moveToLeftEnd()
            } else {
                this.mathquill.moveToRightEnd()
            }
            this.mathquill.focus()
        }
        ;
        MqEditableNodeView.prototype.stopEvent = function() {
            return true
        }
        ;
        MqEditableNodeView.prototype.ignoreMutation = function() {
            return true
        }
        ;
        MqEditableNodeView.prototype.destroy = function() {
            $(this.dom).off(".mq-node");
            this.mathquill.blur();
            this.removeToken();
            cancelAnimationFrame(this.rafToken)
        }
        ;
        return MqEditableNodeView
    }();
    exports.MqEditableNodeView = MqEditableNodeView;
    var MqStaticNodeView = function() {
        function MqStaticNodeView(node, view, getPos) {
            var _this = this;
            this.node = node;
            this.view = view;
            this.getPos = getPos;
            this.dom = $('<span class="dcg-mq-node">').get(0);
            this.value = node.textContent;
            this.mathquill = MathQuill.StaticMath(this.dom);
            this.mathquill.latex(node.textContent);
            this.rafToken = requestAnimationFrame(function() {
                _this.mathquill.reflow()
            });
            var img = $('<img class="dcg-mq-bg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAAAtJREFUCB1jYAACAAAFAAGNu5vzAAAAAElFTkSuQmCC">').get(0);
            $(img).appendTo(this.dom)
        }
        MqStaticNodeView.prototype.destory = function() {
            cancelAnimationFrame(this.rafToken)
        }
        ;
        return MqStaticNodeView
    }();
    exports.MqStaticNodeView = MqStaticNodeView
});
define("core/l10n/localization", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var Localization = function() {
        function Localization(context) {
            if (context) {
                this.initialize(context)
            }
        }
        Localization.prototype.assertContext = function() {
            if (!this.context) {
                throw new Error("Expected i18n module to be initialized before being used.")
            }
            return this.context
        }
        ;
        Localization.prototype.ftl = function() {
            return this.assertContext().getFluentBundleSequence()
        }
        ;
        Localization.prototype.locale = function() {
            return this.assertContext().getLocale()
        }
        ;
        Localization.prototype.initialize = function(context) {
            this.context = context
        }
        ;
        Localization.prototype.isRTL = function() {
            return ["ar", "he"].indexOf(this.locale()) >= 0
        }
        ;
        Localization.prototype.s = function(key, variables) {
            if (variables === void 0) {
                variables = {}
            }
            return this.ftl().format(key, variables) || this.fallback(key)
        }
        ;
        Localization.prototype.unpack = function(_a) {
            var key = _a.key
                , variables = _a.variables;
            return this.ftl().format(key, variables) || this.fallback(key)
        }
        ;
        Localization.prototype.raw = function(s) {
            return s
        }
        ;
        Localization.prototype.num = function(n) {
            return "" + n
        }
        ;
        Localization.prototype.date = function(d, options) {
            return this.ftl().formatDate(d, options)
        }
        ;
        Localization.prototype.time = function(d) {
            return this.ftl().formatTime(d)
        }
        ;
        Localization.prototype.fallback = function(key) {
            var _a;
            if (((_a = this.context) === null || _a === void 0 ? void 0 : _a.getEnvironment()) === "development") {
                return key
            }
            return exports.EMPTY
        }
        ;
        return Localization
    }();
    exports.Localization = Localization;
    exports.EMPTY = ""
});
define("core/lib/i18n", ["require", "exports", "../l10n/localization"], function(require, exports, localization_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.EMPTY = localization_1.EMPTY;
    exports.i18n = new localization_1.Localization;
    function initialize(context) {
        exports.i18n.initialize(context)
    }
    exports.initialize = initialize
});
define("core/l10n/types", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    })
});
define("lib/i18n", ["require", "exports", "core/l10n/localization", "core/lib/i18n", "core/l10n/types"], function(require, exports, localization_1, i18n_1, types_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.EMPTY = localization_1.EMPTY;
    exports.TranslatedString = types_1.TranslatedString;
    exports.InterpolationVariables = types_1.InterpolationVariables;
    function initialize(context) {
        i18n_1.i18n.initialize(context)
    }
    exports.initialize = initialize;
    function isRTL() {
        return i18n_1.i18n.isRTL()
    }
    exports.isRTL = isRTL;
    function t() {
        throw new Error("i18n.t is unimplemented. Use i18n.s instead.")
    }
    exports.t = t;
    exports.s = function s() {
        return i18n_1.i18n.s.apply(i18n_1.i18n, arguments)
    }
    ;
    exports.unpack = function unpack() {
        return i18n_1.i18n.unpack.apply(i18n_1.i18n, arguments)
    }
    ;
    exports.raw = function raw() {
        return i18n_1.i18n.raw.apply(i18n_1.i18n, arguments)
    }
    ;
    exports.num = function num() {
        return i18n_1.i18n.num.apply(i18n_1.i18n, arguments)
    }
    ;
    exports.locale = function() {
        return i18n_1.i18n.locale()
    }
});
define("lib/evt-delegator", ["require", "exports", "jquery", "underscore"], function(require, exports, $, _) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var DelegatorCls = function() {
        function DelegatorCls() {
            var _this = this;
            this.handlers = [];
            $(document).on("keydown.delegator", function(evt) {
                return _this.handleEvent(evt)
            })
        }
        DelegatorCls.prototype.push = function(handler) {
            var _this = this;
            var token = _.uniqueId("delegator_");
            this.handlers.push({
                token: token,
                handler: handler
            });
            return function() {
                return _this.handlers = _.filter(_this.handlers, function(h) {
                    return h.token != token
                })
            }
        }
        ;
        DelegatorCls.prototype.handleEvent = function(evt) {
            if (evt.isDefaultPrevented()) {
                return
            }
            if (this.handlers.length) {
                var stopHandling_1 = false;
                var stopHandlingFn = function() {
                    return stopHandling_1 = true
                };
                for (var _i = 0, _a = this.handlers.slice().reverse(); _i < _a.length; _i++) {
                    var handler = _a[_i].handler;
                    handler(evt, stopHandlingFn);
                    if (stopHandling_1) {
                        return
                    }
                }
            }
        }
        ;
        return DelegatorCls
    }();
    exports.Delegator = new DelegatorCls
});
define("shared/dcgviews/portal-view", ["require", "exports", "tslib", "dcgview"], function(require, exports, tslib_1, DCGView) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var PortalView = function(_super) {
        tslib_1.__extends(PortalView, _super);
        function PortalView() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        PortalView.prototype.template = function() {
            return DCGView.createElement("div", {
                class: DCGView.const("placeholder"),
                style: DCGView.const("display: none")
            })
        }
        ;
        PortalView.prototype.willMount = function() {
            if (this.children.length !== 1 || typeof this.children[0] !== "function") {
                throw new Error("<PortalView> expects a single child that is a function")
            }
            this.node = document.createElement("div");
            this.node.className = "portal-container";
            this.props.mountPt().appendChild(this.node);
            var viewFn = this.children[0];
            var Wrapper = function(_super) {
                tslib_1.__extends(Wrapper, _super);
                function Wrapper() {
                    return _super !== null && _super.apply(this, arguments) || this
                }
                Wrapper.prototype.template = function() {
                    return viewFn()
                }
                ;
                return Wrapper
            }(DCGView.Class);
            this.remoteView = DCGView.mountToNode(Wrapper, this.node, {})
        }
        ;
        PortalView.prototype.didUpdate = function() {
            this.remoteView.update()
        }
        ;
        PortalView.prototype.willUnmount = function() {
            if (!this.node)
                return;
            DCGView.unmountFromNode(this.node);
            if (this.node.parentNode)
                this.node.parentNode.removeChild(this.node);
            this.node = undefined
        }
        ;
        return PortalView
    }(DCGView.Class);
    exports.PortalView = PortalView
});
define("browser", ["require", "jquery"], function(require) {
    var $ = require("jquery");
    var Browser = {
        IS_IE8: navigator.userAgent.match(/MSIE 8.0/i) !== null,
        IS_IE9: navigator.userAgent.match(/MSIE 9.0/i) !== null,
        IS_IE: navigator.userAgent.match(/MSIE/i) !== null,
        IS_EDGE: navigator.userAgent.match(/Edge/i) !== null,
        IS_IPAD: navigator.userAgent.match(/iPad/i) !== null,
        IS_MOBILE: navigator.userAgent.match(/Mobile|Android/i) !== null,
        IS_ANDROID: navigator.userAgent.match(/Android/i) !== null,
        IS_IOS: navigator.userAgent.match(/(iPad|iPhone|iPod)/i) !== null || navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1,
        IS_CHROME: navigator.userAgent.match(/Chrome/i) !== null,
        IS_FIREFOX: navigator.userAgent.match(/Firefox/i) !== null,
        IS_SAFARI: navigator.userAgent.match(/^((?!chrome|android).)*safari/i) !== null,
        IS_APPLE: navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i) !== null,
        IS_WINDOWS: navigator.platform.match(/(Win32)/i) !== null,
        IS_TOUCH: navigator.userAgent.match(/Touch/i) !== null,
        IS_KINDLE: navigator.userAgent.match(/Kindle/i) !== null || navigator.userAgent.match(/Silk/i) !== null,
        IS_BRAILLENOTE: navigator.userAgent.match(/KeyWeb/i) !== null,
        IS_IN_IFRAME: window.parent !== window
    };
    Browser.IS_TABLET = Browser.IS_IPAD || Browser.IS_ANDROID || Browser.IS_KINDLE;
    Browser.IS_TOUCH_DEVICE = Browser.SHOULD_NOT_AUTOFOCUS = Browser.IS_IOS || Browser.IS_ANDROID || navigator.userAgent.match(/webOS/i) || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/Windows Phone/i);
    Browser.IOS_VERSION = function() {
        var v = navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);
        if (v) {
            return [parseInt(v[1], 10), parseInt(v[2], 10), parseInt(v[3] || 0, 10)]
        }
        return null
    }();
    Browser.MAC_VERSION = function() {
        var v = navigator.appVersion.match(/OS X (\d+)_(\d+)_?(\d+)?/);
        if (v) {
            return [parseInt(v[1], 10), parseInt(v[2], 10), parseInt(v[3] || 0, 10)]
        }
        return null
    }();
    Browser.CHROME_VERSION = function() {
        var v = navigator.appVersion.match(/Chrom(e|ium)\/([0-9]+)\.([0-9]+)\.?([0-9]+)?/);
        if (v) {
            return [parseInt(v[2], 10), parseInt(v[3], 10), parseInt(v[4] || 0, 10)]
        }
        return null
    }();
    Browser.SUPPORTS_INPUTMODE = function() {
        var iosVersion = Browser.IOS_VERSION;
        var macVersion = Browser.MAC_VERSION;
        var chromeVersion = Browser.CHROME_VERSION;
        return iosVersion && iosVersion[0] >= 13 || Browser.IS_IOS && !iosVersion && macVersion && (macVersion[0] > 10 || macVersion[0] === 10 && macVersion[1] >= 15) || Browser.IS_ANDROID && chromeVersion && chromeVersion[0] >= 76
    }();
    Browser.SUPPORTS_TRANSLATE3D = false;
    $(document).ready(function() {
        var el = document.createElement("p");
        var has3d;
        var computedStyle;
        var transforms = {
            webkitTransform: "-webkit-transform",
            OTransform: "-o-transform",
            msTransform: "-ms-transform",
            MozTransform: "-moz-transform",
            transform: "transform"
        };
        document.body.insertBefore(el, null);
        for (var t in transforms) {
            if (el.style[t] !== undefined) {
                el.style[t] = "translate3d(1px,1px,1px)";
                computedStyle = window.getComputedStyle(el);
                if (!computedStyle)
                    return;
                has3d = computedStyle.getPropertyValue(transforms[t])
            }
        }
        document.body.removeChild(el);
        Browser.SUPPORTS_TRANSLATE3D = has3d !== undefined && has3d.length > 0 && has3d !== "none"
    });
    Browser.translateRule = function(x, y) {
        if (Browser.SUPPORTS_TRANSLATE3D) {
            return "translate3d(" + x + (x ? "px" : "") + "," + y + (y ? "px" : "") + ",0)"
        }
        return "translate(" + x + (x ? "px" : "") + "," + y + (y ? "px" : "") + ")"
    }
    ;
    Browser.SUPPORTS_CANVAS = function() {
        var elem = document.createElement("canvas");
        var supports_canvas = !!(elem.getContext && elem.getContext("2d"));
        return supports_canvas
    }();
    return Browser
});
define("lib/fullscreen", ["require", "exports", "browser"], function(require, exports, Browser) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function enterFullscreen(element) {
        if (element.requestFullscreen) {
            return element.requestFullscreen()
        } else if (element.mozRequestFullScreen) {
            return element.mozRequestFullScreen()
        } else if (element.webkitRequestFullscreen) {
            return element.webkitRequestFullscreen()
        } else if (element.msRequestFullscreen) {
            return element.msRequestFullscreen()
        }
        return undefined
    }
    exports.enterFullscreen = enterFullscreen;
    function exitFullscreen() {
        if (document.exitFullscreen) {
            return document.exitFullscreen()
        } else if (document.mozCancelFullScreen) {
            return document.mozCancelFullScreen()
        } else if (document.webkitExitFullscreen) {
            return document.webkitExitFullscreen()
        } else if (document.msExitFullscreen) {
            return document.msExitFullscreen()
        }
        return undefined
    }
    exports.exitFullscreen = exitFullscreen;
    function isFullscreen() {
        var fullscreenElement = document.fullscreenElement || document.mozFullScreenElement || document.msFullscreenElement || document.webkitFullscreenElement;
        return !!fullscreenElement
    }
    exports.isFullscreen = isFullscreen;
    function supportsFullscreen() {
        return !Browser.IS_IOS && (!!document.exitFullscreen || !!document.mozCancelFullScreen || !!document.msExitFullscreen || !!document.webkitExitFullscreen)
    }
    exports.supportsFullscreen = supportsFullscreen
});
define("lib/restrict-focus", ["require", "exports", "keys", "jquery"], function(require, exports, Keys, $) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function getFocusableElements(jq) {
        return jq.find(':input:enabled, [tabindex="0"], a[href]').filter(":visible:not([aria-hidden=true])")
    }
    exports.getFocusableElements = getFocusableElements;
    function createRestrictFocusHandler(root) {
        return function handleKeyboardEvent(e) {
            if (Keys.lookup(e) == Keys.TAB) {
                var $focusableElements = getFocusableElements($(root));
                var $first = $focusableElements.first();
                var $last = $focusableElements.last();
                if (e.shiftKey && $first.is(":focus")) {
                    e.preventDefault();
                    $last.focus()
                } else if (!e.shiftKey && $last.is(":focus")) {
                    e.preventDefault();
                    $first.focus()
                } else if (document.activeElement && !$focusableElements.is(":focus")) {
                    e.preventDefault();
                    $first.focus()
                }
            }
        }
    }
    exports.createRestrictFocusHandler = createRestrictFocusHandler
});
define("loadcss!shared/dcgviews/modal", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/dcgviews/modal.css", decodeURIComponent(".modal-cover%20%7B%0A%20%20position%3A%20fixed%3B%0A%20%20top%3A%200%3B%0A%20%20left%3A%200%3B%0A%20%20width%3A%20100%25%3B%0A%20%20height%3A%20100%25%3B%0A%20%20z-index%3A%2030%3B%0A%2F**%0A%20%20*%20%20layout%20of%20the%20various%20modal%20types%0A%20%20*%2F%0A%7D%0A.modal-cover%20.modal-background%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%200%3B%0A%20%20left%3A%200%3B%0A%20%20bottom%3A%200%3B%0A%20%20right%3A%200%3B%0A%20%20background%3A%20rgba(0%2C0%2C0%2C0.7)%3B%0A%7D%0A.modal-cover.fullscreened-modal%20.modal-background%20%7B%0A%20%20background%3A%20%23000%3B%0A%7D%0A.modal-cover.fixed-width%20.modal-container%2C%0A.modal-cover.narrow-width%20.modal-container%2C%0A.modal-cover.centered-modal%20.modal-container%20%7B%0A%20%20-webkit-animation%3A%20fadeInDown%200.3s%3B%0A%20%20-moz-animation%3A%20fadeInDown%200.3s%3B%0A%20%20-o-animation%3A%20fadeInDown%200.3s%3B%0A%20%20-ms-animation%3A%20fadeInDown%200.3s%3B%0A%20%20animation%3A%20fadeInDown%200.3s%3B%0A%7D%0A.modal-cover.modal-background%2C%0A.modal-cover.full-width%20.modal-container%20%7B%0A%20%20-webkit-animation%3A%20fadeIn%200.3s%3B%0A%20%20-moz-animation%3A%20fadeIn%200.3s%3B%0A%20%20-o-animation%3A%20fadeIn%200.3s%3B%0A%20%20-ms-animation%3A%20fadeIn%200.3s%3B%0A%20%20animation%3A%20fadeIn%200.3s%3B%0A%7D%0A.modal-cover.centered-modal%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-align%3A%20center%3B%0A%20%20-moz-box-align%3A%20center%3B%0A%20%20-o-box-align%3A%20center%3B%0A%20%20-ms-flex-align%3A%20center%3B%0A%20%20-webkit-align-items%3A%20center%3B%0A%20%20align-items%3A%20center%3B%0A%20%20justify-contents%3A%20center%3B%0A%7D%0A.modal-cover.centered-modal%20.modal-transition-container%20%7B%0A%20%20margin%3A%200%20auto%3B%0A%20%20position%3A%20relative%3B%0A%7D%0A.modal-cover.fixed-width%20.modal-container%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20left%3A%2050%25%3B%0A%20%20top%3A%2030px%3B%0A%20%20width%3A%20800px%3B%0A%20%20margin-left%3A%20-400px%3B%0A%7D%0A.modal-cover.fixed-width%20.modal-container%20.modal-contents-wrapper%20%7B%0A%20%20max-height%3A%20calc(100vh%20-%2060px)%3B%0A%20%20overflow-y%3A%20auto%3B%0A%7D%0A.modal-cover.narrow-width%20.modal-container%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20left%3A%2050%25%3B%0A%20%20top%3A%2030px%3B%0A%20%20width%3A%20500px%3B%0A%20%20margin-left%3A%20-250px%3B%0A%7D%0A.modal-cover.narrow-width%20.modal-container%20.modal-contents-wrapper%20%7B%0A%20%20max-height%3A%20calc(100vh%20-%2060px)%3B%0A%20%20overflow-y%3A%20auto%3B%0A%7D%0A.modal-cover.full-width%20.modal-container%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%2030px%3B%0A%20%20bottom%3A%2030px%3B%0A%20%20left%3A%2030px%3B%0A%20%20right%3A%2030px%3B%0A%7D%0A.modal-cover.full-width%20.modal-container%20.modal-contents-wrapper%20%7B%0A%20%20overflow-y%3A%20auto%3B%0A%20%20overflow-x%3A%20hidden%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%200%3B%0A%20%20left%3A%200%3B%0A%20%20bottom%3A%200%3B%0A%20%20right%3A%200%3B%0A%7D%0A.modal-cover%20.close-cross%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-28px%3B%0A%20%20right%3A%20-28px%3B%0A%20%20display%3A%20inline-block%3B%0A%20%20padding-top%3A%202px%3B%0A%20%20font-size%3A%20110%25%3B%0A%20%20width%3A%2032px%3B%0A%20%20height%3A%2032px%3B%0A%20%20line-height%3A%2032px%3B%0A%20%20text-align%3A%20center%3B%0A%20%20border-radius%3A%2050%25%3B%0A%20%20color%3A%20%23fff%3B%0A%20%20opacity%3A%200.9%3B%0A%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D90)%22%3B%0A%20%20filter%3A%20alpha(opacity%3D90)%3B%0A%20%20padding-top%3A%202px%3B%0A%20%20font-size%3A%20110%25%3B%0A%7D%0A.modal-cover%20.close-cross.dcg-hovered%20%7B%0A%20%20opacity%3A%201%3B%0A%20%20-ms-filter%3A%20none%3B%0A%20%20filter%3A%20none%3B%0A%20%20background%3A%20rgba(255%2C255%2C255%2C0.15)%3B%0A%7D%0A.modal-cover%20.close-cross.dcg-depressed%20%7B%0A%20%20opacity%3A%201%3B%0A%20%20-ms-filter%3A%20none%3B%0A%20%20filter%3A%20none%3B%0A%20%20background%3A%20rgba(255%2C255%2C255%2C0.3)%3B%0A%7D%0A.modal-cover%20.modal-container%20.modal-contents-wrapper%20%7B%0A%20%20padding%3A%2015px%3B%0A%20%20background%3A%20%23fff%3B%0A%20%20border-radius%3A%206px%3B%0A%20%20-webkit-box-shadow%3A%200%200%2010px%20rgba(0%2C0%2C0%2C0.5)%3B%0A%20%20box-shadow%3A%200%200%2010px%20rgba(0%2C0%2C0%2C0.5)%3B%0A%7D%0A.modal-cover%20.modal-error-message%20%7B%0A%20%20text-align%3A%20center%3B%0A%20%20font-size%3A%2090%25%3B%0A%20%20background%3A%20rgba(192%2C80%2C77%2C0.1)%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%3A%201px%20solid%20rgba(192%2C80%2C77%2C0.5)%3B%0A%20%20border-radius%3A%203px%3B%0A%20%20color%3A%20%23c0504d%3B%0A%20%20-webkit-animation%3A%20fadeIn%200.3s%3B%0A%20%20-moz-animation%3A%20fadeIn%200.3s%3B%0A%20%20-o-animation%3A%20fadeIn%200.3s%3B%0A%20%20-ms-animation%3A%20fadeIn%200.3s%3B%0A%20%20animation%3A%20fadeIn%200.3s%3B%0A%20%20line-height%3A%2024px%3B%0A%7D%0A.modal-cover%20h1%20%7B%0A%20%20padding%3A%200%3B%0A%20%20margin%3A%200%200%2020px%3B%0A%20%20font-weight%3A%20normal%3B%0A%20%20font-size%3A%2024px%3B%0A%20%20text-align%3A%20center%3B%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20850px)%20%7B%0A%20%20.modal-cover.fixed-width%20.modal-container%20%7B%0A%20%20%20%20width%3A%20auto%3B%0A%20%20%20%20margin%3A%200%3B%0A%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20top%3A%2037px%3B%0A%20%20%20%20left%3A%2037px%3B%0A%20%20%20%20right%3A%2037px%3B%0A%20%20%7D%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20600px)%20%7B%0A%20%20.modal-cover%20.modal-background%20%7B%0A%20%20%20%20background%3A%20%23333%3B%0A%20%20%7D%0A%20%20.modal-cover.centered-modal%20.modal-transition-container%20%7B%0A%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20top%3A%200%3B%0A%20%20%20%20left%3A%200%3B%0A%20%20%20%20bottom%3A%200%3B%0A%20%20%20%20right%3A%200%3B%0A%20%20%7D%0A%20%20.modal-cover.fixed-width%20.modal-container%2C%0A%20%20.modal-cover.full-width%20.modal-container%2C%0A%20%20.modal-cover.narrow-width%20.modal-container%2C%0A%20%20.modal-cover.centered-modal%20.modal-container%20%7B%0A%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20top%3A%2042px%3B%0A%20%20%20%20left%3A%200%3B%0A%20%20%20%20right%3A%200%3B%0A%20%20%20%20bottom%3A%200%3B%0A%20%20%20%20width%3A%20auto%3B%0A%20%20%20%20margin%3A%200%3B%0A%20%20%7D%0A%20%20.modal-cover.fixed-width%20.modal-container%20.close-cross%2C%0A%20%20.modal-cover.full-width%20.modal-container%20.close-cross%2C%0A%20%20.modal-cover.narrow-width%20.modal-container%20.close-cross%2C%0A%20%20.modal-cover.centered-modal%20.modal-container%20.close-cross%20%7B%0A%20%20%20%20right%3A%205px%3B%0A%20%20%20%20top%3A%20-38px%3B%0A%20%20%7D%0A%20%20.modal-cover.fixed-width%20.modal-container%20.modal-contents-wrapper%2C%0A%20%20.modal-cover.full-width%20.modal-container%20.modal-contents-wrapper%2C%0A%20%20.modal-cover.narrow-width%20.modal-container%20.modal-contents-wrapper%2C%0A%20%20.modal-cover.centered-modal%20.modal-container%20.modal-contents-wrapper%20%7B%0A%20%20%20%20border-radius%3A%200%3B%0A%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20top%3A%200%3B%0A%20%20%20%20left%3A%200%3B%0A%20%20%20%20bottom%3A%200%3B%0A%20%20%20%20right%3A%200%3B%0A%20%20%20%20overflow-y%3A%20auto%3B%0A%20%20%20%20overflow-x%3A%20hidden%3B%0A%20%20%20%20max-height%3A%20none%3B%0A%20%20%7D%0A%20%20.modal-cover%3Anot(.has-close-button).fixed-width%20.modal-container%2C%0A%20%20.modal-cover%3Anot(.has-close-button).full-width%20.modal-container%2C%0A%20%20.modal-cover%3Anot(.has-close-button).narrow-width%20.modal-container%20%7B%0A%20%20%20%20top%3A%200%3B%0A%20%20%7D%0A%7D%0A"))
});
define("loadcss!tipsycss", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/submodules/albany/tipsy.css", decodeURIComponent(".tipsy%20%7B%20font-size%3A%2014px%3B%20position%3A%20fixed%3B%20padding%3A%205px%3B%20z-index%3A%20100000%3B%20cursor%3Apointer%3B%20font-family%3Asans-serif%3B%7D%0A%20%20.tipsy-inner%20%7B%20background-color%3A%20%23000%3B%20color%3A%20%23FFF%3B%20max-width%3A%20170px%3B%20padding%3A%205px%208px%204px%208px%3B%20text-align%3A%20center%3B%20%20cursor%3Apointer%3B%7D%0A%0A%20%20%2F*%20Rounded%20corners%20*%2F%0A%20%20.tipsy-inner%20%7B%20border-radius%3A%203px%3B%20-moz-border-radius%3A%203px%3B%20-webkit-border-radius%3A%203px%3B%7D%0A%0A%20%20.tipsy-arrow%20%7B%20position%3A%20absolute%3B%20width%3A%200%3B%20height%3A%200%3B%20line-height%3A%200%3B%20border%3A%205px%20dashed%20%23000%3B%20%20cursor%3Apointer%3B%7D%0A%0A%20%20%2F*%20Rules%20to%20colour%20arrows%20*%2F%0A%20%20.tipsy-arrow-n%20%7B%20border-bottom-color%3A%20%23000%3B%20%7D%0A%20%20.tipsy-arrow-s%20%7B%20border-top-color%3A%20%23000%3B%7D%0A%20%20.tipsy-arrow-e%20%7B%20border-left-color%3A%20%23000%3B%7D%0A%20%20.tipsy-arrow-w%20%7B%20border-right-color%3A%20%23000%3B%7D%0A%0A%20%20.tipsy-n%20.tipsy-arrow%20%7B%20top%3A%200px%3B%20left%3A%2050%25%3B%20margin-left%3A%20-5px%3B%20border-bottom-style%3A%20solid%3B%20border-top%3A%20none%3B%20border-left-color%3A%20transparent%3B%20border-right-color%3A%20transparent%3B%20%7D%0A%20%20%20%20.tipsy-nw%20.tipsy-arrow%20%7B%20top%3A%200%3B%20left%3A%2010px%3B%20border-bottom-style%3A%20solid%3B%20border-top%3A%20none%3B%20border-left-color%3A%20transparent%3B%20border-right-color%3A%20transparent%3B%7D%0A%20%20%20%20.tipsy-ne%20.tipsy-arrow%20%7B%20top%3A%200%3B%20right%3A%2010px%3B%20border-bottom-style%3A%20solid%3B%20border-top%3A%20none%3B%20%20border-left-color%3A%20transparent%3B%20border-right-color%3A%20transparent%3B%7D%0A%20%20.tipsy-s%20.tipsy-arrow%20%7B%20bottom%3A%200%3B%20left%3A%2050%25%3B%20margin-left%3A%20-5px%3B%20border-top-style%3A%20solid%3B%20border-bottom%3A%20none%3B%20%20border-left-color%3A%20transparent%3B%20border-right-color%3A%20transparent%3B%20%7D%0A%20%20%20%20.tipsy-sw%20.tipsy-arrow%20%7B%20bottom%3A%200%3B%20left%3A%2010px%3B%20border-top-style%3A%20solid%3B%20border-bottom%3A%20none%3B%20%20border-left-color%3A%20transparent%3B%20border-right-color%3A%20transparent%3B%20%7D%0A%20%20%20%20.tipsy-se%20.tipsy-arrow%20%7B%20bottom%3A%200%3B%20right%3A%2010px%3B%20border-top-style%3A%20solid%3B%20border-bottom%3A%20none%3B%20border-left-color%3A%20transparent%3B%20border-right-color%3A%20transparent%3B%20%7D%0A%20%20.tipsy-e%20.tipsy-arrow%20%7B%20right%3A%200%3B%20top%3A%2050%25%3B%20margin-top%3A%20-5px%3B%20border-left-style%3A%20solid%3B%20border-right%3A%20none%3B%20border-top-color%3A%20transparent%3B%20border-bottom-color%3A%20transparent%3B%20%7D%0A%20%20.tipsy-w%20.tipsy-arrow%20%7B%20left%3A%200%3B%20top%3A%2050%25%3B%20margin-top%3A%20-5px%3B%20border-right-style%3A%20solid%3B%20border-left%3A%20none%3B%20border-top-color%3A%20transparent%3B%20border-bottom-color%3A%20transparent%3B%20%7D%0A%0A.tipsy.tipsy-temporary-sticky%20.tipsy-inner%7B%0A%20%20background-color%3A%20%23777%3B%0A%7D%0A.tipsy.tipsy-temporary-sticky%20.tipsy-arrow%7B%0A%20%20border-bottom-color%3A%20%23777%3B%0A%7D%0A"))
});
define("jquery.tipsy", ["require", "loadcss!tipsycss", "jquery", "keys"], function(require) {
    require("loadcss!tipsycss");
    var $ = require("jquery");
    var Keys = require("keys");
    var openSticky = null;
    var ignoreStickyOpen = false;
    var stickyIdx = 0;
    var allVisibleTipsyInstances = {};
    var delayTooltips = 500;
    $(document).on("dcg-tap", ".tipsy-sticky", function(evnt) {
        if (ignoreStickyOpen) {
            ignoreStickyOpen = false;
            return
        }
        var opener = evnt.currentTarget;
        var $target = $(opener);
        if (!$target.attr("tooltip")) {
            $target = $target.find("[tooltip]").filter(':not([tooltip=""])')
        }
        if ($target.length !== 1)
            return;
        if ($target.css("display") === "none")
            return;
        if ($target.parents().filter(function() {
            return $(this).css("display") === "none"
        }).length)
            return;
        var options = $.extend({}, $.fn.tipsy.defaults);
        if ($target.attr("tipsy-dir")) {
            options.gravity = $target.attr("tipsy-dir")
        } else {
            options.gravity = "nw"
        }
        options.fade = false;
        openSticky = new Tipsy($target[0],options);
        openSticky.isOpenSticky = true;
        openSticky.renderVisible();
        openSticky.opener = opener
    });
    $(document).on("dcg-tapstart keydown", function(evnt) {
        if (evnt.type === "keydown" && Keys.lookup(evnt) === Keys.ESCAPE) {
            for (var id in allVisibleTipsyInstances) {
                allVisibleTipsyInstances[id].clearTooltip()
            }
            return
        }
        if (openSticky) {
            openSticky.clearTooltip();
            var opener = openSticky.opener;
            if (evnt.type === "dcg-tapstart" && $(evnt.target).closest(opener).length) {
                $(document).one("dcg-tapend", function(evnt2) {
                    if ($(evnt2.target).closest(opener).length) {
                        ignoreStickyOpen = true
                    }
                })
            }
            openSticky = null
        }
    });
    function maybeCall(thing, ctx) {
        return typeof thing == "function" ? thing.call(ctx) : thing
    }
    var counter = 0;
    function Tipsy(element, options) {
        this.id = counter++;
        this.$element = $(element);
        this.options = options;
        this.fixTitle()
    }
    Tipsy.prototype = {
        _show: function() {
            var title = this.getTitle();
            if (title && !isTipsyDisabled()) {
                var $tip = this.tip();
                var $arrow = $tip.find(".tipsy-arrow");
                this.uuid = stickyIdx;
                stickyIdx++;
                $(document).on("scroll.tipsy" + this.uuid, this.clearTooltip.bind(this));
                $tip.find(".tipsy-inner")[this.options.html ? "html" : "text"](title);
                $tip[0].className = "tipsy";
                $tip.detach().css({
                    top: 0,
                    left: 0,
                    visibility: "hidden",
                    display: "block"
                }).prependTo(document.body);
                var elt = this.$element[0];
                var tipElt = this.$tip[0];
                var pos = elt.getBoundingClientRect();
                var tipPos = tipElt.getBoundingClientRect();
                var tp, actualWidth = tipPos.width, actualHeight = tipPos.height, gravity = maybeCall(this.options.gravity, this.$element[0]);
                switch (gravity.charAt(0)) {
                    case "n":
                        tp = {
                            top: pos.top + pos.height + this.options.offset,
                            left: pos.left + pos.width / 2 - actualWidth / 2
                        };
                        break;
                    case "s":
                        tp = {
                            top: pos.top - actualHeight - this.options.offset,
                            left: pos.left + pos.width / 2 - actualWidth / 2
                        };
                        break;
                    case "e":
                        tp = {
                            top: pos.top + pos.height / 2 - actualHeight / 2,
                            left: pos.left - actualWidth - this.options.offset
                        };
                        break;
                    case "w":
                        tp = {
                            top: pos.top + pos.height / 2 - actualHeight / 2,
                            left: pos.left + pos.width + this.options.offset
                        };
                        break
                }
                if (gravity.length == 2) {
                    if (gravity.charAt(1) == "w") {
                        tp.left = pos.left + pos.width / 2 - 15
                    } else {
                        tp.left = pos.left + pos.width / 2 - actualWidth + 15
                    }
                }
                var arrowMarginLeft = 0;
                if (tp.left < 0) {
                    arrowMarginLeft = tp.left;
                    tp.left = 0
                } else if (tp.left + actualWidth > window.innerWidth) {
                    arrowMarginLeft = tp.left + actualWidth - window.innerWidth;
                    tp.left = window.innerWidth - actualWidth
                }
                if (gravity === "n" || gravity === "s") {
                    arrowMarginLeft -= 5
                }
                var xScale = pos.width / elt.offsetWidth;
                var yScale = pos.height / elt.offsetHeight;
                tp.top /= yScale;
                tp.left /= xScale;
                arrowMarginLeft /= xScale;
                $arrow.css("marginLeft", arrowMarginLeft);
                $tip.css(tp).addClass("tipsy-" + gravity);
                $arrow[0].className = "tipsy-arrow tipsy-arrow-" + gravity.charAt(0);
                if (this.options.fade) {
                    $tip.stop().css({
                        opacity: 0,
                        display: "block",
                        visibility: "visible"
                    }).animate({
                        opacity: 1
                    }, "fast")
                } else {
                    $tip.css({
                        visibility: "visible",
                        opacity: 1
                    })
                }
                if (this.options.sticky) {
                    $tip.addClass("tipsy-temporary-sticky")
                }
                var self = this;
                var validateLoop = function() {
                    self.validate();
                    self.validateTimeout = setTimeout(validateLoop, 100)
                };
                validateLoop()
            }
        },
        _hide: function() {
            clearTimeout(this.validateTimeout);
            $(document).off("scroll.tipsy" + this.uuid);
            if (this.options.fade) {
                this.tip().stop().fadeOut("fast", function() {
                    $(this).detach()
                })
            } else {
                this.tip().detach()
            }
        },
        clearTooltip: function() {
            delete this.buttonHoverTime;
            this.tooltipIsHovered = false;
            this.isOpenSticky = false;
            this.renderVisible()
        },
        renderVisible: function() {
            var isVisible = !!this.renderedVisible;
            var shouldBeVisible = !!this.tooltipIsHovered || !!this.isOpenSticky;
            if (this.buttonHoverTime) {
                if (isVisible) {
                    shouldBeVisible = true
                } else if (Date.now() - this.buttonHoverTime >= delayTooltips) {
                    shouldBeVisible = true
                }
            }
            if (shouldBeVisible === isVisible)
                return;
            this.renderedVisible = shouldBeVisible;
            if (shouldBeVisible) {
                allVisibleTipsyInstances[this.id] = this;
                this._show()
            } else {
                delete allVisibleTipsyInstances[this.id];
                this._hide()
            }
        },
        fixTitle: function() {
            var $e = this.$element;
            if ($e.attr("title") || typeof $e.attr("original-title") != "string") {
                $e.attr("original-title", $e.attr("title") || "").removeAttr("title")
            }
        },
        getTitle: function() {
            var title, $e = this.$element, o = this.options;
            this.fixTitle();
            o = this.options;
            if (typeof o.title == "string") {
                title = $e.attr(o.title == "title" ? "original-title" : o.title)
            } else if (typeof o.title == "function") {
                title = o.title.call($e[0])
            }
            if (title)
                title = ("" + title).replace(/(^\s*|\s*$)/, "");
            return title || ""
        },
        tip: function() {
            if (!this.$tip) {
                this.$tip = $('<div class="tipsy"><div class="tipsy-arrow"></div><div class="tipsy-inner"></div></div>');
                this.$tip.on("tipsyshow", function() {
                    clearTimeout(this.tooltipOutTimeout);
                    this.tooltipIsHovered = true;
                    this.renderVisible()
                }
                .bind(this));
                this.$tip.on("tipsyhide", function() {
                    clearTimeout(this.tooltipOutTimeout);
                    this.tooltipOutTimeout = setTimeout(function() {
                        this.tooltipIsHovered = false;
                        this.renderVisible()
                    }
                    .bind(this), 100)
                }
                .bind(this))
            }
            return this.$tip
        },
        validate: function() {
            var hasTitle = !!this.getTitle();
            var inDom = false;
            if (hasTitle) {
                try {
                    var node = this.$element[0];
                    while (node) {
                        if (node === document) {
                            inDom = true;
                            break
                        } else {
                            node = node.parentNode
                        }
                    }
                } catch (e) {}
            }
            if (!inDom) {
                this.clearTooltip()
            }
        }
    };
    $.fn.tipsy = function(options) {
        if (options === true) {
            return this.data("tipsy")
        } else if (typeof options == "string") {
            var tipsy = this.data("tipsy");
            if (tipsy)
                tipsy[options]();
            return this
        }
        options = $.extend({}, $.fn.tipsy.defaults, options);
        function get(ele) {
            var tipsy = $.data(ele, "tipsy");
            if (!tipsy) {
                tipsy = new Tipsy(ele,$.fn.tipsy.elementOptions(ele, options));
                $.data(ele, "tipsy", tipsy)
            }
            return tipsy
        }
        function enter(evnt) {
            if (evnt.type === "tipsyshow" && evnt.target !== this)
                return;
            if (openSticky === this)
                return;
            var tipsy = get(this);
            clearTimeout(tipsy.buttonTimeout);
            tipsy.buttonHoverTime = Date.now();
            tipsy.buttonTimeout = setTimeout(function() {
                tipsy.renderVisible()
            }, delayTooltips)
        }
        function leave(evnt) {
            if (evnt.type === "tipsyhide" && evnt.target !== this)
                return;
            var tipsy = get(this);
            if (evnt.type === "dcg-tapstart" && tipsy.options.sticky)
                return;
            clearTimeout(tipsy.buttonTimeout);
            tipsy.buttonTimeout = setTimeout(function() {
                delete tipsy.buttonHoverTime;
                tipsy.renderVisible()
            }, 100)
        }
        var eventIn = "tipsyshow";
        var eventOut = "tipsyhide dcg-tapstart dcg-tapend dcg-tapcancel";
        if (options.delegate) {
            this.on(eventIn, options.delegate, enter).on(eventOut, options.delegate, leave)
        } else {
            this.on(eventIn, enter).on(eventOut, leave)
        }
        return this
    }
    ;
    $.fn.tipsy.defaults = {
        fade: true,
        gravity: "n",
        html: false,
        offset: 0,
        title: "tooltip"
    };
    $.fn.tipsy.elementOptions = function(ele, options) {
        options = $.extend({}, options);
        var gravity = $(ele).attr("tipsy-gravity");
        if (gravity) {
            options.gravity = gravity
        }
        var offset = parseInt($(ele).attr("tipsy-offset"), 10);
        if (!isNaN(offset)) {
            options.offset = offset
        }
        return options
    }
    ;
    $.fn.tipsy.autoNS = function() {
        return $(this).offset().top > $(document).scrollTop() + $(window).height() / 2 ? "s" : "n"
    }
    ;
    $.fn.tipsy.autoWE = function() {
        return $(this).offset().left > $(document).scrollLeft() + $(window).width() / 2 ? "e" : "w"
    }
    ;
    $.fn.tipsy.autoBounds = function(margin, prefer) {
        return function() {
            var dir = {
                ns: prefer[0],
                ew: prefer.length > 1 ? prefer[1] : false
            }
                , boundTop = $(document).scrollTop() + margin
                , boundLeft = $(document).scrollLeft() + margin
                , $this = $(this);
            if ($this.offset().top < boundTop)
                dir.ns = "n";
            if ($this.offset().left < boundLeft)
                dir.ew = "w";
            if ($(window).width() + $(document).scrollLeft() - $this.offset().left < margin)
                dir.ew = "e";
            if ($(window).height() + $(document).scrollTop() - $this.offset().top < margin)
                dir.ns = "s";
            return dir.ns + (dir.ew ? dir.ew : "")
        }
    }
    ;
    $(document).tipsy({
        delegate: ".tipsy-sticky",
        gravity: "nw",
        fade: false,
        sticky: true
    });
    var disableLocks = 0;
    function isTipsyDisabled() {
        return disableLocks !== 0
    }
    function removeDisableLock() {
        disableLocks--
    }
    function addDisableLock() {
        disableLocks++
    }
    return {
        isDisabled: isTipsyDisabled,
        removeDisableLock: removeDisableLock,
        addDisableLock: addDisableLock
    }
});
define("shared/dcgviews/modal", ["require", "exports", "tslib", "lib/i18n", "dcgview", "jquery", "shared/dcgviews/portal-view", "keys", "lib/evt-delegator", "lib/fullscreen", "lib/restrict-focus", "loadcss!./modal", "jquery.tipsy"], function(require, exports, tslib_1, i18n, DCGView, $, portal_view_1, Keys, evt_delegator_1, fullscreen_1, restrict_focus_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var If = DCGView.Components.If;
    var Modal = function(_super) {
        tslib_1.__extends(Modal, _super);
        function Modal() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        Modal.prototype.template = function() {
            var _this = this;
            if (this.children.length !== 1 || typeof this.children[0] !== "function") {
                throw new Error("<Modal> expects a single child that is a function")
            }
            this.handledCloseFocus = false;
            var viewFn = this.children[0];
            var Wrapper = function(_super) {
                tslib_1.__extends(Wrapper, _super);
                function Wrapper() {
                    return _super !== null && _super.apply(this, arguments) || this
                }
                Wrapper.prototype.template = function() {
                    return viewFn()
                }
                ;
                return Wrapper
            }(DCGView.Class);
            return DCGView.createElement(If, {
                predicate: this.props.visible
            }, function() {
                return DCGView.createElement(portal_view_1.PortalView, {
                    mountPt: _this.const(document.body)
                }, function() {
                    return DCGView.createElement("div", {
                        class: function() {
                            var _a;
                            return _a = {
                                "modal-cover": true,
                                "has-close-button": _this.showX(),
                                "fullscreened-modal": fullscreen_1.isFullscreen()
                            },
                                _a["" + (_this.props.className && _this.props.className())] = _this.props.className,
                                _a
                        },
                        didMount: _this.bindFn(_this.didMountModalContents),
                        didUnmount: _this.bindFn(_this.didUnmountModalContents)
                    }, DCGView.createElement("div", {
                        class: DCGView.const("modal-background"),
                        onTap: _this.bindFn(_this.onClose)
                    }), DCGView.createElement("div", {
                        class: DCGView.const("modal-transition-container")
                    }, DCGView.createElement("div", {
                        class: DCGView.const("modal-container"),
                        role: DCGView.const("dialog"),
                        "aria-label": function() {
                            return _this.props.ariaLabel ? _this.props.ariaLabel() : i18n.EMPTY
                        }
                    }, DCGView.createElement(If, {
                        predicate: _this.bindFn(_this.showX)
                    }, function() {
                        return DCGView.createElement("div", {
                            role: DCGView.const("link"),
                            tabindex: DCGView.const("0"),
                            "aria-label": function() {
                                return i18n.s("global-button-close-dialog")
                            },
                            tooltip: function() {
                                return i18n.s("global-button-close-dialog")
                            },
                            class: DCGView.const("close-cross"),
                            onTap: _this.bindFn(_this.onClose),
                            didMount: function(el) {
                                return $(el).tipsy()
                            }
                        }, DCGView.createElement("i", {
                            class: DCGView.const("pillow-icon-remove"),
                            "aria-hidden": DCGView.const("true")
                        }))
                    }), DCGView.createElement("div", {
                        class: DCGView.const("modal-contents-wrapper")
                    }, DCGView.createElement(Wrapper, null)))))
                })
            })
        }
        ;
        Modal.prototype.showX = function() {
            return !!this.props.showX && this.props.showX()
        }
        ;
        Modal.prototype.didMountModalContents = function(el) {
            this.modalContentEl = el;
            $("body").addClass("pillow-modal-open")
        }
        ;
        Modal.prototype.didUnmountModalContents = function() {
            if (fullscreen_1.isFullscreen())
                fullscreen_1.exitFullscreen();
            $("body").removeClass("pillow-modal-open")
        }
        ;
        Modal.prototype.onClose = function() {
            if (this.props.onClose)
                this.props.onClose()
        }
        ;
        Modal.prototype.didMount = function() {
            var _this = this;
            var restrictFocus = restrict_focus_1.createRestrictFocusHandler(".modal-container:visible");
            this.unsub = evt_delegator_1.Delegator.push(function(e, stopHandling) {
                if (!_this.props.visible())
                    return;
                if (Keys.lookup(e) == Keys.ESCAPE) {
                    _this.onClose();
                    stopHandling()
                }
                restrictFocus(e)
            })
        }
        ;
        Modal.prototype.didUpdate = function() {
            if (!this.handledCloseFocus && this.props.visible() && this.props.showX && this.props.showX() && this.props.focusCloseLink && this.props.focusCloseLink()) {
                $(".modal-container:visible").find(".close-cross").focus();
                this.handledCloseFocus = true
            } else if (!this.props.visible()) {
                this.handledCloseFocus = false
            }
        }
        ;
        Modal.prototype.willUnmount = function() {
            this.unsub()
        }
        ;
        return Modal
    }(DCGView.Class);
    exports.Modal = Modal
});
define("activitybuilder/components/shared/prosemirror/helpers", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.ACTIVITY_URL_REGEX = /^https?:\/\/teacher-?\w*\.desmos.com:?\w*\/(((activitybuilder|polygraph)\/custom\/[0-9a-fA-F]{24}$)|(carnival|centralpark|waterline|carnival|tilepile|pennycircle|desman|marbleslides-\w*|polygraph-(\w|-)*)$)/i;
    exports.ACTIVITY_CUSTOM_URL_REGEX = /^https?:\/\/teacher-?\w*\.desmos.com:?\w*\/(activitybuilder|polygraph)\/custom\/[0-9a-fA-F]{24}$/i;
    exports.ACTIVITY_BUILDER_URL_REGEX = /^https?:\/\/teacher-?[\w-]*\.desmos.com:?\w*\/activitybuilder\/custom\/[0-9a-fA-F]{24}(#.*)?$/i;
    exports.ACTIVITY_CUSTOM_ID_REGEX = /^custom\:[0-9a-fA-F]{24}$/i;
    exports.textNodes = ["text", "paragraph", "list_item", "bullet_list", "heading"];
    exports.selectionContainsOnlyNodeTypes = function(state, nodes) {
        var _a;
        var $from = (_a = state.selection,
            _a.$from)
            , $to = _a.$to;
        var containsOnly = true;
        state.doc.nodesBetween($from.pos, $to.pos, function(node) {
            if (nodes.indexOf(node.type.name) === -1) {
                containsOnly = false
            }
        });
        return containsOnly
    }
    ;
    exports.selectionDoesNotContainNodeTypes = function(state, nodes) {
        var _a;
        var $from = (_a = state.selection,
            _a.$from)
            , $to = _a.$to;
        var doesNotContain = true;
        state.doc.nodesBetween($from.pos, $to.pos, function(node) {
            if (nodes.indexOf(node.type.name) !== -1) {
                doesNotContain = false
            }
        });
        return doesNotContain
    }
});
define("loadcss!activitybuilder/components/shared/prosemirror/link-menu-item", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/activitybuilder/components/shared/prosemirror/link-menu-item.css", decodeURIComponent(".link-modal-container%20%7B%0A%20%20margin%3A%205px%3B%0A%7D%0A.link-modal-container%20.link-modal-header%20%7B%0A%20%20text-transform%3A%20uppercase%3B%0A%20%20color%3A%20%23999%3B%0A%20%20font-size%3A%20130%25%3B%0A%20%20margin-bottom%3A%2020px%3B%0A%7D%0A.link-modal-container%20.link-href%20%7B%0A%20%20width%3A%20100%25%3B%0A%20%20margin-bottom%3A%2010px%3B%0A%7D%0A.link-modal-container%20.submit-link-container%20%7B%0A%20%20text-align%3A%20right%3B%0A%7D%0A.link-modal-container%20.submit-link-container%20.btn-link%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20margin-left%3A%2015px%3B%0A%20%20font-size%3A%20120%25%3B%0A%7D%0A"))
});
define("activitybuilder/components/shared/prosemirror/link-menu-item", ["require", "exports", "tslib", "underscore", "lib/i18n", "dcgview", "jquery", "keys", "lib/evt-delegator", "prosemirror-commands", "shared/dcgviews/modal", "./helpers", "loadcss!./link-menu-item"], function(require, exports, tslib_1, _, i18n, DCGView, $, Keys, evt_delegator_1, prosemirror_commands_1, modal_1, helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , Input = _a.Input
        , IfElse = _a.IfElse;
    var markActive = function(state, type) {
        var _a = state.selection
            , from = _a.from
            , $from = _a.$from
            , to = _a.to
            , empty = _a.empty;
        if (empty) {
            return !!type.isInSet(state.storedMarks || $from.marks())
        } else
            return state.doc.rangeHasMark(from, to, type)
    };
    var LinkMenuItem = function() {
        function LinkMenuItem(editorView) {
            this.key = "link";
            this.icon = "pillow-icon-link";
            this.tooltipWhenDisabled = i18n.s("ab-component-message-note-link-disabled");
            this.editorView = editorView;
            this.linkType = editorView.state.schema.marks["link"];
            this.promptText = ""
        }
        LinkMenuItem.prototype.getText = function() {
            return i18n.s("prosemirror-label-link")
        }
        ;
        LinkMenuItem.prototype.performCommand = function(state, dispatch) {
            var _this = this;
            var selectionIsText = helpers_1.selectionContainsOnlyNodeTypes(state, tslib_1.__spreadArrays(helpers_1.textNodes, ["interp"]));
            var selectionIsEmpty = state.selection.from == state.selection.to;
            var selectionHasLink = state.selection.$head.marks().some(function(mark) {
                return mark.type === _this.linkType
            });
            if (!selectionIsText || selectionIsEmpty && !selectionHasLink) {
                return false
            }
            if (dispatch != undefined) {
                this.promptActive = true;
                this.promptText = this.getCurrentHref(state);
                dispatch(state.tr)
            }
            return true
        }
        ;
        LinkMenuItem.prototype.getCurrentHref = function(state) {
            var _this = this;
            var currentHref = "";
            if (state.selection.from == state.selection.to) {
                var href = this.getHrefFromMarks(state.selection.$head.marks());
                if (href)
                    currentHref = href
            } else {
                var selectionContainsLink = markActive(state, this.linkType);
                if (selectionContainsLink) {
                    state.doc.nodesBetween(state.selection.from, state.selection.to, function(node) {
                        var href = _this.getHrefFromMarks(node.marks);
                        if (!currentHref && href) {
                            currentHref = href
                        }
                    })
                }
            }
            return currentHref
        }
        ;
        LinkMenuItem.prototype.getHrefFromMarks = function(marks) {
            var _this = this;
            var linkMark = _.find(marks, function(mark) {
                return mark.type === _this.linkType
            });
            if (!!linkMark && !!linkMark.attrs.href) {
                return linkMark.attrs.href
            }
            return undefined
        }
        ;
        LinkMenuItem.prototype.onLinkInput = function(text) {
            this.promptText = text
        }
        ;
        LinkMenuItem.prototype.submit = function(state, dispatch) {
            return prosemirror_commands_1.toggleMark(this.linkType, {
                href: this.promptText
            })(state, dispatch)
        }
        ;
        LinkMenuItem.prototype.doSubmit = function() {
            this.replaceLinkAroundSelection(this.editorView.state, this.editorView.dispatch, this.promptText);
            if (this.editorView.dispatch != undefined) {
                this.promptActive = false
            }
        }
        ;
        LinkMenuItem.prototype.isActive = function(state) {
            return markActive(state, this.linkType)
        }
        ;
        LinkMenuItem.prototype.replaceLinkAroundSelection = function(state, apply, newHref) {
            var from = state.selection.from;
            var to = state.selection.to;
            if (from == to) {
                var nodeBefore = state.selection.$head.nodeBefore;
                from = state.selection.from - (nodeBefore == undefined ? 0 : nodeBefore.nodeSize);
                var nodeAfter = state.selection.$head.nodeAfter;
                to = state.selection.to + (nodeAfter == undefined ? 0 : nodeAfter.nodeSize)
            }
            var tr = state.tr;
            if (state.doc.rangeHasMark(from, to, this.linkType)) {
                tr = tr.removeMark(from, to, this.linkType)
            }
            if (newHref) {
                tr = tr.addMark(from, to, state.schema.marks.link.create({
                    href: newHref
                }))
            }
            if (apply != undefined) {
                apply(tr)
            }
            return true
        }
        ;
        LinkMenuItem.prototype.doRemove = function() {
            this.replaceLinkAroundSelection(this.editorView.state, this.editorView.dispatch, undefined);
            if (this.editorView.dispatch != undefined) {
                this.promptActive = false
            }
        }
        ;
        return LinkMenuItem
    }();
    exports.LinkMenuItem = LinkMenuItem;
    var LinkEditView = function(_super) {
        tslib_1.__extends(LinkEditView, _super);
        function LinkEditView() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        LinkEditView.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(modal_1.Modal, {
                visible: this.props.visible,
                ariaLabel: function() {
                    return i18n.s("prosemirror-label-enter-link")
                },
                showX: this.const(true),
                className: this.const("narrow-width link-modal"),
                onClose: function() {
                    return _this.props.onClose()
                }
            }, function() {
                return DCGView.createElement("div", {
                    class: DCGView.const("link-modal-container"),
                    didMount: _this.bindFn(_this.modalDidMount),
                    willUnmount: _this.bindFn(_this.modalWillUnmount)
                }, DCGView.createElement("div", {
                    role: DCGView.const("heading"),
                    "aria-level": DCGView.const("1"),
                    class: DCGView.const("link-modal-header")
                }, function() {
                    return i18n.s("prosemirror-title-edit-link")
                }), DCGView.createElement(Input, {
                    type: _this.const("text"),
                    class: _this.const("link-href blue-outline"),
                    value: function() {
                        return _this.props.controller().promptText
                    },
                    placeholder: function() {
                        return i18n.s("prosemirror-placeholder-enter-link")
                    },
                    onInput: _this.bindFn(_this.onInput)
                }), IfElse(function() {
                    return !!_this.currentHref
                }, {
                    true: function() {
                        return DCGView.createElement("div", {
                            class: DCGView.const("submit-link-container")
                        }, DCGView.createElement("div", {
                            class: DCGView.const("red-link btn-link"),
                            onTap: _this.bindFn(_this.doRemove)
                        }, function() {
                            return i18n.s("prosemirror-button-remove-link")
                        }), DCGView.createElement("div", {
                            class: function() {
                                return {
                                    "btn-blue": true,
                                    "btn-link": true,
                                    disabled: _this.isDisabled()
                                }
                            },
                            onTap: _this.bindFn(_this.doSubmit)
                        }, function() {
                            return i18n.s("prosemirror-button-update-link")
                        }))
                    },
                    false: function() {
                        return DCGView.createElement("div", {
                            class: DCGView.const("submit-link-container")
                        }, DCGView.createElement("div", {
                            class: function() {
                                return {
                                    "btn-blue": true,
                                    "btn-link": true,
                                    disabled: _this.isDisabled()
                                }
                            },
                            onTap: _this.bindFn(_this.doSubmit)
                        }, function() {
                            return i18n.s("global-button-save")
                        }))
                    }
                }))
            })
        }
        ;
        LinkEditView.prototype.modalDidMount = function() {
            var _this = this;
            $(".link-href").focus().select();
            this.unsub = evt_delegator_1.Delegator.push(function(e, stopHandling) {
                if (Keys.lookup(e) === Keys.ENTER) {
                    if ($(".link-href").is(":focus")) {
                        _this.doSubmit();
                        return stopHandling()
                    }
                }
            });
            this.currentHref = this.props.controller().promptText
        }
        ;
        LinkEditView.prototype.modalWillUnmount = function() {
            this.unsub();
            this.props.controller().promptText = "";
            this.currentHref = ""
        }
        ;
        LinkEditView.prototype.doSubmit = function() {
            if (!this.isDisabled()) {
                this.props.controller().onLinkInput(this.validateURL(this.props.controller().promptText));
                this.props.controller().doSubmit();
                this.update()
            }
        }
        ;
        LinkEditView.prototype.doRemove = function() {
            this.props.controller().doRemove();
            this.update()
        }
        ;
        LinkEditView.prototype.isDisabled = function() {
            return this.props.controller().promptText.length < 1
        }
        ;
        LinkEditView.prototype.onInput = function(text) {
            this.props.controller().onLinkInput(text);
            this.update()
        }
        ;
        LinkEditView.prototype.validateURL = function(url) {
            if (url.length > 0 && !/[^:\/]+:\/\/.+/.test(url)) {
                return "https://" + url
            }
            return url
        }
        ;
        return LinkEditView
    }(DCGView.Class);
    exports.LinkEditView = LinkEditView
});
define("activitybuilder/components/shared/prosemirror/interp-menu-item", ["require", "exports", "lib/i18n", "prosemirror-state", "./helpers"], function(require, exports, i18n, prosemirror_state_1, helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var InterpMenuItem = function() {
        function InterpMenuItem(getInterpExprs) {
            this.getInterpExprs = getInterpExprs;
            this.key = "interp";
            this.icon = "pillow-icon-interpolate";
            this.tooltipWhenDisabled = i18n.s("ab-component-message-note-no-variables");
            this.tooltipWhenEnabled = i18n.s("ab-component-message-note-interp-button");
            this.gravity = "n"
        }
        InterpMenuItem.prototype.getText = function() {
            return i18n.s("prosemirror-label-interp")
        }
        ;
        InterpMenuItem.prototype.isActive = function(state) {
            var node = state.selection.node;
            if (node) {
                return node.type.name == "interp"
            }
            return false
        }
        ;
        InterpMenuItem.prototype.performCommand = function(state, dispatch) {
            if (!this.getInterpExprs().length || !helpers_1.selectionContainsOnlyNodeTypes(state, helpers_1.textNodes)) {
                return false
            }
            if (dispatch !== undefined) {
                var node = state.schema.nodes.interp.create();
                var tr = state.tr.replaceSelectionWith(node, true);
                var sel = void 0;
                try {
                    sel = prosemirror_state_1.NodeSelection.create(tr.doc, state.selection.from)
                } catch (e) {
                    return false
                }
                dispatch(tr.setSelection(sel).scrollIntoView())
            }
            return true
        }
        ;
        return InterpMenuItem
    }();
    exports.InterpMenuItem = InterpMenuItem
});
define("core/lib/assert-unreachable", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.assertUnreachable = function(x, message) {
        if (!message) {
            message = "Exhaustive case failed! " + JSON.stringify(x)
        }
        throw new Error(message)
    }
    ;
    function assertDefined(x, name) {
        if (x === undefined) {
            throw new Error("Expected " + name + " to be defined.")
        }
    }
    exports.assertDefined = assertDefined
});
define("activitybuilder/components/shared/prosemirror/mq-helpers", ["require", "exports", "tslib", "prosemirror-state", "./helpers"], function(require, exports, tslib_1, prosemirror_state_1, helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.mqAction = function(state, onAction) {
        if (!helpers_1.selectionContainsOnlyNodeTypes(state, tslib_1.__spreadArrays(helpers_1.textNodes, ["mq", "interp"]))) {
            return false
        }
        var selectedText = state.doc.textBetween(state.selection.from, state.selection.to);
        var mqType = state.schema.nodes["mq"];
        var node = mqType.create(undefined, selectedText.length > 0 ? state.schema.text(selectedText) : undefined);
        var replace = state.tr.replaceSelectionWith(node);
        var sel;
        try {
            sel = prosemirror_state_1.NodeSelection.create(replace.doc, state.selection.from)
        } catch (e) {
            return false
        }
        var select = replace.setSelection(sel).scrollIntoView();
        if (onAction != undefined) {
            onAction(select)
        }
        return true
    }
    ;
    exports.backspaceCommand = function(state, onAction) {
        if (!state.selection.empty) {
            return false
        }
        var nodeBefore = state.selection.$from.nodeBefore;
        if (nodeBefore && nodeBefore.type.name == "mq") {
            var select = state.tr.setSelection(prosemirror_state_1.NodeSelection.create(state.doc, state.selection.from - nodeBefore.nodeSize));
            if (onAction != undefined) {
                onAction(select)
            }
            return true
        } else {
            return false
        }
    }
    ;
    exports.deleteCommand = function(state, onAction) {
        if (!state.selection.empty) {
            return false
        }
        var nodeAfter = state.selection.$from.nodeAfter;
        if (nodeAfter && nodeAfter.type.name == "mq") {
            var select = state.tr.setSelection(prosemirror_state_1.NodeSelection.create(state.doc, state.selection.from));
            if (onAction != undefined) {
                onAction(select)
            }
            return true
        } else {
            return false
        }
    }
});
define("lib/class-names", ["require", "exports", "tslib", "core/lib/assert-unreachable"], function(require, exports, tslib_1, assert_unreachable_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function classNames() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i]
        }
        var classes = {};
        for (var _a = 0, args_1 = args; _a < args_1.length; _a++) {
            var arg = args_1[_a];
            if (!arg) {
                continue
            } else if (typeof arg === "string") {
                classes[arg] = true
            } else if (typeof arg === "function") {
                if (!!arg()) {
                    classes[arg()] = true
                }
            } else if (typeof arg === "object") {
                classes = tslib_1.__assign(tslib_1.__assign({}, classes), arg)
            } else {
                assert_unreachable_1.assertUnreachable(arg)
            }
        }
        return classes
    }
    exports.classNames = classNames
});
define("loadcss!shared/dcgviews/tooltip", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/dcgviews/tooltip.css", decodeURIComponent("%2F**%0A%20*%20Adapted%20from%20knox%2Ffrontend%2Fdesmos%2Fpublic%2Fassets%2Fjs%2Flib%2Ftooltip.styl%0A%20*%2F%0A.dcg-tooltip-hit-area-container%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20position%3A%20relative%3B%0A%20%20cursor%3A%20default%20!important%3B%0A%20%20line-height%3A%20initial%3B%0A%7D%0A.dcg-tooltip-mount-pt%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%200%3B%0A%20%20left%3A%200%3B%0A%7D%0A.dcg-tooltip-positioning-container%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20pointer-events%3A%20none%3B%0A%20%20z-index%3A%2010000%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-message-container%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20z-index%3A%2010000%3B%0A%20%20-webkit-animation%3A%20dcg-fadeIn%200.3s%3B%0A%20%20-moz-animation%3A%20dcg-fadeIn%200.3s%3B%0A%20%20-o-animation%3A%20dcg-fadeIn%200.3s%3B%0A%20%20-ms-animation%3A%20dcg-fadeIn%200.3s%3B%0A%20%20animation%3A%20dcg-fadeIn%200.3s%3B%0A%20%20white-space%3A%20normal%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-message-container%20.dcg-tooltip-message%20%7B%0A%20%20background%3A%20%23000%3B%0A%20%20color%3A%20%23fff%3B%0A%20%20border-radius%3A%204px%3B%0A%20%20padding%3A%205px%208px%3B%0A%20%20font-size%3A%2014px%3B%0A%20%20text-shadow%3A%20none%3B%0A%20%20line-height%3A%201.1em%3B%0A%20%20display%3A%20inline-block%3B%0A%20%20pointer-events%3A%20all%3B%0A%20%20text-align%3A%20unset%3B%0A%20%20cursor%3A%20default%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-message-container%20.dcg-tooltip-message.is-sticky-and-not-stuck%20%7B%0A%20%20background%3A%20%23666%3B%0A%20%20cursor%3A%20pointer%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-arrow%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20-webkit-animation%3A%20dcg-fadeIn%200.3s%3B%0A%20%20-moz-animation%3A%20dcg-fadeIn%200.3s%3B%0A%20%20-o-animation%3A%20dcg-fadeIn%200.3s%3B%0A%20%20-ms-animation%3A%20dcg-fadeIn%200.3s%3B%0A%20%20animation%3A%20dcg-fadeIn%200.3s%3B%0A%20%20z-index%3A%2010000%3B%0A%20%20border%3A%205px%20solid%20transparent%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-arrow.dcg-tooltip-gravity-s%20%7B%0A%20%20border-bottom-color%3A%20%23000%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-arrow.dcg-tooltip-gravity-s.is-sticky-and-not-stuck%20%7B%0A%20%20border-bottom-color%3A%20%23666%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-arrow.dcg-tooltip-gravity-n%20%7B%0A%20%20border-top-color%3A%20%23000%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-arrow.dcg-tooltip-gravity-n.is-sticky-and-not-stuck%20%7B%0A%20%20border-top-color%3A%20%23666%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-arrow.dcg-tooltip-gravity-e%20%7B%0A%20%20border-right-color%3A%20%23000%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-arrow.dcg-tooltip-gravity-e.is-sticky-and-not-stuck%20%7B%0A%20%20border-right-color%3A%20%23666%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-arrow.dcg-tooltip-gravity-w%20%7B%0A%20%20border-left-color%3A%20%23000%3B%0A%7D%0A.dcg-tooltip-positioning-container%20.dcg-tooltip-arrow.dcg-tooltip-gravity-w.is-sticky-and-not-stuck%20%7B%0A%20%20border-left-color%3A%20%23666%3B%0A%7D%0A"))
});
define("shared/dcgviews/tooltip", ["require", "exports", "tslib", "keys", "dcgview", "jquery", "underscore", "lib/class-names", "loadcss!./tooltip"], function(require, exports, tslib_1, Keys, DCGView, $, _, class_names_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var TOOLTIP_DELAY = 500;
    var ARROW_SIZE = 5;
    var Wrapper = function(_super) {
        tslib_1.__extends(Wrapper, _super);
        function Wrapper() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        Wrapper.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                class: DCGView.const("dcg-tooltip-positioning-container"),
                style: function() {
                    return {
                        top: _this.props.hitAreaRect().top + "px",
                        left: _this.props.hitAreaRect().left + "px",
                        width: _this.props.hitAreaRect().width + "px",
                        height: _this.props.hitAreaRect().height + "px"
                    }
                }
            }, DCGView.createElement("div", {
                class: DCGView.const("dcg-tooltip-message-container"),
                style: this.bindFn(this.getMessageStyle)
            }, DCGView.createElement("div", {
                class: function() {
                    return class_names_1.classNames("dcg-tooltip-message", {
                        "is-sticky-and-not-stuck": _this.props.isStickyAndNotStuck()
                    })
                }
            }, this.props.tooltip)), DCGView.createElement("div", {
                class: function() {
                    var _a;
                    return class_names_1.classNames("dcg-tooltip-arrow", (_a = {
                        "is-sticky-and-not-stuck": _this.props.isStickyAndNotStuck()
                    },
                        _a["dcg-tooltip-gravity-" + _this.props.gravity()[0]] = true,
                        _a))
                },
                style: this.bindFn(this.getArrowStyle)
            }))
        }
        ;
        Wrapper.prototype.getArrowStyle = function() {
            var gravity = this.props.gravity();
            var arrowOffset = this.props.hitAreaRect().width * .5 + "px";
            var marginString = "-" + ARROW_SIZE + "px";
            switch (gravity) {
                case "s":
                    return {
                        top: "100%",
                        left: "50%",
                        "margin-top": marginString,
                        "margin-left": marginString
                    };
                case "sw":
                    return {
                        top: "100%",
                        right: arrowOffset,
                        "margin-top": marginString,
                        "margin-right": marginString
                    };
                case "se":
                    return {
                        top: "100%",
                        left: arrowOffset,
                        "margin-top": marginString,
                        "margin-left": marginString
                    };
                case "n":
                    return {
                        bottom: "100%",
                        left: "50%",
                        "margin-bottom": marginString,
                        "margin-left": marginString
                    };
                case "nw":
                    return {
                        bottom: "100%",
                        right: arrowOffset,
                        "margin-bottom": marginString,
                        "margin-right": marginString
                    };
                case "ne":
                    return {
                        bottom: "100%",
                        left: arrowOffset,
                        "margin-bottom": marginString,
                        "margin-left": marginString
                    };
                case "e":
                    return {
                        top: "50%",
                        left: "100%",
                        "margin-left": marginString,
                        "margin-top": marginString
                    };
                case "w":
                    return {
                        top: "50%",
                        right: "100%",
                        "margin-right": marginString,
                        "margin-top": marginString
                    };
                default:
                    var _exhaustive = gravity;
                    return _exhaustive
            }
        }
        ;
        Wrapper.prototype.getMessageStyle = function() {
            var hitAreaRect = this.props.hitAreaRect();
            var gravity = this.props.gravity();
            var offsetLeft = this.props.offset().left || 0;
            var width = this.props.maxWidth();
            switch (gravity) {
                case "s":
                    return {
                        top: "100%",
                        width: width + "px",
                        transform: "translate(-50%, 0)",
                        left: .5 * hitAreaRect.width + offsetLeft + "px",
                        "margin-top": ARROW_SIZE + "px",
                        "text-align": "center"
                    };
                case "sw":
                    return {
                        top: "100%",
                        width: width + "px",
                        right: -offsetLeft + "px",
                        "margin-top": ARROW_SIZE + "px",
                        "text-align": "right"
                    };
                case "se":
                    return {
                        top: "100%",
                        width: width + "px",
                        left: offsetLeft + "px",
                        "margin-top": ARROW_SIZE + "px",
                        "text-align": "left"
                    };
                case "n":
                    return {
                        bottom: "100%",
                        width: width + "px",
                        transform: "translate(-50%, 0)",
                        left: .5 * hitAreaRect.width + offsetLeft + "px",
                        "margin-bottom": ARROW_SIZE + "px",
                        "text-align": "center"
                    };
                case "nw":
                    return {
                        bottom: "100%",
                        width: width + "px",
                        right: -offsetLeft + "px",
                        "margin-bottom": ARROW_SIZE + "px",
                        "text-align": "right"
                    };
                case "ne":
                    return {
                        bottom: "100%",
                        width: width + "px",
                        left: offsetLeft + "px",
                        "margin-bottom": ARROW_SIZE + "px",
                        "text-align": "left"
                    };
                case "e":
                    return {
                        transform: "translate(0, -50%)",
                        left: "100%",
                        width: width + "px",
                        top: .5 * hitAreaRect.height + "px",
                        "margin-left": ARROW_SIZE + offsetLeft + "px",
                        "text-align": "left"
                    };
                case "w":
                    return {
                        transform: "translate(0, -50%)",
                        right: "100%",
                        width: width + "px",
                        top: .5 * hitAreaRect.height + "px",
                        "margin-right": ARROW_SIZE - offsetLeft + "px",
                        "text-align": "right"
                    };
                default:
                    var _exhaustive = gravity;
                    return _exhaustive
            }
        }
        ;
        return Wrapper
    }(DCGView.Class);
    var Tooltip = function(_super) {
        tslib_1.__extends(Tooltip, _super);
        function Tooltip() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        Tooltip.prototype.init = function() {
            this.uuid = _.uniqueId();
            this.isMounted = true
        }
        ;
        Tooltip.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                class: function() {
                    var _a;
                    return _a = {
                        "dcg-tooltip-hit-area-container": true
                    },
                        _a[_this.props.class ? _this.props.class() : ""] = !!_this.props.class,
                        _a
                },
                handleevent: DCGView.const("true"),
                didMount: function(hitAreaNode) {
                    _this.hitAreaNode = hitAreaNode;
                    _this.setupEventListeners(_this.hitAreaNode)
                },
                onTap: function() {
                    if (_this.isStuck) {
                        _this.clearTimeouts();
                        _this.hideTooltip();
                        return
                    }
                    if (_this.isSticky()) {
                        _this.showTooltip();
                        _this.stickTooltip()
                    } else {
                        _this.hideTooltip()
                    }
                }
            }, this.children)
        }
        ;
        Tooltip.prototype.didUpdate = function() {
            this.updateTooltip()
        }
        ;
        Tooltip.prototype.updateTooltip = function() {
            if (!this.wrapperRef)
                return;
            var containerRect = this.hitAreaNode.getBoundingClientRect();
            var mountPtRect = this.wrapperRef.elt.getBoundingClientRect();
            var _a = this.wrapperRef
                , originalTop = _a.originalTop
                , originalLeft = _a.originalLeft;
            var top = containerRect.top - mountPtRect.top;
            var left = containerRect.left - mountPtRect.left;
            if (Math.abs(top - originalTop) > 3 || Math.abs(left - originalLeft) > 3) {
                this.hideTooltip()
            } else {
                this.wrapperRef.view.update()
            }
        }
        ;
        Tooltip.prototype.setupEventListeners = function(el) {
            var _this = this;
            $(el).on("tipsyshow", function(e) {
                if (e.target !== el)
                    return;
                if (_this.props.disabled && _this.props.disabled())
                    return;
                _this.clearTimeouts();
                _this.showTooltipTimeout = setTimeout(_this.bindFn(_this.showTooltip), _this.props.tooltipDelay ? _this.props.tooltipDelay() : TOOLTIP_DELAY)
            }).on("tipsyhide", function(e) {
                if (e.target !== el || _this.isStuck)
                    return;
                _this.clearTimeouts();
                _this.hideTooltipTimeout = setTimeout(_this.bindFn(_this.hideTooltip), 150)
            })
        }
        ;
        Tooltip.prototype.willUnmount = function() {
            this.clearTimeouts();
            this.isMounted = false;
            this.hideTooltip()
        }
        ;
        Tooltip.prototype.stickTooltip = function() {
            var _this = this;
            if (!this.isMounted)
                return;
            if (!this.wrapperRef)
                return;
            if (this.isStuck)
                return;
            $(document).on("mousedown.dcg-tooltip-" + this.uuid + " touchstart.dcg-tooltip-" + this.uuid + " pointerdown.dcg-tooltip-" + this.uuid, function(e) {
                if (!_this.wrapperRef)
                    return;
                if ($(e.target).closest(_this.hitAreaNode).length)
                    return;
                if ($(e.target).closest(_this.wrapperRef.elt).length)
                    return;
                _this.hideTooltip()
            });
            this.isStuck = true;
            this.updateTooltip()
        }
        ;
        Tooltip.prototype.clearTimeouts = function() {
            clearTimeout(this.showTooltipTimeout);
            clearTimeout(this.hideTooltipTimeout)
        }
        ;
        Tooltip.prototype.showTooltip = function() {
            var _this = this;
            if (!this.isMounted)
                return;
            if (this.wrapperRef)
                return;
            if (!this.props.tooltip())
                return;
            var containerRect = this.hitAreaNode.getBoundingClientRect();
            var mountPtElt = document.createElement("div");
            mountPtElt.className = "dcg-tooltip-mount-pt";
            var dcgTapContainer = $(this.hitAreaNode).closest(".dcg-tap-container")[0];
            dcgTapContainer.appendChild(mountPtElt);
            var mountPtContainer = mountPtElt.getBoundingClientRect();
            var originalLeft = containerRect.left - mountPtContainer.left;
            var originalTop = containerRect.top - mountPtContainer.top;
            var maxWidth = Math.min(200, this.props.maxParentWidthOverflow ? containerRect.width + 2 * this.props.maxParentWidthOverflow() : Infinity);
            var tooltipProps = {
                tooltip: this.props.tooltip,
                isStickyAndNotStuck: function() {
                    return _this.isSticky() && !_this.isStuck
                },
                offset: function() {
                    return _this.props.offset ? _this.props.offset() : {}
                },
                gravity: function() {
                    return _this.props.gravity ? _this.props.gravity() : "s"
                },
                maxWidth: function() {
                    return maxWidth
                },
                hitAreaRect: function() {
                    return {
                        top: originalTop || 0,
                        left: originalLeft || 0,
                        width: containerRect.width || 0,
                        height: containerRect.height || 0
                    }
                }
            };
            this.setupEventListeners(mountPtElt);
            $(mountPtElt).on("dcg-tap", function() {
                if (_this.isSticky())
                    _this.stickTooltip()
            });
            var wrapperView = DCGView.mountToNode(Wrapper, mountPtElt, tooltipProps);
            $(document).on("keydown.dcg-tooltip-" + this.uuid, function(e) {
                if (Keys.lookup(e) === Keys.ESCAPE) {
                    _this.hideTooltip()
                }
            });
            var onScroll = function() {
                return _this.updateTooltip()
            };
            window.addEventListener("scroll", onScroll, true);
            this.wrapperRef = {
                elt: mountPtElt,
                view: wrapperView,
                originalLeft: originalLeft,
                originalTop: originalTop,
                onScroll: onScroll
            }
        }
        ;
        Tooltip.prototype.hideTooltip = function() {
            this.clearTimeouts();
            if (!this.wrapperRef)
                return;
            this.isStuck = false;
            $(document).off(".dcg-tooltip-" + this.uuid);
            window.removeEventListener("scroll", this.wrapperRef.onScroll, true);
            DCGView.unmountFromNode(this.wrapperRef.elt);
            if (this.wrapperRef.elt.parentNode) {
                this.wrapperRef.elt.parentNode.removeChild(this.wrapperRef.elt)
            }
            this.wrapperRef = undefined
        }
        ;
        Tooltip.prototype.isSticky = function() {
            return !!this.props.sticky && this.props.sticky()
        }
        ;
        return Tooltip
    }(DCGView.Class);
    exports.Tooltip = Tooltip
});
define("activitybuilder/components/shared/prosemirror/menu-item", ["require", "exports", "tslib", "prosemirror-commands", "core/lib/assert-unreachable", "dcgview", "lib/i18n", "./mq-helpers", "prosemirror-schema-list", "shared/dcgviews/tooltip", "./helpers"], function(require, exports, tslib_1, prosemirror_commands_1, assert_unreachable_1, DCGView, i18n, mq_helpers_1, prosemirror_schema_list_1, tooltip_1, helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var Switch = DCGView.Components.Switch;
    var MqMenuItem = function() {
        function MqMenuItem(menuType) {
            this.key = "mq";
            this.tooltipWhenEnabled = i18n.s("ab-component-message-note-mq-button");
            this.gravity = "n";
            if (menuType === "editing") {
                this.icon = "pillow-icon-sqrt"
            } else {
                this.icon = "pillow-icon-new-expression"
            }
        }
        MqMenuItem.prototype.getText = function() {
            return i18n.s("prosemirror-label-math")
        }
        ;
        MqMenuItem.prototype.isActive = function() {
            return false
        }
        ;
        MqMenuItem.prototype.performCommand = function(state, dispatch) {
            if (helpers_1.selectionContainsOnlyNodeTypes(state, helpers_1.textNodes)) {
                return mq_helpers_1.mqAction(state, dispatch)
            }
            return false
        }
        ;
        return MqMenuItem
    }();
    exports.MqMenuItem = MqMenuItem;
    var clearMark = function(markType) {
        return function(state, dispatch) {
            var _a = state.selection
                , $cursor = _a.$cursor
                , ranges = _a.ranges;
            if ($cursor) {
                if (markType.isInSet(state.storedMarks || $cursor.marks())) {
                    if (dispatch)
                        dispatch(state.tr.removeStoredMark(markType))
                } else {
                    return false
                }
            } else {
                var has = false;
                var tr = state.tr;
                for (var i = 0; !has && i < ranges.length; i++) {
                    var ref$1 = ranges[i];
                    var $from = ref$1.$from;
                    var $to = ref$1.$to;
                    has = state.doc.rangeHasMark($from.pos, $to.pos, markType)
                }
                if (!has)
                    return false;
                for (var i$1 = 0; i$1 < ranges.length; i$1++) {
                    var ref$2 = ranges[i$1];
                    var $from$1 = ref$2.$from;
                    var $to$1 = ref$2.$to;
                    tr.removeMark($from$1.pos, $to$1.pos, markType)
                }
                if (dispatch)
                    dispatch(tr.scrollIntoView())
            }
            return true
        }
    };
    var FontMenuItem = function() {
        function FontMenuItem(params) {
            this.key = params.key;
            this.text = params.text;
            this.markType = params.markType;
            this.icon = params.icon
        }
        FontMenuItem.prototype.getText = function() {
            return this.text
        }
        ;
        FontMenuItem.prototype.isActive = function(state) {
            var _a = state.selection
                , from = _a.from
                , $from = _a.$from
                , to = _a.to
                , empty = _a.empty;
            if (this.key === "small") {
                if (prosemirror_commands_1.toggleMark(state.schema.marks.medium)(state)) {
                    if (empty) {
                        return !(state.schema.marks.medium.isInSet(state.storedMarks || $from.marks()) || state.schema.marks.large.isInSet(state.storedMarks || $from.marks()))
                    } else
                        return !(state.doc.rangeHasMark(from, to, state.schema.marks.medium) || state.doc.rangeHasMark(from, to, state.schema.marks.large))
                } else {
                    return false
                }
            }
            var type;
            switch (this.key) {
                case "medium":
                    type = state.schema.marks.medium;
                    break;
                case "large":
                    type = state.schema.marks.large;
                    break;
                default:
                    return assert_unreachable_1.assertUnreachable(this.key)
            }
            if (empty)
                return !!type.isInSet(state.storedMarks || $from.marks());
            else
                return state.doc.rangeHasMark(from, to, type)
        }
        ;
        FontMenuItem.prototype.performCommand = function(state, dispatch) {
            if (this.isActive(state))
                return false;
            if (this.key === "small") {
                var clearMarkMedium = clearMark(state.schema.marks.medium)(state, dispatch);
                var clearMarkLarge = clearMark(state.schema.marks.large)(state, dispatch);
                return clearMarkMedium || clearMarkLarge
            }
            return prosemirror_commands_1.toggleMark(this.markType)(state, dispatch)
        }
        ;
        return FontMenuItem
    }();
    exports.FontMenuItem = FontMenuItem;
    var MarkMenuItem = function() {
        function MarkMenuItem(params) {
            this.key = params.key;
            this.text = params.text;
            this.markType = params.markType;
            this.icon = params.icon
        }
        MarkMenuItem.prototype.getText = function() {
            return this.text
        }
        ;
        MarkMenuItem.prototype.isActive = function(state) {
            var _a = state.selection
                , from = _a.from
                , $from = _a.$from
                , to = _a.to
                , empty = _a.empty;
            if (empty)
                return !!this.markType.isInSet(state.storedMarks || $from.marks());
            else
                return state.doc.rangeHasMark(from, to, this.markType)
        }
        ;
        MarkMenuItem.prototype.performCommand = function(state, dispatch) {
            if (helpers_1.selectionDoesNotContainNodeTypes(state, ["mq"])) {
                return prosemirror_commands_1.toggleMark(this.markType)(state, dispatch)
            }
            return false
        }
        ;
        return MarkMenuItem
    }();
    exports.MarkMenuItem = MarkMenuItem;
    var BlockMenuItem = function() {
        function BlockMenuItem(params, view) {
            this.key = params.key;
            this.text = params.text;
            this.nodeType = params.nodeType;
            this.icon = params.icon;
            this.attrs = params.attrs;
            this.setBlockTypeCommand = prosemirror_commands_1.setBlockType(this.nodeType, params.attrs);
            this.setPlainTypeCommand = prosemirror_commands_1.setBlockType(view.state.schema.nodes["paragraph"], params.attrs)
        }
        BlockMenuItem.prototype.getText = function() {
            return this.text
        }
        ;
        BlockMenuItem.prototype.isActive = function(state) {
            var _a = state.selection
                , $from = _a.$from
                , to = _a.to
                , node = _a.node;
            if (node) {
                return node.hasMarkup(this.nodeType, this.attrs)
            }
            return to <= $from.end() && $from.parent.hasMarkup(this.nodeType, this.attrs)
        }
        ;
        BlockMenuItem.prototype.performCommand = function(state, dispatch) {
            if (this.isActive(state)) {
                return this.setPlainTypeCommand(state, dispatch)
            } else {
                return this.setBlockTypeCommand(state, dispatch)
            }
        }
        ;
        return BlockMenuItem
    }();
    exports.BlockMenuItem = BlockMenuItem;
    var ListMenuItem = function() {
        function ListMenuItem(view) {
            this.key = "ul";
            this.icon = "pillow-icon-bullets";
            this.nodeType = view.state.schema.nodes.bullet_list;
            this.wrapListCommand = prosemirror_schema_list_1.wrapInList(this.nodeType);
            this.liftListCommand = prosemirror_schema_list_1.liftListItem(view.state.schema.nodes.list_item)
        }
        ListMenuItem.prototype.getText = function() {
            return i18n.s("prosemirror-label-list")
        }
        ;
        ListMenuItem.prototype.isActive = function(state) {
            var _a = state.selection
                , $from = _a.$from
                , $to = _a.$to;
            var range = $from.blockRange($to);
            var rangeNode = range && $from.node(range.depth - 1);
            return !!(rangeNode && rangeNode.type === this.nodeType)
        }
        ;
        ListMenuItem.prototype.performCommand = function(state, dispatch) {
            if (this.isActive(state)) {
                return this.liftListCommand(state, dispatch)
            } else {
                return this.wrapListCommand(state, dispatch)
            }
        }
        ;
        return ListMenuItem
    }();
    exports.ListMenuItem = ListMenuItem;
    var ImgMenuItem = function() {
        function ImgMenuItem() {
            this.key = "img";
            this.icon = "pillow-icon-image"
        }
        ImgMenuItem.prototype.getText = function() {
            return i18n.s("prosemirror-label-image")
        }
        ;
        ImgMenuItem.prototype.isActive = function(_state) {
            return false
        }
        ;
        ImgMenuItem.prototype.performCommand = function(_state, _dispatch) {
            return true
        }
        ;
        return ImgMenuItem
    }();
    exports.ImgMenuItem = ImgMenuItem;
    var MenuItemView = function(_super) {
        tslib_1.__extends(MenuItemView, _super);
        function MenuItemView() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        MenuItemView.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("span", {
                class: function() {
                    var _a;
                    return _a = {
                        "prosemirror-menu-item": true
                    },
                        _a["menu-item-" + _this.props.item().key] = true,
                        _a["menu-item-mark"] = _this.props.item()instanceof MarkMenuItem,
                        _a["menu-item-font"] = _this.props.item()instanceof FontMenuItem,
                        _a["menu-item-block"] = _this.props.item()instanceof BlockMenuItem,
                        _a.active = _this.isActive(),
                        _a.disabled = _this.isDisabled(),
                        _a
                },
                onTap: function(evt) {
                    return _this.performAction(evt)
                }
            }, DCGView.createElement(tooltip_1.Tooltip, {
                disabled: function() {
                    return !_this.tooltip()
                },
                tooltip: function() {
                    return _this.tooltip()
                },
                gravity: function() {
                    return _this.props.item().gravity || "n"
                },
                class: this.const("tooltip-when-disabled"),
                tooltipDelay: this.const(0)
            }, DCGView.createElement(Switch, {
                key: function() {
                    return _this.props.item().icon
                }
            }, function(icon) {
                if (icon) {
                    return DCGView.createElement("i", {
                        class: _this.const(icon)
                    })
                } else {
                    return DCGView.createElement("span", null, function() {
                        return _this.props.item().getText()
                    })
                }
            })))
        }
        ;
        MenuItemView.prototype.isActive = function() {
            return this.props.item().isActive(this.props.editorView().state)
        }
        ;
        MenuItemView.prototype.tooltip = function() {
            var item = this.props.item();
            var canPerformAction = this.canPerformAction();
            if (item.tooltipWhenDisabled && !canPerformAction) {
                return item.tooltipWhenDisabled
            }
            if (item.tooltipWhenEnabled && canPerformAction) {
                return item.tooltipWhenEnabled
            }
            return undefined
        }
        ;
        MenuItemView.prototype.isDisabled = function() {
            return !this.canPerformAction() || this.props.disableAll()
        }
        ;
        MenuItemView.prototype.canPerformAction = function() {
            var view = this.props.editorView();
            return this.props.item().performCommand(view.state)
        }
        ;
        MenuItemView.prototype.performAction = function(evt) {
            if (this.isDisabled())
                return;
            if (this.props.item()instanceof ImgMenuItem) {
                this.props.controller().showImageModal();
                return
            }
            var view = this.props.editorView();
            view.focus();
            this.props.item().performCommand(view.state, view.dispatch);
            if (view.dispatch) {
                view.dispatch(view.state.tr.scrollIntoView())
            }
            evt.preventDefault()
        }
        ;
        return MenuItemView
    }(DCGView.Class);
    exports.MenuItemView = MenuItemView
});
define("loadcss!activitybuilder/components/shared/prosemirror/prosemirror-menu", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/activitybuilder/components/shared/prosemirror/prosemirror-menu.css", decodeURIComponent(".prosemirror-menu%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20right%3A%203px%3B%0A%20%20bottom%3A%203px%3B%0A%7D%0A.prosemirror-menu%20.prosemirror-menu-item%20%7B%0A%20%20width%3A%2034px%3B%0A%20%20height%3A%2034px%3B%0A%20%20border-radius%3A%2050%25%3B%0A%20%20background%3A%20%2315b097%3B%0A%20%20color%3A%20%23fff%3B%0A%20%20display%3A%20inline-block%3B%0A%20%20text-align%3A%20center%3B%0A%20%20line-height%3A%2036px%3B%0A%20%20font-size%3A%20125%25%3B%0A%7D%0A.prosemirror-menu%20.prosemirror-menu-item.dcg-hovered%20%7B%0A%20%20background%3A%20%23129e87%3B%0A%7D%0A.prosemirror-menu%20.prosemirror-menu-item.dcg-depressed%20%7B%0A%20%20background%3A%20%230f8371%3B%0A%7D%0A.pm-image-upload-modal-contents%20.image-drop-box%20%7B%0A%20%20height%3A%20100px%3B%0A%20%20max-width%3A%20300px%3B%0A%20%20margin%3A%2020px%20auto%3B%0A%7D%0A"))
});
define("loadcss!activitybuilder/components/shared/prosemirror/prosemirror-editing-menu", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/activitybuilder/components/shared/prosemirror/prosemirror-editing-menu.css", decodeURIComponent(".prosemirror-editing-menu%20%7B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20100%25%3B%0A%20%20background%3A%20%23f7f7f7%3B%0A%7D%0A.prosemirror-editing-menu%20.items-container%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20width%3A%20100%25%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-align%3A%20center%3B%0A%20%20-moz-box-align%3A%20center%3B%0A%20%20-o-box-align%3A%20center%3B%0A%20%20-ms-flex-align%3A%20center%3B%0A%20%20-webkit-align-items%3A%20center%3B%0A%20%20align-items%3A%20center%3B%0A%20%20-webkit-box-pack%3A%20center%3B%0A%20%20-moz-box-pack%3A%20center%3B%0A%20%20-o-box-pack%3A%20center%3B%0A%20%20-ms-flex-pack%3A%20center%3B%0A%20%20-webkit-justify-content%3A%20center%3B%0A%20%20justify-content%3A%20center%3B%0A%20%20text-align%3A%20center%3B%0A%20%20width%3A%2035px%3B%0A%20%20height%3A%2035px%3B%0A%20%20line-height%3A%2032px%3B%0A%20%20background%3A%20%23fff%3B%0A%20%20color%3A%20%23666%3B%0A%20%20border%3A%201px%20solid%20%23ccc%3B%0A%20%20position%3A%20relative%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.active%3Anot(.disabled)%20%7B%0A%20%20color%3A%20%23fff%3B%0A%20%20border-color%3A%20%23666%3B%0A%20%20background%3A%20%23666%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item%3Anot(.active)%3Anot(.disabled).dcg-hovered%20%7B%0A%20%20border-color%3A%20%23999%3B%0A%20%20color%3A%20%23333%3B%0A%20%20z-index%3A%201%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item%3Anot(.active)%3Anot(.disabled).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(0%2C0%2C0%2C0.03)%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.disabled%20%7B%0A%20%20opacity%3A%200.5%3B%0A%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D50)%22%3B%0A%20%20filter%3A%20alpha(opacity%3D50)%3B%0A%20%20cursor%3A%20default%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-mq%20%7B%0A%20%20border-radius%3A%205px%3B%0A%20%20margin-right%3A%204px%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-em%2C%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-strong%2C%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-ul%2C%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-link%20%7B%0A%20%20border-radius%3A%200%3B%0A%20%20margin-right%3A%20-1px%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-em.active%3Anot(.menu-item-em)%2C%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-strong.active%3Anot(.menu-item-em)%2C%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-ul.active%3Anot(.menu-item-em)%2C%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-link.active%3Anot(.menu-item-em)%20%7B%0A%20%20border-left-color%3A%20%23ccc%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-interp%20%7B%0A%20%20border-radius%3A%205px%3B%0A%20%20margin-left%3A%204px%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-interp%20.pillow-icon-interpolate%20%7B%0A%20%20font-size%3A%20120%25%3B%0A%20%20position%3A%20relative%3B%0A%20%20left%3A%201px%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-mq%20%7B%0A%20%20font-size%3A%20130%25%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-mq%3Aafter%20%7B%0A%20%20content%3A%20%22%22%3B%0A%20%20background%3A%20%23e2e2e2%3B%0A%20%20width%3A%208px%3B%0A%20%20height%3A%2010px%3B%0A%20%20position%3A%20absolute%3B%0A%20%20bottom%3A%209px%3B%0A%20%20right%3A%207px%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-em%20%7B%0A%20%20border-radius%3A%205px%200%200%205px%3B%0A%20%20font-style%3A%20italic%3B%0A%20%20font-family%3A%20%22Sanchez%22%2C%20%22Helvetica%20Neue%20Light%22%2C%20%22HelveticaNeue-Light%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-strong%20%7B%0A%20%20font-family%3A%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%20%20font-weight%3A%20600%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item.menu-item-link%20%7B%0A%20%20border-radius%3A%200%205px%205px%200%3B%0A%20%20font-size%3A%20130%25%3B%0A%7D%0A.prosemirror-editing-menu%20.prosemirror-menu-item%20.tooltip-when-disabled%20%7B%0A%20%20position%3A%20relative%3B%0A%20%20top%3A%200%3B%0A%20%20right%3A%200%3B%0A%20%20bottom%3A%200%3B%0A%20%20left%3A%200%3B%0A%20%20cursor%3A%20unset%20!important%3B%0A%7D%0A.prosemirror-editing-menu%20.interp-container%20%7B%0A%20%20margin-left%3A%20auto%3B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-align%3A%20center%3B%0A%20%20-moz-box-align%3A%20center%3B%0A%20%20-o-box-align%3A%20center%3B%0A%20%20-ms-flex-align%3A%20center%3B%0A%20%20-webkit-align-items%3A%20center%3B%0A%20%20align-items%3A%20center%3B%0A%7D%0A.prosemirror-editing-menu%20a.help-link%20%7B%0A%20%20color%3A%20%23666%3B%0A%20%20text-decoration%3A%20none%3B%0A%20%20margin-left%3A%204px%3B%0A%20%20font-size%3A%20110%25%3B%0A%20%20opacity%3A%200.9%3B%0A%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D90)%22%3B%0A%20%20filter%3A%20alpha(opacity%3D90)%3B%0A%7D%0A.prosemirror-editing-menu%20a.help-link.dcg-hovered%20%7B%0A%20%20opacity%3A%201%3B%0A%20%20-ms-filter%3A%20none%3B%0A%20%20filter%3A%20none%3B%0A%7D%0A.prosemirror-editing-menu%20a.help-link.dcg-depressed%20%7B%0A%20%20color%3A%20%234c4c4c%3B%0A%7D%0A"))
});
define("loadcss!activitybuilder/components/shared/prosemirror/prosemirror-format-menu", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/activitybuilder/components/shared/prosemirror/prosemirror-format-menu.css", decodeURIComponent(".prosemirror-format-menu.with-label%20%7B%0A%20%20padding%3A%205px%2010px%3B%0A%20%20min-height%3A%2045px%3B%0A%7D%0A.prosemirror-format-menu.with-label%20.menu-label%20%7B%0A%20%20color%3A%20%23666%3B%0A%20%20font-size%3A%2090%25%3B%0A%20%20-webkit-align-self%3A%20center%3B%0A%20%20align-self%3A%20center%3B%0A%20%20-ms-flex-item-align%3A%20center%3B%0A%20%20-webkit-box-flex%3A%201%3B%0A%20%20-moz-box-flex%3A%201%3B%0A%20%20-o-box-flex%3A%201%3B%0A%20%20box-flex%3A%201%3B%0A%20%20-webkit-flex%3A%201%3B%0A%20%20-ms-flex%3A%201%3B%0A%20%20flex%3A%201%3B%0A%7D%0A.prosemirror-format-menu.with-label%20.items-container%20%7B%0A%20%20-webkit-box-flex%3A%201%3B%0A%20%20-moz-box-flex%3A%201%3B%0A%20%20-o-box-flex%3A%201%3B%0A%20%20box-flex%3A%201%3B%0A%20%20-webkit-flex%3A%20auto%3B%0A%20%20-ms-flex%3A%20auto%3B%0A%20%20flex%3A%20auto%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item%2C%0A.prosemirror-format-menu%20.link-container%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20text-align%3A%20center%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-block%2C%0A.prosemirror-format-menu%20.link-container.menu-item-block%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mark%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mark%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-font%2C%0A.prosemirror-format-menu%20.link-container.menu-item-font%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-link%2C%0A.prosemirror-format-menu%20.link-container.menu-item-link%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mq%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mq%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-ul%2C%0A.prosemirror-format-menu%20.link-container.menu-item-ul%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-img%2C%0A.prosemirror-format-menu%20.link-container.menu-item-img%20%7B%0A%20%20vertical-align%3A%20middle%3B%0A%20%20width%3A%2040px%3B%0A%20%20height%3A%2035px%3B%0A%20%20line-height%3A%2035px%3B%0A%20%20color%3A%20%23666%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-block.disabled%2C%0A.prosemirror-format-menu%20.link-container.menu-item-block.disabled%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mark.disabled%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mark.disabled%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-link.disabled%2C%0A.prosemirror-format-menu%20.link-container.menu-item-link.disabled%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-ul.disabled%2C%0A.prosemirror-format-menu%20.link-container.menu-item-ul.disabled%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mq.disabled%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mq.disabled%20%7B%0A%20%20opacity%3A%200.5%3B%0A%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D50)%22%3B%0A%20%20filter%3A%20alpha(opacity%3D50)%3B%0A%20%20cursor%3A%20default%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-block.menu-item-strong%2C%0A.prosemirror-format-menu%20.link-container.menu-item-block.menu-item-strong%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mark.menu-item-strong%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mark.menu-item-strong%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-link.menu-item-strong%2C%0A.prosemirror-format-menu%20.link-container.menu-item-link.menu-item-strong%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-ul.menu-item-strong%2C%0A.prosemirror-format-menu%20.link-container.menu-item-ul.menu-item-strong%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mq.menu-item-strong%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mq.menu-item-strong%20%7B%0A%20%20font-family%3A%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%20%20font-weight%3A%20600%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-block.menu-item-em%2C%0A.prosemirror-format-menu%20.link-container.menu-item-block.menu-item-em%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mark.menu-item-em%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mark.menu-item-em%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-link.menu-item-em%2C%0A.prosemirror-format-menu%20.link-container.menu-item-link.menu-item-em%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-ul.menu-item-em%2C%0A.prosemirror-format-menu%20.link-container.menu-item-ul.menu-item-em%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mq.menu-item-em%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mq.menu-item-em%20%7B%0A%20%20font-style%3A%20italic%3B%0A%20%20font-family%3A%20%22Sanchez%22%2C%20%22Helvetica%20Neue%20Light%22%2C%20%22HelveticaNeue-Light%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-block.menu-item-em%20span%2C%0A.prosemirror-format-menu%20.link-container.menu-item-block.menu-item-em%20span%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mark.menu-item-em%20span%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mark.menu-item-em%20span%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-link.menu-item-em%20span%2C%0A.prosemirror-format-menu%20.link-container.menu-item-link.menu-item-em%20span%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-ul.menu-item-em%20span%2C%0A.prosemirror-format-menu%20.link-container.menu-item-ul.menu-item-em%20span%2C%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mq.menu-item-em%20span%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mq.menu-item-em%20span%20%7B%0A%20%20position%3A%20relative%3B%0A%20%20left%3A%20-1px%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mark%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mark%20%7B%0A%20%20font-size%3A%20120%25%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-link%2C%0A.prosemirror-format-menu%20.link-container.menu-item-link%20%7B%0A%20%20font-size%3A%20140%25%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-link%20i%2C%0A.prosemirror-format-menu%20.link-container.menu-item-link%20i%20%7B%0A%20%20position%3A%20relative%3B%0A%20%20top%3A%201px%3B%0A%20%20left%3A%201px%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-font%2C%0A.prosemirror-format-menu%20.link-container.menu-item-font%20%7B%0A%20%20font-family%3A%20%22Sanchez%22%2C%20%22Helvetica%20Neue%20Light%22%2C%20%22HelveticaNeue-Light%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%20%20border%3A%201px%20solid%20%23ccc%3B%0A%20%20border-right%3A%200%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-font.disabled%3Anot(.active)%2C%0A.prosemirror-format-menu%20.link-container.menu-item-font.disabled%3Anot(.active)%20%7B%0A%20%20opacity%3A%200.5%3B%0A%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D50)%22%3B%0A%20%20filter%3A%20alpha(opacity%3D50)%3B%0A%20%20cursor%3A%20default%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-font.menu-item-small%2C%0A.prosemirror-format-menu%20.link-container.menu-item-font.menu-item-small%20%7B%0A%20%20margin-left%3A%205px%3B%0A%20%20font-size%3A%20100%25%3B%0A%20%20border-radius%3A%203px%200%200%203px%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-font.menu-item-medium%2C%0A.prosemirror-format-menu%20.link-container.menu-item-font.menu-item-medium%20%7B%0A%20%20font-size%3A%20130%25%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-font.menu-item-large%2C%0A.prosemirror-format-menu%20.link-container.menu-item-font.menu-item-large%20%7B%0A%20%20font-size%3A%20160%25%3B%0A%20%20margin-right%3A%205px%3B%0A%20%20border-radius%3A%200%203px%203px%200%3B%0A%20%20border-right%3A%201px%20solid%20%23ccc%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-font.menu-item-large.active%2C%0A.prosemirror-format-menu%20.link-container.menu-item-font.menu-item-large.active%20%7B%0A%20%20border-right%3A%201px%20solid%20%23666%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-font.active%2C%0A.prosemirror-format-menu%20.link-container.menu-item-font.active%20%7B%0A%20%20pointer-events%3A%20none%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mq%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mq%20%7B%0A%20%20font-size%3A%20150%25%3B%0A%7D%0A.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mq%20i%2C%0A.prosemirror-format-menu%20.link-container.menu-item-mq%20i%20%7B%0A%20%20position%3A%20relative%3B%0A%20%20left%3A%20-1px%3B%0A%20%20top%3A%202px%3B%0A%7D%0A%3Anot(.alignment-editor)%20.prosemirror-format-menu%20%7B%0A%20%20border%3A%201px%20solid%20%23ccc%3B%0A%20%20border-bottom%3A%200%3B%0A%20%20display%3A%20inline-block%3B%0A%20%20border-radius%3A%203px%203px%200%200%3B%0A%7D%0A%3Anot(.alignment-editor)%20.prosemirror-format-menu%20.items-container%20span%3Alast-child%20%7B%0A%20%20border-right%3A%200px%3B%0A%7D%0A%3Anot(.alignment-editor)%20.prosemirror-format-menu%20.prosemirror-menu-item%20%7B%0A%20%20border-right%3A%201px%20solid%20%23ccc%3B%0A%7D%0A%3Anot(.alignment-editor)%20.prosemirror-format-menu%20.prosemirror-menu-item.active%20%7B%0A%20%20background%3A%20%23e2e2e2%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0A%3Anot(.alignment-editor)%20.prosemirror-format-menu%20.prosemirror-menu-item%3Anot(.disabled)%3Anot(.active).dcg-hovered%20%7B%0A%20%20background%3A%20%23eee%3B%0A%7D%0A%3Anot(.alignment-editor)%20.prosemirror-format-menu%20.prosemirror-menu-item%3Anot(.disabled)%3Anot(.active).dcg-depressed%20%7B%0A%20%20background%3A%20%23bbb%3B%0A%7D%0A.alignment-editor%20.prosemirror-format-menu%20%7B%0A%20%20width%3A%20100%25%3B%0A%20%20background%3A%20rgba(255%2C255%2C255%2C0.9)%3B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-pack%3A%20center%3B%0A%20%20-moz-box-pack%3A%20center%3B%0A%20%20-o-box-pack%3A%20center%3B%0A%20%20-ms-flex-pack%3A%20center%3B%0A%20%20-webkit-justify-content%3A%20center%3B%0A%20%20justify-content%3A%20center%3B%0A%7D%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-block%2C%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mark%2C%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-link%2C%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mq%2C%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-font%2C%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-ul%20%7B%0A%20%20background%3A%20%23f7f7f7%3B%0A%7D%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-block%2C%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mark%2C%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-link%2C%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-mq%2C%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.menu-item-ul%20%7B%0A%20%20margin%3A%200%205px%3B%0A%20%20border-radius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23ccc%3B%0A%7D%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item.active%20%7B%0A%20%20background%3A%20%23777%3B%0A%20%20color%3A%20%23fff%3B%0A%20%20border-color%3A%20%23666%3B%0A%7D%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item%3Anot(.disabled)%3Anot(.active).dcg-hovered%20%7B%0A%20%20background%3A%20%23e2e2e2%3B%0A%7D%0A.alignment-editor%20.prosemirror-format-menu%20.prosemirror-menu-item%3Anot(.disabled)%3Anot(.active).dcg-depressed%20%7B%0A%20%20background%3A%20%23bbb%3B%0A%7D%0A"))
});
define("activitybuilder/components/shared/prosemirror/prosemirror-menu", ["require", "exports", "tslib", "dcgview", "lib/i18n", "./link-menu-item", "./interp-menu-item", "./menu-item", "shared/dcgviews/tooltip", "loadcss!./prosemirror-menu", "loadcss!./prosemirror-editing-menu", "loadcss!./prosemirror-format-menu"], function(require, exports, tslib_1, DCGView, i18n, link_menu_item_1, interp_menu_item_1, menu_item_1, tooltip_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , For = _a.For
        , If = _a.If
        , Switch = _a.Switch;
    var defaultMenuOptions = {
        h1: {
            enable: true
        },
        h2: {
            enable: true
        },
        h3: {
            enable: false
        },
        p: {
            enable: false
        },
        link: {
            enable: false
        },
        mq: {
            enable: true
        },
        interp: {
            enable: false
        },
        em: {
            enable: true
        },
        strong: {
            enable: true
        },
        small: {
            enable: true
        },
        medium: {
            enable: true
        },
        large: {
            enable: true
        },
        ul: {
            enable: false
        },
        img: {
            enable: false
        }
    };
    var ProseMirrorMenuController = function() {
        function ProseMirrorMenuController(resources, editorView, partialMenuOptions, menuOrder, getInterpExprs) {
            var _this = this;
            this.dispatch = resources.dispatch;
            this.menuItemKeys = [];
            this.menuItems = {};
            var menuOptions = tslib_1.__assign(tslib_1.__assign({}, defaultMenuOptions), partialMenuOptions);
            var schemaNodes = editorView.state.schema.nodes;
            var schemaMarks = editorView.state.schema.marks;
            if (menuOptions["interp"].enable && getInterpExprs) {
                this.menuItems["interp"] = new interp_menu_item_1.InterpMenuItem(getInterpExprs)
            }
            if (menuOptions["p"].enable) {
                this.menuItems.p = new menu_item_1.BlockMenuItem({
                    key: "p",
                    text: menuOptions["p"] && menuOptions["p"].label || i18n.raw("p"),
                    nodeType: schemaNodes.paragraph
                },editorView)
            }
            if (schemaNodes.heading != undefined && menuOptions["h1"].enable) {
                this.menuItems.h1 = new menu_item_1.BlockMenuItem({
                    key: "h1",
                    text: menuOptions["h1"] && menuOptions["h1"].label || i18n.raw("H1"),
                    nodeType: schemaNodes.heading,
                    attrs: {
                        level: 1
                    }
                },editorView)
            }
            if (schemaNodes.heading != undefined && menuOptions["h2"].enable) {
                this.menuItems.h2 = new menu_item_1.BlockMenuItem({
                    key: "h2",
                    text: menuOptions["h2"] && menuOptions["h2"].label || i18n.raw("H2"),
                    nodeType: schemaNodes.heading,
                    attrs: {
                        level: 2
                    }
                },editorView)
            }
            if (schemaNodes.heading != undefined && menuOptions["h3"].enable) {
                this.menuItems.h3 = new menu_item_1.BlockMenuItem({
                    key: "h3",
                    text: menuOptions["h3"] && menuOptions["h3"].label || i18n.raw("H3"),
                    nodeType: schemaNodes.heading,
                    attrs: {
                        level: 3
                    }
                },editorView)
            }
            if (schemaMarks.medium != undefined && menuOptions["medium"].enable) {
                this.menuItems.small = new menu_item_1.FontMenuItem({
                    key: "small",
                    text: i18n.raw("T")
                });
                this.menuItems.medium = new menu_item_1.FontMenuItem({
                    key: "medium",
                    text: i18n.raw("T"),
                    markType: schemaMarks.medium
                })
            }
            if (schemaMarks.large != undefined && menuOptions["large"].enable) {
                this.menuItems.large = new menu_item_1.FontMenuItem({
                    key: "large",
                    text: i18n.raw("T"),
                    markType: schemaMarks.large
                })
            }
            if (schemaMarks.em != undefined && menuOptions["em"].enable) {
                this.menuItems.em = new menu_item_1.MarkMenuItem({
                    key: "em",
                    text: i18n.raw("I"),
                    markType: schemaMarks.em
                })
            }
            if (schemaMarks.strong != undefined && menuOptions["strong"].enable) {
                this.menuItems.strong = new menu_item_1.MarkMenuItem({
                    key: "strong",
                    text: i18n.raw("B"),
                    markType: schemaMarks.strong
                })
            }
            if (schemaMarks.link !== undefined && menuOptions["link"].enable) {
                this.menuItems.link = new link_menu_item_1.LinkMenuItem(editorView)
            }
            if (menuOptions["ul"].enable) {
                this.menuItems.ul = new menu_item_1.ListMenuItem(editorView)
            }
            if (menuOptions["img"].enable) {
                this.menuItems.img = new menu_item_1.ImgMenuItem
            }
            this.menuItems.mq = new menu_item_1.MqMenuItem(this.getMenuType());
            this.menuItemKeys = Object.keys(defaultMenuOptions).filter(function(key) {
                return !!_this.menuItems[key]
            });
            if (menuOrder) {
                this.menuItemKeys = menuOrder.filter(function(item) {
                    return _this.menuItemKeys.indexOf(item) !== -1
                })
            }
        }
        ProseMirrorMenuController.prototype.getMenuItems = function() {
            return this.menuItemKeys
        }
        ;
        ProseMirrorMenuController.prototype.showImageModal = function() {
            this.imageModalVisible = true;
            this.dispatch({
                type: "update-all"
            })
        }
        ;
        ProseMirrorMenuController.prototype.hideImageModal = function() {
            this.imageModalVisible = false;
            this.dispatch({
                type: "update-all"
            })
        }
        ;
        ProseMirrorMenuController.prototype.getMenuType = function() {
            if (Object.keys(this.menuItems).every(function(item) {
                return item === "mq"
            })) {
                return "mq-only"
            } else if ("interp"in this.menuItems) {
                return "editing"
            } else {
                return "formatting"
            }
        }
        ;
        return ProseMirrorMenuController
    }();
    exports.ProseMirrorMenuController = ProseMirrorMenuController;
    var ProseMirrorMenu = function(_super) {
        tslib_1.__extends(ProseMirrorMenu, _super);
        function ProseMirrorMenu() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ProseMirrorMenu.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(If, {
                predicate: function() {
                    return _this.showMenu()
                }
            }, function() {
                return DCGView.createElement("div", {
                    class: function() {
                        return {
                            "prosemirror-menu": _this.props.controller().getMenuType() === "mq-only",
                            "prosemirror-editing-menu": _this.props.controller().getMenuType() === "editing",
                            "prosemirror-format-menu": _this.props.controller().getMenuType() === "formatting",
                            "with-label": !!_this.props.label
                        }
                    },
                    didMount: _this.bindFn(_this.didMount),
                    willUnmount: _this.bindFn(_this.willUnmount)
                }, DCGView.createElement(If, {
                    predicate: function() {
                        return !!_this.props.label
                    }
                }, function() {
                    return DCGView.createElement("div", {
                        class: DCGView.const("menu-label")
                    }, _this.const(_this.props.label()))
                }), DCGView.createElement(If, {
                    predicate: function() {
                        return _this.showMenuItems()
                    }
                }, function() {
                    return DCGView.createElement(For, {
                        each: function() {
                            return _this.props.controller().getMenuItems()
                        }
                    }, DCGView.createElement("div", {
                        class: DCGView.const("items-container")
                    }, function(itemKey) {
                        return DCGView.createElement(Switch, {
                            key: function() {
                                return itemKey
                            }
                        }, function(itemKey) {
                            if (itemKey === "link") {
                                return DCGView.createElement("div", {
                                    class: DCGView.const("link-container")
                                }, DCGView.createElement(menu_item_1.MenuItemView, {
                                    item: function() {
                                        return _this.props.controller().menuItems[itemKey]
                                    },
                                    editorView: _this.props.editorView,
                                    controller: _this.props.controller,
                                    disableAll: function() {
                                        return _this.interpEditingIsActive()
                                    }
                                }), DCGView.createElement(link_menu_item_1.LinkEditView, {
                                    controller: function() {
                                        return _this.props.controller().menuItems["link"]
                                    },
                                    visible: function() {
                                        return _this.props.controller().menuItems["link"].promptActive
                                    },
                                    onClose: function() {
                                        _this.props.controller().menuItems["link"].promptActive = false;
                                        _this.update()
                                    }
                                }))
                            } else if (itemKey === "interp") {
                                return DCGView.createElement("div", {
                                    class: DCGView.const("interp-container")
                                }, DCGView.createElement(tooltip_1.Tooltip, {
                                    tooltip: function() {
                                        return i18n.s("ab-edit-button-learn-more")
                                    },
                                    gravity: _this.const("n"),
                                    tooltipDelay: _this.const(0)
                                }, DCGView.createElement("a", {
                                    class: DCGView.const("help-link"),
                                    "aria-label": function() {
                                        return i18n.s("ab-edit-button-learn-more")
                                    },
                                    href: function() {
                                        return "//learn.desmos.com/notes"
                                    },
                                    target: DCGView.const("_blank")
                                }, DCGView.createElement("i", {
                                    class: DCGView.const("pillow-icon-question-sign")
                                }))), DCGView.createElement(menu_item_1.MenuItemView, {
                                    item: function() {
                                        return _this.props.controller().menuItems[itemKey]
                                    },
                                    editorView: _this.props.editorView,
                                    controller: _this.props.controller,
                                    disableAll: function() {
                                        return _this.interpEditingIsActive()
                                    }
                                }))
                            } else {
                                return DCGView.createElement(menu_item_1.MenuItemView, {
                                    item: function() {
                                        return _this.props.controller().menuItems[itemKey]
                                    },
                                    editorView: _this.props.editorView,
                                    controller: _this.props.controller,
                                    disableAll: function() {
                                        return _this.interpEditingIsActive()
                                    }
                                })
                            }
                        })
                    }))
                }))
            })
        }
        ;
        ProseMirrorMenu.prototype.didMount = function(node) {
            var _this = this;
            this.dom = node;
            this.removeToken = this.props.subManager().add(function(_tr) {
                _this.update()
            })
        }
        ;
        ProseMirrorMenu.prototype.willUnmount = function() {
            this.removeToken()
        }
        ;
        ProseMirrorMenu.prototype.showMenuItems = function() {
            if (this.props.staticMenu()) {
                return true
            } else {
                return this.props.hasFocus() || this.linkPromptIsActive()
            }
        }
        ;
        ProseMirrorMenu.prototype.linkPromptIsActive = function() {
            var linkItem = this.props.controller().menuItems["link"];
            return !!linkItem && linkItem.promptActive
        }
        ;
        ProseMirrorMenu.prototype.interpEditingIsActive = function() {
            var focused = document.activeElement;
            if (!focused)
                return false;
            return this.props.hasFocus() && focused.classList.contains("interp-node-input")
        }
        ;
        ProseMirrorMenu.prototype.showMenu = function() {
            return this.showMenuItems() || !!this.props.label
        }
        ;
        return ProseMirrorMenu
    }(DCGView.Class);
    exports.ProseMirrorMenu = ProseMirrorMenu
});
define("core/computation-layer/cl-types", ["require", "exports", "tslib"], function(require, exports, tslib_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function makeDummyNamedTypeForTestsOnly(name) {
        return CLType.create(name)
    }
    exports.makeDummyNamedTypeForTestsOnly = makeDummyNamedTypeForTestsOnly;
    function isEmpty(params) {
        if (!params) {
            return true
        }
        return Object.keys(params).length == 0
    }
    function reinflateType(_a) {
        var type = _a.type
            , params = _a.params;
        if (exports.Types.hasOwnProperty(type) && isEmpty(params))
            return exports.Types[type];
        if (type == "function") {
            return getFunctionType(params)
        }
        if (type == "component") {
            return getComponentType(params)
        }
        if (type == "componentScript") {
            return getComponentScriptType(params)
        }
        throw new Error("Asked to inflate unexpected type " + type + " with params " + JSON.stringify(params))
    }
    exports.reinflateType = reinflateType;
    function reinflateSinkTypes(deflatedSinks) {
        var sinks = {};
        for (var sinkName in deflatedSinks) {
            sinks[sinkName] = [];
            for (var _i = 0, _a = deflatedSinks[sinkName]; _i < _a.length; _i++) {
                var deflatedSink = _a[_i];
                sinks[sinkName].push(tslib_1.__assign(tslib_1.__assign({}, deflatedSink), {
                    valueType: reinflateType(deflatedSink.valueType)
                }))
            }
        }
        return sinks
    }
    exports.reinflateSinkTypes = reinflateSinkTypes;
    var CLType = function() {
        function CLType(type) {
            this.type = type
        }
        CLType.prototype.matches = function(other) {
            if (other == undefined)
                throw new Error("Cannot type-check against undefined");
            if (!(other instanceof CLType))
                throw new Error("Cannot type-check against non CLType object" + JSON.stringify(other, null, 2));
            return this === other
        }
        ;
        CLType.prototype.toString = function() {
            if (this.params == undefined)
                return this.type;
            return this.type + "<" + JSON.stringify(this.params) + ">"
        }
        ;
        CLType.create = function(type) {
            if (!this.typeCache[type]) {
                this.typeCache[type] = new CLType(type)
            }
            return this.typeCache[type]
        }
        ;
        CLType.typeCache = {};
        return CLType
    }();
    exports.CLType = CLType;
    var FunctionType = function(_super) {
        tslib_1.__extends(FunctionType, _super);
        function FunctionType(params) {
            var _this = _super.call(this, "function") || this;
            _this.params = params;
            return _this
        }
        FunctionType.get = function(params) {
            var n = params.numVars;
            if (this.functionTypeCache[n] == undefined) {
                this.functionTypeCache[n] = new FunctionType(params)
            }
            return this.functionTypeCache[n]
        }
        ;
        FunctionType.functionTypeCache = {
            1: new FunctionType({
                numVars: 1
            }),
            2: new FunctionType({
                numVars: 2
            })
        };
        return FunctionType
    }(CLType);
    exports.FunctionType = FunctionType;
    function getFunctionType(params) {
        return FunctionType.get(params)
    }
    exports.getFunctionType = getFunctionType;
    var ComponentType = function(_super) {
        tslib_1.__extends(ComponentType, _super);
        function ComponentType(params) {
            var _this = _super.call(this, "component") || this;
            _this.params = params;
            return _this
        }
        ComponentType.get = function(params) {
            var componentId = params.componentId;
            if (this.componentTypeCache[componentId] == undefined) {
                this.componentTypeCache[componentId] = new ComponentType(params)
            }
            return this.componentTypeCache[componentId]
        }
        ;
        ComponentType.componentTypeCache = {};
        return ComponentType
    }(CLType);
    exports.ComponentType = ComponentType;
    function getComponentType(params) {
        return ComponentType.get(params)
    }
    exports.getComponentType = getComponentType;
    var ComponentScriptType = function(_super) {
        tslib_1.__extends(ComponentScriptType, _super);
        function ComponentScriptType(params) {
            var _this = _super.call(this, "componentScript") || this;
            _this.params = params;
            return _this
        }
        ComponentScriptType.get = function(params) {
            var componentId = params.componentId;
            if (this.componentScriptTypeCache[componentId] == undefined) {
                this.componentScriptTypeCache[componentId] = new ComponentScriptType(params)
            }
            return this.componentScriptTypeCache[componentId]
        }
        ;
        ComponentScriptType.componentScriptTypeCache = {};
        return ComponentScriptType
    }(CLType);
    exports.ComponentScriptType = ComponentScriptType;
    function getComponentScriptType(params) {
        return ComponentScriptType.get(params)
    }
    exports.getComponentScriptType = getComponentScriptType;
    exports.Types = {
        number: CLType.create("number"),
        string: CLType.create("string"),
        latex: CLType.create("latex"),
        bounds: CLType.create("bounds"),
        boundsStrategy: CLType.create("boundsStrategy"),
        layer: CLType.create("layer"),
        xyLine: CLType.create("xyLine"),
        orderedPair: CLType.create("orderedPair"),
        equation: CLType.create("equation"),
        inequality: CLType.create("inequality"),
        boolean: CLType.create("boolean"),
        color: CLType.create("color"),
        colorPalette: CLType.create("colorPalette"),
        colorList: CLType.create("colorList"),
        sketch: CLType.create("sketch"),
        numberList: CLType.create("numberList"),
        function1: getFunctionType({
            numVars: 1
        }),
        function2: getFunctionType({
            numVars: 2
        }),
        calculatorStateWithSinkValues: CLType.create("calculatorStateWithSinkValues"),
        randomGenerator: CLType.create("randomGenerator"),
        response: CLType.create("response"),
        sketchTool: CLType.create("sketchTool"),
        sketchTools: CLType.create("sketchTools"),
        buttonStyle: CLType.create("buttonStyle"),
        buttonStyles: CLType.create("buttonStyles"),
        patternLibrary: CLType.create("patternLibrary"),
        numberPattern: CLType.create("numberPattern"),
        numberPatternMatch: CLType.create("numberPatternMatch"),
        mixedNumberPattern: CLType.create("mixedNumberPattern"),
        mixedNumberPatternMatch: CLType.create("mixedNumberPatternMatch"),
        literalPattern: CLType.create("literalPattern"),
        literalPatternMatch: CLType.create("literalPatternMatch"),
        expressionPattern: CLType.create("expressionPattern"),
        expressionPatternMatch: CLType.create("expressionPatternMatch"),
        orPattern: CLType.create("orPattern"),
        orPatternMatch: CLType.create("orPatternMatch"),
        scientificPattern: CLType.create("scientificPattern"),
        scientificPatternMatch: CLType.create("scientificPatternMatch"),
        partialInterpolation: CLType.create("partialInterpolation")
    };
    function assertType(target, type, message) {
        if (target.matches(type))
            return;
        throw new Error(message || "Expected " + target.toString() + ", but got " + type.toString())
    }
    exports.assertType = assertType
});
define("core/computation-layer/helpers", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function listExportKeys(runtime) {
        var keys = [];
        var allSinks = runtime.sinks;
        for (var componentId in allSinks) {
            var sinks = allSinks[componentId];
            for (var _i = 0, _a = ["exportString", "exportNumber", "exportNumberList"]; _i < _a.length; _i++) {
                var sinkName = _a[_i];
                if (sinks[sinkName]) {
                    for (var _b = 0, _c = sinks[sinkName]; _b < _c.length; _b++) {
                        var sink = _c[_b];
                        keys.push({
                            componentId: componentId,
                            exportKey: sink.params[0],
                            sinkName: sinkName
                        })
                    }
                }
            }
        }
        return keys
    }
    exports.listExportKeys = listExportKeys;
    var contentSynthesisCache = new WeakMap;
    function synthesizeStringForContent(str) {
        var cachedSynthesis = contentSynthesisCache.get(str);
        if (cachedSynthesis != undefined) {
            return cachedSynthesis
        }
        var out = "";
        var backtickCount = 0;
        for (var partIdx = 0; partIdx < str.parts.length; partIdx += 1) {
            var part = str.parts[partIdx];
            if (part == undefined || typeof part == "number" && isNaN(part)) {
                out += "undefined"
            } else if (isCLLatexType(part)) {
                if (backtickCount % 2 == 1) {
                    out += part.latex
                } else {
                    out += "`" + part.latex + "`";
                    backtickCount += 2
                }
            } else {
                var partStr = part.toString();
                for (var _i = 0, partStr_1 = partStr; _i < partStr_1.length; _i++) {
                    var char = partStr_1[_i];
                    if (char == "`") {
                        backtickCount += 1
                    }
                }
                out += partStr
            }
        }
        contentSynthesisCache.set(str, out);
        return out
    }
    exports.synthesizeStringForContent = synthesizeStringForContent;
    var interalSynthesisCache = new WeakMap;
    function synthesizeStringInternal(str) {
        var cachedSynthesis = interalSynthesisCache.get(str);
        if (cachedSynthesis != undefined) {
            return cachedSynthesis
        }
        var out = "";
        for (var _i = 0, _a = str.parts; _i < _a.length; _i++) {
            var part = _a[_i];
            if (isCLLatexType(part)) {
                out += part.latex
            } else if (part == undefined && typeof part == "number" && isNaN(part)) {
                out += "undefined"
            } else {
                out += part
            }
        }
        interalSynthesisCache.set(str, out);
        return out
    }
    exports.synthesizeStringInternal = synthesizeStringInternal;
    function isCLStringType(x) {
        if (x == undefined) {
            return false
        }
        return x.type == "string"
    }
    exports.isCLStringType = isCLStringType;
    function isCLLatexType(x) {
        if (x == undefined) {
            return false
        }
        return x.latex != undefined
    }
    exports.isCLLatexType = isCLLatexType
});
(function(e, t) {
        if (typeof define === "function" && define.amd) {
            define("core/lib/mathtools", [], t)
        } else {
            e.mathtools = t()
        }
    }
)(this, function() {
    var e, t, _;
    !function(p) {
        var a, o, f, h, d = {}, m = {}, g = {}, y = {}, r = Object.prototype.hasOwnProperty, n = [].slice;
        function v(e, t) {
            return r.call(e, t)
        }
        function s(e, t) {
            var r, n, i, a, o, s, u, c, l, p, f = t && t.split("/"), h = g.map, d = h && h["*"] || {};
            if (e && "." === e.charAt(0))
                if (t) {
                    for (e = (f = f.slice(0, f.length - 1)).concat(e.split("/")),
                             c = 0; c < e.length; c += 1)
                        if ("." === (p = e[c]))
                            e.splice(c, 1),
                                --c;
                        else if (".." === p) {
                            if (1 === c && (".." === e[2] || ".." === e[0]))
                                break;
                            0 < c && (e.splice(c - 1, 2),
                                c -= 2)
                        }
                    e = e.join("/")
                } else
                    0 === e.indexOf("./") && (e = e.substring(2));
            if ((f || d) && h) {
                for (c = (r = e.split("/")).length; 0 < c; --c) {
                    if (n = r.slice(0, c).join("/"),
                        f)
                        for (l = f.length; 0 < l; --l)
                            if (i = (i = h[f.slice(0, l).join("/")]) && i[n]) {
                                a = i,
                                    o = c;
                                break
                            }
                    if (a)
                        break;
                    !s && d && d[n] && (s = d[n],
                        u = c)
                }
                !a && s && (a = s,
                    o = u),
                a && (r.splice(0, o, a),
                    e = r.join("/"))
            }
            return e
        }
        function b(e, t) {
            return function() {
                return o.apply(p, n.call(arguments, 0).concat([e, t]))
            }
        }
        function x(e) {
            var t;
            if (v(m, e) && (t = m[e],
                delete m[e],
                y[e] = !0,
                a.apply(p, t)),
            !v(d, e) && !v(y, e))
                throw new Error("No " + e);
            return d[e]
        }
        function u(e) {
            var t, r = e ? e.indexOf("!") : -1;
            return -1 < r && (t = e.substring(0, r),
                e = e.substring(r + 1, e.length)),
                [t, e]
        }
        f = function(e, t) {
            var r, n, i = u(e), a = i[0];
            return e = i[1],
            a && (r = x(a = s(a, t))),
                a ? e = r && r.normalize ? r.normalize(e, (n = t,
                        function(e) {
                            return s(e, n)
                        }
                )) : s(e, t) : (a = (i = u(e = s(e, t)))[0],
                    e = i[1],
                a && (r = x(a))),
                {
                    f: a ? a + "!" + e : e,
                    n: e,
                    pr: a,
                    p: r
                }
        }
            ,
            h = {
                require: function(e) {
                    return b(e)
                },
                exports: function(e) {
                    var t = d[e];
                    return void 0 !== t ? t : d[e] = {}
                },
                module: function(e) {
                    return {
                        id: e,
                        uri: "",
                        exports: d[e],
                        config: (t = e,
                                function() {
                                    return g && g.config && g.config[t] || {}
                                }
                        )
                    };
                    var t
                }
            },
            a = function(e, t, r, n) {
                var i, a, o, s, u, c, l = [];
                if (n = n || e,
                "function" == typeof r) {
                    for (t = !t.length && r.length ? ["require", "exports", "module"] : t,
                             u = 0; u < t.length; u += 1)
                        if ("require" === (a = (s = f(t[u], n)).f))
                            l[u] = h.require(e);
                        else if ("exports" === a)
                            l[u] = h.exports(e),
                                c = !0;
                        else if ("module" === a)
                            i = l[u] = h.module(e);
                        else if (v(d, a) || v(m, a) || v(y, a))
                            l[u] = x(a);
                        else {
                            if (!s.p)
                                throw new Error(e + " missing " + a);
                            s.p.load(s.n, b(n, !0), function(t) {
                                return function(e) {
                                    d[t] = e
                                }
                            }(a), {}),
                                l[u] = d[a]
                        }
                    o = r.apply(d[e], l),
                    e && (i && i.exports !== p && i.exports !== d[e] ? d[e] = i.exports : o === p && c || (d[e] = o))
                } else
                    e && (d[e] = r)
            }
            ,
            e = t = o = function(e, t, r, n, i) {
                return "string" == typeof e ? h[e] ? h[e](t) : x(f(e, t).f) : (e.splice || (g = e,
                    t.splice ? (e = t,
                        t = r,
                        r = null) : e = p),
                    t = t || function() {}
                    ,
                "function" == typeof r && (r = n,
                    n = i),
                    n ? a(p, e, t, r) : setTimeout(function() {
                        a(p, e, t, r)
                    }, 4),
                    o)
            }
            ,
            o.config = function(e) {
                return (g = e).deps && o(g.deps, g.callback),
                    o
            }
            ,
            (_ = function(e, t, r) {
                    t.splice || (r = t,
                        t = []),
                    v(d, e) || v(m, e) || (m[e] = [e, t, r])
                }
            ).amd = {
                jQuery: !0
            }
    }(),
    "undefined" != typeof ALMOND_OVERRIDES && ALMOND_OVERRIDES && (_ = ALMOND_OVERRIDES.define || _,
        t = ALMOND_OVERRIDES.require || t,
        e = ALMOND_OVERRIDES.requirejs || e);
    _("core/vendor/almond", function() {});
    _("core/lib/worker-i18n", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.s = void 0,
            t.s = function(e, t) {
                return {
                    key: e,
                    vars: t
                }
            }
    });
    _("pjs", [], function() {
        var u, c, l;
        function p(e) {
            return "object" == typeof e
        }
        function f(e) {
            return "function" == typeof e
        }
        function h() {}
        return u = "prototype",
            c = {}.hasOwnProperty,
            function t(r, e) {
                function n() {
                    var e = new i;
                    return f(e.init) && e.init.apply(e, arguments),
                        e
                }
                function i() {}
                e === l && (e = r,
                    r = Object),
                    n.Bare = i;
                var a, o = h[u] = r[u], s = i[u] = n[u] = new h;
                return (s.constructor = n).mixin = function(e) {
                    return i[u] = n[u] = t(n, e)[u],
                        n
                }
                    ,
                    (n.open = function(e) {
                            if (a = {},
                                f(e) ? a = e.call(n, s, o, n, r) : p(e) && (a = e),
                                p(a))
                                for (var t in a)
                                    c.call(a, t) && (s[t] = a[t]);
                            return f(s.init) || (s.init = r),
                                n
                        }
                    )(e)
            }
    });
    _("core/math/mathshim", ["require"], function(e) {
        "use strict";
        var n = {};
        return n.cosh = Math.cosh || function(e) {
            return .5 * (Math.exp(e) + Math.exp(-e))
        }
            ,
            n.sinh = Math.sinh && 0 !== Math.sinh(1e-20) ? Math.sinh : function(e) {
                var t = 0 < e ? 1 : -1;
                return e = 0 < e ? e : -e,
                .5 * -t * Math.exp(e) * n.expm1(-2 * e)
            }
            ,
            n.tanh = Math.tanh && 0 !== Math.tanh(1e-20) ? Math.tanh : function(e) {
                var t = 0 < e ? 1 : -1;
                e = 0 < e ? e : -e;
                var r = n.expm1(-2 * e);
                return -t * r / (2 + r)
            }
            ,
            n.acosh = Math.acosh || function(e) {
                return e < 1 ? NaN : Math.log(e + n.sqrtxsqm1(e))
            }
            ,
            n.asinh = Math.asinh && 0 !== Math.asinh(1e-20) ? Math.asinh : function(e) {
                var t = 0 < e ? 1 : -1;
                return 1 + (e = 0 < e ? e : -e) * e == 1 ? t * n.log1p(e) : t * Math.log(e + n.sqrtxsqp1(e))
            }
            ,
            n.atanh = Math.atanh && 0 !== Math.atanh(1e-20) ? Math.atanh : function(e) {
                return .5 * (n.log1p(e) - n.log1p(-e))
            }
            ,
            n.expm1 = Math.expm1 || function(e) {
                return e + .5 * e * e === e ? e : Math.exp(e) - 1
            }
            ,
            n.log1p = Math.log1p || function(e) {
                return e - .5 * e * e === e ? e : Math.log(1 + e)
            }
            ,
            n.sqrtxsqp1 = function(e) {
                var t = e * e;
                return 1 + t == 1 ? 1 : 1 + t == t ? Math.abs(e) : Math.sqrt(1 + t)
            }
            ,
            n.sqrtxsqm1 = function(e) {
                var t = e * e;
                return t < 1 ? NaN : t - 1 == t ? Math.abs(e) : Math.sqrt(t - 1)
            }
            ,
            n
    });
    _("core/math/distance", ["require", "exports"], function(e, l) {
        "use strict";
        Object.defineProperty(l, "__esModule", {
            value: !0
        }),
            l.approx = l.pointToSegment = l.closestPointOnSegment = l.pointToSegmentParameter = l.mean = l.hypot = void 0;
        var t = Math.hypot && Math.hypot(1 / 0, NaN) === 1 / 0;
        function s(e) {
            return e === 1 / 0 || e === -1 / 0
        }
        function u(e, t, r, n, i, a, o, s, u) {
            var c = l.hypot(o - n, s - i, u - a);
            return 0 === c ? 0 : (e - n) / c * ((o - n) / c) + (t - i) / c * ((s - i) / c) + (r - a) / c * ((u - a) / c)
        }
        function c(e, t, r, n, i, a) {
            var o = u(e, t, 0, r, n, 0, i, a, 0);
            return o <= 0 ? [r, n] : 1 <= o ? [i, a] : [r + o * (i - r), n + o * (a - n)]
        }
        l.hypot = t ? Math.hypot : function(e, t, r) {
            if (s(e) || s(t) || void 0 !== r && s(r))
                return 1 / 0;
            if (isNaN(e) || isNaN(t) || void 0 !== r && isNaN(r))
                return NaN;
            if (0 === e && 0 === t && (void 0 === r || 0 === r))
                return 0;
            for (var n = 0, i = 0, a = 0; a < arguments.length; a += 1) {
                var o = Math.abs(Number(arguments[a]));
                n < o && (i *= n / o * (n / o),
                    n = o),
                    i += 0 === o && 0 === n ? 0 : o / n * (o / n)
            }
            return n === 1 / 0 ? 1 / 0 : n * Math.sqrt(i)
        }
            ,
            l.mean = function(e, t) {
                return 0 < e == 0 < t ? e + .5 * (t - e) : .5 * (e + t)
            }
            ,
            l.pointToSegmentParameter = u,
            l.closestPointOnSegment = c,
            l.pointToSegment = function(e, t, r, n, i, a) {
                var o = c(e, t, r, n, i, a);
                return l.hypot(e - o[0], t - o[1])
            }
            ,
            l.approx = function(e, t, r) {
                if (void 0 === r && (r = 1),
                e === t)
                    return !0;
                if (!isFinite(e) || !isFinite(t))
                    return !1;
                if (50 < r)
                    throw new Error("Within " + (52 - r) + " bits isn't really approximate any more");
                var n = Math.max(Math.max(Math.abs(e), Math.abs(t)), 1);
                return n === n + (1 === r ? .5 : Math.pow(.5, r)) * Math.abs(t - e)
            }
    });
    _("core/math/poi", ["require", "exports", "core/math/distance"], function(e, t, y) {
        "use strict";
        function P(e, t) {
            var r;
            t < e && (r = e,
                e = t,
                t = r);
            var n = 0 < e
                , i = 0 < t
                , a = .01 < Math.abs(e)
                , o = .01 < Math.abs(t);
            if (a || o)
                return y.mean(e, t);
            if (0 === e)
                return t * Math.abs(t);
            if (0 === t)
                return e * Math.abs(e);
            if (n != i)
                return 0;
            var s = n ? Math.sqrt(e * t) : -Math.sqrt(e * t);
            return e <= s && s <= t ? s : y.mean(e, t)
        }
        function p(e, t, r, n, i, a, o) {
            var s, u, c, l;
            if (isFinite(n))
                return isFinite(t) || (s = v(e, t, r, n, o)) && (e = s[0],
                    t = s[1]),
                isFinite(a) || (s = v(r, n, i, a, o)) && (i = s[0],
                    a = s[1]),
                    u = t === n ? [e, t] : f(e, t, r, n, o, n),
                    c = a === n ? [i, a] : f(r, n, i, a, o, n),
                u && c && (l = P(u[0], c[0])),
                    void 0 !== l ? [l, o(l)] : void 0
        }
        function v(e, t, r, n, i) {
            if (isFinite(t) !== isFinite(n))
                for (; ; ) {
                    var a = P(e, r)
                        , o = i(a);
                    if (a === e || a === r)
                        return isFinite(t) ? [e, t] : [r, n];
                    isFinite(o) !== isFinite(t) ? (r = a,
                        n = o) : (e = a,
                        t = o)
                }
        }
        function f(e, t, r, n, i, a) {
            if (t === a != (n === a))
                for (; ; ) {
                    var o = P(e, r)
                        , s = i(o);
                    if (o === e || o === r)
                        return t === a ? [e, t] : [r, n];
                    s === a != (t === a) ? (r = o,
                        n = s) : (e = o,
                        t = s)
                }
        }
        function O(e, t) {
            var r = e[0]
                , n = e[1]
                , i = t[0]
                , a = t[1];
            return (i - r) * (i - r) + (a - n) * (a - n)
        }
        function b(e, t, r, n, i, a) {
            var o, s, u, c, l, p, f, h, d, m = a(e), g = a(t), y = a(r), v = O(m, n), b = O(g, n), x = O(y, n);
            if (!(t <= e || r <= t) && isFinite(v) && isFinite(b) && isFinite(x) && !(v <= b || x <= b))
                for (; ; ) {
                    if (Math.abs(y[0] - m[0]) < i && Math.abs(y[1] - m[1]) < i)
                        return [e, r];
                    var S = P(e, t)
                        , _ = a(S)
                        , E = O(_, n)
                        , M = P(t, r)
                        , D = a(M)
                        , w = O(D, n);
                    if (!isFinite(E) || !isFinite(w))
                        return;
                    if (S === e || S === t || M === t || M === r)
                        return E < b && E < w ? [S, S] : w < E && w < b ? [M, M] : [t, t];
                    if (!(E !== b && w !== b || E !== (b = O(g = a(t = .5 * (S + t)), n)) && w !== b))
                        return [e, r];
                    E < b && E < w ? (r = (o = [t, S])[0],
                        t = o[1],
                        y = (s = [g, _])[0],
                        g = s[1],
                        x = (u = [b, E])[0],
                        b = u[1]) : w < E && w < b ? (e = (c = [t, M])[0],
                        t = c[1],
                        m = (l = [g, D])[0],
                        g = l[1],
                        v = (p = [b, w])[0],
                        b = p[1]) : (e = (f = [S, M])[0],
                        r = f[1],
                        m = (h = [_, D])[0],
                        y = h[1],
                        v = (d = [E, w])[0],
                        x = d[1])
                }
        }
        function x(e, t, r) {
            return void 0 === t && (t = -1 / 0),
            void 0 === r && (r = 1 / 0),
                Math.min(r, Math.max(t, e))
        }
        function c(e, t, r, n, i, a) {
            var o, s, u, c, l;
            l = void 0 !== n && void 0 !== i ? r + .01 * (r < .5 * (n + i) ? i - n : n - i) : 1 < Math.abs(r) ? 1.00001 * r : r + 1e-5;
            var p = e(r)
                , f = e(l)
                , h = O(p, t)
                , d = O(f, t);
            if (isFinite(h) && isFinite(d)) {
                if (h === d)
                    return [r, l];
                for (h < d && (r = (o = [l, r])[0],
                    l = o[1],
                    s = [f, p],
                    h = (u = [d, h])[0],
                    d = u[1]); isFinite(r) && isFinite(l) && r !== l; ) {
                    if (void 0 !== i && i < l)
                        return [i, i];
                    if (void 0 !== n && l < n)
                        return [n, n];
                    var m = r + 3 * (l - r)
                        , g = O(e(m), t);
                    if (!isFinite(g))
                        return [r, l];
                    if (g === d)
                        return [r, l];
                    if (d < g) {
                        var y = r < l ? b(r, l, m, t, a, e) : b(m, l, r, t, a, e);
                        return y ? [x(y[0], n, i), x(y[1], n, i)] : y
                    }
                    r = (c = [l, d, m, g])[0],
                        h = c[1],
                        l = c[2],
                        d = c[3]
                }
                return [r, l]
            }
        }
        function l(e, t, r, n) {
            return !r || n && Math.min(O(e(n[0]), t), O(e(n[1]), t)) < Math.min(O(e(r[0]), t), O(e(r[1]), t))
        }
        function S(e, t, r, n, i, a, o, s) {
            var u = Math.abs(n - t)
                , c = Math.abs(a - n)
                , l = Math.abs(s - a);
            return c < u && l < u ? [[e, t], [r, n]] : c < l && u < l ? [[i, a], [o, s]] : [[r, n], [i, a]]
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.bisectJump = t.findLocalClosestPointOnParametric = t.bisectClosestPointOnParametric = t.bisectExtremum = t.bisectFinite = t.flatCenter = t.bisectZero = t.floatMiddle = void 0,
            t.floatMiddle = P,
            t.bisectZero = function(e, t, r, n, i) {
                if (!isNaN(t) && !isNaN(n) && t < 0 != n < 0)
                    for (; ; ) {
                        var a = P(e, r)
                            , o = i(a);
                        if (!isFinite(o))
                            return;
                        if (a === e || a === r)
                            return Math.abs(t) <= Math.abs(n) ? [e, t] : [r, n];
                        if (0 === o)
                            return p(e, t, a, o, r, n, i);
                        t < 0 != o < 0 ? (r = a,
                            n = o) : (e = a,
                            t = o)
                    }
            }
            ,
            t.flatCenter = p,
            t.bisectFinite = v,
            t.bisectExtremum = function(e, t, r, n, i, a, o) {
                if (e < r && r < i && isFinite(t) && isFinite(n) && isFinite(a) && t !== n && n !== a && t < n == a < n)
                    for (; ; ) {
                        var s = P(e, r)
                            , u = o(s)
                            , c = P(r, i)
                            , l = o(c);
                        if (!isFinite(u) || !isFinite(l))
                            return;
                        if (s === e || s === r || c === r || c === i)
                            return n < u == t < n ? [s, u] : n < l == t < n ? [c, l] : [r, n];
                        if (u === n || l === n)
                            return p(e, t, r, n, i, a, o);
                        t < u == t < n && t < u == n < u ? (i = r,
                            a = n,
                            r = s,
                            n = u) : a < l == a < n && n < l == a < l ? (e = r,
                            t = n,
                            r = c,
                            n = l) : (e = s,
                            t = u,
                            i = c,
                            a = l)
                    }
            }
            ,
            t.bisectClosestPointOnParametric = b,
            t.findLocalClosestPointOnParametric = function(e, t, r, n, i, a) {
                var o, s, u = c(e, t, r, n, i, a);
                return void 0 === n || l(e, t, u, o = c(e, t, n, n, i, a)) && (u = o),
                void 0 === i || l(e, t, u, s = c(e, t, i, n, i, a)) && (u = s),
                    u
            }
            ,
            t.bisectJump = function(e, t, r, n, i, a, o, s) {
                if (s = s || 0,
                !((r - e) * (i - r) <= 0) && isFinite(e) && isFinite(r) && isFinite(i) && isFinite(t) && isFinite(a)) {
                    if (!isFinite(n)) {
                        var u = v(e, t, r, n, o)
                            , c = v(r, n, i, a, o);
                        if (!u || !c)
                            return;
                        return [u, c]
                    }
                    if (!(Math.abs(n - ((i - r) * t + (r - e) * a) / (i - e)) < s))
                        for (; ; ) {
                            var l = P(e, r)
                                , p = o(l)
                                , f = P(r, i)
                                , h = o(f)
                                , d = Math.abs(p - y.mean(t, n))
                                , m = Math.abs(n - y.mean(p, h))
                                , g = Math.abs(h - y.mean(n, a));
                            if (d <= s && m <= s && g <= s)
                                return;
                            if (!isFinite(p)) {
                                u = v(e, t, l, p, o),
                                    c = v(l, p, i, a, o);
                                if (!u || !c)
                                    return;
                                return [u, c]
                            }
                            if (!isFinite(h)) {
                                u = v(e, t, f, h, o),
                                    c = v(f, h, i, a, o);
                                if (!u || !c)
                                    return;
                                return [u, c]
                            }
                            if (!(l !== e && l !== r || f !== r && f !== i))
                                return Math.abs(n - t) > Math.abs(a - n) ? [[e, t], [r, n]] : [[r, n], [i, a]];
                            if (l === e || l === r)
                                return S(e, t, r, n, f, h, i, a);
                            if (f === r || f === i)
                                return S(e, t, l, p, r, n, i, a);
                            g < d && m <= d ? (i = r,
                                a = n,
                                r = l,
                                n = p) : d < g && m <= g ? (e = r,
                                t = n,
                                r = f,
                                n = h) : (e = l,
                                t = p,
                                i = f,
                                a = h)
                        }
                }
            }
    });
    _("core/math/quadrature", ["require", "core/math/mathshim", "core/math/poi"], function(e) {
        "use strict";
        var u = e("core/math/mathshim")
            , t = e("core/math/poi")
            , v = t.bisectJump
            , P = t.bisectFinite
            , r = Math.pow(2, -13)
            , o = r * r
            , b = o * o
            , O = o
            , T = 32
            , L = []
            , I = [];
        !function(e, t) {
            for (var r = T; 0 < r; r--) {
                var n = 3.154019550531224 / T * r
                    , i = u.sinh(n)
                    , a = u.cosh(Math.PI / 2 * i)
                    , o = 1 / (Math.exp(Math.PI / 2 * i) * a)
                    , s = u.cosh(n) / (a * a);
                e.push(o),
                    t.push(s)
            }
        }(L, I);
        for (var n = 0, i = 0; i < I.length; i++)
            n += I[i];
        var C = 1 / (1 + 2 * n);
        function N(e, t, r) {
            return .5 * (t * (2 - r) + e * r)
        }
        function A(e, t, r, n, i) {
            return {
                x1: e,
                x2: t,
                value: r,
                error: n,
                minerror: i
            }
        }
        function F(e, t, r) {
            var n = Math.abs(e(N(t, r, o)))
                , i = Math.abs(e(N(t, r, 2 * o)))
                , a = Math.abs(e(N(t, r, 4 * o)));
            return !(n < o || i < o) && (1.95 * i < n && 1.95 * a < i)
        }
        function x(e, t, r) {
            var n, i, a = N(r, t, L[0]), o = N(t, r, L[0]), s = e(a), u = e(o), c = N(t, r, 1), l = e(c);
            if (isFinite(l) && !isFinite(s)) {
                if (n = P(a, s, c, l, e),
                Math.abs((n[0] - t) / (r - t)) > O)
                    return A(t, r, NaN, NaN, NaN);
                t = n[0],
                    s = n[1]
            }
            if (isFinite(l) && !isFinite(u)) {
                if (i = P(c, l, o, u, e),
                Math.abs((i[0] - r) / (r - t)) > O)
                    return A(t, r, NaN, NaN, NaN);
                r = i[0],
                    u = i[1]
            }
            if (isFinite(s) && isFinite(u) && !isFinite(l)) {
                if (n = P(a, s, c, l, e),
                    i = P(c, l, o, u, e),
                Math.abs((i[0] - n[0]) / (r - t)) > O)
                    return A(t, r, NaN, NaN, NaN);
                l = .5 * (n[1] + i[1])
            }
            if (F(e, t, r) || F(e, r, t))
                return A(t, r, NaN, NaN, NaN);
            for (var p, f, h = l, d = 0, m = 0, g = 0, y = 0, v = 0; v < T; v += 4)
                p = e(N(t, r, L[v])),
                    f = e(N(r, t, L[v])),
                    y = Math.max(y, Math.abs(p), Math.abs(f)),
                    d += I[v] * (p + f),
                    p = e(N(t, r, L[v + 1])),
                    f = e(N(r, t, L[v + 1])),
                    y = Math.max(y, Math.abs(p), Math.abs(f)),
                    g += I[v + 1] * (p + f),
                    p = e(N(t, r, L[v + 2])),
                    f = e(N(r, t, L[v + 2])),
                    y = Math.max(y, Math.abs(p), Math.abs(f)),
                    m += I[v + 2] * (p + f),
                    p = e(N(t, r, L[v + 3])),
                    f = e(N(r, t, L[v + 3])),
                    y = Math.max(y, Math.abs(p), Math.abs(f)),
                    g += I[v + 3] * (p + f);
            var b = h + d
                , x = b + m
                , S = x + g
                , _ = Math.abs(m - b)
                , E = Math.abs(g - x)
                , M = C * (r - t) * S
                , D = C * Math.abs(r - t) * y * I[0]
                , w = 0 === _ ? C * Math.abs(r - t) * E : C * Math.abs(r - t) * E * (E / _) * (E / _);
            return A(t, r, M, w = Math.max(w, D), D)
        }
        function S(e) {
            for (var t = -1 / 0, r = -1 / 0, n = -1, i = 0, a = 0; a < e.length; a++) {
                var o = e[a];
                i += o.value,
                o.error > t && (t = o.error,
                    n = a),
                o.minerror > r && (r = o.minerror)
            }
            return {
                maxerror: t,
                maxminerror: r,
                maxindex: n,
                totalvalue: i
            }
        }
        return {
            quad: function e(t, r, n, i) {
                if (void 0 === i && (i = 32),
                isNaN(r) || isNaN(n))
                    return NaN;
                var a, o = 1;
                if (n < r && (a = r,
                    r = n,
                    n = a,
                    o = -1),
                r === 1 / 0 && n === 1 / 0)
                    return NaN;
                if (r === -1 / 0 && n === -1 / 0)
                    return NaN;
                if (r === -1 / 0 && n === 1 / 0)
                    return o * e(function(e) {
                        return t(e / ((1 + e) * (1 - e))) * (1 + e * e) / ((1 + e) * (1 + e) * (1 - e) * (1 - e))
                    }, -1, 1, i);
                if (r === -1 / 0)
                    return o * e(function(e) {
                        return -t(n - e / (1 - e)) / ((1 - e) * (1 - e))
                    }, 1, 0, i);
                if (n === 1 / 0)
                    return o * e(function(e) {
                        return t(r + e / (1 - e)) / ((1 - e) * (1 - e))
                    }, 0, 1, i);
                for (var s, u, c, l, p, f = [x(t, r, n)], h = S(f), d = 1; d < i && !(Math.abs(h.maxerror / h.totalvalue) <= 32 * b || h.maxerror <= 32 * b || h.maxerror <= 32 * h.maxminerror) && isFinite(h.maxerror) && isFinite(h.maxminerror); d++) {
                    var m = f[f.length - 1];
                    f[f.length - 1] = f[h.maxindex],
                        f[h.maxindex] = m;
                    var g = f.pop()
                        , y = (s = t,
                        u = N(g.x2, g.x1, .125),
                        c = N(g.x1, g.x2, .125),
                        p = l = void 0,
                        l = .5 * (u + c),
                        (p = v(u, s(u), l, s(l), c, s(c), s, 0)) ? .5 * (p[0][0] + p[1][0]) : l);
                    f.push(x(t, g.x1, y)),
                        f.push(x(t, y, g.x2)),
                        h = S(f)
                }
                return isFinite(h.maxerror) && isFinite(h.maxminerror) ? Math.abs(h.totalvalue) <= 10 * h.maxminerror ? 0 : o * h.totalvalue : NaN
            }
        }
    });
    _("core/math/tofraction", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.default = function(e, t) {
                if (void 0 === t && (t = 1e6),
                e === 1 / 0)
                    return {
                        n: 1 / 0,
                        d: 1
                    };
                if (e === -1 / 0)
                    return {
                        n: -1 / 0,
                        d: 1
                    };
                if (!isFinite(e))
                    return {
                        n: NaN,
                        d: 1
                    };
                for (var r, n, i, a = 0, o = 1, s = 1, u = 0; n = (r = Math.floor(e)) * o + a,
                !(t < (i = r * u + s)) && (a = o,
                    s = u,
                    o = n,
                    u = i,
                e !== r); )
                    e = 1 / (e - r);
                return {
                    n: o,
                    d: u
                }
            }
    });
    !function(e) {
        "use strict";
        function p(e, t) {
            var r = (65535 & e) + (65535 & t);
            return (e >> 16) + (t >> 16) + (r >> 16) << 16 | 65535 & r
        }
        function s(e, t, r, n, i, a) {
            return p((o = p(p(t, e), p(n, a))) << (s = i) | o >>> 32 - s, r);
            var o, s
        }
        function f(e, t, r, n, i, a, o) {
            return s(t & r | ~t & n, e, t, i, a, o)
        }
        function h(e, t, r, n, i, a, o) {
            return s(t & n | r & ~n, e, t, i, a, o)
        }
        function d(e, t, r, n, i, a, o) {
            return s(t ^ r ^ n, e, t, i, a, o)
        }
        function m(e, t, r, n, i, a, o) {
            return s(r ^ (t | ~n), e, t, i, a, o)
        }
        function u(e, t) {
            var r, n, i, a;
            e[t >> 5] |= 128 << t % 32,
                e[14 + (t + 64 >>> 9 << 4)] = t;
            for (var o = 1732584193, s = -271733879, u = -1732584194, c = 271733878, l = 0; l < e.length; l += 16)
                o = f(r = o, n = s, i = u, a = c, e[l], 7, -680876936),
                    c = f(c, o, s, u, e[l + 1], 12, -389564586),
                    u = f(u, c, o, s, e[l + 2], 17, 606105819),
                    s = f(s, u, c, o, e[l + 3], 22, -1044525330),
                    o = f(o, s, u, c, e[l + 4], 7, -176418897),
                    c = f(c, o, s, u, e[l + 5], 12, 1200080426),
                    u = f(u, c, o, s, e[l + 6], 17, -1473231341),
                    s = f(s, u, c, o, e[l + 7], 22, -45705983),
                    o = f(o, s, u, c, e[l + 8], 7, 1770035416),
                    c = f(c, o, s, u, e[l + 9], 12, -1958414417),
                    u = f(u, c, o, s, e[l + 10], 17, -42063),
                    s = f(s, u, c, o, e[l + 11], 22, -1990404162),
                    o = f(o, s, u, c, e[l + 12], 7, 1804603682),
                    c = f(c, o, s, u, e[l + 13], 12, -40341101),
                    u = f(u, c, o, s, e[l + 14], 17, -1502002290),
                    o = h(o, s = f(s, u, c, o, e[l + 15], 22, 1236535329), u, c, e[l + 1], 5, -165796510),
                    c = h(c, o, s, u, e[l + 6], 9, -1069501632),
                    u = h(u, c, o, s, e[l + 11], 14, 643717713),
                    s = h(s, u, c, o, e[l], 20, -373897302),
                    o = h(o, s, u, c, e[l + 5], 5, -701558691),
                    c = h(c, o, s, u, e[l + 10], 9, 38016083),
                    u = h(u, c, o, s, e[l + 15], 14, -660478335),
                    s = h(s, u, c, o, e[l + 4], 20, -405537848),
                    o = h(o, s, u, c, e[l + 9], 5, 568446438),
                    c = h(c, o, s, u, e[l + 14], 9, -1019803690),
                    u = h(u, c, o, s, e[l + 3], 14, -187363961),
                    s = h(s, u, c, o, e[l + 8], 20, 1163531501),
                    o = h(o, s, u, c, e[l + 13], 5, -1444681467),
                    c = h(c, o, s, u, e[l + 2], 9, -51403784),
                    u = h(u, c, o, s, e[l + 7], 14, 1735328473),
                    o = d(o, s = h(s, u, c, o, e[l + 12], 20, -1926607734), u, c, e[l + 5], 4, -378558),
                    c = d(c, o, s, u, e[l + 8], 11, -2022574463),
                    u = d(u, c, o, s, e[l + 11], 16, 1839030562),
                    s = d(s, u, c, o, e[l + 14], 23, -35309556),
                    o = d(o, s, u, c, e[l + 1], 4, -1530992060),
                    c = d(c, o, s, u, e[l + 4], 11, 1272893353),
                    u = d(u, c, o, s, e[l + 7], 16, -155497632),
                    s = d(s, u, c, o, e[l + 10], 23, -1094730640),
                    o = d(o, s, u, c, e[l + 13], 4, 681279174),
                    c = d(c, o, s, u, e[l], 11, -358537222),
                    u = d(u, c, o, s, e[l + 3], 16, -722521979),
                    s = d(s, u, c, o, e[l + 6], 23, 76029189),
                    o = d(o, s, u, c, e[l + 9], 4, -640364487),
                    c = d(c, o, s, u, e[l + 12], 11, -421815835),
                    u = d(u, c, o, s, e[l + 15], 16, 530742520),
                    o = m(o, s = d(s, u, c, o, e[l + 2], 23, -995338651), u, c, e[l], 6, -198630844),
                    c = m(c, o, s, u, e[l + 7], 10, 1126891415),
                    u = m(u, c, o, s, e[l + 14], 15, -1416354905),
                    s = m(s, u, c, o, e[l + 5], 21, -57434055),
                    o = m(o, s, u, c, e[l + 12], 6, 1700485571),
                    c = m(c, o, s, u, e[l + 3], 10, -1894986606),
                    u = m(u, c, o, s, e[l + 10], 15, -1051523),
                    s = m(s, u, c, o, e[l + 1], 21, -2054922799),
                    o = m(o, s, u, c, e[l + 8], 6, 1873313359),
                    c = m(c, o, s, u, e[l + 15], 10, -30611744),
                    u = m(u, c, o, s, e[l + 6], 15, -1560198380),
                    s = m(s, u, c, o, e[l + 13], 21, 1309151649),
                    o = m(o, s, u, c, e[l + 4], 6, -145523070),
                    c = m(c, o, s, u, e[l + 11], 10, -1120210379),
                    u = m(u, c, o, s, e[l + 2], 15, 718787259),
                    s = m(s, u, c, o, e[l + 9], 21, -343485551),
                    o = p(o, r),
                    s = p(s, n),
                    u = p(u, i),
                    c = p(c, a);
            return [o, s, u, c]
        }
        function c(e) {
            for (var t = "", r = 32 * e.length, n = 0; n < r; n += 8)
                t += String.fromCharCode(e[n >> 5] >>> n % 32 & 255);
            return t
        }
        function l(e) {
            var t = [];
            for (t[(e.length >> 2) - 1] = void 0,
                     n = 0; n < t.length; n += 1)
                t[n] = 0;
            for (var r = 8 * e.length, n = 0; n < r; n += 8)
                t[n >> 5] |= (255 & e.charCodeAt(n / 8)) << n % 32;
            return t
        }
        function n(e) {
            for (var t, r = "0123456789abcdef", n = "", i = 0; i < e.length; i += 1)
                t = e.charCodeAt(i),
                    n += r.charAt(t >>> 4 & 15) + r.charAt(15 & t);
            return n
        }
        function r(e) {
            return unescape(encodeURIComponent(e))
        }
        function i(e) {
            return c(u(l(t = r(e)), 8 * t.length));
            var t
        }
        function a(e, t) {
            return function(e, t) {
                var r, n, i = l(e), a = [], o = [];
                for (a[15] = o[15] = void 0,
                     16 < i.length && (i = u(i, 8 * e.length)),
                         r = 0; r < 16; r += 1)
                    a[r] = 909522486 ^ i[r],
                        o[r] = 1549556828 ^ i[r];
                return n = u(a.concat(l(t)), 512 + 8 * t.length),
                    c(u(o.concat(n), 640))
            }(r(e), r(t))
        }
        function t(e, t, r) {
            return t ? r ? a(t, e) : n(a(t, e)) : r ? i(e) : n(i(e))
        }
        "function" == typeof _ && _.amd ? _("core/lib/md5", [], function() {
            return t
        }) : "object" == typeof module && module.exports ? module.exports = t : e.md5 = t
    }(this);
    _("core/vendor/d3-color", ["require"], function(e) {
        function t(e, t, r) {
            (e.prototype = t.prototype = r).constructor = e
        }
        function r(e, t) {
            var r = Object.create(e.prototype);
            for (var n in t)
                r[n] = t[n];
            return r
        }
        function c() {}
        var n = .7
            , i = 1 / n
            , a = "\\s*([+-]?\\d+)\\s*"
            , o = "\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*"
            , s = "\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*"
            , u = /^#([0-9a-f]{3,8})$/
            , l = new RegExp("^rgb\\(" + [a, a, a] + "\\)$")
            , p = new RegExp("^rgb\\(" + [s, s, s] + "\\)$")
            , f = new RegExp("^rgba\\(" + [a, a, a, o] + "\\)$")
            , h = new RegExp("^rgba\\(" + [s, s, s, o] + "\\)$")
            , d = new RegExp("^hsl\\(" + [o, s, s] + "\\)$")
            , m = new RegExp("^hsla\\(" + [o, s, s, o] + "\\)$")
            , g = {
            aliceblue: 15792383,
            antiquewhite: 16444375,
            aqua: 65535,
            aquamarine: 8388564,
            azure: 15794175,
            beige: 16119260,
            bisque: 16770244,
            black: 0,
            blanchedalmond: 16772045,
            blue: 255,
            blueviolet: 9055202,
            brown: 10824234,
            burlywood: 14596231,
            cadetblue: 6266528,
            chartreuse: 8388352,
            chocolate: 13789470,
            coral: 16744272,
            cornflowerblue: 6591981,
            cornsilk: 16775388,
            crimson: 14423100,
            cyan: 65535,
            darkblue: 139,
            darkcyan: 35723,
            darkgoldenrod: 12092939,
            darkgray: 11119017,
            darkgreen: 25600,
            darkgrey: 11119017,
            darkkhaki: 12433259,
            darkmagenta: 9109643,
            darkolivegreen: 5597999,
            darkorange: 16747520,
            darkorchid: 10040012,
            darkred: 9109504,
            darksalmon: 15308410,
            darkseagreen: 9419919,
            darkslateblue: 4734347,
            darkslategray: 3100495,
            darkslategrey: 3100495,
            darkturquoise: 52945,
            darkviolet: 9699539,
            deeppink: 16716947,
            deepskyblue: 49151,
            dimgray: 6908265,
            dimgrey: 6908265,
            dodgerblue: 2003199,
            firebrick: 11674146,
            floralwhite: 16775920,
            forestgreen: 2263842,
            fuchsia: 16711935,
            gainsboro: 14474460,
            ghostwhite: 16316671,
            gold: 16766720,
            goldenrod: 14329120,
            gray: 8421504,
            green: 32768,
            greenyellow: 11403055,
            grey: 8421504,
            honeydew: 15794160,
            hotpink: 16738740,
            indianred: 13458524,
            indigo: 4915330,
            ivory: 16777200,
            khaki: 15787660,
            lavender: 15132410,
            lavenderblush: 16773365,
            lawngreen: 8190976,
            lemonchiffon: 16775885,
            lightblue: 11393254,
            lightcoral: 15761536,
            lightcyan: 14745599,
            lightgoldenrodyellow: 16448210,
            lightgray: 13882323,
            lightgreen: 9498256,
            lightgrey: 13882323,
            lightpink: 16758465,
            lightsalmon: 16752762,
            lightseagreen: 2142890,
            lightskyblue: 8900346,
            lightslategray: 7833753,
            lightslategrey: 7833753,
            lightsteelblue: 11584734,
            lightyellow: 16777184,
            lime: 65280,
            limegreen: 3329330,
            linen: 16445670,
            magenta: 16711935,
            maroon: 8388608,
            mediumaquamarine: 6737322,
            mediumblue: 205,
            mediumorchid: 12211667,
            mediumpurple: 9662683,
            mediumseagreen: 3978097,
            mediumslateblue: 8087790,
            mediumspringgreen: 64154,
            mediumturquoise: 4772300,
            mediumvioletred: 13047173,
            midnightblue: 1644912,
            mintcream: 16121850,
            mistyrose: 16770273,
            moccasin: 16770229,
            navajowhite: 16768685,
            navy: 128,
            oldlace: 16643558,
            olive: 8421376,
            olivedrab: 7048739,
            orange: 16753920,
            orangered: 16729344,
            orchid: 14315734,
            palegoldenrod: 15657130,
            palegreen: 10025880,
            paleturquoise: 11529966,
            palevioletred: 14381203,
            papayawhip: 16773077,
            peachpuff: 16767673,
            peru: 13468991,
            pink: 16761035,
            plum: 14524637,
            powderblue: 11591910,
            purple: 8388736,
            rebeccapurple: 6697881,
            red: 16711680,
            rosybrown: 12357519,
            royalblue: 4286945,
            saddlebrown: 9127187,
            salmon: 16416882,
            sandybrown: 16032864,
            seagreen: 3050327,
            seashell: 16774638,
            sienna: 10506797,
            silver: 12632256,
            skyblue: 8900331,
            slateblue: 6970061,
            slategray: 7372944,
            slategrey: 7372944,
            snow: 16775930,
            springgreen: 65407,
            steelblue: 4620980,
            tan: 13808780,
            teal: 32896,
            thistle: 14204888,
            tomato: 16737095,
            turquoise: 4251856,
            violet: 15631086,
            wheat: 16113331,
            white: 16777215,
            whitesmoke: 16119285,
            yellow: 16776960,
            yellowgreen: 10145074
        };
        function y() {
            return this.rgb().formatHex()
        }
        function v() {
            return this.rgb().formatRgb()
        }
        function b(e) {
            var t, r;
            return e = (e + "").trim().toLowerCase(),
                (t = u.exec(e)) ? (r = t[1].length,
                    t = parseInt(t[1], 16),
                    6 === r ? x(t) : 3 === r ? new M(t >> 8 & 15 | t >> 4 & 240,t >> 4 & 15 | 240 & t,(15 & t) << 4 | 15 & t,1) : 8 === r ? S(t >> 24 & 255, t >> 16 & 255, t >> 8 & 255, (255 & t) / 255) : 4 === r ? S(t >> 12 & 15 | t >> 8 & 240, t >> 8 & 15 | t >> 4 & 240, t >> 4 & 15 | 240 & t, ((15 & t) << 4 | 15 & t) / 255) : null) : (t = l.exec(e)) ? new M(t[1],t[2],t[3],1) : (t = p.exec(e)) ? new M(255 * t[1] / 100,255 * t[2] / 100,255 * t[3] / 100,1) : (t = f.exec(e)) ? S(t[1], t[2], t[3], t[4]) : (t = h.exec(e)) ? S(255 * t[1] / 100, 255 * t[2] / 100, 255 * t[3] / 100, t[4]) : (t = d.exec(e)) ? O(t[1], t[2] / 100, t[3] / 100, 1) : (t = m.exec(e)) ? O(t[1], t[2] / 100, t[3] / 100, t[4]) : g.hasOwnProperty(e) ? x(g[e]) : "transparent" === e ? new M(NaN,NaN,NaN,0) : null
        }
        function x(e) {
            return new M(e >> 16 & 255,e >> 8 & 255,255 & e,1)
        }
        function S(e, t, r, n) {
            return n <= 0 && (e = t = r = NaN),
                new M(e,t,r,n)
        }
        function _(e) {
            return e instanceof c || (e = b(e)),
                e ? new M((e = e.rgb()).r,e.g,e.b,e.opacity) : new M
        }
        function E(e, t, r, n) {
            return 1 === arguments.length ? _(e) : new M(e,t,r,null == n ? 1 : n)
        }
        function M(e, t, r, n) {
            this.r = +e,
                this.g = +t,
                this.b = +r,
                this.opacity = +n
        }
        function D() {
            return "#" + P(this.r) + P(this.g) + P(this.b)
        }
        function w() {
            var e = this.opacity;
            return (1 === (e = isNaN(e) ? 1 : Math.max(0, Math.min(1, e))) ? "rgb(" : "rgba(") + Math.max(0, Math.min(255, Math.round(this.r) || 0)) + ", " + Math.max(0, Math.min(255, Math.round(this.g) || 0)) + ", " + Math.max(0, Math.min(255, Math.round(this.b) || 0)) + (1 === e ? ")" : ", " + e + ")")
        }
        function P(e) {
            return ((e = Math.max(0, Math.min(255, Math.round(e) || 0))) < 16 ? "0" : "") + e.toString(16)
        }
        function O(e, t, r, n) {
            return n <= 0 ? e = t = r = NaN : r <= 0 || 1 <= r ? e = t = NaN : t <= 0 && (e = NaN),
                new I(e,t,r,n)
        }
        function T(e) {
            if (e instanceof I)
                return new I(e.h,e.s,e.l,e.opacity);
            if (e instanceof c || (e = b(e)),
                !e)
                return new I;
            if (e instanceof I)
                return e;
            var t = (e = e.rgb()).r / 255
                , r = e.g / 255
                , n = e.b / 255
                , i = Math.min(t, r, n)
                , a = Math.max(t, r, n)
                , o = NaN
                , s = a - i
                , u = (a + i) / 2;
            return s ? (o = t === a ? (r - n) / s + 6 * (r < n) : r === a ? (n - t) / s + 2 : (t - r) / s + 4,
                s /= u < .5 ? a + i : 2 - a - i,
                o *= 60) : s = 0 < u && u < 1 ? 0 : o,
                new I(o,s,u,e.opacity)
        }
        function L(e, t, r, n) {
            return 1 === arguments.length ? T(e) : new I(e,t,r,null == n ? 1 : n)
        }
        function I(e, t, r, n) {
            this.h = +e,
                this.s = +t,
                this.l = +r,
                this.opacity = +n
        }
        function C(e, t, r) {
            return 255 * (e < 60 ? t + (r - t) * e / 60 : e < 180 ? r : e < 240 ? t + (r - t) * (240 - e) / 60 : t)
        }
        return t(c, b, {
            copy: function(e) {
                return Object.assign(new this.constructor, this, e)
            },
            displayable: function() {
                return this.rgb().displayable()
            },
            hex: y,
            formatHex: y,
            formatHsl: function() {
                return T(this).formatHsl()
            },
            formatRgb: v,
            toString: v
        }),
            t(M, E, r(c, {
                brighter: function(e) {
                    return e = null == e ? i : Math.pow(i, e),
                        new M(this.r * e,this.g * e,this.b * e,this.opacity)
                },
                darker: function(e) {
                    return e = null == e ? n : Math.pow(n, e),
                        new M(this.r * e,this.g * e,this.b * e,this.opacity)
                },
                rgb: function() {
                    return this
                },
                displayable: function() {
                    return -.5 <= this.r && this.r < 255.5 && -.5 <= this.g && this.g < 255.5 && -.5 <= this.b && this.b < 255.5 && 0 <= this.opacity && this.opacity <= 1
                },
                hex: D,
                formatHex: D,
                formatRgb: w,
                toString: w
            })),
            t(I, L, r(c, {
                brighter: function(e) {
                    return e = null == e ? i : Math.pow(i, e),
                        new I(this.h,this.s,this.l * e,this.opacity)
                },
                darker: function(e) {
                    return e = null == e ? n : Math.pow(n, e),
                        new I(this.h,this.s,this.l * e,this.opacity)
                },
                rgb: function() {
                    var e = this.h % 360 + 360 * (this.h < 0)
                        , t = isNaN(e) || isNaN(this.s) ? 0 : this.s
                        , r = this.l
                        , n = r + (r < .5 ? r : 1 - r) * t
                        , i = 2 * r - n;
                    return new M(C(240 <= e ? e - 240 : 120 + e, i, n),C(e, i, n),C(e < 120 ? 240 + e : e - 120, i, n),this.opacity)
                },
                displayable: function() {
                    return (0 <= this.s && this.s <= 1 || isNaN(this.s)) && 0 <= this.l && this.l <= 1 && 0 <= this.opacity && this.opacity <= 1
                },
                formatHsl: function() {
                    var e = this.opacity;
                    return (1 === (e = isNaN(e) ? 1 : Math.max(0, Math.min(1, e))) ? "hsl(" : "hsla(") + (this.h || 0) + ", " + 100 * (this.s || 0) + "%, " + 100 * (this.l || 0) + "%" + (1 === e ? ")" : ", " + e + ")")
                }
            })),
            {
                Color: c,
                darker: n,
                brighter: i,
                color: b,
                rgbConvert: _,
                rgb: E,
                Rgb: M,
                hslConvert: T,
                hsl: L
            }
    });
    _("core/math/builtin", ["require", "core/math/mathshim", "core/math/distance", "core/math/quadrature", "core/math/tofraction", "core/math/poi", "core/lib/md5", "core/vendor/d3-color"], function(e) {
        "use strict";
        var i = e("core/math/mathshim")
            , n = e("core/math/distance")
            , t = e("core/math/quadrature")
            , r = e("core/math/tofraction").default
            , u = e("core/math/poi").floatMiddle
            , a = e("core/lib/md5")
            , o = e("core/vendor/d3-color");
        function s(e, t, r) {
            return Math.max(t, Math.min(r, e))
        }
        var f = {};
        f.cosh = i.cosh,
            f.sinh = i.sinh,
            f.tanh = i.tanh,
            f.acosh = i.acosh,
            f.asinh = i.asinh,
            f.atanh = i.atanh,
            f.expm1 = i.expm1,
            f.log1p = i.log1p,
            f.sqrtxsqp1 = i.sqrtxsqp1,
            f.sqrtxsqm1 = i.sqrtxsqm1,
            f.mod = function(e, t) {
                return e - t * Math.floor(e / t)
            }
            ,
            f.round = function(e, t) {
                if (void 0 === t && (t = 0),
                0 === (t = Math.round(t)))
                    return Math.round(e);
                var r = Math.pow(10, t);
                return Math.round(e * r) / r
            }
            ,
            f.sign = Math.sign || function(e) {
                return 0 === e ? 0 : 0 < e ? 1 : e < 0 ? -1 : NaN
            }
            ,
            f.lcm = function(e, t) {
                e = Math.round(e),
                    t = Math.round(t);
                var r = f.gcd(e, t);
                return Math.abs(e / r * t)
            }
            ,
            f.gcd = function(e, t) {
                var r;
                if ((e = Math.round(e)) < 0 && (e = -e),
                (t = Math.round(t)) < 0 && (t = -t),
                e < t && (r = t,
                    t = e,
                    e = r),
                0 === t)
                    return e;
                for (var n = e % t; 0 < n; )
                    n = (e = t) % (t = n);
                return t
            }
            ,
            f.listGCD = function(e) {
                if (0 === e.length)
                    return NaN;
                for (var t = e[0], r = 1; r < e.length; r++)
                    t = f.gcd(t, e[r]);
                return t
            }
            ,
            f.listLCM = function(e) {
                if (0 === e.length)
                    return NaN;
                for (var t = e[0], r = 1; r < e.length; r++)
                    t = f.lcm(t, e[r]);
                return t
            }
            ,
            f.nCr = function(e, t) {
                if ((e = Math.round(e)) < (t = Math.round(t)) || e < 0 || t < 0)
                    return 0;
                if (t === 1 / 0 || e === 1 / 0)
                    return NaN;
                for (var r = 1, n = 0; n < t; n++)
                    r *= (e - n) / (n + 1);
                return r
            }
            ,
            f.nPr = function(e, t) {
                if ((e = Math.round(e)) < (t = Math.round(t)) || e < 0 || t < 0)
                    return 0;
                if (t === 1 / 0 || e === 1 / 0)
                    return NaN;
                for (var r = 1, n = 0; n < t; n++)
                    r *= e - n;
                return r
            }
            ,
            f.factorial = function(e) {
                return f.gamma(e + 1)
            }
            ,
            f.gamma = function(e) {
                if (e < 0)
                    return Math.PI / (f.sin(Math.PI * e) * f.gamma(1 - e));
                if (170 < e)
                    return 1 / 0;
                var t = Math.round(e) === e
                    , r = e < 15 ? c(e) : e < 120 ? l(e) : Math.exp(p(e));
                return t ? Math.round(r) : r
            }
        ;
        var c = function(e) {
            var t = 1 + e * (4.077131788261185 + e * (7.024675027156382 + e * (6.657107767450176 + e * (3.766266976716022 + e * (1.2792371666711133 + e * (.24304596436338005 + .020049769312165774 * e))))))
                , r = 1 + e * (4.154347453162709 + e * (7.270007565107539 + e * (6.97805297331391 + e * (3.989651532924167 + e * (1.367176195613119 + e * (.26175627691546965 + .021742722739397567 * e))))));
            return Math.E * Math.pow((1 + e) / Math.E, 1 + e) / (e * Math.sqrt(1 + e)) * (t / r)
        }
            , l = function(e) {
            var t = e - 1;
            return Math.pow(t, t) * Math.exp(y(t) - t) * Math.sqrt(2 * Math.PI * t)
        }
            , p = function(e) {
            var t = e - 1;
            return t * (Math.log(t) - 1) + .5 * Math.log(2 * Math.PI * t) + y(t)
        };
        f.lnGamma = function(e) {
            return e < 0 ? NaN : e < 15 ? Math.log(c(e)) : p(e)
        }
            ,
            f.bernoulliTable = [1 / 6, -1 / 30, 1 / 42, -1 / 30, 5 / 66, -691 / 2730, 7 / 6, -3617 / 510, 43867 / 798, -174611 / 330, 854513 / 138, -236364091 / 2730, 8553103 / 6, -23749461029 / 870],
            f.cotDerivative = function(e, t) {
                if (e !== Math.floor(e))
                    return NaN;
                if (e < 0)
                    return NaN;
                if (0 === e)
                    return 1 / f.tan(t);
                var r = f.sin(t);
                if (1 === e)
                    return -1 / (r * r);
                var n = f.cos(t);
                if (2 === e)
                    return 2 * n / (r * r * r);
                for (var i, a, o, s = [0, 2], u = 3; u <= e; u++) {
                    for (i = [],
                             l = 0; l < u; l++)
                        (o = a = 0) < l && (a = (u - l + 1) * s[l - 1]),
                        l + 2 < u && (o = (l + 1) * s[l + 1]),
                            i.push(-(a + o));
                    s = i
                }
                for (var c = 0, l = e - 1; 0 <= l; l--)
                    c = i[l] + n * c;
                return c / Math.pow(r, e + 1)
            }
            ,
            f.polyGamma = function(e, t) {
                if (e < 0)
                    return NaN;
                if (e !== Math.floor(e))
                    return NaN;
                var r = e % 2 == 0 ? -1 : 1;
                if (t < 0)
                    return -r * f.polyGamma(e, 1 - t) - Math.pow(Math.PI, e + 1) * f.cotDerivative(e, Math.PI * t);
                for (var n = f.factorial(e), i = 0, a = Math.pow(t, -(e + 1)); t < 10; )
                    i += a,
                        t++,
                        a = Math.pow(t, -(e + 1));
                i += 0 === e ? -Math.log(t) : a * t / e,
                    i += .5 * a;
                for (var o = f.bernoulliTable, s = e + 1, u = 2, c = a * t * s / u, l = 1 / (t * t), p = 1; p <= 14; p++)
                    i += (c *= l) * o[p - 1],
                        c *= ++s / ++u,
                        c *= ++s / ++u;
                return n * r * i
            }
            ,
            f.toFraction = r,
            f.log = function(e) {
                var t = Math.log(e);
                return Math.exp(Math.round(t)) === e ? Math.round(t) : t
            }
            ,
            f.log_base = function(e, t) {
                if (0 === t)
                    return NaN;
                var r = t === Math.E ? Math.log(e) : 2 === t && Math.log2 ? Math.log2(e) : 10 === t && Math.log10 ? Math.log10(e) : Math.log(e) / Math.log(t);
                return Math.pow(t, Math.round(r)) === e ? Math.round(r) : r
            }
            ,
            f.common_log = function(e) {
                return f.log_base(e, 10)
            }
            ,
            f.pow = function(e, t) {
                if (!isFinite(e) && 0 === t)
                    return NaN;
                if (0 <= e || t === Math.floor(t))
                    return Math.pow(e, t);
                var r = f.toFraction(t, 100);
                return n.approx(r.n / r.d, t, 2) && r.d % 2 == 1 ? (r.n % 2 == 0 ? 1 : -1) * Math.pow(-e, t) : NaN
            }
            ,
            f.nthroot = function(e, t) {
                return f.pow(e, 1 / t)
            }
        ;
        var h = 1 / Math.PI;
        function d(e) {
            return !(1e12 < e) && Math.round(h * e) * Math.PI === e
        }
        function m(e) {
            if (!(1e12 < e)) {
                var t = Math.round(2 * h * e);
                return t % 2 == 1 && t * Math.PI == 2 * e
            }
        }
        f.sin = function(e) {
            return d(Math.abs(e)) ? 0 : Math.sin(e)
        }
            ,
            f.cos = function(e) {
                return m(Math.abs(e)) ? 0 : Math.cos(e)
            }
            ,
            f.tan = function(e) {
                var t = Math.abs(e);
                return d(t) ? 0 : m(t) ? 1 / 0 : Math.tan(e)
            }
            ,
            f.sec = function(e) {
                return m(Math.abs(e)) ? 1 / 0 : 1 / Math.cos(e)
            }
            ,
            f.csc = function(e) {
                return d(Math.abs(e)) ? 1 / 0 : 1 / Math.sin(e)
            }
            ,
            f.cot = function(e) {
                var t = Math.abs(e);
                return d(t) ? 1 / 0 : m(t) ? 0 : 1 / Math.tan(e)
            }
            ,
            f.acot = function(e) {
                return Math.PI / 2 - Math.atan(e)
            }
            ,
            f.acsc = function(e) {
                return Math.asin(1 / e)
            }
            ,
            f.asec = function(e) {
                return Math.acos(1 / e)
            }
            ,
            f.sech = function(e) {
                return 1 / f.cosh(e)
            }
            ,
            f.csch = function(e) {
                return 1 / f.sinh(e)
            }
            ,
            f.coth = function(e) {
                return 1 / f.tanh(e)
            }
            ,
            f.asech = function(e) {
                return f.acosh(1 / e)
            }
            ,
            f.acsch = function(e) {
                return f.asinh(1 / e)
            }
            ,
            f.acoth = function(e) {
                return f.atanh(1 / e)
            }
            ,
            f.mean = function(e) {
                for (var t = 0, r = 0; r < e.length; r++)
                    t += e[r];
                return t / e.length
            }
            ,
            f.total = function(e) {
                for (var t = 0, r = 0; r < e.length; r++)
                    t += e[r];
                return t
            }
        ;
        function g(e) {
            return 50 < e ? Math.exp(.5 * ((1 - e) * i.log1p(-1 / (e - 1)) - 1) + y(.5 * (e - 1)) - y(.5 * (e - 2))) * Math.sqrt((1 - 1 / e) / (2 * Math.PI)) : f.gamma((e + 1) / 2) / (f.gamma(e / 2) * Math.sqrt(e * Math.PI))
        }
        var y = function(e) {
            var t = e * e;
            return (.08333333333333333 - (.002777777777777778 - (.0007936507936507937 - (.0005952380952380953 - .0008417508417508417 / t) / t) / t) / t) / e
        };
        f.tpdf = function(e, t) {
            return t <= 0 ? NaN : g(t) * Math.pow(1 + e * e / t, -(t + 1) / 2)
        }
        ;
        var v = function(e, t) {
            if (0 < t)
                return 1 - v(e, -t);
            if (t === -1 / 0)
                return 0;
            var r = Math.sqrt(2 * e / (e + 1));
            if (Math.abs(t / r) < .001)
                return .5 * (1 + Math.sqrt(Math.PI) * g(e) * r * f.erf(t / r));
            if (t / e < -1e3) {
                var n = t * t;
                return g(e) * Math.pow(e, .5 * (e - 1)) * Math.pow(Math.abs(t), -e) * (1 - e * e * (e + 1) * (1 / (2 + e) + e * (e + 3) / (4 * (4 + e) * n)) / (2 * n))
            }
            var i = Math.sqrt(t * t + e);
            return S((t + i) / (2 * i), e / 2, e / 2)
        };
        f.tcdf = function(e, t, r) {
            return r <= 0 ? NaN : e === -1 / 0 ? v(r, t) : 0 < e && 0 < t ? v(r, -e) - v(r, -t) : v(r, t) - v(r, e)
        }
        ;
        function b(e, t, r) {
            return (e - t) / (Math.SQRT2 * Math.abs(r))
        }
        function x(e) {
            return e < 0 ? .5 * Math.exp(-e * e) * f.erfcx(-e) : 1 - .5 * Math.exp(-e * e) * f.erfcx(e)
        }
        var S = function(e, t, r) {
            if (e < 0 || 1 < e)
                throw new RangeError("First argument must be between 0 and 1.");
            if (1 === t && 1 === r)
                return e;
            if (0 === e)
                return 0;
            if (1 === e)
                return 1;
            if (0 === t)
                return 1;
            if (0 === r)
                return 0;
            var n = Math.exp(f.lnGamma(t + r) - f.lnGamma(t) - f.lnGamma(r) + t * Math.log(e) + r * i.log1p(-e));
            return e < (t + 1) / (t + r + 2) ? n * _(e, t, r) / t : 1 - n * _(1 - e, r, t) / r
        }
            , _ = function(e, t, r) {
            var n, i, a, o, s = 1e-30, u = 1, c = t + r, l = t + 1, p = t - 1, f = 1, h = 1 - c * e / l;
            for (Math.abs(h) < s && (h = s),
                     o = h = 1 / h; u <= 100 && (h = 1 + (i = u * (r - u) * e / ((p + (n = 2 * u)) * (t + n))) * h,
            Math.abs(h) < s && (h = s),
                f = 1 + i / f,
            Math.abs(f) < s && (f = s),
                o *= (h = 1 / h) * f,
                h = 1 + (i = -(t + u) * (c + u) * e / ((t + n) * (l + n))) * h,
            Math.abs(h) < s && (h = s),
                f = 1 + i / f,
            Math.abs(f) < s && (f = s),
                o *= a = (h = 1 / h) * f,
                !(Math.abs(a - 1) < 3e-7)); u++)
                ;
            return o
        };
        f.normalcdf = function(e, t, r, n) {
            var i = b(t, r, n);
            if (e === -1 / 0)
                return x(i);
            var a = b(e, r, n);
            return 0 < e && 0 < t ? x(-a) - x(-i) : x(i) - x(a)
        }
            ,
            f.normalpdf = function(e, t, r) {
                return 1 / Math.sqrt(2 * Math.PI * r * r) * Math.exp(-(e - t) * (e - t) / (2 * r * r))
            }
            ,
            f.random = function(e) {
                var t = a(e);
                return (4294967296 * (2097151 & parseInt(t.slice(0, 8), 16)) + parseInt(t.slice(8, 16), 16)) / 9007199254740992
            }
            ,
            f.shuffle = function(e, t) {
                for (var r = t.length - 1; 0 < r; r--) {
                    var n = e + "::sc" + r
                        , i = Math.floor(f.random(n) * (r + 1))
                        , a = t[r];
                    t[r] = t[i],
                        t[i] = a
                }
            }
            ,
            f.randomPerm = function(e, t) {
                for (var r = [], n = 0; n < t; n++)
                    r.push(n);
                return f.shuffle(e, r),
                    r
            }
            ,
            f.uniformSample = function(e, t, r) {
                return f.random(e) * (r - t) + t
            }
            ,
            f.normalSample = function(e, t, r) {
                for (var n, i, a, o, s = 0; n = e + "::sc" + s,
                    s += 1,
                    i = 2 * f.uniformSample(n, 0, 1) - 1,
                    n = e + "::sc" + s,
                    s += 1,
                1 <= (o = i * i + (a = 2 * f.uniformSample(n, 0, 1) - 1) * a) || 0 === o; )
                    ;
                return t + r * i * Math.sqrt(-2 * Math.log(o) / o)
            }
            ,
            f.tSample = function(e, t) {
                if (t <= 0)
                    return NaN;
                for (var r, n, i, a = 0; u = e + "::sc" + a,
                    a += 1,
                    r = 2 * f.uniformSample(u, 0, 1) - 1,
                    u = e + "::sc" + a,
                    a += 1,
                1 < (i = r * r + (n = 2 * f.uniformSample(u, 0, 1) - 1) * n); )
                    ;
                var o = r * r / i
                    , s = t * (Math.pow(i, -2 / t) - 1)
                    , u = e + "::sc" + a;
                return a += 1,
                (f.uniformSample(u, 0, 1) < .5 ? -1 : 1) * Math.sqrt(o * s)
            }
            ,
            f.binomSample = function(e, t, r) {
                return (t = s(Math.round(t), 0, 1 / 0)) === 1 / 0 ? NaN : (r = s(r, 0, 1),
                    f.invBinom(f.uniformSample(e, 0, 1), t, r))
            }
            ,
            f.poissonSample = function(e, t) {
                return t <= 0 ? NaN : f.invPoisson(f.uniformSample(e, 0, 1), t)
            }
        ;
        function E(e, t, r) {
            if (t <= e)
                return 1;
            if (e < 0)
                return 0;
            for (var n = r / (1 - r), i = Math.pow(1 - r, t), a = i, o = 1; o <= Math.min(t, e); o++)
                a += i *= (t - o + 1) / o * n;
            return a
        }
        f.binomcdf = function(e, t, r, n) {
            return (r = s(Math.round(r), 0, 1 / 0)) === 1 / 0 ? NaN : (n = s(n, 0, 1),
                t < 0 ? 0 : (e = Math.ceil(e),
                    t = Math.floor(t),
                    e === -1 / 0 ? E(t, r, n) : E(t, r, n) - E(e - 1, r, n)))
        }
            ,
            f.binompdf = function(e, t, r) {
                return e = Math.round(e),
                    (t = s(Math.round(t), 0, 1 / 0)) === 1 / 0 ? NaN : (r = s(r, 0, 1),
                        e < 0 || t < e ? 0 : f.nCr(t, e) * Math.pow(r, e) * Math.pow(1 - r, t - e))
            }
            ,
            f.poissonpdf = function(e, t) {
                return t <= 0 ? NaN : (e = Math.round(e)) < 0 ? 0 : Math.exp(-t + e * Math.log(t) - f.lnGamma(e + 1))
            }
        ;
        function M(e, t) {
            if (e === 1 / 0)
                return 1;
            if (e < 0)
                return 0;
            for (var r = 1, n = 1, i = 1; i <= e; i++) {
                var a = n;
                if ((n += r *= t / i) === a)
                    break
            }
            return Math.exp(-t) * n
        }
        f.poissoncdf = function(e, t, r) {
            return r <= 0 ? NaN : (e = Math.ceil(e),
                (t = Math.floor(t)) < 0 ? 0 : e === -1 / 0 ? M(t, r) : M(t, r) - M(e - 1, r))
        }
            ,
            f.uniformpdf = function(e, t, r) {
                return r <= t ? NaN : e < t || r < e ? 0 : 1 / (r - t)
            }
        ;
        function D(e, t, r) {
            return r <= t ? NaN : e < t ? 0 : r < e ? 1 : (e - t) / (r - t)
        }
        f.uniformcdf = function(e, t, r, n) {
            return D(t, r, n) - D(e, r, n)
        }
            ,
            f.erf = function(e) {
                var t = -e * e;
                if (t < -750)
                    return 0 <= e ? 1 : -1;
                if (.065 <= e)
                    return 1 - Math.exp(t) * f.erfcx(e);
                if (e <= -.065)
                    return Math.exp(t) * f.erfcx(-e) - 1;
                return e * (1.1283791670955126 + t * (.37612638903183754 + t * (.11283791670955126 + t * (.026866170645131252 + .005223977625442188 * t))))
            }
            ,
            f.erfcx = function(e) {
                if (e < 0)
                    return e < -6.1 ? 2 * Math.exp(e * e) : 2 * Math.exp(e * e) - f.erfcx(-e);
                if (50 < e) {
                    var t = .5641895835477563
                        , r = e * e;
                    return 5e7 < e ? t / e : t * (r * (4.5 + r) + 2) / (e * (r * (5 + r) + 3.75))
                }
                return (.9999999999999999 + e * (2.224574423459406 + e * (2.444115549920689 + e * (1.7057986861852539 + e * (.8257463703357973 + e * (.28647031042892007 + e * (.07124513844341643 + e * (.012296749268608364 + e * (.001347817214557592 + 7263959403471071e-20 * e))))))))) / (1 + e * (3.352953590554884 + e * (5.227518529742423 + e * (5.003720878235473 + e * (3.266590890998987 + e * (1.5255421920765353 + e * (.5185887413188858 + e * (.12747319185915415 + e * (.02185979575963238 + e * (.0023889438122503674 + .00012875032817508128 * e))))))))))
            }
            ,
            f.invNorm = function(e) {
                var t, r, n;
                return .5 < e ? -f.invNorm(1 - e) : .5 === e ? 0 : e < 0 ? NaN : 0 === e ? -1 / 0 : (n = e < .02425 ? (((((-.00778489400243029 * (t = Math.sqrt(-2 * Math.log(e))) - .322396458041136) * t - 2.40075827716184) * t - 2.54973253934373) * t + 4.37466414146497) * t + 2.93816398269878) / ((((.00778469570904146 * t + .32246712907004) * t + 2.445134137143) * t + 3.75440866190742) * t + 1) : (((((-39.6968302866538 * (r = (t = e - .5) * t) + 220.946098424521) * r - 275.928510446969) * r + 138.357751867269) * r - 30.6647980661472) * r + 2.50662827745924) * t / (((((-54.4760987982241 * r + 161.585836858041) * r - 155.698979859887) * r + 66.8013118877197) * r - 13.2806815528857) * r + 1)) - Math.sqrt(2 * Math.PI) * (.5 * f.erfcx(-n / Math.SQRT2) - Math.exp(.5 * n * n) * e)
            }
            ,
            f.invPoisson = function(e, t) {
                if (t <= 0 || e < 0 || 1 < e)
                    return NaN;
                if (0 === e)
                    return 0;
                if (1 === e)
                    return 1 / 0;
                for (var r = 1, n = 1, i = 1; Math.exp(-t) * n < e; ) {
                    if (n + (r *= t / i) === n)
                        return 1 / 0;
                    n += r,
                        i += 1
                }
                return i - 1
            }
            ,
            f.invBinom = function(e, t, r) {
                if (t !== Math.round(t))
                    return NaN;
                if (r < 0 || 1 < r)
                    return NaN;
                if (e < 0 || 1 < e)
                    return NaN;
                if (0 === e)
                    return 0;
                if (1 === e)
                    return t;
                if (0 === t)
                    return 0;
                if (1 === r)
                    return t;
                if (0 === r)
                    return 0;
                for (var n = r / (1 - r), i = Math.pow(1 - r, t), a = i, o = 1; a < e; ) {
                    if (a + (i *= (t - o + 1) / o * n) === a)
                        return t;
                    if (t < o)
                        return t;
                    a += i,
                        o += 1
                }
                return o - 1
            }
            ,
            f.invT = function(e, t) {
                return isNaN(t) || t <= 0 || e < 0 || 1 < e ? NaN : 0 === e ? -1 / 0 : 1 === e ? 1 / 0 : 1 === t || 2 === t || 4 === t ? w(t, e) : .5 === e ? 0 : .5 < e ? (r = 1 < t ? f.invNorm(e) : w(1, e),
                    n = 1 < t ? w(1, e) : Math.pow(f.tpdf(0, t) * Math.pow(t, (t - 1) / 2) / (1 - e), 1 / t),
                    P(t, e, r, n)) : -f.invT(1 - e, t);
                var r, n
            }
        ;
        var w = function(e, t) {
            var r = 4 * t * (1 - t);
            switch (e) {
                case 1:
                    return Math.tan(Math.PI * (t - .5));
                case 2:
                    return 2 * (t - .5) * Math.sqrt(2 / r);
                case 4:
                    var n = Math.cos(Math.acos(Math.sqrt(r)) / 3) / Math.sqrt(r);
                    return 2 * Math.sign(t - .5) * Math.sqrt(n - 1);
                default:
                    throw new Error("_invTSimple() must be called with 1, 2, or 4 df.")
            }
        }
            , P = function(e, t, r, n) {
            if (!isFinite(r) || !isFinite(n))
                return NaN;
            for (var i, a, o = r, s = n; ; ) {
                if (i = u(o, s),
                    a = v(e, i),
                i === o || i === s)
                    return t < a ? o : s;
                a < t ? o = i : s = i
            }
        };
        function O(e, t, r) {
            return r < 0 ? f.tcdf(-1 / 0, e, t) : 0 < r ? f.tcdf(-1 / 0, -e, t) : 2 * f.tcdf(-1 / 0, -Math.abs(e), t)
        }
        return f.invUniform = function(e, t, r) {
            return e < 0 || 1 < e || r <= t ? NaN : 0 === e ? t : 1 === e ? r : t + e * (r - t)
        }
            ,
            f.tscore = function(e, t) {
                var r = f.stdev(e);
                return (f.mean(e) - t) * Math.sqrt(e.length) / r
            }
            ,
            f.itscore = function(e, t) {
                var r = e.length
                    , n = f.mean(e)
                    , i = f.stdev(e)
                    , a = t.length
                    , o = f.mean(t)
                    , s = f.stdev(t);
                return (n - o) / (Math.sqrt(((r - 1) * i * i + (a - 1) * s * s) / (r + a - 2)) * Math.sqrt(1 / r + 1 / a))
            }
            ,
            f.ttest = function(e, t) {
                1 === arguments.length && (t = 0);
                var r = f.tscore(e, t)
                    , n = e.length - 1;
                return {
                    lessThan: O(r, n, -1),
                    greaterThan: O(r, n, 1),
                    notEqual: O(r, n, 0)
                }
            }
            ,
            f.ittest = function(e, t) {
                var r = f.itscore(e, t)
                    , n = e.length + t.length - 2;
                return {
                    lessThan: O(r, n, -1),
                    greaterThan: O(r, n, 1),
                    notEqual: O(r, n, 0)
                }
            }
            ,
            f.stats = function(e) {
                return {
                    min: f.listMin(e),
                    q1: f.quartile(e, 1),
                    median: f.median(e),
                    q3: f.quartile(e, 3),
                    max: f.listMax(e)
                }
            }
            ,
            f.length = function(e) {
                return e.length
            }
            ,
            f.listMin = function(e) {
                if (e.length < 1)
                    return NaN;
                var t = e[0];
                if (isNaN(t))
                    return NaN;
                for (var r = 1; r < e.length; r++) {
                    if (isNaN(e[r]))
                        return NaN;
                    e[r] < t && (t = e[r])
                }
                return t
            }
            ,
            f.listMax = function(e) {
                if (e.length < 1)
                    return NaN;
                var t = e[0];
                if (isNaN(t))
                    return NaN;
                for (var r = 1; r < e.length; r++) {
                    if (isNaN(e[r]))
                        return NaN;
                    e[r] >= t && (t = e[r])
                }
                return t
            }
            ,
            f.quantile = function(e, t) {
                if (!isFinite(t) || t < 0 || 1 < t)
                    return NaN;
                if (e.some(isNaN))
                    return NaN;
                if (0 === e.length)
                    return NaN;
                var r = e.length
                    , n = f.sortPerm(e)
                    , i = t * (r - 1);
                return Math.floor(i) === i ? e[n[i]] : (Math.ceil(i) - i) * e[n[Math.floor(i)]] + (i - Math.floor(i)) * e[n[Math.ceil(i)]]
            }
            ,
            f.quartile = function(e, t) {
                if (!isFinite(t) || t < 0 || 4 < t)
                    return NaN;
                if (e.some(isNaN))
                    return NaN;
                var r = f.sortPerm(e)
                    , n = f.quartileIndex(e, t)
                    , i = Math.floor(n)
                    , a = Math.ceil(n);
                return (e[r[i]] + e[r[a]]) / 2
            }
            ,
            f.sortPerm = function(r) {
                for (var e = r.length, t = [], n = 0; n < e; n++)
                    t.push(n);
                return t.sort(function(e, t) {
                    return r[e] - r[t]
                }),
                    t
            }
            ,
            f.quartileIndex = function(e, t) {
                t = Math.round(t);
                var r, n = e.length, i = n % 2 == 1;
                return 1 === n ? 0 : (0 === t && (r = 0),
                2 === t && (r = (n - 1) / 2),
                4 === t && (r = n - 1),
                1 === t && (r = i ? (n + 1) / 4 - 1 : (n + 2) / 4 - 1),
                3 === t && (r = i ? (3 * n + 3) / 4 - 1 : (3 * n + 2) / 4 - 1),
                    r)
            }
            ,
            f.upperQuantileIndex = function(e, t) {
                return f.sortPerm(e)[Math.ceil(t * (e.length - 1))] + 1
            }
            ,
            f.lowerQuantileIndex = function(e, t) {
                return f.sortPerm(e)[Math.floor(t * (e.length - 1))] + 1
            }
            ,
            f.upperQuartileIndex = function(e, t) {
                return f.sortPerm(e)[Math.ceil(f.quartileIndex(e, t))] + 1
            }
            ,
            f.lowerQuartileIndex = function(e, t) {
                return f.sortPerm(e)[Math.floor(f.quartileIndex(e, t))] + 1
            }
            ,
            f.median = function(e) {
                return f.quantile(e, .5)
            }
            ,
            f.argMin = function(e) {
                if (e.length < 1)
                    return 0;
                var t = e[0];
                if (isNaN(t))
                    return 0;
                for (var r = 0, n = 1; n < e.length; n++) {
                    if (isNaN(e[n]))
                        return 0;
                    e[n] < t && (t = e[r = n])
                }
                return r + 1
            }
            ,
            f.argMax = function(e) {
                if (e.length < 1)
                    return 0;
                var t = e[0];
                if (isNaN(t))
                    return 0;
                for (var r = 0, n = 1; n < e.length; n++)
                    if (e[n] >= t) {
                        if (isNaN(e[n]))
                            return 0;
                        t = e[r = n]
                    }
                return r + 1
            }
            ,
            f.varp = function(e) {
                for (var t = f.mean(e), r = 0, n = 0; n < e.length; n++) {
                    var i = e[n] - t;
                    r += i * i
                }
                return r / e.length
            }
            ,
            f.mad = function(e) {
                for (var t = f.mean(e), r = 0, n = 0; n < e.length; n++)
                    r += Math.abs(e[n] - t);
                return r / e.length
            }
            ,
            f.var = function(e) {
                var t = e.length;
                return f.varp(e) * t / (t - 1)
            }
            ,
            f.covp = function(e, t) {
                if (e.length !== t.length)
                    return NaN;
                for (var r = e.length, n = f.mean(e), i = f.mean(t), a = 0, o = 0; o < r; o++)
                    a += (e[o] - n) * (t[o] - i);
                return a / r
            }
            ,
            f.cov = function(e, t) {
                if (e.length !== t.length)
                    return NaN;
                var r = e.length;
                return f.covp(e, t) * r / (r - 1)
            }
            ,
            f.corr = function(e, t) {
                if (e.length !== t.length)
                    return NaN;
                for (var r, n, i = e.length, a = f.mean(e), o = f.mean(t), s = 0, u = 0, c = 0, l = 0; l < i; l++)
                    s += (r = e[l] - a) * r,
                        u += (n = t[l] - o) * n,
                        c += r * n;
                return c / Math.sqrt(s * u)
            }
            ,
            f.rank = function(e) {
                var t = e.length;
                if (0 === t)
                    return [];
                for (var r = [], n = [], i = 0; i < t; i++)
                    n.push([e[i], i]);
                n.sort(function(e, t) {
                    var r = e[0]
                        , n = t[0];
                    return r === 1 / 0 && n === 1 / 0 || r === -1 / 0 && n === -1 / 0 ? 0 : r - n
                }),
                    i = 0;
                for (var a = 1; i < t; ) {
                    for (u = i; u < t - 1 && n[u][0] === n[u + 1][0]; )
                        u += 1;
                    for (var o, s = u - i + 1, u = 0; u < s; u++)
                        r[o = n[i + u][1]] = isNaN(e[o]) ? NaN : a + .5 * (s - 1);
                    a += s,
                        i += s
                }
                return r
            }
            ,
            f.spearman = function(e, t) {
                return f.corr(f.rank(e), f.rank(t))
            }
            ,
            f.stdev = function(e) {
                return Math.sqrt(f.var(e))
            }
            ,
            f.stdevp = function(e) {
                return Math.sqrt(f.varp(e))
            }
            ,
            f.quad = t.quad,
            f.distance = function(e, t) {
                return n.hypot(t[0] - e[0], t[1] - e[1])
            }
            ,
            f.midpoint = function(e, t) {
                return [.5 * (e[0] + t[0]), .5 * (e[1] + t[1])]
            }
            ,
            f.addPoints = function(e, t) {
                return [e[0] + t[0], e[1] + t[1]]
            }
            ,
            f.subtractPoints = function(e, t) {
                return [e[0] - t[0], e[1] - t[1]]
            }
            ,
            f.negatePoint = function(e) {
                return [-e[0], -e[1]]
            }
            ,
            f.multiplyPoint = function(e, t) {
                return [t * e[0], t * e[1]]
            }
            ,
            f.dividePoint = function(e, t) {
                return [e[0] / t, e[1] / t]
            }
            ,
            f.rgb = function(e, t, r) {
                return [s(Math.round(e), 0, 255), s(Math.round(t), 0, 255), s(Math.round(r), 0, 255)]
            }
            ,
            f.hsv = function(e, t, r) {
                e = s(e, 0, 360),
                    t = s(t, 0, 1);
                var n = (r = s(r, 0, 1)) * (1 - t / 2);
                t = 0 == n || 1 == n ? 0 : (r - n) / Math.min(n, 1 - n);
                var i = o.hsl(e, t, n).rgb();
                return f.rgb(i.r, i.g, i.b)
            }
            ,
            f
    });
    _("core/math/functions", ["require", "exports", "core/math/builtin"], function(e, t, n) {
        "use strict";
        function i(e) {
            delete e.fn
        }
        function a(e) {
            e.fn = o(e.args, e.source)
        }
        function o(e, t) {
            var r = e.join(",");
            return new Function("BuiltIn","return (function(" + r + '){"use strict"; ' + t + "})")(n)
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.closureFunctionWithBuiltIn = t.createEvaluateFunction = t.rehydrateCompiledFunction = t.dehydrateCompiledFunction = t.rehydrateGraphData = t.dehydrateGraphData = void 0,
            t.dehydrateGraphData = function(e) {
                for (var t = 0, r = e; t < r.length; t++) {
                    var n = r[t].compiled;
                    n && i(n)
                }
            }
            ,
            t.rehydrateGraphData = function(e) {
                for (var t = 0, r = e; t < r.length; t++) {
                    var n = r[t].compiled;
                    n && a(n)
                }
            }
            ,
            t.dehydrateCompiledFunction = i,
            t.rehydrateCompiledFunction = a,
            t.createEvaluateFunction = function(e, t) {
                for (var r = [], n = 0; n < t; n++)
                    r.push("values[" + n + "]");
                return o(["values"], "return " + e(r))
            }
            ,
            t.closureFunctionWithBuiltIn = o
    });
    _("core/math/parser/input-span", ["require", "exports"], function(e, t) {
        "use strict";
        function r(e, t, r) {
            return {
                input: e,
                start: t,
                end: r
            }
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.slice = t.joinSpans = t.emptySpanAt = t.Span = void 0,
            t.Span = r,
            t.emptySpanAt = function(e, t) {
                return r(e, t, t)
            }
            ,
            t.joinSpans = function(e, t) {
                if (e.input !== t.input)
                    throw new Error("Programming Error: cannot form a span on different inputs");
                return r(e.input, e.start, t.end)
            }
            ,
            t.slice = function(e) {
                return e.input.slice(e.start, e.end)
            }
    });
    _("core/math/policy", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.defaultPolicy = void 0;
        var r = ["Sum", "Product", "Integral", "List", "Derivative", "Piecewise", "Exponent", "PercentOf"];
        t.defaultPolicy = {
            assignmentForbidden: function(e) {
                return !0
            },
            graphingEnabled: function() {
                return !1
            },
            isValidSlider: function(e) {
                return !1
            },
            sliderVariables: function(e) {
                return []
            },
            ansEnabled: function() {
                return !1
            },
            disabledFeatures: function() {
                return r
            }
        }
    });
    _("core/math/parsenode/base", ["require", "pjs", "core/math/functions", "core/math/parser/input-span", "core/math/policy"], function(e) {
        "use strict";
        var t = e("pjs")
            , a = e("core/math/functions")
            , i = e("core/math/parser/input-span")
            , o = e("core/math/policy").defaultPolicy;
        return t(function(e, t, r) {
            e.init = function() {
                this._dependencies = [],
                    this._dummyDependencies = [],
                    this._exports = []
            }
            ;
            var n = e.exportPenalty = 0;
            e.tmpVar = function() {
                return "tmp" + n++
            }
                ,
                e.dependencies = function() {
                    return this.getDependencies()
                }
                ,
                e.evaluateOnce = function(e) {
                    void 0 === e && (e = {});
                    var t = this.getConcreteTree(o, e).getEvaluationInfo();
                    return t ? t[0].val : NaN
                }
                ,
                e.setInputSpan = function(e) {
                    this._inputSpan = e
                }
                ,
                e.getInputString = function() {
                    return void 0 === this._inputSpan ? "" : i.slice(this._inputSpan)
                }
                ,
                e.getInputSpan = function() {
                    return this._inputSpan
                }
                ,
                e.shouldExportAns = function() {
                    return !1
                }
                ,
                e.getAnsVariable = function() {
                    return this.shouldExportAns() && this.userData && this.userData.hasOwnProperty("index") ? ["ans_" + this.userData.index] : []
                }
                ,
                e.addDependency = function(e) {
                    this.dependsOn(e) || this._dependencies.push(e)
                }
                ,
                e.addDependencies = function(e) {
                    for (var t = 0; t < e.length; t++)
                        this.addDependency(e[t])
                }
                ,
                e.addDummyDependency = function(e) {
                    -1 === this._dummyDependencies.indexOf(e) && this._dummyDependencies.push(e)
                }
                ,
                e.addDummyDependencies = function(e) {
                    for (var t = 0; t < e.length; t++)
                        this.addDummyDependency(e[t])
                }
                ,
                e.mergeDependencies = function() {
                    for (var e = 0; e < arguments.length; e++)
                        this.addDependencies(arguments[e].getDependencies()),
                            this.addDummyDependencies(arguments[e].getDummyDependencies())
                }
                ,
                e.getDependencies = function() {
                    return this._dependencies
                }
                ,
                e.getDummyDependencies = function() {
                    return this._dummyDependencies
                }
                ,
                e.removeDependency = function(e) {
                    var t = this._dependencies.indexOf(e);
                    0 <= t && this._dependencies.splice(t, 1)
                }
                ,
                e.dependsOn = function(e) {
                    return -1 < this._dependencies.indexOf(e)
                }
                ,
                e.getExports = function() {
                    return (this._exports || []).concat(this.getAnsVariable())
                }
                ,
                e.getLegalExports = function(t) {
                    return this.getExports().filter(function(e) {
                        return !t.assignmentForbidden(e)
                    })
                }
                ,
                e.exportsSymbol = function(e) {
                    return -1 < this._exports.indexOf(e)
                }
                ,
                e.exportTo = function(e, t, r) {
                    for (var n = this.getLegalExports(e), i = 0; i < n.length; i++) {
                        var a = n[i];
                        if (r[a])
                            return;
                        r[a] = t.blocksExport ? t : this
                    }
                }
                ,
                e.getOperator = function() {
                    return this.operator || "="
                }
                ,
                e.isInequality = function() {
                    return !1
                }
                ,
                e.isShadeBetween = function() {
                    return !1
                }
                ,
                e.getAllIds = function() {
                    return this.userData ? [this.userData.id] : []
                }
                ,
                e.getEvaluationInfo = function() {
                    return !1
                }
                ,
                e.shouldPromoteToSlider = function(e) {
                    return !1
                }
                ,
                e.getSliderVariables = function(e, t) {
                    return e.sliderVariables(t.getDependencies())
                }
                ,
                e.getCompiledFunction = function(e) {
                    var t, r, n = this.getEvalStrings(), i = n.statements.join(";") + ";return " + n.expression;
                    return void 0 !== e || -1 !== (t = (e = this.getDependencies()).indexOf("x")) && (r = e[0],
                        e[0] = e[t],
                        e[t] = r),
                        {
                            args: e,
                            source: i,
                            fn: a.closureFunctionWithBuiltIn(e, i)
                        }
                }
                ,
                e.getCompiledDerivative = function() {
                    var e = this.getDependencies();
                    return this.takeDerivative(e[0] || "x").getCompiledFunction()
                }
                ,
                e.asValue = function() {}
        })
    });
    _("core/math/parsenode/error", ["require", "pjs", "./base"], function(e) {
        "use strict";
        return e("pjs")(e("./base"), function(e, t) {
            e.init = function(e) {
                t.init.call(this),
                    this._msg = e,
                    this._sliderVariables = [],
                    this.blocksExport = !0
            }
                ,
                e.evaluateOnce = function(e) {
                    return this._msg
                }
                ,
                e.isError = !0,
                e.getError = function() {
                    return this._msg
                }
                ,
                e.setDependencies = function(e) {
                    return this._dependencies = e,
                        this
                }
                ,
                e.allowExport = function() {
                    return this.blocksExport = !1,
                        this
                }
        })
    });
    !function(e, t) {
        var r, n;
        "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof _ && _.amd ? _("underscore", t) : (r = e._,
                n = t(),
                (e._ = n).noConflict = function() {
                    return e._ = r,
                        n
                }
        )
    }(this, function() {
        var e = "object" == typeof self && self.self === self && self || "object" == typeof global && global.global === global && global || Function("return this")() || {}
            , n = Array.prototype
            , o = Object.prototype
            , p = "undefined" != typeof Symbol ? Symbol.prototype : null
            , i = n.push
            , u = n.slice
            , f = o.toString
            , a = o.hasOwnProperty
            , t = Array.isArray
            , s = Object.keys
            , r = Object.create
            , c = e.isNaN
            , l = e.isFinite
            , h = function() {};
        function d(e) {
            return e instanceof d ? e : this instanceof d ? void (this._wrapped = e) : new d(e)
        }
        d.VERSION = "1.10.2";
        function m(i, a, e) {
            if (void 0 === a)
                return i;
            switch (null == e ? 3 : e) {
                case 1:
                    return function(e) {
                        return i.call(a, e)
                    }
                        ;
                case 3:
                    return function(e, t, r) {
                        return i.call(a, e, t, r)
                    }
                        ;
                case 4:
                    return function(e, t, r, n) {
                        return i.call(a, e, t, r, n)
                    }
            }
            return function() {
                return i.apply(a, arguments)
            }
        }
        function g(e, t, r) {
            return null == e ? rt : ze(e) ? m(e, t, r) : (ke(e) && !Ve(e) ? it : nt)(e)
        }
        function y(e, t) {
            return g(e, t, 1 / 0)
        }
        function v(e, t, r) {
            return d.iteratee !== y ? d.iteratee(e, t) : g(e, t, r)
        }
        function b(i, a) {
            return a = null == a ? i.length - 1 : +a,
                function() {
                    for (var e = Math.max(arguments.length - a, 0), t = Array(e), r = 0; r < e; r++)
                        t[r] = arguments[r + a];
                    switch (a) {
                        case 0:
                            return i.call(this, t);
                        case 1:
                            return i.call(this, arguments[0], t);
                        case 2:
                            return i.call(this, arguments[0], arguments[1], t)
                    }
                    for (var n = Array(a + 1), r = 0; r < a; r++)
                        n[r] = arguments[r];
                    return n[a] = t,
                        i.apply(this, n)
                }
        }
        function x(e) {
            if (!ke(e))
                return {};
            if (r)
                return r(e);
            h.prototype = e;
            var t = new h;
            return h.prototype = null,
                t
        }
        function S(t) {
            return function(e) {
                return null == e ? void 0 : e[t]
            }
        }
        function _(e, t) {
            return null != e && a.call(e, t)
        }
        function E(e, t) {
            for (var r = t.length, n = 0; n < r; n++) {
                if (null == e)
                    return;
                e = e[t[n]]
            }
            return r ? e : void 0
        }
        d.iteratee = y;
        var M = Math.pow(2, 53) - 1
            , D = S("length");
        function w(e) {
            var t = D(e);
            return "number" == typeof t && 0 <= t && t <= M
        }
        function P(e, t, r) {
            if (t = m(t, r),
                w(e))
                for (i = 0,
                         a = e.length; i < a; i++)
                    t(e[i], i, e);
            else
                for (var n = _e(e), i = 0, a = n.length; i < a; i++)
                    t(e[n[i]], n[i], e);
            return e
        }
        function O(e, t, r) {
            t = v(t, r);
            for (var n = !w(e) && _e(e), i = (n || e).length, a = Array(i), o = 0; o < i; o++) {
                var s = n ? n[o] : o;
                a[o] = t(e[s], s, e)
            }
            return a
        }
        function T(u) {
            return function(e, t, r, n) {
                var i = 3 <= arguments.length;
                return function(e, t, r, n) {
                    var i = !w(e) && _e(e)
                        , a = (i || e).length
                        , o = 0 < u ? 0 : a - 1;
                    for (n || (r = e[i ? i[o] : o],
                        o += u); 0 <= o && o < a; o += u) {
                        var s = i ? i[o] : o;
                        r = t(r, e[s], s, e)
                    }
                    return r
                }(e, m(t, n, 4), r, i)
            }
        }
        var L = T(1)
            , I = T(-1);
        function C(e, t, r) {
            var n = (w(e) ? ie : Le)(e, t, r);
            if (void 0 !== n && -1 !== n)
                return e[n]
        }
        function N(e, n, t) {
            var i = [];
            return n = v(n, t),
                P(e, function(e, t, r) {
                    n(e, t, r) && i.push(e)
                }),
                i
        }
        function A(e, t, r) {
            t = v(t, r);
            for (var n = !w(e) && _e(e), i = (n || e).length, a = 0; a < i; a++) {
                var o = n ? n[a] : a;
                if (!t(e[o], o, e))
                    return !1
            }
            return !0
        }
        function F(e, t, r) {
            t = v(t, r);
            for (var n = !w(e) && _e(e), i = (n || e).length, a = 0; a < i; a++) {
                var o = n ? n[a] : a;
                if (t(e[o], o, e))
                    return !0
            }
            return !1
        }
        function q(e, t, r, n) {
            return w(e) || (e = Me(e)),
            "number" == typeof r && !n || (r = 0),
            0 <= ue(e, t, r)
        }
        var R = b(function(e, r, n) {
            var i, a;
            return ze(r) ? a = r : Ve(r) && (i = r.slice(0, -1),
                r = r[r.length - 1]),
                O(e, function(e) {
                    var t = a;
                    if (!t) {
                        if (i && i.length && (e = E(e, i)),
                        null == e)
                            return;
                        t = e[r]
                    }
                    return null == t ? t : t.apply(e, n)
                })
        });
        function B(e, t) {
            return O(e, nt(t))
        }
        function V(e, n, t) {
            var r, i, a = -1 / 0, o = -1 / 0;
            if (null == n || "number" == typeof n && "object" != typeof e[0] && null != e)
                for (var s = 0, u = (e = w(e) ? e : Me(e)).length; s < u; s++)
                    null != (r = e[s]) && a < r && (a = r);
            else
                n = v(n, t),
                    P(e, function(e, t, r) {
                        i = n(e, t, r),
                        (o < i || i === -1 / 0 && a === -1 / 0) && (a = e,
                            o = i)
                    });
            return a
        }
        function k(e, t, r) {
            if (null == t || r)
                return w(e) || (e = Me(e)),
                    e[at(e.length - 1)];
            var n = (w(e) ? Fe : Me)(e)
                , i = D(n);
            t = Math.max(Math.min(t, i), 0);
            for (var a = i - 1, o = 0; o < t; o++) {
                var s = at(o, a)
                    , u = n[o];
                n[o] = n[s],
                    n[s] = u
            }
            return n.slice(0, t)
        }
        function j(o, t) {
            return function(n, i, e) {
                var a = t ? [[], []] : {};
                return i = v(i, e),
                    P(n, function(e, t) {
                        var r = i(e, t, n);
                        o(a, e, r)
                    }),
                    a
            }
        }
        var z = j(function(e, t, r) {
            _(e, r) ? e[r].push(t) : e[r] = [t]
        })
            , U = j(function(e, t, r) {
            e[r] = t
        })
            , G = j(function(e, t, r) {
            _(e, r) ? e[r]++ : e[r] = 1
        })
            , W = /[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;
        var Y = j(function(e, t, r) {
            e[r ? 0 : 1].push(t)
        }, !0);
        function X(e, t, r) {
            return null == e || e.length < 1 ? null == t ? void 0 : [] : null == t || r ? e[0] : H(e, e.length - t)
        }
        function H(e, t, r) {
            return u.call(e, 0, Math.max(0, e.length - (null == t || r ? 1 : t)))
        }
        function Z(e, t, r) {
            return u.call(e, null == t || r ? 1 : t)
        }
        function K(e, t, r, n) {
            for (var i = (n = n || []).length, a = 0, o = D(e); a < o; a++) {
                var s = e[a];
                if (w(s) && (Ve(s) || je(s)))
                    if (t)
                        for (var u = 0, c = s.length; u < c; )
                            n[i++] = s[u++];
                    else
                        K(s, t, r, n),
                            i = n.length;
                else
                    r || (n[i++] = s)
            }
            return n
        }
        var $ = b(function(e, t) {
            return ee(e, t)
        });
        function Q(e, t, r, n) {
            tt(t) || (n = r,
                r = t,
                t = !1),
            null != r && (r = v(r, n));
            for (var i = [], a = [], o = 0, s = D(e); o < s; o++) {
                var u = e[o]
                    , c = r ? r(u, o, e) : u;
                t && !r ? (o && a === c || i.push(u),
                    a = c) : r ? q(a, c) || (a.push(c),
                    i.push(u)) : q(i, u) || i.push(u)
            }
            return i
        }
        var J = b(function(e) {
            return Q(K(e, !0, !0))
        });
        var ee = b(function(e, t) {
            return t = K(t, !0, !0),
                N(e, function(e) {
                    return !q(t, e)
                })
        });
        function te(e) {
            for (var t = e && V(e, D).length || 0, r = Array(t), n = 0; n < t; n++)
                r[n] = B(e, n);
            return r
        }
        var re = b(te);
        function ne(a) {
            return function(e, t, r) {
                t = v(t, r);
                for (var n = D(e), i = 0 < a ? 0 : n - 1; 0 <= i && i < n; i += a)
                    if (t(e[i], i, e))
                        return i;
                return -1
            }
        }
        var ie = ne(1)
            , ae = ne(-1);
        function oe(e, t, r, n) {
            for (var i = (r = v(r, n, 1))(t), a = 0, o = D(e); a < o; ) {
                var s = Math.floor((a + o) / 2);
                r(e[s]) < i ? a = s + 1 : o = s
            }
            return a
        }
        function se(a, o, s) {
            return function(e, t, r) {
                var n = 0
                    , i = D(e);
                if ("number" == typeof r)
                    0 < a ? n = 0 <= r ? r : Math.max(r + i, n) : i = 0 <= r ? Math.min(r + 1, i) : r + i + 1;
                else if (s && r && i)
                    return e[r = s(e, t)] === t ? r : -1;
                if (t != t)
                    return 0 <= (r = o(u.call(e, n, i), et)) ? r + n : -1;
                for (r = 0 < a ? n : i - 1; 0 <= r && r < i; r += a)
                    if (e[r] === t)
                        return r;
                return -1
            }
        }
        var ue = se(1, ie, oe)
            , ce = se(-1, ae);
        function le(e, t, r, n, i) {
            if (!(n instanceof t))
                return e.apply(r, i);
            var a = x(e.prototype)
                , o = e.apply(a, i);
            return ke(o) ? o : a
        }
        var pe = b(function(t, r, n) {
            if (!ze(t))
                throw new TypeError("Bind must be called on a function");
            var i = b(function(e) {
                return le(t, i, r, this, n.concat(e))
            });
            return i
        })
            , fe = b(function(i, a) {
            var o = fe.placeholder
                , s = function() {
                for (var e = 0, t = a.length, r = Array(t), n = 0; n < t; n++)
                    r[n] = a[n] === o ? arguments[e++] : a[n];
                for (; e < arguments.length; )
                    r.push(arguments[e++]);
                return le(i, s, this, this, r)
            };
            return s
        });
        fe.placeholder = d;
        var he = b(function(e, t) {
            var r = (t = K(t, !1, !1)).length;
            if (r < 1)
                throw new Error("bindAll must be passed function names");
            for (; r--; ) {
                var n = t[r];
                e[n] = pe(e[n], e)
            }
        });
        var de = b(function(e, t, r) {
            return setTimeout(function() {
                return e.apply(null, r)
            }, t)
        })
            , me = fe(de, d, 1);
        function ge(e) {
            return function() {
                return !e.apply(this, arguments)
            }
        }
        function ye(e, t) {
            var r;
            return function() {
                return 0 < --e && (r = t.apply(this, arguments)),
                e <= 1 && (t = null),
                    r
            }
        }
        var ve = fe(ye, 2)
            , be = !{
            toString: null
        }.propertyIsEnumerable("toString")
            , xe = ["valueOf", "isPrototypeOf", "toString", "propertyIsEnumerable", "hasOwnProperty", "toLocaleString"];
        function Se(e, t) {
            var r = xe.length
                , n = e.constructor
                , i = ze(n) && n.prototype || o
                , a = "constructor";
            for (_(e, a) && !q(t, a) && t.push(a); r--; )
                (a = xe[r])in e && e[a] !== i[a] && !q(t, a) && t.push(a)
        }
        function _e(e) {
            if (!ke(e))
                return [];
            if (s)
                return s(e);
            var t = [];
            for (var r in e)
                _(e, r) && t.push(r);
            return be && Se(e, t),
                t
        }
        function Ee(e) {
            if (!ke(e))
                return [];
            var t = [];
            for (var r in e)
                t.push(r);
            return be && Se(e, t),
                t
        }
        function Me(e) {
            for (var t = _e(e), r = t.length, n = Array(r), i = 0; i < r; i++)
                n[i] = e[t[i]];
            return n
        }
        function De(e) {
            for (var t = {}, r = _e(e), n = 0, i = r.length; n < i; n++)
                t[e[r[n]]] = r[n];
            return t
        }
        function we(e) {
            var t = [];
            for (var r in e)
                ze(e[r]) && t.push(r);
            return t.sort()
        }
        function Pe(u, c) {
            return function(e) {
                var t = arguments.length;
                if (c && (e = Object(e)),
                t < 2 || null == e)
                    return e;
                for (var r = 1; r < t; r++)
                    for (var n = arguments[r], i = u(n), a = i.length, o = 0; o < a; o++) {
                        var s = i[o];
                        c && void 0 !== e[s] || (e[s] = n[s])
                    }
                return e
            }
        }
        var Oe = Pe(Ee)
            , Te = Pe(_e);
        function Le(e, t, r) {
            t = v(t, r);
            for (var n, i = _e(e), a = 0, o = i.length; a < o; a++)
                if (t(e[n = i[a]], n, e))
                    return n
        }
        function Ie(e, t, r) {
            return t in r
        }
        var Ce = b(function(e, t) {
            var r = {}
                , n = t[0];
            if (null == e)
                return r;
            ze(n) ? (1 < t.length && (n = m(n, t[1])),
                t = Ee(e)) : (n = Ie,
                t = K(t, !1, !1),
                e = Object(e));
            for (var i = 0, a = t.length; i < a; i++) {
                var o = t[i]
                    , s = e[o];
                n(s, o, e) && (r[o] = s)
            }
            return r
        })
            , Ne = b(function(e, r) {
            var t, n = r[0];
            return ze(n) ? (n = ge(n),
            1 < r.length && (t = r[1])) : (r = O(K(r, !1, !1), String),
                    n = function(e, t) {
                        return !q(r, t)
                    }
            ),
                Ce(e, n, t)
        })
            , Ae = Pe(Ee, !0);
        function Fe(e) {
            return ke(e) ? Ve(e) ? e.slice() : Oe({}, e) : e
        }
        function qe(e, t) {
            var r = _e(t)
                , n = r.length;
            if (null == e)
                return !n;
            for (var i = Object(e), a = 0; a < n; a++) {
                var o = r[a];
                if (t[o] !== i[o] || !(o in i))
                    return !1
            }
            return !0
        }
        function Re(e, t, r, n) {
            if (e === t)
                return 0 !== e || 1 / e == 1 / t;
            if (null == e || null == t)
                return !1;
            if (e != e)
                return t != t;
            var i = typeof e;
            return ("function" == i || "object" == i || "object" == typeof t) && function(e, t, r, n) {
                e instanceof d && (e = e._wrapped);
                t instanceof d && (t = t._wrapped);
                var i = f.call(e);
                if (i !== f.call(t))
                    return !1;
                switch (i) {
                    case "[object RegExp]":
                    case "[object String]":
                        return "" + e == "" + t;
                    case "[object Number]":
                        return +e != +e ? +t != +t : 0 == +e ? 1 / e == 1 / t : +e == +t;
                    case "[object Date]":
                    case "[object Boolean]":
                        return +e == +t;
                    case "[object Symbol]":
                        return p.valueOf.call(e) === p.valueOf.call(t)
                }
                var a = "[object Array]" === i;
                if (!a) {
                    if ("object" != typeof e || "object" != typeof t)
                        return !1;
                    var o = e.constructor
                        , s = t.constructor;
                    if (o !== s && !(ze(o) && o instanceof o && ze(s) && s instanceof s) && "constructor"in e && "constructor"in t)
                        return !1
                }
                n = n || [];
                var u = (r = r || []).length;
                for (; u--; )
                    if (r[u] === e)
                        return n[u] === t;
                if (r.push(e),
                    n.push(t),
                    a) {
                    if ((u = e.length) !== t.length)
                        return !1;
                    for (; u--; )
                        if (!Re(e[u], t[u], r, n))
                            return !1
                } else {
                    var c, l = _e(e);
                    if (u = l.length,
                    _e(t).length !== u)
                        return !1;
                    for (; u--; )
                        if (c = l[u],
                        !_(t, c) || !Re(e[c], t[c], r, n))
                            return !1
                }
                return r.pop(),
                    n.pop(),
                    !0
            }(e, t, r, n)
        }
        function Be(t) {
            return function(e) {
                return f.call(e) === "[object " + t + "]"
            }
        }
        var Ve = t || Be("Array");
        function ke(e) {
            var t = typeof e;
            return "function" == t || "object" == t && !!e
        }
        var je = Be("Arguments")
            , ze = Be("Function")
            , Ue = Be("String")
            , Ge = Be("Number")
            , We = Be("Date")
            , Ye = Be("RegExp")
            , Xe = Be("Error")
            , He = Be("Symbol")
            , Ze = Be("Map")
            , Ke = Be("WeakMap")
            , $e = Be("Set")
            , Qe = Be("WeakSet");
        !function() {
            je(arguments) || (je = function(e) {
                    return _(e, "callee")
                }
            )
        }();
        var Je = e.document && e.document.childNodes;
        function et(e) {
            return Ge(e) && c(e)
        }
        function tt(e) {
            return !0 === e || !1 === e || "[object Boolean]" === f.call(e)
        }
        function rt(e) {
            return e
        }
        function nt(t) {
            return Ve(t) ? function(e) {
                    return E(e, t)
                }
                : S(t)
        }
        function it(t) {
            return t = Te({}, t),
                function(e) {
                    return qe(e, t)
                }
        }
        function at(e, t) {
            return null == t && (t = e,
                e = 0),
            e + Math.floor(Math.random() * (t - e + 1))
        }
        "function" != typeof /./ && "object" != typeof Int8Array && "function" != typeof Je && (ze = function(e) {
                return "function" == typeof e || !1
            }
        );
        var ot = Date.now || function() {
            return (new Date).getTime()
        }
            , st = {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#x27;",
            "`": "&#x60;"
        }
            , ut = De(st);
        function ct(t) {
            function r(e) {
                return t[e]
            }
            var e = "(?:" + _e(t).join("|") + ")"
                , n = RegExp(e)
                , i = RegExp(e, "g");
            return function(e) {
                return e = null == e ? "" : "" + e,
                    n.test(e) ? e.replace(i, r) : e
            }
        }
        var lt = ct(st)
            , pt = ct(ut);
        var ft = 0;
        function ht(e) {
            return "\\" + gt[e]
        }
        var dt = d.templateSettings = {
            evaluate: /<%([\s\S]+?)%>/g,
            interpolate: /<%=([\s\S]+?)%>/g,
            escape: /<%-([\s\S]+?)%>/g
        }
            , mt = /(.)^/
            , gt = {
            "'": "'",
            "\\": "\\",
            "\r": "r",
            "\n": "n",
            "\u2028": "u2028",
            "\u2029": "u2029"
        }
            , yt = /\\|'|\r|\n|\u2028|\u2029/g;
        function vt(e, t) {
            return e._chain ? d(t).chain() : t
        }
        function bt(r) {
            return P(we(r), function(e) {
                var t = d[e] = r[e];
                d.prototype[e] = function() {
                    var e = [this._wrapped];
                    return i.apply(e, arguments),
                        vt(this, t.apply(d, e))
                }
            }),
                d
        }
        P(["pop", "push", "reverse", "shift", "sort", "splice", "unshift"], function(t) {
            var r = n[t];
            d.prototype[t] = function() {
                var e = this._wrapped;
                return r.apply(e, arguments),
                "shift" !== t && "splice" !== t || 0 !== e.length || delete e[0],
                    vt(this, e)
            }
        }),
            P(["concat", "join", "slice"], function(e) {
                var t = n[e];
                d.prototype[e] = function() {
                    return vt(this, t.apply(this._wrapped, arguments))
                }
            }),
            d.prototype.valueOf = d.prototype.toJSON = d.prototype.value = function() {
                return this._wrapped
            }
            ,
            d.prototype.toString = function() {
                return String(this._wrapped)
            }
        ;
        var xt = bt({
            default: d,
            VERSION: "1.10.2",
            iteratee: y,
            restArguments: b,
            each: P,
            forEach: P,
            map: O,
            collect: O,
            reduce: L,
            foldl: L,
            inject: L,
            reduceRight: I,
            foldr: I,
            find: C,
            detect: C,
            filter: N,
            select: N,
            reject: function(e, t, r) {
                return N(e, ge(v(t)), r)
            },
            every: A,
            all: A,
            some: F,
            any: F,
            contains: q,
            includes: q,
            include: q,
            invoke: R,
            pluck: B,
            where: function(e, t) {
                return N(e, it(t))
            },
            findWhere: function(e, t) {
                return C(e, it(t))
            },
            max: V,
            min: function(e, n, t) {
                var r, i, a = 1 / 0, o = 1 / 0;
                if (null == n || "number" == typeof n && "object" != typeof e[0] && null != e)
                    for (var s = 0, u = (e = w(e) ? e : Me(e)).length; s < u; s++)
                        null != (r = e[s]) && r < a && (a = r);
                else
                    n = v(n, t),
                        P(e, function(e, t, r) {
                            ((i = n(e, t, r)) < o || i === 1 / 0 && a === 1 / 0) && (a = e,
                                o = i)
                        });
                return a
            },
            shuffle: function(e) {
                return k(e, 1 / 0)
            },
            sample: k,
            sortBy: function(e, n, t) {
                var i = 0;
                return n = v(n, t),
                    B(O(e, function(e, t, r) {
                        return {
                            value: e,
                            index: i++,
                            criteria: n(e, t, r)
                        }
                    }).sort(function(e, t) {
                        var r = e.criteria
                            , n = t.criteria;
                        if (r !== n) {
                            if (n < r || void 0 === r)
                                return 1;
                            if (r < n || void 0 === n)
                                return -1
                        }
                        return e.index - t.index
                    }), "value")
            },
            groupBy: z,
            indexBy: U,
            countBy: G,
            toArray: function(e) {
                return e ? Ve(e) ? u.call(e) : Ue(e) ? e.match(W) : w(e) ? O(e, rt) : Me(e) : []
            },
            size: function(e) {
                return null == e ? 0 : w(e) ? e.length : _e(e).length
            },
            partition: Y,
            first: X,
            head: X,
            take: X,
            initial: H,
            last: function(e, t, r) {
                return null == e || e.length < 1 ? null == t ? void 0 : [] : null == t || r ? e[e.length - 1] : Z(e, Math.max(0, e.length - t))
            },
            rest: Z,
            tail: Z,
            drop: Z,
            compact: function(e) {
                return N(e, Boolean)
            },
            flatten: function(e, t) {
                return K(e, t, !1)
            },
            without: $,
            uniq: Q,
            unique: Q,
            union: J,
            intersection: function(e) {
                for (var t = [], r = arguments.length, n = 0, i = D(e); n < i; n++) {
                    var a = e[n];
                    if (!q(t, a)) {
                        for (var o = 1; o < r && q(arguments[o], a); o++)
                            ;
                        o === r && t.push(a)
                    }
                }
                return t
            },
            difference: ee,
            unzip: te,
            zip: re,
            object: function(e, t) {
                for (var r = {}, n = 0, i = D(e); n < i; n++)
                    t ? r[e[n]] = t[n] : r[e[n][0]] = e[n][1];
                return r
            },
            findIndex: ie,
            findLastIndex: ae,
            sortedIndex: oe,
            indexOf: ue,
            lastIndexOf: ce,
            range: function(e, t, r) {
                null == t && (t = e || 0,
                    e = 0),
                    r = r || (t < e ? -1 : 1);
                for (var n = Math.max(Math.ceil((t - e) / r), 0), i = Array(n), a = 0; a < n; a++,
                    e += r)
                    i[a] = e;
                return i
            },
            chunk: function(e, t) {
                if (null == t || t < 1)
                    return [];
                for (var r = [], n = 0, i = e.length; n < i; )
                    r.push(u.call(e, n, n += t));
                return r
            },
            bind: pe,
            partial: fe,
            bindAll: he,
            memoize: function(n, i) {
                var a = function(e) {
                    var t = a.cache
                        , r = "" + (i ? i.apply(this, arguments) : e);
                    return _(t, r) || (t[r] = n.apply(this, arguments)),
                        t[r]
                };
                return a.cache = {},
                    a
            },
            delay: de,
            defer: me,
            throttle: function(r, n, i) {
                var a, o, s, u, c = 0;
                function l() {
                    c = !1 === i.leading ? 0 : ot(),
                        a = null,
                        u = r.apply(o, s),
                    a || (o = s = null)
                }
                function e() {
                    var e = ot();
                    c || !1 !== i.leading || (c = e);
                    var t = n - (e - c);
                    return o = this,
                        s = arguments,
                        t <= 0 || n < t ? (a && (clearTimeout(a),
                            a = null),
                            c = e,
                            u = r.apply(o, s),
                        a || (o = s = null)) : a || !1 === i.trailing || (a = setTimeout(l, t)),
                        u
                }
                return i = i || {},
                    e.cancel = function() {
                        clearTimeout(a),
                            c = 0,
                            a = o = s = null
                    }
                    ,
                    e
            },
            debounce: function(r, n, i) {
                function a(e, t) {
                    o = null,
                    t && (s = r.apply(e, t))
                }
                var o, s, e = b(function(e) {
                    var t;
                    return o && clearTimeout(o),
                        i ? (t = !o,
                            o = setTimeout(a, n),
                        t && (s = r.apply(this, e))) : o = de(a, n, this, e),
                        s
                });
                return e.cancel = function() {
                    clearTimeout(o),
                        o = null
                }
                    ,
                    e
            },
            wrap: function(e, t) {
                return fe(t, e)
            },
            negate: ge,
            compose: function() {
                var r = arguments
                    , n = r.length - 1;
                return function() {
                    for (var e = n, t = r[n].apply(this, arguments); e--; )
                        t = r[e].call(this, t);
                    return t
                }
            },
            after: function(e, t) {
                return function() {
                    if (--e < 1)
                        return t.apply(this, arguments)
                }
            },
            before: ye,
            once: ve,
            keys: _e,
            allKeys: Ee,
            values: Me,
            mapObject: function(e, t, r) {
                t = v(t, r);
                for (var n = _e(e), i = n.length, a = {}, o = 0; o < i; o++) {
                    var s = n[o];
                    a[s] = t(e[s], s, e)
                }
                return a
            },
            pairs: function(e) {
                for (var t = _e(e), r = t.length, n = Array(r), i = 0; i < r; i++)
                    n[i] = [t[i], e[t[i]]];
                return n
            },
            invert: De,
            functions: we,
            methods: we,
            extend: Oe,
            extendOwn: Te,
            assign: Te,
            findKey: Le,
            pick: Ce,
            omit: Ne,
            defaults: Ae,
            create: function(e, t) {
                var r = x(e);
                return t && Te(r, t),
                    r
            },
            clone: Fe,
            tap: function(e, t) {
                return t(e),
                    e
            },
            isMatch: qe,
            isEqual: function(e, t) {
                return Re(e, t)
            },
            isEmpty: function(e) {
                return null == e || (w(e) && (Ve(e) || Ue(e) || je(e)) ? 0 === e.length : 0 === _e(e).length)
            },
            isElement: function(e) {
                return !(!e || 1 !== e.nodeType)
            },
            isArray: Ve,
            isObject: ke,
            isArguments: je,
            isFunction: ze,
            isString: Ue,
            isNumber: Ge,
            isDate: We,
            isRegExp: Ye,
            isError: Xe,
            isSymbol: He,
            isMap: Ze,
            isWeakMap: Ke,
            isSet: $e,
            isWeakSet: Qe,
            isFinite: function(e) {
                return !He(e) && l(e) && !c(parseFloat(e))
            },
            isNaN: et,
            isBoolean: tt,
            isNull: function(e) {
                return null === e
            },
            isUndefined: function(e) {
                return void 0 === e
            },
            has: function(e, t) {
                if (!Ve(t))
                    return _(e, t);
                for (var r = t.length, n = 0; n < r; n++) {
                    var i = t[n];
                    if (null == e || !a.call(e, i))
                        return !1;
                    e = e[i]
                }
                return !!r
            },
            identity: rt,
            constant: function(e) {
                return function() {
                    return e
                }
            },
            noop: function() {},
            property: nt,
            propertyOf: function(t) {
                return null == t ? function() {}
                    : function(e) {
                        return Ve(e) ? E(t, e) : t[e]
                    }
            },
            matcher: it,
            matches: it,
            times: function(e, t, r) {
                var n = Array(Math.max(0, e));
                t = m(t, r, 1);
                for (var i = 0; i < e; i++)
                    n[i] = t(i);
                return n
            },
            random: at,
            now: ot,
            escape: lt,
            unescape: pt,
            result: function(e, t, r) {
                Ve(t) || (t = [t]);
                var n = t.length;
                if (!n)
                    return ze(r) ? r.call(e) : r;
                for (var i = 0; i < n; i++) {
                    var a = null == e ? void 0 : e[t[i]];
                    void 0 === a && (a = r,
                        i = n),
                        e = ze(a) ? a.call(e) : a
                }
                return e
            },
            uniqueId: function(e) {
                var t = ++ft + "";
                return e ? e + t : t
            },
            templateSettings: dt,
            template: function(a, e, t) {
                !e && t && (e = t),
                    e = Ae({}, e, d.templateSettings);
                var r, n = RegExp([(e.escape || mt).source, (e.interpolate || mt).source, (e.evaluate || mt).source].join("|") + "|$", "g"), o = 0, s = "__p+='";
                a.replace(n, function(e, t, r, n, i) {
                    return s += a.slice(o, i).replace(yt, ht),
                        o = i + e.length,
                        t ? s += "'+\n((__t=(" + t + "))==null?'':_.escape(__t))+\n'" : r ? s += "'+\n((__t=(" + r + "))==null?'':__t)+\n'" : n && (s += "';\n" + n + "\n__p+='"),
                        e
                }),
                    s += "';\n",
                e.variable || (s = "with(obj||{}){\n" + s + "}\n"),
                    s = "var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n" + s + "return __p;\n";
                try {
                    r = new Function(e.variable || "obj","_",s)
                } catch (e) {
                    throw e.source = s,
                        e
                }
                function i(e) {
                    return r.call(this, e, d)
                }
                var u = e.variable || "obj";
                return i.source = "function(" + u + "){\n" + s + "}",
                    i
            },
            chain: function(e) {
                var t = d(e);
                return t._chain = !0,
                    t
            },
            mixin: bt
        });
        return xt._ = xt
    });
    _("core/lib/label", ["require", "exports", "underscore", "core/math/distance", "core/math/tofraction"], function(e, t, n, u, l) {
        "use strict";
        function a(e, t) {
            if (void 0 === t && (t = e),
            isNaN(e) || !isFinite(e))
                return {
                    ariaString: "undefined",
                    string: "undefined",
                    value: e
                };
            if (0 === e)
                return {
                    ariaString: "0",
                    string: "0",
                    value: e
                };
            Math.abs(e) > Math.abs(t) && (t = e);
            var r = l.default(e / Math.PI, 24);
            if (m(t) && u.approx(r.n / r.d * Math.PI, e, 3))
                return {
                    ariaString: p(n = (0 === r.n ? "0" : 1 === r.n ? "" : -1 === r.n ? "-" : r.n.toString() + "") + (1 === r.d ? "" : "/" + r.d.toString())),
                    string: n,
                    value: r.n / r.d * Math.PI
                };
            if (m(t))
                return {
                    ariaString: p(n = "-0" === (i = h(e.toFixed(g(t)))) ? "0" : i),
                    string: n,
                    value: parseFloat(n)
                };
            var n, i, a = d(e.toExponential(g(t / e))).split("e"), o = a[0] + "10", s = a[1].replace("+", "");
            return {
                ariaString: p(n = d(e.toExponential(g(t / e))).replace("+", "")),
                string: n,
                mantissa: o,
                superscript: s,
                value: parseFloat(n)
            }
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.trimLatex = t.latexToIdentifier = t.identifierToHTML = t.identifierToLatex = t.formatSymbol = t.truncatedAriaLabel = t.truncatedLatexLabel = t.truncatedPlainmathLabel = t.truncatedHTMLLabel = t.numericLabel = t.canDisplayAsFraction = t.point = t.value = void 0,
            t.value = a;
        var r = {
            "[e]": " times 10 to the ",
            "[+]": " plus ",
            "[-]": " minus ",
            "[*]": " times ",
            "[/]": " over ",
            "[]": " pi ",
            "[]": " tau ",
            "[]": " theta ",
            "[]": " phi "
        }
            , i = new RegExp(Object.keys(r).join("|"),"gi");
        function o(e) {
            return r["[" + e + "]"]
        }
        var s = /\.\d+/g;
        function c(e) {
            return e[0] + e.slice(1).split("").join(" ")
        }
        function p(e) {
            return e.replace(s, c).replace(i, o).replace(/ +/gi, " ").trim()
        }
        t.point = function(e, t, r, n) {
            var i = a(e, t);
            return [i, a(n(i.value), r)]
        }
        ;
        var f = /\.?0+$/;
        function h(e) {
            return -1 === e.indexOf(".") ? e : e.replace(f, "")
        }
        function d(e) {
            return e.replace(/\.?0+e/, "e")
        }
        function m(e) {
            return 1e-4 < (e = Math.abs(e)) && e < 1e7
        }
        function g(e) {
            return e = Math.abs(e),
                e = Math.max(e, 1e-16),
                Math.max(3, Math.floor(4.5 - Math.log(e) / Math.LN10))
        }
        function y(e) {
            return 1e6 / Math.sqrt(Math.abs(e))
        }
        function v(e) {
            var t = y(e);
            if (t < 1)
                return !1;
            if (1e12 < t)
                return !1;
            var r = l.default(e, t)
                , n = r.n
                , i = r.d;
            return 1 !== i && e === e + Math.pow(2, -3) * Math.abs(n / i - e)
        }
        function b(e, t) {
            if (t = t || {},
            isNaN(e) || !isFinite(e))
                return {
                    type: "undefined"
                };
            if (0 === e || t.zeroCutoff && Math.abs(e) < t.zeroCutoff)
                return {
                    type: "decimal",
                    value: "0"
                };
            var r = t.smallCutoff || .001
                , n = t.bigCutoff || 1e6
                , i = t.digits || 10
                , a = d(e.toExponential(i - 2)).match(/([\d\.\-]+)e\+?([\d\-]+)/);
            if (!a)
                return {
                    type: "undefined"
                };
            var o = parseInt(a[2], 10) >= i
                , s = v(e);
            if (Math.abs(e) > n || Math.abs(e) < r || o)
                return {
                    type: "scientific",
                    mantissa: a[1],
                    exponent: a[2]
                };
            if (s && t.displayAsFraction) {
                var u = l.default(e, y(e));
                return {
                    type: "fraction",
                    numerator: u.n.toString(),
                    denominator: u.d.toString()
                }
            }
            var c = h(e.toPrecision(i));
            return e !== Number(c) && t.addEllipses && (c += "..."),
                {
                    type: "decimal",
                    value: c
                }
        }
        function x(e) {
            e = e.replace("\\", "");
            var t = {
                pi: "",
                tau: "",
                theta: "",
                phi: "",
                div: "",
                cdot: "",
                times: "",
                lt: "<",
                gt: ">",
                le: "",
                ge: "",
                sim: "",
                ldots: "",
                prime: "",
                approx: ""
            };
            return t.hasOwnProperty(e) ? t[e] : e
        }
        t.canDisplayAsFraction = v,
            t.numericLabel = b,
            t.truncatedHTMLLabel = function(e, t) {
                var r = b(e, t);
                switch (r.type) {
                    case "undefined":
                        return "undefined";
                    case "decimal":
                        return r.value;
                    case "scientific":
                        return r.mantissa + "<span class='dcg-cross'></span>10<sup>" + r.exponent + "</sup>";
                    case "fraction":
                        return "1" === r.denominator ? r.numerator : r.numerator + "/" + r.denominator;
                    default:
                        return r
                }
            }
            ,
            t.truncatedPlainmathLabel = function(e, t) {
                var r = b(e, t);
                switch (r.type) {
                    case "undefined":
                        return "undefined";
                    case "decimal":
                        return r.value;
                    case "scientific":
                        return r.mantissa + " * 10^" + r.exponent;
                    case "fraction":
                        return "1" === r.denominator ? r.numerator : r.numerator + "/" + r.denominator;
                    default:
                        return r
                }
            }
            ,
            t.truncatedLatexLabel = function(e, t) {
                var r = b(e, t);
                switch (r.type) {
                    case "undefined":
                        return "undefined";
                    case "decimal":
                        return r.value;
                    case "scientific":
                        return r.mantissa + "\\times10^{" + r.exponent + "}";
                    case "fraction":
                        return "1" === r.denominator ? r.numerator : "-" === r.numerator[0] ? "-\\frac{" + r.numerator.slice(1) + "}{" + r.denominator + "}" : "\\frac{" + r.numerator + "}{" + r.denominator + "}";
                    default:
                        return r
                }
            }
            ,
            t.truncatedAriaLabel = function(e, t) {
                var r = b(e, t);
                switch (r.type) {
                    case "undefined":
                        return "undefined";
                    case "decimal":
                        return p(r.value);
                    case "scientific":
                        return p(r.mantissa + "e" + r.exponent);
                    case "fraction":
                        return p(r.numerator + "/" + r.denominator);
                    default:
                        return r
                }
            }
            ,
            t.formatSymbol = x,
            t.identifierToLatex = function(e) {
                var t = e.split("_")
                    , r = "";
                return 1 < t[0].length && (r += "\\"),
                    r += t[0],
                t[1] && (r += "_{" + t[1] + "}"),
                    r
            }
            ,
            t.identifierToHTML = function(e) {
                if (!e)
                    return "";
                var t = e.split("_").map(x).map(n.escape)
                    , r = t[0];
                return t[1] && (r += "<sub>" + t[1] + "</sub>"),
                    r
            }
            ,
            t.latexToIdentifier = function(e) {
                return (e = e.replace(/\\operatorname\{(.*)\}/, "$1")).replace(/[{}\\]/g, "")
            }
            ,
            t.trimLatex = function(e) {
                return e.replace(/^(\\ | |\\space)+/, "").replace(/(\\ | |\\space)+$/, "")
            }
    });
    _("core/math/types", ["require", "exports", "core/lib/worker-i18n"], function(e, t, r) {
        "use strict";
        function n(e) {
            switch (e) {
                case t.Any:
                    return "Any";
                case t.Number:
                    return "Number";
                case t.Bool:
                    return "Bool";
                case t.Point:
                    return "Point";
                case t.Distribution:
                    return "Distribution";
                case t.ListOfAny:
                    return "ListOfAny";
                case t.ListOfNumber:
                    return "ListOfNumber";
                case t.ListOfBool:
                    return "ListOfBool";
                case t.ListOfPoint:
                    return "ListOfPoint";
                case t.ListOfDistribution:
                    return "ListOfDistribution";
                case t.EmptyList:
                    return "EmptyList";
                case t.ErrorType:
                    return "ErrorType";
                case t.SeedType:
                    return "SeedType";
                case t.RGBColor:
                    return "RGBColor";
                case t.ListOfColor:
                    return "ListOfColor";
                default:
                    throw new Error("Invalid type: " + e)
            }
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.isOneOf = t.hasListType = t.listType = t.elementType = t.isList = t.prettyPrint = t.repr = t.ListOfColor = t.RGBColor = t.SeedType = t.ErrorType = t.EmptyList = t.ListOfDistribution = t.ListOfPoint = t.ListOfBool = t.ListOfNumber = t.ListOfAny = t.Distribution = t.Point = t.Bool = t.Number = t.Any = void 0,
            t.Any = 0,
            t.Number = 1,
            t.Bool = 2,
            t.Point = 3,
            t.Distribution = 4,
            t.ListOfAny = 5,
            t.ListOfNumber = 6,
            t.ListOfBool = 7,
            t.ListOfPoint = 8,
            t.ListOfDistribution = 9,
            t.EmptyList = 10,
            t.ErrorType = 11,
            t.SeedType = 12,
            t.RGBColor = 13,
            t.ListOfColor = 14,
            t.repr = n,
            t.prettyPrint = function(e) {
                switch (e) {
                    case t.Any:
                        return r.s("shared-calculator-label-value-type-any");
                    case t.Number:
                        return r.s("shared-calculator-label-value-type-number");
                    case t.Bool:
                        return r.s("shared-calculator-label-value-type-bool");
                    case t.Point:
                        return r.s("shared-calculator-label-value-type-point");
                    case t.Distribution:
                        return r.s("shared-calculator-label-value-type-distribution");
                    case t.ListOfAny:
                        return r.s("shared-calculator-label-value-type-list-of-any");
                    case t.ListOfNumber:
                        return r.s("shared-calculator-label-value-type-list-of-numbers");
                    case t.ListOfBool:
                        return r.s("shared-calculator-label-value-type-list-of-bool");
                    case t.ListOfPoint:
                        return r.s("shared-calculator-label-value-type-list-of-points");
                    case t.ListOfDistribution:
                        return r.s("shared-calculator-label-value-type-list-of-distributions");
                    case t.EmptyList:
                        return r.s("shared-calculator-label-value-type-empty-list");
                    case t.ErrorType:
                        return r.s("shared-calculator-label-value-type-error");
                    case t.SeedType:
                        return r.s("shared-calculator-label-value-type-seed");
                    case t.RGBColor:
                        return r.s("shared-calculator-label-value-type-color");
                    case t.ListOfColor:
                        return r.s("shared-calculator-label-value-type-list-of-colors");
                    default:
                        throw new Error("Invalid type: " + e)
                }
            }
            ,
            t.isList = function(e) {
                switch (e) {
                    case t.ListOfAny:
                    case t.ListOfNumber:
                    case t.ListOfBool:
                    case t.ListOfPoint:
                    case t.ListOfDistribution:
                    case t.ListOfColor:
                    case t.EmptyList:
                        return !0;
                    case t.Any:
                    case t.Number:
                    case t.Bool:
                    case t.Point:
                    case t.Distribution:
                    case t.ErrorType:
                    case t.SeedType:
                    case t.RGBColor:
                        return !1;
                    default:
                        throw new Error("Invalid type: " + e)
                }
            }
            ,
            t.elementType = function(e) {
                switch (e) {
                    case t.EmptyList:
                    case t.ListOfNumber:
                        return t.Number;
                    case t.ListOfBool:
                        return t.Bool;
                    case t.ListOfPoint:
                        return t.Point;
                    case t.ListOfDistribution:
                        return t.Distribution;
                    case t.ListOfColor:
                        return t.RGBColor;
                    case t.ListOfAny:
                        return t.Any;
                    case t.Any:
                    case t.Number:
                    case t.Bool:
                    case t.Point:
                    case t.Distribution:
                    case t.ErrorType:
                    case t.SeedType:
                    case t.RGBColor:
                        return t.Any;
                    default:
                        throw new Error("Invalid type: " + e)
                }
            }
            ,
            t.listType = function(e) {
                switch (e) {
                    case t.Any:
                        return t.ListOfAny;
                    case t.Number:
                        return t.ListOfNumber;
                    case t.Bool:
                        return t.ListOfBool;
                    case t.Point:
                        return t.ListOfPoint;
                    case t.Distribution:
                        return t.ListOfDistribution;
                    case t.RGBColor:
                        return t.ListOfColor;
                    case t.EmptyList:
                    case t.ListOfNumber:
                    case t.ListOfBool:
                    case t.ListOfPoint:
                    case t.ListOfDistribution:
                    case t.ListOfColor:
                    case t.ListOfAny:
                    case t.ErrorType:
                    case t.SeedType:
                        throw new Error("Type " + n(e) + " does not implement listType.");
                    default:
                        throw new Error("Invalid type: " + e)
                }
            }
            ,
            t.hasListType = function(e) {
                switch (e) {
                    case t.Any:
                    case t.Number:
                    case t.Bool:
                    case t.Point:
                    case t.Distribution:
                    case t.RGBColor:
                        return !0;
                    case t.EmptyList:
                    case t.ListOfNumber:
                    case t.ListOfBool:
                    case t.ListOfPoint:
                    case t.ListOfDistribution:
                    case t.ListOfColor:
                    case t.ListOfAny:
                    case t.ErrorType:
                    case t.SeedType:
                        return !1;
                    default:
                        throw new Error("Invalid type: " + e)
                }
            }
            ,
            t.isOneOf = function(e, t) {
                for (var r = 0, n = t; r < n.length; r++) {
                    if (e === n[r])
                        return !0
                }
                return !1
            }
    });
    _("core/math/errormsg", ["require", "core/lib/worker-i18n", "core/math/parsenode/error", "core/lib/label", "core/math/types"], function(e) {
        "use strict";
        var u = e("core/lib/worker-i18n")
            , c = e("core/math/parsenode/error")
            , l = e("core/lib/label")
            , t = e("core/math/types");
        return {
            parseError: function() {
                return c(u.s("shared-calculator-error-parse-error"))
            },
            unrecognizedSymbol: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-unrecognized-symbol", {
                        symbol: e
                    }))
            },
            unexpectedInequality: function() {
                return c(u.s("shared-calculator-error-unexpected-inequality"))
            },
            unexpectedSymbol: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-unexpected-symbol", {
                        symbol: e
                    }))
            },
            addTypeError: function(e) {
                return c(u.s("shared-calculator-error-add-type-error", {
                    symbol1: e[0],
                    symbol2: e[1]
                })).allowExport()
            },
            subtractTypeError: function(e) {
                return c(u.s("shared-calculator-error-subtract-type-error", {
                    symbol1: e[0],
                    symbol2: e[1]
                })).allowExport()
            },
            multiplyTypeError: function(e) {
                return c(u.s("shared-calculator-error-multiply-type-error", {
                    symbol1: e[0],
                    symbol2: e[1]
                })).allowExport()
            },
            divideTypeError: function(e) {
                return c(u.s("shared-calculator-error-divide-type-error", {
                    symbol1: e[0],
                    symbol2: e[1]
                })).allowExport()
            },
            exponentTypeError: function(e) {
                return c(u.s("shared-calculator-error-exponent-type-error", {
                    symbol1: e[0],
                    symbol2: e[1]
                })).allowExport()
            },
            negativeTypeError: function(e) {
                return c(u.s("shared-calculator-error-negative-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            comparatorTypeError: function(e) {
                return c(u.s("shared-calculator-error-comparator-type-error", {
                    symbol1: e[0],
                    symbol2: e[1]
                })).allowExport()
            },
            andTypeError: function(e) {
                return c(u.s("shared-calculator-error-and-type-error", {
                    symbol: "and",
                    symbol1: e[0],
                    symbol2: e[1]
                })).allowExport()
            },
            listTypeError: function(e) {
                return c(u.s("shared-calculator-error-list-type-error", {
                    symbol1: e[0]
                })).allowExport()
            },
            pointTypeError: function(e) {
                return c(u.s("shared-calculator-error-point-type-error", {
                    symbol1: e,
                    symbol2: t.prettyPrint(t.Point)
                })).allowExport()
            },
            indexTypeError: function(e) {
                return c(u.s("shared-calculator-error-index-type-error", {
                    symbol1: e[0],
                    symbol2: e[1]
                })).allowExport()
            },
            orderedPairAccessTypeError: function(e) {
                return c(u.s("shared-calculator-error-ordered-pair-access-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            functionTypeError: function(e, t) {
                switch (t.length) {
                    case 1:
                        return c(u.s("shared-calculator-error-function-type-error-1", {
                            fn: l.formatSymbol(e),
                            arg: t[0]
                        })).allowExport();
                    case 2:
                        return c(u.s("shared-calculator-error-function-type-error-2", {
                            fn: l.formatSymbol(e),
                            arg1: t[0],
                            arg2: t[1]
                        })).allowExport();
                    default:
                        return c(u.s("shared-calculator-error-function-type-error-many", {
                            fn: l.formatSymbol(e)
                        })).allowExport()
                }
            },
            illegalDotCall: function(e) {
                return c(u.s("shared-calculator-error-illegal-dot-call", {
                    symbol: l.formatSymbol(e)
                }))
            },
            dotLHSTypeError: function(e, t) {
                return c(u.s("shared-calculator-error-dot-lhs-type-error", {
                    symbol: l.formatSymbol(e),
                    type: t
                }))
            },
            sumLowerBoundTypeError: function(e) {
                return c(u.s("shared-calculator-error-sum-lower-bound-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            sumUpperBoundTypeError: function(e) {
                return c(u.s("shared-calculator-error-sum-upper-bound-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            sumInfiniteBoundError: function() {
                return c(u.s("shared-calculator-error-sum-infinite-bound-type-error"))
            },
            sumArgumentTypeError: function(e) {
                return c(u.s("shared-calculator-error-sum-argument-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            productLowerBoundTypeError: function(e) {
                return c(u.s("shared-calculator-error-product-lower-bound-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            productUpperBoundTypeError: function(e) {
                return c(u.s("shared-calculator-error-product-upper-bound-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            productInfiniteBoundError: function() {
                return c(u.s("shared-calculator-error-product-infinite-bound-type-error"))
            },
            productArgumentTypeError: function(e) {
                return c(u.s("shared-calculator-error-product-argument-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            integralLowerBoundTypeError: function(e) {
                return c(u.s("shared-calculator-error-integral-lower-bound-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            integralUpperBoundTypeError: function(e) {
                return c(u.s("shared-calculator-error-integral-upper-bound-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            integralArgumentTypeError: function(e) {
                return c(u.s("shared-calculator-error-integral-argument-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            derivativeTypeError: function(e) {
                return c(u.s("shared-calculator-error-derivative-type-error", {
                    symbol: e[0]
                })).allowExport()
            },
            derivativeVariableTypeError: function(e, t) {
                return c(u.s("shared-calculator-error-derivative-variable-type-error", {
                    symbol1: l.formatSymbol(e),
                    symbol2: t[0]
                }))
            },
            piecewiseConditionTypeError: function(e) {
                return c(u.s("shared-calculator-error-piecewise-condition-type-error", {
                    symbol1: t.prettyPrint(t.Bool),
                    symbol2: e[0]
                })).allowExport()
            },
            piecewiseBranchTypeError: function(e) {
                return c(u.s("shared-calculator-error-piecewise-branch-type-error", {
                    symbol1: e[0],
                    symbol2: e[1]
                })).allowExport()
            },
            piecewiseBranchLengthError: function(e) {
                return c(u.s("shared-calculator-error-piecewise-branch-length-error", {
                    symbol: e
                })).allowExport()
            },
            tableHeaderTypeError: function(e) {
                return c(u.s("shared-calculator-error-table-header-type-error", {
                    symbol: e[0]
                }))
            },
            tableEntryTypeError: function(e) {
                return c(u.s("shared-calculator-error-table-entry-type-error", {
                    symbol: e[0]
                }))
            },
            regressionTypeError: function(e) {
                return c(u.s("shared-calculator-error-regression-type-error", {
                    symbol1: e[0],
                    symbol2: e[1]
                }))
            },
            heterogeneousList: function() {
                return c(u.s("shared-calculator-error-heterogeneous-list")).allowExport()
            },
            deeplyNested: function() {
                return c(u.s("shared-calculator-error-deeply-nested")).allowExport()
            },
            polygonListTypeError: function(e) {
                return c(u.s("shared-calculator-error-polygon-list-type-error", {
                    type: e[0]
                }))
            },
            polygonPointArgsError: function() {
                return c(u.s("shared-calculator-error-polygon-point-args-error"))
            },
            polygonTwoNumbersError: function() {
                return c(u.s("shared-calculator-error-two-numbers-error"))
            },
            boxplotOffsetInvalid: function() {
                return c(u.s("shared-calculator-error-boxplot-offset-invalid"))
            },
            boxplotBreadthInvalid: function() {
                return c(u.s("shared-calculator-error-boxplot-breadth-invalid"))
            },
            tooManyArguments: function(e, t) {
                return c(u.s("shared-calculator-error-too-many-arguments", {
                    symbol: e,
                    max: t
                }))
            },
            pdfWrongArity: function() {
                var e = u.s("shared-calculator-error-pdf-wrong-arity-recommendation")
                    , t = u.s("shared-calculator-error-pdf-wrong-arity", {
                    recommendation: e
                });
                return c(t)
            },
            cdfRequiresArguments: function() {
                var e = u.s("shared-calculator-error-cdf-wrong-arity-recommendation")
                    , t = u.s("shared-calculator-error-cdf-wrong-arity", {
                    recommendation: e
                });
                return c(t)
            },
            cdfTooManyArguments: function() {
                var e = u.s("shared-calculator-error-cdf-too-many-arguments-recommendation")
                    , t = u.s("shared-calculator-error-cdf-too-many-arguments", {
                    recommendation: e
                });
                return c(t)
            },
            tdistWrongArity: function() {
                return c(u.s("shared-calculator-error-tdist-wrong-arity"))
            },
            randomArity: function() {
                return c(u.s("shared-calculator-error-random-arity"))
            },
            randomFromBroadcastDistribution: function() {
                return c(u.s("shared-calculator-error-random-from-broadcast-distribution"))
            },
            wrongArity: function(e, t, r, n) {
                var i, a;
                if (e = l.formatSymbol(e),
                1 === t)
                    n = n || e + "(x)",
                        a = u.s("shared-calculator-error-wrong-arity-supplement", {
                            recommendation: n
                        }),
                        i = 1 < r ? u.s("shared-calculator-error-wrong-arity-single-arg-too-many", {
                            dependency: e,
                            supplement: a
                        }) : u.s("shared-calculator-error-wrong-arity-single-arg-too-few", {
                            dependency: e,
                            supplement: a
                        });
                else {
                    var o = [];
                    if (!n) {
                        for (var s = 0; s < t; s++)
                            o[s] = s + 1;
                        n = l.formatSymbol(e) + "(" + o.join(", ") + ")"
                    }
                    a = u.s("shared-calculator-error-wrong-arity-supplement", {
                        recommendation: n
                    }),
                        i = u.s("shared-calculator-error-wrong-arity-many-arg", {
                            dependency: e,
                            assignment_arity: t,
                            supplement: a
                        })
                }
                return c(i)
            },
            wrongParametrizedReducerArity: function(e) {
                return c(u.s("shared-calculator-error-wrong-two-arg-arity", {
                    symbol: l.formatSymbol(e),
                    recommendation: l.formatSymbol(e) + "([1,2,3], 1)"
                }))
            },
            wrongDoubleReducerArity: function(e) {
                return c(u.s("shared-calculator-error-wrong-two-arg-arity", {
                    symbol: l.formatSymbol(e),
                    recommendation: l.formatSymbol(e) + "([1,2,3], [3,2,1])"
                }))
            },
            primedFunctionArity: function() {
                return c(u.s("shared-calculator-error-primed-function-arity"))
            },
            zeroArgReducer: function(e) {
                return c(u.s("shared-calculator-error-zero-arg-reducer", {
                    symbol: l.formatSymbol(e)
                }))
            },
            malformedPoint: function() {
                return c(u.s("shared-calculator-error-malformed-point"))
            },
            badTupleDimensions: function(e) {
                return c(u.s("shared-calculator-error-bad-tuple-dimensions", {
                    symbol: e
                }))
            },
            badImplicitCall: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-bad-implicit-call", {
                        symbol: e
                    }))
            },
            adjacentNumbers: function(e, t) {
                return c(u.s("shared-calculator-error-adjacent-numbers", {
                    left: e,
                    right: t
                }))
            },
            identifierAsFunction: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-identifier-as-function", {
                        symbol: e
                    }))
            },
            binaryOperatorMissingOperand: function(e) {
                return "%" === (e = l.formatSymbol(e)) && (e = "% of"),
                    c(u.s("shared-calculator-error-binary-operator-missing-operand", {
                        symbol: e
                    }))
            },
            unaryOperatorMissingLeft: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-unary-operator-missing-left", {
                        symbol: e
                    }))
            },
            unaryOperatorMissingRight: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-unary-operator-missing-right", {
                        symbol: e
                    }))
            },
            fractionMissingNumerator: function() {
                return c(u.s("shared-calculator-error-fraction-missing-numerator"))
            },
            fractionMissingDenominator: function() {
                return c(u.s("shared-calculator-error-fraction-missing-denominator"))
            },
            fractionEmpty: function() {
                return c(u.s("shared-calculator-error-fraction-empty"))
            },
            emptySubscript: function() {
                return c(u.s("shared-calculator-error-empty-subscript"))
            },
            emptySuperscript: function() {
                return c(u.s("shared-calculator-error-empty-superscript"))
            },
            invalidSubscript: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-invalid-subscript", {
                        symbol: e
                    }))
            },
            invalidOperatorName: function() {
                return c(u.s("shared-calculator-error-invalid-operator-name"))
            },
            unexpectedSubscript: function() {
                return c(u.s("shared-calculator-error-unexpected-subscript"))
            },
            superscriptWithPrime: function() {
                return c(u.s("shared-calculator-error-superscript-with-prime"))
            },
            unexpectedPrime: function() {
                return c(u.s("shared-calculator-error-unexpected-prime"))
            },
            primeWithoutParen: function() {
                return c(u.s("shared-calculator-error-prime-without-paren"))
            },
            emptyRadical: function() {
                return c(u.s("shared-calculator-error-empty-radical"))
            },
            emptyRadicalIndex: function() {
                return c(u.s("shared-calculator-error-empty-radical-index"))
            },
            emptyParen: function() {
                return c(u.s("shared-calculator-error-empty-paren"))
            },
            emptySquareBracket: function() {
                return c(u.s("shared-calculator-error-empty-square-bracket"))
            },
            emptyPipe: function() {
                return c(u.s("shared-calculator-error-empty-pipe"))
            },
            badTrigExponent: function(e) {
                var t = e + "^2"
                    , r = e + "^-1";
                return c(u.s("shared-calculator-error-bad-trig-exponent", {
                    form1: t,
                    form2: r
                }))
            },
            badLogExponent: function(e) {
                var t = e + "^2";
                return c(u.s("shared-calculator-error-bad-log-exponent", {
                    form: t
                }))
            },
            inequalityChainTooLong: function() {
                return c(u.s("shared-calculator-error-inequality-chain-too-long"))
            },
            piecewiseMissingCondition: function() {
                return c(u.s("shared-calculator-error-piecewise-missing-condition"))
            },
            piecewisePartMissingCondition: function() {
                return c(u.s("shared-calculator-error-piecewise-part-missing-condition"))
            },
            colonMissingCondition: function() {
                return c(u.s("shared-calculator-error-colon-missing-condition"))
            },
            blankExpression: function() {
                return c(u.s("shared-calculator-error-blank-expression"))
            },
            functionNotDefined: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-function-not-defined", {
                        dependency: e
                    }))
            },
            parameterAlreadyDefined: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-parameter-already-defined", {
                        dependency: e
                    }))
            },
            cannotRedefine: function(e, t) {
                return e = l.formatSymbol(e),
                    c(void 0 === t ? u.s("shared-calculator-error-cannot-redefine", {
                        symbol: e
                    }) : u.s("shared-calculator-error-cannot-redefine-root", {
                        symbol: e,
                        symbolRoot: t
                    }))
            },
            cannotSubscript: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-cannot-subscript", {
                        symbol: e
                    }))
            },
            multiplyDefined: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-multiply-defined", {
                        dependency: e
                    }))
            },
            shadowedIndex: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-shadowed-index", {
                        symbol: e
                    }))
            },
            cycle: function(e) {
                var t = (e = e.map(l.formatSymbol)).pop();
                return c(u.s("shared-calculator-error-dependency-cycle", {
                    symbols: e.join("', '"),
                    lastSymbol: t
                }))
            },
            selfReferentialFunction: function(e) {
                return c(u.s("shared-calculator-error-self-referential-function", {
                    symbol: l.formatSymbol(e)
                }))
            },
            simulationFPSNonNegativeNumber: function() {
                return c(u.s("shared-calculator-error-simulation-fps-nonnegative"))
            },
            sliderLimitReferencesExport: function(e) {
                return c(u.s("shared-calculator-error-slider-limit-references-export", {
                    symbol: l.formatSymbol(e)
                }))
            },
            sliderMinInvalid: function() {
                return c(u.s("shared-calculator-error-slider-min-invalid"))
            },
            sliderMaxInvalid: function() {
                return c(u.s("shared-calculator-error-slider-max-invalid"))
            },
            sliderMaxLessThanMin: function() {
                return c(u.s("shared-calculator-error-slider-max-less-than-min"))
            },
            sliderStepInvalid: function() {
                return c(u.s("shared-calculator-error-slider-step-invalid"))
            },
            domainMinInvalid: function() {
                return c(u.s("shared-calculator-error-domain-min-invalid"))
            },
            domainMaxInvalid: function() {
                return c(u.s("shared-calculator-error-domain-max-invalid"))
            },
            domainMaxLessThanMin: function() {
                return c(u.s("shared-calculator-error-domain-max-less-than-min"))
            },
            cdfMinInvalid: function() {
                return c(u.s("shared-calculator-error-cdf-min-invalid"))
            },
            cdfMaxInvalid: function() {
                return c(u.s("shared-calculator-error-cdf-max-invalid"))
            },
            cdfMaxLessThanMin: function() {
                return c(u.s("shared-calculator-error-cdf-max-less-than-min"))
            },
            tooManyVariables: function(e) {
                if (0 === (e = e.map(l.formatSymbol)).length)
                    return c(u.s("shared-calculator-error-too-many-variables-no-symbols"));
                var t = e.pop();
                return 0 < e.length ? c(u.s("shared-calculator-error-too-many-variables-many-symbols", {
                    variables: e.join("', '"),
                    lastVariable: t
                })) : c(u.s("shared-calculator-error-too-many-variables-one-symbol", {
                    variable: t
                }))
            },
            addArgumentsToDefinition: function(e, t, r) {
                e = e.map(l.formatSymbol);
                var n = (t = l.formatSymbol(t)) + "(" + (r = r.map(l.formatSymbol)).join(",") + "," + e.join(",") + ")"
                    , i = e.pop()
                    , a = {
                    symbols: e.join("', '"),
                    lastSymbol: i,
                    newSignature: n
                };
                return e.length ? c(u.s("shared-calculator-error-add-arguments-to-definition-many", a)) : c(u.s("shared-calculator-error-add-arguments-to-definition-one", a))
            },
            invalidLHS: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-invalid-lhs", {
                        symbol: e
                    }))
            },
            unplottablePolarFunction: function() {
                return c(u.s("shared-calculator-error-unplottable-polar-function"))
            },
            invalidInequalityVariables: function() {
                return c(u.s("shared-calculator-error-invalid-inequality-variables"))
            },
            invalidImplicitVariables: function() {
                return c(u.s("shared-calculator-error-invalid-implicit-variables"))
            },
            singleVariableImplicitEquationsDisabled: function() {
                return c(u.s("shared-calculator-error-single-variable-implicit-equations-disabled"))
            },
            implicitsDisabled: function() {
                return c(u.s("shared-calculator-error-implicits-disabled"))
            },
            inequalitiesDisabled: function() {
                return c(u.s("shared-calculator-error-inequalities-disabled"))
            },
            complicatedPolarImplicit: function() {
                return c(u.s("shared-calculator-error-complicated-polar-implicit"))
            },
            invalidDoubleInequalityVariables: function() {
                return c(u.s("shared-calculator-error-invalid-double-inequality-variables"))
            },
            mismatchedDoubleInequality: function() {
                return c(u.s("shared-calculator-error-mismatched-double-inequality", {
                    example: "1 < y < 2"
                }))
            },
            complicatedDoubleInequality: function() {
                return c(u.s("shared-calculator-error-complicated-double-inequality"))
            },
            equationRequired: function(e) {
                return e ? (e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-equation-required-symbol", {
                        lhs: e + "="
                    }))) : c(u.s("shared-calculator-error-equation-required"))
            },
            variableAsFunction: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-variable-as-function", {
                        dependency: e
                    }))
            },
            distributionAsFunction: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-distribution-as-function", {
                        symbol: e
                    }))
            },
            invalidTableHeader: function(e) {
                return c(u.s("shared-calculator-error-invalid-table-header", {
                    supplement: e
                }))
            },
            invalidTableEntry: function(e) {
                return c(u.s("shared-calculator-error-invalid-table-entry", {
                    supplement: e
                }))
            },
            invalidFirstTableColumn: function() {
                return c(u.s("shared-calculator-error-invalid-first-table-column", {
                    most: "'y', 'r',",
                    last: "''"
                }))
            },
            invalidDependentFirstTableColumn: function() {
                return c(u.s("shared-calculator-error-invalid-dependent-first-table-column"))
            },
            invalidRegressionParameter: function(e) {
                return c(u.s("shared-calculator-error-invalid-regression-parameter", {
                    symbol: l.formatSymbol(e)
                }))
            },
            optimizationError: function() {
                return c(u.s("shared-calculator-error-optimization-error"))
            },
            nonListDoubleReducer: function(e) {
                return c(u.s("shared-calculator-error-non-list-double-reducer", {
                    symbol: l.formatSymbol(e),
                    recommendation: l.formatSymbol(e) + "([1,2,3], [3,2,1])"
                })).allowExport()
            },
            nonListParametrizedReducer: function(e) {
                return c(u.s("shared-calculator-error-non-list-parameterized-reducer", {
                    symbol: l.formatSymbol(e),
                    recommendation: l.formatSymbol(e) + "([1,2,3], 1)"
                })).allowExport()
            },
            methodRequiresList: function(e) {
                return c(u.s("shared-calculator-error-method-requires-list", {
                    symbol: l.formatSymbol(e),
                    recommendation: l.formatSymbol(e) + "([1,2,3])"
                })).allowExport()
            },
            variableRange: function(e) {
                return c(u.s("shared-calculator-error-variable-range", {
                    symbol: l.formatSymbol(e[0])
                })).setDependencies(e).allowExport()
            },
            variableListIndicies: function(e) {
                return c(u.s("shared-calculator-error-variable-list-indices", {
                    symbol: l.formatSymbol(e[0])
                })).setDependencies(e).allowExport()
            },
            variableFilter: function(e) {
                return c(u.s("shared-calculator-error-variable-filter", {
                    symbol: l.formatSymbol(e[0])
                })).setDependencies(e).allowExport()
            },
            functionFreeVariable: function(e, t) {
                return c(u.s("shared-calculator-error-variable-function-free-variable", {
                    functionSymbol: e,
                    variableSymbol: t
                })).allowExport()
            },
            nonArithmeticRange: function(e) {
                return c(u.s("shared-calculator-error-non-arithmetic-range")).allowExport()
            },
            invalidHalfEmptyRange: function() {
                return c(u.s("shared-calculator-error-invalid-half-empty-range"))
            },
            sumMissingBound: function() {
                return c(u.s("shared-calculator-error-sum-missing-bound"))
            },
            productMissingBound: function() {
                return c(u.s("shared-calculator-error-product-missing-bound"))
            },
            incorrectSumLowerBound: function() {
                return c(u.s("shared-calculator-error-incorrect-sum-lower-bound"))
            },
            incorrectProductLowerBound: function() {
                return c(u.s("shared-calculator-error-incorrect-product-lower-bound"))
            },
            badSumBoundDependency: function(e) {
                return c(u.s("shared-calculator-error-bad-sum-bound-dependency", {
                    symbol: l.formatSymbol(e)
                }))
            },
            badProductBoundDependency: function(e) {
                return c(u.s("shared-calculator-error-bad-product-bound-dependency", {
                    symbol: l.formatSymbol(e)
                }))
            },
            integralMissingBound: function() {
                return c(u.s("shared-calculator-error-integral-missing-bound"))
            },
            integralMissingDifferential: function() {
                return c(u.s("shared-calculator-error-integral-missing-differential"))
            },
            differentialWithSuperscript: function() {
                return c(u.s("shared-calculator-error-differential-with-superscript"))
            },
            sumMissingBody: function() {
                return c(u.s("shared-calculator-error-sum-missing-body"))
            },
            productMissingBody: function() {
                return c(u.s("shared-calculator-error-product-missing-body"))
            },
            integralMissingBody: function() {
                return c(u.s("shared-calculator-error-integral-missing-body"))
            },
            derivativeMissingBody: function() {
                return c(u.s("shared-calculator-error-derivative-missing-body"))
            },
            mismatchedBraces: function(e, t) {
                return e = l.formatSymbol(e),
                    t = l.formatSymbol(t),
                    c(u.s("shared-calculator-error-mismatched-braces", {
                        symbol1: e,
                        symbol2: t
                    }))
            },
            shadowedIntegrationVariable: function(e) {
                return c(u.s("shared-calculator-error-shadowed-integration-variable", {
                    symbol: l.formatSymbol(e)
                }))
            },
            badIntegralBoundDependency: function(e) {
                return c(u.s("shared-calculator-error-bad-integral-bound-dependency", {
                    symbol: l.formatSymbol(e)
                }))
            },
            percentMissingOf: function() {
                return c(u.s("shared-calculator-error-percent-missing-of"))
            },
            illegalBinWidth: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-illegal-bin-width", {
                        symbol: e
                    }))
            },
            ttestListTooShort: function(e) {
                return e = l.formatSymbol(e),
                    c(u.s("shared-calculator-error-ttest-list-too-short", {
                        symbol: e
                    }))
            },
            badSampleSize: function() {
                return c(u.s("shared-calculator-error-bad-sample-size"))
            },
            variableSampleSize: function(e) {
                return c(u.s("shared-calculator-error-variable-sample-size", {
                    symbol: l.formatSymbol(e[0])
                })).setDependencies(e).allowExport()
            },
            variableSeed: function(e) {
                return c(u.s("shared-calculator-error-variable-seed", {
                    symbol: l.formatSymbol(e[0])
                })).setDependencies(e).allowExport()
            },
            badAnsContext: function() {
                return c(u.s("shared-calculator-error-bad-ans-context"))
            },
            ansUndefined: function() {
                return c(u.s("shared-calculator-error-ans-undefined"))
            },
            variablesUnsupported: function(e) {
                return c(u.s("shared-calculator-error-variables-unsupported", {
                    variable: l.formatSymbol(e)
                }))
            },
            functionUnsupported: function(e) {
                return c(u.s("shared-calculator-error-function-unsupported", {
                    symbol: l.formatSymbol(e)
                }))
            },
            logbaseUnsupported: function() {
                return c(u.s("shared-calculator-error-logbase-unsupported"))
            },
            constantUnsupported: function(e) {
                return c(u.s("shared-calculator-error-constant-unsupported", {
                    symbol: l.formatSymbol(e)
                }))
            },
            assignmentsUnsupported: function() {
                return c(u.s("shared-calculator-error-assignments-unsupported"))
            },
            functionDefinitionsUnsupported: function() {
                return c(u.s("shared-calculator-error-function-definition-unsupported"))
            },
            equationsUnsupported: function() {
                return c(u.s("shared-calculator-error-equations-unsupported"))
            },
            inequalitiesUnsupported: function() {
                return c(u.s("shared-calculator-error-inequalities-unsupported"))
            },
            regressionsUnsupported: function() {
                return c(u.s("shared-calculator-error-regressions-unsupported"))
            },
            pointsUnsupported: function() {
                return c(u.s("shared-calculator-error-points-unsupported"))
            },
            colorsUnsupported: function() {
                return c(u.s("shared-calculator-error-colors-unsupported"))
            },
            featureUnavailable: function() {
                return c(u.s("shared-calculator-error-feature-unavailable"))
            },
            fractionsUnavailable: function() {
                return c(u.s("basic-calculator-error-fractions-unavailable"))
            },
            nonSquareDeterminant: function() {
                return c(u.s("shared-calculator-error-non-square-determinant"))
            },
            nonSquareTrace: function() {
                return c(u.s("shared-calculator-error-non-square-trace"))
            },
            nonSquareInverse: function() {
                return c(u.s("shared-calculator-error-non-square-inverse"))
            },
            singularInverse: function() {
                return c(u.s("shared-calculator-error-non-singular-inverse"))
            },
            clickableObjectAssignmentNotDefined: function(e) {
                return c(u.s("shared-calculator-error-clickable-object-assignment-not-defined", {
                    symbol: e
                }))
            },
            clickableObjectAlreadyAssigned: function(e) {
                return c(u.s("shared-calculator-error-multiply-defined", {
                    dependency: e
                }))
            },
            clickableObjectAssignmentNotIdentifier: function() {
                return c(u.s("shared-calculator-error-clickable-object-assignment-not-identifier"))
            },
            clickableObjectInvalidExpression: function() {
                return c(u.s("shared-calculator-error-clickable-object-invalid-expression"))
            },
            matrixAssignment: function() {
                return c(u.s("shared-calculator-error-matrix-assignment"))
            },
            matrixAddDimensions: function() {
                return c(u.s("shared-calculator-error-matrix-add-dimensions"))
            },
            matrixSubtractDimensions: function() {
                return c(u.s("shared-calculator-error-matrix-subtract-dimensions"))
            },
            matrixMultiplyDimensions: function() {
                return c(u.s("shared-calculator-error-matrix-multiply-dimensions"))
            },
            matrixFractionalPower: function() {
                return c(u.s("shared-calculator-error-matrix-fractional-power"))
            },
            matrixPowerDimensions: function() {
                return c(u.s("shared-calculator-error-matrix-power-dimensions"))
            },
            matrixElementTypeError: function(e) {
                return c(u.s("shared-calculator-error-matrix-element-type-error", {
                    arg: e[0]
                }))
            },
            matrixInvalidVariable: function(e) {
                return c(u.s("shared-calculator-error-matrix-invalid-variable", {
                    symbol: l.formatSymbol(e)
                }))
            }
        }
    });
    _("core/math/parsenode/expression", ["require", "pjs", "./base", "core/math/errormsg", "core/math/types"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./base")
            , n = e("core/math/errormsg")
            , i = e("core/math/types");
        return t(r, function(e, t) {
            e.init = function(e) {
                if (!Array.isArray(e))
                    throw new TypeError("Argument to expression constructor must be an Array.");
                t.init.call(this),
                    this.args = e,
                    this.valueType = this._getValueType(e),
                    this.registerDependencies(),
                    this.computeTreeSize()
            }
                ,
                e._getValueType = function(e) {
                    return i.Any
                }
                ,
                e.shouldExportAns = function() {
                    return !0
                }
                ,
                e.registerDependencies = function() {
                    for (var e = 0; e < this.args.length; e++)
                        this.mergeDependencies(this.args[e])
                }
                ,
                e.computeTreeSize = function() {
                    for (var e = 0, t = 0; t < this.args.length; t++)
                        this.args[t].treeSize && (e += this.args[t].treeSize);
                    if (this.treeSize = e + 1,
                    1e4 < e)
                        throw n.deeplyNested()
                }
                ,
                e.copyWithArgs = function(e) {
                    return new this.constructor(e)
                }
        })
    });
    _("core/math/parsenode/scalarexpression", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {
            e.init = function(e) {
                t.init.call(this, e)
            }
                ,
                e.getEvalStrings = function() {
                    for (var e = [], t = [], r = 0; r < this.args.length; r++) {
                        var n = this.args[r].getEvalStrings()
                            , e = e.concat(n.statements);
                        t.push(n.expression)
                    }
                    return {
                        statements: e,
                        expression: this.scalarEvalExpression(t)
                    }
                }
        })
    });
    _("core/math/parsenode/expressionTypes", ["require", "pjs", "./scalarexpression"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./scalarexpression")
            , n = {
            Add: t(r, {}),
            Subtract: t(r, {}),
            Multiply: t(r, {}),
            Divide: t(r, {}),
            Exponent: t(r, {}),
            Negative: t(r, {}),
            And: t(r, {
                isInequality: function() {
                    return this.args[0].isInequality() && this.args[1].isInequality()
                }
            }),
            PercentOf: t(r, {})
        };
        return n.RawExponent = t(n.Exponent, {}),
            n
    });
    _("core/math/maybe-rational", ["require", "exports", "core/math/builtin"], function(e, t, s) {
        "use strict";
        function i(e, t) {
            return {
                n: e,
                d: t
            }
        }
        function u(e) {
            return "object" == typeof e && "number" == typeof e.n && "number" == typeof e.d
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.total = t.mod = t.nthroot = t.sqrt = t.pow = t.div = t.sub = t.mul = t.add = t.reciprocal = t.abs = t.neg = t.maybeRational = t.asFloat = t.fromDecimalString = t.isRational = void 0,
            t.isRational = u;
        var l = Math.pow(2, 53) - 1;
        function c(e) {
            return u(e) ? e.n / e.d : e
        }
        function p(e, t) {
            if (!isFinite(e) || !isFinite(t) || 0 === t || Math.floor(e) !== e || Math.floor(t) !== t || Math.abs(e) > l || Math.abs(t) > l)
                return e / t;
            t < 0 && (e = -e,
                t = -t);
            var r = s.gcd(e, t);
            return i(e / r, t / r)
        }
        function f(e) {
            return u(e) ? i(-e.n, e.d) : -e
        }
        function h(e) {
            return u(e) ? 0 === e.n ? e.d / e.n : i(e.n < 0 ? -e.d : e.d, Math.abs(e.n)) : 1 / e
        }
        function a(e, t) {
            if (!u(e) || !u(t))
                return c(e) + c(t);
            var r = s.gcd(e.d, t.d);
            return p(e.n * (t.d / r) + t.n * (e.d / r), e.d / r * t.d)
        }
        function o(e, t) {
            if (!u(e) || !u(t))
                return c(e) * c(t);
            var r = s.gcd(e.n, t.d)
                , n = s.gcd(t.n, e.d);
            return p(e.n / r * (t.n / n), e.d / n * (t.d / r))
        }
        function d(e, t) {
            return a(e, f(t))
        }
        function m(e, t) {
            return u(e) && u(t) ? o(e, h(t)) : c(e) / c(t)
        }
        function r(e, t) {
            if (!u(e) || !u(t))
                return s.pow(c(e), c(t));
            var r = function(e, t) {
                var r = e
                    , n = t;
                if (t.n < 0 && (n = f(t),
                    r = h(e)),
                !u(r) || !u(n))
                    return s.pow(c(e), c(t));
                if (e = r,
                1 === (t = n).d)
                    return p(Math.pow(e.n, t.n), Math.pow(e.d, t.n));
                var i = e.n < 0;
                if (i && t.d % 2 != 1)
                    return NaN;
                var a = (i ? -1 : 1) * Math.round(Math.pow(Math.abs(e.n), 1 / t.d))
                    , o = Math.round(Math.pow(Math.abs(e.d), 1 / t.d));
                return Math.pow(a, t.d) !== e.n || Math.pow(o, t.d) !== e.d ? s.pow(c(e), c(t)) : p(Math.pow(a, t.n), Math.pow(o, t.n))
            }(e, t);
            return u(r) ? r : s.pow(c(e), c(t))
        }
        t.fromDecimalString = function(e) {
            var t = e.match(/^(-)?(\d*)?(?:\.(\d*))?$/);
            if (!t)
                return NaN;
            var r = t[1]
                , n = t[2]
                , i = t[3];
            if (!n && !i)
                return NaN;
            var a = !!r;
            if (i) {
                var o = i.replace(/0+$/, "")
                    , s = o.length
                    , u = Math.pow(10, s)
                    , c = parseInt(n || "0", 10) * u + parseInt(o || "0", 10);
                return l < c || l < u ? parseFloat(e) : p(a ? -c : c, u)
            }
            return c = parseInt(n, 10),
                l < c ? parseFloat(e) : p(a ? -c : c, 1)
        }
            ,
            t.asFloat = c,
            t.maybeRational = p,
            t.neg = f,
            t.abs = function(e) {
                return u(e) ? i(Math.abs(e.n), Math.abs(e.d)) : Math.abs(e)
            }
            ,
            t.reciprocal = h,
            t.add = a,
            t.mul = o,
            t.sub = d,
            t.div = m,
            t.pow = r,
            t.sqrt = function(e) {
                if (!u(e))
                    return Math.sqrt(e);
                var t = Math.round(Math.sqrt(e.n))
                    , r = Math.round(Math.sqrt(e.d));
                return t * t !== e.n || r * r !== e.d ? Math.sqrt(c(e)) : p(t, r)
            }
            ,
            t.nthroot = function(e, t) {
                return r(e, h(t))
            }
            ,
            t.mod = function(e, t) {
                if (u(e) && u(t))
                    return d(e, o(t, i(Math.floor(c(m(e, t))), 1)));
                var r = c(e)
                    , n = c(t);
                return r - n * Math.floor(r / n)
            }
            ,
            t.total = function(e) {
                for (var t = i(0, 1), r = 0, n = e; r < n.length; r++)
                    t = a(t, n[r]);
                return t
            }
    });
    _("core/math/parsenode/constant", ["require", "pjs", "./scalarexpression", "core/math/maybe-rational", "core/math/types"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./scalarexpression")
            , n = e("core/math/maybe-rational")
            , i = e("core/math/types");
        return t(r, function(e, t) {
            e.init = function(e) {
                "number" == typeof e && (e = n.maybeRational(e, 1)),
                    this._constantValue = e,
                    t.init.call(this, [])
            }
                ,
                e.isConstant = !0,
                e.getEvalStrings = function() {
                    return {
                        statements: [],
                        expression: this.scalarExprString()
                    }
                }
                ,
                e.asValue = function() {
                    return "boolean" == typeof this._constantValue ? this._constantValue : n.asFloat(this._constantValue)
                }
                ,
                e.asMaybeRationalValue = function() {
                    return "boolean" == typeof this._constantValue ? NaN : this._constantValue
                }
                ,
                e.scalarExprString = function() {
                    return 0 < this.asValue() ? String(this.asValue()) : "(" + String(this.asValue()) + ")"
                }
                ,
                e.getEvaluationInfo = function() {
                    return [{
                        val: this.asValue()
                    }]
                }
                ,
                e.isNaN = function() {
                    return "number" == typeof this.asValue() && isNaN(this.asValue())
                }
                ,
                e._getValueType = function() {
                    switch (typeof this.asValue()) {
                        case "number":
                            return i.Number;
                        case "boolean":
                            return i.Bool;
                        default:
                            throw new Error("Constant node expects value of type number or boolean, but saw " + typeof value)
                    }
                }
        })
    });
    _("core/math/parsenode/mixednumber", ["require", "pjs", "./constant"], function(e) {
        "use strict";
        return e("pjs")(e("./constant"), function(e, t) {
            e.init = function(e) {
                t.init.call(this, e)
            }
                ,
                e.is_mixed_number = !0
        })
    });
    _("core/math/parsenode/identifier", ["require", "pjs", "./expression", "core/lib/label", "core/math/parser/input-span"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./expression")
            , n = e("core/lib/label")
            , i = e("core/math/parser/input-span");
        return t(r, function(e, t, r) {
            e.init = function(e) {
                t.init.call(this, []),
                    this._symbol = n.latexToIdentifier(e),
                    this.setInputSpan(new i.Span(e,0,e.length)),
                    this.addDependency(this._symbol)
            }
                ,
                e.evaluate = function() {
                    throw "Cannot evaluate undefined variable " + this._symbol
                }
        })
    });
    _("core/math/parsenode/ans", ["require", "pjs", "./identifier"], function(e) {
        "use strict";
        return e("pjs")(e("./identifier"), function(e, t, r) {})
    });
    _("core/math/parsenode/freevariable", ["require", "pjs", "./scalarexpression"], function(e) {
        "use strict";
        return e("pjs")(e("./scalarexpression"), function(e, t) {
            e.init = function(e) {
                t.init.call(this, []),
                    this.addDependency(e),
                    this._symbol = e
            }
                ,
                e.isFreeVariable = !0,
                e.scalarEvalExpression = function(e) {
                    return this._symbol
                }
                ,
                e.copyWithArgs = function(e) {
                    return this
                }
        })
    });
    _("core/math/parsenode/dummyindex", ["require", "pjs", "./freevariable"], function(e) {
        "use strict";
        return e("pjs")(e("./freevariable"), function() {})
    });
    _("core/math/parsenode/list", ["require", "pjs", "./expression", "core/math/types"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./expression")
            , s = e("core/math/types");
        return t(r, function(e, t, i) {
            e.init = function(e) {
                t.init.call(this, e),
                    this.length = e.length
            }
                ,
                e.isList = !0,
                e.getEvalStrings = function() {
                    for (var e = [], t = [], r = 0; r < this.args.length; r++) {
                        var n = this.args[r].getEvalStrings();
                        Array.prototype.push.apply(e, n.statements),
                            t.push(n.expression)
                    }
                    return {
                        statements: e,
                        expression: "[" + t.join(",") + "]"
                    }
                }
                ,
                e.asValue = function() {
                    for (var e = [], t = 0; t < this.args.length; t++)
                        e.push(this.args[t].asValue());
                    return e
                }
                ,
                e.asMaybeRationalValue = function() {
                    for (var e = [], t = 0; t < this.args.length; t++)
                        e.push(this.args[t].asMaybeRationalValue());
                    return e
                }
                ,
                e.getEvaluationInfo = function() {
                    if (this.args.every(function(e) {
                        return e.isConstant
                    }))
                        return [{
                            val: this.args.map(function(e) {
                                return e.asValue()
                            })
                        }]
                }
                ,
                i.eachArgs = function(e, t, r) {
                    var n = function(e) {
                        for (var t = 1 / 0, r = 0; r < e.length; r++)
                            (e[r].isList || e[r].isBroadcast) && (t = Math.min(t, e[r].length));
                        return t
                    }(t);
                    if (isFinite(n))
                        for (var i = 0; i < n; i++) {
                            for (var a = [], o = 0; o < t.length; o++)
                                a.push(t[o].isList || s.isList(t[o].valueType) ? t[o].elementAt(e, i) : t[o]);
                            r(a)
                        }
                    else
                        r(t)
                }
                ,
                i.mapArgs = function(e, t, r) {
                    var n = [];
                    return i.eachArgs(e, t, function(e) {
                        n.push(r(e))
                    }),
                        n
                }
                ,
                i.wrap = function(e) {
                    return e.isList || s.isList(e.valueType) ? e : i([e])
                }
        })
    });
    _("core/math/parsenode/range", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t, r) {
            e.init = function(e) {
                t.init.call(this, e),
                    this.beginning = e[0],
                    this.end = e[1]
            }
                ,
                e.isHalfEmpty = function() {
                    return this.end && this.end.args && 0 === this.end.args.length
                }
        })
    });
    _("core/math/parsenode/broadcast", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, a, t) {
            e.init = function(e, t) {
                if (a.init.call(this, t),
                    this._replacedSymbols = e,
                    this._expression = t[0],
                    this._lists = t.slice(1),
                    !e.length)
                    throw new Error("Cannot construct a broadcast node with no replaced symbols");
                for (var r = 0; r < e.length; r++)
                    this.removeDependency(e[r]);
                for (var n = 1 / 0, i = 0; i < this._lists.length; i++) {
                    if (!this._lists[i].isList)
                        throw new Error("List arguments of broadcast must be list literals");
                    n = Math.min(n, this._lists[i].length)
                }
                this.length = n
            }
                ,
                e.isBroadcast = !0,
                e.copyWithArgs = function(e) {
                    return new this.constructor(this._replacedSymbols,e)
                }
                ,
                e.getEvalStrings = function() {
                    var e = []
                        , t = this._expression.getEvalStrings();
                    Array.prototype.push.apply(e, t.statements);
                    for (var r = [], n = [], i = 0; i < this._lists.length; i++) {
                        var a = this._lists[i].getEvalStrings();
                        Array.prototype.push.apply(e, a.statements);
                        var o = this.tmpVar();
                        n.push(o),
                            r.push("var " + o + " = " + a.expression)
                    }
                    var s = this.tmpVar()
                        , u = this.tmpVar();
                    r.push("var " + s + " = []");
                    var c = [];
                    for (i = 0; i < n.length; i++)
                        c.push("var " + this._replacedSymbols[i] + " = " + n[i] + "[" + u + "]");
                    return r.push("for (var " + u + " = 0; " + u + " < " + this.length + "; " + u + "++) {\n  " + c.join(";\n  ") + ";\n  " + s + ".push(" + t.expression + ");\n}"),
                        {
                            statements: e.concat(r),
                            expression: s
                        }
                }
        })
    });
    _("core/math/parsenode/listaccess", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {
            e.init = function(e) {
                t.init.call(this, e),
                    this.list = e[0],
                    this.index = e[1]
            }
                ,
                e.getEvalStrings = function() {
                    var e = this.index.getEvalStrings()
                        , t = this.list.getEvalStrings()
                        , r = e.statements.concat(t.statements)
                        , n = this.tmpVar();
                    r.push("var " + n + " = " + t.expression);
                    var i = this.tmpVar();
                    return r.push("var " + i + " = Math.floor(" + e.expression + ") - 1"),
                        {
                            statements: r,
                            expression: "(" + i + " >= 0 && " + i + " < " + n + ".length ? " + n + "[" + i + "] : NaN)"
                        }
                }
        })
    });
    _("core/math/parsenode/dotaccess", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), {})
    });
    _("core/math/parsenode/dotaccessexponent", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), {})
    });
    _("core/math/parsenode/orderedpair", ["require", "pjs", "./scalarexpression"], function(e) {
        "use strict";
        return e("pjs")(e("./scalarexpression"), function(e, t, r) {
            e.asArray = function() {
                return [+this.args[0].asValue(), +this.args[1].asValue()]
            }
                ,
                e.asValue = e.asArray,
                e.getSliderVariables = function(t, e) {
                    return t.sliderVariables(e.getDependencies()).filter(function(e) {
                        return !t.validParametricVariable(e)
                    })
                }
                ,
                e.getEvalStrings = function() {
                    for (var e = [], t = [], r = 0; r < this.args.length; r++) {
                        var n = this.args[r].getEvalStrings()
                            , e = e.concat(n.statements);
                        t.push(n.expression)
                    }
                    return {
                        statements: e,
                        expression: "[" + t.join(",") + "]"
                    }
                }
        })
    });
    _("core/math/parsenode/movablepoint", ["require", "pjs", "./orderedpair"], function(e) {
        "use strict";
        return e("pjs")(e("./orderedpair"), function(e, n) {
            e.init = function(e, t, r) {
                n.init.call(this, e),
                    this.moveStrategy = t,
                    this.defaultDragMode = r
            }
                ,
                e.isMovablePoint = !0
        })
    });
    _("core/math/parsenode/orderedpairaccess", ["require", "pjs", "./scalarexpression"], function(e) {
        "use strict";
        return e("pjs")(e("./scalarexpression"), function(e, t) {
            e.init = function(e) {
                t.init.call(this, e),
                    this.point = e[0],
                    this.index = e[1]
            }
                ,
                e.getEvalStrings = function() {
                    var e = this.index.getEvalStrings()
                        , t = this.point.getEvalStrings()
                        , r = [];
                    return Array.prototype.push.apply(r, e.statements),
                        Array.prototype.push.apply(r, t.statements),
                        {
                            statements: r,
                            expression: t.expression + "[" + e.expression + "-1]"
                        }
                }
        })
    });
    _("core/math/parsenode/polygon", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {
            e.init = function(e) {
                t.init.call(this, e),
                    this._symbol = "polygon"
            }
        })
    });
    _("core/math/comparators", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.get = t.table = void 0,
            t.table = {
                "<": {
                    inclusive: !1,
                    direction: -1
                },
                "!=": {
                    inclusive: !1,
                    direction: 0
                },
                ">": {
                    inclusive: !1,
                    direction: 1
                },
                "<=": {
                    inclusive: !0,
                    direction: -1
                },
                "=": {
                    inclusive: !0,
                    direction: 0
                },
                ">=": {
                    inclusive: !0,
                    direction: 1
                }
            },
            t.get = function(e, t) {
                switch (t) {
                    case -1:
                        return e ? "<=" : "<";
                    case 0:
                        return e ? "=" : "!=";
                    case 1:
                        return e ? ">=" : ">";
                    default:
                        throw "Programming error.  Comparators must have a direction of -1, 0, or 1"
                }
            }
    });
    _("core/math/parsenode/basecomparator", ["require", "pjs", "./scalarexpression", "./expressionTypes", "core/math/comparators", "core/math/functions"], function(e) {
        "use strict";
        var a = e("pjs")
            , t = e("./scalarexpression")
            , r = e("./expressionTypes").Subtract
            , o = e("core/math/comparators").table
            , s = e("core/math/functions");
        return a(t, function(e, t, i) {
            i.create = function(r, n) {
                return n = n || r,
                    a(i, function(e, t) {
                        e.operator = r,
                            e.isInequality = function() {
                                return 0 !== o[r].direction
                            }
                            ,
                            e.compiledOperator = n,
                            e.scalarEvalExpression = function(e) {
                                return e.join(n)
                            }
                            ,
                            e.evaluate = s.createEvaluateFunction(e.scalarEvalExpression, 2)
                    })
            }
                ,
                e.init = function(e) {
                    t.init.call(this, e),
                        this._difference = -1 === o[this.operator].direction ? r([e[1], e[0]]) : r([e[0], e[1]])
                }
        })
    });
    _("core/math/parsenode/comparator", ["require", "core/math/parsenode/basecomparator"], function(e) {
        "use strict";
        var t = e("core/math/parsenode/basecomparator");
        return {
            "<": t.create("<"),
            ">": t.create(">"),
            "<=": t.create("<="),
            ">=": t.create(">="),
            "=": t.create("=", "===")
        }
    });
    _("core/math/parsenode/doubleinequality", ["require", "pjs", "./base", "core/math/comparators", "./comparator"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./base")
            , n = e("core/math/comparators")
            , i = e("./comparator");
        return t(r, function(e, r) {
            e.init = function(e) {
                r.init.call(this),
                    this.args = e,
                    this._symbol = e[2]._symbol,
                    this._operators = [e[1], e[3]],
                    this._expressions = [e[0], e[4]];
                var t = n.get(n.table[e[1]].inclusive && n.table[e[3]].inclusive, n.table[e[1]].direction);
                this._indicator = i[t]([e[0], e[4]]),
                    this.addDependency(this._symbol),
                    this.mergeDependencies(this._expressions[0], this._expressions[1])
            }
                ,
                e.isInequality = function() {
                    return !0
                }
                ,
                e.isShadeBetween = function() {
                    return !0
                }
        })
    });
    _("core/math/parsenode/repeatedoperator", ["require", "pjs", "./scalarexpression", "./dummyindex"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./scalarexpression")
            , n = e("./dummyindex");
        return t(r, function(e, t) {
            e.init = function(e) {
                t.init.call(this, e),
                    this._index = e[0],
                    this.addDummyDependency(this._index._symbol),
                this._index instanceof n && this.removeDependency(this._index._symbol)
            }
                ,
                e.getEvalStrings = function() {
                    var e = []
                        , t = this.tmpVar()
                        , r = this._index._symbol
                        , n = this.tmpVar()
                        , i = this.tmpVar()
                        , a = this.args[1].getEvalStrings()
                        , o = this.args[2].getEvalStrings()
                        , s = this.args[3].getEvalStrings();
                    Array.prototype.push.apply(e, a.statements),
                        e.push("var " + n + " = Math.round(" + a.expression + ")"),
                        Array.prototype.push.apply(e, o.statements),
                        e.push("var " + i + " = Math.round(" + o.expression + ")"),
                        e.push("var " + t + "=" + this.starting_value);
                    var u = "for (var " + r + "=" + n + ";" + r + "<=" + i + ";" + r + "++) {" + s.statements.join(";") + ";" + t + this.in_place_operator + s.expression + "};"
                        , c = "if(!isFinite(" + i + "-" + n + ")) {" + t + "=(" + i + "<" + n + "?" + this.starting_value + ":NaN);}else{" + u + "}";
                    return e.push(c),
                        {
                            statements: e,
                            expression: t
                        }
                }
                ,
                e.evaluate = function(e, t, r) {
                    var n = r.getCompiledFunction([this._index._symbol]).fn;
                    if (t = Math.round(t),
                        e = Math.round(e),
                        !isFinite(t - e))
                        return t < e ? this.starting_value : NaN;
                    for (var i = this.starting_value, a = e; a <= t; a++)
                        i = this.update(i, n(a));
                    return i
                }
        })
    });
    _("core/math/parsenode/sum", ["require", "pjs", "./repeatedoperator"], function(e) {
        "use strict";
        return e("pjs")(e("./repeatedoperator"), function(e, t) {
            e.in_place_operator = "+=",
                e.starting_value = 0,
                e.evaluateConstant = function(e) {
                    var t = 1 + Math.round(e[1]) - Math.round(e[0]);
                    return t <= 0 ? this.starting_value : t * e[2]
                }
                ,
                e.update = function(e, t) {
                    return e + t
                }
        })
    });
    _("core/math/parsenode/product", ["require", "pjs", "./repeatedoperator"], function(e) {
        "use strict";
        return e("pjs")(e("./repeatedoperator"), function(e, t) {
            e.in_place_operator = "*=",
                e.starting_value = 1,
                e.evaluateConstant = function(e) {
                    var t = 1 + Math.round(e[1]) - Math.round(e[0]);
                    return t <= 0 ? this.starting_value : Math.pow(e[2], t)
                }
                ,
                e.update = function(e, t) {
                    return e * t
                }
        })
    });
    _("core/math/parsenode/integral", ["require", "pjs", "./scalarexpression", "./dummyindex", "core/math/builtin"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./scalarexpression")
            , n = e("./dummyindex")
            , a = e("core/math/builtin");
        return t(r, function(e, t) {
            e.init = function(e) {
                t.init.call(this, e),
                    this._differential = e[0],
                    this.addDummyDependency(this._differential._symbol),
                this._differential instanceof n && this.removeDependency(this._differential._symbol)
            }
                ,
                e.getEvalStrings = function() {
                    var e = this.args[0]
                        , t = this.args[1]
                        , r = this.args[2]
                        , n = this.args[3]
                        , i = []
                        , a = this.tmpVar()
                        , o = e._symbol
                        , s = this.tmpVar()
                        , u = this.tmpVar()
                        , c = t.getEvalStrings()
                        , l = r.getEvalStrings()
                        , p = n.getEvalStrings();
                    return Array.prototype.push.apply(i, c.statements),
                        Array.prototype.push.apply(i, l.statements),
                        i.push("var " + s + " = " + c.expression),
                        i.push("var " + u + " = " + l.expression),
                        i.push("var " + a + " = function (" + o + ") { " + p.statements.join("; ") + "; return " + p.expression + ";}"),
                        {
                            statements: i,
                            expression: "BuiltIn.quad(" + [a, s, u].join(", ") + ")"
                        }
                }
                ,
                e.evaluate = function(e, t, r) {
                    var n = this.args[0]
                        , i = r.getCompiledFunction([n._symbol]).fn;
                    return a.quad(i, e, t)
                }
        })
    });
    _("core/math/parsenode/functioncall", ["require", "pjs", "./expression", "./identifier"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./expression")
            , n = e("./identifier");
        return t(r, function(e, r) {
            e.init = function(e, t) {
                "string" == typeof e && (e = n(e)),
                    this._identifier = e,
                    this._symbol = e._symbol,
                    r.init.call(this, t),
                    this.addDependency(this._symbol)
            }
                ,
                e.copyWithArgs = function(e) {
                    return new this.constructor(n(this._symbol),e)
                }
        })
    });
    _("core/math/parsenode/seededfunctioncall", ["require", "pjs", "./functioncall"], function(e) {
        "use strict";
        return e("pjs")(e("./functioncall"), function(e, r) {
            e.init = function(e, t) {
                r.init.call(this, e, t),
                    this.seed = t[0]
            }
        })
    });
    _("core/math/parsenode/functionexponent", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {})
    });
    _("core/math/parsenode/functionfactorial", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {})
    });
    _("core/math/parsenode/prime", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, r) {
            e.init = function(e, t) {
                r.init.call(this, t),
                    this.order = e
            }
                ,
                e.copyWithArgs = function(e) {
                    return new this.constructor(this.order,e)
                }
        })
    });
    _("core/math/parsenode/piecewise", ["require", "pjs", "./scalarexpression", "./constant", "core/math/maybe-rational"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./scalarexpression")
            , n = e("./constant")
            , i = e("core/math/maybe-rational").maybeRational
            , a = t(r, {});
        return a.chain = function(e, t) {
            for (var r, n = t; e.length; )
                r = e.pop(),
                    n = a([r.condition, r.if_expr, n]);
            return n
        }
            ,
            a.empty = function() {
                return a([n(!0), n(i(1, 1)), n(NaN)])
            }
            ,
            a
    });
    _("core/math/parsenode/derivative", ["require", "pjs", "./scalarexpression", "./identifier"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./scalarexpression")
            , n = e("./identifier");
        return t(r, function(e, r) {
            e.init = function(e, t) {
                this._symbol = e instanceof n ? e._symbol : n(e)._symbol,
                    r.init.call(this, t)
            }
        })
    });
    _("core/math/parsenode/nativefunction", ["require", "pjs", "./scalarexpression", "core/math/functions"], function(e) {
        "use strict";
        var i = e("pjs")
            , t = e("./scalarexpression")
            , s = e("core/math/functions");
        return i(t, function(e, r, t) {
            e.init = function(e, t) {
                if (e.length >= this._requiredArity)
                    for (; e.length < this._maxArity; )
                        e.push(this._optionalArguments[e.length - this._requiredArity]);
                this._errorSymbol = "logbase" === this._symbol ? "log" : t || this._symbol,
                    r.init.call(this, e)
            }
                ,
                e.copyWithArgs = function(e) {
                    var t = r.copyWithArgs.call(this, e);
                    return t._errorSymbol = this._errorSymbol,
                        t
                }
                ,
                e.scalarEvalExpression = function(e) {
                    return this.head + "(" + e.join(",") + ")"
                }
                ,
                t.create = function(r, n, a, o) {
                    return i(this, function(e, t, i) {
                        i.isFunction = !0,
                            e._symbol = r,
                            e.head = n,
                            e._requiredArity = a,
                            e._optionalArguments = o || [],
                            e._maxArity = e._requiredArity + e._optionalArguments.length,
                            e.evaluate = s.createEvaluateFunction(e.scalarEvalExpression.bind(e), e._maxArity),
                            i.getConcreteInvocationTree = function(e, t, r, n) {
                                return i(r, n).getConcreteTree(e, t)
                            }
                            ,
                            i.getCacheKeys = function() {
                                return []
                            }
                    })
                }
        })
    });
    _("core/math/parsenode/typedfunction", ["require", "pjs", "./nativefunction"], function(e) {
        "use strict";
        return e("pjs")(e("./nativefunction"), function(e, t, r, o) {
            r.create = function(e, t, r, n) {
                var i = r.length
                    , a = o.create.call(this, e, t, i);
                return a.prototype._inputTypes = r,
                    a.prototype._outputType = n,
                    a
            }
        })
    });
    _("core/math/parsenode/trigfunction", ["require", "pjs", "./nativefunction", "./expressionTypes", "core/math/errormsg"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./nativefunction")
            , o = e("./expressionTypes").Multiply
            , s = e("core/math/errormsg");
        return t(r, function(e, t, r, n) {
            r.create = function(e, t) {
                var a = n.create(e, t, 1);
                return a.getConcreteInvocationTree = function(e, t, r, n) {
                    if (r.length < 1)
                        throw s.wrongArity(n, 1, r.length);
                    var i = t.trigAngleMultiplier ? [o([r[0], t.trigAngleMultiplier])].concat(r.slice(1)) : r;
                    return a(i, n).getConcreteTree(e, t)
                }
                    ,
                    a.getCacheKeys = function() {
                        return ["trigAngleMultiplier"]
                    }
                    ,
                    a
            }
        })
    });
    _("core/math/parsenode/inversetrigfunction", ["require", "pjs", "./nativefunction", "./expressionTypes"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./nativefunction")
            , o = e("./expressionTypes").Divide;
        return t(r, function(e, t, r, n) {
            r.create = function(e, t, r) {
                var a = n.create(e, t, 1, r);
                return a.getConcreteInvocationTree = function(e, t, r, n) {
                    var i = a(r, n);
                    return (t.trigAngleMultiplier ? o([i, t.trigAngleMultiplier]) : i).getConcreteTree(e, t)
                }
                    ,
                    a.getCacheKeys = function() {
                        return ["trigAngleMultiplier"]
                    }
                    ,
                    a
            }
        })
    });
    _("core/math/parsenode/distribution", ["require", "pjs", "./scalarexpression", "core/math/errormsg"], function(e) {
        "use strict";
        var i = e("pjs")
            , t = e("./scalarexpression")
            , a = e("core/math/errormsg");
        return i(t, function(e, n, t) {
            e.init = function(e, t) {
                var r = "tdist" === this._symbol;
                if (e.length < this._requiredArity) {
                    if (r)
                        throw a.tdistWrongArity();
                    throw a.wrongArity(t, this._requiredArity, e.length)
                }
                if (e.length > this._maxArity) {
                    if (r)
                        throw a.tdistWrongArity();
                    throw a.wrongArity(this._symbol, this._maxArity, e.length)
                }
                for (; e.length < this._maxArity; )
                    e.push(this._optionalArguments[e.length - this._requiredArity]);
                n.init.call(this, e)
            }
                ,
                e.scalarEvalExpression = function(e) {
                    return this.head + "(" + e.join(",") + ")"
                }
                ,
                t.create = function(r, n, a) {
                    return i(this, function(e, t, i) {
                        i.isFunction = !0,
                            e._symbol = r,
                            e._requiredArity = n,
                            e._optionalArguments = a || [],
                            e._maxArity = e._requiredArity + e._optionalArguments.length,
                            i.getConcreteInvocationTree = function(e, t, r, n) {
                                return i(r, n)
                            }
                            ,
                            i.getCacheKeys = function() {
                                return []
                            }
                    })
                }
        })
    });
    _("core/math/parsenode/reducerfunction", ["require", "pjs", "./expression", "core/math/functions", "core/math/errormsg", "./distribution", "core/math/types"], function(e) {
        "use strict";
        var i = e("pjs")
            , t = e("./expression")
            , a = e("core/math/functions")
            , n = e("core/math/errormsg")
            , o = e("./distribution")
            , s = e("core/math/types");
        return i(t, function(e, r, t) {
            e.init = function(e, t) {
                if (0 === e.length)
                    throw n.zeroArgReducer(t);
                if (e[0]instanceof o && "length" !== this._symbol && !e[0][this._symbol])
                    throw n.functionTypeError(this._symbol, [s.prettyPrint(this.args[0].valueType)]);
                r.init.call(this, e)
            }
                ,
                e.evalExpression = function(e) {
                    return this.head + "(" + e + ")"
                }
                ,
                e.getEvalStrings = function() {
                    var e = this.args[0].getEvalStrings();
                    return {
                        statements: e.statements,
                        expression: this.evalExpression(e.expression)
                    }
                }
                ,
                t.create = function(r, n) {
                    return i(t, function(e, t, i) {
                        e._symbol = r,
                            e.head = n,
                            e._arity = 1,
                            i.isFunction = !0,
                            i.allowDotCalls = !0,
                            i.dotMinArity = 0,
                            i.dotMaxArity = 0,
                            e.evaluate = a.createEvaluateFunction(e.evalExpression.bind(e), e._arity),
                            i.getConcreteInvocationTree = function(e, t, r, n) {
                                return i(r, n).getConcreteTree(e, t)
                            }
                            ,
                            i.getCacheKeys = function() {
                                return []
                            }
                    })
                }
        })
    });
    _("core/math/parsenode/doublereducerfunction", ["require", "pjs", "./expression", "core/math/functions", "core/math/errormsg"], function(e) {
        "use strict";
        var i = e("pjs")
            , t = e("./expression")
            , a = e("core/math/functions")
            , n = e("core/math/errormsg");
        return i(t, function(e, r, t) {
            e.init = function(e, t) {
                if (r.init.call(this, e),
                2 !== this.args.length)
                    throw n.wrongDoubleReducerArity(t)
            }
                ,
                e.evalExpression = function(e) {
                    return this.head + "(" + e.join(",") + ")"
                }
                ,
                e.getEvalStrings = function() {
                    for (var e = [], t = [], r = Math.min(this.args[0].length, this.args[1].length), n = 0; n < this.args.length; n++) {
                        var i = this.args[n]
                            , a = i.getEvalStrings();
                        Array.prototype.push.apply(e, a.statements),
                            t.push(i.length === r ? a.expression : a.expression + ".slice(0," + r + ")")
                    }
                    return {
                        statements: e,
                        expression: this.evalExpression(t)
                    }
                }
                ,
                t.create = function(r, n) {
                    return i(t, function(e, t, i) {
                        e._symbol = r,
                            e.head = n,
                            e._arity = 2,
                            i.isFunction = !0,
                            e.evaluate = a.createEvaluateFunction(e.evalExpression.bind(e), e._arity),
                            i.getConcreteInvocationTree = function(e, t, r, n) {
                                return i(r, n).getConcreteTree(e, t)
                            }
                            ,
                            i.getCacheKeys = function() {
                                return []
                            }
                    })
                }
        })
    });
    _("core/math/parsenode/parametrizedreducerfunction", ["require", "pjs", "./expression", "core/math/functions", "core/math/errormsg", "./distribution", "core/math/types"], function(e) {
        "use strict";
        var i = e("pjs")
            , t = e("./expression")
            , o = e("core/math/functions")
            , n = e("core/math/errormsg")
            , a = e("./distribution")
            , s = e("core/math/types");
        return i(t, function(e, r, t) {
            e.init = function(e, t) {
                if (e.length < 2 && void 0 !== this._optionalArgument && e.push(this._optionalArgument),
                2 !== e.length)
                    throw n.wrongParametrizedReducerArity(t);
                if (e[0]instanceof a && !e[0][this._symbol])
                    throw n.functionTypeError(t, [s.prettyPrint(this.args[0].valueType)]);
                r.init.call(this, e)
            }
                ,
                e.evalExpression = function(e) {
                    return this.head + "(" + e.join(",") + ")"
                }
                ,
                e.getEvalStrings = function() {
                    var e = []
                        , t = this.args[0].getEvalStrings()
                        , r = this.args[1].getEvalStrings();
                    return Array.prototype.push.apply(e, t.statements),
                        Array.prototype.push.apply(e, r.statements),
                        {
                            statements: e,
                            expression: this.evalExpression([t.expression, r.expression])
                        }
                }
                ,
                t.create = function(r, n, a) {
                    return i(t, function(e, t, i) {
                        e._symbol = r,
                            e.head = n,
                            e._optionalArgument = a,
                            e._arity = 2,
                            i.isFunction = !0,
                            i.allowDotCalls = !0,
                            i.dotMinArity = void 0 === a ? 1 : 0,
                            i.dotMaxArity = 1,
                            e.evaluate = o.createEvaluateFunction(e.evalExpression.bind(e), e._arity),
                            i.getConcreteInvocationTree = function(e, t, r, n) {
                                return i(r, n).getConcreteTree(e, t)
                            }
                            ,
                            i.getCacheKeys = function() {
                                return []
                            }
                    })
                }
        })
    });
    _("core/math/parsenode/toplevelfunction", ["require", "pjs", "./nativefunction", "core/math/errormsg"], function(e) {
        "use strict";
        var i = e("pjs")
            , t = e("./nativefunction")
            , a = e("core/math/errormsg");
        return i(t, function(e, t, r, n) {
            r.create = function(e) {
                return i(r, function(e, t, r) {
                    r.isFunction = !0,
                        r.getConcreteInvocationTree = function(e, t, r, n) {
                            throw a.unexpectedSymbol(n)
                        }
                        ,
                        r.getCacheKeys = function() {
                            return []
                        }
                })
            }
        })
    });
    _("core/math/parsenode/builtinfunction", ["require", "core/math/parsenode/nativefunction", "core/math/parsenode/typedfunction", "core/math/parsenode/trigfunction", "core/math/parsenode/inversetrigfunction", "core/math/parsenode/reducerfunction", "core/math/parsenode/doublereducerfunction", "core/math/parsenode/parametrizedreducerfunction", "core/math/parsenode/distribution", "core/math/parsenode/toplevelfunction", "core/math/types", "core/math/maybe-rational", "core/math/parsenode/constant"], function(e) {
        "use strict";
        var t = e("core/math/parsenode/nativefunction")
            , r = e("core/math/parsenode/typedfunction")
            , n = e("core/math/parsenode/trigfunction")
            , i = e("core/math/parsenode/inversetrigfunction")
            , a = e("core/math/parsenode/reducerfunction")
            , o = e("core/math/parsenode/doublereducerfunction")
            , s = e("core/math/parsenode/parametrizedreducerfunction")
            , u = e("core/math/parsenode/distribution")
            , c = e("core/math/parsenode/toplevelfunction")
            , l = e("core/math/types")
            , p = e("core/math/maybe-rational").maybeRational
            , f = e("core/math/parsenode/constant")
            , h = f(p(1, 1))
            , d = f(p(0, 1))
            , m = f(p(1, 2));
        return {
            sin: n.create("sin", "BuiltIn.sin"),
            cos: n.create("cos", "BuiltIn.cos"),
            tan: n.create("tan", "BuiltIn.tan"),
            cot: n.create("cot", "BuiltIn.cot"),
            sec: n.create("sec", "BuiltIn.sec"),
            csc: n.create("csc", "BuiltIn.csc"),
            arcsin: i.create("arcsin", "Math.asin"),
            arccos: i.create("arccos", "Math.acos"),
            arctan: i.create("arctan", "Math.atan2", [h]),
            arccot: i.create("arccot", "BuiltIn.acot"),
            arcsec: i.create("arcsec", "BuiltIn.asec"),
            arccsc: i.create("arccsc", "BuiltIn.acsc"),
            sinh: t.create("sinh", "BuiltIn.sinh", 1),
            cosh: t.create("cosh", "BuiltIn.cosh", 1),
            tanh: t.create("tanh", "BuiltIn.tanh", 1),
            coth: t.create("coth", "BuiltIn.coth", 1),
            sech: t.create("sech", "BuiltIn.sech", 1),
            csch: t.create("csch", "BuiltIn.csch", 1),
            arcsinh: t.create("arcsinh", "BuiltIn.asinh", 1),
            arccosh: t.create("arccosh", "BuiltIn.acosh", 1),
            arctanh: t.create("arctanh", "BuiltIn.atanh", 1),
            arccoth: t.create("arccoth", "BuiltIn.acoth", 1),
            arcsech: t.create("arcsech", "BuiltIn.asech", 1),
            arccsch: t.create("arccsch", "BuiltIn.acsch", 1),
            sqrt: t.create("sqrt", "Math.sqrt", 1),
            rtxsqpone: t.create("rtxsqpone", "BuiltIn.sqrtxsqp1", 1),
            rtxsqmone: t.create("rtxsqmone", "BuiltIn.sqrtxsqm1", 1),
            nthroot: t.create("nthroot", "BuiltIn.nthroot", 2),
            log: t.create("log", "BuiltIn.common_log", 1),
            logbase: t.create("logbase", "BuiltIn.log_base", 2),
            ln: t.create("ln", "BuiltIn.log", 1),
            exp: t.create("exp", "Math.exp", 1),
            floor: t.create("floor", "Math.floor", 1),
            ceil: t.create("ceil", "Math.ceil", 1),
            round: t.create("round", "BuiltIn.round", 1, [d]),
            abs: t.create("abs", "Math.abs", 1),
            sign: t.create("sign", "BuiltIn.sign", 1),
            mod: t.create("mod", "BuiltIn.mod", 2),
            nCr: t.create("nCr", "BuiltIn.nCr", 2),
            nPr: t.create("nPr", "BuiltIn.nPr", 2),
            factorial: t.create("factorial", "BuiltIn.factorial", 1),
            polyGamma: t.create("polyGamma", "BuiltIn.polyGamma", 2),
            lcm: a.create("lcm", "BuiltIn.listLCM"),
            gcd: a.create("gcd", "BuiltIn.listGCD"),
            mean: a.create("mean", "BuiltIn.mean"),
            total: a.create("total", "BuiltIn.total"),
            stdev: a.create("stdev", "BuiltIn.stdev"),
            stdevp: a.create("stdevp", "BuiltIn.stdevp"),
            mad: a.create("mad", "BuiltIn.mad"),
            length: a.create("length", "BuiltIn.length"),
            min: a.create("min", "BuiltIn.listMin"),
            max: a.create("max", "BuiltIn.listMax"),
            argmin: a.create("argmin", "BuiltIn.argMin"),
            argmax: a.create("argmax", "BuiltIn.argMax"),
            median: a.create("median", "BuiltIn.median"),
            var: a.create("var", "BuiltIn.var"),
            varp: a.create("varp", "BuiltIn.varp"),
            cov: o.create("cov", "BuiltIn.cov"),
            covp: o.create("covp", "BuiltIn.covp"),
            corr: o.create("corr", "BuiltIn.corr"),
            spearman: o.create("spearman", "BuiltIn.spearman"),
            quantile: s.create("quantile", "BuiltIn.quantile"),
            quartile: s.create("quartile", "BuiltIn.quartile"),
            upperQuantileIndex: s.create("upperQuantileIndex", "BuiltIn.upperQuantileIndex"),
            lowerQuantileIndex: s.create("lowerQuantileIndex", "BuiltIn.lowerQuantileIndex"),
            quartileIndex: s.create("quartileIndex", "BuiltIn.quartileIndex"),
            upperQuartileIndex: s.create("upperQuartileIndex", "BuiltIn.upperQuartileIndex"),
            lowerQuartileIndex: s.create("lowerQuartileIndex", "BuiltIn.lowerQuartileIndex"),
            normalcdf: t.create("normalcdf", "BuiltIn.normalcdf", 2, [d, h]),
            normalpdf: t.create("normalpdf", "BuiltIn.normalpdf", 1, [d, h]),
            normalSample: r.create("normalSample", "BuiltIn.normalSample", [l.SeedType, l.Number, l.Number], l.Number),
            uniformSample: r.create("uniformSample", "BuiltIn.uniformSample", [l.SeedType, l.Number, l.Number], l.Number),
            tSample: r.create("tSample", "BuiltIn.tSample", [l.SeedType, l.Number], l.Number),
            poissonSample: r.create("poissonSample", "BuiltIn.poissonSample", [l.SeedType, l.Number], l.Number),
            binomSample: r.create("binomSample", "BuiltIn.binomSample", [l.SeedType, l.Number, l.Number], l.Number),
            binomcdf: t.create("binomcdf", "BuiltIn.binomcdf", 3, [m]),
            binompdf: t.create("binompdf", "BuiltIn.binompdf", 2, [m]),
            poissoncdf: t.create("poissoncdf", "BuiltIn.poissoncdf", 3),
            poissonpdf: t.create("poissonpdf", "BuiltIn.poissonpdf", 2),
            uniformcdf: t.create("uniformcdf", "BuiltIn.uniformcdf", 2, [d, h]),
            uniformpdf: t.create("uniformpdf", "BuiltIn.uniformpdf", 1, [d, h]),
            invNorm: t.create("invNorm", "BuiltIn.invNorm", 1),
            invT: t.create("invT", "BuiltIn.invT", 2),
            invPoisson: t.create("invPoisson", "BuiltIn.invPoisson", 2),
            invBinom: t.create("invBinom", "BuiltIn.invBinom", 3),
            invUniform: t.create("invUniform", "BuiltIn.invUniform", 3),
            erf: t.create("erf", "BuiltIn.erf", 1),
            tpdf: t.create("tpdf", "BuiltIn.tpdf", 2),
            tcdf: t.create("tcdf", "BuiltIn.tcdf", 3),
            tscore: s.create("tscore", "BuiltIn.tscore", d),
            distance: r.create("distance", "BuiltIn.distance", [l.Point, l.Point], l.Number),
            midpoint: r.create("midpoint", "BuiltIn.midpoint", [l.Point, l.Point], l.Point),
            addPoints: r.create("addPoints", "BuiltIn.addPoints", [l.Point, l.Point], l.Point),
            subtractPoints: r.create("addPoints", "BuiltIn.subtractPoints", [l.Point, l.Point], l.Point),
            negatePoint: r.create("negatePoint", "BuiltIn.negatePoint", [l.Point], l.Point),
            multiplyPoint: r.create("multiplyPoint", "BuiltIn.multiplyPoint", [l.Point, l.Number], l.Point),
            dividePoint: r.create("dividePoint", "BuiltIn.dividePoint", [l.Point, l.Number], l.Point),
            normaldist: u.create("normaldist", 0, [d, h]),
            tdist: u.create("tdist", 1),
            binomialdist: u.create("binomialdist", 1, [m]),
            poissondist: u.create("poissondist", 1),
            uniformdist: u.create("uniformdist", 0, [d, h]),
            pdf: r.create("pdf", "BuiltIn.normpdf", [l.Distribution, [l.Number, l.ListOfNumber, l.EmptyList]], l.Number).open(function(e, t, r) {
                r.allowDotCalls = !0,
                    r.dotMinArity = 1,
                    r.dotMaxArity = 1
            }),
            cdf: r.create("cdf", "BuiltIn.normcdf", [l.Distribution, [l.Number, l.ListOfNumber, l.EmptyList], [l.Number, l.ListOfNumber, l.EmptyList]], l.Number).open(function(e, t, r) {
                r.allowDotCalls = !0,
                    r.dotMinArity = 1,
                    r.dotMaxArity = 2
            }),
            random: t.create("random", "", 2).open(function(e, t, r) {
                r.allowDotCalls = !0,
                    r.dotMinArity = 1,
                    r.dotMaxArity = 3
            }),
            rgb: r.create("rgb", "BuiltIn.rgb", [l.Number, l.Number, l.Number], l.RGBColor),
            hsv: r.create("hsv", "BuiltIn.hsv", [l.Number, l.Number, l.Number], l.RGBColor),
            shuffle: t.create("shuffle", "", 2).open(function(e, t, r) {
                r.allowDotCalls = !0,
                    r.dotMinArity = 1,
                    r.dotMaxArity = 2,
                    r.minArityUsageExample = "shuffle([1,2,3])",
                    e.minArityUsageExample = r.minArityUsageExample,
                    r.maxArityUsageExample = "shuffle([1,2,3],2)",
                    e.maxArityUsageExample = r.maxArityUsageExample,
                    r.dotMaxArityUsageExample = ".shuffle(2)"
            }),
            sort: t.create("sort", "", 1).open(function(e, t, r) {
                r.allowDotCalls = !0,
                    r.dotMinArity = 0,
                    r.dotMaxArity = 1,
                    r.minArityUsageExample = "sort([3,2,1])",
                    e.minArityUsageExample = r.minArityUsageExample,
                    r.maxArityUsageExample = "sort([1,2,3],[3,2,1])",
                    e.maxArityUsageExample = r.maxArityUsageExample,
                    r.dotMaxArityUsageExample = ".sort([3,4])"
            }),
            join: t.create("join", "", 2).open(function(e, t, r) {
                r.allowDotCalls = !0,
                    r.dotMinArity = 1,
                    r.dotMaxArity = 1 / 0,
                    r.minArityUsageExample = "join([1,2],[3,4])",
                    e.minArityUsageExample = r.minArityUsageExample,
                    r.dotMinArityUsageExample = ".join([3,4])"
            }),
            polygon: c.create("polygon"),
            histogram: c.create("histogram"),
            dotplot: c.create("dotplot"),
            boxplot: c.create("boxplot"),
            ttest: c.create("ttest"),
            ittest: c.create("ittest"),
            stats: c.create("stats"),
            det: c.create("det"),
            inv: c.create("inv"),
            transpose: c.create("transpose"),
            rref: c.create("rref"),
            trace: c.create("trace")
        }
    });
    _("core/math/parsenode/histogram", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {
            e.init = function(e) {
                t.init.call(this, e),
                    this._symbol = "histogram"
            }
        })
    });
    _("core/math/parsenode/object3d", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, r) {
            e.init = function(e, t) {
                r.init.call(this, e),
                    this._symbol = t
            }
        })
    });
    _("core/math/parsenode/dotplot", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {
            e.init = function(e) {
                t.init.call(this, e),
                    this._symbol = "dotplot"
            }
        })
    });
    _("core/math/parsenode/boxplot", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {
            e.init = function(e) {
                t.init.call(this, e),
                    this._symbol = "boxplot"
            }
        })
    });
    _("core/math/parsenode/ttest", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {
            e.init = function() {
                t.init.apply(this, arguments),
                    this._symbol = "ttest"
            }
        })
    });
    _("core/math/parsenode/independent-ttest", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {
            e.init = function() {
                t.init.apply(this, arguments),
                    this._symbol = "ittest"
            }
        })
    });
    _("core/math/parsenode/stats", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {
            e.init = function() {
                t.init.apply(this, arguments),
                    this._symbol = "stats"
            }
        })
    });
    _("core/math/parsenode/equation", ["require", "./base", "pjs", "./expressionTypes", "core/math/parsenode/comparator"], function(e) {
        "use strict";
        var t = e("./base")
            , r = e("pjs")
            , n = e("./expressionTypes").Subtract
            , i = e("core/math/parsenode/comparator");
        return r(t, function(e, r) {
            e.init = function(e, t) {
                r.init.call(this),
                    this.mergeDependencies(e, t),
                    this._lhs = e,
                    this._rhs = t,
                    this._difference = n([this._lhs, this._rhs])
            }
                ,
                e.asComparator = function() {
                    return i["="]([this._lhs, this._rhs])
                }
        })
    });
    _("core/math/parsenode/assignment", ["require", "./base", "./equation", "./identifier", "pjs"], function(e) {
        "use strict";
        var t = e("./base")
            , n = e("./equation")
            , i = e("./identifier");
        return e("pjs")(t, function(e, r) {
            e.init = function(e, t) {
                r.init.call(this),
                    e = e._symbol,
                    this.mergeDependencies(t),
                    this._expression = t,
                    this._symbol = e,
                    this._exports = this.computeExports()
            }
                ,
                e.shouldExportAns = function() {
                    return !0
                }
                ,
                e.computeExports = function() {
                    for (var e = this._symbol, t = this.getDependencies(), r = 0; r < t.length; r++)
                        if (t[r] === e)
                            return [];
                    return [e]
                }
                ,
                e.isEquation = function(e) {
                    return -1 !== e.getDependencies().indexOf(this._symbol)
                }
                ,
                e.asEquation = function() {
                    var e = n(i(this._symbol), this._expression);
                    return e.userData = this.userData,
                        e.metaData = this.metaData,
                        e
                }
                ,
                e.shouldPromoteToSlider = function(e) {
                    return !!this._expression.isConstant && (!this._expression.is_mixed_number && ("number" == typeof this._expression.asValue() && (!!isFinite(this._expression.asValue()) && e.isValidSlider(this._symbol))))
                }
        })
    });
    _("core/math/parsenode/functiondefinition", ["require", "pjs", "./base", "core/math/errormsg", "./equation", "./identifier", "./functioncall"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./base")
            , o = e("core/math/errormsg")
            , i = e("./equation")
            , a = e("./identifier")
            , s = e("./functioncall");
        return t(r, function(e, n) {
            e.init = function(e, t, r) {
                n.init.call(this),
                    e = e._symbol,
                    this._argSymbols = t.map(function(e) {
                        return e._symbol
                    }),
                    this._symbol = e,
                    this._exports = [e],
                    this._expression = r,
                    this.addDependencies(this._argSymbols),
                    this.addDummyDependencies(this._argSymbols),
                    this.mergeDependencies(this._expression)
            }
                ,
                e.isFunction = !0,
                e.getConcreteInvocationTree = function(e, t, r, n) {
                    if (r.length !== this._argSymbols.length)
                        throw o.wrongArity(n, this._argSymbols.length, r.length);
                    for (var i = Object.create(t), a = 0; a < this._argSymbols.length; a++)
                        i[this._argSymbols[a]] = r[a];
                    return this._expression.getConcreteTree(e, i)
                }
                ,
                e.getSliderVariables = function(e, t) {
                    var r = this._argSymbols;
                    return e.sliderVariables(t.getDependencies()).filter(function(e) {
                        return -1 === r.indexOf(e)
                    })
                }
                ,
                e.asEquation = function() {
                    var e = this._argSymbols.map(function(e) {
                        return a(e)
                    })
                        , t = i(s(a(this._symbol), e), this._expression);
                    return t.userData = this.userData,
                        t.metaData = this.metaData,
                        t
                }
        })
    });
    _("core/math/parsenode/optimizedregression", ["require", "pjs", "./base"], function(e) {
        "use strict";
        return e("pjs")(e("./base"), function(e, o) {
            e.init = function(e, t, r, n, i) {
                for (var a in o.init.call(this),
                    this.parameters = e,
                    this.residuals = t,
                    this.statistics = r,
                    this.model = n,
                    this.isModelValid = i.isModelValid,
                    this.residualVariable = i.residualVariable,
                    this.residualSuggestionId = i.residualSuggestionId,
                    this.shouldSuggestLogMode = i.shouldSuggestLogMode,
                    this.isLinear = i.isLinear,
                    this.parameterWarning = i.parameterWarning,
                    this._exports = [this.residualVariable],
                    e)
                    e.hasOwnProperty(a) && this._exports.push(a);
                this.mergeDependencies(n)
            }
                ,
                e.getCompiledFunction = function() {
                    return this.model.getCompiledFunction.apply(this.model, arguments)
                }
                ,
                e.getCompiledDerivative = function() {
                    return this.model.getCompiledDerivative.apply(this.model, arguments)
                }
                ,
                e.evaluate = function() {
                    return this.model.evaluate.apply(this.model, arguments)
                }
        })
    });
    _("numeric", [], function() {
        "use strict";
        var g = "undefined" == typeof exports ? function() {}
            : exports;
        return "undefined" != typeof global && (global.numeric = g),
            g.version = "1.2.6",
            g._myIndexOf = function(e) {
                for (var t = this.length, r = 0; r < t; ++r)
                    if (this[r] === e)
                        return r;
                return -1
            }
            ,
            g.myIndexOf = Array.prototype.indexOf ? Array.prototype.indexOf : g._myIndexOf,
            g.precision = 4,
            g.largeArray = 50,
            g.compile = function() {
                var e = Array.prototype.slice.call(arguments)
                    , t = e.pop()
                    , t = "return function (" + e.join(",") + ") {" + t + "}";
                return new Function(["numeric"],t)(g)
            }
            ,
            g._dim = function(e) {
                for (var t = []; "object" == typeof e; )
                    t.push(e.length),
                        e = e[0];
                return t
            }
            ,
            g.dim = function(e) {
                var t;
                return "object" == typeof e ? "object" == typeof (t = e[0]) ? "object" == typeof t[0] ? g._dim(e) : [e.length, t.length] : [e.length] : []
            }
            ,
            g.mapreduce = function(e, t) {
                return g.compile("x", "accum", "_s", "_k", 'if(typeof accum === "undefined") accum = ' + t + ';\nif(typeof x === "number") { var xi = x; ' + e + '; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    ' + e + ";\n    xi = x[i-1];\n    " + e + ";\n}\nif(i === 0) {\n    xi = x[i];\n    " + e + "\n}\nreturn accum;")
            }
            ,
            g.mapreduce2 = function(e, t) {
                return g.compile("x", "var n = x.length;\nvar i,xi;\n" + t + "\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    " + e + "\n}\nreturn accum;")
            }
            ,
            g.rep = function(e, t, r) {
                void 0 === r && (r = 0);
                var n, i = e[r], a = Array(i);
                if (r === e.length - 1) {
                    for (n = i - 2; 0 <= n; n -= 2)
                        a[n + 1] = t,
                            a[n] = t;
                    return -1 === n && (a[0] = t),
                        a
                }
                for (n = i - 1; 0 <= n; n--)
                    a[n] = g.rep(e, t, r + 1);
                return a
            }
            ,
            g.dotMMsmall = function(e, t) {
                for (var r, n, i, a, o, s, u = e.length, c = t.length, l = t[0].length, p = Array(u), f = u - 1; 0 <= f; f--) {
                    for (i = Array(l),
                             a = e[f],
                             n = l - 1; 0 <= n; n--) {
                        for (o = a[c - 1] * t[c - 1][n],
                                 r = c - 2; 1 <= r; r -= 2)
                            s = r - 1,
                                o += a[r] * t[r][n] + a[s] * t[s][n];
                        0 === r && (o += a[0] * t[0][n]),
                            i[n] = o
                    }
                    p[f] = i
                }
                return p
            }
            ,
            g._getCol = function(e, t, r) {
                for (var n = e.length - 1; 0 < n; --n)
                    r[n] = e[n][t],
                        r[--n] = e[n][t];
                0 === n && (r[0] = e[0][t])
            }
            ,
            g.dotMMbig = function(e, t) {
                var r, n, i, a = g._getCol, o = t.length, s = Array(o), u = e.length, c = t[0].length, l = new Array(u), p = g.dotVV;
                for (n = --u; -1 !== n; --n)
                    l[n] = Array(c);
                for (n = --c; -1 !== n; --n)
                    for (a(t, n, s),
                             i = u; -1 !== i; --i)
                        r = e[i],
                            l[i][n] = p(r, s);
                return l
            }
            ,
            g.dotMV = function(e, t) {
                for (var r = e.length, n = (t.length,
                    Array(r)), i = g.dotVV, a = r - 1; 0 <= a; a--)
                    n[a] = i(e[a], t);
                return n
            }
            ,
            g.dotVM = function(e, t) {
                for (var r, n, i, a = e.length, o = t[0].length, s = Array(o), u = o - 1; 0 <= u; u--) {
                    for (n = e[a - 1] * t[a - 1][u],
                             r = a - 2; 1 <= r; r -= 2)
                        i = r - 1,
                            n += e[r] * t[r][u] + e[i] * t[i][u];
                    0 === r && (n += e[0] * t[0][u]),
                        s[u] = n
                }
                return s
            }
            ,
            g.dotVV = function(e, t) {
                for (var r, n = e.length, i = e[n - 1] * t[n - 1], a = n - 2; 1 <= a; a -= 2)
                    r = a - 1,
                        i += e[a] * t[a] + e[r] * t[r];
                return 0 === a && (i += e[0] * t[0]),
                    i
            }
            ,
            g.dot = function(e, t) {
                var r = g.dim;
                switch (1e3 * r(e).length + r(t).length) {
                    case 2002:
                        return t.length < 10 ? g.dotMMsmall(e, t) : g.dotMMbig(e, t);
                    case 2001:
                        return g.dotMV(e, t);
                    case 1002:
                        return g.dotVM(e, t);
                    case 1001:
                        return g.dotVV(e, t);
                    case 1e3:
                        return g.mulVS(e, t);
                    case 1:
                        return g.mulSV(e, t);
                    case 0:
                        return e * t;
                    default:
                        throw new Error("numeric.dot only works on vectors and matrices")
                }
            }
            ,
            g.diag = function(e) {
                for (var t, r, n, i = e.length, a = Array(i), o = i - 1; 0 <= o; o--) {
                    for (n = Array(i),
                             t = o + 2,
                             r = i - 1; t <= r; r -= 2)
                        n[r] = 0,
                            n[r - 1] = 0;
                    for (o < r && (n[r] = 0),
                             n[o] = e[o],
                             r = o - 1; 1 <= r; r -= 2)
                        n[r] = 0,
                            n[r - 1] = 0;
                    0 === r && (n[0] = 0),
                        a[o] = n
                }
                return a
            }
            ,
            g.getDiag = function(e) {
                for (var t = Math.min(e.length, e[0].length), r = Array(t), n = t - 1; 1 <= n; --n)
                    r[n] = e[n][n],
                        r[--n] = e[n][n];
                return 0 === n && (r[0] = e[0][0]),
                    r
            }
            ,
            g.identity = function(e) {
                return g.diag(g.rep([e], 1))
            }
            ,
            g.pointwise = function(e, t, r) {
                void 0 === r && (r = "");
                for (var n, i = [], a = /\[i\]$/, o = "", s = !1, u = 0; u < e.length; u++)
                    a.test(e[u]) ? o = n = e[u].substring(0, e[u].length - 3) : n = e[u],
                    "ret" === n && (s = !0),
                        i.push(n);
                return i[e.length] = "_s",
                    i[e.length + 1] = "_k",
                    i[e.length + 2] = 'if(typeof _s === "undefined") _s = numeric.dim(' + o + ');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i' + (s ? "" : ", ret = Array(_n)") + ";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee(" + e.join(",") + ",_s,_k+1);\n    return ret;\n}\n" + r + "\nfor(i=_n-1;i!==-1;--i) {\n    " + t + "\n}\nreturn ret;",
                    g.compile.apply(null, i)
            }
            ,
            g.pointwise2 = function(e, t, r) {
                void 0 === r && (r = "");
                for (var n, i = [], a = /\[i\]$/, o = "", s = !1, u = 0; u < e.length; u++)
                    a.test(e[u]) ? o = n = e[u].substring(0, e[u].length - 3) : n = e[u],
                    "ret" === n && (s = !0),
                        i.push(n);
                return i[e.length] = "var _n = " + o + ".length;\nvar i" + (s ? "" : ", ret = Array(_n)") + ";\n" + r + "\nfor(i=_n-1;i!==-1;--i) {\n" + t + "\n}\nreturn ret;",
                    g.compile.apply(null, i)
            }
            ,
            g._biforeach = function e(t, r, n, i, a) {
                if (i !== n.length - 1)
                    for (var o = n[i] - 1; 0 <= o; o--)
                        e("object" == typeof t ? t[o] : t, "object" == typeof r ? r[o] : r, n, i + 1, a);
                else
                    a(t, r)
            }
            ,
            g._biforeach2 = function e(t, r, n, i, a) {
                if (i === n.length - 1)
                    return a(t, r);
                for (var o = n[i], s = Array(o), u = o - 1; 0 <= u; --u)
                    s[u] = e("object" == typeof t ? t[u] : t, "object" == typeof r ? r[u] : r, n, i + 1, a);
                return s
            }
            ,
            g._foreach = function e(t, r, n, i) {
                if (n !== r.length - 1)
                    for (var a = r[n] - 1; 0 <= a; a--)
                        e(t[a], r, n + 1, i);
                else
                    i(t)
            }
            ,
            g._foreach2 = function e(t, r, n, i) {
                if (n === r.length - 1)
                    return i(t);
                for (var a = r[n], o = Array(a), s = a - 1; 0 <= s; s--)
                    o[s] = e(t[s], r, n + 1, i);
                return o
            }
            ,
            g.ops2 = {
                add: "+",
                sub: "-",
                mul: "*",
                div: "/",
                mod: "%",
                and: "&&",
                or: "||",
                eq: "===",
                neq: "!==",
                lt: "<",
                gt: ">",
                leq: "<=",
                geq: ">=",
                band: "&",
                bor: "|",
                bxor: "^",
                lshift: "<<",
                rshift: ">>",
                rrshift: ">>>"
            },
            g.opseq = {
                addeq: "+=",
                subeq: "-=",
                muleq: "*=",
                diveq: "/=",
                modeq: "%=",
                lshifteq: "<<=",
                rshifteq: ">>=",
                rrshifteq: ">>>=",
                bandeq: "&=",
                boreq: "|=",
                bxoreq: "^="
            },
            g.mathfuns = ["abs", "acos", "asin", "atan", "ceil", "cos", "exp", "floor", "log", "round", "sin", "sqrt", "tan", "isNaN", "isFinite"],
            g.mathfuns2 = ["atan2", "pow", "max", "min"],
            g.ops1 = {
                neg: "-",
                not: "!",
                bnot: "~",
                clone: ""
            },
            g.mapreducers = {
                any: ["if(xi) return true;", "var accum = false;"],
                all: ["if(!xi) return false;", "var accum = true;"],
                sum: ["accum += xi;", "var accum = 0;"],
                prod: ["accum *= xi;", "var accum = 1;"],
                norm2Squared: ["accum += xi*xi;", "var accum = 0;"],
                norminf: ["accum = max(accum,abs(xi));", "var accum = 0, max = Math.max, abs = Math.abs;"],
                norm1: ["accum += abs(xi);", "var accum = 0, abs = Math.abs;"],
                sup: ["accum = max(accum,xi);", "var accum = -Infinity, max = Math.max;"],
                inf: ["accum = min(accum,xi);", "var accum = Infinity, min = Math.min;"]
            },
            function() {
                for (var n, e, t, r, i = 0; i < g.mathfuns2.length; ++i)
                    n = g.mathfuns2[i],
                        g.ops2[n] = n;
                for (i in g.ops2) {
                    g.ops2.hasOwnProperty(i) && (n = g.ops2[i],
                        t = "",
                        r = -1 !== g.myIndexOf.call(g.mathfuns2, i) ? (t = "var " + n + " = Math." + n + ";\n",
                                e = function(e, t, r) {
                                    return e + " = " + n + "(" + t + "," + r + ")"
                                }
                                ,
                                function(e, t) {
                                    return e + " = " + n + "(" + e + "," + t + ")"
                                }
                        ) : (e = function(e, t, r) {
                                return e + " = " + t + " " + n + " " + r
                            }
                                ,
                                g.opseq.hasOwnProperty(i + "eq") ? function(e, t) {
                                        return e + " " + n + "= " + t
                                    }
                                    : function(e, t) {
                                        return e + " = " + e + " " + n + " " + t
                                    }
                        ),
                        g[i + "VV"] = g.pointwise2(["x[i]", "y[i]"], e("ret[i]", "x[i]", "y[i]"), t),
                        g[i + "SV"] = g.pointwise2(["x", "y[i]"], e("ret[i]", "x", "y[i]"), t),
                        g[i + "VS"] = g.pointwise2(["x[i]", "y"], e("ret[i]", "x[i]", "y"), t),
                        g[i] = g.compile("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric." + i + "VV, VS = numeric." + i + "VS, SV = numeric." + i + 'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else ' + r("x", "y") + "\n}\nreturn x;\n"),
                        g[n] = g[i],
                        g[i + "eqV"] = g.pointwise2(["ret[i]", "x[i]"], r("ret[i]", "x[i]"), t),
                        g[i + "eqS"] = g.pointwise2(["ret[i]", "x"], r("ret[i]", "x"), t),
                        g[i + "eq"] = g.compile("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric." + i + "eqV, S = numeric." + i + 'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n'))
                }
                for (i = 0; i < g.mathfuns2.length; ++i)
                    n = g.mathfuns2[i],
                        delete g.ops2[n];
                for (i = 0; i < g.mathfuns.length; ++i)
                    n = g.mathfuns[i],
                        g.ops1[n] = n;
                for (i in g.ops1)
                    g.ops1.hasOwnProperty(i) && (t = "",
                        n = g.ops1[i],
                    -1 !== g.myIndexOf.call(g.mathfuns, i) && Math.hasOwnProperty(n) && (t = "var " + n + " = Math." + n + ";\n"),
                        g[i + "eqV"] = g.pointwise2(["ret[i]"], "ret[i] = " + n + "(ret[i]);", t),
                        g[i + "eq"] = g.compile("x", 'if(typeof x !== "object") return ' + n + "x\nvar i;\nvar V = numeric." + i + "eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),
                        g[i + "V"] = g.pointwise2(["x[i]"], "ret[i] = " + n + "(x[i]);", t),
                        g[i] = g.compile("x", 'if(typeof x !== "object") return ' + n + "(x)\nvar i;\nvar V = numeric." + i + "V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));
                for (i = 0; i < g.mathfuns.length; ++i)
                    n = g.mathfuns[i],
                        delete g.ops1[n];
                for (i in g.mapreducers)
                    g.mapreducers.hasOwnProperty(i) && (n = g.mapreducers[i],
                        g[i + "V"] = g.mapreduce2(n[0], n[1]),
                        g[i] = g.compile("x", "s", "k", n[1] + 'if(typeof x !== "object") {    xi = x;\n' + n[0] + '\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.' + i + "V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n" + n[0] + "\n}\nreturn accum;\n"))
            }(),
            g.inv = function(e) {
                for (var t, r, n, i, a, o = g.dim(e), s = Math.abs, u = o[0], c = o[1], l = g.clone(e), p = g.identity(u), f = 0; f < c; ++f) {
                    for (var h = -1, d = -1, m = f; m !== u; ++m)
                        d < (a = s(l[m][f])) && (h = m,
                            d = a);
                    for (r = l[h],
                             l[h] = l[f],
                             l[f] = r,
                             i = p[h],
                             p[h] = p[f],
                             p[f] = i,
                             e = r[f],
                             a = f; a !== c; ++a)
                        r[a] /= e;
                    for (a = c - 1; -1 !== a; --a)
                        i[a] /= e;
                    for (m = u - 1; -1 !== m; --m)
                        if (m !== f) {
                            for (t = l[m],
                                     n = p[m],
                                     e = t[f],
                                     a = f + 1; a !== c; ++a)
                                t[a] -= r[a] * e;
                            for (a = c - 1; 0 < a; --a)
                                n[a] -= i[a] * e,
                                    n[--a] -= i[a] * e;
                            0 === a && (n[0] -= i[0] * e)
                        }
                }
                return p
            }
            ,
            g.det = function(e) {
                var t = g.dim(e);
                if (2 !== t.length || t[0] !== t[1])
                    throw new Error("numeric: det() only works on square matrices");
                for (var r, n, i, a, o, s, u, c = t[0], l = 1, p = g.clone(e), f = 0; f < c - 1; f++) {
                    for (r = (n = f) + 1; r < c; r++)
                        Math.abs(p[r][f]) > Math.abs(p[n][f]) && (n = r);
                    for (n !== f && (s = p[n],
                        p[n] = p[f],
                        p[f] = s,
                        l *= -1),
                             i = p[f],
                             r = f + 1; r < c; r++) {
                        for (o = (a = p[r])[f] / i[f],
                                 n = f + 1; n < c - 1; n += 2)
                            u = n + 1,
                                a[n] -= i[n] * o,
                                a[u] -= i[u] * o;
                        n !== c && (a[n] -= i[n] * o)
                    }
                    if (0 === i[f])
                        return 0;
                    l *= i[f]
                }
                return l * p[f][f]
            }
            ,
            g.transpose = function(e) {
                for (var t, r, n, i, a = e.length, o = e[0].length, s = Array(o), u = 0; u < o; u++)
                    s[u] = Array(a);
                for (t = a - 1; 1 <= t; t -= 2) {
                    for (n = e[t],
                             r = e[t - 1],
                             u = o - 1; 1 <= u; --u)
                        (i = s[u])[t] = n[u],
                            i[t - 1] = r[u],
                            (i = s[--u])[t] = n[u],
                            i[t - 1] = r[u];
                    0 === u && ((i = s[0])[t] = n[0],
                        i[t - 1] = r[0])
                }
                if (0 === t) {
                    for (r = e[0],
                             u = o - 1; 1 <= u; --u)
                        s[u][0] = r[u],
                            s[--u][0] = r[u];
                    0 === u && (s[0][0] = r[0])
                }
                return s
            }
            ,
            g.negtranspose = function(e) {
                for (var t, r, n, i, a = e.length, o = e[0].length, s = Array(o), u = 0; u < o; u++)
                    s[u] = Array(a);
                for (t = a - 1; 1 <= t; t -= 2) {
                    for (n = e[t],
                             r = e[t - 1],
                             u = o - 1; 1 <= u; --u)
                        (i = s[u])[t] = -n[u],
                            i[t - 1] = -r[u],
                            (i = s[--u])[t] = -n[u],
                            i[t - 1] = -r[u];
                    0 === u && ((i = s[0])[t] = -n[0],
                        i[t - 1] = -r[0])
                }
                if (0 === t) {
                    for (r = e[0],
                             u = o - 1; 1 <= u; --u)
                        s[u][0] = -r[u],
                            s[--u][0] = -r[u];
                    0 === u && (s[0][0] = -r[0])
                }
                return s
            }
            ,
            g.norm2 = function(e) {
                return Math.sqrt(g.norm2Squared(e))
            }
            ,
            g.linspace = function(e, t, r) {
                if (void 0 === r && (r = Math.max(Math.round(t - e) + 1, 1)),
                r < 2)
                    return 1 === r ? [e] : [];
                for (var n = Array(r), i = --r; 0 <= i; i--)
                    n[i] = (i * t + (r - i) * e) / r;
                return n
            }
            ,
            g.getBlock = function(e, s, u) {
                var c = g.dim(e);
                return function e(t, r) {
                    var n, i = s[r], a = u[r] - i, o = Array(a);
                    if (r === c.length - 1) {
                        for (n = a; 0 <= n; n--)
                            o[n] = t[n + i];
                        return o
                    }
                    for (n = a; 0 <= n; n--)
                        o[n] = e(t[n + i], r + 1);
                    return o
                }(e, 0)
            }
            ,
            g.setBlock = function(e, s, u, t) {
                var c = g.dim(e);
                return function e(t, r, n) {
                    var i, a = s[n], o = u[n] - a;
                    if (n === c.length - 1)
                        for (i = o; 0 <= i; i--)
                            t[i + a] = r[i];
                    for (i = o; 0 <= i; i--)
                        e(t[i + a], r[i], n + 1)
                }(e, t, 0),
                    e
            }
            ,
            g.getRange = function(e, t, r) {
                for (var n, i, a, o = t.length, s = r.length, u = Array(o), c = o - 1; -1 !== c; --c)
                    for (u[c] = Array(s),
                             i = u[c],
                             a = e[t[c]],
                             n = s - 1; -1 !== n; --n)
                        i[n] = a[r[n]];
                return u
            }
            ,
            g.blockMatrix = function(e) {
                var t = g.dim(e);
                if (t.length < 4)
                    return g.blockMatrix([e]);
                for (var r, n, i = t[0], a = t[1], o = 0, s = 0, u = 0; u < i; ++u)
                    o += e[u][0].length;
                for (r = 0; r < a; ++r)
                    s += e[0][r][0].length;
                var c = Array(o);
                for (u = 0; u < o; ++u)
                    c[u] = Array(s);
                var l, p, f, h, d, m = 0;
                for (u = 0; u < i; ++u) {
                    for (l = s,
                             r = a - 1; -1 !== r; --r)
                        for (l -= (n = e[u][r])[0].length,
                                 f = n.length - 1; -1 !== f; --f)
                            for (d = n[f],
                                     p = c[m + f],
                                     h = d.length - 1; -1 !== h; --h)
                                p[l + h] = d[h];
                    m += e[u][0].length
                }
                return c
            }
            ,
            g.tensor = function(e, t) {
                if ("number" == typeof e || "number" == typeof t)
                    return g.mul(e, t);
                var r = g.dim(e)
                    , n = g.dim(t);
                if (1 !== r.length || 1 !== n.length)
                    throw new Error("numeric: tensor product is only defined for vectors");
                for (var i, a, o, s = r[0], u = n[0], c = Array(s), l = s - 1; 0 <= l; l--) {
                    for (i = Array(u),
                             o = e[l],
                             a = u - 1; 3 <= a; --a)
                        i[a] = o * t[a],
                            i[--a] = o * t[a],
                            i[--a] = o * t[a],
                            i[--a] = o * t[a];
                    for (; 0 <= a; )
                        i[a] = o * t[a],
                            --a;
                    c[l] = i
                }
                return c
            }
            ,
            g.epsilon = 2.220446049250313e-16,
            g.LU = function(e, t) {
                t = t || !1;
                var r, n, i, a, o, s, u, c, l, p = Math.abs, f = e.length, h = f - 1, d = new Array(f);
                for (t || (e = g.clone(e)),
                         i = 0; i < f; ++i) {
                    for (l = p((s = e[u = i])[i]),
                             n = i + 1; n < f; ++n)
                        l < (a = p(e[n][i])) && (l = a,
                            u = n);
                    for ((d[i] = u) != i && (e[i] = e[u],
                        e[u] = s,
                        s = e[i]),
                             o = s[i],
                             r = i + 1; r < f; ++r)
                        e[r][i] /= o;
                    for (r = i + 1; r < f; ++r) {
                        for (c = e[r],
                                 n = i + 1; n < h; ++n)
                            c[n] -= c[i] * s[n],
                                c[++n] -= c[i] * s[n];
                        n === h && (c[n] -= c[i] * s[n])
                    }
                }
                return {
                    LU: e,
                    P: d
                }
            }
            ,
            g.LUsolve = function(e, t) {
                for (var r, n, i, a, o = e.LU, s = o.length, u = g.clone(t), c = e.P, l = s - 1; -1 !== l; --l)
                    u[l] = t[l];
                for (l = 0; l < s; ++l)
                    for (n = c[l],
                         c[l] !== l && (a = u[l],
                             u[l] = u[n],
                             u[n] = a),
                             i = o[l],
                             r = 0; r < l; ++r)
                        u[l] -= u[r] * i[r];
                for (l = s - 1; 0 <= l; --l) {
                    for (i = o[l],
                             r = l + 1; r < s; ++r)
                        u[l] -= u[r] * i[r];
                    u[l] /= i[l]
                }
                return u
            }
            ,
            g.solve = function(e, t, r) {
                return g.LUsolve(g.LU(e, r), t)
            }
            ,
            g
    });
    _("core/math/qr", ["require", "exports"], function(e, t) {
        "use strict";
        function u(e, t, r) {
            for (var n = e.reflectors, i = e.r, a = e.p, o = t.slice(), s = 0; s < n.length; s++)
                !function(e, t) {
                    for (var r = e.length, n = t.length, i = 0, a = 0, o = n - r; o < n; o++)
                        i += e[o + r - n] * t[o],
                            a += e[o + r - n] * e[o + r - n];
                    for (var s = i / a, o = n - r; o < n; o++)
                        t[o] = 2 * s * e[o + r - n] - t[o]
                }(n[s], o);
            for (s = n.length; s < i[0].length; s++)
                o[s] = 0;
            o.length = i[0].length;
            for (var u = Math.pow(2, -52), c = r.regularize ? u * Math.abs(i[0][0]) * Math.max(i.length, i[0].length) : 0, s = n.length - 1; 0 <= s; s--) {
                var l = i[s];
                if (Math.abs(l[s]) <= c)
                    o[s] = 0;
                else {
                    for (var p = s + 1; p < n.length; p++)
                        o[s] -= o[p] * l[p];
                    o[s] /= l[s]
                }
            }
            for (var f, s = a.length - 1; 0 <= s; s--) {
                a[s] !== s && (f = o[s],
                    o[s] = o[a[s]],
                    o[a[s]] = f)
            }
            return o
        }
        function r(e) {
            var t = e.r
                , r = Math.min(t.length, t[0].length)
                , n = t[0][0]
                , i = t[r - 1][r - 1];
            return 0 === n ? 1 / 0 : Math.abs(n / i)
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.isNumericallyFullRank = t.conditionNumber = t.qrSolve = t.qr = void 0,
            t.qr = function(e, t) {
                if (!t || !t.mutateInput) {
                    var r = e;
                    e = Array(e.length);
                    for (var n = 0; n < r.length; n++)
                        e[n] = r[n].slice()
                }
                for (var i = Math.min(e.length, e[0].length), a = Array(i), o = [], s = 0; s < i; s++) {
                    for (var u = -1 / 0, c = s, l = s; l < e[s].length; l++) {
                        var p = function(e, t, r) {
                            for (var n = 0; t < e.length; t++)
                                n += e[t][r] * e[t][r];
                            return n
                        }(e, s, l);
                        u < p && (u = p,
                            c = l)
                    }
                    if ((a[s] = c) !== s)
                        for (n = 0; n < e.length; n++) {
                            var f = e[n][c];
                            e[n][c] = e[n][s],
                                e[n][s] = f
                        }
                    for (var h = function(e, t, r, n) {
                        var i = Array(e.length - t);
                        if (1 === i.length)
                            return i[0] = 1,
                                i;
                        if (0 === n) {
                            for (var a = i[0] = 1; a < i.length; a++)
                                i[a] = 0;
                            return i
                        }
                        var o = e[t][r] < 0 ? -1 : 1;
                        i[0] = e[t][r] + o * Math.sqrt(n);
                        for (var s = t + 1; s < e.length; s++)
                            i[s - t] = e[s][r];
                        return i
                    }(e, s, s, u), l = s; l < e[s].length; l++)
                        !function(e, t, r) {
                            for (var n = e.length, i = t.length, a = 0, o = 0, s = i - n; s < i; s++)
                                a += e[s + n - i] * t[s][r],
                                    o += e[s + n - i] * e[s + n - i];
                            for (var u = a / o, s = i - n; s < i; s++)
                                t[s][r] = 2 * u * e[s + n - i] - t[s][r]
                        }(h, e, l);
                    o.push(h)
                }
                return {
                    reflectors: o,
                    r: e,
                    p: a
                }
            }
            ,
            t.qrSolve = function(e, t, r) {
                return (Array.isArray(t[0]) ? function(e, t, r) {
                        for (var n = Array(e.r[0].length), i = 0; i < n.length; i++)
                            n[i] = Array(t[0].length);
                        for (var a = Array(t.length), o = 0; o < t[0].length; o++) {
                            for (i = 0; i < t.length; i++)
                                a[i] = t[i][o];
                            for (var s = u(e, a, r), i = 0; i < s.length; i++)
                                n[i][o] = s[i]
                        }
                        return n
                    }
                    : u)(e, t, r)
            }
            ,
            t.conditionNumber = r,
            t.isNumericallyFullRank = function(e) {
                var t = Math.pow(2, -52);
                return Math.max(e.r.length, e.r[0].length) * t * r(e) < 1
            }
    });
    _("core/math/least-squares", ["require", "exports", "numeric", "core/math/distance", "./qr"], function(e, t, O, l, T) {
        "use strict";
        function L(e, t) {
            for (var r = [], n = 0; n < t; n++)
                r.push(e);
            return r
        }
        function I(e, t) {
            for (var r = C(e, t), n = 0, i = 0, a = r; i < a.length; i++) {
                var o = a[i];
                n += o * o
            }
            return n / r.length
        }
        function C(e, t) {
            return e.apply(void 0, t)
        }
        function N(e, t) {
            for (var r = [], n = 0, i = e; n < i.length; n++) {
                var a = i[n].apply(void 0, t);
                r.push(a)
            }
            return r
        }
        function A(e, t) {
            for (var r = [], n = 0; n < e.length; n++)
                t[n] && r.push(e[n]);
            return r
        }
        function F(e, t, r) {
            for (var n = [], i = 0, a = 0; i < e.length; i++) {
                var o = 0;
                r[i] && (o = t[a],
                    a += 1),
                    n.push(e[i] + o)
            }
            return n
        }
        function p(e, t, r, n) {
            var i, a = n.maxIterations, o = n.linearSubset || L(!1, r.length), s = O.not(o), u = A(t, o), c = A(t, s), l = r, p = 0, f = .001;
            O.any(o) && (i = {
                Jv: E = O.transpose(N(u, l)),
                F: M = T.qr(E)
            },
                m = C(e, l),
                l = F(l, O.neg(T.qrSolve(M, m, {
                    regularize: !0
                })), o));
            for (var h = !1, d = I(e, l); p < a && !h && isFinite(d); ) {
                var m = C(e, l)
                    , g = N(c, l)
                    , y = O.transpose(g)
                    , v = void 0
                    , b = void 0;
                b = i ? (M = i.F,
                    E = i.Jv,
                    v = O.dot(g, O.sub(m, O.dot(E, T.qrSolve(M, m, {
                        regularize: !0
                    })))),
                    O.dot(g, O.sub(y, O.dot(E, T.qrSolve(M, y, {
                        regularize: !0
                    }))))) : (v = O.dot(g, m),
                    O.dot(g, y));
                for (var x = l, S = !1; p < a && !h && !S; ) {
                    p += 1;
                    var _ = O.add(b, O.diag(L(f, c.length)));
                    x = F(l, O.neg(O.solve(_, v, !0)), s),
                        h = O.all(O.eq(x, l));
                    var E, M, D, w = void 0;
                    i && (w = {
                        Jv: E = O.transpose(N(u, x)),
                        F: M = T.qr(E)
                    },
                        D = C(e, x),
                        x = F(x, O.neg(T.qrSolve(M, D, {
                            regularize: !0
                        })), o));
                    var P = I(e, x);
                    (S = P < d) ? (l = x,
                        d = P,
                        i = w,
                        f *= .1) : (f = Math.max(f, 1e-64),
                        f *= 2)
                }
            }
            return {
                solution: l,
                MSE: d
            }
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.testOnlyExports = t.optimizeNonLinear = t.optimizeLinear = t.tryRoundingSmallParametersToZero = t.evaluateMeanSquare = void 0,
            t.evaluateMeanSquare = I,
            t.tryRoundingSmallParametersToZero = function(e, t) {
                var r = t.solution.map(function(e) {
                    return Math.abs(e) < 1e-6 ? 0 : e
                })
                    , n = I(e, r);
                return isFinite(t.MSE) && !isFinite(t.MSE) || n < t.MSE || t.MSE !== t.MSE + Math.pow(.5, 8) * (n - t.MSE) ? t : {
                    solution: r,
                    MSE: n
                }
            }
            ,
            t.optimizeLinear = function(e, t) {
                for (var r = N(t, s = L(0, t.length)), n = T.qr(O.transpose(r), {
                    mutateInput: !0
                }), i = 0; i < 2; i++)
                     var a = C(e, s)
                         , o = O.neg(T.qrSolve(n, a, {
                         regularize: !1
                     }))
                         , s = O.add(s, o);
                var u = I(e, s);
                if (T.isNumericallyFullRank(n))
                    return {
                        solution: s,
                        MSE: u
                    };
                for (var c = L(0, t.length), i = 0; i < 2; i++)
                    a = C(e, c),
                        o = O.neg(T.qrSolve(n, a, {
                            regularize: !0
                        })),
                        c = O.add(c, o);
                var l = I(e, c);
                return .999 * l <= u ? {
                    solution: c,
                    MSE: l
                } : {
                    solution: s,
                    MSE: u
                }
            }
        ;
        function f(e) {
            for (var t = [], r = 0; r < a.length; r++) {
                for (var n = [], i = 0; i < e; i++)
                    n[i] = 0 === r && 1 !== e ? 0 : 1 === r && 1 !== e ? 1 : a[503 * (r * e + i) % a.length];
                t.push(n)
            }
            return t
        }
        function h(e, t, r, n, i) {
            for (var a = [], o = 0, s = r; o < s.length; o++) {
                var u = s[o];
                a.push({
                    soln: p(e, t, u, i),
                    initialGuess: u
                })
            }
            a.sort(function(e, t) {
                return isNaN(e.soln.MSE) ? 1 : isNaN(t.soln.MSE) ? -1 : e.soln.MSE - t.soln.MSE
            });
            for (var c = [], l = 0; l < n; l++)
                c.push(a[l].initialGuess);
            return c
        }
        var a = [18.9, .105, .0113, .089, 4.414, .373, .06, .149, 1.84, 9.26, 5, .7, .2, 1.13, 2.61, 1, .007, 30, 120, 1500, 4e-4, 7.23, -1, -.0081, -.03, -28.6, -1.71, -.4, -6.94, -.777, -500];
        var u = [3, 5, 7, 11, 13, 17, 19];
        function d(e, t) {
            for (var r = [], n = 0; n < e.length; n++) {
                for (var i = e[n], a = [], o = 0; o < i.length; o++) {
                    var s = u[o % u.length] * n % e.length;
                    a.push(function(e, t, r, n) {
                        if (!t)
                            return e;
                        if ("known" !== t.type)
                            return e;
                        var i = t.bounds;
                        return i[0] === -1 / 0 && i[1] === 1 / 0 ? e : i[0] === -1 / 0 ? i[1] - Math.exp(-e) : i[1] === 1 / 0 ? i[0] + Math.exp(e) : r / (n - 1) * i[1] + (n - 1 - r) / (n - 1) * i[0]
                    }(i[o], t[o], s, e.length))
                }
                r.push(a)
            }
            return r
        }
        t.optimizeNonLinear = function(e, t, r) {
            var n = (r = r || {}).linearSubset
                , i = r.bounds
                , a = r.preferredInitialGuess
                , o = f(t.length);
            i && (o = d(o, i));
            var s = h(e, t, o, 5, {
                maxIterations: 3,
                linearSubset: n
            })
                , u = p(e, t, h(e, t, s, 1, {
                maxIterations: 60,
                linearSubset: n
            })[0], {
                maxIterations: 250,
                linearSubset: n
            });
            if (!a)
                return u;
            var c = p(e, t, a, {
                maxIterations: 100,
                linearSubset: n
            });
            return isFinite(c.MSE) && (c.MSE < u.MSE || l.approx(c.MSE, u.MSE, 8)) ? c : u
        }
            ,
            t.testOnlyExports = {
                generateInitialGuesses: f,
                mapInitialGuesses: d
            }
    });
    _("core/math/builtinconstants", ["require", "core/math/parsenode/constant", "core/math/maybe-rational"], function(e) {
        "use strict";
        var t = e("core/math/parsenode/constant")
            , r = e("core/math/maybe-rational").maybeRational;
        return {
            pi: t(Math.PI),
            tau: t(2 * Math.PI),
            e: t(Math.E),
            trigAngleMultiplier: t(r(1, 1)),
            infty: t(1 / 0)
        }
    });
    _("core/math/builtinframe", ["require", "core/math/builtinconstants", "core/math/parsenode/builtinfunction"], function(e) {
        "use strict";
        var t, r = e("core/math/builtinconstants"), n = e("core/math/parsenode/builtinfunction"), i = {};
        for (t in r)
            r.hasOwnProperty(t) && (i[t] = r[t]);
        for (t in n)
            n.hasOwnProperty(t) && (i[t] = n[t]);
        return i
    });
    !function() {
        var t, r, i, a, o, s, u, c, l, p, f, h, d, m, g, y, v, b, x, S, e = {};
        !function(t) {
            var i = "object" == typeof e ? e : "object" == typeof self ? self : "object" == typeof this ? this : {};
            function r(r, n) {
                return r !== i && ("function" == typeof Object.create ? Object.defineProperty(r, "__esModule", {
                    value: !0
                }) : r.__esModule = !0),
                    function(e, t) {
                        return r[e] = n ? n(e, t) : t
                    }
            }
            "function" == typeof _ && _.amd ? _("tslib", ["exports"], function(e) {
                t(r(i, r(e)))
            }) : "object" == typeof module && "object" == typeof module.exports ? t(r(i, r(module.exports))) : t(r(i))
        }(function(e) {
            var n = Object.setPrototypeOf || {
                    __proto__: []
                }instanceof Array && function(e, t) {
                    e.__proto__ = t
                }
                || function(e, t) {
                    for (var r in t)
                        t.hasOwnProperty(r) && (e[r] = t[r])
                }
            ;
            t = function(e, t) {
                function r() {
                    this.constructor = e
                }
                n(e, t),
                    e.prototype = null === t ? Object.create(t) : (r.prototype = t.prototype,
                        new r)
            }
                ,
                r = Object.assign || function(e) {
                    for (var t, r = 1, n = arguments.length; r < n; r++)
                        for (var i in t = arguments[r])
                            Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]);
                    return e
                }
                ,
                i = function(e, t) {
                    var r = {};
                    for (var n in e)
                        Object.prototype.hasOwnProperty.call(e, n) && t.indexOf(n) < 0 && (r[n] = e[n]);
                    if (null != e && "function" == typeof Object.getOwnPropertySymbols)
                        for (var i = 0, n = Object.getOwnPropertySymbols(e); i < n.length; i++)
                            t.indexOf(n[i]) < 0 && Object.prototype.propertyIsEnumerable.call(e, n[i]) && (r[n[i]] = e[n[i]]);
                    return r
                }
                ,
                a = function(e, t, r, n) {
                    var i, a = arguments.length, o = a < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, r) : n;
                    if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
                        o = Reflect.decorate(e, t, r, n);
                    else
                        for (var s = e.length - 1; 0 <= s; s--)
                            (i = e[s]) && (o = (a < 3 ? i(o) : 3 < a ? i(t, r, o) : i(t, r)) || o);
                    return 3 < a && o && Object.defineProperty(t, r, o),
                        o
                }
                ,
                o = function(r, n) {
                    return function(e, t) {
                        n(e, t, r)
                    }
                }
                ,
                s = function(e, t) {
                    if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
                        return Reflect.metadata(e, t)
                }
                ,
                u = function(a, o, s, u) {
                    return new (s = s || Promise)(function(e, t) {
                            function r(e) {
                                try {
                                    i(u.next(e))
                                } catch (e) {
                                    t(e)
                                }
                            }
                            function n(e) {
                                try {
                                    i(u.throw(e))
                                } catch (e) {
                                    t(e)
                                }
                            }
                            function i(t) {
                                t.done ? e(t.value) : new s(function(e) {
                                        e(t.value)
                                    }
                                ).then(r, n)
                            }
                            i((u = u.apply(a, o || [])).next())
                        }
                    )
                }
                ,
                c = function(r, n) {
                    var i, a, o, s = {
                        label: 0,
                        sent: function() {
                            if (1 & o[0])
                                throw o[1];
                            return o[1]
                        },
                        trys: [],
                        ops: []
                    }, e = {
                        next: t(0),
                        throw: t(1),
                        return: t(2)
                    };
                    return "function" == typeof Symbol && (e[Symbol.iterator] = function() {
                            return this
                        }
                    ),
                        e;
                    function t(t) {
                        return function(e) {
                            return function(t) {
                                if (i)
                                    throw new TypeError("Generator is already executing.");
                                for (; s; )
                                    try {
                                        if (i = 1,
                                        a && (o = 2 & t[0] ? a.return : t[0] ? a.throw || ((o = a.return) && o.call(a),
                                            0) : a.next) && !(o = o.call(a, t[1])).done)
                                            return o;
                                        switch (a = 0,
                                        o && (t = [2 & t[0], o.value]),
                                            t[0]) {
                                            case 0:
                                            case 1:
                                                o = t;
                                                break;
                                            case 4:
                                                return s.label++,
                                                    {
                                                        value: t[1],
                                                        done: !1
                                                    };
                                            case 5:
                                                s.label++,
                                                    a = t[1],
                                                    t = [0];
                                                continue;
                                            case 7:
                                                t = s.ops.pop(),
                                                    s.trys.pop();
                                                continue;
                                            default:
                                                if (!(o = 0 < (o = s.trys).length && o[o.length - 1]) && (6 === t[0] || 2 === t[0])) {
                                                    s = 0;
                                                    continue
                                                }
                                                if (3 === t[0] && (!o || t[1] > o[0] && t[1] < o[3])) {
                                                    s.label = t[1];
                                                    break
                                                }
                                                if (6 === t[0] && s.label < o[1]) {
                                                    s.label = o[1],
                                                        o = t;
                                                    break
                                                }
                                                if (o && s.label < o[2]) {
                                                    s.label = o[2],
                                                        s.ops.push(t);
                                                    break
                                                }
                                                o[2] && s.ops.pop(),
                                                    s.trys.pop();
                                                continue
                                        }
                                        t = n.call(r, s)
                                    } catch (e) {
                                        t = [6, e],
                                            a = 0
                                    } finally {
                                        i = o = 0
                                    }
                                if (5 & t[0])
                                    throw t[1];
                                return {
                                    value: t[0] ? t[1] : void 0,
                                    done: !0
                                }
                            }([t, e])
                        }
                    }
                }
                ,
                l = function(e, t) {
                    for (var r in e)
                        t.hasOwnProperty(r) || (t[r] = e[r])
                }
                ,
                p = function(e) {
                    var t = "function" == typeof Symbol && e[Symbol.iterator]
                        , r = 0;
                    return t ? t.call(e) : {
                        next: function() {
                            return e && r >= e.length && (e = void 0),
                                {
                                    value: e && e[r++],
                                    done: !e
                                }
                        }
                    }
                }
                ,
                f = function(e, t) {
                    var r = "function" == typeof Symbol && e[Symbol.iterator];
                    if (!r)
                        return e;
                    var n, i, a = r.call(e), o = [];
                    try {
                        for (; (void 0 === t || 0 < t--) && !(n = a.next()).done; )
                            o.push(n.value)
                    } catch (e) {
                        i = {
                            error: e
                        }
                    } finally {
                        try {
                            n && !n.done && (r = a.return) && r.call(a)
                        } finally {
                            if (i)
                                throw i.error
                        }
                    }
                    return o
                }
                ,
                h = function() {
                    for (var e = [], t = 0; t < arguments.length; t++)
                        e = e.concat(f(arguments[t]));
                    return e
                }
                ,
                d = function() {
                    for (var e = 0, t = 0, r = arguments.length; t < r; t++)
                        e += arguments[t].length;
                    for (var n = Array(e), i = 0, t = 0; t < r; t++)
                        for (var a = arguments[t], o = 0, s = a.length; o < s; o++,
                            i++)
                            n[i] = a[o];
                    return n
                }
                ,
                m = function(e) {
                    return this instanceof m ? (this.v = e,
                        this) : new m(e)
                }
                ,
                g = function(e, t, r) {
                    if (!Symbol.asyncIterator)
                        throw new TypeError("Symbol.asyncIterator is not defined.");
                    var i = r.apply(e, t || [])
                        , a = []
                        , o = {};
                    return n("next"),
                        n("throw"),
                        n("return"),
                        o[Symbol.asyncIterator] = function() {
                            return this
                        }
                        ,
                        o;
                    function n(n) {
                        i[n] && (o[n] = function(r) {
                                return new Promise(function(e, t) {
                                        1 < a.push([n, r, e, t]) || s(n, r)
                                    }
                                )
                            }
                        )
                    }
                    function s(e, t) {
                        try {
                            (r = i[e](t)).value instanceof m ? Promise.resolve(r.value.v).then(u, c) : l(a[0][2], r)
                        } catch (e) {
                            l(a[0][3], e)
                        }
                        var r
                    }
                    function u(e) {
                        s("next", e)
                    }
                    function c(e) {
                        s("throw", e)
                    }
                    function l(e, t) {
                        e(t),
                            a.shift(),
                        a.length && s(a[0][0], a[0][1])
                    }
                }
                ,
                y = function(n) {
                    var i, e = {};
                    return t("next"),
                        t("throw", function(e) {
                            throw e
                        }),
                        t("return"),
                        e[Symbol.iterator] = function() {
                            return this
                        }
                        ,
                        e;
                    function t(t, r) {
                        e[t] = n[t] ? function(e) {
                                return (i = !i) ? {
                                    value: m(n[t](e)),
                                    done: "return" === t
                                } : r ? r(e) : e
                            }
                            : r
                    }
                }
                ,
                v = function(u) {
                    if (!Symbol.asyncIterator)
                        throw new TypeError("Symbol.asyncIterator is not defined.");
                    var e, t = u[Symbol.asyncIterator];
                    return t ? t.call(u) : (u = p(u),
                        e = {},
                        r("next"),
                        r("throw"),
                        r("return"),
                        e[Symbol.asyncIterator] = function() {
                            return this
                        }
                        ,
                        e);
                    function r(s) {
                        e[s] = u[s] && function(o) {
                            return new Promise(function(e, t) {
                                    var r, n, i, a;
                                    o = u[s](o),
                                        r = e,
                                        n = t,
                                        i = o.done,
                                        a = o.value,
                                        Promise.resolve(a).then(function(e) {
                                            r({
                                                value: e,
                                                done: i
                                            })
                                        }, n)
                                }
                            )
                        }
                    }
                }
                ,
                b = function(e, t) {
                    return Object.defineProperty ? Object.defineProperty(e, "raw", {
                        value: t
                    }) : e.raw = t,
                        e
                }
                ,
                x = function(e) {
                    if (e && e.__esModule)
                        return e;
                    var t = {};
                    if (null != e)
                        for (var r in e)
                            Object.hasOwnProperty.call(e, r) && (t[r] = e[r]);
                    return t.default = e,
                        t
                }
                ,
                S = function(e) {
                    return e && e.__esModule ? e : {
                        default: e
                    }
                }
                ,
                e("__extends", t),
                e("__assign", r),
                e("__rest", i),
                e("__decorate", a),
                e("__param", o),
                e("__metadata", s),
                e("__awaiter", u),
                e("__generator", c),
                e("__exportStar", l),
                e("__values", p),
                e("__read", f),
                e("__spread", h),
                e("__spreadArrays", d),
                e("__await", m),
                e("__asyncGenerator", g),
                e("__asyncDelegator", y),
                e("__asyncValues", v),
                e("__makeTemplateObject", b),
                e("__importStar", x),
                e("__importDefault", S)
        })
    }();
    _("core/math/reparameterization", ["require", "exports", "core/math/parsenode/constant", "core/math/builtinframe", "tslib", "core/math/distance", "core/math/policy"], function(e, t, P, y, O, T, v) {
        "use strict";
        function L(e, t, r) {
            var n = e.getPolynomialCoefficients(t).map(function(e) {
                return e.getConcreteTree(v.defaultPolicy, y)
            });
            return (r - n[0].asValue()) / n[1].asValue()
        }
        function I(e, t) {
            return e.map(function(e) {
                return t[e] ? +t[e].asValue() : NaN
            })
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.solveForOriginalParameters = t.mapInitialGuesses = void 0,
            t.mapInitialGuesses = function(e, t) {
                var r = {};
                for (var n in e)
                    e[n].isConstant && (r[n] = e[n]);
                var i, a, o, s, u, c = t.model;
                switch (c.type) {
                    case "trig":
                        for (var l = [(u = [c.amplitudeNode, c.frequencyNode, c.phaseNode].map(function(e) {
                            return +e.substitute(r).getConcreteTree(v.defaultPolicy, y).asValue()
                        }))[0] * Math.cos(u[2]), u[0] * Math.sin(u[2]), u[1]], p = 0; p < c.newParameterSymbols.length; p++)
                            r[c.newParameterSymbols[p]] = P(l[p]);
                        break;
                    case "exp":
                        if (c.intercept && (r[c.intercept.newParameterSymbols[0]] = P(Math.log(c.intercept.sign * c.intercept.node.substitute(r).getConcreteTree(v.defaultPolicy, y).asValue()))),
                        c.base && (r[c.base.newParameterSymbols[0]] = P(Math.log(+c.base.node.substitute(r).getConcreteTree(v.defaultPolicy, y).asValue()))),
                            c.shiftScale)
                            for (var f = c.shiftScale, h = f.mulNode, d = f.addNode, m = f.newParameterSymbols, g = f.stats, l = (i = [h, d].map(function(e) {
                                return +e.substitute(r).getConcreteTree(v.defaultPolicy, y).asValue()
                            }),
                                o = (a = g).range,
                                s = a.midrange,
                                [o * i[0], i[1] + s * i[0]]), p = 0; p < m.length; p++)
                                r[m[p]] = P(l[p]);
                        break;
                    default:
                        throw new Error("Unexpected model type " + c.type)
                }
                for (var n in r)
                    t.expression.dependsOn(n) || delete r[n];
                return r
            }
            ,
            t.solveForOriginalParameters = function(e, t, r) {
                e = O.__assign({}, e);
                var n, i, a, o, s, u, c, l, p, f = t.model;
                switch (f.type) {
                    case "trig":
                        for (var h = (p = I(f.newParameterSymbols, e),
                            [T.hypot(p[0], p[1]), p[2], Math.atan2(p[1], p[0])]), d = [f.amplitudeNode, f.frequencyNode, f.phaseNode], m = 0; m < d.length; m++) {
                            var g = d[m].substitute(e)
                                , y = h[m];
                            e[E = g.getDependencies()[0]] = P(L(g, E, y))
                        }
                        break;
                    case "exp":
                        if (f.shiftScale)
                            for (var v = f.shiftScale, b = v.mulNode, x = v.addNode, S = v.stats, _ = v.newParameterSymbols, h = (s = I(_, e),
                                c = (u = S).range,
                                l = u.midrange,
                                [s[0] / c, s[1] - l * s[0] / c]), d = [b, x], m = 0; m < d.length; m++) {
                                g = d[m].substitute(e),
                                    y = h[m];
                                e[E = g.getDependencies()[0]] = P(L(g, E, y))
                            }
                        f.intercept && (n = f.intercept.node.getDependencies()[0],
                            i = L(f.intercept.node, n, f.intercept.sign * Math.exp(+e[f.intercept.newParameterSymbols[0]].asValue())),
                            e[n] = P(i)),
                        f.base && (a = f.base.node.getDependencies()[0],
                            o = L(f.base.node, a, Math.exp(+e[f.base.newParameterSymbols[0]].asValue())),
                            e[a] = P(o));
                        break;
                    default:
                        throw new Error("Unimplemented model " + f.type)
                }
                for (var E, M = {}, D = 0, w = r; D < w.length; D++) {
                    M[E = w[D]] = e[E]
                }
                return M
            }
    });
    _("core/math/parsenode/regression", ["require", "pjs", "./base", "core/math/distance", "core/math/builtin", "core/lib/label", "core/math/errormsg", "./error", "./optimizedregression", "./list", "./functioncall", "./identifier", "./constant", "./freevariable", "./expressionTypes", "core/math/types", "core/math/least-squares", "core/math/reparameterization"], function(e) {
        "use strict";
        var t = e("pjs")
            , r = e("./base")
            , m = e("core/math/distance")
            , g = e("core/math/builtin")
            , E = e("core/lib/label")
            , M = e("core/math/errormsg")
            , n = e("./error")
            , D = e("./optimizedregression")
            , w = e("./list")
            , i = e("./functioncall")
            , a = e("./identifier")
            , P = e("./constant")
            , p = e("./freevariable")
            , o = e("./expressionTypes")
            , O = e("core/math/types")
            , h = e("core/math/least-squares")
            , s = e("core/math/reparameterization")
            , T = s.solveForOriginalParameters
            , L = s.mapInitialGuesses
            , I = h.optimizeLinear
            , d = h.optimizeNonLinear
            , C = h.evaluateMeanSquare
            , u = o.Subtract;
        return t(r, function(e, r, t) {
            function y(e, t, r, n) {
                var i = t.getDependencies();
                for (p = 0; p < i.length; p++)
                    if (!e.validRegressionParameter(i[p]))
                        throw M.invalidRegressionParameter(i[p]);
                var a = t.getCompiledFunction(i).fn;
                if (i.length) {
                    for (var o, s, u = t.findLinearSubset(i), c = u.every(function(e) {
                        return e
                    }), l = [], p = 0; p < i.length; p++)
                        l.push(t.takeDerivative(i[p]).getCompiledFunction(i).fn);
                    c ? (s = h.tryRoundingSmallParametersToZero(a, I(a, l))).isLinear = !0 : (o = {
                        linearSubset: u,
                        bounds: function(e, t) {
                            for (var r = [], n = 0; n < e.length; n++)
                                r.push(t.boundDomain(e[n]));
                            return r
                        }(i, t),
                        preferredInitialGuess: function(e, t, r) {
                            var n = [];
                            t = t || {},
                                r = r || {};
                            for (var i = 0; i < e.length; i++) {
                                var a = e[i]
                                    , o = E.identifierToLatex(a);
                                r[a] && isFinite(r[a].asValue()) ? n.push(+r[a].asValue()) : t.hasOwnProperty(o) && isFinite(t[o]) ? n.push(+t[o].asValue()) : n.push(1)
                            }
                            return n
                        }(i, r, n)
                    },
                        (s = h.tryRoundingSmallParametersToZero(a, d(a, l, o))).isLinear = !1)
                } else
                    s = {
                        solution: [],
                        MSE: C(a, []),
                        isLinear: !0
                    };
                return s
            }
            function v(e, t) {
                for (var r = {}, n = t.getDependencies(), i = 0; i < n.length; i++)
                    r[n[i]] = P(e.solution[i]);
                return r
            }
            function f(e, t) {
                var r = e.length
                    , n = e[0]
                    , i = t[0]
                    , a = e[r - 1]
                    , o = t[r - 1];
                if (isFinite(n) && isFinite(a) && isFinite(i) && isFinite(o) && o - i != 0) {
                    var s = a - n;
                    if (0 != s) {
                        for (var u = 1; u < r - 1; u++) {
                            var c = e[u]
                                , l = t[u]
                                , p = (o * (c - n) + i * (a - c)) / s;
                            if (!m.approx(l, p, 5))
                                return
                        }
                        return 1
                    }
                }
            }
            e.init = function(e, t) {
                r.init.call(this),
                    this._lhs = e,
                    this.isLhsSimple = e instanceof a,
                    this._logLhs = i("ln", [e]),
                    this._rhs = t,
                    this._difference = u([e, t]),
                    this._logDifference = u([i("ln", [e]), i("ln", [t])]),
                    this.mergeDependencies(e, t)
            }
                ,
                e.isRegression = !0,
                e.chooseResidualVariable = function(e) {
                    if (this.userData && this.userData.residualVariable) {
                        var t = E.latexToIdentifier(this.userData.residualVariable);
                        if (!e[t])
                            return t
                    }
                    for (var r, n = this.getDependencies(), i = 0; i < n.length; i++) {
                        var a = n[i].match(/_(.*)/);
                        if (a && !e[r = "e_" + a[1]])
                            return r
                    }
                    for (var o = 1; ; ) {
                        if (!e[r = "e_" + o])
                            return r;
                        o++
                    }
                }
                ,
                e.getRHSModel = function(e, t, r) {
                    for (var n, i, a = this._rhs.getDependencies(), o = 0; o < a.length; o++) {
                        var s = a[o];
                        if (t[s] && t[s].tryGetConcreteTree) {
                            var u = t[s].tryGetConcreteTree(e, t);
                            if (!u.isError && u.valueType === O.ListOfNumber) {
                                if (void 0 !== n) {
                                    n = void 0;
                                    break
                                }
                                0 === u.getDependencies().length && (n = s,
                                    i = u)
                            }
                        }
                    }
                    var c = Object.create(t);
                    void 0 !== n && (c[n] = p(this.tmpVar()));
                    var l = this._rhs.tryGetConcreteTree(e, c);
                    return {
                        node: l,
                        substituted: l.isError ? l : l.substitute(r),
                        listNode: i,
                        isValid: void 0 !== n
                    }
                }
                ,
                e.computeStatistics = function(e, t, r, n, i, a) {
                    if (n.getDependencies().length)
                        throw M.optimizationError();
                    var o = b(e, n);
                    if (!isFinite(o))
                        throw M.optimizationError();
                    if (0 < t.getDependencies().length)
                        return {
                            RMSE: Math.sqrt(o)
                        };
                    var s = O.isList(t.valueType) ? g.varp(t.asValue()) : 0;
                    if (t.getDependencies().length || !isFinite(s) || s <= 0 || !this.isLhsSimple)
                        return {
                            RMSE: Math.sqrt(o)
                        };
                    var u, c, l = 1 - o / s;
                    if (r.isValid) {
                        var p = []
                            , f = []
                            , h = i && (a === x.LINLOG || a === x.LOGLOG);
                        w.eachArgs(e, [r.listNode, t], function(e) {
                            p.push(h ? Math.log(e[0].asValue()) : +e[0].asValue()),
                                f.push(+e[1].asValue())
                        });
                        var d = g.corr(p, f);
                        if (m.approx((u = p,
                            c = f,
                            I(function(e, t) {
                                for (var r = [], n = 0; n < u.length; n++)
                                    r.push(c[n] - (e * u[n] + t));
                                return r
                            }, [function() {
                                return u.map(function(e) {
                                    return -e
                                })
                            }
                                , function() {
                                    return u.map(function() {
                                        return -1
                                    })
                                }
                            ], [0, 0])).MSE, o, 8))
                            return {
                                r: d,
                                rsquared: d * d
                            }
                    }
                    return {
                        Rsquared: l
                    }
                }
                ,
                e.getResidualSuggestionId = function(e, t) {
                    var r, n = this._rhs.getDependencies();
                    for (var i in t)
                        if (t.hasOwnProperty(i) && t[i].concreteTree.isTable && t[i].concreteTree.columns[0]) {
                            var a = t[i].rawTree.columns;
                            if (a && a.length) {
                                var o = a[0].getExports();
                                if (1 === o.length && -1 !== n.indexOf(o[0])) {
                                    for (var s = 1; s < a.length; s++)
                                        if (-1 !== a[s].getDependencies().indexOf(e))
                                            return;
                                    r = r || i
                                }
                            }
                        }
                    return r || void 0
                }
            ;
            var x = {
                NONE: 0,
                LOGLIN: 1,
                LOGLOG: 2,
                LINLOG: 3
            };
            function S(e, t, r, n) {
                var i = Object.create(r);
                for (var a in n)
                    n.hasOwnProperty(a) && (i[a] = n[a]);
                return w.wrap(t.getConcreteTree(e, i))
            }
            function b(e, t) {
                var r = 0;
                return t.eachElement(e, function(e) {
                    var t = e.asValue();
                    r += t * t
                }),
                r / t.length
            }
            function _(e, t, r, n, i) {
                var a = r.reparameterizeRegression();
                if (!a || 0 === a.length)
                    return {
                        parameters: v(p = y(e, r = r.deriveRegressionRestrictions(), n, i), r),
                        isLinear: p.isLinear,
                        parameterWarning: !1
                    };
                for (var o = r.getDependencies(), s = 1 / 0, u = {}, c = !1, l = 0; l < a.length; l++) {
                    var p, f = a[l], h = f.expression;
                    if ((p = y(e, h = h.deriveRegressionRestrictions(), L(n, f), L(i, f))).MSE < s) {
                        var d = v(p, h)
                            , m = T(d, f, o)
                            , g = b(e, S(e, r.substitute(m), t, m));
                        if (u && (!isFinite(g) || s <= g)) {
                            isFinite(g) || (c = !0);
                            continue
                        }
                        s = p.MSE,
                            u = m
                    }
                }
                return {
                    parameters: u,
                    isLinear: !1,
                    parameterWarning: c
                }
            }
            e.linearizingTransformation = function(e, t, r) {
                if (!this.isLhsSimple)
                    return x.NONE;
                if (!r.isValid)
                    return x.NONE;
                var n = r.substituted;
                if (n.isError)
                    return x.NONE;
                if (n.valueType !== O.Number)
                    return x.NONE;
                var i = n.getDependencies();
                if (1 !== i.length)
                    return x.NONE;
                if (isFinite(r.node.polynomialOrder(i[0])))
                    return x.NONE;
                var a = n.getCompiledFunction(i).fn
                    , o = r.listNode;
                if (n.valueType !== O.Number)
                    return x.NONE;
                var s = o.mapElements(e, function(e) {
                    return +e.asValue()
                });
                if (s.length < 3)
                    return x.NONE;
                s.sort(function(e, t) {
                    return e - t
                });
                var u = s.map(a)
                    , c = u.map(Math.log)
                    , l = s.map(Math.log)
                    , p = !0;
                return w.wrap(t).eachElement(e, function(e) {
                    isFinite(Math.log(+e.asValue())) || (p = !1)
                }),
                    f(s, c) && p ? x.LOGLIN : f(l, c) && p ? x.LOGLOG : f(l, u) ? x.LINLOG : x.NONE
            }
                ,
                e.optimize = function(e, t, r, n, i) {
                    var a = this._lhs.getConcreteTree(e, t)
                        , o = this._rhs.getConcreteTree(e, t);
                    this.typeCheck(e, [a, o]);
                    var s, u, c, l, p = function(e) {
                        var t = {};
                        for (var r in e)
                            t[r] = P(e[r]);
                        return t
                    }(this.userData.regressionParameters), f = _(e, t, w.wrap(this._difference.getConcreteTree(e, t)), p, n), h = f.parameters, d = f.isLinear, m = this.getRHSModel(e, t, h), g = S(e, this._difference, t, h), y = this.linearizingTransformation(e, a, m);
                    l = !this.userData.isLogModeRegression || y !== x.LOGLIN && y !== x.LOGLOG ? this.computeStatistics(e, a, m, g, this.userData.isLogModeRegression, y) : (s = this._logDifference.getConcreteTree(e, t),
                        u = this._logLhs.getConcreteTree(e, t),
                        h = (f = _(e, t, s, p, n)).parameters,
                        d = f.isLinear,
                        m = this.getRHSModel(e, t, h),
                        g = S(e, this._difference, t, h),
                        c = S(e, this._logDifference, t, h),
                        this.computeStatistics(e, u, m, c, this.userData.isLogModeRegression, y));
                    var v = this.chooseResidualVariable(r)
                        , b = this.getResidualSuggestionId(v, i);
                    return this.userData.residualVariable = E.identifierToLatex(v),
                        D(h, g, l, m.substituted, {
                            isModelValid: m.isValid,
                            residualVariable: v,
                            residualSuggestionId: b,
                            shouldSuggestLogMode: y !== x.NONE,
                            isLinear: d,
                            parameterWarning: f.parameterWarning
                        })
                }
                ,
                e.tryOptimize = function() {
                    try {
                        return this.optimize.apply(this, arguments)
                    } catch (e) {
                        return e instanceof n ? e : M.parseError()
                    }
                }
                ,
                e.exportTo = function(e, t, r) {
                    if (!t.isError) {
                        for (var n in t.parameters)
                            t.parameters.hasOwnProperty(n) && (e.assignmentForbidden(n) || (r[n] = r[n] ? M.multiplyDefined(n) : t.parameters[n]));
                        e.assignmentForbidden(t.residualVariable) || (r[t.residualVariable] = t.residuals)
                    }
                }
                ,
                e.getSliderVariables = function() {
                    return []
                }
        })
    });
    _("core/math/parsenode/image", ["require", "pjs", "./base"], function(e) {
        "use strict";
        return e("pjs")(e("./base"), function(e, r, t, n) {
            e.isImage = !0,
                e.init = function(e, t) {
                    r.init.call(this),
                        this.center = e.center,
                        this.radianAngle = e.radianAngle,
                        this.width = e.width,
                        this.height = e.height,
                        this.opacity = e.opacity,
                        this.moveStrategy = t,
                        this.mergeDependencies(this.center, this.radianAngle, this.width, this.height, this.opacity)
                }
        })
    });
    _("core/math/parsenode/simulation", ["require", "pjs", "./base"], function(e) {
        "use strict";
        return e("pjs")(e("./base"), function(e, t, r, n) {
            e.isSimulation = !0,
                e.init = function(e) {
                    t.init.call(this),
                        this.fps = e,
                        this.mergeDependencies(this.fps)
                }
        })
    });
    _("core/math/parsenode/slider", ["require", "pjs", "./assignment", "./identifier"], function(e) {
        "use strict";
        var t = e("pjs")
            , i = e("./assignment")
            , a = e("./identifier");
        return t(i, function(e, r, t, n) {
            e.isSlider = !0,
                e.init = function(e, t) {
                    r.init.call(this, a(e._symbol), e._expression),
                        this.setInputSpan(e._inputSpan),
                        this.sliderAssignment = e,
                        this.sliderMin = t.sliderMin,
                        this.sliderMax = t.sliderMax,
                        this.sliderSoftMin = t.sliderSoftMin,
                        this.sliderSoftMax = t.sliderSoftMax,
                        this.sliderStep = t.sliderStep,
                        this.sliderIsPlayingOnce = t.sliderIsPlayingOnce,
                    this.sliderMin && this.mergeDependencies(this.sliderMin),
                    this.sliderMax && this.mergeDependencies(this.sliderMax),
                    this.sliderStep && this.mergeDependencies(this.sliderStep)
                }
                ,
                e.shouldPromoteToSlider = function(e) {
                    return !1
                }
                ,
                e.asAssignment = function() {
                    return i(this._symbol, this._expression)
                }
        })
    });
    _("core/math/parsenode/table", ["require", "pjs", "./base"], function(e) {
        "use strict";
        return e("pjs")(e("./base"), function(e, r) {
            e.init = function(e) {
                r.init.call(this),
                    this.columns = e,
                    this._exports = [],
                    this.mergeDependencies.apply(this, e);
                for (var t = 0; t < e.length; t++)
                    Array.prototype.push.apply(this._exports, e[t].getExports())
            }
                ,
                e.exportPenalty = 1,
                e.isTable = !0,
                e.exportTo = function(e, t, r) {
                    for (var n = 0; n < this.columns.length; n++) {
                        var i, a = this.columns[n].getExports();
                        a.length && (i = a[0],
                        e.assignmentForbidden(i) || r[i] || (t.isError ? r[i] = t : this.columns[n].exportTo(e, t.columns[n], r)))
                    }
                }
                ,
                e.getAllIds = function() {
                    return this.columns.map(function(e) {
                        return e.header.userData.id
                    })
                }
        })
    });
    _("core/math/parsenode/tablecolumn", ["require", "pjs", "./base", "./list", "./constant", "./identifier"], function(e) {
        "use strict";
        var t = e("pjs")
            , a = e("./base")
            , o = e("./list")
            , r = e("./constant")
            , s = e("./identifier");
        return t(a, function(e, n) {
            function i(e) {
                return e.isError ? r(NaN) : e
            }
            e.init = function(e, t, r) {
                n.init.call(this),
                    this.header = e,
                    this.length = t,
                    this.values = r,
                    this.isIndependent = !1,
                    this.registerDependencies(),
                    this._exports = this.computeExports()
            }
                ,
                e.registerDependencies = function() {
                    this.mergeDependencies(this.header),
                        this.mergeDependencies.apply(this, this.values)
                }
                ,
                e.computeExports = function() {
                    return this.header instanceof s ? [this.header._symbol] : []
                }
                ,
                e.isDiscrete = function(e) {
                    return 1 !== this.header.getDependencies().length || 1 !== e.header.getDependencies().length || this.header.getDependencies()[0] !== e.header.getDependencies()[0]
                }
                ,
                e._exportSymbolsTo = function(e, t, r) {
                    if (e.length) {
                        var n = e[0];
                        if (t.isError)
                            r[n] = t;
                        else
                            try {
                                r[n] = o(t.values.map(i))
                            } catch (e) {
                                if (!(e instanceof a))
                                    throw e;
                                r[n] = e
                            }
                    }
                }
                ,
                e.exportTo = function(e, t, r) {
                    var n = this.getLegalExports(e);
                    this._exportSymbolsTo(n, t, r)
                }
                ,
                e.exportToLocal = function(e, t) {
                    this._exportSymbolsTo(this.getExports(), e, t)
                }
        })
    });
    _("core/math/parsenode/solvedequation", ["require", "pjs", "./base"], function(e) {
        "use strict";
        return e("pjs")(e("./base"), function(e, r) {
            e.init = function(e, t) {
                r.init.call(this),
                    this._symbol = e,
                    this._expression = t,
                    this.mergeDependencies(t)
            }
                ,
                e.getCompiledFunction = function() {
                    return this._expression.getCompiledFunction.apply(this._expression, arguments)
                }
                ,
                e.getCompiledDerivative = function() {
                    return this._expression.getCompiledDerivative.apply(this._expression, arguments)
                }
                ,
                e.evaluate = function() {
                    return this._expression.evaluate.apply(this._expression, arguments)
                }
        })
    });
    _("core/math/parsenode/seed", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, t) {
            e.init = function(e) {
                "string" != typeof e && (e = "" + e),
                    this._stringValue = e,
                    t.init.call(this, [])
            }
                ,
                e.isString = !0,
                e.getEvalStrings = function() {
                    return {
                        statements: [],
                        expression: "'" + this.asValue() + "'"
                    }
                }
                ,
                e.asValue = function() {
                    return this._stringValue
                }
        })
    });
    _("core/math/parsenode/extendseed", ["require", "pjs", "./expression"], function(e) {
        "use strict";
        return e("pjs")(e("./expression"), function(e, r) {
            e.init = function(e, t) {
                r.init.call(this, t),
                    this.seed = t[0],
                    this.userSeed = t[1],
                    this.tag = e
            }
                ,
                e.getEvalStrings = function() {
                    var e = this.seed.getEvalStrings()
                        , t = this.userSeed.getEvalStrings()
                        , r = [];
                    return Array.prototype.push.apply(r, e.statements),
                        Array.prototype.push.apply(r, t.statements),
                        {
                            statements: r,
                            expression: "(" + e.expression + ") + '::" + this.tag + "' + (" + t.expression + ")"
                        }
                }
                ,
                e.asValue = function() {
                    return this.seed.asValue() + "::" + this.tag + this.userSeed.asValue()
                }
                ,
                e.copyWithArgs = function(e) {
                    return new this.constructor(this.tag,e)
                }
        })
    });
    _("core/math/parsenode/rgbcolor", ["require", "pjs", "./scalarexpression"], function(e) {
        "use strict";
        return e("pjs")(e("./scalarexpression"), function(e, t, r) {
            e.asArray = function() {
                return [+this.args[0].asValue(), +this.args[1].asValue(), +this.args[2].asValue()]
            }
                ,
                e.asValue = e.asArray,
                e.getEvalStrings = function() {
                    for (var e = [], t = [], r = 0; r < this.args.length; r++) {
                        var n = this.args[r].getEvalStrings()
                            , e = e.concat(n.statements);
                        t.push(n.expression)
                    }
                    return {
                        statements: e,
                        expression: "[" + t.join(",") + "]"
                    }
                }
        })
    });
    _("parsenodes", ["require", "core/math/parsenode/expressionTypes", "core/math/parsenode/base", "core/math/parsenode/expression", "core/math/parsenode/scalarexpression", "core/math/parsenode/error", "core/math/parsenode/constant", "core/math/parsenode/mixednumber", "core/math/parsenode/identifier", "core/math/parsenode/ans", "core/math/parsenode/freevariable", "core/math/parsenode/dummyindex", "core/math/parsenode/list", "core/math/parsenode/range", "core/math/parsenode/broadcast", "core/math/parsenode/listaccess", "core/math/parsenode/dotaccess", "core/math/parsenode/dotaccessexponent", "core/math/parsenode/orderedpair", "core/math/parsenode/movablepoint", "core/math/parsenode/orderedpairaccess", "core/math/parsenode/polygon", "core/math/parsenode/basecomparator", "core/math/parsenode/comparator", "core/math/parsenode/doubleinequality", "core/math/parsenode/repeatedoperator", "core/math/parsenode/sum", "core/math/parsenode/product", "core/math/parsenode/integral", "core/math/parsenode/functioncall", "core/math/parsenode/seededfunctioncall", "core/math/parsenode/functionexponent", "core/math/parsenode/functionfactorial", "core/math/parsenode/prime", "core/math/parsenode/piecewise", "core/math/parsenode/derivative", "core/math/parsenode/builtinfunction", "core/math/parsenode/nativefunction", "core/math/parsenode/typedfunction", "core/math/parsenode/reducerfunction", "core/math/parsenode/parametrizedreducerfunction", "core/math/parsenode/doublereducerfunction", "core/math/parsenode/toplevelfunction", "core/math/parsenode/distribution", "core/math/parsenode/histogram", "core/math/parsenode/object3d", "core/math/parsenode/dotplot", "core/math/parsenode/boxplot", "core/math/parsenode/ttest", "core/math/parsenode/independent-ttest", "core/math/parsenode/stats", "core/math/parsenode/assignment", "core/math/parsenode/functiondefinition", "core/math/parsenode/equation", "core/math/parsenode/regression", "core/math/parsenode/image", "core/math/parsenode/simulation", "core/math/parsenode/slider", "core/math/parsenode/table", "core/math/parsenode/tablecolumn", "core/math/parsenode/solvedequation", "core/math/parsenode/optimizedregression", "core/math/parsenode/seed", "core/math/parsenode/extendseed", "core/math/parsenode/rgbcolor"], function(e) {
        "use strict";
        var t = e("core/math/parsenode/expressionTypes")
            , r = {
            Base: e("core/math/parsenode/base"),
            Expression: e("core/math/parsenode/expression"),
            ScalarExpression: e("core/math/parsenode/scalarexpression"),
            Error: e("core/math/parsenode/error"),
            Constant: e("core/math/parsenode/constant"),
            MixedNumber: e("core/math/parsenode/mixednumber"),
            Identifier: e("core/math/parsenode/identifier"),
            Ans: e("core/math/parsenode/ans"),
            FreeVariable: e("core/math/parsenode/freevariable"),
            DummyIndex: e("core/math/parsenode/dummyindex"),
            List: e("core/math/parsenode/list"),
            Range: e("core/math/parsenode/range"),
            Broadcast: e("core/math/parsenode/broadcast"),
            ListAccess: e("core/math/parsenode/listaccess"),
            DotAccess: e("core/math/parsenode/dotaccess"),
            DotAccessExponent: e("core/math/parsenode/dotaccessexponent"),
            OrderedPair: e("core/math/parsenode/orderedpair"),
            MovablePoint: e("core/math/parsenode/movablepoint"),
            OrderedPairAccess: e("core/math/parsenode/orderedpairaccess"),
            Polygon: e("core/math/parsenode/polygon"),
            BaseComparator: e("core/math/parsenode/basecomparator"),
            Comparator: e("core/math/parsenode/comparator"),
            DoubleInequality: e("core/math/parsenode/doubleinequality"),
            RepeatedOperator: e("core/math/parsenode/repeatedoperator"),
            Sum: e("core/math/parsenode/sum"),
            Product: e("core/math/parsenode/product"),
            Integral: e("core/math/parsenode/integral"),
            FunctionCall: e("core/math/parsenode/functioncall"),
            SeededFunctionCall: e("core/math/parsenode/seededfunctioncall"),
            FunctionExponent: e("core/math/parsenode/functionexponent"),
            FunctionFactorial: e("core/math/parsenode/functionfactorial"),
            Prime: e("core/math/parsenode/prime"),
            Piecewise: e("core/math/parsenode/piecewise"),
            Derivative: e("core/math/parsenode/derivative"),
            BuiltInFunction: e("core/math/parsenode/builtinfunction"),
            NativeFunction: e("core/math/parsenode/nativefunction"),
            TypedFunction: e("core/math/parsenode/typedfunction"),
            ReducerFunction: e("core/math/parsenode/reducerfunction"),
            ParametrizedReducerFunction: e("core/math/parsenode/parametrizedreducerfunction"),
            DoubleReducerFunction: e("core/math/parsenode/doublereducerfunction"),
            TopLevelFunction: e("core/math/parsenode/toplevelfunction"),
            Distribution: e("core/math/parsenode/distribution"),
            Histogram: e("core/math/parsenode/histogram"),
            Object3D: e("core/math/parsenode/object3d"),
            DotPlot: e("core/math/parsenode/dotplot"),
            BoxPlot: e("core/math/parsenode/boxplot"),
            TTest: e("core/math/parsenode/ttest"),
            IndependentTTest: e("core/math/parsenode/independent-ttest"),
            Stats: e("core/math/parsenode/stats"),
            Assignment: e("core/math/parsenode/assignment"),
            FunctionDefinition: e("core/math/parsenode/functiondefinition"),
            Equation: e("core/math/parsenode/equation"),
            Regression: e("core/math/parsenode/regression"),
            Image: e("core/math/parsenode/image"),
            Simulation: e("core/math/parsenode/simulation"),
            Slider: e("core/math/parsenode/slider"),
            Table: e("core/math/parsenode/table"),
            TableColumn: e("core/math/parsenode/tablecolumn"),
            SolvedEquation: e("core/math/parsenode/solvedequation"),
            OptimizedRegression: e("core/math/parsenode/optimizedregression"),
            Seed: e("core/math/parsenode/seed"),
            ExtendSeed: e("core/math/parsenode/extendseed"),
            RGBColor: e("core/math/parsenode/rgbcolor")
        };
        for (var n in t)
            r[n] = t[n];
        for (var i in r)
            r.hasOwnProperty(i) && "Comparator" !== i && "BuiltInFunction" !== i && (r[i].prototype.type = i);
        for (var a in r.Comparator)
            r.Comparator.hasOwnProperty(a) && (r.Comparator[a].prototype.type = "Comparator['" + a + "']");
        for (var o in r.BuiltInFunction)
            r.BuiltInFunction.hasOwnProperty(o) && (r.BuiltInFunction[o].prototype.type = "BuiltInFunction['" + o + "']");
        return r
    });
    _("core/math/parser/char-codes", ["require", "exports"], function(e, t) {
        "use strict";
        function r(e) {
            return 97 <= e && e <= 122
        }
        function n(e) {
            return 65 <= e && e <= 90
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.isWhitespace = t.isSingleQuote = t.isDot = t.isBackslash = t.isLetter = t.isUpperCaseLetter = t.isLowerCaseLetter = t.isDigit = void 0,
            t.isDigit = function(e) {
                return 48 <= e && e <= 57
            }
            ,
            t.isLowerCaseLetter = r,
            t.isUpperCaseLetter = n,
            t.isLetter = function(e) {
                return r(e) || n(e)
            }
            ,
            t.isBackslash = function(e) {
                return 92 === e
            }
            ,
            t.isDot = function(e) {
                return 46 === e
            }
            ,
            t.isSingleQuote = function(e) {
                return 39 === e
            }
            ,
            t.isWhitespace = function(e) {
                if (9 <= e && e <= 13)
                    return !0;
                if (8192 <= e && e <= 8202)
                    return !0;
                switch (e) {
                    case 32:
                    case 160:
                    case 5760:
                    case 8232:
                    case 8233:
                    case 8239:
                    case 8287:
                    case 12288:
                    case 65279:
                        return !0;
                    default:
                        return !1
                }
            }
    });
    _("core/math/parser/latex-lexer", ["require", "exports", "./char-codes", "./input-span"], function(e, t, o, s) {
        "use strict";
        function u(e, t, r) {
            return {
                type: e,
                span: t,
                val: r
            }
        }
        function r(e, t, r) {
            for (; o.isWhitespace(e.charCodeAt(t)); )
                t += 1;
            return {
                input: e,
                prevSpan: r,
                pos: t,
                token: function(e, t) {
                    var r = t;
                    if (t >= e.length)
                        return u("End", s.emptySpanAt(e, t), "");
                    var n = e.charCodeAt(t);
                    {
                        if (o.isDigit(n))
                            return u("Digit", i = s.Span(e, r, t + 1), e.charAt(r));
                        if (o.isLetter(n))
                            return u("Letter", i = s.Span(e, r, t + 1), e.charAt(r));
                        if (o.isBackslash(n)) {
                            if (t += 1,
                                o.isLetter(e.charCodeAt(t))) {
                                for (; o.isLetter(e.charCodeAt(t)); )
                                    t += 1;
                                var i = s.Span(e, r, t)
                                    , a = s.slice(i);
                                return u(c[a] || "Cmd", i, a)
                            }
                            t += 1;
                            i = s.Span(e, r, t),
                                a = s.slice(i);
                            return u("EscapedSymbol", i, a)
                        }
                        if (o.isSingleQuote(n)) {
                            for (t += 1; o.isSingleQuote(e.charCodeAt(t)); )
                                t += 1;
                            if ("^" === e.charAt(t)) {
                                t += 1;
                                i = s.Span(e, r, t),
                                    a = s.slice(i);
                                return u("Primes^", i, a)
                            }
                            i = s.Span(e, r, t),
                                a = s.slice(i);
                            return u("Primes", i, a)
                        }
                        i = s.Span(e, r, t + 1),
                            a = e.charAt(r);
                        return u(l[a] || "Symbol", i, a)
                    }
                }(e, t)
            }
        }
        function n(e) {
            return r(e.input, e.token.span.end, e.token.span)
        }
        function i(e) {
            return e.token
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.isDone = t.isAt = t.eat = t.peek = t.advance = t.lex = t.LatexToken = t.spanStates = void 0,
            t.spanStates = function(e, t) {
                return s.joinSpans(e.token.span, t.prevSpan)
            }
            ,
            t.LatexToken = u,
            t.lex = function(e) {
                return r(e, 0, s.emptySpanAt(e, 0))
            }
            ,
            t.advance = n,
            t.peek = i,
            t.eat = function(e, t) {
                if (i(e).type !== t)
                    throw "Parse Error: expected " + t + ".";
                return n(e)
            }
            ,
            t.isAt = function(e, t) {
                return i(e).type === t
            }
            ,
            t.isDone = function(e) {
                return e.pos >= e.input.length
            }
        ;
        var c = {
            "\\left": "Left",
            "\\right": "Right",
            "\\sqrt": "Sqrt",
            "\\frac": "Frac",
            "\\operatorname": "OperatorName"
        }
            , l = {
            "[": "[",
            "]": "]",
            "{": "{",
            "}": "}",
            "^": "^",
            _: "_"
        }
    });
    _("core/math/parser/latex-node", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.Symbol = t.OperatorName = t.LeftRight = t.SupSub = t.Frac = t.Sqrt = t.Group = void 0,
            t.Group = function(e, t) {
                return {
                    type: "Group",
                    span: e,
                    args: t
                }
            }
            ,
            t.Sqrt = function(e, t, r) {
                return {
                    type: "Sqrt",
                    span: e,
                    optArg: t,
                    arg: r
                }
            }
            ,
            t.Frac = function(e, t, r) {
                return {
                    type: "Frac",
                    span: e,
                    num: t,
                    den: r
                }
            }
            ,
            t.SupSub = function(e, t, r, n) {
                return {
                    type: "SupSub",
                    span: e,
                    sup: t,
                    sub: r,
                    nprimes: n
                }
            }
            ,
            t.LeftRight = function(e, t, r, n) {
                return {
                    type: "LeftRight",
                    span: e,
                    left: t,
                    right: r,
                    arg: n
                }
            }
            ,
            t.OperatorName = function(e, t) {
                return {
                    type: "OperatorName",
                    span: e,
                    arg: t
                }
            }
            ,
            t.Symbol = function(e, t) {
                return {
                    type: "Symbol",
                    span: e,
                    val: t
                }
            }
    });
    _("core/math/parser/latex-parser", ["require", "exports", "./latex-lexer", "./input-span", "./latex-node"], function(e, t, p, s, f) {
        "use strict";
        function u(e) {
            switch (e) {
                case "Frac":
                    return 2;
                case "^":
                case "_":
                case "Primes^":
                case "Left":
                case "Frac":
                case "Sqrt":
                case "OperatorName":
                    return 1;
                default:
                    return 0
            }
        }
        function h(e, t) {
            return {
                state: e,
                tree: t
            }
        }
        function c(e, t) {
            var r = e
                , n = [];
            e: for (; !p.isDone(e); ) {
                var i = p.peek(e);
                switch (i.type) {
                    case "Cmd":
                    case "EscapedSymbol":
                    case "Letter":
                    case "Digit":
                    case "Symbol":
                    case "[":
                    case "{":
                    case "^":
                    case "_":
                    case "Primes":
                    case "Primes^":
                    case "Left":
                    case "Frac":
                    case "Sqrt":
                    case "OperatorName":
                    case "]":
                        if ("]" === i.type && t)
                            break e;
                        var a, o;
                        if (e = (o = d(e)).state,
                        "Group" === (a = o.tree).type)
                            for (var s = 0, u = a.args; s < u.length; s++) {
                                var c = u[s];
                                n.push(c)
                            }
                        else
                            n.push(a);
                        break;
                    case "}":
                    case "Right":
                    case "End":
                        break e;
                    default:
                        throw "Unexpected token type " + i.type + "."
                }
            }
            var l = p.spanStates(r, e);
            return h(e, f.Group(l, n))
        }
        function d(e) {
            var t = p.peek(e);
            switch (t.type) {
                case "Cmd":
                case "EscapedSymbol":
                case "Letter":
                case "Digit":
                case "Symbol":
                    return h(e = p.advance(e), t);
                case "[":
                case "]":
                    return h(e = p.advance(e), f.Symbol(t.span, t.val));
                case "{":
                    var r, n;
                    return e = (n = c(e = p.advance(e), !1)).state,
                        r = n.tree,
                        h(e = p.eat(e, "}"), r);
                case "^":
                case "_":
                case "Primes":
                case "Primes^":
                    return function(e) {
                        var t, r, n, i, a, o = e, s = 0;
                        e: for (; !p.isDone(e); ) {
                            var u = p.peek(e);
                            switch (u.type) {
                                case "^":
                                    if (e = p.advance(e),
                                        i)
                                        throw "Parse Error: double superscript.";
                                    t = l(e, u),
                                        e = t.state,
                                        i = t.tree;
                                    break;
                                case "_":
                                    if (e = p.advance(e),
                                        a)
                                        throw "Parse Error: double subscript.";
                                    r = l(e, u),
                                        e = r.state,
                                        a = r.tree;
                                    break;
                                case "Primes":
                                    if (e = p.advance(e),
                                    0 < s)
                                        throw "Parse Error: double primes.";
                                    s = u.val.length;
                                    break;
                                case "Primes^":
                                    if (e = p.advance(e),
                                    0 < s)
                                        throw "Parse Error: double primes.";
                                    if (i)
                                        throw "Parse Error: double superscript";
                                    s = u.val.length - 1,
                                        n = l(e, u),
                                        e = n.state,
                                        i = n.tree;
                                    break;
                                default:
                                    break e
                            }
                        }
                        var c = p.spanStates(o, e);
                        return h(e, f.SupSub(c, i, a, s))
                    }(e);
                case "Left":
                    return function(e) {
                        var t, r = e;
                        e = p.eat(e, "Left");
                        var n, i = p.peek(e);
                        e = p.advance(e),
                            t = c(e, !1),
                            e = t.state,
                            n = t.tree,
                            e = p.eat(e, "Right");
                        var a = p.peek(e);
                        e = p.advance(e);
                        var o = p.spanStates(r, e);
                        return h(e, f.LeftRight(o, i, a, n))
                    }(e);
                case "Frac":
                    return function(e) {
                        var t, r, n, i, a = e, o = p.peek(e);
                        e = p.eat(e, "Frac"),
                            t = l(e, o),
                            e = t.state,
                            n = t.tree,
                            r = l(e, o),
                            e = r.state,
                            i = r.tree;
                        var s = p.spanStates(a, e);
                        return h(e, f.Frac(s, n, i))
                    }(e);
                case "Sqrt":
                    return function(e) {
                        var t, r, n, i, a = e, o = p.peek(e);
                        e = p.eat(e, "Sqrt"),
                        p.isAt(e, "[") && (t = function(e) {
                            var t, r;
                            return e = p.eat(e, "["),
                                t = c(e, !0),
                                e = t.state,
                                r = t.tree,
                                h(e = p.eat(e, "]"), r)
                        }(e),
                            e = t.state,
                            n = t.tree);
                        r = l(e, o),
                            e = r.state,
                            i = r.tree;
                        var s = p.spanStates(a, e);
                        return h(e, f.Sqrt(s, n, i))
                    }(e);
                case "OperatorName":
                    return function(e) {
                        var t, r, n = e, i = p.peek(e);
                        e = p.eat(e, "OperatorName"),
                            t = l(e, i),
                            e = t.state,
                            r = t.tree;
                        var a = p.spanStates(n, e);
                        return h(e, f.OperatorName(a, r))
                    }(e);
                case "}":
                case "Right":
                    throw "Parse Error: unexpected " + t.val + ".";
                case "End":
                    throw "Parse Error: unexpected end.";
                default:
                    throw "Unexpected token type " + t.type + "."
            }
        }
        function l(e, t) {
            var r, n, i = u(t.type);
            if (i <= 0)
                throw new Error("Programming Error: greediness must be greater than 0.");
            var a = u(p.peek(e).type);
            if (0 < a && a <= i) {
                var o = s.slice(t.span);
                throw "Parse Error: can't use " + s.slice(p.peek(e).span) + " as argument of " + o + ". Use {}."
            }
            return e = (r = d(e)).state,
            "Group" !== (n = r.tree).type && (n = f.Group(n.span, [n])),
                h(e, n)
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.parse = void 0,
            t.parse = function(e) {
                var t = c(p.lex(e), !1)
                    , r = t.state
                    , n = t.tree;
                if (!p.isDone(r))
                    throw "Parse error: unexpected " + s.slice(p.peek(r).span) + ".";
                return n
            }
    });
    _("core/math/parser/command-aliases", ["require", "exports", "./char-codes"], function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.translateCmd = void 0;
        var n = {
            mcd: "gcd",
            gcf: "gcd",
            mcm: "lcm",
            signum: "sign",
            stdDevP: "stdevp",
            stddevp: "stdevp",
            stdDev: "stdev",
            stddev: "stdev",
            variance: "var",
            TTest: "ttest",
            TScore: "tscore",
            IndependentTTest: "ittest",
            iTTest: "ittest",
            inverseCdf: "quantile",
            inversecdf: "quantile",
            arsinh: "arcsinh",
            arcosh: "arccosh",
            artanh: "arctanh",
            arcsch: "arccsch",
            arsech: "arcsech",
            arcoth: "arccoth"
        };
        t.translateCmd = function(e) {
            for (var t = 0; r.isBackslash(e.charCodeAt(t)); )
                t += 1;
            return 0 < t && (e = e.slice(t)),
            n[e] || e
        }
    });
    _("core/math/parser/surface-node", ["require", "exports", "./command-aliases"], function(e, t, r) {
        "use strict";
        function a(e) {
            if ("Subscript" === e.type) {
                if ("Alphanumeric" !== e.args[1].type)
                    return !1;
                e = e.args[0]
            }
            switch (e.type) {
                case "Cmd":
                case "Letter":
                    return !0;
                default:
                    return !1
            }
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.unwrapSeq = t.isDerivative = t.isSuperscriptedIdentifier = t.isIdentifier = t.MixedNumber = t.Alphanumeric = t.Cmd = t.Decimal = t.Letter = t.Juxt = t.PercentOf = t.Dot = t.Ellipsis = t.Colon = t.EmptyRangeEnd = t.EmptyPiecewise = t.Piecewise = t.Product = t.Sum = t.EmptyIntegral = t.Integral = t.Derivative = t.Frac = t.Nthroot = t.Sqrt = t.Seq = t.Prime = t.Superscript = t.Subscript = t.Pipes = t.List = t.Paren = t.Index = t.ImplicitCall = t.Call = t.Bang = t.Div = t.Mul = t.Sub = t.Add = t.Neg = t.Pos = t.Tilde = t.InequalityChain = t.TrailingInequalityPiece = t.Inequality = t.Equals = void 0,
            t.Equals = function(e, t) {
                return {
                    type: "Equals",
                    span: e,
                    args: t
                }
            }
            ,
            t.Inequality = function(e, t, r) {
                return {
                    type: "Inequality",
                    span: e,
                    symbol: t,
                    args: r
                }
            }
            ,
            t.TrailingInequalityPiece = function(e, t, r) {
                return {
                    type: "TrailingInequalityPiece",
                    span: e,
                    symbol: t,
                    args: r
                }
            }
            ,
            t.InequalityChain = function(e, t, r) {
                return {
                    type: "InequalityChain",
                    span: e,
                    first: t,
                    chain: r
                }
            }
            ,
            t.Tilde = function(e, t) {
                return {
                    type: "Tilde",
                    span: e,
                    args: t
                }
            }
            ,
            t.Pos = function(e, t) {
                return {
                    type: "Pos",
                    span: e,
                    args: t
                }
            }
            ,
            t.Neg = function(e, t) {
                return {
                    type: "Neg",
                    span: e,
                    args: t
                }
            }
            ,
            t.Add = function(e, t) {
                return {
                    type: "Add",
                    span: e,
                    args: t
                }
            }
            ,
            t.Sub = function(e, t) {
                return {
                    type: "Sub",
                    span: e,
                    args: t
                }
            }
            ,
            t.Mul = function(e, t) {
                return {
                    type: "Mul",
                    span: e,
                    args: t
                }
            }
            ,
            t.Div = function(e, t) {
                return {
                    type: "Div",
                    span: e,
                    args: t
                }
            }
            ,
            t.Bang = function(e, t) {
                return {
                    type: "Bang",
                    span: e,
                    args: t
                }
            }
            ,
            t.Call = function(e, t) {
                return {
                    type: "Call",
                    span: e,
                    args: t
                }
            }
            ,
            t.ImplicitCall = function(e, t) {
                return {
                    type: "ImplicitCall",
                    span: e,
                    args: t
                }
            }
            ,
            t.Index = function(e, t) {
                return {
                    type: "Index",
                    span: e,
                    args: t
                }
            }
            ,
            t.Paren = function(e, t) {
                return {
                    type: "Paren",
                    span: e,
                    args: t
                }
            }
            ,
            t.List = function(e, t) {
                return {
                    type: "List",
                    span: e,
                    args: t
                }
            }
            ,
            t.Pipes = function(e, t) {
                return {
                    type: "Pipes",
                    span: e,
                    args: t
                }
            }
            ,
            t.Subscript = function(e, t) {
                return {
                    type: "Subscript",
                    span: e,
                    args: t
                }
            }
            ,
            t.Superscript = function(e, t) {
                return {
                    type: "Superscript",
                    span: e,
                    args: t
                }
            }
            ,
            t.Prime = function(e, t, r) {
                return {
                    type: "Prime",
                    span: e,
                    nprimes: t,
                    args: r
                }
            }
            ,
            t.Seq = function(e, t) {
                return {
                    type: "Seq",
                    span: e,
                    args: t
                }
            }
            ,
            t.Sqrt = function(e, t) {
                return {
                    type: "Sqrt",
                    span: e,
                    args: t
                }
            }
            ,
            t.Nthroot = function(e, t) {
                return {
                    type: "Nthroot",
                    span: e,
                    args: t
                }
            }
            ,
            t.Frac = function(e, t) {
                return {
                    type: "Frac",
                    span: e,
                    args: t
                }
            }
            ,
            t.Derivative = function(e, t) {
                return {
                    type: "Derivative",
                    span: e,
                    args: t
                }
            }
            ,
            t.Integral = function(e, t) {
                return {
                    type: "Integral",
                    span: e,
                    args: t
                }
            }
            ,
            t.EmptyIntegral = function(e, t) {
                return {
                    type: "EmptyIntegral",
                    span: e,
                    args: t
                }
            }
            ,
            t.Sum = function(e, t) {
                return {
                    type: "Sum",
                    span: e,
                    args: t
                }
            }
            ,
            t.Product = function(e, t) {
                return {
                    type: "Product",
                    span: e,
                    args: t
                }
            }
            ,
            t.Piecewise = function(e, t) {
                return {
                    type: "Piecewise",
                    span: e,
                    args: t
                }
            }
            ,
            t.EmptyPiecewise = function(e) {
                return {
                    type: "EmptyPiecewise",
                    span: e
                }
            }
            ,
            t.EmptyRangeEnd = function(e) {
                return {
                    type: "EmptyRangeEnd",
                    span: e
                }
            }
            ,
            t.Colon = function(e, t) {
                return {
                    type: "Colon",
                    span: e,
                    args: t
                }
            }
            ,
            t.Ellipsis = function(e, t) {
                return {
                    type: "Ellipsis",
                    span: e,
                    args: t
                }
            }
            ,
            t.Dot = function(e, t) {
                return {
                    type: "Dot",
                    span: e,
                    args: t
                }
            }
            ,
            t.PercentOf = function(e, t) {
                return {
                    type: "PercentOf",
                    span: e,
                    args: t
                }
            }
            ,
            t.Juxt = function(e, t) {
                return {
                    type: "Juxt",
                    span: e,
                    args: t
                }
            }
            ,
            t.Letter = function(e, t) {
                return {
                    type: "Letter",
                    span: e,
                    val: t
                }
            }
            ,
            t.Decimal = function(e, t) {
                return {
                    type: "Decimal",
                    span: e,
                    val: t
                }
            }
            ,
            t.Cmd = function(e, t) {
                return {
                    type: "Cmd",
                    span: e,
                    val: r.translateCmd(t)
                }
            }
            ,
            t.Alphanumeric = function(e, t) {
                return {
                    type: "Alphanumeric",
                    span: e,
                    val: t
                }
            }
            ,
            t.MixedNumber = function(e, t, r, n) {
                return {
                    type: "MixedNumber",
                    span: e,
                    whole: t,
                    num: r,
                    den: n
                }
            }
            ,
            t.isIdentifier = a,
            t.isSuperscriptedIdentifier = function(e) {
                return "Superscript" === e.type && a(e.args[0])
            }
            ,
            t.isDerivative = function(e, t) {
                if ("Letter" !== e.type || "d" !== e.val)
                    return !1;
                if ("Juxt" !== t.type)
                    return !1;
                var r = t.args
                    , n = r[0]
                    , i = r[1];
                return "Letter" === n.type && "d" === n.val && a(i)
            }
            ,
            t.unwrapSeq = function(e) {
                return "Seq" === e.type ? e.args : [e]
            }
    });
    _("core/math/parser/surface-node-error", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.AdjacentNumbers = t.FractionEmpty = t.FractionMissingDenominator = t.FractionMissingNumerator = t.DifferentialWithSuperscript = t.IntegralMissingDifferential = t.DerivativeMissingBody = t.IntegralMissingBody = t.ProductMissingBody = t.SumMissingBody = t.IntegralMissingBound = t.MissingBound = t.ProductMissingBound = t.SumMissingBound = t.UnexpectedPrime = t.SuperscriptWithPrime = t.PrimeWithoutParen = t.PercentMissingOf = t.FunctionMissingArgument = t.UnexpectedSubscript = t.InvalidSubscript = t.InvalidOperatorName = t.UnrecognizedSymbol = t.UnexpectedDifferential = t.UnexpectedCloseDelimiter = t.MissingCloseDelimiter = t.UnaryOperatorMissingLeft = t.UnaryOperatorMissingRight = t.BinaryOperatorMissingLeft = t.BinaryOperatorMissingRight = t.UnexpectedEnd = t.EmptyRadicalIndex = t.EmptyPipe = t.EmptySquareBracket = t.EmptyRadical = t.EmptySuperscript = t.EmptySubscript = t.EmptyGroup = t.EmptyInput = t.UnexpectedParseError = t.Err = void 0,
            t.Err = function(e, t) {
                return {
                    type: "Err",
                    span: e,
                    error: t
                }
            }
            ,
            t.UnexpectedParseError = function() {
                return {
                    type: "UnexpectedParseError"
                }
            }
            ,
            t.EmptyInput = function() {
                return {
                    type: "EmptyInput"
                }
            }
            ,
            t.EmptyGroup = function() {
                return {
                    type: "EmptyGroup"
                }
            }
            ,
            t.EmptySubscript = function() {
                return {
                    type: "EmptySubscript"
                }
            }
            ,
            t.EmptySuperscript = function() {
                return {
                    type: "EmptySuperscript"
                }
            }
            ,
            t.EmptyRadical = function() {
                return {
                    type: "EmptyRadical"
                }
            }
            ,
            t.EmptySquareBracket = function() {
                return {
                    type: "EmptySquareBracket"
                }
            }
            ,
            t.EmptyPipe = function() {
                return {
                    type: "EmptyPipe"
                }
            }
            ,
            t.EmptyRadicalIndex = function() {
                return {
                    type: "EmptyRadicalIndex"
                }
            }
            ,
            t.UnexpectedEnd = function() {
                return {
                    type: "UnexpectedEnd"
                }
            }
            ,
            t.BinaryOperatorMissingRight = function(e) {
                return {
                    type: "BinaryOperatorMissingRight",
                    val: e
                }
            }
            ,
            t.BinaryOperatorMissingLeft = function(e) {
                return {
                    type: "BinaryOperatorMissingLeft",
                    val: e
                }
            }
            ,
            t.UnaryOperatorMissingRight = function(e) {
                return {
                    type: "UnaryOperatorMissingRight",
                    val: e
                }
            }
            ,
            t.UnaryOperatorMissingLeft = function(e) {
                return {
                    type: "UnaryOperatorMissingLeft",
                    val: e
                }
            }
            ,
            t.MissingCloseDelimiter = function(e, t) {
                return {
                    type: "MissingCloseDelimiter",
                    open: e,
                    close: t
                }
            }
            ,
            t.UnexpectedCloseDelimiter = function(e, t) {
                return {
                    type: "UnexpectedCloseDelimiter",
                    open: e,
                    close: t
                }
            }
            ,
            t.UnexpectedDifferential = function() {
                return {
                    type: "UnexpectedDifferential"
                }
            }
            ,
            t.UnrecognizedSymbol = function(e) {
                return {
                    type: "UnrecognizedSymbol",
                    val: e
                }
            }
            ,
            t.InvalidOperatorName = function(e) {
                return {
                    type: "InvalidOperatorName",
                    val: e
                }
            }
            ,
            t.InvalidSubscript = function(e) {
                return {
                    type: "InvalidSubscript",
                    val: e
                }
            }
            ,
            t.UnexpectedSubscript = function(e) {
                return {
                    type: "UnexpectedSubscript",
                    base: e
                }
            }
            ,
            t.FunctionMissingArgument = function(e) {
                return {
                    type: "FunctionMissingArgument",
                    val: e
                }
            }
            ,
            t.PercentMissingOf = function() {
                return {
                    type: "PercentMissingOf"
                }
            }
            ,
            t.PrimeWithoutParen = function() {
                return {
                    type: "PrimeWithoutParen"
                }
            }
            ,
            t.SuperscriptWithPrime = function() {
                return {
                    type: "SuperscriptWithPrime"
                }
            }
            ,
            t.UnexpectedPrime = function() {
                return {
                    type: "UnexpectedPrime"
                }
            }
            ,
            t.SumMissingBound = function() {
                return {
                    type: "SumMissingBound"
                }
            }
            ,
            t.ProductMissingBound = function() {
                return {
                    type: "ProductMissingBound"
                }
            }
            ,
            t.MissingBound = function() {
                return {
                    type: "MissingBound"
                }
            }
            ,
            t.IntegralMissingBound = function() {
                return {
                    type: "IntegralMissingBound"
                }
            }
            ,
            t.SumMissingBody = function() {
                return {
                    type: "SumMissingBody"
                }
            }
            ,
            t.ProductMissingBody = function() {
                return {
                    type: "ProductMissingBody"
                }
            }
            ,
            t.IntegralMissingBody = function() {
                return {
                    type: "IntegralMissingBody"
                }
            }
            ,
            t.DerivativeMissingBody = function() {
                return {
                    type: "DerivativeMissingBody"
                }
            }
            ,
            t.IntegralMissingDifferential = function() {
                return {
                    type: "IntegralMissingDifferential"
                }
            }
            ,
            t.DifferentialWithSuperscript = function() {
                return {
                    type: "DifferentialWithSuperscript"
                }
            }
            ,
            t.FractionMissingNumerator = function() {
                return {
                    type: "FractionMissingNumerator"
                }
            }
            ,
            t.FractionMissingDenominator = function() {
                return {
                    type: "FractionMissingDenominator"
                }
            }
            ,
            t.FractionEmpty = function() {
                return {
                    type: "FractionEmpty"
                }
            }
            ,
            t.AdjacentNumbers = function(e) {
                return {
                    type: "AdjacentNumbers",
                    args: e
                }
            }
    });
    _("core/math/parser/expression-token-tables", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.allTokenTypes = t.rightTable = t.leftTable = t.escapedSymbolTable = t.symbolTable = t.commandTable = void 0;
        t.commandTable = {
            "\\lt": "<",
            "\\gt": ">",
            "\\le": "<=",
            "\\ge": ">=",
            "\\leq": "<=",
            "\\geq": ">=",
            "\\ldots": "...",
            "\\sim": "~",
            "\\cdot": "*",
            "\\times": "*",
            "\\div": "/",
            "\\ln": "Ln",
            "\\log": "Log",
            "\\int": "Int",
            "\\sum": "Sum",
            "\\prod": "Prod",
            "\\backslash": "Err"
        };
        for (var r = 0, n = ["sin", "cos", "tan", "cot", "sec", "csc"]; r < n.length; r++) {
            var i = n[r];
            t.commandTable["\\" + i] = "Trig",
                t.commandTable["\\" + i + "h"] = "Trig",
                t.commandTable["\\arc" + i] = "Trig",
                t.commandTable["\\arc" + i + "h"] = "Trig",
                t.commandTable["\\ar" + i + "h"] = "Trig"
        }
        t.symbolTable = {
            "+": "+",
            "-": "-",
            "*": "*",
            "/": "/",
            "!": "!",
            "(": "(",
            ")": ")",
            "[": "[",
            "]": "]",
            ",": ",",
            "...": "...",
            ":": ":",
            "=": "=",
            ">=": ">=",
            "<=": "<=",
            ">": ">",
            "<": "<",
            "~": "~",
            ".": "."
        },
            t.escapedSymbolTable = {
                "\\{": "\\{",
                "\\}": "\\}",
                "\\%": "%"
            },
            t.leftTable = {
                "|": "(|",
                "\\{": "\\{",
                "[": "[",
                "(": "("
            },
            t.rightTable = {
                "|": "|)",
                "\\}": "\\}",
                "]": "]",
                ")": ")"
            },
            t.allTokenTypes = Object.keys({
                "+": !0,
                "-": !0,
                "*": !0,
                "/": !0,
                "!": !0,
                "(": !0,
                ")": !0,
                "\\{": !0,
                "\\}": !0,
                "(|": !0,
                "|)": !0,
                "[": !0,
                "]": !0,
                ",": !0,
                "...": !0,
                ":": !0,
                "=": !0,
                ">": !0,
                "<": !0,
                ">=": !0,
                "<=": !0,
                "~": !0,
                "%": !0,
                ".": !0,
                Letter: !0,
                Decimal: !0,
                Cmd: !0,
                Differential: !0,
                End: !0,
                Trig: !0,
                Ln: !0,
                Log: !0,
                Int: !0,
                Sum: !0,
                Prod: !0,
                Err: !0
            })
    });
    _("core/math/parser/expression-lexer", ["require", "exports", "./expression-token-tables", "./input-span", "./input-span", "./surface-node"], function(e, t, M, D, r, m) {
        "use strict";
        function f(e, t, r, n, i, a, o, s) {
            return {
                opts: e,
                input: t,
                prevSpan: r,
                startIndex: n,
                endIndex: i,
                token: a,
                mode: o,
                parent: s
            }
        }
        function w(e, t, r) {
            return {
                type: e,
                span: t,
                val: r
            }
        }
        function o(e, t, r, n, i, a) {
            var o = t.args;
            if (r > o.length && a)
                return h(a, n);
            var s = function e(t, r, n) {
                var i = t.args;
                if (r >= i.length) {
                    var a = D.emptySpanAt(t.span.input, t.span.end);
                    return P(r, w("End", a, ""))
                }
                var o = t.args[r];
                switch (o.type) {
                    case "Sqrt":
                    case "Frac":
                    case "SupSub":
                        return P(r, o);
                    case "Letter":
                        if (!n || "integral" !== n.type)
                            return P(r, o);
                        if ("d" != o.val)
                            return P(r, o);
                        var s = e(t, r + 1, n)
                            , u = s.endIndex
                            , c = s.token;
                        if ("Letter" !== c.type && "Cmd" !== c.type)
                            return P(r, o);
                        var l = {
                            type: "Differential",
                            span: D.joinSpans(o.span, c.span),
                            val: c.val
                        };
                        return P(u, l);
                    case "LeftRight":
                        var p = o.left
                            , f = M.leftTable[p.val] || "Err"
                            , h = D.joinSpans(o.span, p.span);
                        return P(r, w(f, h, p.val));
                    case "OperatorName":
                        for (var d = [], m = 0, g = o.arg.args; m < g.length; m++) {
                            var y = g[m];
                            if ("Letter" !== y.type)
                                return P(r, w("Err", o.span, D.slice(o.arg.span)));
                            d.push(y.val)
                        }
                        var v = "\\" + d.join("")
                            , b = M.commandTable[v] || "Cmd";
                        return P(r, w(b, o.span, v));
                    case "Cmd":
                        var x = M.commandTable[o.val] || "Cmd";
                        return P(r, w(x, o.span, o.val));
                    case "EscapedSymbol":
                        var S = M.escapedSymbolTable[o.val] || "Err";
                        return P(r, w(S, o.span, o.val));
                    case "Symbol":
                        if (L(o))
                            return O(t, r);
                        var _ = M.symbolTable[o.val] || "Err";
                        return P(r, w(_, o.span, o.val));
                    case "Digit":
                        return T(t, r);
                    default:
                        var E = o;
                        throw "Unexpected atom " + E.type + "."
                }
            }(t, r = v(o, r), i)
                , u = s.token
                , c = s.endIndex;
            if ("End" === u.type && a) {
                var l = a.input.args[a.startIndex];
                if ("LeftRight" === l.type) {
                    var p = l.right;
                    return f(e, t, n, r, c, w(M.rightTable[p.val] || "Err", p.span, p.val), i, a)
                }
            } else
                "Int" === u.type ? i = d(i) : "Differential" === u.type && (i = g(i));
            return f(e, t, n, r, c, u, i, a)
        }
        function h(e, t) {
            var r = e.input
                , n = e.endIndex
                , i = e.mode
                , a = e.parent;
            return o(e.opts, r, n + 1, t, i, a)
        }
        function n(e) {
            return e.token
        }
        function d(e) {
            return {
                type: "integral",
                parent: e
            }
        }
        function g(e) {
            if (!e || "integral" !== e.type)
                throw new Error("Programming Error: expected lexer to be in integral mode.");
            return e.parent
        }
        function P(e, t) {
            return {
                token: t,
                endIndex: e
            }
        }
        function O(e, t) {
            var r = e.args[t];
            if ("Symbol" !== r.type || "." !== r.val)
                throw new Error("Programming Error: expected '.'");
            if (t + 2 < e.args.length && L(e.args[t + 1]) && L(e.args[t + 2])) {
                var n = D.joinSpans(r.span, e.args[t + 2].span);
                return P(t + 2, w("...", n, D.slice(n)))
            }
            var i = v(e.args, t + 1);
            return i < e.args.length && "Digit" === e.args[i].type ? T(e, t) : P(t, w(M.symbolTable[r.val] || "Err", r.span, r.val))
        }
        function T(e, t) {
            var r = function(e, t) {
                for (var r = e.args, n = r[t].span, i = []; t < r.length; t++) {
                    var a = v(r, t);
                    if (a >= r.length)
                        break;
                    if ("Digit" !== (h = r[a]).type)
                        break;
                    t = a,
                        i.push(h.val)
                }
                if ((t = v(r, t)) >= r.length)
                    return;
                var o = r[t];
                if ("Frac" !== o.type)
                    return;
                for (var s = [], u = [], c = 0, l = o.num.args; c < l.length; c++) {
                    if (!y(h = l[c])) {
                        if ("Digit" !== h.type)
                            return;
                        s.push(h.val)
                    }
                }
                for (var p = 0, f = o.den.args; p < f.length; p++) {
                    var h;
                    if (!y(h = f[p])) {
                        if ("Digit" !== h.type)
                            return;
                        u.push(h.val)
                    }
                }
                var d = D.joinSpans(n, o.span);
                return P(t, m.MixedNumber(d, i.join(""), s.join(""), u.join("")))
            }(e, t);
            if (r)
                return r;
            for (var n = e.args, i = e.args[t].span, a = [], o = !1, s = !1; t < n.length; t++) {
                var u = v(n, t);
                if (u >= n.length)
                    break;
                var c = n[u];
                if ("Digit" === c.type)
                    t = u,
                        o = !0,
                        a.push(c.val);
                else {
                    if (s || !L(c))
                        break;
                    if (u + 1 < n.length && L(e.args[u + 1]))
                        break;
                    t = u,
                        s = !0,
                        a.push(".")
                }
            }
            if (!o)
                throw new Error("Programming Error: decimals must have at least one digit.");
            return P(t - 1, w("Decimal", D.joinSpans(i, e.args[t - 1].span), a.join("")))
        }
        function y(e) {
            switch (e.type) {
                case "Sqrt":
                case "Frac":
                case "SupSub":
                case "LeftRight":
                case "OperatorName":
                case "Symbol":
                case "Letter":
                case "Digit":
                    return;
                case "Cmd":
                    return "\\space" === e.val;
                case "EscapedSymbol":
                    return "\\ " === e.val || "\\:" === e.val || "\\," === e.val || "\\;" === e.val;
                default:
                    throw "Unexpected atom " + e.type + "."
            }
        }
        function v(e, t) {
            for (; t < e.length && y(e[t]); )
                t += 1;
            return t
        }
        function L(e) {
            return "Symbol" === e.type && "." === e.val
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.didAdvance = t.isDone = t.isAt = t.endIntegral = t.beginIntegral = t.peek = t.advance = t.lexAt = t.lex = t.emptySpanAtState = t.joinState = t.spanStates = t.Span = void 0,
            Object.defineProperty(t, "Span", {
                enumerable: !0,
                get: function() {
                    return r.Span
                }
            }),
            t.spanStates = function(e, t) {
                return D.joinSpans(e.token.span, t.prevSpan)
            }
            ,
            t.joinState = function(e, t) {
                return D.joinSpans(e, t.prevSpan)
            }
            ,
            t.emptySpanAtState = function(e) {
                return D.emptySpanAt(e.token.span.input, e.token.span.start)
            }
            ,
            t.lex = function(e, t) {
                return o(t, e, 0, D.emptySpanAt(e.span.input, e.span.start), void 0, void 0)
            }
            ,
            t.lexAt = o,
            t.advance = function(e) {
                var t = e.input.args[e.startIndex]
                    , r = e.token.span;
                return t && "LeftRight" === t.type ? o(e.opts, t.arg, 0, r, e.mode, e) : h(e, r)
            }
            ,
            t.peek = n,
            t.beginIntegral = d,
            t.endIntegral = g,
            t.isAt = function(e, t) {
                return n(e).type === t
            }
            ,
            t.isDone = function(e) {
                return e.startIndex >= e.input.args.length
            }
            ,
            t.didAdvance = function(e, t) {
                return t.token.span.start > e.token.span.start
            }
    });
    _("core/math/parser/precspec", ["require", "exports", "./expression-token-tables"], function(e, t, a) {
        "use strict";
        function p(e, t) {
            for (var r = 0, n = a.allTokenTypes; r < n.length; r++) {
                var i = n[r];
                if (void 0 === t[i])
                    throw new Error("Programming Error: token " + i + " must be a assigned a " + e + " precedence")
            }
        }
        function f(e, t, r, n) {
            if (void 0 !== t[r])
                throw new Error("Programming Error: duplicate " + e + " entry for token " + r + ".");
            t[r] = n
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.precSpec = t.ra = t.la = t.r = t.l = t.initial = void 0,
            t.initial = function(e) {
                return {
                    type: "initial",
                    tokenType: e
                }
            }
            ,
            t.l = function(e) {
                return {
                    type: "l",
                    tokenType: e
                }
            }
            ,
            t.r = function(e) {
                return {
                    type: "r",
                    tokenType: e
                }
            }
            ,
            t.la = function(e) {
                return {
                    type: "la",
                    tokenType: e
                }
            }
            ,
            t.ra = function(e) {
                return {
                    type: "ra",
                    tokenType: e
                }
            }
            ,
            t.precSpec = function(e) {
                for (var r = {}, t = {}, n = {}, i = 0; i < e.length; i++)
                    for (var a = 0, o = e[i]; a < o.length; a++) {
                        var s = o[a]
                            , u = s.type
                            , c = s.tokenType;
                        switch (u) {
                            case "initial":
                                f("initial", r, c, i);
                                break;
                            case "l":
                                f("left", t, c, i);
                                break;
                            case "r":
                                f("right", n, c, i);
                                break;
                            case "la":
                                f("left", t, c, i),
                                    f("right", n, c, i);
                                break;
                            case "ra":
                                f("left", t, c, i),
                                    f("right", n, c, i - 1)
                        }
                    }
                function l(e) {
                    return n[e]
                }
                return p("left", t),
                    p("right", n),
                    {
                        rightPrec: l,
                        leftPrec: function(e) {
                            return t[e]
                        },
                        initialPrec: function(e) {
                            var t = r[e];
                            return void 0 === t ? l(e) : t
                        }
                    }
            }
    });
    _("core/math/parser/expression-parser", ["require", "exports", "core/math/errormsg", "tslib", "./surface-node", "./surface-node-error", "./input-span", "./expression-lexer", "./precspec"], function(e, t, W, n, Y, X, s, H, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.parse = void 0;
        var i = [[r.initial("("), r.la(")"), r.initial("\\{"), r.la("\\}"), r.r("["), r.la("]"), r.initial("(|"), r.la("|)"), r.la("Differential"), r.la("End")], [r.ra("...")], [r.la(",")], [r.ra(":")], [r.la("="), r.la(">"), r.la("<"), r.la(">="), r.la("<="), r.la("~")], [r.la("+"), r.la("-")], [r.la("*"), r.la("/"), r.la("Decimal"), r.la("MixedNumber"), r.la("Letter"), r.la("Cmd"), r.la("%"), r.r("("), r.la("\\{"), r.la("(|"), r.la("Frac"), r.la("Sqrt"), r.la("Trig"), r.la("Ln"), r.la("Log"), r.ra("Int"), r.ra("Sum"), r.ra("Prod")], [r.initial("+"), r.initial("-")], [r.la("!")], [r.la("SupSub")], [r.l("["), r.la(".")], [r.l("(")], [r.la("Err")]]
            , a = r.precSpec(i)
            , Z = a.leftPrec
            , L = a.rightPrec
            , K = a.initialPrec
            , o = {
            trailingComma: !1
        };
        function $(e, t) {
            var r = H.lex(e, t);
            if (H.isDone(r))
                return X.Err(H.spanStates(r, r), X.EmptyGroup());
            var n = J(r, 0)
                , i = n.state
                , a = n.tree;
            return "Err" === a.type || H.isDone(i) ? a : se(i).tree
        }
        function Q(e, t) {
            return {
                state: e,
                tree: t
            }
        }
        function J(e, t) {
            var r, n, i = e, a = function(e) {
                var t, r, n, i, a, o, s, u, c, l, p, f, h, d, m, g, y, v, b, x = e, S = H.peek(e), _ = K(S.type);
                switch (S.type) {
                    case "+":
                        if (e = H.advance(e),
                            t = J(e, _),
                            e = t.state,
                        "Err" !== (b = t.tree).type)
                            return Q(e, Y.Pos(H.spanStates(x, e), [b]));
                        if (!ee(b.error))
                            return Q(e, b);
                        var E = H.spanStates(x, e)
                            , M = X.Err(E, X.UnaryOperatorMissingRight(S.val));
                        return Q(e, M);
                    case "-":
                        if (e = H.advance(e),
                            r = J(e, _),
                            e = r.state,
                        "Err" !== (b = r.tree).type)
                            return Q(e, Y.Neg(H.spanStates(x, e), [b]));
                        if (!ee(b.error))
                            return Q(e, b);
                        E = H.spanStates(x, e),
                            M = X.Err(E, X.UnaryOperatorMissingRight(S.val));
                        return Q(e, M);
                    case "(":
                        return ie(e);
                    case "\\{":
                        return e = H.advance(e),
                            H.isAt(e, "\\}") ? Q(e = H.advance(e), Y.EmptyPiecewise(H.spanStates(x, e))) : (n = J(e, _),
                                e = n.state,
                                b = n.tree,
                                i = oe(x, e, b, "\\{", "\\}"),
                                e = i.state,
                                "Err" === (b = i.tree).type ? Q(e, b) : Q(e, Y.Piecewise(H.spanStates(x, e), [b])));
                    case "[":
                        return e = H.advance(e),
                            H.isAt(e, "]") ? Q(e = H.advance(e), Y.List(H.spanStates(x, e), [])) : (a = J(e, _),
                                e = a.state,
                                b = a.tree,
                                o = oe(x, e, b, "[", "]"),
                                e = o.state,
                                "Err" === (b = o.tree).type ? Q(e, b) : Q(e, Y.List(H.spanStates(x, e), [b])));
                    case "(|":
                        if (e = H.advance(e),
                            H.isAt(e, "|)")) {
                            e = H.advance(e);
                            E = H.spanStates(x, e);
                            return Q(e, X.Err(E, X.EmptyPipe()))
                        }
                        return s = J(e, _),
                            e = s.state,
                            b = s.tree,
                            u = oe(x, e, b, "(|", "|)"),
                            e = u.state,
                            "Err" === (b = u.tree).type ? Q(e, b) : Q(e, Y.Pipes(H.spanStates(x, e), [b]));
                    case "Frac":
                        if (e.opts.disallowFrac)
                            throw W.fractionsUnavailable();
                        e = H.advance(e);
                        var D = $(S.num, e.opts)
                            , w = $(S.den, e.opts);
                        if ("Err" === D.type && "EmptyGroup" === D.error.type && "Err" === w.type && "EmptyGroup" === w.error.type) {
                            E = H.spanStates(x, e),
                                M = X.Err(E, X.FractionEmpty());
                            return Q(e, M)
                        }
                        if ("Err" === D.type && "EmptyGroup" === D.error.type) {
                            E = H.spanStates(x, e),
                                M = X.Err(E, X.FractionMissingNumerator());
                            return Q(e, M)
                        }
                        if ("Err" === w.type && "EmptyGroup" === w.error.type) {
                            E = H.spanStates(x, e),
                                M = X.Err(E, X.FractionMissingDenominator());
                            return Q(e, M)
                        }
                        if ("Err" === D.type)
                            return Q(e, D);
                        if ("Err" === w.type)
                            return Q(e, w);
                        if (Y.isDerivative(D, w) && "Juxt" === w.type) {
                            var P = w.args[1]
                                , O = void 0;
                            if (c = J(e, Z("*") - 1),
                                e = c.state,
                            "Err" !== (O = c.tree).type)
                                return Q(e, Y.Derivative(H.spanStates(x, e), [P, O]));
                            if (ee(O.error)) {
                                E = H.spanStates(x, e);
                                return Q(e, X.Err(E, X.DerivativeMissingBody()))
                            }
                            return Q(e, O)
                        }
                        return Q(e, Y.Frac(H.spanStates(x, e), [D, w]));
                    case "Sqrt":
                        if (e = H.advance(e),
                            S.optArg) {
                            var T = $(S.optArg, e.opts);
                            return "Err" === T.type ? "EmptyGroup" === T.error.type ? Q(e, X.Err(T.span, X.EmptyRadicalIndex())) : Q(e, T) : "Err" === (L = $(S.arg, e.opts)).type ? "EmptyGroup" === L.error.type ? Q(e, X.Err(L.span, X.EmptyRadical())) : Q(e, L) : Q(e, Y.Nthroot(H.spanStates(x, e), [T, L]))
                        }
                        var L;
                        return "Err" === (L = $(S.arg, e.opts)).type ? "EmptyGroup" === L.error.type ? Q(e, X.Err(L.span, X.EmptyRadical())) : Q(e, L) : Q(e, Y.Sqrt(H.spanStates(x, e), [L]));
                    case "Trig":
                    case "Ln":
                        e = H.advance(e);
                        var I = Y.Cmd(H.spanStates(x, e), S.val)
                            , C = 0;
                        if ("SupSub" === (B = H.peek(e)).type) {
                            if (e = H.advance(e),
                                B.sub) {
                                E = H.spanStates(x, e),
                                    M = X.Err(E, X.UnexpectedSubscript(I.val));
                                return Q(e, M)
                            }
                            if (F = re(B, e.opts)) {
                                if ("Err" === F.type)
                                    return Q(e, F);
                                I = Y.Superscript(H.spanStates(x, e), [I, F])
                            }
                            C = B.nprimes
                        }
                        if (N = H.isAt(e, "(")) {
                            if (l = ie(e),
                                e = l.state,
                            "Err" === (b = l.tree).type)
                                return Q(e, b);
                            b = Y.Call(H.spanStates(x, e), [I, b.args[0]])
                        } else {
                            if (p = J(e, _ - 1),
                                e = p.state,
                            "Err" === (b = p.tree).type)
                                return ee(b.error) ? Q(e, X.Err(H.spanStates(x, e), X.FunctionMissingArgument(S.val))) : Q(e, b);
                            b = Y.ImplicitCall(H.spanStates(x, e), [I, b])
                        }
                        if (0 < C) {
                            E = H.spanStates(x, e);
                            if (!N) {
                                M = X.Err(E, X.PrimeWithoutParen());
                                return Q(e, M)
                            }
                            b = Y.Prime(E, C, [b])
                        }
                        return Q(e, b);
                    case "Log":
                        e = H.advance(e);
                        var N, I = Y.Cmd(H.spanStates(x, e), S.val), C = 0, A = void 0, F = void 0;
                        if ("SupSub" === (B = H.peek(e)).type && (e = H.advance(e),
                            A = te(B, e.opts),
                            F = re(B, e.opts),
                            C = B.nprimes),
                        A && "Err" === A.type)
                            return Q(e, A);
                        if (F && "Err" === F.type)
                            return Q(e, F);
                        if (N = H.isAt(e, "(")) {
                            if (f = ie(e),
                                e = f.state,
                            "Err" === (b = f.tree).type)
                                return Q(e, b);
                            b = b.args[0]
                        } else if (h = J(e, _ - 1),
                            e = h.state,
                        "Err" === (b = h.tree).type)
                            return ee(b.error) ? Q(e, X.Err(H.spanStates(x, e), X.FunctionMissingArgument(S.val))) : Q(e, b);
                        var q = A ? Y.Seq(H.spanStates(x, e), Y.unwrapSeq(b).concat(A)) : b
                            , R = A ? Y.Cmd(H.spanStates(x, e), "\\logbase") : I;
                        if (F && (R = Y.Superscript(H.spanStates(x, e), [R, F])),
                            b = N ? Y.Call(H.spanStates(x, e), [R, q]) : Y.ImplicitCall(H.spanStates(x, e), [R, q]),
                        0 < C) {
                            E = H.spanStates(x, e);
                            if (!N) {
                                M = X.Err(E, X.PrimeWithoutParen());
                                return Q(e, M)
                            }
                            b = Y.Prime(E, C, [b])
                        }
                        return Q(e, b);
                    case "Int":
                        e = H.advance(e);
                        var B = H.peek(e);
                        if (e = H.advance(e),
                        "Err" === (k = ne(B, x, e)).type)
                            return "MissingBound" === k.error.type ? Q(e, X.Err(k.span, X.IntegralMissingBound())) : Q(e, k);
                        F = k.sup,
                            A = k.sub,
                            P = void 0;
                        if (H.isAt(e, "Differential"))
                            return d = ae(e),
                                e = d.state,
                                "Err" === (P = d.tree).type ? Q(e, P) : Q(e, Y.EmptyIntegral(H.spanStates(x, e), [P, A, F]));
                        if (m = J(e, _),
                            e = m.state,
                        "Err" === (b = m.tree).type)
                            return ee(b.error) ? Q(e, X.Err(b.span, X.IntegralMissingBody())) : Q(e, b);
                        var V = b;
                        return H.isAt(e, "Differential") ? (g = ae(e),
                            e = g.state,
                            "Err" === (P = g.tree).type ? Q(e, P) : Q(e, Y.Integral(H.spanStates(x, e), [P, A, F, V]))) : Q(e, X.Err(H.spanStates(x, e), X.IntegralMissingDifferential()));
                    case "Sum":
                        e = H.advance(e);
                        B = H.peek(e);
                        if (e = H.advance(e),
                        "Err" === (k = ne(B, x, e)).type)
                            return "MissingBound" === k.error.type ? Q(e, X.Err(k.span, X.SumMissingBound())) : Q(e, k);
                        F = k.sup,
                            A = k.sub;
                        return y = J(e, _),
                            e = y.state,
                            "Err" === (b = y.tree).type ? ee(b.error) ? Q(e, X.Err(b.span, X.SumMissingBody())) : Q(e, b) : Q(e, Y.Sum(H.spanStates(x, e), [b, A, F]));
                    case "Prod":
                        e = H.advance(e);
                        var k, B = H.peek(e);
                        if (e = H.advance(e),
                        "Err" === (k = ne(B, x, e)).type)
                            return "MissingBound" === k.error.type ? Q(e, X.Err(k.span, X.ProductMissingBound())) : Q(e, k);
                        F = k.sup,
                            A = k.sub;
                        return v = J(e, _),
                            e = v.state,
                            "Err" === (b = v.tree).type ? ee(b.error) ? Q(e, X.Err(b.span, X.ProductMissingBody())) : Q(e, b) : Q(e, Y.Product(H.spanStates(x, e), [b, A, F]));
                    case "Cmd":
                        return e = H.advance(e),
                            b = Y.Cmd(H.spanStates(x, e), S.val),
                            Q(e, b);
                    case "Letter":
                        return e = H.advance(e),
                            b = Y.Letter(H.spanStates(x, e), S.val),
                            Q(e, b);
                    case "Decimal":
                        e = H.advance(e);
                        var j = Y.Decimal(H.spanStates(x, e), S.val);
                        if ("Decimal" !== (B = e.token).type && "MixedNumber" !== B.type)
                            return Q(e, j);
                        var z = e;
                        e = H.advance(e);
                        var E = H.spanStates(x, e)
                            , U = "MixedNumber" === B.type ? B : Y.Decimal(H.spanStates(z, e), B.val);
                        return Q(e, X.Err(E, X.AdjacentNumbers([j, U])));
                    case "MixedNumber":
                        if (e.opts.disallowFrac)
                            throw W.fractionsUnavailable();
                        if (e = H.advance(e),
                        "Decimal" !== (B = e.token).type && "MixedNumber" !== B.type)
                            return Q(e, S);
                        z = e;
                        e = H.advance(e);
                        E = H.spanStates(x, e),
                            U = "MixedNumber" === B.type ? B : Y.Decimal(H.spanStates(z, e), B.val);
                        return Q(e, X.Err(E, X.AdjacentNumbers([S, U])));
                    case "*":
                    case "/":
                    case ",":
                    case "=":
                    case ">":
                    case "<":
                    case ">=":
                    case "<=":
                    case "~":
                    case ":":
                    case "...":
                    case "%":
                    case ".":
                        e = H.advance(e);
                        E = H.spanStates(x, e),
                            M = X.Err(E, X.BinaryOperatorMissingLeft(S.val));
                        return Q(e, M);
                    case "!":
                        e = H.advance(e);
                        E = H.spanStates(x, e),
                            M = X.Err(E, X.UnaryOperatorMissingLeft(S.val));
                        return Q(e, M);
                    case "SupSub":
                        e = H.advance(e);
                        var G = "supsub";
                        S.sub ? G = "subscript" : S.sup ? G = "superscript" : 0 < S.nprimes && (G = "prime");
                        E = H.spanStates(x, e),
                            M = X.Err(E, X.UnaryOperatorMissingLeft(G));
                        return Q(e, M);
                    case ")":
                    case "\\}":
                    case "]":
                    case "|)":
                    case "Differential":
                        return se(e);
                    case "Err":
                        e = H.advance(e);
                        E = H.spanStates(x, e),
                            M = X.Err(E, X.UnrecognizedSymbol(S.val));
                        return Q(e, M);
                    case "End":
                        E = H.spanStates(x, e),
                            M = X.Err(E, X.UnexpectedEnd());
                        return Q(e, M);
                    default:
                        throw "Unexpected token type " + S.type + "."
                }
            }(e);
            if (e = a.state,
            "Err" === (r = a.tree).type)
                return Q(e, r);
            if (!H.didAdvance(i, e))
                throw new Error("Programming Error: parseInitial did not advance state.");
            for (; !H.isDone(e); ) {
                if ((!H.isAt(e, "(") || (n = r,
                Y.isIdentifier(n) || "Prime" === n.type && Y.isIdentifier(n.args[0])) ? Z(H.peek(e).type) : L("(")) <= t)
                    break;
                var o, s = e;
                if (e = (o = function(e, t) {
                    var r, n, i, a, o, s, u, c, l, p, f, h, d, m, g, y = H.peek(e), v = L(y.type);
                    switch (y.type) {
                        case "+":
                        case "-":
                        case "*":
                        case "/":
                        case "=":
                        case "~":
                        case ":":
                        case ".":
                            if (e = H.advance(e),
                                r = J(e, v),
                                e = r.state,
                            "Err" !== (g = r.tree).type)
                                return Q(e, function(e, t, r) {
                                    switch (e) {
                                        case "+":
                                            return Y.Add(t, r);
                                        case "-":
                                            return Y.Sub(t, r);
                                        case "*":
                                            return Y.Mul(t, r);
                                        case "/":
                                            return Y.Div(t, r);
                                        case "=":
                                            return Y.Equals(t, r);
                                        case "~":
                                            return Y.Tilde(t, r);
                                        case ":":
                                            return Y.Colon(t, r);
                                        case ".":
                                            return Y.Dot(t, r);
                                        default:
                                            throw "Unexpected token type " + e + "."
                                    }
                                }(y.type, H.joinState(t.span, e), [t, g]));
                            if (ee(g.error)) {
                                var b = H.joinState(t.span, e)
                                    , x = X.Err(b, X.BinaryOperatorMissingRight(y.val));
                                return Q(e, x)
                            }
                            return Q(e, g);
                        case "%":
                            e = H.advance(e);
                            var S = H.peek(e);
                            if ("Cmd" !== S.type || "of" !== S.val && "\\of" !== S.val) {
                                x = X.Err(y.span, X.PercentMissingOf());
                                return Q(e, x)
                            }
                            if (e = H.advance(e),
                                n = J(e, v),
                                e = n.state,
                            "Err" !== (g = n.tree).type)
                                return Q(e, Y.PercentOf(H.joinState(t.span, e), [t, g]));
                            if (ee(g.error)) {
                                b = H.joinState(t.span, e),
                                    x = X.Err(b, X.BinaryOperatorMissingRight(y.val));
                                return Q(e, x)
                            }
                            return Q(e, g);
                        case ">=":
                        case "<=":
                        case ">":
                        case "<":
                            var _ = y.type;
                            if (e = H.advance(e),
                                i = I(e, _),
                                e = i.state,
                                _ = i.symbol,
                                a = J(e, v),
                                e = a.state,
                            "Err" === (g = a.tree).type) {
                                if (ee(g.error)) {
                                    b = H.joinState(t.span, e),
                                        x = X.Err(b, X.BinaryOperatorMissingRight(y.val));
                                    return Q(e, x)
                                }
                                return Q(e, g)
                            }
                            for (var E = Y.Inequality(H.joinState(t.span, e), _, [t, g]), M = [], D = H.peek(e).type; ">=" === D || "<=" === D || ">" === D || "<" === D; ) {
                                var w = e;
                                if (_ = D,
                                    e = H.advance(e),
                                    o = I(e, _),
                                    e = o.state,
                                    _ = o.symbol,
                                    s = J(e, v),
                                    e = s.state,
                                "Err" === (g = s.tree).type) {
                                    if (ee(g.error)) {
                                        b = H.joinState(t.span, e),
                                            x = X.Err(b, X.BinaryOperatorMissingRight(y.val));
                                        return Q(e, x)
                                    }
                                    return Q(e, g)
                                }
                                M.push(Y.TrailingInequalityPiece(H.spanStates(w, e), _, [g])),
                                    D = H.peek(e).type
                            }
                            return M.length ? Q(e, Y.InequalityChain(H.joinState(t.span, e), E, M)) : Q(e, E);
                        case "!":
                            return Q(e = H.advance(e), Y.Bang(H.joinState(t.span, e), [t]));
                        case "[":
                            w = e;
                            if (e = H.advance(e),
                                H.isAt(e, "]")) {
                                e = H.advance(e);
                                b = H.spanStates(w, e);
                                return Q(e, X.Err(b, X.EmptySquareBracket()))
                            }
                            return u = J(e, v),
                                e = u.state,
                                g = u.tree,
                                c = oe(w, e, g, "[", "]"),
                                e = c.state,
                                "Err" === (g = c.tree).type ? Q(e, g) : Q(e, Y.Index(H.joinState(t.span, e), [t, g]));
                        case "Sqrt":
                        case "Frac":
                        case "Letter":
                        case "Cmd":
                        case "Trig":
                        case "Ln":
                        case "Log":
                        case "Sum":
                        case "Int":
                        case "Prod":
                        case "Decimal":
                        case "MixedNumber":
                        case "\\{":
                        case "(|":
                            return l = J(e, v),
                                e = l.state,
                                "Err" === (g = l.tree).type ? Q(e, g) : Q(e, Y.Juxt(H.joinState(t.span, e), [t, g]));
                        case "(":
                            if (Y.isIdentifier(t)) {
                                if (p = ie(e),
                                    e = p.state,
                                "Err" === (g = p.tree).type)
                                    return Q(e, g);
                                b = H.joinState(t.span, e);
                                return Q(e, Y.Call(b, [t, g.args[0]]))
                            }
                            if ("Prime" === t.type && Y.isIdentifier(t.args[0])) {
                                if (f = ie(e),
                                    e = f.state,
                                "Err" === (g = f.tree).type)
                                    return Q(e, g);
                                b = H.joinState(t.span, e);
                                return Q(e, Y.Prime(b, t.nprimes, [Y.Call(b, [t.args[0], g.args[0]])]))
                            }
                            return h = J(e, v),
                                e = h.state,
                                "Err" === (g = h.tree).type ? Q(e, g) : Q(e, Y.Juxt(H.joinState(t.span, e), [t, g]));
                        case "SupSub":
                            e = H.advance(e);
                            var P = C(y)
                                , O = re(y, e.opts);
                            if (P && "Err" === P.type)
                                return Q(e, P);
                            if (O && "Err" === O.type)
                                return Q(e, O);
                            if (P && (t = Y.Subscript(H.joinState(t.span, e), [t, P])),
                            O && (t = Y.Superscript(H.joinState(t.span, e), [t, O])),
                            0 < y.nprimes) {
                                b = H.joinState(t.span, e);
                                if (!Y.isIdentifier(t)) {
                                    x = X.Err(b, X.UnexpectedPrime());
                                    return Q(e, x)
                                }
                                t = Y.Prime(b, y.nprimes, [t])
                            }
                            return Q(e, t);
                        case ",":
                            for (var T = [t]; H.isAt(e, ",") && (e = H.advance(e),
                                !H.isAt(e, "...")) && (!e.opts.trailingComma || !function(e) {
                                return H.isAt(e, ")") || H.isAt(e, "]") || H.isAt(e, "\\}")
                            }(e)); ) {
                                if (d = J(e, v),
                                    e = d.state,
                                "Err" === (g = d.tree).type) {
                                    if (ee(g.error)) {
                                        b = H.joinState(t.span, e),
                                            x = X.Err(b, X.BinaryOperatorMissingRight(y.val));
                                        return Q(e, x)
                                    }
                                    return Q(e, g)
                                }
                                T.push(g)
                            }
                            return Q(e, Y.Seq(H.joinState(t.span, e), T));
                        case "...":
                            if (e = H.advance(e),
                            H.isAt(e, ",") && (e = H.advance(e)),
                            v >= Z(H.peek(e).type))
                                return Q(e, Y.Ellipsis(H.joinState(t.span, e), [t, Y.EmptyRangeEnd(H.emptySpanAtState(e))]));
                            if (m = J(e, v),
                                e = m.state,
                            "Err" !== (g = m.tree).type)
                                return Q(e, Y.Ellipsis(H.joinState(t.span, e), [t, g]));
                            if (ee(g.error)) {
                                b = H.joinState(t.span, e),
                                    x = X.Err(b, X.BinaryOperatorMissingRight(y.val));
                                return Q(e, x)
                            }
                            return Q(e, g);
                        case "]":
                        case ")":
                        case "\\}":
                        case "|)":
                        case "Differential":
                            return se(e);
                        case "Err":
                            return J(e, v);
                        case "End":
                            b = H.spanStates(e, e),
                                x = X.Err(b, X.UnexpectedEnd());
                            return Q(e, x);
                        default:
                            throw "Unexpected token type " + y.type + "."
                    }
                }(e, r)).state,
                "Err" === (r = o.tree).type)
                    return Q(e, r);
                if (!H.didAdvance(s, e))
                    throw new Error("Programming Error: parseSuccessor did not advance state.")
            }
            return Q(e, r)
        }
        function ee(e) {
            return "UnexpectedDifferential" === e.type || "UnexpectedCloseDelimiter" === e.type || "UnexpectedEnd" === e.type || "BinaryOperatorMissingLeft" === e.type
        }
        function I(e, t) {
            if (!H.isAt(e, "="))
                return {
                    state: e,
                    symbol: t
                };
            switch (t) {
                case ">":
                    e = H.advance(e),
                        t = ">=";
                    break;
                case "<":
                    e = H.advance(e),
                        t = "<="
            }
            return {
                state: e,
                symbol: t
            }
        }
        function te(e, t) {
            if (e.sub) {
                var r = $(e.sub, t);
                return "Err" === r.type && "EmptyGroup" === r.error.type ? X.Err(r.span, X.EmptySubscript()) : r
            }
        }
        function C(e) {
            if (e.sub) {
                var t = e.sub;
                if (0 === t.args.length)
                    return X.Err(t.span, X.EmptySubscript());
                for (var r = [], n = 0, i = t.args; n < i.length; n++) {
                    var a = i[n];
                    if ("Digit" !== a.type && "Letter" !== a.type) {
                        var o = a.span;
                        return X.Err(o, X.InvalidSubscript(s.slice(o)))
                    }
                    r.push(a.val)
                }
                return Y.Alphanumeric(t.span, r.join(""))
            }
        }
        function re(e, t) {
            if (e.sup) {
                var r = $(e.sup, t);
                return "Err" === r.type ? "EmptyGroup" === r.error.type ? X.Err(r.span, X.EmptySuperscript()) : r : 0 < e.nprimes ? X.Err(e.span, X.SuperscriptWithPrime()) : r
            }
        }
        function ne(e, t, r) {
            if ("SupSub" !== e.type) {
                var n = H.spanStates(t, r);
                return X.Err(n, X.MissingBound())
            }
            if (0 < e.nprimes) {
                n = H.spanStates(t, r);
                return X.Err(n, X.UnexpectedPrime())
            }
            var i = te(e, r.opts)
                , a = re(e, r.opts);
            if (!i || "Err" === i.type && "EmptySubscript" === i.error.type || !a || "Err" === a.type && "EmptySuperscript" === a.error.type) {
                n = H.spanStates(t, r);
                return X.Err(n, X.MissingBound())
            }
            return "Err" === i.type ? i : "Err" === a.type ? a : {
                type: "Bounds",
                sup: a,
                sub: i
            }
        }
        function ie(e) {
            var t, r, n, i = e, a = H.peek(e), o = K(a.type);
            if (!H.isAt(e, "("))
                throw new Error("Programming Error: expected '(' at start of parseParen.");
            if (e = H.advance(e),
                H.isAt(e, ")")) {
                var s = Y.Seq(H.emptySpanAtState(e), []);
                e = H.advance(e);
                var u = H.spanStates(i, e);
                return Q(e, Y.Paren(u, [s]))
            }
            return e = (r = oe(i, e = (t = J(e, o)).state, t.tree, "(", ")")).state,
                "Err" === (n = r.tree).type ? Q(e, n) : Q(e, Y.Paren(H.spanStates(i, e), [n]))
        }
        function ae(e) {
            var t = e
                , r = H.peek(e);
            if ("Differential" !== r.type)
                throw new Error("Programming Error: expected differential");
            e = H.advance(e);
            var n = Y.Cmd(r.span, r.val)
                , i = H.peek(e);
            if ("SupSub" === i.type) {
                e = H.advance(e);
                var a = H.spanStates(t, e)
                    , o = C(i);
                if (o) {
                    if ("Err" === o.type)
                        return Q(e, o);
                    n = Y.Subscript(a, [n, o])
                }
                if (i.sup)
                    return Q(e, X.Err(a, X.DifferentialWithSuperscript()));
                if (0 < i.nprimes)
                    return Q(e, X.Err(a, X.UnexpectedPrime()))
            }
            return Q(e, n)
        }
        function oe(e, t, r, n, i) {
            if ("Err" === r.type && "UnexpectedEnd" !== r.error.type)
                return Q(t, r);
            if ("Err" !== r.type && H.isAt(t, i))
                return Q(t = H.advance(t), r);
            var a = H.spanStates(e, t);
            return Q(t, X.Err(a, X.MissingCloseDelimiter(n, i)))
        }
        function se(e) {
            var t = e;
            switch (H.peek(e).type) {
                case ")":
                    e = H.advance(e);
                    var r = H.spanStates(t, e);
                    return Q(e, X.Err(r, X.UnexpectedCloseDelimiter("(", ")")));
                case "]":
                    e = H.advance(e);
                    r = H.spanStates(t, e);
                    return Q(e, X.Err(r, X.UnexpectedCloseDelimiter("[", "]")));
                case "\\}":
                    e = H.advance(e);
                    r = H.spanStates(t, e);
                    return Q(e, X.Err(r, X.UnexpectedCloseDelimiter("\\{", "\\}")));
                case "|)":
                    e = H.advance(e);
                    r = H.spanStates(t, e);
                    return Q(e, X.Err(r, X.UnexpectedCloseDelimiter("|", "|")));
                case "Differential":
                    e = H.advance(e);
                    r = H.spanStates(t, e);
                    return Q(e, X.Err(r, X.UnexpectedDifferential()));
                default:
                    e = H.advance(e);
                    r = H.spanStates(t, e);
                    return Q(e, X.Err(r, X.UnexpectedParseError()))
            }
        }
        t.parse = function(e, t) {
            var r = $(e, t ? n.__assign(n.__assign({}, o), t) : o);
            return "Err" === r.type && "EmptyGroup" === r.error.type ? X.Err(r.span, X.EmptyInput()) : r
        }
    });
    _("core/math/inverses", [], function() {
        "use strict";
        var t = {};
        return ["sin", "cos", "tan", "cot", "sec", "csc", "sinh", "cosh", "tanh", "coth", "sech", "csch"].forEach(function(e) {
            t[e] = "arc" + e,
                t["arc" + e] = e
        }),
            t
    });
    _("core/math/parser/lower", ["require", "exports", "core/math/inverses", "core/math/errormsg", "tslib", "./input-span", "./surface-node", "../maybe-rational"], function(e, t, g, Z, n, K, $, Q) {
        "use strict";
        function J(e, t) {
            for (var r = [], n = 0; n < t.length; n++)
                r.push(te(e, t[n]));
            return r
        }
        function ee(e) {
            if ("Paren" !== e.type)
                return !1;
            var t = e.args[0];
            return "Seq" === t.type && 2 === t.args.length
        }
        function te(e, t) {
            return e.setInput(re(e, t), t.span)
        }
        function re(e, t) {
            var r = e.nodes;
            switch (t.type) {
                case "Pos":
                    return re(e, t.args[0]);
                case "Neg":
                    for (var n = -1, i = t.args[0]; ; )
                        if ("Pos" === i.type || "Paren" === i.type && !ee(i))
                            i = i.args[0];
                        else {
                            if ("Neg" !== i.type)
                                break;
                            i = i.args[0],
                                n *= -1
                        }
                    switch (i.type) {
                        case "Decimal":
                            var a = ue(i);
                            return r.Constant(-1 === n ? Q.neg(a) : a);
                        case "MixedNumber":
                            a = ce(i);
                            return r.MixedNumber(-1 === n ? Q.neg(a) : a);
                        default:
                            return -1 === n ? r.Negative([te(e, i)]) : re(e, i)
                    }
                case "Add":
                    return r.Add(J(e, t.args));
                case "Sub":
                    return r.Subtract(J(e, t.args));
                case "Mul":
                    return r.Multiply(J(e, t.args));
                case "Div":
                    return r.Divide(J(e, t.args));
                case "Bang":
                    var o = t.args[0];
                    return "Call" === o.type ? r.FunctionFactorial(J(e, o.args)) : r.FunctionCall("\\factorial", J(e, t.args));
                case "PercentOf":
                    return r.PercentOf(J(e, t.args));
                case "Call":
                    return ae(e, t);
                case "ImplicitCall":
                    return function(e) {
                        var t = e.args
                            , r = t[0]
                            , n = t[1];
                        "Superscript" === r.type && (r = r.args[0]);
                        if ("Cmd" === r.type && "logbase" === r.val && "Seq" === n.type && 2 === n.args.length) {
                            if (!pe(n.args[0]))
                                throw Z.badImplicitCall("log")
                        } else if (!pe(n)) {
                            if ("Cmd" === r.type)
                                throw Z.badImplicitCall(r.val);
                            throw Z.parseError()
                        }
                    }(t),
                        ae(e, t);
                case "Dot":
                    var s = t.args[1]
                        , u = J(e, t.args)
                        , c = u[0]
                        , l = u[1];
                    if (fe(s)) {
                        var p = K.emptySpanAt(s.span.input, s.span.end)
                            , f = e.setInput(he(e), p);
                        l = e.setInput(r.SeededFunctionCall(l, [f]), s.span)
                    } else if ("Letter" === s.type)
                        switch (s.val) {
                            case "x":
                                return r.OrderedPairAccess([c, r.Constant(1)]);
                            case "y":
                                return r.OrderedPairAccess([c, r.Constant(2)])
                        }
                    return r.DotAccess([c, l]);
                case "Prime":
                    var h = t.args[0];
                    if ("Call" !== h.type)
                        throw "ImplicitCall" === h.type ? Z.primeWithoutParen() : Z.unexpectedPrime();
                    var d = h.args
                        , m = d[0]
                        , g = d[1]
                        , y = $.unwrapSeq(g).length;
                    if ("Cmd" === m.type && "logbase" === m.val) {
                        if (2 !== y)
                            throw Z.primedFunctionArity()
                    } else if (1 !== y)
                        throw Z.primedFunctionArity();
                    return r.Prime(t.nprimes, J(e, t.args));
                case "Index":
                    var v = t.args
                        , b = v[0]
                        , x = v[1];
                    if ("Seq" === x.type)
                        return r.ListAccess([re(e, b), r.List(J(e, x.args))]);
                    if ("Ellipsis" !== x.type)
                        return oe(x) ? r.ListAccess([re(e, b), se(e, x)]) : r.ListAccess(J(e, t.args));
                    var S = x.args
                        , _ = S[0]
                        , E = S[1];
                    return r.ListAccess([re(e, b), r.Range([r.List(J(e, $.unwrapSeq(_))), r.List("EmptyRangeEnd" === E.type ? [] : J(e, $.unwrapSeq(E)))])]);
                case "Paren":
                    var M = t.args[0];
                    return "Seq" === M.type ? r.OrderedPair(J(e, M.args)) : re(e, M);
                case "List":
                    if (0 === t.args.length)
                        return r.List([]);
                    var D = t.args[0];
                    if ("Ellipsis" !== D.type)
                        return r.List(J(e, $.unwrapSeq(D)));
                    var w = D.args
                        , _ = w[0]
                        , E = w[1];
                    return r.Range([r.List(J(e, $.unwrapSeq(_))), r.List(J(e, $.unwrapSeq(E)))]);
                case "Pipes":
                    return r.FunctionCall("\\abs", J(e, t.args));
                case "Subscript":
                    var P = t.args
                        , O = P[0]
                        , T = P[1];
                    if (0 === T.val.length)
                        throw Z.emptySubscript();
                    var L = void 0;
                    switch (O.type) {
                        case "Letter":
                        case "Cmd":
                            L = O.val;
                            break;
                        default:
                            throw Z.unexpectedSubscript()
                    }
                    return r.Identifier(L + "_" + T.val);
                case "Superscript":
                    var I = t.args
                        , O = I[0]
                        , C = I[1];
                    if ("Call" !== O.type || "Seq" === O.args[1].type || function(e) {
                        if ("Call" !== e.type)
                            return !1;
                        var t = e.args[0];
                        for (; "Superscript" === t.type || "Subscript" === t.type || "Prime" === t.type; )
                            t = t.args[0];
                        return "Cmd" === t.type && (ne(t.val) || ie(t.val))
                    }(O)) {
                        if ("Dot" !== O.type)
                            return r.Exponent(J(e, t.args));
                        var s = O.args[1]
                            , N = J(e, O.args)
                            , c = N[0]
                            , l = N[1]
                            , A = te(e, C);
                        if ("Letter" === s.type)
                            switch (s.val) {
                                case "x":
                                    return r.Exponent([r.OrderedPairAccess([c, r.Constant(1)]), A]);
                                case "y":
                                    return r.Exponent([r.OrderedPairAccess([c, r.Constant(2)]), A])
                            }
                        else if ("Call" === s.type) {
                            if ("Letter" === (m = s.args[0]).type)
                                switch (m.val) {
                                    case "x":
                                        return r.Multiply([r.OrderedPairAccess([c, r.Constant(1)]), r.Exponent([te(e, s.args[1]), A])]);
                                    case "y":
                                        return r.Exponent([r.OrderedPairAccess([c, r.Constant(2)]), r.Exponent([te(e, s.args[1]), A])])
                                }
                        }
                        return r.DotAccessExponent([c, l, A])
                    }
                    return r.FunctionExponent(J(e, [O.args[0], O.args[1], C]));
                case "Sqrt":
                    return r.FunctionCall("sqrt", J(e, t.args));
                case "Nthroot":
                    return r.FunctionCall("nthroot", J(e, [t.args[1], t.args[0]]));
                case "Frac":
                    return r.Divide(J(e, t.args));
                case "Derivative":
                    var F = J(e, t.args);
                    if (!$.isIdentifier(t.args[0]))
                        throw Z.parseError();
                    return r.Derivative(F[0], [F[1]]);
                case "Integral":
                    var q = t.args
                        , F = J(e, [B = q[0], q[1], k = q[2], j = q[3]]);
                    return r.Integral(F);
                case "EmptyIntegral":
                    var R = J(e, t.args)
                        , B = R[0]
                        , V = R[1]
                        , k = R[2]
                        , j = r.Constant(Q.maybeRational(1, 1));
                    return r.Integral([B, V, k, j]);
                case "Sum":
                    var z = t.args
                        , U = z[0]
                        , G = z[1]
                        , k = z[2];
                    if ("Equals" != G.type)
                        throw Z.incorrectSumLowerBound();
                    if (!$.isIdentifier(G.args[0]))
                        throw Z.incorrectSumLowerBound();
                    var W = te(de(e, (F = J(e, [G.args[0], G.args[1], k]))[0]), U);
                    return r.Sum(F.concat(W));
                case "Product":
                    var Y = t.args
                        , U = Y[0]
                        , X = Y[1]
                        , k = Y[2];
                    if ("Equals" != X.type)
                        throw Z.incorrectProductLowerBound();
                    if (!$.isIdentifier(X.args[0]))
                        throw Z.incorrectProductLowerBound();
                    W = te(de(e, (F = J(e, [X.args[0], X.args[1], k]))[0]), U);
                    return r.Product(F.concat(W));
                case "Juxt":
                    return r.Multiply(J(e, t.args));
                case "Letter":
                    return r.Identifier(t.val);
                case "Cmd":
                    var H = t.val;
                    if ("ans" === H) {
                        if (void 0 === e.currentIndex)
                            throw Z.badAnsContext();
                        return r.Ans("ans_{" + (e.currentIndex - 1) + "}")
                    }
                    if ("approx" === H)
                        throw Z.unrecognizedSymbol(H);
                    return r.Identifier(H);
                case "Decimal":
                    return r.Constant(ue(t));
                case "MixedNumber":
                    return r.MixedNumber(ce(t));
                case "Piecewise":
                    return function(e, t) {
                        var r, n = e.nodes, i = t.args[0], a = $.unwrapSeq(i), o = [];
                        e: for (r = 0; r < a.length; r++) {
                            var s = a[r];
                            switch (s.type) {
                                case "Colon":
                                    var u = s.args
                                        , c = u[0]
                                        , l = u[1];
                                    if (!oe(c))
                                        throw Z.colonMissingCondition();
                                    o.push({
                                        condition: se(e, c),
                                        if_expr: te(e, l)
                                    });
                                    break;
                                case "Equals":
                                case "Inequality":
                                case "InequalityChain":
                                    o.push({
                                        condition: se(e, s),
                                        if_expr: n.Constant(Q.maybeRational(1, 1))
                                    });
                                    break;
                                default:
                                    break e
                            }
                        }
                        if (0 === r)
                            throw Z.piecewiseMissingCondition();
                        if (r < a.length - 1)
                            throw Z.piecewisePartMissingCondition();
                        var p = r === a.length - 1 ? te(e, a[r]) : n.Constant(NaN);
                        if (!n.Piecewise.chain)
                            throw Z.featureUnavailable();
                        return n.Piecewise.chain(o, p)
                    }(e, t);
                case "EmptyPiecewise":
                    if (!r.Piecewise.empty)
                        throw Z.featureUnavailable();
                    return r.Piecewise.empty();
                case "Equals":
                    throw Z.unexpectedSymbol("=");
                case "Inequality":
                case "InequalityChain":
                    throw Z.unexpectedInequality();
                case "Tilde":
                    throw Z.unexpectedSymbol("~");
                case "Seq":
                    throw Z.unexpectedSymbol(",");
                case "Colon":
                    throw Z.unexpectedSymbol(":");
                case "Ellipsis":
                    throw Z.unexpectedSymbol("...");
                case "EmptyRangeEnd":
                    throw Z.invalidHalfEmptyRange();
                case "Err":
                    throw function(e) {
                        switch (e.type) {
                            case "UnexpectedParseError":
                            case "MissingBound":
                            case "EmptyGroup":
                            case "UnexpectedDifferential":
                            case "UnexpectedEnd":
                                return Z.parseError();
                            case "InvalidOperatorName":
                                return Z.invalidOperatorName();
                            case "UnexpectedCloseDelimiter":
                            case "MissingCloseDelimiter":
                                return Z.mismatchedBraces(e.open, e.close);
                            case "UnrecognizedSymbol":
                                return "." === e.val ? Z.unexpectedSymbol(e.val) : Z.unrecognizedSymbol(e.val);
                            case "EmptyInput":
                                return Z.blankExpression();
                            case "BinaryOperatorMissingRight":
                            case "BinaryOperatorMissingLeft":
                                return Z.binaryOperatorMissingOperand("%" === e.val ? "% of" : e.val);
                            case "UnaryOperatorMissingLeft":
                                return Z.unaryOperatorMissingLeft(e.val);
                            case "UnaryOperatorMissingRight":
                                return Z.unaryOperatorMissingRight(e.val);
                            case "UnexpectedSubscript":
                                return Z.cannotSubscript(e.base);
                            case "PercentMissingOf":
                                return Z.percentMissingOf();
                            case "SumMissingBound":
                                return Z.sumMissingBound();
                            case "ProductMissingBound":
                                return Z.productMissingBound();
                            case "IntegralMissingBound":
                                return Z.integralMissingBound();
                            case "SumMissingBody":
                                return Z.sumMissingBody();
                            case "ProductMissingBody":
                                return Z.productMissingBody();
                            case "IntegralMissingBody":
                                return Z.integralMissingBody();
                            case "DerivativeMissingBody":
                                return Z.derivativeMissingBody();
                            case "IntegralMissingDifferential":
                                return Z.integralMissingDifferential();
                            case "DifferentialWithSuperscript":
                                return Z.differentialWithSuperscript();
                            case "FractionMissingNumerator":
                                return Z.fractionMissingNumerator();
                            case "FractionMissingDenominator":
                                return Z.fractionMissingDenominator();
                            case "FractionEmpty":
                                return Z.fractionEmpty();
                            case "EmptySuperscript":
                                return Z.emptySuperscript();
                            case "EmptySubscript":
                                return Z.emptySubscript();
                            case "InvalidSubscript":
                                return Z.invalidSubscript(e.val);
                            case "SuperscriptWithPrime":
                                return Z.superscriptWithPrime();
                            case "PrimeWithoutParen":
                                return Z.primeWithoutParen();
                            case "UnexpectedPrime":
                                return Z.unexpectedPrime();
                            case "EmptyRadical":
                                return Z.emptyRadical();
                            case "EmptyRadicalIndex":
                                return Z.emptyRadicalIndex();
                            case "EmptySquareBracket":
                                return Z.emptySquareBracket();
                            case "EmptyPipe":
                                return Z.emptyPipe();
                            case "FunctionMissingArgument":
                                return Z.wrongArity(e.val, 1, 0);
                            case "AdjacentNumbers":
                                return Z.adjacentNumbers(le(e.args[0]), le(e.args[1]));
                            default:
                                throw "Unexpected surface node " + e.type + "."
                        }
                    }(t.error);
                default:
                    throw "Unexpected surface node " + t.type + "."
            }
        }
        function ne(e) {
            return g.hasOwnProperty(e)
        }
        function ie(e) {
            return "ln" === e || "log" === e || "logbase" === e
        }
        function ae(e, t) {
            var r, n, i = e.nodes, a = t.args, o = a[0], s = a[1], u = te(e, o), c = J(e, $.unwrapSeq(s));
            if (fe(o)) {
                var l = K.emptySpanAt(s.span.input, s.span.start)
                    , p = e.setInput(he(e), l);
                return i.SeededFunctionCall(u, [p].concat(c))
            }
            if ($.isIdentifier(o))
                return i.FunctionCall(u, c);
            if ("Superscript" === o.type) {
                var f = o.args
                    , h = f[0]
                    , d = f[1];
                if ("Cmd" === h.type) {
                    var m = h.val;
                    if (ne(m) || ie(m)) {
                        if ("Decimal" === (n = d).type && "2" === n.val)
                            return i.Exponent([i.FunctionCall(m, c), te(e, d)]);
                        if ("Neg" === (r = d).type && "Decimal" === (r = r.args[0]).type && "1" === r.val && void 0 !== g[m])
                            return i.FunctionCall(g[m], c);
                        throw ne(m) ? Z.badTrigExponent(m) : Z.badLogExponent("logbase" === m ? "log" : m)
                    }
                }
            }
            return i.Multiply([u, te(e, s)])
        }
        function oe(e) {
            return "Equals" === e.type || "Inequality" === e.type || "InequalityChain" === e.type
        }
        function se(e, t) {
            var r = e.nodes;
            switch (t.type) {
                case "Equals":
                    return r.Comparator["="](J(e, t.args));
                case "Inequality":
                    return r.Comparator[t.symbol](J(e, t.args));
                case "InequalityChain":
                    if (1 < t.chain.length)
                        throw Z.inequalityChainTooLong();
                    var n = t.first
                        , i = n.symbol
                        , a = n.args
                        , o = a[0]
                        , s = a[1]
                        , u = t.chain[0]
                        , c = u.symbol
                        , l = u.args[0]
                        , p = K.emptySpanAt(t.span.input, t.span.start);
                    return r.And([se(e, $.Inequality(p, i, [o, s])), se(e, $.Inequality(p, c, [s, l]))]);
                default:
                    throw Z.parseError()
            }
        }
        function ue(e) {
            return Q.fromDecimalString(e.val)
        }
        function ce(e) {
            var t = Q.fromDecimalString(e.whole)
                , r = Q.fromDecimalString(e.num)
                , n = Q.fromDecimalString(e.den);
            return Q.add(t, Q.div(r, n))
        }
        function le(e) {
            switch (e.type) {
                case "Decimal":
                    return e.val;
                case "MixedNumber":
                    return e.whole + " " + e.num + "/" + e.den;
                default:
                    throw new Error("Unexpected node type " + e.type)
            }
        }
        function pe(e) {
            switch (e.type) {
                case "Letter":
                case "Decimal":
                case "MixedNumber":
                case "Cmd":
                case "EmptyPiecewise":
                    return !0;
                case "Neg":
                    for (var t = e.args[0]; ; )
                        if ("Pos" === t.type || "Paren" === t.type && !ee(t))
                            t = t.args[0];
                        else {
                            if ("Neg" !== t.type)
                                break;
                            t = t.args[0]
                        }
                    return "Decimal" === t.type || "MixedNumber" === t.type;
                case "Pos":
                case "Paren":
                    return pe(e.args[0]);
                case "Juxt":
                case "Mul":
                case "Div":
                    return pe(e.args[0]) && pe(e.args[1]);
                case "Subscript":
                    return pe(e.args[0]);
                case "Superscript":
                case "Frac":
                case "Add":
                case "Sub":
                    return pe(e.args[0]) && pe(e.args[1]);
                case "Piecewise":
                    return "Equals" === (t = e.args[0]).type || "Inequality" === t.type || "InequalityChain" === t.type;
                case "Call":
                    var r = e.args
                        , n = r[0]
                        , i = r[1];
                    return $.isIdentifier(n) || $.isSuperscriptedIdentifier(n) ? !1 : pe(n) && pe(i);
                case "Derivative":
                case "Sqrt":
                case "Nthroot":
                case "Pipes":
                case "Bang":
                    return !1;
                case "Neg":
                case "Equals":
                case "Inequality":
                case "InequalityChain":
                case "Tilde":
                case "ImplicitCall":
                case "Index":
                case "List":
                case "Seq":
                case "Integral":
                case "EmptyIntegral":
                case "Sum":
                case "Product":
                case "Colon":
                case "Ellipsis":
                case "Dot":
                case "PercentOf":
                case "Prime":
                case "EmptyRangeEnd":
                    return !1;
                default:
                    throw "Unexpected surface node " + e.type + "."
            }
        }
        function fe(e) {
            return "Cmd" === e.type && ("random" === e.val || "shuffle" === e.val)
        }
        function he(e) {
            var t = e.nodes.ExtendSeed("", [e.nodes.Identifier("globalRandomSeed"), e.nodes.Seed(e.nextSeed())]);
            if (!e.seedExtensions)
                return t;
            for (var r = 0, n = e.seedExtensions; r < n.length; r++)
                 var i = n[r]
                     , t = e.nodes.ExtendSeed("ro", [t, i]);
            return t
        }
        function de(e, t) {
            var r = e.seedExtensions || [];
            return n.__assign(n.__assign({}, e), {
                seedExtensions: r.concat(t)
            })
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.lower = void 0,
            t.lower = function(e, t) {
                return n = t,
                    (r = e).setInput(function(e, t) {
                        var r = e.nodes;
                        switch (t.type) {
                            case "Equals":
                                var n = t.args
                                    , i = n[0]
                                    , a = n[1];
                                if ("Call" === i.type) {
                                    var o = i.args
                                        , s = o[0]
                                        , u = o[1]
                                        , c = $.unwrapSeq(u);
                                    if ($.isIdentifier(s) && c.every($.isIdentifier))
                                        return r.FunctionDefinition(te(e, s), J(e, c), te(e, a))
                                } else if ($.isIdentifier(i))
                                    return r.Assignment(te(e, i), te(e, a));
                                return r.Equation(te(e, i), te(e, a));
                            case "Tilde":
                                var l = J(e, t.args)
                                    , i = l[0]
                                    , a = l[1];
                                return r.Regression(i, a);
                            case "Inequality":
                                return se(e, t);
                            case "InequalityChain":
                                if (1 < t.chain.length)
                                    throw Z.inequalityChainTooLong();
                                var p = t.first
                                    , f = p.symbol
                                    , h = p.args
                                    , d = h[0]
                                    , m = h[1]
                                    , g = t.chain[0]
                                    , y = g.symbol
                                    , v = g.args[0];
                                return $.isIdentifier(m) ? r.DoubleInequality([te(e, d), f, te(e, m), y, te(e, v)]) : se(e, t);
                            case "Seq":
                                if (!t.args.every(ee))
                                    throw Z.malformedPoint();
                                return r.List(J(e, t.args));
                            case "Call":
                                var b = t.args
                                    , x = b[0]
                                    , S = b[1];
                                if ("Cmd" === x.type)
                                    switch (x.val) {
                                        case "polygon":
                                            return r.Polygon(J(e, $.unwrapSeq(S)));
                                        case "histogram":
                                            return r.Histogram(J(e, $.unwrapSeq(S)));
                                        case "cube":
                                        case "sphere":
                                        case "cone":
                                        case "dodecahedron":
                                        case "octahedron":
                                        case "tetrahedron":
                                            return r.Object3D(J(e, $.unwrapSeq(S)), x.val);
                                        case "dotplot":
                                            return r.DotPlot(J(e, $.unwrapSeq(S)));
                                        case "boxplot":
                                            return r.BoxPlot(J(e, $.unwrapSeq(S)));
                                        case "ttest":
                                            return r.TTest(J(e, $.unwrapSeq(S)));
                                        case "ittest":
                                            return r.IndependentTTest(J(e, $.unwrapSeq(S)));
                                        case "stats":
                                            return r.Stats(J(e, $.unwrapSeq(S)));
                                        default:
                                            return re(e, t)
                                    }
                                return re(e, t);
                            default:
                                return re(e, t)
                        }
                    }(r, n), n.span);
                var r, n
            }
    });
    _("core/math/baseparser", ["require", "exports", "core/math/errormsg", "parsenodes", "core/math/parser/latex-parser", "core/math/parser/expression-parser", "core/math/parser/lower"], function(e, t, h, d, m, g, y) {
        "use strict";
        function v() {
            throw h.featureUnavailable()
        }
        function b(e, t) {
            return e.setInputSpan(t),
                e
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.parse = void 0,
            t.parse = function(e, t) {
                var r = typeof e;
                if ("string" != r)
                    throw new Error("Type Error: parse can only be called with strings, got " + JSON.stringify(e) + " of type " + r);
                var n = d;
                if ((t = t || {}).disabledFeatures) {
                    n = Object.create(n);
                    for (var i = 0, a = t.disabledFeatures; i < a.length; i++) {
                        var o = a[i];
                        if (!n[o])
                            throw new Error("Programming Error: " + o + " cannot be disabled because it is not a parsenode.");
                        n[o] = v
                    }
                }
                var s = void 0 === t.seedPrefix ? "" : t.seedPrefix
                    , u = 0
                    , c = {
                    nodes: n,
                    currentIndex: t.index,
                    setInput: b,
                    nextSeed: function() {
                        var e = s + "::vc" + u;
                        return u += 1,
                            e
                    }
                }
                    , l = {};
                void 0 !== t.trailingComma && (l.trailingComma = t.trailingComma),
                t.disallowFrac && (l.disallowFrac = !0);
                try {
                    var p = m.parse(e)
                        , f = g.parse(p, l);
                    return y.lower(c, f)
                } catch (e) {
                    return e instanceof d.Error ? e : "string" == typeof e ? d.Error(e) : h.parseError()
                }
            }
    });
    _("core/math/rational-arithmetic-sequence", ["require", "core/math/distance", "core/math/builtin"], function(e) {
        "use strict";
        var o = e("core/math/distance")
            , s = e("core/math/builtin");
        return function(e, t) {
            var r = s.toFraction(e)
                , n = s.toFraction(t);
            if (o.approx(r.n / r.d, e) && o.approx(n.n / n.d, t)) {
                var i = s.lcm(r.d, n.d)
                    , a = r.n * (i / r.d);
                return {
                    nstart: a,
                    nstep: n.n * (i / n.d) - a,
                    lcm: i
                }
            }
        }
    });
    _("core/math/sliders", ["require", "exports"], function(e, t) {
        "use strict";
        function u(e, t) {
            var r = Math.round(1e6 * e) / 1e6;
            return Math.abs(r - e) < t ? r : e
        }
        function s(e) {
            var t, r = e.target, n = e.hardMin, i = e.hardMax, a = e.step, o = 1e-10;
            if (void 0 !== n && void 0 !== i && (o = Math.min(o, Math.abs(i - n) / 1e3)),
            a && (o = Math.min(o, a / 10)),
            void 0 !== n && (n = u(n, o)),
            void 0 !== i && (i = u(i, o)),
            e.forceSliderToMax && void 0 !== i && (r = i),
            i < n)
                return n;
            if (r <= n)
                return n;
            if (i <= r)
                return i;
            a && (t = void 0 !== n ? n : 0,
                r = a * Math.round((r - t) / a) + t);
            var s = u(r, o);
            return !a && n !== s && i !== s || (r = s),
                r <= n ? n : i <= r ? i : r
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.computeSoftMax = t.constrainSliderValueLikeEvaluator = t.determineWhichLimitsAreCompatibleWithValue = t.roundToReasonableDecimal = void 0,
            t.roundToReasonableDecimal = u,
            t.determineWhichLimitsAreCompatibleWithValue = function(e) {
                var t = !0
                    , r = !0
                    , n = !0;
                return void 0 !== e.hardMin && e.target < e.hardMin && (t = !1),
                void 0 !== e.hardMax && e.target > e.hardMax && (r = !1),
                e.step && s({
                    target: e.target,
                    step: e.step,
                    hardMin: t ? e.hardMin : void 0,
                    hardMax: r ? e.hardMax : void 0
                }) !== e.target && (n = !1),
                    {
                        min: t,
                        max: r,
                        step: n
                    }
            }
            ,
            t.constrainSliderValueLikeEvaluator = s,
            t.computeSoftMax = function(e) {
                var t, r = e.storedMax, n = e.sliderValue, i = e.hardMin, a = e.step, o = 10;
                return o < r && (o = r),
                o < n && (o = n),
                o < i && (o = i),
                a && (o = o <= (t = s({
                    target: o,
                    hardMin: i,
                    hardMax: void 0,
                    step: a
                })) ? t : t + a),
                    o
            }
    });
    _("core/math/features/getConcreteTree", ["require", "parsenodes", "core/math/errormsg", "core/math/types", "core/lib/label", "core/math/builtin", "core/math/distance", "core/math/maybe-rational", "core/math/rational-arithmetic-sequence", "core/math/sliders"], function(e) {
        "use strict";
        var f = e("parsenodes")
            , g = e("core/math/errormsg")
            , p = e("core/math/types")
            , o = e("core/lib/label")
            , h = e("core/math/builtin")
            , s = e("core/math/distance")
            , y = e("core/math/maybe-rational")
            , d = y.maybeRational
            , m = e("core/math/rational-arithmetic-sequence")
            , v = f.List
            , c = f.Range
            , n = f.OrderedPair
            , u = f.ScalarExpression
            , b = f.Constant
            , x = f.ExtendSeed
            , l = f.Multiply
            , S = f.Identifier
            , _ = f.DummyIndex
            , E = f.BuiltInFunction
            , M = e("core/math/sliders");
        function D(e, t, r) {
            for (var n = [], i = 0; i < e.length; i++)
                n.push(e[i].getConcreteTree(t, r));
            return n
        }
        function t() {
            return this.getDependencies().concat([this._symbol])
        }
        function w(e, t, r, n) {
            var i = n.length - 1
                , a = e[t];
            if (!a)
                throw g.unexpectedSymbol(".");
            if (a.isError)
                throw a;
            if (!a.isFunction)
                throw g.unexpectedSymbol(".");
            if (!a.allowDotCalls)
                throw g.illegalDotCall(r);
            var o, s = "random" === t, u = "random" === t || "shuffle" === t, c = u ? n[1].valueType : n[0].valueType;
            if ((o = c) !== p.Distribution && !p.isList(o))
                throw g.dotLHSTypeError("." + r, p.prettyPrint(c));
            var l = u ? 1 : 0;
            if (i < a.dotMinArity) {
                if (s)
                    throw g.randomArity();
                throw g.wrongArity("." + r, a.dotMinArity - l, i - l, a.dotMinArityUsageExample)
            }
            if (i > a.dotMaxArity) {
                if (s)
                    throw g.randomArity();
                throw g.wrongArity("." + r, a.dotMaxArity - l, i - l, a.dotMaxArityUsageExample)
            }
        }
        function P(e, t, r, n, i) {
            var a = D(r, n, i);
            return w(i, e, t, a),
                i[e].getConcreteInvocationTree(n, i, a, t)
        }
        function O(e, t) {
            return !e.isError && -1 === t.indexOf(e.valueType) ? g.parseError() : e
        }
        function T(e, t, r) {
            if (t) {
                var n = t.getDependencies();
                if (t.isError)
                    r.errors[e] = !0;
                else if (0 < n.length) {
                    r.errors[e] = !0;
                    for (var i = 0; i < n.length; i++)
                        n[i] === r.exportedSymbol ? r.errors.cycle = !0 : r.missingVars.push(n[i])
                } else
                    r.values[e] = +t.asValue();
                r.valids[e] = isFinite(r.values[e]),
                r.valids[e] || (r.values[e] = void 0)
            } else
                r.valids[e] = !0
        }
        function L(e) {
            return e && e.valueType === p.ListOfNumber && 1 === e.length && e.args ? e.args[0] : e
        }
        function I(e, t, r, n, i, a) {
            if (n < t.length && !s.approx(a, t.elementAt(e, n).asValue(), 10))
                throw g.nonArithmeticRange();
            if (i - n <= r.length && 1 < i - n && !s.approx(a, r.elementAt(e, r.length - i + n).asValue(), 10))
                throw g.nonArithmeticRange()
        }
        function a(e, t) {
            for (var r = !1, n = !1, i = !1, a = 0; a < e.length; a++) {
                var o = e[a];
                (o.isList || o.isBroadcast) && (n = !0,
                0 === o.length && (i = !0));
                for (var s = o.getDependencies(), u = 0; u < s.length; u++)
                    if (-1 !== t.indexOf(s[u])) {
                        if (o.isList || o.isBroadcast)
                            return "list"
                    } else
                        r = !0
            }
            return n ? i ? "empty" : r ? "broadcast" : "list" : "none"
        }
        function C(e) {
            for (var t = [], r = [], n = [], i = 0; i < e.length; i++) {
                var a, o = e[i];
                if (o.isList) {
                    for (var s, u = !1, c = 0; c < n.length; c++)
                        if (o === n[c]) {
                            u = !0,
                                (a = f.DummyIndex(r[c])).valueType = p.elementType(o.valueType),
                                t.push(a);
                            break
                        }
                    u || (s = f.Base.prototype.tmpVar(),
                        r.push(s),
                        n.push(o),
                        (a = f.DummyIndex(s)).valueType = p.elementType(o.valueType),
                        t.push(a))
                } else
                    o.isBroadcast ? (Array.prototype.push.apply(r, o._replacedSymbols),
                        Array.prototype.push.apply(n, o._lists),
                        t.push(o._expression)) : t.push(o)
            }
            return {
                replacedArgs: n,
                concreteArgs: t,
                replacedSymbols: r
            }
        }
        f.Base.prototype.tryGetConcreteTree = function() {
            var t;
            try {
                t = this.getConcreteTree.apply(this, arguments)
            } catch (e) {
                t = e instanceof f.Base ? e : g.parseError()
            }
            return t
        }
            ,
            f.Base.prototype.getConcreteTree = function(e, t, r) {
                if (this.isConcreteTreeCacheValid(t))
                    return this.__cachedConcreteTree.value;
                for (var n = this._getConcreteTree(e, t, r), i = {}, a = this.getCacheKeys().slice(); a.length; ) {
                    var o, s = a.pop();
                    i.hasOwnProperty(s) || (o = t[s],
                    (i[s] = o) && Array.prototype.push.apply(a, o.getCacheKeys()))
                }
                return this.__cachedConcreteTree = {
                    keys: i,
                    value: n
                },
                    n
            }
            ,
            f.Base.prototype.getCacheKeys = function() {
                return this.getDependencies()
            }
            ,
            f.Histogram.prototype.getCacheKeys = t,
            f.Object3D.prototype.getCacheKeys = t,
            f.DotPlot.prototype.getCacheKeys = t,
            f.BoxPlot.prototype.getCacheKeys = t,
            f.TTest.prototype.getCacheKeys = t,
            f.IndependentTTest.prototype.getCacheKeys = t,
            f.Base.prototype.isConcreteTreeCacheValid = function(e) {
                if (!this.__cachedConcreteTree)
                    return !1;
                for (var t in this.__cachedConcreteTree.keys)
                    if (this.__cachedConcreteTree.keys.hasOwnProperty(t) && e[t] !== this.__cachedConcreteTree.keys[t])
                        return !1;
                return !0
            }
            ,
            f.PercentOf.prototype._getConcreteTree = function(e, t) {
                return f.Divide([f.Multiply(this.args), f.Constant(d(100, 1))]).getConcreteTree(e, t)
            }
            ,
            f.Assignment.prototype._getConcreteTree = function(e, t) {
                return this._expression.getConcreteTree(e, t)
            }
            ,
            f.Identifier.prototype._getConcreteTree = function(e, t) {
                var r = o.latexToIdentifier(this.getInputString())
                    , n = t[this._symbol];
                if (n) {
                    if (n.isError)
                        throw n;
                    if (n.isFunction)
                        throw g.identifierAsFunction(r);
                    return n.getConcreteTree(e, t)
                }
                if (E.hasOwnProperty(this._symbol))
                    throw g.functionUnsupported(r);
                return f.FreeVariable(this._symbol)
            }
            ,
            f.Ans.prototype._getConcreteTree = function(e, t) {
                if (void 0 === t[this._symbol])
                    throw g.ansUndefined();
                return S.prototype._getConcreteTree.call(this, e, t)
            }
            ,
            f.Equation.prototype._getConcreteTree = function(e, t) {
                return this.asComparator().getConcreteTree(e, t)
            }
            ,
            f.Constant.prototype._getConcreteTree = function(e, t) {
                return new this.constructor(this._constantValue)
            }
            ,
            f.Seed.prototype._getConcreteTree = function(e, t) {
                return new this.constructor(this._stringValue)
            }
            ,
            f.Derivative.prototype._getConcreteTree = function(e, t) {
                var r;
                if (t[this._symbol]) {
                    var n = Object.create(t);
                    n[this._symbol] = f.FreeVariable(this._symbol);
                    var i = t[this._symbol].getConcreteTree(e, t);
                    if (i.valueType !== p.Number && i.valueType !== p.ListOfNumber)
                        throw g.derivativeVariableTypeError(this._symbol, [p.prettyPrint(i.valueType)]);
                    var a = {};
                    return a[this._symbol] = i,
                        r = this.args[0].getConcreteTree(e, n),
                        this.typeCheck(e, [r]),
                        r.takeDerivative(this._symbol).substitute(a).getConcreteTree(e, t)
                }
                return r = this.args[0].getConcreteTree(e, t),
                    this.typeCheck(e, [r]),
                    r.takeDerivative(this._symbol).getConcreteTree(e, t)
            }
            ,
            f.DoubleInequality.prototype._getConcreteTree = function(e, t) {
                return new this.constructor([f.Piecewise([this._indicator, this._expressions[0], b(NaN)]).getConcreteTree(e, t), this._operators[0], S(this._symbol), this._operators[1], f.Piecewise([this._indicator, this._expressions[1], b(NaN)]).getConcreteTree(e, t)])
            }
            ,
            f.Expression.prototype._getConcreteTree = function(e, t) {
                var r = D(this.args, e, t);
                return this.typeCheck(e, r),
                    this._constantCollapsedCopy(e, r)
            }
            ,
            f.Add.prototype._getConcreteTree = function(e, t) {
                var r = D(this.args, e, t);
                return p.isOneOf(r[0].valueType, [p.Point, p.ListOfPoint]) && p.isOneOf(r[1].valueType, [p.Point, p.ListOfPoint]) ? f.BuiltInFunction.addPoints(this.args).getConcreteTree(e, t) : i.call(this, e, t)
            }
            ,
            f.Subtract.prototype._getConcreteTree = function(e, t) {
                var r = D(this.args, e, t);
                return p.isOneOf(r[0].valueType, [p.Point, p.ListOfPoint]) && p.isOneOf(r[1].valueType, [p.Point, p.ListOfPoint]) ? f.BuiltInFunction.subtractPoints(this.args).getConcreteTree(e, t) : i.call(this, e, t)
            }
            ,
            f.Multiply.prototype._getConcreteTree = function(e, t) {
                var r = D(this.args, e, t);
                return p.isOneOf(r[0].valueType, [p.Point, p.ListOfPoint]) && p.isOneOf(r[1].valueType, [p.Number, p.ListOfNumber]) ? f.BuiltInFunction.multiplyPoint(this.args).getConcreteTree(e, t) : p.isOneOf(r[0].valueType, [p.Number, p.ListOfNumber]) && p.isOneOf(r[1].valueType, [p.Point, p.ListOfPoint]) ? f.BuiltInFunction.multiplyPoint([this.args[1], this.args[0]]).getConcreteTree(e, t) : i.call(this, e, t)
            }
            ,
            f.Divide.prototype._getConcreteTree = function(e, t) {
                var r = D(this.args, e, t);
                return p.isOneOf(r[0].valueType, [p.Point, p.ListOfPoint]) && p.isOneOf(r[1].valueType, [p.Number, p.ListOfNumber]) ? f.BuiltInFunction.dividePoint(this.args).getConcreteTree(e, t) : i.call(this, e, t)
            }
            ,
            f.Negative.prototype._getConcreteTree = function(e, t) {
                var r = D(this.args, e, t);
                return p.isOneOf(r[0].valueType, [p.Point, p.ListOfPoint]) ? f.BuiltInFunction.negatePoint(this.args).getConcreteTree(e, t) : i.call(this, e, t)
            }
            ,
            f.Error.prototype._getConcreteTree = function(e, t) {
                return this
            }
            ,
            f.FreeVariable.prototype._getConcreteTree = function(e, t) {
                return this
            }
            ,
            f.FunctionCall.prototype._getConcreteTree = function(e, t) {
                var r = "logbase" === this._symbol ? "log" : o.latexToIdentifier(this._identifier.getInputString())
                    , n = t[this._symbol];
                if (n && n.isError)
                    throw n;
                if (!n || !n.isFunction) {
                    if (E.hasOwnProperty(this._symbol))
                        throw "logbase" === this._symbol && t.ln && t.log ? g.logbaseUnsupported() : g.functionUnsupported(r);
                    if (n && n.getConcreteTree(e, t).valueType === p.Distribution)
                        throw g.distributionAsFunction(n._symbol);
                    if (1 == this.args.length) {
                        var i = [S(this._symbol), this.args[0]];
                        return l(i).getConcreteTree(e, t)
                    }
                    if (n)
                        throw g.variableAsFunction(r);
                    throw g.functionNotDefined(r)
                }
                var a = D(this.args, e, t);
                return n.getConcreteInvocationTree(e, t, a, r)
            }
            ,
            f.DotAccess.prototype._getConcreteTree = function(e, t) {
                var r, n, i = this.args[0], a = this.args[1];
                if (a instanceof f.Identifier)
                    return n = o.latexToIdentifier(a.getInputString()),
                        r = [i],
                        P(a._symbol, n, r, e, t);
                if (a instanceof f.SeededFunctionCall)
                    return n = o.latexToIdentifier(a._identifier.getInputString()),
                        r = [a.seed, i].concat(a.args.slice(1)),
                        P(a._symbol, n, r, e, t);
                if (a instanceof f.FunctionCall)
                    return "x" === a._symbol && 1 === a.args.length ? f.Multiply([f.OrderedPairAccess([i, f.Constant(1)]), a.args[0]]).getConcreteTree(e, t) : "y" === a._symbol && 1 === a.args.length ? f.Multiply([f.OrderedPairAccess([i, f.Constant(2)]), a.args[0]]).getConcreteTree(e, t) : (n = o.latexToIdentifier(a._identifier.getInputString()),
                        r = [i].concat(a.args),
                        P(a._symbol, n, r, e, t));
                throw g.unexpectedSymbol(".")
            }
            ,
            f.DotAccessExponent.prototype._getConcreteTree = function(e, t) {
                return "FunctionCall" !== this.args[1].type || 1 !== this.args[1].args.length || t[this.args[1]._symbol] && t[this.args[1]._symbol].isFunction ? f.Exponent([f.DotAccess([this.args[0], this.args[1]]), this.args[2]]).getConcreteTree(e, t) : f.Multiply([f.DotAccess([this.args[0], f.Identifier(this.args[1]._symbol)]), f.Exponent([this.args[1].args[0], this.args[2]])]).getConcreteTree(e, t)
            }
            ,
            f.FunctionExponent.prototype._getConcreteTree = function(e, t) {
                var r = this.args[0]._symbol;
                return t[r] && t[r].isFunction ? f.Exponent([f.FunctionCall(r, [this.args[1]]), this.args[2]]).getConcreteTree(e, t) : l([this.args[0], f.Exponent([this.args[1], this.args[2]])]).getConcreteTree(e, t)
            }
            ,
            f.FunctionFactorial.prototype._getConcreteTree = function(e, t) {
                var r = this.args[0]._symbol;
                return t[r] && t[r].isFunction ? f.FunctionCall("\\factorial", [f.FunctionCall(r, [this.args[1]])]).getConcreteTree(e, t) : l([this.args[0], f.FunctionCall("\\factorial", [this.args[1]])]).getConcreteTree(e, t)
            }
            ,
            f.FunctionDefinition.prototype._getConcreteTree = function(e, t) {
                for (var r = 0; r < this._argSymbols.length; r++) {
                    if (t[this._argSymbols[r]])
                        throw g.parameterAlreadyDefined(this._argSymbols[r]);
                    if (this._argSymbols[r] === this._symbol)
                        throw g.parameterAlreadyDefined(this._argSymbols[r])
                }
                return this._expression.getConcreteTree(e, t)
            }
            ,
            f.Image.prototype._getConcreteTree = function(e, t) {
                var r = this.center.tryGetConcreteTree(e, t)
                    , n = this.radianAngle.tryGetConcreteTree(e, t)
                    , i = this.width.tryGetConcreteTree(e, t)
                    , a = this.height.tryGetConcreteTree(e, t)
                    , o = this.opacity.tryGetConcreteTree(e, t)
                    , s = [p.Point, p.ListOfPoint]
                    , u = [p.Number, p.ListOfNumber]
                    , r = O(r, s)
                    , n = O(n, u)
                    , i = O(i, u)
                    , a = O(a, u)
                    , o = O(o, u);
                return f.Image({
                    center: r,
                    radianAngle: n,
                    width: i,
                    height: a,
                    opacity: o
                }, this.moveStrategy)
            }
            ,
            f.Simulation.prototype._getConcreteTree = function(e, t) {
                var r = this.fps.tryGetConcreteTree(e, t);
                return f.Simulation(r)
            }
            ,
            f.Slider.prototype._getConcreteTree = function(e, t) {
                var r, n, i, a, o, s, u, c, l, p = this._expression.getConcreteTree(e, t), f = L(this.sliderMin && this.sliderMin.tryGetConcreteTree(e, t)), h = L(this.sliderMax && this.sliderMax.tryGetConcreteTree(e, t)), d = L(this.sliderStep && this.sliderStep.tryGetConcreteTree(e, t)), m = {
                    exportedSymbol: this._symbol,
                    errors: {},
                    values: {},
                    valids: {},
                    missingVars: [],
                    errMsg: void 0
                };
                return T("min", f, m),
                    T("max", h, m),
                    T("step", d, m),
                d && m.valids.step && (0 === m.values.step ? delete m.values.step : m.values.step = Math.abs(m.values.step)),
                    m.errors.cycle ? p = g.sliderLimitReferencesExport(m.exportedSymbol) : (m.errors.min || !m.valids.min ? m.errMsg = g.sliderMinInvalid() : m.errors.max || !m.valids.max ? m.errMsg = g.sliderMaxInvalid() : !m.errors.step && m.valids.step || (m.errMsg = g.sliderStepInvalid()),
                    m.values.min > m.values.max && (m.valids.min = !1,
                        m.valids.max = !1,
                    m.errMsg || (m.errMsg = g.sliderMaxLessThanMin()))),
                p.isConstant && (r = t.initialEvaluation && t.initialEvaluation.asValue() && this.sliderIsPlayingOnce,
                    n = m.values.max,
                    i = +p.asValue(),
                    a = m.values.min,
                    o = m.values.step,
                !r || isFinite(n) || (s = L(this.sliderSoftMax && this.sliderSoftMax.tryGetConcreteTree(e, t))) && (n = M.computeSoftMax({
                    storedMax: +s.asValue(),
                    sliderValue: i,
                    step: o,
                    hardMin: a
                })),
                    u = M.constrainSliderValueLikeEvaluator({
                        target: i,
                        hardMin: a,
                        hardMax: n,
                        step: o,
                        forceSliderToMax: r
                    }),
                    c = y.fromDecimalString(u.toString()),
                    l = isFinite(y.asFloat(c)) ? c : u,
                    p = b(l)),
                    p.sliderInfo = m,
                    p
            }
            ,
            f.Integral.prototype._getConcreteTree = function(e, t) {
                if (t[this._differential._symbol])
                    throw g.shadowedIntegrationVariable(this._differential._symbol);
                var r = this.args[0]
                    , n = this.args[1].getConcreteTree(e, t)
                    , i = this.args[2].getConcreteTree(e, t);
                if (n.dependsOn(r._symbol) || i.dependsOn(r._symbol))
                    throw g.badIntegralBoundDependency(r._symbol);
                var a = Object.create(t);
                return a[this._differential._symbol] = _(this._differential._symbol),
                    u.prototype._getConcreteTree.call(this, e, a)
            }
            ,
            f.ListAccess.prototype._getConcreteTree = function(e, t) {
                var r, n = this.list.getConcreteTree(e, t);
                if (this.index instanceof c && this.index.isHalfEmpty()) {
                    if (r = c([this.index.beginning, v([b(d(n.length, 1))])]).getConcreteTree(e, t),
                    Math.round(+r.args[0].asValue()) > n.length)
                        return v([])
                } else
                    r = this.index.getConcreteTree(e, t);
                var i = [n, r];
                this.typeCheck(e, i);
                var a = r.getDependencies();
                if (a.length) {
                    if (r.isList)
                        throw g.variableListIndicies(a);
                    if (r.valueType === p.ListOfBool)
                        throw g.variableFilter(a)
                }
                if (r.isList) {
                    if (r.valueType === p.EmptyList)
                        return v([]);
                    var o = []
                        , s = 0;
                    if (r.valueType === p.ListOfNumber) {
                        for (; s < r.length; s++) {
                            var u = r.args[s];
                            o.push(n.elementAt(e, u.asValue() - 1))
                        }
                        return v(o)
                    }
                    if (r.valueType === p.ListOfBool) {
                        for (; s < r.length; s++) {
                            r.args[s]._constantValue && o.push(n.elementAt(e, s))
                        }
                        return v(o)
                    }
                }
                return this._constantCollapsedCopy(e, i)
            }
            ,
            f.List.prototype._getConcreteTree = function(e, t) {
                var r = D(this.args, e, t);
                return this.typeCheck(e, r),
                    new this.constructor(r)
            }
            ,
            f.ParametrizedReducerFunction.prototype._getConcreteTree = function(t, r) {
                if (this.args[0]instanceof f.List && this.args[0].valueType === p.ListOfDistribution)
                    return f.List(f.List.mapArgs(t, [this.args[0]], function(e) {
                        return this.copyWithArgs([e[0], this.args[1]]).getConcreteTree(t, r)
                    }
                    .bind(this)));
                if (this.args[0]instanceof f.Distribution)
                    return this.args[0][this._symbol](this.args.slice(1)).getConcreteTree(t, r);
                var n = D(this.args, t, r);
                switch (a([n[1]], this.getDummyDependencies())) {
                    case "none":
                        return this.typeCheck(t, n),
                            this._constantCollapsedCopy(t, n);
                    case "empty":
                        return f.List([]);
                    case "list":
                        return f.List(f.List.mapArgs(t, [n[1]], function(e) {
                            return e = [n[0]].concat(e),
                                this.typeCheck(t, e),
                                this._constantCollapsedCopy(t, e)
                        }
                        .bind(this)));
                    case "broadcast":
                        var e = C([n[1]])
                            , i = [n[0]].concat(e.concreteArgs);
                        return this.typeCheck(t, i),
                            f.Broadcast(e.replacedSymbols, [this.copyWithArgs(i)].concat(e.replacedArgs))
                }
            }
            ,
            f.Prime.prototype._getConcreteTree = function(e, t) {
                var r = this.args[0]
                    , n = r.args[0];
                if (!t[r._symbol])
                    throw g.functionNotDefined(r._symbol);
                var i, a = this.tmpVar();
                if ("logbase" === r._symbol) {
                    if (2 !== r.args.length)
                        throw g.primedFunctionArity();
                    i = [S(a), r.args[1]]
                } else {
                    if (1 !== r.args.length)
                        throw g.primedFunctionArity();
                    i = [S(a)]
                }
                for (var o = r.copyWithArgs(i).getConcreteTree(e, t), s = 0; s < this.order; s++)
                    o = o.takeDerivative(a);
                var u = {};
                return u[a] = n,
                    o.substitute(u).getConcreteTree(e, t)
            }
            ,
            f.Range.prototype._getConcreteTree = function(e, t) {
                var r = this.beginning.getConcreteTree(e, t)
                    , n = this.end.getConcreteTree(e, t);
                if (r.getDependencies().length)
                    throw g.variableRange(r.getDependencies());
                if (n.getDependencies().length)
                    throw g.variableRange(n.getDependencies());
                if (!r.isList || !n.isList)
                    throw new Error("Programming Error: range bounds must be List nodes.");
                var i, a, o, s = r.elementAt(e, 0).asValue(), u = n.elementAt(e, n.length - 1).asValue() - s;
                o = 1 === r.length ? 0 <= u ? 1 : -1 : (i = r.elementAt(e, 1).asValue(),
                    a = m(s, i),
                r.elementAt(e, 1).asValue() - s);
                var c = Math.round(u / o) + 1;
                if (!isFinite(c) || c < r.length || c < n.length)
                    throw g.nonArithmeticRange();
                var l, p = [];
                if (a)
                    for (var f = a.nstart, h = 0; h < c; h++)
                        I(e, r, n, h, c, f / a.lcm),
                            p.push(b(d(f, a.lcm))),
                            f += a.nstep;
                else
                    for (p.push(b(s)),
                             h = 1; h < c; h++)
                        I(e, r, n, h, c, l = s + h * o),
                            p.push(b(d(l, 1)));
                return v(p)
            }
            ,
            f.ReducerFunction.prototype._getConcreteTree = function(t, r) {
                if (this.args[0]instanceof f.List && this.args[0].valueType === p.ListOfDistribution && "length" !== this._symbol)
                    return f.List(f.List.mapArgs(t, this.args, function(e) {
                        return this.copyWithArgs(e).getConcreteTree(t, r)
                    }
                    .bind(this)));
                if (this.args[0]instanceof f.Distribution && "length" !== this._symbol)
                    return this.args[0][this._symbol]().getConcreteTree(t, r);
                var e = D(this.args, t, r);
                if (1 === this.args.length)
                    return e = [f.List.wrap(e[0])],
                        this.typeCheck(t, e),
                        this._constantCollapsedCopy(t, e);
                switch (a(e, this.getDummyDependencies())) {
                    case "none":
                        return e = [f.List(e)],
                            this.typeCheck(t, e),
                            this._constantCollapsedCopy(t, e);
                    case "empty":
                        return f.List([]);
                    case "list":
                        return f.List(f.List.mapArgs(t, e, function(e) {
                            return e = [f.List(e)],
                                this.typeCheck(t, e),
                                this._constantCollapsedCopy(t, e)
                        }
                        .bind(this)));
                    case "broadcast":
                        var n = C(e)
                            , e = [f.List(n.concreteArgs)];
                        return this.typeCheck(t, e),
                            f.Broadcast(n.replacedSymbols, [this.copyWithArgs(e)].concat(n.replacedArgs))
                }
            }
            ,
            f.RepeatedOperator.prototype._getConcreteTree = function(e, t) {
                if (t[this._index._symbol])
                    throw g.shadowedIndex(this._index._symbol);
                var r = this.args[1].getConcreteTree(e, t)
                    , n = this.args[2].getConcreteTree(e, t);
                if (r.dependsOn(this._index._symbol) || n.dependsOn(this._index._symbol))
                    throw this instanceof f.Sum ? g.badSumBoundDependency(this._index._symbol) : this instanceof f.Product ? g.badProductBoundDependency(this._index._symbol) : g.parseError();
                var i = Object.create(t);
                return i[this._index._symbol] = _(this._index._symbol),
                    u.prototype._getConcreteTree.call(this, e, i)
            }
        ;
        var i = function(t, e) {
            var r = D(this.args, t, e);
            switch (a(r, this.getDummyDependencies())) {
                case "none":
                    return this.typeCheck(t, r),
                        this._constantCollapsedCopy(t, r);
                case "empty":
                    return f.List([]);
                case "list":
                    return f.List(f.List.mapArgs(t, r, function(e) {
                        return this.typeCheck(t, e),
                            this._constantCollapsedCopy(t, e)
                    }
                    .bind(this)));
                case "broadcast":
                    var n = C(r);
                    return this.typeCheck(t, n.concreteArgs),
                        f.Broadcast(n.replacedSymbols, [this.copyWithArgs(n.concreteArgs)].concat(n.replacedArgs))
            }
        };
        function r(t, r) {
            if (!r[this._symbol])
                throw g.functionUnsupported(this._symbol);
            var e = this.args.map(function(e) {
                return e.getConcreteTree(t, r)
            });
            if (0 < e.length) {
                if (1 === e.length && e.push(f.Constant(1)),
                    e[1].getDependencies().length)
                    throw g.illegalBinWidth(this._symbol).setDependencies(e[1].getDependencies());
                if (e[1].valueType !== p.Number)
                    throw g.illegalBinWidth(this._symbol);
                var n = e[1].asValue();
                if (!isFinite(n) || n <= 0)
                    throw g.illegalBinWidth(this._symbol)
            }
            return this.typeCheck(t, e),
                new this.constructor(e)
        }
        f.ScalarExpression.prototype._getConcreteTree = i,
            f.Object3D.prototype._getConcreteTree = i,
            f.Piecewise.prototype._getConcreteTree = function(e, t) {
                var r = D(this.args, e, t)
                    , n = r[0];
                if (n.isConstant && n.valueType === p.Bool && r[1].valueType === r[2].valueType)
                    return n.asValue() ? r[1] : r[2];
                if (n.valueType === p.Bool && p.isList(r[1].valueType) && p.isList(r[2].valueType) && r[1].length !== r[2].length)
                    throw g.piecewiseBranchLengthError(n.getDependencies()[0]);
                return i.call(this, e, t)
            }
            ,
            f.Regression.prototype._getConcreteTree = function(e, t) {
                return new this.constructor(this._lhs,this._rhs)
            }
            ,
            f.Polygon.prototype._getConcreteTree = function(t, r) {
                var e = this.args.map(function(e) {
                    return e.getConcreteTree(t, r)
                });
                return this.typeCheck(t, e),
                    1 === e.length && e[0].valueType === p.ListOfPoint ? new this.constructor(e) : e.every(function(e) {
                        return e.valueType === p.Point
                    }) ? new this.constructor([v(e)]) : 2 === e.length ? new this.constructor([n(this.args).getConcreteTree(t, r)]) : g.parseError()
            }
            ,
            f.Histogram.prototype._getConcreteTree = r,
            f.DotPlot.prototype._getConcreteTree = r,
            f.BoxPlot.prototype._getConcreteTree = function(t, r) {
                if (!r[this._symbol])
                    throw g.functionUnsupported(this._symbol);
                var e = this.args.map(function(e) {
                    return e.getConcreteTree(t, r)
                });
                return this.typeCheck(t, e),
                    1 !== e.length || e[0].valueType !== p.ListOfNumber && e[0].valueType !== p.EmptyList ? g.parseError() : new this.constructor(e)
            }
            ,
            f.TTest.prototype._getConcreteTree = function(t, r) {
                if (!r[this._symbol])
                    throw g.functionUnsupported(this._symbol);
                var e = this.args.map(function(e) {
                    return e.getConcreteTree(t, r)
                });
                return this.typeCheck(t, e),
                    new this.constructor(e)
            }
            ,
            f.IndependentTTest.prototype._getConcreteTree = function(t, r) {
                if (!r[this._symbol])
                    throw g.functionUnsupported(this._symbol);
                var e = this.args.map(function(e) {
                    return e.getConcreteTree(t, r)
                });
                return this.typeCheck(t, e),
                    new this.constructor(e)
            }
            ,
            f.SolvedEquation.prototype._getConcreteTree = function(e, t) {
                return new this.constructor(this._symbol,this._expression.getConcreteTree(e, t))
            }
            ,
            f.Table.prototype._getConcreteTree = function(e, t) {
                for (var r = [], n = Object.create(t), i = 0; i < this.columns.length; i++) {
                    var a = this.columns[i].getConcreteTree(e, n, t);
                    a.isIndependent && this.columns[i].exportToLocal(a, n),
                        r.push(a)
                }
                return new this.constructor(r)
            }
            ,
            f.TableColumn.prototype._getConcreteTree = function(e, t, r) {
                var n, i, a = this.header.getConcreteTree(e, t);
                if (a.isFreeVariable) {
                    n = [];
                    for (var o, s = 0; s < this.values.length; s++) {
                        this.values[s].tableError() ? n.push(g.invalidTableEntry(this.values[s].tableError())) : (o = this.values[s].tryGetConcreteTree(e, t)).isError ? n.push(o) : o.tableError() ? n.push(g.invalidTableEntry(o.tableError())) : o.valueType === p.Number ? n.push(o) : n.push(g.tableEntryTypeError([p.prettyPrint(o.valueType)]))
                    }
                    return (i = new this.constructor(a,this.length,n)).isIndependent = !0,
                        i
                }
                if (a.isConstant) {
                    for (var u = [], c = 0; c < this.length; c++)
                        u.push(a);
                    n = u
                } else
                    n = a.isList ? a.args.slice() : [];
                return (a = this.header.getConcreteTree(e, r)).isError || a.valueType === p.Number || a.valueType === p.ListOfNumber || a.valueType === p.EmptyList || (a = g.tableHeaderTypeError([p.prettyPrint(a.valueType)])),
                    i = new this.constructor(a,this.length,n)
            }
            ,
            f.BuiltInFunction.pdf.prototype._getConcreteTree = function(t, r) {
                if (this.args[0]instanceof v)
                    return f.List(f.List.mapArgs(t, this.args, function(e) {
                        return this.copyWithArgs(e).getConcreteTree(t, r)
                    }
                    .bind(this)));
                if (this.typeCheck(t, this.args),
                    !(this.args[0]instanceof f.Distribution))
                    throw g.functionTypeError(this._symbol, [p.prettyPrint(this.args[0].valueType)]);
                return this.args[0].pdf([this.args[1]]).getConcreteTree(t, r)
            }
            ,
            f.BuiltInFunction.cdf.prototype._getConcreteTree = function(t, r) {
                var e = this.args;
                if (2 === e.length && (e = [e[0], f.Constant(-1 / 0), e[1]]),
                e[0]instanceof f.List)
                    return f.List(f.List.mapArgs(t, e, function(e) {
                        return this.copyWithArgs(e).getConcreteTree(t, r)
                    }
                    .bind(this)));
                if (this.typeCheck(t, e),
                    !(e[0]instanceof f.Distribution))
                    throw g.functionTypeError(this._symbol, [p.prettyPrint(e[0].valueType)]);
                return e[0].cdf(e.slice(1)).getConcreteTree(t, r)
            }
            ,
            f.BuiltInFunction.random.prototype._getConcreteTree = function(e, t) {
                var r = this.args;
                (r.length <= 1 || !(r[1]instanceof f.Distribution) && !(r[1]instanceof f.List) && r.length < 4) && (r = [r[0], E.uniformdist([])].concat(r.slice(1)));
                var n = r[0]
                    , i = r[1]
                    , a = r[2]
                    , o = r[3];
                if (this.typeCheck(e, r.slice(1)),
                a && a.getDependencies().length)
                    throw g.variableSampleSize(a.getDependencies());
                if (o && o.getDependencies().length)
                    throw g.variableSeed(o.getDependencies());
                if (o && (n = x("us", [n, o])),
                    a) {
                    var s = a.asValue();
                    if (s < 1)
                        throw g.badSampleSize();
                    s = Math.round(s);
                    for (var u, c = [], l = 0; l < s; l++)
                        u = x("lc", [n, b(d(l, 1))]),
                            c.push(i.sample([u]).getConcreteTree(e, t));
                    return v(c)
                }
                return i.sample([n]).getConcreteTree(e, t)
            }
            ,
            f.BuiltInFunction.shuffle.prototype._getConcreteTree = function(e, t) {
                var r = this.args;
                this.typeCheck(e, r.slice(1));
                var n, i = r[0], a = r[1], o = r[2];
                if (o && o.getDependencies().length)
                    throw g.variableSeed(o.getDependencies());
                if (o && (i = x("us", [i, o])),
                "List" === a.type)
                    return n = a.args.slice(),
                        h.shuffle(i.asValue(), n),
                        v(n);
                if ("Broadcast" !== a.type)
                    throw g.parseError();
                for (var s = a, u = [s._expression], c = h.randomPerm(i.asValue(), s.length), l = 0; l < s._lists.length; l++) {
                    n = [];
                    for (var p = 0; p < c.length; p++)
                        n.push(s._lists[l].args[c[p]]);
                    u.push(f.List(n))
                }
                return s.copyWithArgs(u)
            }
            ,
            f.BuiltInFunction.sort.prototype._getConcreteTree = function(e, t) {
                var r = this.args;
                if (1 === r.length && (r = r.concat(r[0])),
                    this.typeCheck(e, r),
                0 !== r[1].getDependencies().length)
                    throw g.functionFreeVariable(this._errorSymbol, r[1].getDependencies()[0]);
                if ("List" !== r[1].type)
                    throw g.parseError();
                var n, i = r[1].asValue(), a = h.sortPerm(i);
                if ("List" === r[0].type) {
                    for (n = [],
                             c = 0; c < Math.min(a.length, r[0].args.length); c++)
                        n.push(r[0].args[a[c]]);
                    return f.List(n)
                }
                if ("Broadcast" !== r[0].type)
                    throw g.parseError();
                for (var o = [r[0]._expression], s = 0; s < r[0]._lists.length; s++) {
                    n = [];
                    for (var u = r[0]._lists[s].args, c = 0; c < Math.min(a.length, u.length); c++)
                        n.push(u[a[c]]);
                    o.push(f.List(n))
                }
                return r[0].copyWithArgs(o)
            }
            ,
            f.BuiltInFunction.join.prototype._getConcreteTree = function(e, t) {
                var r = this.args;
                this.typeCheck(e, r);
                for (var n = [], i = 0; i < r.length; i++) {
                    var a = r[i];
                    if ("Broadcast" === a.type && (a = a.asList(e)),
                    "List" === a.type)
                        for (var o = 0; o < a.args.length; o++)
                            n.push(a.args[o]);
                    else
                        n.push(a)
                }
                return f.List(n)
            }
    });
    _("core/math/features/getValueType", ["require", "parsenodes", "core/math/types"], function(e) {
        "use strict";
        var t = e("parsenodes")
            , n = e("core/math/types");
        function r() {
            return n.Number
        }
        function i() {
            return n.Bool
        }
        function a(e) {
            for (var t = 0; t < e.length; t++)
                if (e[t].valueType === n.Point)
                    return n.Point;
            return n.Number
        }
        var o = {
            Add: a,
            Multiply: a,
            Divide: a,
            Subtract: a,
            Exponent: r,
            Negative: a,
            And: i,
            Piecewise: function(e) {
                return e[1].valueType
            },
            BaseComparator: i,
            RepeatedOperator: r,
            List: function(e) {
                if (0 === e.length)
                    return n.EmptyList;
                for (var t = e[0].valueType, r = 1; r < e.length; r++)
                    if (e[r].valueType !== t)
                        return n.ListOfAny;
                return n.hasListType(t) ? n.listType(t) : n.ListOfAny
            },
            ListAccess: function(e) {
                return n.elementType(e[0].valueType)
            },
            Broadcast: function(e) {
                return n.listType(e[0].valueType)
            },
            Seed: function(e) {
                return n.SeedType
            },
            ExtendSeed: function(e) {
                return n.SeedType
            },
            OrderedPairAccess: r,
            OrderedPair: function() {
                return n.Point
            },
            RGBColor: function() {
                return n.RGBColor
            },
            NativeFunction: r,
            ReducerFunction: r,
            DoubleReducerFunction: r,
            ParametrizedReducerFunction: r,
            Distribution: function() {
                return n.Distribution
            },
            DummyIndex: r,
            FreeVariable: r,
            TypedFunction: function() {
                return this._outputType
            },
            Derivative: r,
            Integral: r,
            Identifier: function() {
                return n.Any
            }
        };
        for (var s in o)
            t[s].prototype._getValueType = o[s]
    });
    _("core/math/features/typeCheck", ["require", "parsenodes", "core/math/types", "core/math/errormsg"], function(e) {
        "use strict";
        var o = e("parsenodes")
            , s = e("core/math/types")
            , l = e("core/math/errormsg")
            , p = s.isOneOf;
        function f(e) {
            for (var t = [], r = 0; r < e.length; r++)
                t.push(s.prettyPrint(e[r].valueType));
            return t
        }
        function t(n, i) {
            return function(e, t) {
                for (var r = 0; r < t.length; r++)
                    if (t[r].valueType !== n[r])
                        throw i(f(t))
            }
        }
        function r(e, t) {
            var r = t.length
                , n = t[0];
            if (r < 2)
                throw l.methodRequiresList(this._symbol);
            if (!p(n.valueType, [s.ListOfNumber, s.EmptyList]))
                throw l.methodRequiresList(this._symbol);
            if (2 < r)
                throw l.tooManyArguments(this._symbol, 2)
        }
        var n = {
            Add: t([s.Number, s.Number], l.addTypeError),
            Multiply: t([s.Number, s.Number], l.multiplyTypeError),
            Divide: t([s.Number, s.Number], l.divideTypeError),
            Subtract: t([s.Number, s.Number], l.subtractTypeError),
            Exponent: t([s.Number, s.Number], l.exponentTypeError),
            Negative: t([s.Number], l.negativeTypeError),
            BaseComparator: t([s.Number, s.Number], l.comparatorTypeError),
            And: t([s.Bool, s.Bool], l.andTypeError),
            ExtendSeed: function(e, t) {
                if (2 !== t.length || t[0].valueType !== s.SeedType || !p(t[1].valueType, [s.SeedType, s.Number]))
                    throw l.functionUnsupported("random")
            },
            List: function(e, t) {
                if (0 !== t.length) {
                    var r = t[0].valueType;
                    if (!s.hasListType(r))
                        throw l.listTypeError([s.prettyPrint(r)]);
                    for (var n = 0; n < t.length; n++) {
                        var i = t[n].valueType;
                        if (!s.hasListType(i))
                            throw l.listTypeError([s.prettyPrint(i)]);
                        if (i !== r)
                            throw l.heterogeneousList()
                    }
                }
            },
            Broadcast: function(e, t) {},
            Distribution: function(e, t) {},
            RGBColor: function(e, t) {},
            OrderedPair: function(e, t) {
                if (0 === t.length)
                    throw l.emptyParen();
                if (e.dimensions && t.length !== e.dimensions())
                    throw l.badTupleDimensions(e.dimensions());
                for (var r = 0; r < t.length; r++) {
                    var n = t[r].valueType;
                    if (n !== s.Number)
                        throw l.pointTypeError(s.prettyPrint(n))
                }
            },
            Piecewise: function(e, t) {
                if (t[0].valueType !== s.Bool)
                    throw l.piecewiseConditionTypeError(f(t));
                if (t[1].valueType !== t[2].valueType)
                    throw l.piecewiseBranchTypeError([s.prettyPrint(t[1].valueType), s.prettyPrint(t[2].valueType)])
            },
            ListAccess: function(e, t) {
                var r = s.isList(t[0].valueType)
                    , n = t[1].valueType
                    , i = n === s.EmptyList || n === s.Number || n === s.ListOfNumber || n === s.ListOfBool;
                if (!r || !i)
                    throw l.indexTypeError(f(t))
            },
            OrderedPairAccess: t([s.Point, s.Number], l.orderedPairAccessTypeError),
            Sum: function(e, t) {
                if (t[1].valueType !== s.Number)
                    throw l.sumLowerBoundTypeError([s.prettyPrint(t[1].valueType)]);
                if (t[2].valueType !== s.Number)
                    throw l.sumUpperBoundTypeError([s.prettyPrint(t[2].valueType)]);
                if (t[3].valueType !== s.Number)
                    throw l.sumArgumentTypeError([s.prettyPrint(t[3].valueType)])
            },
            Product: function(e, t) {
                if (t[1].valueType !== s.Number)
                    throw l.productLowerBoundTypeError([s.prettyPrint(t[1].valueType)]);
                if (t[2].valueType !== s.Number)
                    throw l.productUpperBoundTypeError([s.prettyPrint(t[2].valueType)]);
                if (t[3].valueType !== s.Number)
                    throw l.productArgumentTypeError([s.prettyPrint(t[3].valueType)])
            },
            Integral: function(e, t) {
                if (t[1].valueType !== s.Number)
                    throw l.integralLowerBoundTypeError([s.prettyPrint(t[1].valueType)]);
                if (t[2].valueType !== s.Number)
                    throw l.integralUpperBoundTypeError([s.prettyPrint(t[2].valueType)]);
                if (t[3].valueType !== s.Number)
                    throw l.integralArgumentTypeError([s.prettyPrint(t[3].valueType)])
            },
            NativeFunction: function(e, t) {
                var r = this._errorSymbol
                    , n = t.length
                    , i = "logbase" === this._symbol ? 1 : 0;
                if (n < this._requiredArity)
                    throw l.wrongArity(r, this._requiredArity - i, n - i);
                if (n > this._maxArity)
                    throw l.wrongArity(r, this._maxArity - i, n - i);
                for (var a = 0; a < t.length; a++) {
                    if (t[a].valueType !== s.Number)
                        throw l.functionTypeError(r, f(t))
                }
            },
            ReducerFunction: function(e, t) {
                if (!p(t[0].valueType, [s.ListOfNumber, s.EmptyList]))
                    throw l.functionTypeError(this._symbol, f(t))
            },
            DoubleReducerFunction: function(e, t) {
                var r = t[0]
                    , n = t[1];
                if (!s.isList(r.valueType) || !s.isList(n.valueType))
                    throw l.nonListDoubleReducer(this._symbol);
                if (!p(r.valueType, [s.ListOfNumber, s.EmptyList]) || !p(n.valueType, [s.ListOfNumber, s.EmptyList]))
                    throw l.functionTypeError(this._symbol, f(t))
            },
            ParametrizedReducerFunction: function(e, t) {
                if (!p(t[0].valueType, [s.ListOfNumber, s.EmptyList]))
                    throw l.nonListParametrizedReducer(this._symbol);
                if (t[1].valueType !== s.Number)
                    throw l.functionTypeError(this._symbol, f(t))
            },
            TypedFunction: function(e, t) {
                var r = this._errorSymbol
                    , n = t.length
                    , i = "pdf" === this._symbol
                    , a = "cdf" === this._symbol;
                if (n < this._requiredArity) {
                    if (i)
                        throw l.pdfWrongArity();
                    if (a)
                        throw l.cdfRequiresArguments();
                    throw l.wrongArity(r, this._requiredArity, n)
                }
                if (n > this._maxArity) {
                    if (i)
                        throw l.pdfWrongArity();
                    if (a)
                        throw l.cdfTooManyArguments();
                    throw l.wrongArity(r, this._maxArity, n)
                }
                for (var o = 0; o < t.length; o++) {
                    var s = t[o].valueType
                        , u = this._inputTypes[o]
                        , c = Array.isArray(u);
                    if (!c && s !== u || c && !p(s, u))
                        throw l.functionTypeError(r, f(t))
                }
            },
            Derivative: function(e, t) {
                if (!p(t[0].valueType, [s.Number, s.ListOfNumber, s.EmptyList, s.Point, s.ListOfPoint]))
                    throw l.derivativeTypeError(f(t))
            },
            Regression: function(e, t) {
                if (!p(t[0].valueType, [s.Number, s.ListOfNumber]) || !p(t[1].valueType, [s.Number, s.ListOfNumber]))
                    throw l.regressionTypeError(f(t))
            },
            Polygon: function(e, t) {
                if (1 === t.length && t[0].valueType !== s.ListOfPoint)
                    throw l.polygonListTypeError(f(t));
                if (2 === t.length && t[0].valueType === s.Number && t[1].valueType === s.Number)
                    throw l.polygonTwoNumbersError();
                if (2 < t.length && !t.every(function(e) {
                    return e.valueType === s.Point
                }))
                    throw l.polygonPointArgsError()
            },
            Object3D: function(e, t) {
                if (t.length < 3)
                    throw l.wrongArity(this._symbol, 3, t.length)
            },
            Histogram: r,
            DotPlot: r,
            BoxPlot: function(e, t) {
                var r = t.length
                    , n = t[0];
                if (0 === r)
                    throw l.methodRequiresList(this._symbol);
                if (!p(n.valueType, [s.ListOfNumber, s.EmptyList]))
                    throw l.methodRequiresList(this._symbol);
                if (1 < r)
                    throw l.methodRequiresList(this._symbol)
            },
            TTest: function(e, t) {
                var r = this._symbol;
                if (0 === t.length)
                    throw l.methodRequiresList(r);
                if (t[0].valueType === s.EmptyList)
                    throw l.ttestListTooShort(r);
                if (t[0].valueType !== s.ListOfNumber)
                    throw l.methodRequiresList(r);
                if (2 < t.length)
                    throw l.tooManyArguments(r, 2);
                if (t[0].length < 2)
                    throw l.ttestListTooShort(r);
                if (t[1] && t[1].valueType !== s.Number)
                    throw l.functionTypeError(r, f(t))
            },
            IndependentTTest: function(e, t) {
                var r = this._symbol;
                if (2 !== t.length)
                    throw l.wrongDoubleReducerArity(r);
                if (!s.isList(t[0].valueType) || !s.isList(t[1].valueType))
                    throw l.nonListDoubleReducer(r);
                if (t[0].valueType === s.EmptyList || t[1].valueType === s.EmptyList)
                    throw l.ttestListTooShort("ittest");
                if (t[0].valueType !== s.ListOfNumber || t[1].valueType !== s.ListOfNumber)
                    throw l.functionTypeError(r, f(t));
                if (t[0].args.length < 2 || t[1].args.length < 2)
                    throw l.ttestListTooShort("ittest")
            },
            Stats: function(e, t) {
                var r = t.length
                    , n = t[0];
                if (0 === r)
                    throw l.methodRequiresList(this._symbol);
                if (n.valueType === s.EmptyList)
                    throw l.functionTypeError(this._symbol, f(t));
                if (n.valueType !== s.ListOfNumber)
                    throw l.methodRequiresList(this._symbol);
                if (1 < r)
                    throw l.methodRequiresList(this._symbol)
            }
        };
        for (var i in n)
            o[i].prototype.typeCheck = n[i];
        o.BuiltInFunction.random.prototype.typeCheck = function(e, t) {
            var r = t.length
                , n = t[0]
                , i = t[1]
                , a = t[2];
            if (3 < r)
                throw l.randomArity();
            if (!n)
                throw l.randomArity();
            if (!(n instanceof o.Distribution || n instanceof o.List))
                throw l.randomArity();
            if (n instanceof o.Distribution && n.args && (n.args[0]instanceof o.List || n.args[1]instanceof o.List))
                throw l.randomFromBroadcastDistribution();
            if (i && i.valueType !== s.Number)
                throw l.randomArity();
            if (a && a.valueType !== s.Number)
                throw l.randomArity()
        }
            ,
            o.BuiltInFunction.shuffle.prototype.typeCheck = function(e, t) {
                var r = t.length;
                if (r < 1)
                    throw l.wrongArity(this._errorSymbol, 1, r, this.minArityUsageExample);
                if (2 < r)
                    throw l.wrongArity(this._errorSymbol, 2, r, this.maxArityUsageExample);
                if (!s.isList(t[0].valueType) || 2 === r && t[1].valueType !== s.Number)
                    throw l.functionTypeError(this._errorSymbol, f(t))
            }
            ,
            o.BuiltInFunction.length.prototype.typeCheck = function(e, t) {
                if (1 !== t.length || !s.isList(t[0].valueType))
                    throw l.parseError()
            }
            ,
            o.BuiltInFunction.sort.prototype.typeCheck = function(e, t) {
                var r = t.length;
                if (r < 1)
                    throw l.wrongArity(this._errorSymbol, 1, r, this.minArityUsageExample);
                if (2 < r)
                    throw l.wrongArity(this._errorSymbol, 2, r, this.maxArityUsageExample);
                if (!s.isList(t[0].valueType) || !p(t[1].valueType, [s.ListOfNumber, s.EmptyList]))
                    throw l.functionTypeError(this._errorSymbol, f(t))
            }
            ,
            o.BuiltInFunction.join.prototype.typeCheck = function(e, t) {
                var r = t.length;
                if (r < this._requiredArity)
                    throw l.wrongArity(this._errorSymbol, this._requiredArity, r, this.minArityUsageExample);
                var n = t[0].valueType;
                s.isList(n) || (n = s.listType(n));
                for (var i = 1; i < t.length; i++) {
                    var a = t[i].valueType;
                    if (s.isList(a) || (a = s.listType(a)),
                    a !== s.EmptyList && (n === s.EmptyList && (n = a),
                    a !== n))
                        throw l.functionTypeError(this._errorSymbol, f(t))
                }
            }
    });
    _("core/math/features/repr", ["require", "parsenodes"], function(e) {
        "use strict";
        function r(e, t, r) {
            r = r || 0;
            var n = Array(r + 1).join("  ")
                , i = n + "  ";
            return "[\n" + i + e.map(function(e) {
                return e.repr(t, r + 1)
            }).join(",\n" + i) + "\n" + n + "]"
        }
        function i(e, t) {
            return "" + (t = t || "") + e
        }
        var n = e("parsenodes");
        n.Expression.prototype.repr = function(e, t) {
            return i(this.type, e) + "(" + r(this.args, e, t) + ")"
        }
            ,
            n.DoubleInequality.prototype.repr = function(e, t) {
                t = t || 0;
                var r = Array(t + 1).join("  ")
                    , n = r + "  ";
                return i(this.type, e) + "([\n" + n + this.args[0].repr(e, t + 1) + ",\n" + n + "'" + this.args[1] + "',\n" + n + this.args[2].repr(e, t + 1) + ",\n" + n + "'" + this.args[3] + "',\n" + n + this.args[4].repr(e, t + 1) + "\n" + r + "])"
            }
            ,
            n.Identifier.prototype.repr = n.FreeVariable.prototype.repr = function(e) {
                return i(this.type, e) + "('" + this._symbol + "')"
            }
            ,
            n.Constant.prototype.repr = function(e) {
                return i(this.type, e) + "(" + this.asValue() + ")"
            }
            ,
            n.ExtendSeed.prototype.repr = function(e, t) {
                return i(this.type, e) + "('" + this.tag + "', " + r(this.args, e, t) + ")"
            }
            ,
            n.Seed.prototype.repr = function(e) {
                return i(this.type, e) + "(" + this.asValue() + ")"
            }
            ,
            n.FunctionCall.prototype.repr = function(e, t) {
                return i(this.type, e) + "('" + this._symbol + "', " + r(this.args, e, t) + ")"
            }
            ,
            n.Assignment.prototype.repr = function(e, t) {
                return i(this.type, e) + "(" + n.Identifier(this._symbol).repr(e, t) + ", " + this._expression.repr(e, t) + ")"
            }
            ,
            n.Regression.prototype.repr = n.Equation.prototype.repr = function(e, t) {
                return i(this.type, e) + "(" + this._lhs.repr(e, t) + ", " + this._rhs.repr(e, t) + ")"
            }
            ,
            n.FunctionDefinition.prototype.repr = function(e, t) {
                return i(this.type, e) + "(" + n.Identifier(this._symbol).repr(e, t) + ", " + r(this._argSymbols.map(function(e) {
                    return n.Identifier(e)
                }), e, t) + ", " + this._expression.repr(e, t) + ")"
            }
            ,
            n.Error.prototype.repr = function(e, t) {
                return i(this.type, e) + "('" + this._msg + "')"
            }
            ,
            n.Derivative.prototype.repr = function(e, t) {
                return i(this.type, e) + "('" + this._symbol + "', " + r(this.args, e, t) + ")"
            }
            ,
            n.SolvedEquation.prototype.repr = function(e, t) {
                return i(this.type, e) + "('" + this._symbol + "', " + this._expression.repr(e, t) + ")"
            }
            ,
            n.OptimizedRegression.prototype.repr = function(e, t) {
                return i(this.type, e) + "(" + JSON.stringify(this.parameters) + ", " + JSON.stringify(this.residuals) + ", " + JSON.stringify(this.statistics) + ", " + this.model.repr(e, t + 1) + ", " + JSON.stringify({
                    isModelValid: this.isModelValid,
                    residualVariable: this.residualVariable,
                    residualSuggestionId: this.residualSuggestionId,
                    shouldSuggestLogMode: this.shouldSuggestLogMode,
                    isLinear: this.isLinear,
                    parameterWarning: this.parameterWarning
                }) + ")"
            }
            ,
            n.Table.prototype.repr = function(e, t) {
                return i(this.type, e) + "(" + r(this.columns, e, t) + ")"
            }
            ,
            n.TableColumn.prototype.repr = function(e, t) {
                return i(this.type, e) + "(" + this.header.repr(e, t) + ", " + this.length + ", " + r(this.values, e, t) + ")"
            }
            ,
            n.Image.prototype.repr = function(e, t) {
                var r = Array(t + 1).join("  ")
                    , n = r + "  ";
                return i(this.type, e) + "({\n" + n + "center: " + this.center.repr(e, t + 1) + ",\n" + n + "radianAngle: " + this.radianAngle.repr(e, t + 1) + ",\n" + n + "width: " + this.width.repr(e, t + 1) + ",\n" + n + "height: " + this.height.repr(e, t + 1) + "},\n" + n + "opacity: " + this.opacity.repr(e, t + 1) + ",\n" + n + JSON.stringify(this.moveStrategy) + "\n" + r + ")"
            }
            ,
            n.Simulation.prototype.repr = function(e) {
                return i(this.type, e) + "({\n)"
            }
            ,
            n.Slider.prototype.repr = function(e, t) {
                var r = Array(t + 1).join("  ")
                    , n = r + "  ";
                return i(this.type, e) + "({\n" + n + "sliderAssignment: " + this.sliderAssignment.repr(e, t + 1) + ",\n" + n + "sliderMin: " + (this.sliderMin && this.sliderMin.repr(e, t + 1)) + ",\n" + n + "sliderMax: " + (this.sliderMax && this.sliderMax.repr(e, t + 1)) + ",\n" + n + "sliderStep: " + (this.sliderStep && this.sliderStep.repr(e, t + 1)) + "},\n" + r + ")"
            }
            ,
            n.Broadcast.prototype.repr = function(e, t) {
                return i(this.type, e) + "(['" + this._replacedSymbols.join("', ") + "'], " + r(this.args, e, t) + ")"
            }
    });
    _("core/math/features/scalarEvalExpression", ["require", "parsenodes", "core/math/functions"], function(e) {
        "use strict";
        var t = e("parsenodes")
            , r = e("core/math/functions")
            , n = {
            Add: function(e) {
                return "(" + e.join("+") + ")"
            },
            Multiply: function(e) {
                return "(" + e.join("*") + ")"
            },
            Divide: function(e) {
                return "(" + e.join("/") + ")"
            },
            Subtract: function(e) {
                return "(" + e.join("-") + ")"
            },
            Exponent: function(e) {
                return "BuiltIn.pow(" + e.join(",") + ")"
            },
            RawExponent: function(e) {
                return "Math.pow(" + e.join(",") + ")"
            },
            Negative: function(e) {
                return "(-" + e[0] + ")"
            },
            And: function(e) {
                return e.join("&&")
            },
            Piecewise: function(e) {
                return "(" + e[0] + "?" + e[1] + ":" + e[2] + ")"
            }
        }
            , i = {
            Add: 2,
            Multiply: 2,
            Divide: 2,
            Subtract: 2,
            Exponent: 2,
            RawExponent: 2,
            Negative: 1,
            And: 2,
            Piecewise: 3
        };
        for (var a in n) {
            var o = t[a].prototype;
            o.scalarEvalExpression = n[a],
                o.evaluate = r.createEvaluateFunction(o.scalarEvalExpression, i[a])
        }
    });
    _("core/math/reconstitute-node", ["require", "parsenodes", "core/math/types"], function(e) {
        "use strict";
        var o = e("parsenodes")
            , s = e("core/math/types");
        return function e(t, r) {
            if (s.isList(t)) {
                for (var n = [], i = 0; i < r.length; i++)
                    n.push(e(s.elementType(t), r[i]));
                var a = o.List(n);
                return a.valueType = t,
                    a
            }
            switch (t) {
                case s.Number:
                case s.Bool:
                    return o.Constant(r);
                case s.Point:
                    return o.OrderedPair([o.Constant(r[0]), o.Constant(r[1])]);
                case s.RGBColor:
                    return o.RGBColor([o.Constant(r[0]), o.Constant(r[1]), o.Constant(r[2])]);
                default:
                    throw new Error("Cannot reconstitute value of a " + s.prettyPrint(t) + ".")
            }
        }
    });
    _("core/math/features/constantcollapsedcopy", ["require", "parsenodes", "core/math/reconstitute-node", "core/math/maybe-rational", "core/math/errormsg"], function(e) {
        "use strict";
        var r = e("parsenodes")
            , u = r.Constant
            , c = r.Multiply
            , l = r.Subtract
            , a = r.Exponent
            , i = r.RawExponent
            , o = r.Seed
            , s = r.BuiltInFunction
            , p = e("core/math/reconstitute-node")
            , f = e("core/math/maybe-rational")
            , h = e("core/math/errormsg");
        function d(e) {
            if (e.isConstant) {
                var t = e.asValue();
                return "number" == typeof t && !isFinite(t)
            }
        }
        var t = {
            Expression: function(e, t) {
                return this.copyWithArgs(t)
            },
            FreeVariable: function(e, t) {
                return this
            },
            ScalarExpression: function(e, t) {
                for (var r = [], n = 0; n < t.length; n++) {
                    if (!t[n].isConstant && !t[n].isString)
                        return this.copyWithArgs(t);
                    r.push(t[n].asValue())
                }
                return u(this.evaluate(r))
            },
            TypedFunction: function(e, t) {
                for (var r = [], n = 0; n < t.length; n++) {
                    if (0 !== t[n].getDependencies().length)
                        return this.copyWithArgs(t);
                    r.push(t[n].asValue())
                }
                return p(this._outputType, this.evaluate(r))
            },
            OrderedPair: function(e, t) {
                return this.copyWithArgs(t)
            },
            RGBColor: function(e, t) {
                return this.copyWithArgs(t)
            },
            Distribution: function(e, t) {
                return this.copyWithArgs(t)
            },
            Add: function(e, t) {
                return t[0].isConstant && t[1].isConstant ? u(f.add(t[0].asMaybeRationalValue(), t[1].asMaybeRationalValue())) : 0 === t[0].asValue() ? t[1] : 0 === t[1].asValue() ? t[0] : this.copyWithArgs(t)
            },
            Multiply: function(e, t) {
                return t[0].isConstant && t[1].isConstant ? u(f.mul(t[0].asMaybeRationalValue(), t[1].asMaybeRationalValue())) : 1 === t[0].asValue() ? t[1] : 1 === t[1].asValue() ? t[0] : this.copyWithArgs(t)
            },
            Subtract: function(e, t) {
                return t[0].isConstant && t[1].isConstant ? u(f.sub(t[0].asMaybeRationalValue(), t[1].asMaybeRationalValue())) : 0 === t[0].asValue() ? r.Negative([t[1]]) : 0 === t[1].asValue() ? t[0] : this.copyWithArgs(t)
            },
            Divide: function(e, t) {
                return t[0].isConstant && t[1].isConstant ? u(f.div(t[0].asMaybeRationalValue(), t[1].asMaybeRationalValue())) : 1 === t[1].asValue() ? t[0] : this.copyWithArgs(t)
            },
            Exponent: function(e, t) {
                if (t[0].isConstant && t[1].isConstant)
                    return u(f.pow(t[0].asMaybeRationalValue(), t[1].asMaybeRationalValue()));
                if (t[0].isConstant) {
                    if (t[0].asValue() === Math.E)
                        return s.exp([t[1]]);
                    if (0 < t[0].asValue())
                        return i(t)
                }
                if (t[1].isConstant) {
                    var r = t[1].asValue();
                    if (1 === r)
                        return t[0];
                    if (r === Math.floor(r))
                        return i(t);
                    var n = t[1].asMaybeRationalValue();
                    return f.isRational(n) ? n.d % 2 == 1 ? c([n.n % 2 == 0 ? u(f.maybeRational(1, 1)) : s.sign([t[0]]), i([s.abs([t[0]]), t[1]])]) : i(t) : this.copyWithArgs(t)
                }
                return this.copyWithArgs(t)
            },
            RawExponent: function(e, t) {
                return t[0].isConstant && t[1].isConstant ? u(f.pow(t[0].asMaybeRationalValue(), t[1].asMaybeRationalValue())) : this.copyWithArgs(t)
            },
            Negative: function(e, t) {
                return t[0].isConstant ? u(f.neg(t[0].asMaybeRationalValue())) : t[0]instanceof r.Negative ? t[0].args[0] : this.copyWithArgs(t)
            },
            And: function(e, t) {
                return t[0].isConstant && t[1].isConstant ? u(t[0].asValue() && t[1].asValue()) : t[0].isConstant && !0 === t[0] ? t[1] : t[0].isConstant && !1 === t[0] ? u(!1) : t[1].isConstant && !0 === t[1] ? t[0] : t[1].isConstant && !1 === t[1] ? u(!1) : this.copyWithArgs(t)
            },
            Piecewise: function(e, t) {
                return t[0].isConstant && !0 === t[0].asValue() ? t[1] : t[0].isConstant && !1 === t[0].asValue() ? t[2] : this.copyWithArgs(t)
            },
            Integral: function(e, t) {
                var r = t[0]
                    , n = t[1]
                    , i = t[2]
                    , a = t[3]
                    , o = a.getDependencies();
                if (n.isConstant && i.isConstant) {
                    var s = i.asValue() - n.asValue();
                    if (a.isConstant)
                        return u(a.asValue() * s);
                    if (!a.dependsOn(r._symbol))
                        return c([a, u(s)]);
                    if (1 === o.length && o[0] === r._symbol)
                        return u(this.evaluate(n.asValue(), i.asValue(), a))
                } else if (!a.dependsOn(r._symbol))
                    return c([a, l([i, n])]);
                return this.copyWithArgs(t)
            },
            ListAccess: function(e, t) {
                return t[1].isConstant ? t[0].elementAt(e, t[1].asValue() - 1) : this.copyWithArgs(t)
            },
            OrderedPairAccess: function(e, t) {
                return t[1].isConstant && t[0]instanceof r.OrderedPair ? t[0].elementAt(e, t[1].asValue() - 1) : this.copyWithArgs(t)
            },
            Broadcast: function(e, t) {
                for (var r = t[0].getDependencies(), n = 0; n < r.length; n++)
                    if (-1 === this._replacedSymbols.indexOf(r[n]))
                        return this.copyWithArgs(t);
                for (n = 1; n < t.length; n++)
                    if (0 !== t[n].getDependencies().length)
                        return this.copyWithArgs(t);
                var i = t[0].getCompiledFunction(this._replacedSymbols).fn
                    , a = t.slice(1).map(function(e) {
                    return e.asValue()
                })
                    , o = [];
                for (n = 0; n < this.length; n++) {
                    for (var s = [], u = 0; u < a.length; u++)
                        s.push(a[u][n]);
                    o.push(i.apply(void 0, s))
                }
                return p(this.valueType, o)
            },
            ReducerFunction: function(e, t) {
                return 0 === t[0].getDependencies().length ? p(this.valueType, this.evaluate([t[0].asValue()])) : this.copyWithArgs(t)
            },
            DoubleReducerFunction: function(e, t) {
                if (0 !== t[0].getDependencies().length || 0 !== t[1].getDependencies().length)
                    return this.copyWithArgs(t);
                var r = Math.min(t[0].length, t[1].length);
                return p(this.valueType, this.evaluate([t[0].asValue().slice(0, r), t[1].asValue().slice(0, r)]))
            },
            ParametrizedReducerFunction: function(e, t) {
                var r = t[0]
                    , n = t[1];
                return n.isConstant && 0 === r.getDependencies().length ? p(this.valueType, this.evaluate([r.asValue(), n.asValue()])) : this.copyWithArgs(t)
            },
            RepeatedOperator: function(e, t) {
                var r = t[1]
                    , n = t[2];
                if (d(r) || d(n))
                    switch (this.type) {
                        case "Sum":
                            throw h.sumInfiniteBoundError();
                        case "Product":
                            throw h.productInfiniteBoundError();
                        default:
                            throw h.parseError()
                    }
                if (r.isConstant && n.isConstant) {
                    var i = r.asValue()
                        , a = n.asValue()
                        , o = t[3];
                    if (o.isConstant)
                        return u(this.evaluateConstant([i, a, o.asValue()]));
                    var s = o.getDependencies();
                    if (0 === s.length || 1 === s.length && s[0] === t[0]._symbol)
                        return u(this.evaluate(i, a, o))
                }
                return this.copyWithArgs(t)
            },
            ExtendSeed: function(e, t) {
                var r = t[0]
                    , n = t[1];
                return 0 === r.getDependencies().length && 0 === n.getDependencies().length ? o(r.asValue() + "::" + this.tag + n.asValue()) : this.copyWithArgs(t)
            }
        };
        for (var n in t)
            r[n].prototype._constantCollapsedCopy = t[n];
        s.mod.prototype._constantCollapsedCopy = function(e, t) {
            return t[0].isConstant && t[1].isConstant ? u(f.mod(t[0].asMaybeRationalValue(), t[1].asMaybeRationalValue())) : this.copyWithArgs(t)
        }
            ,
            s.sqrt.prototype._constantCollapsedCopy = function(e, t) {
                return t[0].isConstant ? u(f.sqrt(t[0].asMaybeRationalValue())) : this.copyWithArgs(t)
            }
            ,
            s.nthroot.prototype._constantCollapsedCopy = function(e, t) {
                var r = t[0]
                    , n = t[1];
                if (n.isConstant) {
                    if (r.isConstant)
                        return u(f.nthroot(r.asMaybeRationalValue(), n.asMaybeRationalValue()));
                    var i = [r, u(f.reciprocal(n.asMaybeRationalValue()))];
                    return a(i)._constantCollapsedCopy(e, i)
                }
                return this.copyWithArgs(t)
            }
            ,
            s.abs.prototype._constantCollapsedCopy = function(e, t) {
                return t[0].isConstant ? u(f.abs(t[0].asMaybeRationalValue())) : this.copyWithArgs(t)
            }
            ,
            s.total.prototype._constantCollapsedCopy = function(e, t) {
                if (!t[0].isList)
                    return this.copyWithArgs(t);
                for (var r = t[0].args, n = 0; n < r.length; n++)
                    if (!r[n].isConstant)
                        return this.copyWithArgs(t);
                return u(f.total(t[0].asMaybeRationalValue()))
            }
    });
    _("core/math/features/polynomialorder", ["require", "parsenodes"], function(e) {
        "use strict";
        var t, r = e("parsenodes"), n = {
            Expression: "this.dependsOn(symbol) ? Infinity : 0",
            FreeVariable: "(symbol === this._symbol ? 1 : 0)",
            Constant: "0",
            Add: "Math.max(order0, order1)",
            Subtract: "Math.max(order0, order1)",
            Multiply: "order0 + order1",
            Negative: "order0",
            Divide: "order1 > 0 ? Infinity : order0"
        };
        for (var i in n) {
            var a = n[i];
            r[i].prototype.polynomialOrder = (t = (t = (t = a).replace("order0", "this.args[0].polynomialOrder(symbol)")).replace("order1", "this.args[1].polynomialOrder(symbol)"),
                new Function(["symbol"],"return " + t))
        }
        r.Exponent.prototype.polynomialOrder = function(e) {
            var t = this.args[0].polynomialOrder(e)
                , r = this.args[1].polynomialOrder(e);
            if (0 === t && 0 === r)
                return 0;
            var n = this.args[1];
            return n.isConstant && n.asValue() === Math.round(n.asValue()) && 0 < n.asValue() ? t * n.asValue() : 1 / 0
        }
            ,
            r.Piecewise.prototype.polynomialOrder = function(e) {
                return this.dependsOn(e) ? this.args[2].isConstant && this.args[2].isNaN() ? this.args[1].polynomialOrder(e) : 1 / 0 : 0
            }
            ,
            r.List.prototype.polynomialOrder = function(e) {
                return 1 / 0
            }
    });
    _("core/math/features/polynomialcoefficients", ["require", "parsenodes", "core/math/maybe-rational"], function(e) {
        "use strict";
        var l = e("parsenodes")
            , t = e("core/math/maybe-rational").maybeRational
            , i = l.Constant(t(0, 1))
            , r = l.Constant(t(1, 1));
        l.FreeVariable.prototype.getPolynomialCoefficients = function(e) {
            return e === this._symbol ? [i, r] : [this]
        }
            ,
            l.Constant.prototype.getPolynomialCoefficients = function(e) {
                return [this]
            }
            ,
            l.Add.prototype.getPolynomialCoefficients = function(e) {
                for (var t = this.args[0].getPolynomialCoefficients(e), r = this.args[1].getPolynomialCoefficients(e), n = t.length - 1, i = r.length - 1, a = [], o = 0; o <= Math.max(n, i); o++)
                    o <= n && o <= i ? a.push(l.Add([t[o], r[o]])) : a.push(i < n ? t[o] : r[o]);
                return a
            }
            ,
            l.Subtract.prototype.getPolynomialCoefficients = function(e) {
                for (var t = this.args[0].getPolynomialCoefficients(e), r = this.args[1].getPolynomialCoefficients(e), n = t.length - 1, i = r.length - 1, a = [], o = 0; o <= Math.max(n, i); o++)
                    o <= n && o <= i ? a.push(l.Subtract([t[o], r[o]])) : a.push(i < n ? t[o] : l.Negative([r[o]]));
                return a
            }
            ,
            l.Negative.prototype.getPolynomialCoefficients = function(e) {
                for (var t = this.args[0].getPolynomialCoefficients(e), r = [], n = 0; n < t.length; n++)
                    r.push(l.Negative([t[n]]));
                return r
            }
            ,
            l.Exponent.prototype.getPolynomialCoefficients = function(e) {
                var t = this.args[0].getPolynomialCoefficients(e)
                    , r = this.args[1].getPolynomialCoefficients(e)
                    , n = t.length - 1;
                if (0 < r.length - 1)
                    throw "can't solve for variable in exponent";
                if (0 == n)
                    return [l.Exponent([t[0], r[0]])];
                if (this.args[1].isConstant)
                    switch (this.args[1].asValue()) {
                        case 0:
                            return [i];
                        case 1:
                            return t;
                        case 2:
                            return l.Multiply([this.args[0], this.args[0]]).getPolynomialCoefficients(e)
                    }
                throw "Unable to compile polynomial representation"
            }
            ,
            l.Multiply.prototype.getPolynomialCoefficients = function(e) {
                for (var t = this.args[0].getPolynomialCoefficients(e), r = this.args[1].getPolynomialCoefficients(e), n = t.length - 1, i = r.length - 1, a = [], o = 0; o <= n; o++)
                    for (var s = 0; s <= i; s++) {
                        var u = l.Multiply([t[o], r[s]])
                            , c = a[o + s];
                        a[o + s] = void 0 === c ? u : l.Add([c, u])
                    }
                return a
            }
            ,
            l.Divide.prototype.getPolynomialCoefficients = function(e) {
                var t = this.args[0].getPolynomialCoefficients(e)
                    , r = this.args[1].getPolynomialCoefficients(e)
                    , n = [];
                if (0 < r.length - 1)
                    throw "Can't solve for variable in denominator";
                for (var i = 0; i < t.length; i++)
                    n.push(l.Divide([t[i], r[0]]));
                return n
            }
            ,
            l.Expression.prototype.getPolynomialCoefficients = function(e) {
                if (this.dependsOn(e))
                    throw "Unimplemented polynomialCoefficient call";
                return [this]
            }
            ,
            l.Piecewise.prototype.getPolynomialCoefficients = function(e) {
                return this.dependsOn(e) ? this.args[1].getPolynomialCoefficients(e) : [this]
            }
    });
    _("core/math/features/extractconditions", ["require", "parsenodes"], function(e) {
        "use strict";
        var n = e("parsenodes");
        n.Expression.prototype.extractConditions = function(e, t) {
            if (!this.dependsOn(e))
                return t;
            for (var r = 0; r < this.args.length; r++) {
                t = this.args[r].extractConditions(e, t)
            }
            return t
        }
            ,
            n.Piecewise.prototype.extractConditions = function(e, t) {
                if (!this.dependsOn(e))
                    return t;
                if (!this.args[0].dependsOn(e))
                    return t = this.args[1].extractConditions(e, t),
                        t = this.args[2].extractConditions(e, t);
                var r = {};
                return r[e] = t,
                    n.Piecewise([this.args[0].substitute(r), t, n.Constant(NaN)])
            }
    });
    _("core/math/features/piecewiseDependsOn", ["require", "parsenodes"], function(e) {
        "use strict";
        var t = e("parsenodes");
        t.Expression.prototype.piecewiseDependsOn = function(e) {
            if (!this.dependsOn(e))
                return !1;
            for (var t = 0; t < this.args.length; t++) {
                if (this.args[t].piecewiseDependsOn(e))
                    return !0
            }
            return !1
        }
            ,
            t.Piecewise.prototype.piecewiseDependsOn = function(e) {
                return this.dependsOn(e)
            }
    });
    _("core/math/domaintypes", ["require", "exports"], function(e, n) {
        "use strict";
        Object.defineProperty(n, "__esModule", {
            value: !0
        }),
            n.intersectDomains = n.allReals = n.knownDomain = n.unknownDomain = n.emptyDomain = void 0,
            n.emptyDomain = function() {
                return {
                    type: "empty"
                }
            }
            ,
            n.unknownDomain = function() {
                return {
                    type: "unknown"
                }
            }
            ,
            n.knownDomain = function(e) {
                return isNaN(e[0]) || isNaN(e[1]) || e[1] < e[0] ? n.emptyDomain() : {
                    type: "known",
                    bounds: e
                }
            }
            ,
            n.allReals = function() {
                return n.knownDomain([-1 / 0, 1 / 0])
            }
            ,
            n.intersectDomains = function(e, t) {
                if ("empty" === e.type || "empty" === t.type)
                    return n.emptyDomain();
                if ("unknown" === e.type || "unknown" === t.type)
                    return n.unknownDomain();
                if (e.bounds && t.bounds) {
                    var r = [Math.max(e.bounds[0], t.bounds[0]), Math.min(e.bounds[1], t.bounds[1])];
                    return n.knownDomain(r)
                }
                return n.emptyDomain()
            }
    });
    _("core/math/features/bounddomain", ["require", "parsenodes", "core/math/builtinframe", "core/math/domaintypes", "core/math/comparators", "core/math/maybe-rational", "core/math/policy"], function(e) {
        "use strict";
        var t = e("parsenodes")
            , u = e("core/math/builtinframe")
            , c = e("core/math/domaintypes")
            , l = e("core/math/comparators").table
            , r = e("core/math/maybe-rational").maybeRational
            , p = e("core/math/policy").defaultPolicy
            , f = t.Constant(r(0, 1));
        t.Base.prototype.boundDomain = function(e) {
            return c.unknownDomain()
        }
            ,
            t.List.prototype.boundDomain = function(e) {
                if (!this.dependsOn(e))
                    return c.allReals();
                if (!this.args.length)
                    return c.allReals();
                var t = this.args[0].boundDomain(e);
                if ("known" !== t.type)
                    return c.unknownDomain();
                for (var r = 0; r < this.args.length; r++) {
                    var n = this.args[r].boundDomain(e);
                    if ("known" !== n.type)
                        return c.unknownDomain();
                    if (n.bounds[0] !== t.bounds[0] || n.bounds[1] !== t.bounds[1])
                        return c.unknownDomain()
                }
                return t
            }
            ,
            t.Expression.prototype.boundDomain = function(e) {
                for (var t = c.allReals(), r = 0; r < this.args.length; r++)
                    t = c.intersectDomains(t, this.args[r].boundDomain(e));
                return t
            }
            ,
            t.Constant.prototype.boundDomain = function(e) {
                return this.isNaN() ? c.emptyDomain() : c.allReals()
            }
            ,
            t.Piecewise.prototype.boundDomain = function(e) {
                return this.args[2].isConstant && isNaN(this.args[2].asValue()) ? c.intersectDomains(this.args[0].boundDomain(e), this.args[1].boundDomain(e)) : c.unknownDomain()
            }
            ,
            t.OrderedPair.prototype.boundDomain = function(e) {
                return c.intersectDomains(this.args[0].boundDomain(e), this.args[1].boundDomain(e))
            }
            ,
            t.BaseComparator.prototype.boundDomain = function(e) {
                if (!this.dependsOn(e))
                    return c.allReals();
                if ("=" === this.operator)
                    return c.unknownDomain();
                var t = this._difference
                    , r = this._difference.boundDomain(e);
                if (1 < t.polynomialOrder(e))
                    return c.unknownDomain();
                var n = t.getPolynomialCoefficients(e)
                    , i = n[1] ? n[1].getConcreteTree(p, u) : f
                    , a = n[0] ? n[0].getConcreteTree(p, u) : f;
                if (!i.isConstant || !a.isConstant)
                    return c.unknownDomain();
                if (isNaN(i.asValue()) || isNaN(a.asValue()))
                    return c.emptyDomain();
                if (0 === i.asValue())
                    return l[this.operator].inclusive ? 0 <= a.asValue() ? r : c.emptyDomain() : 0 < a.asValue() ? r : c.emptyDomain();
                var o = -a.asValue() / i.asValue()
                    , s = i.asValue() < 0 ? [-1 / 0, o] : [o, 1 / 0];
                return c.intersectDomains(r, c.knownDomain(s))
            }
    });
    _("core/math/features/derivative", ["require", "parsenodes", "core/math/baseparser", "core/math/builtinframe", "core/math/parsenode/builtinfunction", "core/math/maybe-rational", "core/math/policy", "core/math/types", "core/math/errormsg"], function(e) {
        "use strict";
        var c = e("parsenodes")
            , t = e("core/math/baseparser")
            , u = e("core/math/builtinframe")
            , r = e("core/math/parsenode/builtinfunction")
            , n = e("core/math/maybe-rational").maybeRational
            , l = e("core/math/policy").defaultPolicy
            , i = e("core/math/types")
            , a = e("core/math/errormsg")
            , o = c.Constant(n(0, 1))
            , s = c.Constant(n(1, 1))
            , p = c.Constant(n(2, 1))
            , f = c.OrderedPair([o, o])
            , h = {
            FreeVariable: function(e) {
                return e === this._symbol ? s : o
            },
            Constant: function(e) {
                return isFinite(this.asValue()) ? o : c.Constant(this.asValue())
            },
            Negative: function(e) {
                return c.Negative([this.args[0].takeDerivative(e)])
            },
            Add: function(e) {
                return c.Add([this.args[0].takeDerivative(e), this.args[1].takeDerivative(e)])
            },
            Subtract: function(e) {
                return c.Subtract([this.args[0].takeDerivative(e), this.args[1].takeDerivative(e)])
            },
            Multiply: function(e) {
                return c.Add([b(e, this.args[0], c.Multiply([this.args[0].takeDerivative(e), this.args[1]])), b(e, this.args[1], c.Multiply([this.args[0], this.args[1].takeDerivative(e)]))])
            },
            Divide: function(e) {
                return c.Subtract([b(e, this.args[0], c.Divide([this.args[0].takeDerivative(e), this.args[1]])), b(e, this.args[1], c.Divide([c.Multiply([this.args[0], this.args[1].takeDerivative(e)]), c.Exponent([this.args[1], p])]))])
            },
            Exponent: function(e) {
                return c.Add([b(e, this.args[0], c.Multiply([c.Multiply([this.args[1], c.Exponent([this.args[0], c.Subtract([this.args[1], s])])]), this.args[0].takeDerivative(e)])), b(e, this.args[1], c.Multiply([c.Piecewise([c.Comparator["="]([this.args[0], o]), c.Piecewise([c.Comparator[">"]([this.args[1], o]), o, c.Constant(NaN)]), c.Multiply([c.FunctionCall("\\ln", [this.args[0]]), c.Exponent([this.args[0], this.args[1]])])]), this.args[1].takeDerivative(e)]))]).getConcreteTree(l, u)
            },
            Sum: function(e) {
                return this.copyWithArgs([this.args[0], this.args[1], this.args[2], this.args[3].takeDerivative(e)])
            },
            Product: function(e) {
                var t = c.Sum([this.args[0], this.args[1], this.args[2], c.Piecewise([c.Comparator["="]([o, this.args[3]]), s, o])])
                    , r = c.Multiply([c.Sum([this.args[0], this.args[1], this.args[2], c.Divide([this.args[3].takeDerivative(e), this.args[3]])]), c.Product(this.args)])
                    , n = c.Product([this.args[0], this.args[1], this.args[2], c.Piecewise([c.Comparator["="]([o, this.args[3]]), this.args[3].takeDerivative(e), this.args[3]])]);
                return c.Piecewise([c.Comparator["="]([o, t]), r, c.Piecewise([c.Comparator["="]([s, t]), n, o])])
            },
            Piecewise: function(e) {
                return 2 === this.args.length ? c.Piecewise([this.args[0], this.args[1].takeDerivative(e)]) : 3 === this.args.length ? c.Piecewise([this.args[0], this.args[1].takeDerivative(e), this.args[2].takeDerivative(e)]) : void 0
            },
            List: function(t) {
                return c.List(this.args.map(function(e) {
                    return e.takeDerivative(t)
                }))
            },
            ListAccess: function(e) {
                return new this.constructor([this.args[0].takeDerivative(e), this.args[1]])
            },
            OrderedPair: function(e) {
                return new this.constructor([this.args[0].takeDerivative(e), this.args[1].takeDerivative(e)])
            },
            OrderedPairAccess: function(e) {
                return new this.constructor([this.args[0].takeDerivative(e), this.args[1]])
            },
            Integral: function(e) {
                var t = this.args[0]
                    , r = this.args[1]
                    , n = this.args[2]
                    , i = this.args[3]
                    , a = {};
                a[t._symbol] = n;
                var o = {};
                return o[t._symbol] = r,
                    c.Add([b(e, i, this.copyWithArgs([t, r, n, i.takeDerivative(e)])), c.Subtract([b(e, n, c.Multiply([i.substitute(a), n.takeDerivative(e)])), b(e, r, c.Multiply([i.substitute(o), r.takeDerivative(e)]))])])
            },
            SolvedEquation: function(e) {
                return this._expression.takeDerivative(e)
            },
            OptimizedRegression: function(e) {
                return this.model.takeDerivative(e)
            },
            Broadcast: function(e) {
                for (var t = this._replacedSymbols.slice(), r = this.args.slice(1), n = this._expression.takeDerivative(e), i = 0; i < this._replacedSymbols.length; i++) {
                    var a, o, s = this._replacedSymbols[i], u = this.args[i + 1];
                    u.dependsOn(e) && (a = this.tmpVar(),
                        o = c.DummyIndex(a),
                        t.push(a),
                        r.push(u.takeDerivative(e)),
                        n = c.Add([n, c.Multiply([this._expression.takeDerivative(s), o])]))
                }
                return c.Broadcast(t, [n].concat(r))
            },
            Seed: function(e) {
                return c.Constant(NaN)
            }
        }
            , d = {
            exp: "\\exp(x)*x_1",
            ln: "\\{x >= 0: x_1/x \\}",
            log: "\\{ x >= 0: x_1/(x*\\ln(10)) \\}",
            sqrt: "x_1/(2*\\sqrt{x})",
            rtxsqpone: "x*x_1/\\rtxsqpone(x)",
            rtxsqmone: "x*x_1/\\rtxsqmone(x)",
            sin: "\\cos(x)*x_1",
            cos: "-\\sin(x)*x_1",
            tan: "\\sec(x)^2*x_1",
            arcsin: "x_1/\\sqrt{1 - x^2}",
            arccos: "-x_1/\\sqrt{1 - x^2}",
            sinh: "\\cosh(x)*x_1",
            cosh: "\\sinh(x)*x_1",
            tanh: "(\\sech(x))^2*x_1",
            arcsinh: "x_1/\\sqrt{x^2 + 1}",
            arccosh: "\\{ x > 0: x_1/\\rtxsqmone(x) \\}",
            arctanh: "\\{ \\abs(x) < 1: x_1/(1 - x^2) \\}",
            csc: "-\\cot(x)*\\csc(x)*x_1",
            sec: "\\tan(x)*\\sec(x)*x_1",
            cot: "-\\csc(x)^2*x_1",
            arccsc: "-x_1/(\\abs(x)*\\rtxsqmone(x))",
            arcsec: "x_1/(\\abs(x)*\\rtxsqmone(x))",
            arccot: "-x_1/(1+x^2)",
            csch: "-\\coth(x)*\\csch(x)*x_1",
            sech: "-\\tanh(x)*\\sech(x)*x_1",
            coth: "-(\\csch(x))^2*x_1",
            arccsch: "-x_1/(\\abs(x)*\\rtxsqpone(x))",
            arcsech: "\\{ x >= 0: -x_1/(x*\\sqrt{1 - x^2}) \\}",
            arccoth: "\\{ \\abs(x) > 1 : x_1/(1 - x^2) \\}",
            factorial: "(x)!*\\polyGamma(0, x + 1)*x_1",
            floor: "\\{ \\mod(x, 1) > 0: 0*x_1 \\}",
            ceil: "\\{ \\mod(x, 1) > 0: 0*x_1 \\}",
            abs: "\\{ \\abs(x) > 0: \\sign(x)*x_1 \\}",
            sign: "\\{ \\abs(x) > 0: 0*x_1 \\}",
            mean: "\\mean(x_1)",
            total: "\\total(x_1)",
            length: "0",
            var: "2*\\cov(x, x_1)",
            varp: "2*\\cov(x, x_1)*(\\length(x)-1)/\\length(x)",
            stdev: "\\cov(x, x_1)/\\stdev(x)",
            stdevp: "\\covp(x, x_1)/\\stdevp(x)",
            mad: "\\mean(\\sign(x-\\mean(x))*(x_1 - \\mean(x_1)))",
            min: "x_1[\\argmin(x)]",
            max: "x_1[\\argmax(x)]",
            median: "0.5*(x_1[\\lowerQuantileIndex(x, 0.5)] + x_1[\\upperQuantileIndex(x, 0.5)])",
            argmin: "0/0",
            argmax: "0/0",
            gcd: "0/0",
            lcm: "0/0",
            erf: "\\frac{2x_1}{\\sqrt{\\pi }}e^{-x^2}",
            invNorm: "\\frac{x_1}{\\pdf(\\normaldist(0,1),\\invNorm(x))}",
            negatePoint: "-x_1"
        }
            , m = {
            logbase: ["\\{x > 0: \\frac{x_1}{x*\\ln(y)}\\}", "\\frac{-\\log_{y}(x)*y_1}{y*\\ln(y)}"],
            nthroot: ["x^{1/y - 1}/y*x_1", "-\\frac{x^{1/y}*\\ln(x)*y_1}{y^2}"],
            polyGamma: ["0/0", "\\polyGamma(1 + x, y)*y_1"],
            mod: ["\\{ \\abs(\\mod(x, y)) > 0: x_1 \\}", "\\{ \\mod(x/y, 1) > 0: -\\floor(x/y)*y_1 \\}"],
            round: ["\\{ \\abs(\\mod(x, 1) - 0.5) > 0: 0*x_1 \\}", "0/0"],
            cov: ["\\cov(x_1, y)", "\\cov(x, y_1)"],
            covp: ["\\covp(x_1, y)", "\\covp(x, y_1)"],
            corr: ["(\\cov(x_1, y) - (\\cov(x, y)*\\cov(x, x_1)/\\var(x)))/(\\stdevp(x)\\stdevp(y))", "(\\cov(x, y_1) - (\\cov(x, y)*\\cov(y, y_1)/\\var(y)))/(\\stdevp(x)\\stdevp(y))"],
            spearman: ["0/0", "0/0"],
            quantile: ["\\{ \\floor(y*(\\length(x)-1)) = y*(\\length(x)-1) :   x_1[\\upperQuantileIndex(x, y)],  (\\ceil(y*(\\length(x)-1)) - y*(\\length(x)-1))*x_1[\\lowerQuantileIndex(x, y)] +   (y*(\\length(x)-1) - \\floor(y*(\\length(x)-1)))*x_1[\\upperQuantileIndex(x, y)]\\}", "\\{ \\floor(y*(\\length(x)-1)) < y*(\\length(x)-1) :   (x[\\upperQuantileIndex(x, y)] - x[\\lowerQuantileIndex(x, y)])*y_1\\}"],
            quartile: ["0.5*(x_1[\\lowerQuartileIndex(x, y)] + x_1[\\upperQuartileIndex(x, y)])", "0/0"],
            tscore: ["\\frac{\\sqrt{\\length(x)}(\\stdev(x)*\\mean(x_1)-(\\mean(x)-y)*\\frac{\\cov(x,x_1)}{\\stdev(x)})}{\\stdev(x)^2}", "-y_1*\\sqrt{\\length(x)}/\\stdev(x)"],
            quartileIndex: ["0/0", "0/0"],
            upperQuartileIndex: ["0/0", "0/0"],
            lowerQuartileIndex: ["0/0", "0/0"],
            upperQuantileIndex: ["0/0", "0/0"],
            lowerQuantileIndex: ["0/0", "0/0"],
            nCr: ["0/0", "0/0"],
            nPr: ["0/0", "0/0"],
            arctan: ["x_1*y/(y^2+x^2)", "-y_1*x/(y^2+x^2)"],
            poissonpdf: ["0/0", "y_1\\frac{e^{-y}(\\floor(x)-y)y^{(\\floor(x)-1)}}{\\floor(x)!}"],
            invPoisson: ["0/0", "0/0"],
            tpdf: ["x_1*\\pdf(\\tdist(y),x)*\\frac{-(y+1)*x}{y+x^2}", "y_1*\\frac{1}{2}\\pdf(\\tdist(y),x)(  \\frac{x^2-1}{y + x^2} + \\ln(\\frac{y}{y + x^2}) +   \\polyGamma(0, \\frac{1+y}{2}) - \\polyGamma(0, y/2))"],
            invT: ["x_1/\\pdf(\\tdist(y),\\invT(x, y))", "0/0"],
            addPoints: ["x_1", "y_1"],
            subtractPoints: ["x_1", "-y_1"],
            multiplyPoint: ["x_1*y", "x*y_1"],
            dividePoint: ["x_1/y", "-x*(y_1/y^2)"],
            midpoint: ["x_1/2", "y_1/2"],
            distance: ["-((y.x-x.x)*x_1.x+(y.y-x.y)*x_1.y)/\\distance(x,y)", "((y.x-x.x)*y_1.x+(y.y-x.y)*y_1.y)/\\distance(x,y)"]
        }
            , g = {
            tcdf: ["-x_1*\\pdf(\\tdist(z),x)", "y_1*\\pdf(\\tdist(z),y)", "0/0"],
            poissoncdf: ["0/0", "0/0", "z_1\\sum _{n=\\max(0,\\floor(\\min(x,y)))}^{\\floor(\\max(x,y))}\\frac{e^{-z}(n-z)z^{(n-1)}}{n!}"],
            normalpdf: ["-x_1*\\frac{x-y}{z^2} \\pdf(\\normaldist(y,z),x)", "y_1*\\frac{x-y}{z^2} \\pdf(\\normaldist(y,z),x)", "z_1*(\\frac{(x-y-z)*(x-y+z)}{z^3}) \\pdf(\\normaldist(y,z),x)"],
            binompdf: ["0/0", "0/0", "\\{0<=z<=1: z_1*\\pdf(\\binomialdist(y,z),x)*(\\frac{\\round(x)}{z}-\\frac{\\round(y)-\\round(x)}{1-z}), 0 \\}"],
            invBinom: ["0/0", "0/0", "0/0"],
            uniformpdf: ["0", "\\{y<=x: \\frac{y_1}{(z-y)^2}, 0\\}", "\\{z>=x: -\\frac{z_1}{(z-y)^2}, 0\\}"],
            invUniform: ["\\{y<=x<=z: x_1*(z-y), 0\\}", "\\{y<=x<=z: y_1*(1-x), 0\\}", "\\{y<=x<=z: z_1*x, 0\\}"]
        }
            , y = {
            normalcdf: ["-x_1\\pdf(\\normaldist(z,u), x)", "y_1\\pdf(\\normaldist(z,u), y)", "-z_1*(\\pdf(\\normaldist(z,u), y) - \\pdf(\\normaldist(z,u), x))", "u_1*(  \\{\\abs(y)=1/0:0,\\frac{z-y}{u}\\pdf(\\normaldist(z,u),y)\\} -   \\{\\abs(x)=1/0:0,\\frac{z-x}{u}\\pdf(\\normaldist(z,u),x)\\})"],
            binomcdf: ["0/0", "0/0", "0/0", "\\{0<=u<=1: u_1*\\sum _{n=\\max(0,\\round(\\min(x,y)))}^{\\round(\\max(x,y))}(  \\pdf(\\binomialdist(z,u),n)*(\\frac{n}{u}-\\frac{\\round(z)-n}{1-u})), 0 \\}"],
            uniformcdf: ["\\{z>u: 0/0, -x_1\\pdf(\\uniformdist(z,u), x)\\}", "\\{z>u: 0/0, y_1\\pdf(\\uniformdist(z,u), y)\\}", "\\{z>u: 0/0, z_1*(\\frac{\\{z<x<u:u-x,0\\} + \\{z<y<u:y-u,0\\}}{(u-z)^2})\\}", "\\{z>u: 0/0, u_1*(\\frac{\\{z<x<u:x-z,0\\} + \\{z<y<u:z-y,0\\}}{(u-z)^2})\\}"]
        };
        for (var v in d)
            r[v].prototype.takeDerivative = function(n, i) {
                return function(e) {
                    var t = this.args
                        , r = {
                        x: t[0],
                        x_1: t[0].takeDerivative(e)
                    };
                    return b(e, t[0], n.substitute(r), i).getConcreteTree(l, u)
                }
            }(t.parse(d[v]), r[v].prototype._outputType || i.Number);
        for (v in m)
            r[v].prototype.takeDerivative = function(n, i, a) {
                return function(e) {
                    var t = this.args
                        , r = {
                        x: t[0],
                        x_1: t[0].takeDerivative(e),
                        y: t[1],
                        y_1: t[1].takeDerivative(e)
                    };
                    return c.Add([b(e, t[0], n.substitute(r), a), b(e, t[1], i.substitute(r), a)]).getConcreteTree(l, u)
                }
            }(t.parse(m[v][0]), t.parse(m[v][1]), r[v].prototype._outputType || i.Number);
        for (v in g)
            r[v].prototype.takeDerivative = function(n, i, a, o) {
                return function(e) {
                    var t = this.args
                        , r = {
                        x: t[0],
                        x_1: t[0].takeDerivative(e),
                        y: t[1],
                        y_1: t[1].takeDerivative(e),
                        z: t[2],
                        z_1: t[2].takeDerivative(e)
                    };
                    return c.Add([c.Add([b(e, t[0], n.substitute(r), o), b(e, t[1], i.substitute(r), o)]), b(e, t[2], a.substitute(r), o)]).getConcreteTree(l, u)
                }
            }(t.parse(g[v][0]), t.parse(g[v][1]), t.parse(g[v][2]), r[v].prototype._outputType || i.Number);
        for (v in y)
            r[v].prototype.takeDerivative = function(n, i, a, o, s) {
                return function(e) {
                    var t = this.args
                        , r = {
                        x: t[0],
                        x_1: t[0].takeDerivative(e),
                        y: t[1],
                        y_1: t[1].takeDerivative(e),
                        z: t[2],
                        z_1: t[2].takeDerivative(e),
                        u: t[3],
                        u_1: t[3].takeDerivative(e)
                    };
                    return c.Add([c.Add([b(e, t[0], n.substitute(r), s), b(e, t[1], i.substitute(r), s)]), c.Add([b(e, t[2], a.substitute(r), s), b(e, t[3], o.substitute(r), s)])]).getConcreteTree(l, u)
                }
            }(t.parse(y[v][0]), t.parse(y[v][1]), t.parse(y[v][2]), t.parse(y[v][3]), r[v].prototype._outputType || i.Number);
        var b = function(e, t, r, n) {
            if (void 0 === n && (n = i.Number),
                t.dependsOn(e))
                return r;
            if (n === i.Number)
                return o;
            if (n === i.Point)
                return f;
            throw a.parseError()
        };
        for (var x in h) {
            var S = h[x];
            c[x].prototype.takeDerivative = S
        }
        ["tSample", "poissonSample", "uniformSample", "normalSample", "binomSample"].forEach(function(e) {
            r[e].prototype.takeDerivative = function(e) {
                for (var t = 0; t < this.args.length; t++)
                    if (this.args[t].dependsOn(e))
                        return c.Constant(NaN);
                return o
            }
        })
    });
    _("core/math/features/substitute", ["require", "parsenodes"], function(e) {
        "use strict";
        var r = e("parsenodes")
            , t = {
            Identifier: function(e) {
                return e[this._symbol] ? e[this._symbol] : this
            },
            FreeVariable: function(e) {
                return e[this._symbol] ? e[this._symbol] : this
            },
            Constant: function(e) {
                return this
            },
            Expression: function(t) {
                return this.copyWithArgs(this.args.map(function(e) {
                    return e.substitute(t)
                }))
            },
            List: function(t) {
                return r.List(this.args.map(function(e) {
                    return e.substitute(t)
                }))
            },
            SolvedEquation: function(e) {
                return new this.constructor(this._symbol,this._expression.substitute(e))
            },
            OptimizedRegression: function(e) {
                return new this.constructor(this.model.substitute(e),this.parameters,this.residualVariables,this.residuals,this.statistics)
            }
        };
        for (var n in t)
            r[n].prototype.substitute = t[n]
    });
    _("core/math/features/isImplicit", ["require", "parsenodes"], function(e) {
        "use strict";
        var t = e("parsenodes");
        function r(e) {
            return !(e[0]instanceof t.FreeVariable) || e[1].dependsOn(e[0]._symbol)
        }
        t.Base.prototype.isImplicit = function() {
            return !1
        }
            ,
            t.Equation.prototype.isImplicit = function() {
                return r(this.args)
            }
            ,
            t.BaseComparator.prototype.isImplicit = function() {
                return r(this.args)
            }
            ,
            t.Broadcast.prototype.isImplicit = function() {
                return this._expression.isImplicit()
            }
    });
    _("core/math/workerconfig", [], function() {
        "use strict";
        return {
            pointsOfInterest: !0,
            plotSingleVariableImplicitEquations: !0,
            plotImplicits: !0,
            plotInequalities: !0,
            sliders: !0
        }
    });
    _("core/math/features/solve", ["require", "core/math/baseparser", "parsenodes", "core/math/errormsg", "core/math/builtinframe", "core/math/workerconfig", "core/math/maybe-rational", "core/math/policy"], function(e) {
        "use strict";
        var t = e("core/math/baseparser")
            , r = e("parsenodes")
            , n = r.Base
            , v = r.Constant
            , i = r.Equation
            , b = r.SolvedEquation
            , a = r.BaseComparator
            , x = r.List
            , S = e("core/math/errormsg")
            , g = e("core/math/builtinframe")
            , _ = e("core/math/workerconfig")
            , o = e("core/math/maybe-rational").maybeRational
            , y = e("core/math/policy").defaultPolicy
            , E = v(o(0, 1));
        var s = t.parse("b*b")
            , u = t.parse("4*a*c")
            , c = t.parse("(-b+\\sqrt{b*b-4*a*c})/(2*a)")
            , l = t.parse("(-b-\\sqrt{b*b-4*a*c})/(2*a)")
            , p = t.parse("[\\{\\abs(b)>0:-c/b\\}]")
            , f = t.parse("[\\{\\abs(a)>0:-b/(2*a)\\}]")
            , h = t.parse("[\\{a=0:\\{b<0:-c/b\\},q\\},\\{a=0:\\{b>0:-c/b\\},p\\}]")
            , d = t.parse("[\\{a=0:\\{b<0:-c/b\\},a>0:q\\},\\{a=0:\\{b=0:\\{c>0:-m\\}\\},a>0:\\{f<g:-m\\},p\\},\\{a=0:\\{b=0:\\{c>0:m\\}\\},a>0:\\{f<g:m\\},q\\},\\{a=0:\\{b>0:-c/b\\},a>0:p\\}]");
        function M(e, t, r, n) {
            for (var i, a, o, s, u = [], c = [], l = 0; l < r.length; l++) {
                var p = r[l]
                    , f = 0;
                x.eachArgs(e, [t], function(e) {
                    var t = e[0];
                    f = Math.max(f, t.polynomialOrder(p))
                });
                var h = 2 < f
                    , d = 1 < r.length && !e.validSolvedVariable(p)
                    , m = n && t.piecewiseDependsOn(p);
                h || d || m ? (c[l] = {},
                    u[l] = 1 / 0) : (c[l] = [],
                    u[l] = 0,
                    x.eachArgs(e, [t], function(e) {
                        var t, r, n, i = e[0];
                        t = i.getPolynomialCoefficients(p),
                            (r = Object.create(g)).a = t[2] ? t[2].tryGetConcreteTree(y, g) : E,
                            r.b = t[1] ? t[1].tryGetConcreteTree(y, g) : E,
                            r.c = t[0] ? t[0].tryGetConcreteTree(y, g) : E,
                            a = r,
                            c[l].push(a),
                            u[l] = Math.max(u[l], 0 === (n = a).a.asValue() ? 0 === n.b.asValue() ? 0 : 1 : 2)
                    }))
            }
            return s = 1 === r.length ? (a = c[0],
                o = r[0],
                u[0]) : (i = 0 !== u[0] && (0 === u[1] || u[0] < u[1]) ? 0 : 1,
                a = c[i],
                o = r[i],
                u[i]),
                {
                    localFrame: a,
                    variableOfInterest: o,
                    effectiveOrder: s
                }
        }
        var D = {
            inequality: function(e) {
                return m(e),
                    d.getConcreteTree(y, e)
            },
            generalEquation: function(e) {
                return m(e),
                    e.a.isConstant && 0 === e.a.asValue() ? p.getConcreteTree(y, e) : e.f.isConstant && e.g.isConstant && e.f.asValue() - e.g.asValue() == 0 ? f.getConcreteTree(y, e) : h.getConcreteTree(y, e)
            }
        };
        function m(e) {
            e.f = s.getConcreteTree(y, e),
                e.g = u.getConcreteTree(y, e),
                e.p = c.getConcreteTree(y, e),
                e.q = l.getConcreteTree(y, e),
                e.m = v(o(1e305, 1))
        }
        n.prototype.trySolve = function(e, t) {
            try {
                return this.solve(e, t)
            } catch (e) {
                if (e instanceof r.Error)
                    return e;
                throw e
            }
        }
            ,
            i.prototype.solve = function(e, t) {
                return this.asComparator().solve(e, t)
            }
            ,
            a.prototype.solve = function(e, t) {
                var r = this.tryGetConcreteTree(e, t);
                if (r.isError)
                    return r;
                if (r.isConstant)
                    return r;
                var n = "=" !== this.getOperator();
                if (!_.plotImplicits && r.isImplicit())
                    throw new S.implicitsDisabled;
                var i = this._difference.tryGetConcreteTree(e, t);
                i.isBroadcast && (i = i.asList(e));
                var a = i.getDependencies();
                if (0 === a.length)
                    return i.isList ? x(i.args.map(function(e) {
                        return v(0 === e.asValue())
                    })) : v(0 === i.asValue());
                if (1 === a.length && i.isList && !n)
                    return i;
                if (1 === a.length && !n && !_.plotSingleVariableImplicitEquations)
                    return S.singleVariableImplicitEquationsDisabled();
                var o = x.wrap(i);
                if (2 < a.length)
                    return S.tooManyVariables(this.getSliderVariables(e, r)).setDependencies(a);
                if (n && !e.validInequalityVariables(a))
                    return S.invalidInequalityVariables().setDependencies(a);
                var s = M(e, o, a, n)
                    , u = s.localFrame
                    , c = s.effectiveOrder
                    , l = s.variableOfInterest;
                if (e.complicatedPolarImplicit(l, c))
                    return S.complicatedPolarImplicit().setDependencies(a);
                if (!e.validImplicitVariables(a))
                    return S.invalidImplicitVariables();
                if (2 < c)
                    return i;
                for (var p = n ? D.inequality : D.generalEquation, f = [], h = 0; h < u.length; h++) {
                    var d = p(u[h]);
                    if (d.isError)
                        return d;
                    if (d.isConstant)
                        f.push(d);
                    else
                        for (var m = 0; m < d.args.length; m++) {
                            var g = d.args[m]
                                , y = o.args[h].extractConditions(l, g).getConcreteTree(e, t);
                            f.push(y)
                        }
                }
                return b(l, x(f))
            }
    });
    _("core/types/graphmode", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.PARAMETRIC_CURVE_3D = t.Z_3D = t.OBJECT3D = t.VISUALIZATION = t.NONE = t.IMPLICIT = t.POLYGONFILL = t.POLAR = t.PARAMETRIC = t.XYPOINT_MOVABLE = t.XYPOINT = t.Y = t.X = void 0,
            t.X = 1,
            t.Y = 2,
            t.XYPOINT = 3,
            t.XYPOINT_MOVABLE = 4,
            t.PARAMETRIC = 5,
            t.POLAR = 6,
            t.POLYGONFILL = 7,
            t.IMPLICIT = 8,
            t.NONE = 10,
            t.VISUALIZATION = 11,
            t.OBJECT3D = 12,
            t.Z_3D = 13,
            t.PARAMETRIC_CURVE_3D = 14
    });
    _("core/math/distribution-spec", ["require", "exports", "core/math/baseparser", "tslib"], function(e, u, t, c) {
        "use strict";
        Object.defineProperty(u, "__esModule", {
            value: !0
        }),
            u.getFunctionSpecFromTree = u.parseToplevelFunction = u.DistributionParameterDefaultsMap = void 0,
            u.DistributionParameterDefaultsMap = {
                normaldist: {
                    type: "distribution",
                    symbol: "normaldist",
                    params: ["mean", "stdev"],
                    defaults: ["0", "1"],
                    discrete: !1
                },
                tdist: {
                    type: "distribution",
                    symbol: "tdist",
                    params: ["dof"],
                    defaults: [void 0],
                    discrete: !1
                },
                binomialdist: {
                    type: "distribution",
                    symbol: "binomialdist",
                    params: ["trials", "probsuccess"],
                    defaults: [void 0, "0.5"],
                    discrete: !0
                },
                poissondist: {
                    type: "distribution",
                    symbol: "poissondist",
                    params: ["mean"],
                    defaults: [void 0],
                    discrete: !0
                },
                uniformdist: {
                    type: "distribution",
                    symbol: "uniformdist",
                    params: ["min", "max"],
                    defaults: ["0", "1"],
                    discrete: !1
                }
            };
        var l = {
            Histogram: {
                type: "visualization",
                symbol: "histogram",
                params: ["data", "binwidth"],
                defaults: [void 0, "1"]
            },
            DotPlot: {
                type: "visualization",
                symbol: "dotplot",
                params: ["data", "binwidth"],
                defaults: [void 0, "1"]
            },
            BoxPlot: {
                type: "visualization",
                symbol: "boxplot",
                params: ["data"],
                defaults: [void 0]
            }
        };
        function r(e) {
            var t = e
                , r = l[t.type];
            if (!r)
                switch ("Assignment" === t.type && (t = t._expression),
                    t.type) {
                    case "FunctionCall":
                        r = u.DistributionParameterDefaultsMap[t._symbol];
                        break;
                    default:
                        return
                }
            if (r) {
                for (var n = {}, i = r.params, a = t.args, o = 0; o < i.length; o++) {
                    var s = a[o];
                    n[i[o]] = s && s.getInputString() || ""
                }
                return c.__assign(c.__assign({}, r), {
                    span: t.getInputSpan(),
                    values: n
                })
            }
        }
        u.parseToplevelFunction = function(e) {
            return r(t.parse(e, {
                trailingComma: !0
            }))
        }
            ,
            u.getFunctionSpecFromTree = r
    });
    _("core/math/evaluationstate", ["require", "exports", "core/vendor/d3-color", "parsenodes", "./errormsg", "core/types/graphmode", "core/lib/label", "core/math/distribution-spec", "./types"], function(e, t, g, y, v, b, x, S, _) {
        "use strict";
        function E(e) {
            return e.isError ? e.getError() : void 0 === e.asValue() ? "" : +e.asValue()
        }
        function M() {
            return {
                operator: "=",
                variables: []
            }
        }
        function D(e, t, r) {
            var n = e.variables;
            if (n && n.length) {
                for (var i = {}, a = 0, o = n; a < o.length; a++) {
                    i[s = o[a]] = !0
                }
                for (var s in r)
                    i[s] = !0;
                r = i
            }
            e.variables = t.sliderVariables(Object.keys(r))
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.addSliderPrompts = t.EvaluationState = t.defaultEvaluationState = void 0,
            t.defaultEvaluationState = M,
            t.EvaluationState = function(e, t, r) {
                if (t.isTable)
                    return function(e, t) {
                        for (var r = [], n = 0; n < e.columns.length; n++) {
                            var i = t.columns[n]
                                , a = i.isError ? [] : i.values.map(E)
                                , o = {
                                dependent: !i.isIndependent,
                                discrete: !!i.isIndependent,
                                values: a
                            };
                            i.isError && (o.error = i.getError()),
                                r.push(o)
                        }
                        return {
                            column_data: r
                        }
                    }(t, r);
                if (t.isImage)
                    return n = e,
                        i = t,
                        o = {
                            variables: [],
                            errorMap: {},
                            dimensions: {}
                        },
                    (a = r).center.isError && (o.errorMap.center = !0),
                    a.radianAngle.isError && (o.errorMap.angle = !0),
                    a.width.isError && (o.errorMap.width = !0),
                    a.height.isError && (o.errorMap.height = !0),
                    a.opacity.isError && (o.errorMap.opacity = !0),
                        a.center.isError || a.radianAngle.isError || a.width.isError || a.height.isError || a.opacity.isError ? o.variables = i.getSliderVariables(n, a) : (o.dimensions.x = [],
                            o.dimensions.y = [],
                            o.dimensions.radianAngle = [],
                            o.dimensions.width = [],
                            o.dimensions.height = [],
                            o.dimensions.opacity = [],
                            y.List.eachArgs(n, [a.center, a.radianAngle, a.width, a.height, a.opacity], function(e) {
                                var t = e[0].asValue()
                                    , r = +e[1].asValue()
                                    , n = Math.atan2(Math.sin(r), Math.cos(r));
                                o.dimensions.x.push(+t[0]),
                                    o.dimensions.y.push(+t[1]),
                                    o.dimensions.radianAngle.push(n),
                                    o.dimensions.width.push(+e[2].asValue()),
                                    o.dimensions.height.push(+e[3].asValue()),
                                    o.dimensions.opacity.push(Math.max(0, Math.min(1, +e[4].asValue())))
                            }),
                        (n.graphingEnabled() ? i.getGraphMode(n, a) : b.NONE) !== b.NONE && (o.is_graphable = !0),
                        a.moveStrategy && (o.move_strategy = a.moveStrategy)),
                        o;
                var n, i, a, o;
                if (t.isSimulation)
                    return function(e, t) {
                        var r = t.fps
                            , n = r.asValue()
                            , i = void 0;
                        ("number" != typeof n || n < 0) && (n = 0,
                            i = v.simulationFPSNonNegativeNumber().getError());
                        for (var a = {}, o = 0, s = r.getDependencies(); o < s.length; o++) {
                            a[s[o]] = !0
                        }
                        var u = {
                            variables: [],
                            fps: n,
                            fps_error: i
                        };
                        return D(u, e, a),
                            u
                    }(e, r);
                var s, u = M();
                if (r.isError && (!(t instanceof y.FunctionDefinition) || r.blocksExport))
                    return u.error = r.getError(),
                        u.variables = t.getSliderVariables(e, r),
                        u.is_single_identifier = t instanceof y.Identifier,
                        u;
                r instanceof y.RGBColor && (s = r.asValue(),
                    u.rgb_value = g.rgb(s[0], s[1], s[2]).formatHex()),
                r.moveStrategy && (u.move_strategy = r.moveStrategy,
                    u.default_drag_mode = r.defaultDragMode),
                t.isInequality() && (u.is_inequality = !0),
                    u.operator = t.getOperator(),
                    r instanceof y.SolvedEquation ? !0 !== r._expression.asValue() && !1 !== r._expression.asValue() && (u.assignment = r._symbol) : t instanceof y.Assignment && (u.assignment = t._symbol);
                var c, l = e.graphingEnabled() ? t.getGraphMode(e, r) : b.NONE;
                l !== b.NONE && (u.is_graphable = !0,
                    u.expression_type = t.getExpressionType(l, r.valueType),
                r.isShadeBetween() && (u.is_shade_between = !0),
                (c = t.tableInfo(e, r)) && (u.is_tableable = !0,
                    u.table_info = c)),
                void 0 !== r.valueType && _.isList(r.valueType) && (u.is_concrete_list = !0),
                    u.variables = u.is_graphable ? [] : t.getSliderVariables(e, r),
                    u.is_single_identifier = t instanceof y.Identifier,
                r.isConstant && (u.constant_value = r.asValue());
                var p = r.getEvaluationInfo();
                if (!p || "=" !== u.operator || t.isConstant || t.isFunction || r.valueType === _.Bool || r.valueType === _.ListOfBool || t instanceof y.Equation || t instanceof y.And || (u.is_evaluable = !0,
                    u.zero_values = p),
                r instanceof y.OptimizedRegression) {
                    var f = r
                        , h = {};
                    for (var d in f.parameters)
                        f.parameters.hasOwnProperty(d) && (h[x.identifierToLatex(d)] = +f.parameters[d].asValue());
                    u.is_regression = !0,
                        u.regression = {
                            parameters: h,
                            residualVariable: x.identifierToLatex(f.residualVariable),
                            residualSuggestionId: f.residualSuggestionId,
                            shouldSuggestLogMode: f.shouldSuggestLogMode,
                            isLinear: f.isLinear,
                            statistics: f.statistics,
                            parameterWarning: f.parameterWarning
                        }
                }
                var m = S.getFunctionSpecFromTree(t);
                return m && m.discrete && (u.is_discrete_distribution = !0),
                    u
            }
            ,
            t.addSliderPrompts = D
    });
    _("core/math/statementanalysis", ["require", "core/math/evaluationstate", "pjs", "core/types/graphmode", "core/math/workerconfig"], function(e) {
        "use strict";
        var n = e("core/math/evaluationstate").EvaluationState
            , t = e("pjs")
            , r = e("core/types/graphmode")
            , i = e("core/math/workerconfig");
        return t(function(e) {
            e.init = function(e, t, r) {
                this.policy = e,
                    this.rawTree = t,
                    this.concreteTree = r,
                    this.evaluationState = n(e, t, r)
            }
                ,
                e.exportTo = function(e, t) {
                    this.rawTree.exportTo(e, this.concreteTree, t)
                }
                ,
                e.graph = function(e) {
                    return this.rawTree.graph(this.policy, this.concreteTree, e)
                }
                ,
                e.getGraphMode = function() {
                    return this.rawTree.getGraphMode(this.policy, this.concreteTree)
                }
                ,
                e.getGraphInfo = function() {
                    return this.rawTree.getGraphInfo(this.policy, this.concreteTree)
                }
                ,
                e.shouldIntersect = function() {
                    if (!this.evaluationState.is_graphable)
                        return !1;
                    if (!this.rawTree.userData.shouldGraph)
                        return !1;
                    if (!i.pointsOfInterest)
                        return !1;
                    var e = this.getGraphMode();
                    return e === r.X || e === r.Y
                }
        })
    });
    _("core/math/expression-types", ["require", "exports"], function(e, n) {
        "use strict";
        var i, t;
        Object.defineProperty(n, "__esModule", {
            value: !0
        }),
            n.isClickableExpressionType = n.getReconciledExpressionProps = n.EXPRESSION_PROP_DEFAULTS = n.ExpressionType = void 0,
            (t = i = n.ExpressionType || (n.ExpressionType = {})).X_OR_Y = "X_OR_Y",
            t.SINGLE_POINT = "SINGLE_POINT",
            t.POINT_LIST = "POINT_LIST",
            t.PARAMETRIC = "PARAMETRIC",
            t.POLAR = "POLAR",
            t.IMPLICIT = "IMPLICIT",
            t.POLYGON = "POLYGON",
            t.HISTOGRAM = "HISTOGRAM",
            t.DOTPLOT = "DOTPLOT",
            t.BOXPLOT = "BOXPLOT",
            t.TTEST = "TTEST",
            t.STATS = "STATS",
            t.CUBE = "CUBE",
            t.SPHERE = "SPHERE",
            n.EXPRESSION_PROP_DEFAULTS = {
                X_OR_Y: {
                    points: !1,
                    lines: !0,
                    fill: !1
                },
                SINGLE_POINT: {
                    points: !0,
                    lines: !1,
                    fill: !1
                },
                POINT_LIST: {
                    points: !0,
                    lines: !1,
                    fill: !1
                },
                PARAMETRIC: {
                    points: !1,
                    lines: !0,
                    fill: !1
                },
                POLAR: {
                    points: !1,
                    lines: !0,
                    fill: !1
                },
                IMPLICIT: {
                    points: !1,
                    lines: !0,
                    fill: !1
                },
                POLYGON: {
                    points: !1,
                    lines: !0,
                    fill: !0
                },
                HISTOGRAM: {
                    points: !1,
                    lines: !0,
                    fill: !0
                },
                DOTPLOT: {
                    points: !0,
                    lines: !1,
                    fill: !1
                },
                BOXPLOT: {
                    points: !1,
                    lines: !0,
                    fill: !1
                },
                TTEST: {
                    points: !1,
                    lines: !1,
                    fill: !1
                },
                STATS: {
                    points: !1,
                    lines: !1,
                    fill: !1
                },
                CUBE: {
                    points: !1,
                    lines: !1,
                    fill: !0
                },
                SPHERE: {
                    points: !1,
                    lines: !1,
                    fill: !0
                }
            },
            n.getReconciledExpressionProps = function(e, t) {
                if (void 0 === e)
                    return {
                        points: !1,
                        lines: !1,
                        fill: !1
                    };
                var r = n.EXPRESSION_PROP_DEFAULTS[e];
                switch (e) {
                    case i.SINGLE_POINT:
                        return {
                            points: !0,
                            lines: !1,
                            fill: !1
                        };
                    case i.POINT_LIST:
                    case i.DOTPLOT:
                        return {
                            points: void 0 === t.points ? r.points : t.points,
                            lines: void 0 === t.lines ? r.lines : t.lines,
                            fill: !1
                        };
                    case i.PARAMETRIC:
                    case i.POLYGON:
                    case i.X_OR_Y:
                    case i.POLAR:
                    case i.IMPLICIT:
                    case i.HISTOGRAM:
                    case i.BOXPLOT:
                    case i.TTEST:
                    case i.STATS:
                    case i.CUBE:
                    case i.SPHERE:
                        return {
                            points: !1,
                            lines: void 0 === t.lines ? r.lines : t.lines,
                            fill: void 0 === t.fill ? r.fill : t.fill
                        };
                    default:
                        return e
                }
            }
            ,
            n.isClickableExpressionType = function(e) {
                if (void 0 === e)
                    return !1;
                switch (e) {
                    case i.SINGLE_POINT:
                    case i.POINT_LIST:
                    case i.PARAMETRIC:
                    case i.POLYGON:
                    case i.X_OR_Y:
                    case i.POLAR:
                    case i.IMPLICIT:
                        return !0;
                    case i.HISTOGRAM:
                    case i.BOXPLOT:
                    case i.DOTPLOT:
                    case i.TTEST:
                    case i.STATS:
                    case i.CUBE:
                    case i.SPHERE:
                        return !1;
                    default:
                        return e
                }
            }
    });
    _("core/math/features/analyze", ["require", "underscore", "parsenodes", "core/math/statementanalysis", "core/math/builtin", "core/math/builtinframe", "core/math/parsenode/builtinfunction", "core/math/errormsg", "core/math/comparators", "core/math/types", "core/types/graphmode", "core/math/expression-types", "core/math/distribution-spec", "core/math/workerconfig"], function(e) {
        "use strict";
        var u = e("underscore")
            , c = e("parsenodes")
            , l = e("core/math/statementanalysis")
            , o = e("core/math/builtin")
            , p = e("core/math/builtinframe")
            , s = e("core/math/parsenode/builtinfunction")
            , f = e("core/math/errormsg")
            , i = e("core/math/comparators")
            , a = e("core/math/types")
            , h = e("core/types/graphmode")
            , d = e("core/math/expression-types").ExpressionType
            , m = e("core/math/distribution-spec").DistributionParameterDefaultsMap
            , g = e("core/math/workerconfig");
        function y(e, t, r, n) {
            if (n.isError)
                return l(e, r, n);
            var i = n.getDependencies();
            switch (n.valueType) {
                case a.Distribution:
                case a.ListOfDistribution:
                case a.RGBColor:
                case a.ListOfColor:
                case a.EmptyList:
                    return l(e, r, n);
                case a.Point:
                case a.ListOfPoint:
                    return i.length ? e.validParametricVariables(i) ? l(e, r, n) : l(e, r, f.tooManyVariables(r.getSliderVariables(e, n)).setDependencies(i)) : l(e, r, n);
                case a.Number:
                case a.ListOfNumber:
                    return 0 === i.length ? l(e, r, n) : i.length <= e.dimensions() - 1 ? e.validExpressionVariables(i) ? l(e, r, n) : l(e, r, f.equationRequired(e.implicitDependency(i)).setDependencies(i)) : e.validImplicitVariables(i) ? l(e, r, f.equationRequired().setDependencies(i)) : l(e, r, f.tooManyVariables(r.getSliderVariables(e, n)).setDependencies(i));
                default:
                    return l(e, r, f.parseError())
            }
        }
        function v(e) {
            return s.pdf([e, c.FreeVariable("x")])
        }
        function t(e, t) {
            var r = this.tryGetConcreteTree(e, t)
                , n = r.getDependencies();
            return n.length ? l(e, this, f.tooManyVariables(this.getSliderVariables(e, r)).setDependencies(n)) : l(e, this, this.tryGetConcreteTree(e, t))
        }
        function r(o) {
            return function(e, t) {
                var r = this.tryGetConcreteTree(e, t)
                    , n = r.getDependencies();
                if (n.length)
                    return l(e, this, f.tooManyVariables(this.getSliderVariables(e, r)).setDependencies(n));
                var i, a = l(e, this, this.tryGetConcreteTree(e, t));
                return r.isError || (a.evaluationState.expression_type = d.TTEST,
                    i = r.args.map(function(e) {
                        return e.asValue()
                    }),
                    a.evaluationState.ttest_results = o.apply(null, i)),
                    a
            }
        }
        c.Base.prototype.analyze = function(e, t) {
            return l(e, this, this.tryGetConcreteTree(e, t))
        }
            ,
            c.FunctionCall.prototype.analyze = function(e, t) {
                var r = this.tryGetConcreteTree(e, t);
                return !r.isError && m[this._symbol] && 0 === r.getDependencies().length && (r = v(r).tryGetConcreteTree(e, t)),
                    y(e, 0, this, r)
            }
            ,
            c.Expression.prototype.analyze = function(e, t) {
                return y(e, 0, this, this.tryGetConcreteTree(e, t))
            }
            ,
            c.FunctionDefinition.prototype.analyze = function(e, t) {
                if (p[this._symbol])
                    return this.asEquation().analyze(e, t);
                var r = this._symbol.split("_")[0];
                if (s[r])
                    return l(e, this, f.cannotRedefine(this._symbol, r));
                var n = this.tryGetConcreteTree(e, t);
                if (n.isError)
                    return l(e, this, n);
                var i = this._argSymbols
                    , a = n.getDependencies();
                if (-1 !== a.indexOf(this._symbol))
                    return l(e, this, f.selfReferentialFunction(this._symbol));
                var o = a.filter(function(e) {
                    return -1 === i.indexOf(e)
                });
                return e.unplottablePolarFunction(this._symbol, a) ? l(e, this, f.unplottablePolarFunction()) : o.some(e.assignmentForbidden) ? l(e, this, f.addArgumentsToDefinition(o, this._symbol, i).setDependencies(a)) : o.length ? l(e, this, f.tooManyVariables(this.getSliderVariables(e, n)).setDependencies(a)) : l(e, this, n)
            }
            ,
            c.Assignment.prototype.analyze = function(e, t, r) {
                var n = this._symbol;
                if (!e.validLHS(n))
                    return l(e, this, f.invalidLHS(n));
                if (p[n])
                    return this.asEquation().analyze(e, t);
                var i = this.tryGetConcreteTree(e, t);
                if (!i.isError && this._expression instanceof c.FunctionCall && m[this._expression._symbol] && 0 === i.getDependencies().length && (i = v(i).tryGetConcreteTree(e, t)),
                    i.isError)
                    return l(e, this, i);
                var a = i.getDependencies();
                if (this.isEquation(i))
                    return this.asEquation().analyze(e, t);
                if (1 < a.length) {
                    var o = this.getSliderVariables(e, i);
                    return o.length ? l(e, this, f.tooManyVariables(o).allowExport().setDependencies(a)) : l(e, this, i)
                }
                var s = this.getMoveStrategy(e, t, i, r, this.userData);
                if (s) {
                    var u = this.getDefaultDragMode(s);
                    return l(e, this, c.MovablePoint(i.args, s, u))
                }
                return l(e, this, i)
            }
            ,
            c.Regression.prototype.analyze = function(e, t, r, n, i) {
                return l(e, this, this.tryOptimize(e, t, r, n, i))
            }
            ,
            c.Polygon.prototype.analyze = t,
            c.Histogram.prototype.analyze = t,
            c.Object3D.prototype.analyze = t,
            c.DotPlot.prototype.analyze = t,
            c.BoxPlot.prototype.analyze = t,
            c.TTest.prototype.analyze = r(o.ttest),
            c.IndependentTTest.prototype.analyze = r(o.ittest),
            c.Stats.prototype.analyze = function(e, t) {
                var r = this.tryGetConcreteTree(e, t)
                    , n = r.getDependencies();
                if (n.length)
                    return l(e, this, f.tooManyVariables(this.getSliderVariables(e, r)).setDependencies(n));
                var i, a = l(e, this, this.tryGetConcreteTree(e, t));
                return r.isError || (a.evaluationState.expression_type = d.STATS,
                    i = r.args.map(function(e) {
                        return e.asValue()
                    }),
                    a.evaluationState.stats_results = o.stats.apply(null, i)),
                    a
            }
            ,
            c.Equation.prototype.analyze = c.BaseComparator.prototype.analyze = function(e, t) {
                var r = "=" !== this.getOperator();
                if (!g.plotInequalities && r)
                    return l(e, this, f.inequalitiesDisabled());
                var n = this.trySolve(e, t);
                if (n.isError)
                    return l(e, this, n);
                if (n instanceof c.SolvedEquation && n.getDependencies().length) {
                    var i = n.getDependencies().concat(n._symbol);
                    if (!e.validImplicitVariables(i))
                        return l(e, this, f.invalidImplicitVariables().setDependencies(i))
                }
                return this.getGraphMode(e, n) !== h.IMPLICIT || e.validImplicitVariables(n.getDependencies()) ? l(e, this, n) : l(e, this, f.invalidImplicitVariables().setDependencies(n.getDependencies()))
            }
            ,
            c.DoubleInequality.prototype.analyze = function(e, t) {
                if (!g.plotInequalities)
                    return l(e, this, f.inequalitiesDisabled());
                var r = this.tryGetConcreteTree(e, t);
                if (r.isError)
                    return l(e, this, r);
                var n = r.getDependencies();
                return i.table[this._operators[0]].direction !== i.table[this._operators[1]].direction ? l(e, this, f.mismatchedDoubleInequality()) : e.validDoubleInequalitySymbol(r._symbol) && e.validDoubleInequalityVariables(n) ? 2 < n.length ? l(e, this, f.tooManyVariables(this.getSliderVariables(e, r)).setDependencies(n)) : -1 !== r._expressions[0].getDependencies().indexOf(r._symbol) || -1 !== r._expressions[1].getDependencies().indexOf(r._symbol) ? l(e, this, f.complicatedDoubleInequality().setDependencies(n)) : l(e, this, r) : l(e, this, f.invalidDoubleInequalityVariables().setDependencies(n))
            }
            ,
            c.And.prototype.analyze = function(e, t) {
                var r = this.tryGetConcreteTree(e, t);
                if (r.isError)
                    return l(e, this, r);
                var n = r.getDependencies();
                return n.length ? e.validDoubleInequalityVariables(n) ? l(e, this, f.complicatedDoubleInequality().setDependencies(n)) : l(e, this, f.tooManyVariables(this.getSliderVariables(e, r)).setDependencies(n)) : l(e, this, r)
            }
            ,
            c.OrderedPair.prototype.analyze = function(e, t, r) {
                var n = this.tryGetConcreteTree(e, t);
                if (n.isError)
                    return l(e, this, n);
                var i = this.getMoveStrategy(e, t, n, r, this.userData);
                if (i) {
                    var a = this.getDefaultDragMode(i);
                    return l(e, this, c.MovablePoint(n.args, i, a))
                }
                return y(e, 0, this, n)
            }
            ,
            c.Table.prototype.analyze = function(e, t) {
                for (var r = Object.create(t), n = [], i = 0; i < this.columns.length; i++) {
                    var a, o = this.columns[i].analyze(e, r, t);
                    0 === i && (o.concreteTree.isIndependent ? e.validFirstColumnVariable(o.concreteTree.header._symbol) ? o.concreteTree.header._symbol : o = l(e, this.columns[i], f.invalidFirstTableColumn()) : o = l(e, this.columns[i], f.invalidDependentFirstTableColumn())),
                        o.concreteTree.isIndependent ? o.rawTree.exportToLocal(o.concreteTree, r) : o.concreteTree.isError || (a = function(e, t) {
                            return e.filter(function(e) {
                                return !t[e]
                            })
                        }(o.concreteTree.header.getDependencies(), r)).length && (o = l(e, this.columns[i], f.tooManyVariables(a).setDependencies(a))),
                        n.push(o.concreteTree)
                }
                var s = c.Table(n)
                    , u = l(e, this, s);
                return u.evaluationState.is_graphable = !0,
                    u
            }
            ,
            c.TableColumn.prototype.analyze = function(e, t, r) {
                var n = this.header.tableError();
                if (n)
                    return l(e, this, f.invalidTableHeader(n));
                var i = this.tryGetConcreteTree(e, t, r);
                if (i.isError)
                    return l(e, this, i);
                if (i.header.isError)
                    return l(e, this, i.header);
                if (i.values.isError)
                    return l(e, this, i.values);
                for (var a, o, s = 0; s < i.values.length; s++) {
                    i.values[s].isError || ((a = this.values[s] && this.values[s].tableError()) ? i.values[s] = f.invalidTableEntry(a) : (o = i.values[s].getDependencies()).length && (i.values[s] = f.tooManyVariables(o).setDependencies(o)))
                }
                return l(e, this, i)
            }
            ,
            c.Image.prototype.analyze = function(e, t, r) {
                var n = this.tryGetConcreteTree(e, t);
                if (n.radianAngle.isError || n.center.isError || n.width.isError || n.height.isError || n.opacity.isError)
                    return l(e, this, n);
                var i = n.center.getDependencies()
                    , a = n.radianAngle.getDependencies()
                    , o = n.width.getDependencies()
                    , s = n.height.getDependencies()
                    , u = n.opacity.getDependencies();
                return i.length || a.length || o.length || s.length || u.length ? l(e, this, c.Image({
                    center: i.length ? f.tooManyVariables(a).setDependencies(i) : n.center,
                    radianAngle: a.length ? f.tooManyVariables(a).setDependencies(a) : n.radianAngle,
                    width: o.length ? f.tooManyVariables(o).setDependencies(o) : n.width,
                    height: s.length ? f.tooManyVariables(s).setDependencies(s) : n.height,
                    opacity: u.length ? f.tooManyVariables(u).setDependencies(u) : n.opacity
                })) : (n.moveStrategy = this.getMoveStrategy(e, t, n, r, this.userData),
                    l(e, this, n))
            }
            ,
            c.Simulation.prototype.analyze = function(e, t, r) {
                var n = this.tryGetConcreteTree(e, t);
                return l(e, this, n)
            }
            ,
            c.Slider.prototype.analyze = function(e, t) {
                var r, n, i, a = this.tryGetConcreteTree(e, t), o = a.sliderInfo, s = (n = o.missingVars.length ? (r = u.unique(o.missingVars),
                    l(e, this, f.tooManyVariables(e.sliderVariables(r)).setDependencies(r).allowExport())) : l(e, this, a)).evaluationState;
                return g.sliders && (s.assignment = o.exportedSymbol,
                    s.slider_min_number = o.values.min,
                    s.slider_max_number = o.values.max,
                    s.slider_step_number = o.values.step,
                    s.slider_min_valid = o.valids.min,
                    s.slider_max_valid = o.valids.max,
                    s.slider_step_valid = o.valids.step,
                    i = s.slider_min_valid && s.slider_max_valid && s.slider_step_valid,
                    s.is_slider = !0,
                    s.raw_slider_latex = this.getInputString(),
                    s.is_slidable = i,
                    s.is_animatable = s.is_slidable && !s.is_graphable,
                o.errMsg && (s.error = o.errMsg.getError())),
                    delete s.is_evaluable,
                    delete s.zero_values,
                    n
            }
    });
    _("core/math/features/analyzeFourFunction", ["require", "parsenodes", "core/math/statementanalysis", "core/math/errormsg", "core/math/parsenode/builtinfunction", "core/math/builtinconstants"], function(e) {
        "use strict";
        var t = e("parsenodes")
            , o = e("core/math/statementanalysis")
            , s = e("core/math/errormsg")
            , u = e("core/math/parsenode/builtinfunction")
            , c = e("core/math/builtinconstants");
        function r(e, t) {
            return o(e, this, s.inequalitiesUnsupported())
        }
        t.Base.prototype.analyzeFourFunction = function(e, t) {
            var r = this.tryGetConcreteTree(e, t);
            return r.isError ? o(e, this, r) : o(e, this, s.parseError())
        }
            ,
            t.Expression.prototype.analyzeFourFunction = function(e, t) {
                var r = this.tryGetConcreteTree(e, t);
                if (r.isError)
                    return o(e, this, r);
                var n = r.getDependencies();
                if (0 < n.length) {
                    var i = n[0]
                        , a = u.hasOwnProperty(i) ? s.functionUnsupported(i) : c.hasOwnProperty(i) ? s.constantUnsupported(i) : s.variablesUnsupported(i);
                    return o(e, this, a)
                }
                return o(e, this, r)
            }
            ,
            t.Assignment.prototype.analyzeFourFunction = function(e, t) {
                return o(e, this, s.assignmentsUnsupported())
            }
            ,
            t.FunctionDefinition.prototype.analyzeFourFunction = function(e, t) {
                return o(e, this, s.functionDefinitionsUnsupported())
            }
            ,
            t.Equation.prototype.analyzeFourFunction = function(e, t) {
                return o(e, this, s.equationsUnsupported())
            }
            ,
            t.And.prototype.analyzeFourFunction = r,
            t.DoubleInequality.prototype.analyzeFourFunction = r,
            t.BaseComparator.prototype.analyzeFourFunction = r,
            t.Regression.prototype.analyzeFourFunction = function(e, t) {
                return o(e, this, s.regressionsUnsupported())
            }
            ,
            t.OrderedPair.prototype.analyzeFourFunction = function(e, t) {
                return o(e, this, s.pointsUnsupported())
            }
            ,
            t.RGBColor.prototype.analyzeFourFunction = function(e, t) {
                return o(e, this, s.colorsUnsupported())
            }
    });
    _("core/math/features/analyzeScientific", ["require", "parsenodes", "core/math/statementanalysis", "core/math/errormsg", "core/math/builtinframe"], function(e) {
        "use strict";
        var t = e("parsenodes")
            , o = e("core/math/statementanalysis")
            , s = e("core/math/errormsg")
            , u = e("core/math/builtinframe");
        function r(e, t) {
            return o(e, this, s.inequalitiesUnsupported())
        }
        t.Base.prototype.analyzeScientific = function(e, t) {
            var r = this.tryGetConcreteTree(e, t);
            return r.isError ? o(e, this, r) : o(e, this, s.parseError())
        }
            ,
            t.Expression.prototype.analyzeScientific = function(e, t) {
                var r = this.tryGetConcreteTree(e, t);
                if (r.isError)
                    return o(e, this, r);
                var n = r.getDependencies();
                return 0 < n.length ? o(e, this, s.tooManyVariables(n)) : o(e, this, r)
            }
            ,
            t.Assignment.prototype.analyzeScientific = function(e, t) {
                var r = this._symbol;
                if (u[r])
                    return o(e, this, s.cannotRedefine(r));
                var n = this.tryGetConcreteTree(e, t);
                if (n.isError)
                    return o(e, this, n);
                var i = n.getDependencies();
                return this.isEquation(n) ? o(e, this, s.equationsUnsupported()) : 0 < i.length ? o(e, this, s.tooManyVariables(i)) : o(e, this, n)
            }
            ,
            t.FunctionDefinition.prototype.analyzeScientific = function(e, t) {
                if (u[this._symbol])
                    return o(e, this, s.cannotRedefine(this._symbol));
                var r = this.tryGetConcreteTree(e, t);
                if (r.isError)
                    return o(e, this, r);
                var n = this._argSymbols
                    , i = r.getDependencies();
                if (-1 !== i.indexOf(this._symbol))
                    return o(e, this, s.selfReferentialFunction(this._symbol));
                var a = i.filter(function(e) {
                    return -1 === n.indexOf(e)
                });
                return a.length ? o(e, this, s.addArgumentsToDefinition(a, this._symbol, n)) : o(e, this, r)
            }
            ,
            t.Equation.prototype.analyzeScientific = function(e, t) {
                return o(e, this, s.equationsUnsupported())
            }
            ,
            t.And.prototype.analyzeScientific = r,
            t.DoubleInequality.prototype.analyzeScientific = r,
            t.BaseComparator.prototype.analyzeScientific = r,
            t.Regression.prototype.analyzeScientific = function(e, t) {
                return o(e, this, s.regressionsUnsupported())
            }
            ,
            t.OrderedPair.prototype.analyzeScientific = function(e, t) {
                return o(e, this, s.pointsUnsupported())
            }
            ,
            t.RGBColor.prototype.analyzeScientific = function(e, t) {
                return o(e, this, s.colorsUnsupported())
            }
    });
    _("core/math/features/analyzeSingleExpressionScientific", ["require", "parsenodes", "core/math/statementanalysis", "core/math/errormsg", "core/math/parsenode/builtinfunction", "core/math/builtinconstants"], function(e) {
        "use strict";
        var t = e("parsenodes")
            , o = e("core/math/statementanalysis")
            , s = e("core/math/errormsg")
            , u = e("core/math/parsenode/builtinfunction")
            , c = e("core/math/builtinconstants");
        function r(e, t) {
            return o(e, this, s.inequalitiesUnsupported())
        }
        t.Base.prototype.analyzeSingleExpressionScientific = function(e, t) {
            var r = this.tryGetConcreteTree(e, t);
            return r.isError ? o(e, this, r) : o(e, this, s.parseError())
        }
            ,
            t.Expression.prototype.analyzeSingleExpressionScientific = function(e, t) {
                var r = this.tryGetConcreteTree(e, t);
                if (r.isError)
                    return o(e, this, r);
                var n = r.getDependencies();
                if (0 < n.length) {
                    var i = n[0]
                        , a = u.hasOwnProperty(i) ? s.functionUnsupported(i) : c.hasOwnProperty(i) ? s.constantUnsupported(i) : s.variablesUnsupported(i);
                    return o(e, this, a)
                }
                return o(e, this, r)
            }
            ,
            t.Assignment.prototype.analyzeSingleExpressionScientific = function(e, t) {
                return o(e, this, s.assignmentsUnsupported())
            }
            ,
            t.FunctionDefinition.prototype.analyzeSingleExpressionScientific = function(e, t) {
                return o(e, this, s.functionDefinitionsUnsupported())
            }
            ,
            t.Equation.prototype.analyzeSingleExpressionScientific = function(e, t) {
                return o(e, this, s.equationsUnsupported())
            }
            ,
            t.And.prototype.analyzeSingleExpressionScientific = r,
            t.DoubleInequality.prototype.analyzeSingleExpressionScientific = r,
            t.BaseComparator.prototype.analyzeSingleExpressionScientific = r,
            t.Regression.prototype.analyzeSingleExpressionScientific = function(e, t) {
                return o(e, this, s.regressionsUnsupported())
            }
            ,
            t.OrderedPair.prototype.analyzeSingleExpressionScientific = function(e, t) {
                return o(e, this, s.pointsUnsupported())
            }
            ,
            t.RGBColor.prototype.analyzeSingleExpressionScientific = function(e, t) {
                return o(e, this, s.colorsUnsupported())
            }
    });
    _("core/lib/dragmode", ["require", "exports"], function(e, t) {
        "use strict";
        var i, r;
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.reconcileDragMode = t.DragMode = void 0,
            (r = i = t.DragMode || (t.DragMode = {})).NONE = "NONE",
            r.X = "X",
            r.Y = "Y",
            r.XY = "XY",
            r.AUTO = "AUTO",
            t.reconcileDragMode = function(e, t) {
                var r, n = !(r = t) || "none" === r[0].type && "none" === r[1].type ? i.NONE : "none" === r[1].type ? i.X : "none" === r[0].type ? i.Y : i.XY;
                switch (e) {
                    case i.NONE:
                        return i.NONE;
                    case i.AUTO:
                    case i.XY:
                        return n;
                    case i.X:
                        return n === i.X || n === i.XY ? i.X : i.NONE;
                    case i.Y:
                        return n === i.Y || n === i.XY ? i.Y : i.NONE;
                    default:
                        return i.NONE
                }
            }
    });
    _("core/math/features/getgraphmode", ["require", "parsenodes", "core/types/graphmode", "core/lib/dragmode", "core/lib/dragmode", "core/math/types"], function(e) {
        "use strict";
        var n = e("parsenodes")
            , o = e("core/types/graphmode")
            , s = e("core/lib/dragmode").reconcileDragMode
            , u = e("core/lib/dragmode").DragMode
            , c = e("core/math/types");
        function i(e, t) {
            var r, n, i, a = t.getDependencies();
            switch (t.valueType) {
                case c.Point:
                case c.ListOfPoint:
                    return t.isMovablePoint && (r = this.userData,
                        n = t,
                        i = !r || !r.hasOwnProperty("dragMode") || r.dragMode === u.AUTO ? n.defaultDragMode : r.dragMode,
                    s(i, n.moveStrategy) !== u.NONE) ? o.XYPOINT_MOVABLE : 0 === a.length ? o.XYPOINT : e.validParametricVariables(a) ? 2 === e.dimensions() ? o.PARAMETRIC : o.PARAMETRIC_CURVE_3D : o.NONE;
                case c.Number:
                case c.ListOfNumber:
                    return 2 === e.dimensions() && 1 === a.length ? o.Y : 3 === e.dimensions() && 2 === a.length ? o.Z_3D : o.NONE;
                default:
                    return o.NONE
            }
        }
        function a(e, t) {
            var r = t._expression.getDependencies();
            if (1 < r.length)
                return o.NONE;
            if (t._expression.valueType !== c.Number && t._expression.valueType !== c.ListOfNumber)
                return o.NONE;
            var n = t._symbol;
            return e.graphMode(n, r)
        }
        function t(e, t) {
            return t.isError ? o.NONE : o.VISUALIZATION
        }
        n.Base.prototype.getGraphMode = function(e, t) {
            return o.NONE
        }
            ,
            n.Expression.prototype.getGraphMode = i,
            n.Equation.prototype.getGraphMode = n.BaseComparator.prototype.getGraphMode = function(e, t) {
                var r = t.getDependencies();
                return t.isConstant ? o.NONE : t instanceof n.SolvedEquation ? 0 === r.length ? e.graphableAsConstant(t._symbol) ? e.constantGraphMode(t._symbol) : o.NONE : a(e, t) : 1 === r.length || 2 === r.length ? o.IMPLICIT : o.NONE
            }
            ,
            n.DoubleInequality.prototype.getGraphMode = function(e, t) {
                return e.constantGraphMode(t._symbol)
            }
            ,
            n.Assignment.prototype.getGraphMode = function(e, t) {
                if (t instanceof n.SolvedEquation)
                    return a(e, t);
                if (this.isEquation(t))
                    return this.asEquation().getGraphMode(e, t);
                var r = t.getDependencies();
                switch (t.valueType) {
                    case c.Number:
                    case c.ListOfNumber:
                    case c.EmptyList:
                        switch (r.length) {
                            case 0:
                                return e.graphableAsConstant(this._symbol) ? e.constantGraphMode(this._symbol) : o.NONE;
                            case 1:
                                return t.valueType !== c.ListOfNumber || e.graphableListVariables(this._symbol, r[0]) ? this.isSlider ? o.NONE : e.graphMode(this._symbol, r) : o.NONE;
                            case 2:
                                return 3 === e.dimensions() && "z" === this._symbol ? o.Z_3D : o.NONE;
                            default:
                                return o.NONE
                        }
                        break;
                    default:
                        return i.call(this, e, t)
                }
            }
            ,
            n.FunctionDefinition.prototype.getGraphMode = function(e, t) {
                if (1 !== this._argSymbols.length)
                    return o.NONE;
                var r = e.graphMode(this._symbol, this._argSymbols)
                    , n = t.getDependencies();
                switch (t.valueType) {
                    case c.Number:
                    case c.ListOfNumber:
                        switch (n.length) {
                            case 0:
                                return r;
                            case 1:
                                return n[0] !== this._argSymbols[0] ? o.NONE : r;
                            default:
                                return o.NONE
                        }
                        break;
                    default:
                        return o.NONE
                }
            }
            ,
            n.Regression.prototype.getGraphMode = function(e, t) {
                return !this.isLhsSimple || !t.isModelValid || 1 !== t.model.getDependencies().length ? o.NONE : o.Y
            }
            ,
            n.Polygon.prototype.getGraphMode = function(e, t) {
                return t.isError ? o.NONE : o.POLYGONFILL
            }
            ,
            n.Object3D.prototype.getGraphMode = function(e, t) {
                return t.isError ? o.NONE : o.OBJECT3D
            }
            ,
            n.Histogram.prototype.getGraphMode = t,
            n.DotPlot.prototype.getGraphMode = t,
            n.BoxPlot.prototype.getGraphMode = t,
            n.Image.prototype.getGraphMode = function(e, t) {
                return !this.userData.showPoints || this.center.isError || this.radianAngle.isError || this.width.isError || this.height.isError || this.opacity.isError ? o.NONE : o.XYPOINT
            }
    });
    _("core/lib/color-helpers", ["require", "exports"], function(e, t) {
        "use strict";
        function u(e) {
            return c(e) ? (e.match(/^#([A-Fa-f0-9]{3})$/g) && (e = "#" + e[1] + e[1] + e[2] + e[2] + e[3] + e[3]),
                e.toLowerCase()) : e
        }
        function c(e) {
            return "string" == typeof e && (e.match(/^#([A-Fa-f0-9]{3})$/g) || e.match(/^#([A-Fa-f0-9]{6})$/g))
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.colors = t.getDisplayColor = t.mutateOpacity = t.parseHex = t.invertColor = t.shadeColor = t.isValidHexColor = t.normalizeColor = void 0,
            t.normalizeColor = u,
            t.isValidHexColor = c,
            t.shadeColor = function(e, t) {
                if (!c(e = u(e)))
                    return e;
                1 < t && (t = 1),
                t < -1 && (t = -1);
                var r = parseInt(e.slice(1), 16)
                    , n = t < 0 ? 0 : 255
                    , i = t < 0 ? -1 * t : t
                    , a = r >> 16
                    , o = r >> 8 & 255
                    , s = 255 & r;
                return "#" + (16777216 + 65536 * (Math.round((n - a) * i) + a) + 256 * (Math.round((n - o) * i) + o) + (Math.round((n - s) * i) + s)).toString(16).slice(1)
            }
            ,
            t.invertColor = function(e) {
                if (!c(e = u(e)))
                    return e;
                var t = "0123456789abcdef";
                return "#" + e.slice(1).split("").map(function(e) {
                    return t[15 - t.indexOf(e)]
                }).join("")
            }
            ,
            t.parseHex = function(e) {
                var t, r, n;
                return n = 3 === (e = e.replace(/#/, "")).length ? (t = parseInt(e.slice(0, 1) + e.slice(0, 1), 16),
                    r = parseInt(e.slice(1, 2) + e.slice(1, 2), 16),
                    parseInt(e.slice(2, 3) + e.slice(2, 3), 16)) : 6 === e.length ? (t = parseInt(e.slice(0, 2), 16),
                    r = parseInt(e.slice(2, 4), 16),
                    parseInt(e.slice(4, 6), 16)) : r = t = 0,
                    {
                        r: t,
                        g: r,
                        b: n
                    }
            }
            ,
            t.mutateOpacity = function(e, t) {
                var r = /(rgba\([\d]+\,\ ?[\d]+\,\ ?[\d]+\,\ ?)[\d.]+(\))/;
                return e.match(r) ? e.replace(r, "$1" + t + "$2") : e
            }
            ,
            t.getDisplayColor = function(e, t, r) {
                if (t && t.colorLatexValue) {
                    var n = t.colorLatexValue;
                    return Array.isArray(n) && void 0 !== r ? n[r] || "#000000" : n
                }
                return e.color
            }
            ,
            t.colors = {
                RED: "#c74440",
                BLUE: "#2d70b3",
                GREEN: "#388c46",
                PURPLE: "#6042a6",
                ORANGE: "#fa7e19",
                BLACK: "#000000",
                GRAY: "#aaaaaa"
            }
    });
    _("core/math/features/getgraphinfo", ["require", "parsenodes", "core/math/builtinframe", "core/math/domaintypes", "core/math/policy", "core/lib/color-helpers"], function(e) {
        "use strict";
        var t = e("parsenodes")
            , r = e("core/math/builtinframe")
            , o = e("core/math/domaintypes")
            , n = e("core/math/policy").defaultPolicy
            , s = e("core/lib/color-helpers").getDisplayColor;
        t.Base.prototype.getGraphInfo = function(e, t, r) {
            var n, i, a = t.getDependencies();
            switch (a.length) {
                case 0:
                    n = t.getLinearCoefficients(),
                        i = t.boundDomain("x");
                    break;
                case 1:
                    "known" === (i = t.boundDomain(a[0])).type && (n = t.getLinearCoefficients());
                    break;
                case 2:
                    i = o.unknownDomain()
            }
            return {
                graphMode: this.getGraphMode(e, t),
                color: s(this.userData, this.metaData, r),
                pointStyle: this.userData.pointStyle,
                lineStyle: this.userData.lineStyle,
                operator: this.getOperator(),
                isLinear: !!n,
                linearCoefficients: n,
                domainBound: i
            }
        }
            ,
            t.Base.prototype.getLinearCoefficients = function() {
                var e = this.getDependencies();
                switch (e.length) {
                    case 0:
                        return [+this.asValue(), 0];
                    case 1:
                        if (1 < this.polynomialOrder(e[0]))
                            return;
                        var t = this.getPolynomialCoefficients(e[0]);
                        return [t[0] ? +t[0].tryGetConcreteTree(n, r).asValue() : 0, t[1] ? +t[1].tryGetConcreteTree(n, r).asValue() : 0];
                    default:
                        return
                }
            }
            ,
            t.OrderedPair.prototype.getLinearCoefficients = function() {
                var e = this.args[0].getLinearCoefficients()
                    , t = this.args[1].getLinearCoefficients();
                if (e && t)
                    return [e, t]
            }
    });
    _("core/math/features/getMoveStrategy", ["require", "parsenodes", "core/math/types", "core/math/maybe-rational", "core/math/builtinframe", "core/math/functions"], function(e) {
        "use strict";
        var E = e("parsenodes")
            , M = e("core/math/types")
            , t = e("core/math/maybe-rational").maybeRational
            , m = e("core/math/builtinframe")
            , D = e("core/math/functions")
            , g = E.Constant(t(0, 1));
        function w(e) {
            return {
                type: "none",
                inputString: e
            }
        }
        function P(e) {
            return {
                type: "updateCoordinate",
                inputString: e
            }
        }
        function O(e, t, r) {
            return {
                type: "updateSlider",
                inputString: e,
                id: t,
                coefficients: r
            }
        }
        function T(e, t, r, n, i, a) {
            for (var o = t.getDependencies(), s = 0; s < o.length; s++)
                if (i[o[s]])
                    return !1;
            for (var u = o.length - 1; 0 <= u; u--) {
                var c = o[u];
                if (!a[c]) {
                    var l = n[c];
                    if (void 0 !== l) {
                        var p = r[c];
                        if (1 === p.order) {
                            var f = p.tree.getPolynomialCoefficients(c)
                                , h = f[1] ? f[1].getConcreteTree(e, m) : g
                                , d = f[0] ? f[0].getConcreteTree(e, m) : g;
                            if (d.isConstant && h.isConstant)
                                if (isFinite(d.asValue()) && isFinite(h.asValue()))
                                    if (0 !== h.asValue())
                                        return {
                                            symbol: c,
                                            id: l,
                                            coefficients: [-d.asValue() / h.asValue(), 1 / h.asValue()]
                                        }
                        }
                    }
                }
            }
            return !1
        }
        function L(e, t) {
            var r = function(e) {
                for (var t = {}, r = 0; r < e.length; r++)
                    t[e[r]] = !0;
                return t
            }(e)
                , n = {};
            for (var i in t) {
                var a = t[i].evaluationState.assignment;
                t[i].evaluationState.is_slidable && r[a] && (n[a] = i)
            }
            return n
        }
        function I(e, t, r, n) {
            for (var i = [], a = 0; a < r.length; a++) {
                var o = r[a]
                    , s = {};
                i.push(s);
                for (var u = 0; u < n.length; u++) {
                    var c = n[u]
                        , l = Object.create(t);
                    l[c] = E.FreeVariable(c);
                    var p = o.tryGetConcreteTree(e, l);
                    p.isError ? s[c] = {
                        tree: p,
                        order: 1 / 0
                    } : s[c] = {
                        tree: p,
                        order: p.polynomialOrder(c)
                    }
                }
            }
            return i
        }
        function C(e, t, r) {
            for (var n = 0; n < e.length; n++) {
                var i = e[n];
                0 !== t[i].order && (r[i] = !0)
            }
        }
        E.Base.prototype.getMoveStrategy = function() {}
            ,
            E.Assignment.prototype.getMoveStrategy = function(e, t, r, n, i) {
                if (this._expression instanceof E.OrderedPair)
                    return this._expression.getMoveStrategy(e, t, r, n, i)
            }
            ,
            E.OrderedPair.prototype.getMoveStrategy = function(e, t, r, n, i) {
                if ((!i || !1 !== i.shouldGraph) && r.valueType === M.Point && 0 === r.getDependencies().length) {
                    for (var a, o, s, u, c = L(this.getDependencies(), n), l = Object.keys(c), p = this.args, f = I(e, t, p, l), h = [], d = {}, m = {}, g = 0; g < 2; g++) {
                        var y, v = p[g], b = v.getInputString();
                        v.isConstant ? h[g] = P(b) : ((y = T(e, v, f[g], c, d, m)) && (h[g] = O(b, y.id, y.coefficients),
                            d[y.symbol] = !0,
                            C(l, f[g], m)),
                        h[g] || (h[g] = w(b)))
                    }
                    if ("none" !== h[0].type || "none" !== h[1].type)
                        return h;
                    if (1 === l.length) {
                        var x, S = l[0], _ = c[S];
                        try {
                            x = E.OrderedPair([f[0][S].tree, f[1][S].tree]).getCompiledFunction()
                        } catch (e) {
                            return
                        }
                        return D.dehydrateCompiledFunction(x),
                            [(a = p[0].getInputString(),
                                s = n[o = _].evaluationState,
                                u = x,
                                {
                                    type: "updateSliderNonlinear",
                                    inputString: a,
                                    id: o,
                                    initialValue: s.constant_value,
                                    min: s.slider_min_number,
                                    max: s.slider_max_number,
                                    compiled: u
                                }), w(p[1].getInputString())]
                    }
                }
            }
            ,
            E.Image.prototype.getMoveStrategy = function(e, t, r, n, i) {
                if ((!i || !1 !== i.shouldGraph) && (!i || !1 !== i.showPoints) && "OrderedPair" === r.center.type && r.center.args[0].isConstant && r.center.args[1].isConstant && r.width.isConstant && r.height.isConstant && r.radianAngle.isConstant && r.opacity.isConstant) {
                    var a = L(this.getDependencies(), n)
                        , o = Object.keys(a)
                        , s = [this.width, this.height];
                    "OrderedPair" === this.center.type && s.push(this.center.args[0], this.center.args[1]);
                    for (var u = [], c = {}, l = {}, p = I(e, t, s, o), f = [2, 3, 0, 1], h = 0; h < f.length; h++) {
                        var d, m, g = f[h], y = s[g];
                        y ? (d = y.getInputString(),
                            y.isConstant ? u[g] = P(d) : ((m = T(e, y, p[g], a, c, l)) && (u[g] = O(d, m.id, m.coefficients),
                                c[m.symbol] = !0,
                                C(o, p[g], l)),
                            u[g] || (u[g] = w(d)))) : u[g] = w("")
                    }
                    if ("none" !== u[0].type || "none" !== u[1].type || "none" !== u[2].type || "none" !== u[3].type)
                        return u
                }
            }
    });
    _("core/math/features/getDefaultDragMode", ["require", "parsenodes", "core/lib/dragmode"], function(e) {
        "use strict";
        var t = e("parsenodes")
            , r = e("core/lib/dragmode").DragMode;
        t.Base.prototype.getMoveStrategy = function() {
            return r.NONE
        }
            ,
            t.Assignment.prototype.getDefaultDragMode = function(e) {
                return "none" !== e[0].type && "none" !== e[1].type ? r.XY : "none" !== e[0].type ? r.X : "none" !== e[1].type ? r.Y : r.NONE
            }
            ,
            t.OrderedPair.prototype.getDefaultDragMode = function(e) {
                return "updateSlider" === e[0].type && "updateSlider" === e[1].type ? r.XY : "updateSlider" === e[0].type ? r.X : "updateSlider" === e[1].type ? r.Y : r.NONE
            }
    });
    _("core/math/features/tableinfo", ["require", "parsenodes", "core/math/types", "core/lib/label", "core/math/distribution-spec"], function(e) {
        "use strict";
        var i = e("parsenodes")
            , a = i.List
            , o = e("core/math/types")
            , s = e("core/lib/label")
            , u = e("core/math/distribution-spec").getFunctionSpecFromTree;
        i.Base.prototype.tableInfo = function(e, t) {
            return !1
        }
            ,
            i.Identifier.prototype.tableInfo = function(e, t) {
                return !!e.validFirstColumnVariable(this._symbol) && {
                    independent_variable: this._symbol,
                    dependent_column: this.getInputString(),
                    by_reference: !1
                }
            }
            ,
            i.Expression.prototype.tableInfo = function(e, t) {
                var r = t.getDependencies();
                if (u(this))
                    return !1;
                switch (t.valueType) {
                    case o.Point:
                    case o.ListOfPoint:
                        return 0 !== r.length ? !1 : (!t.isMovablePoint || "updateSlider" !== t.moveStrategy[0].type && "updateSlider" !== t.moveStrategy[1].type) && {
                            independent_variable: "x",
                            dependent_column: "y",
                            by_reference: !1,
                            values: a.wrap(t).mapElements(e, function(e) {
                                return e.asArray()
                            })
                        };
                    case o.Number:
                        if (1 !== r.length)
                            return !1;
                        var n = r[0];
                        return e.validFirstColumnVariable(n) ? {
                            independent_variable: n,
                            dependent_column: this.getInputString(),
                            by_reference: !1
                        } : !1;
                    default:
                        return !1
                }
            }
            ,
            i.Assignment.prototype.tableInfo = function(e, t) {
                if (t instanceof i.SolvedEquation)
                    return !1;
                if (!this.getInputString().length)
                    return !1;
                if (u(this))
                    return !1;
                var r, n = t.getDependencies();
                if (1 < n.length)
                    return !1;
                if (0 === n.length) {
                    if (!e.tableableAsConstant(this._symbol))
                        return !1;
                    r = e.implicitIndependent(this._symbol)
                } else
                    r = n[0];
                return !!e.validFirstColumnVariable(r) && {
                    independent_variable: r,
                    dependent_column: e.assignmentForbidden(this._symbol) ? s.trimLatex(this.getInputString().replace(/[^=]*=/, "")) : s.trimLatex(this.getInputString().split("=")[0]),
                    by_reference: !e.assignmentForbidden(this._symbol)
                }
            }
            ,
            i.FunctionDefinition.prototype.tableInfo = function(e, t) {
                if (1 !== this._argSymbols.length)
                    return !1;
                if (!this.getInputString().length)
                    return !1;
                if (1 < t.getDependencies().length)
                    return !1;
                var r = this._argSymbols[0];
                if (!e.validFirstColumnVariable(r))
                    return !1;
                var n = e.assignmentForbidden(this._symbol);
                return {
                    independent_variable: r,
                    dependent_column: n ? s.trimLatex(this.getInputString().replace(/[^=]*=/, "")) : s.trimLatex(this.getInputString().split("=")[0]),
                    by_reference: !n
                }
            }
            ,
            i.BaseComparator.prototype.tableInfo = function(e, t) {
                return !1
            }
            ,
            i.DoubleInequality.prototype.tableInfo = function(e, t) {
                return !1
            }
            ,
            i.Equation.prototype.tableInfo = function(e, t) {
                return !1
            }
    });
    _("core/math/features/tableerror", ["require", "parsenodes", "core/lib/worker-i18n"], function(e) {
        "use strict";
        var t = e("parsenodes")
            , r = e("core/lib/worker-i18n");
        t.Base.prototype.tableError = function() {
            return this.isInequality() ? r.s("shared-calculator-error-table-inequality-supplement") : !(this instanceof t.Expression) && r.s("shared-calculator-error-table-generic-supplement")
        }
            ,
            t.List.prototype.tableError = function() {
                return r.s("shared-calculator-error-table-list-supplement")
            }
            ,
            t.Equation.prototype.tableError = t.Assignment.prototype.tableError = function() {
                return r.s("shared-calculator-error-table-equation-supplement")
            }
            ,
            t.FunctionDefinition.prototype.tableError = function() {
                return r.s("shared-calculator-error-table-function-definition-supplement")
            }
            ,
            t.Regression.prototype.tableError = function() {
                return r.s("shared-calculator-error-table-regression-supplement")
            }
    });
    _("core/math/curve-accumulator", ["require", "exports", "core/math/distance"], function(e, t, a) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.Accumulator = void 0;
        var r = (n.prototype.colinear = function(e, t, r) {
            this.map && (e = this.map(e),
                t = this.map(t),
                r = this.map(r));
            var n = a.pointToSegmentParameter(r[0], r[1], r[2] || 0, e[0], e[1], e[2] || 0, t[0], t[1], t[2] || 0);
            if (n < 1)
                return !1;
            var i = [e[0] + n * (t[0] - e[0]), e[1] + n * (t[1] - e[1]), 3 === e.length ? e[2] + n * (t[2] - e[2]) : 0];
            return Math.abs(r[0] - i[0]) <= this.xtolerance && Math.abs(r[1] - i[1]) <= this.ytolerance && (2 === e.length || Math.abs(r[2] - i[2]) <= this.ztolerance)
        }
            ,
            n.prototype.addPoint = function(e) {
                if (this.dimensions = e.length,
                this.xtolerance < 0 && this.ytolerance < 0 && (2 === this.dimensions || this.ztolerance < 0))
                    this.segment.push.apply(this.segment, e);
                else if (this.segment.length) {
                    var t = 2 === this.dimensions ? [this.segment[this.segment.length - 2], this.segment[this.segment.length - 1]] : [this.segment[this.segment.length - 3], this.segment[this.segment.length - 2], this.segment[this.segment.length - 1]];
                    if (e[0] !== t[0] || e[1] !== t[1] || e[2] !== t[2]) {
                        if (!this.pivotPoint || !this.pendingPoint)
                            return this.pivotPoint = e,
                                void (this.pendingPoint = e);
                        (!this.colinear(t, this.pivotPoint, e) || a.hypot(t[0] - e[0], t[1] - e[1], (t[2] || 0) - (e[2] || 0)) < a.hypot(t[0] - this.pendingPoint[0], t[1] - this.pendingPoint[1], (t[2] || 0) - (this.pendingPoint[2] || 0))) && (this.flushPending(),
                            this.pivotPoint = e),
                            this.pendingPoint = e
                    }
                } else
                    this.segment.push.apply(this.segment, e)
            }
            ,
            n.prototype.flushPending = function() {
                this.pendingPoint && (this.segment.push.apply(this.segment, this.pendingPoint),
                    this.pivotPoint = void 0,
                    this.pendingPoint = void 0)
            }
            ,
            n.prototype.breakSegment = function() {
                this.flushPending(),
                this.segment.length > (this.dimensions || 2) && this.segments.push(this.segment),
                    this.segment = []
            }
            ,
            n.prototype.getSegments = function() {
                return this.breakSegment(),
                    this.segments
            }
            ,
            n.prototype.finish = function() {
                return {
                    segments: this.getSegments(),
                    resolved: !0
                }
            }
            ,
            n);
        function n(e) {
            e ? (this.xtolerance = e.xtolerance || e.tolerance || 0,
                this.ytolerance = e.ytolerance || e.tolerance || 0,
                this.ztolerance = e.ztolerance || e.tolerance || 0,
                this.map = e.map) : this.xtolerance = this.ytolerance = this.ztolerance = 0,
                this.segments = [],
                this.segment = [],
                this.pivotPoint = void 0,
                this.pendingPoint = void 0
        }
        t.Accumulator = r
    });
    _("core/math/implicit-plotter", ["require", "exports", "core/math/distance", "./curve-accumulator"], function(e, t, p, o) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.displayTriangles = t.traceContours = t.triangulate = t.buildQuadTree = t.sampleImplicitDiagnostic = t.sampleImplicit = void 0;
        var T = 5
            , L = Math.pow(2, 14);
        function n(e, t) {
            var r = Math.pow(2, -T)
                , n = s(t, r)
                , i = s(t, 2 * r)
                , a = u(e, n, i)
                , o = c(a.root, e, n);
            return {
                paddedDomain: n,
                rootDomain: i,
                quadTree: a,
                triangles: o,
                contours: _(o, e, n)
            }
        }
        function v(e, t, r) {
            return {
                x: e,
                y: t,
                z: r
            }
        }
        function b(e, t, r) {
            return {
                x: e,
                y: t,
                isZero: r
            }
        }
        function a(e, t, r) {
            return {
                vertices: [e, t, r],
                visited: !1,
                next: void 0
            }
        }
        function s(e, t) {
            var r = (1 + t) * e.xmin - t * e.xmax
                , n = (1 + t) * e.xmax - t * e.xmin;
            return {
                xmin: r,
                ymin: (1 + t) * e.ymin - t * e.ymax,
                xmax: n,
                ymax: (1 + t) * e.ymax - t * e.ymin,
                xtolerance: e.xtolerance,
                ytolerance: e.ytolerance
            }
        }
        function I(e, t) {
            return {
                depth: e,
                vertices: t,
                children: void 0,
                center: void 0
            }
        }
        function C(e, t, r) {
            e.center = B(e.vertices[0], e.vertices[1], e.vertices[2], e.vertices[3], t, r)
        }
        function u(e, t, r) {
            var n, i, a, o, s, u, c = (n = e,
                a = (i = r).xmin,
                o = i.xmax,
                s = i.ymin,
                u = i.ymax,
                I(0, [F(a, u, n), F(o, u, n), F(o, s, n), F(a, s, n)])), l = [];
            (P = []).push(c);
            var p, f, h, d, m, g, y, v, b, x, S, _, E = 1, M = !0;
            e: for (; P.length; )
                for (var D, w = l, l = P, P = w; D = l.pop(); )
                    if (function(e, t, r) {
                        if (e.depth < T)
                            return !0;
                        if (function(e, t) {
                            return e.vertices[0].x < t.xmin || e.vertices[0].y > t.ymax || e.vertices[2].x > t.xmax || e.vertices[2].y < t.ymin
                        }(e, r))
                            return !1;
                        if (function(e, t) {
                            if (e.vertices[1].x - e.vertices[0].x < 10 * t.xtolerance)
                                return !0;
                            if (e.vertices[0].y - e.vertices[3].y < 10 * t.ytolerance)
                                return !0;
                            return !1
                        }(e, r))
                            return !1;
                        var n = e.vertices[0]
                            , i = e.vertices[1]
                            , a = e.vertices[2]
                            , o = e.vertices[3];
                        if (isNaN(n.z) && isNaN(i.z) && isNaN(a.z) && isNaN(o.z))
                            return !1;
                        if (isNaN(n.z) || isNaN(i.z) || isNaN(a.z) || isNaN(o.z))
                            return !0;
                        var s = B(n, i, a, o, t, r)
                            , u = R(n, i, t, r)
                            , c = R(i, a, t, r)
                            , l = R(a, o, t, r)
                            , p = R(o, n, t, r);
                        return A(n, u, t) || A(i, u, t) || A(i, c, t) || A(a, c, t) || A(a, l, t) || A(o, l, t) || A(o, p, t) || A(n, p, t) || N(n, u, s, t, r) || N(u, i, s, t, r) || N(i, c, s, t, r) || N(c, a, s, t, r) || N(a, l, s, t, r) || N(l, o, s, t, r) || N(o, p, s, t, r) || N(p, n, s, t, r)
                    }(D, e, t)) {
                        if (f = e,
                            _ = S = x = b = v = y = g = m = d = h = void 0,
                            h = (p = D).depth + 1,
                            d = p.vertices[0],
                            m = p.vertices[1],
                            g = p.vertices[2],
                            y = p.vertices[3],
                            v = q(d, m, f),
                            b = q(m, g, f),
                            x = q(g, y, f),
                            S = q(y, d, f),
                            _ = q(d, g, f),
                            p.children = [I(h, [d, v, _, S]), I(h, [v, m, b, _]), I(h, [_, b, g, x]), I(h, [S, _, x, y])],
                            !D.children) {
                            M = !1;
                            break e
                        }
                        if (P.push(D.children[0]),
                            P.push(D.children[1]),
                            P.push(D.children[2]),
                            P.push(D.children[3]),
                        L <= (E += 3)) {
                            M = !1;
                            break e
                        }
                    } else
                        C(D, e, t);
            for (var O = 0; O < l.length; O++)
                C(l[O], e, t);
            for (O = 0; O < P.length; O++)
                C(P[O], e, t);
            return {
                root: c,
                resolved: M
            }
        }
        function N(e, t, r, n, i) {
            if (0 < e.z == 0 < t.z && 0 < t.z == 0 < r.z)
                return !1;
            var a, o, s, u;
            if (0 < e.z == 0 < t.z) {
                if (0 < (a = q(e, t, n)).z != 0 < e.z)
                    return !0;
                o = f(e, r, n, i),
                    s = f(t, r, n, i),
                    u = f(a, r, n, i)
            } else if (0 < t.z == 0 < r.z) {
                if (0 < (a = q(t, r, n)).z != 0 < t.z)
                    return !0;
                o = f(t, e, n, i),
                    s = f(r, e, n, i),
                    u = f(a, e, n, i)
            } else {
                if (0 < (a = q(r, e, n)).z != 0 < r.z)
                    return !0;
                o = f(r, t, n, i),
                    s = f(e, t, n, i),
                    u = f(a, t, n, i)
            }
            var c = i.xtolerance
                , l = i.ytolerance;
            return c * l < p.pointToSegment(l * u.x, c * u.y, l * o.x, c * o.y, l * s.x, c * s.y)
        }
        function A(e, t, r) {
            if (isNaN(e.z) && isNaN(t.z))
                return !1;
            if (isNaN(e.z) || isNaN(t.z))
                return 0 < e.z || 0 < t.z;
            var n = 4 * q(e, t, r).z - t.z - 3 * e.z
                , i = 1e-4
                , a = (r((1 - i) * e.x + i * t.x, (1 - i) * e.y + i * t.y) - e.z) / i
                , o = Math.max(Math.abs(e.z), Math.abs(t.z));
            return Math.abs(n - a) > .125 * o
        }
        function x(e, t) {
            return e.x < t.xmin || e.x > t.xmax || e.y < t.ymin || e.y > t.ymax
        }
        function F(e, t, r) {
            return v(e, t, r(e, t))
        }
        function q(e, t, r) {
            return F(.5 * (e.x + t.x), .5 * (e.y + t.y), r)
        }
        function R(e, t, r, n) {
            if (x(e, n) || x(t, n))
                return q(e, t, r);
            if (isNaN(e.z) || isNaN(t.z))
                return function(e, t, r, n) {
                    if (isNaN(e.z) === isNaN(t.z))
                        return q(e, t, r);
                    {
                        var i;
                        isNaN(e.z) && (i = e,
                            e = t,
                            t = i)
                    }
                    var a = e.x
                        , o = t.x
                        , s = e.y
                        , u = t.y
                        , c = e.z
                        , l = n.xtolerance
                        , p = n.ytolerance;
                    for (; Math.abs(a - o) > l || Math.abs(s - u) > p; ) {
                        var f = .5 * (a + o)
                            , h = .5 * (s + u)
                            , d = r(f, h);
                        isNaN(d) === isNaN(c) ? (a = f,
                            s = h,
                            c = d) : (o = f,
                            u = h)
                    }
                    return v(a, s, c)
                }(e, t, r, n);
            if (0 < e.z != 0 < t.z)
                return q(e, t, r);
            var i = .01
                , a = r(.99 * e.x + i * t.x, .99 * e.y + i * t.y) - e.z
                , o = t.z - r(i * e.x + .99 * t.x, i * e.y + .99 * t.y);
            return isNaN(a) || isNaN(o) || 0 < a == 0 < o ? q(e, t, r) : S(v(e.x, e.y, a), v(t.x, t.y, o), r)
        }
        function B(e, t, r, n, i, a) {
            var o = R(e, r, i, a);
            return 0 < e.z == 0 < r.z && 0 < o.z != 0 < e.z ? o : (o = R(t, n, i, a),
                0 < t.z == 0 < n.z && 0 < o.z != 0 < t.z ? o : q(e, r, i))
        }
        function S(e, t, r) {
            if (isNaN(e.z))
                return t;
            if (isNaN(t.z))
                return e;
            if (isFinite(e.z) || isFinite(t.z)) {
                if (isFinite(e.z)) {
                    if (isFinite(t.z)) {
                        var n = 1 - e.z / t.z
                            , i = 1 - t.z / e.z;
                        return F(e.x / n + t.x / i, e.y / n + t.y / i, r)
                    }
                    return e
                }
                return t
            }
            return q(e, t, r)
        }
        function f(e, t, r, n) {
            var i = e.x
                , a = t.x
                , o = e.y
                , s = t.y
                , u = e.z
                , c = t.z
                , l = n.xtolerance
                , p = n.ytolerance;
            if (x(e, n) || x(t, n)) {
                var f = q(e, t, r);
                return b(f.x, f.y, !1)
            }
            for (; Math.abs(i - a) > l || Math.abs(o - s) > p; ) {
                var h = .5 * (i + a)
                    , d = .5 * (o + s)
                    , m = r(h, d);
                0 < m == 0 < u ? (i = h,
                    o = d,
                    u = m) : (a = h,
                    s = d,
                    c = m)
            }
            if (isNaN(u))
                return b(a, s, !1);
            if (isNaN(c))
                return b(i, o, !1);
            var g = S(v(i, o, u), v(a, s, c), r)
                , y = 0 === u || 0 === c || 0 === g.z || g.z >= u == c >= g.z && Math.abs(g.z) < 1e250;
            return b(g.x, g.y, y)
        }
        function c(e, t, r) {
            var n = {
                triangles: [],
                edgeCache: {},
                domain: r,
                fn: t
            };
            return function e(t, r) {
                if (!t.children)
                    return;
                e(t.children[0], r);
                e(t.children[1], r);
                e(t.children[2], r);
                e(t.children[3], r);
                i(t.children[0], t.children[1], r);
                i(t.children[3], t.children[2], r);
                l(t.children[1], t.children[2], r);
                l(t.children[0], t.children[3], r)
            }(e, n),
                n.triangles
        }
        function i(e, t, r) {
            e.children && t.children ? (i(e.children[1], t.children[0], r),
                i(e.children[2], t.children[3], r)) : e.children ? (i(e.children[1], t, r),
                i(e.children[2], t, r)) : t.children ? (i(e, t.children[0], r),
                i(e, t.children[3], r)) : function(e, t, r) {
                if (!e.center || !t.center)
                    return;
                var n, i;
                i = e.depth >= t.depth ? (n = R(e.vertices[1], e.vertices[2], r.fn, r.domain),
                    h(e.vertices[1], t.center, e.vertices[2], e.center, n)) : (n = R(t.vertices[0], t.vertices[3], r.fn, r.domain),
                    h(t.vertices[0], t.center, t.vertices[3], e.center, n));
                g(i, r.edgeCache, r.domain);
                for (var a = 0; a < 4; a++)
                    r.triangles.push(i[a])
            }(e, t, r)
        }
        function l(e, t, r) {
            e.children && t.children ? (l(e.children[2], t.children[1], r),
                l(e.children[3], t.children[0], r)) : e.children ? (l(e.children[2], t, r),
                l(e.children[3], t, r)) : t.children ? (l(e, t.children[1], r),
                l(e, t.children[0], r)) : function(e, t, r) {
                if (!e.center || !t.center)
                    return;
                var n, i;
                i = e.depth >= t.depth ? (n = R(e.vertices[3], e.vertices[2], r.fn, r.domain),
                    h(e.vertices[2], t.center, e.vertices[3], e.center, n)) : (n = R(t.vertices[1], t.vertices[0], r.fn, r.domain),
                    h(t.vertices[1], t.center, t.vertices[0], e.center, n));
                g(i, r.edgeCache, r.domain);
                for (var a = 0; a < 4; a++)
                    r.triangles.push(i[a])
            }(e, t, r)
        }
        function h(e, t, r, n, i) {
            return [a(e, i, t), a(t, i, r), a(r, i, n), a(n, i, e)]
        }
        function m(e, t, r) {
            return 0 < e.z && !x(e, r) && (!(0 < t.z) || x(t, r))
        }
        function d(e, t) {
            return e.x + "," + e.y + "," + t.x + "," + t.y
        }
        function g(e, t, r) {
            y(e[0], e[1], e[2], d(e[1].vertices[2], e[1].vertices[0]), t, r),
                y(e[1], e[2], e[3], d(e[2].vertices[0], e[2].vertices[2]), t, r),
                y(e[2], e[3], e[0], d(e[3].vertices[2], e[3].vertices[0]), t, r),
                y(e[3], e[0], e[1], d(e[0].vertices[0], e[0].vertices[2]), t, r)
        }
        function y(e, t, r, n, i, a) {
            var o, s, u, c, l, p, f = t.vertices[0], h = t.vertices[1], d = t.vertices[2];
            m(h, d, a) && (t.next = r),
            m(f, h, a) && (t.next = e),
            m(d, f, a) && (o = t,
                (u = i)[s = n] ? o.next = u[s] : u[s] = o),
            m(f, d, a) && (c = t,
                (p = i)[l = n] ? p[l].next = c : p[l] = c)
        }
        function _(e, t, r) {
            for (var n = {
                fillAccumulator: new o.Accumulator(r),
                strokeAccumulator: new o.Accumulator(r),
                fn: t,
                domain: r
            }, i = 0; i < e.length; i++) {
                var a = e[i];
                a.next && !a.visited && function(e, t) {
                    for (; ; ) {
                        var r = e.vertices[0]
                            , n = e.vertices[1]
                            , i = e.vertices[2];
                        if (E(r, n, t),
                            E(n, i, t),
                            E(i, r, t),
                            e.visited)
                            break;
                        if (!e.next)
                            break;
                        e.visited = !0,
                            e = e.next
                    }
                    t.strokeAccumulator.breakSegment(),
                        t.fillAccumulator.breakSegment()
                }(a, n)
            }
            return {
                strokeSegments: n.strokeAccumulator.finish().segments,
                fillSegments: n.fillAccumulator.finish().segments
            }
        }
        function E(e, t, r) {
            var n;
            m(e, t, r.domain) && (n = f(e, t, r.fn, r.domain),
                r.fillAccumulator.addPoint([n.x, n.y]),
                n.isZero ? r.strokeAccumulator.addPoint([n.x, n.y]) : r.strokeAccumulator.breakSegment())
        }
        t.sampleImplicit = function(e, t) {
            var r = n(e, t);
            return {
                segments: r.contours.strokeSegments,
                fillSegments: r.contours.fillSegments,
                resolved: r.quadTree.resolved
            }
        }
            ,
            t.sampleImplicitDiagnostic = n,
            t.buildQuadTree = u,
            t.triangulate = c,
            t.traceContours = _,
            t.displayTriangles = function(e) {
                for (var t = [], r = 0; r < e.length; r++) {
                    var n = e[r];
                    t.push([n.vertices[0].x, n.vertices[0].y, n.vertices[1].x, n.vertices[1].y, n.vertices[2].x, n.vertices[2].y, n.vertices[0].x, n.vertices[0].y])
                }
                return t
            }
    });
    _("core/math/poi-finding-accumulator", ["require", "exports", "core/math/workerconfig", "tslib", "./curve-accumulator", "./poi"], function(e, t, r, n, i, l) {
        "use strict";
        function a(e) {
            return Math.abs(e) < 5e-8
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var o, s = (o = i.Accumulator,
            n.__extends(u, o),
            u.prototype.getPOI = function() {
                return r.pointsOfInterest ? (void 0 !== this.fn && (this.poiData.intercept = this.findIntercept(this.fn)),
                    this.poiData) : {
                    zeros: {
                        x: [],
                        y: []
                    },
                    intercept: {
                        x: [],
                        y: []
                    },
                    extrema: {
                        x: [],
                        y: []
                    }
                }
            }
            ,
            u.prototype.addLinearZero = function(e) {
                var t = -e[0] / e[1];
                this.isOutsideDomain(t) || (this.poiData.zeros = {
                    x: [t],
                    y: [0]
                })
            }
            ,
            u.prototype.addLinearIntercept = function(e) {
                this.isOutsideDomain(0) || (this.poiData.intercept = {
                    x: [0],
                    y: [e[0]]
                })
            }
            ,
            u.prototype.isOutsideDomain = function(e) {
                return !this.domain || void 0 === this.domain.min || void 0 === this.domain.max || e < this.domain.min || e > this.domain.max || isNaN(e)
            }
            ,
            u.prototype.addPoint = function(e) {
                0 === this.segment.length && a(e[1]) && (this.poiData.zeros.x.push(e[0]),
                    this.poiData.zeros.y.push(e[1])),
                    this.updateZeroBuffer(e),
                    this.updateExtremumBuffer(e),
                    o.prototype.addPoint.call(this, e)
            }
            ,
            u.prototype.updateZeroBuffer = function(e) {
                if (this.fn)
                    if (isFinite(e[0]) && isFinite(e[1]))
                        switch (this.zeroBuffer.length) {
                            case 0:
                                if (a(e[1]))
                                    return;
                                return void this.zeroBuffer.push(e);
                            case 1:
                                return 0 === e[1] || (0 < e[1] == 0 < this.zeroBuffer[0][1] || (t = l.bisectZero(this.zeroBuffer[0][0], this.zeroBuffer[0][1], e[0], e[1], this.fn)) && (this.poiData.zeros.x.push(t[0]),
                                    this.poiData.zeros.y.push(t[1])),
                                    this.zeroBuffer.length = 0),
                                    void this.zeroBuffer.push(e);
                            case 2:
                                if (0 === e[1])
                                    return;
                                return 0 < e[1] == 0 < this.zeroBuffer[0][1] || (t = l.flatCenter(this.zeroBuffer[0][0], this.zeroBuffer[0][1], this.zeroBuffer[1][0], this.zeroBuffer[1][1], e[0], e[1], this.fn)) && (this.poiData.zeros.x.push(t[0]),
                                    this.poiData.zeros.y.push(t[1])),
                                    this.zeroBuffer.length = 0,
                                    void this.zeroBuffer.push(e);
                                var t
                        }
                    else
                        this.zeroBuffer.length = 0
            }
            ,
            u.prototype.updateExtremumBuffer = function(e) {
                if (this.fn)
                    if (isFinite(e[0]) && isFinite(e[1]))
                        switch (this.extremumBuffer.length) {
                            case 0:
                                return void this.extremumBuffer.push(e);
                            case 1:
                                return e[1] === this.extremumBuffer[0][1] && (this.extremumBuffer.length = 0),
                                    void this.extremumBuffer.push(e);
                            case 2:
                                return e[1] === this.extremumBuffer[1][1] || (e[1] > this.extremumBuffer[1][1] == this.extremumBuffer[1][1] > this.extremumBuffer[0][1] || (t = this.bisectExtremumUsingDerivative(this.extremumBuffer[0][0], this.extremumBuffer[0][1], this.extremumBuffer[1][0], this.extremumBuffer[1][1], e[0], e[1])) && (this.poiData.extrema.x.push(t[0]),
                                    this.poiData.extrema.y.push(t[1]),
                                !l.bisectJump(this.extremumBuffer[0][0], this.extremumBuffer[0][1], t[0], t[1], e[0], e[1], this.fn, this.ytolerance) && t[0] > this.segment[this.segment.length - 2] && (this.pendingPoint = t)),
                                    this.extremumBuffer.shift()),
                                    void this.extremumBuffer.push(e);
                            case 3:
                                if (e[1] === this.extremumBuffer[1][1])
                                    return;
                                if (e[1] > this.extremumBuffer[1][1] == this.extremumBuffer[1][1] > this.extremumBuffer[0][1])
                                    return this.extremumBuffer.shift(),
                                        this.extremumBuffer.shift(),
                                        void this.extremumBuffer.push(e);
                                var t = void 0
                                    , r = .5 * (this.extremumBuffer[1][0] + this.extremumBuffer[2][0])
                                    , n = this.fn(r);
                                return (t = n === this.extremumBuffer[1][1] ? l.flatCenter(this.extremumBuffer[0][0], this.extremumBuffer[0][1], this.extremumBuffer[1][0], this.extremumBuffer[1][1], e[0], e[1], this.fn) : this.bisectExtremumUsingDerivative(this.extremumBuffer[1][0], this.extremumBuffer[1][1], r, n, this.extremumBuffer[2][0], this.extremumBuffer[2][1])) && (this.poiData.extrema.x.push(t[0]),
                                    this.poiData.extrema.y.push(t[1])),
                                    this.extremumBuffer.shift(),
                                    this.extremumBuffer.shift(),
                                    void this.extremumBuffer.push(e)
                        }
                    else
                        this.zeroBuffer.length = 0
            }
            ,
            u.prototype.bisectExtremumUsingDerivative = function(e, t, r, n, i, a) {
                var o, s, u, c;
                if (this.fn)
                    return this.derivative && (s = this.derivative(e),
                        u = this.derivative(i),
                    isNaN(s) || isNaN(u) || s < 0 == u < 0 || (c = l.bisectZero(e, s, i, u, this.derivative)) && (o = [c[0], this.fn(c[0])])),
                        o = o || l.bisectExtremum(e, t, r, n, i, a, this.fn)
            }
            ,
            u.prototype.breakSegment = function() {
                this.zeroBuffer.length = 0,
                    this.extremumBuffer.length = 0,
                    this.flushPending(),
                2 < this.segment.length && (this.segments.push(this.segment),
                a(this.segment[this.segment.length - 1]) && (this.poiData.zeros.x.push(this.segment[this.segment.length - 2]),
                    this.poiData.zeros.y.push(this.segment[this.segment.length - 1]))),
                    this.segment = []
            }
            ,
            u.prototype.findIntercept = function(e) {
                if (!e)
                    return {
                        x: [],
                        y: []
                    };
                var t = e(0);
                return isFinite(t) ? {
                    x: [0],
                    y: [e(0)]
                } : {
                    x: [],
                    y: []
                }
            }
            ,
            u.prototype.finish = function() {
                return {
                    segments: this.getSegments(),
                    resolved: !0,
                    poi: this.getPOI()
                }
            }
            ,
            u);
        function u(e, t, r) {
            var n = o.call(this, e) || this;
            return n.domain = e,
                n.fn = t,
                n.derivative = r,
                n.poiData = {
                    zeros: {
                        x: [],
                        y: []
                    },
                    intercept: {
                        x: [],
                        y: []
                    },
                    extrema: {
                        x: [],
                        y: []
                    }
                },
                n.zeroBuffer = [],
                n.extremumBuffer = [],
                n
        }
        t.default = s
    });
    _("core/math/plotter", ["require", "exports", "tslib", "core/math/distance", "./poi", "./implicit-plotter", "./curve-accumulator", "./poi-finding-accumulator", "core/types/graphmode", "./domaintypes"], function(e, t, n, x, g, M, o, a, D, v) {
        "use strict";
        function w(e, t) {
            var r = new a.default(t)
                , n = e[0] + t.min * e[1]
                , i = e[0] + t.max * e[1];
            return isFinite(n) && isFinite(i) && (r.addPoint([t.min, n]),
                r.addPoint([t.max, i]),
                r.addLinearZero(e),
                r.addLinearIntercept(e)),
                r.finish()
        }
        function P(e, t) {
            var r = e(t);
            return {
                segments: [n.__spreadArrays(r, r)],
                resolved: !0
            }
        }
        function y(e, t, r) {
            var n = r.fn
                , i = r.jumpTolerance
                , a = e[0]
                , o = e[1]
                , s = t[0]
                , u = t[1]
                , c = x.mean(a, s)
                , l = n(c);
            return g.bisectJump(a, o, c, l, s, u, n, i)
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var b = function(e, t, r) {
            var n = r.fn
                , i = r.jumpTolerance
                , a = r.accumulator;
            if (!isFinite(i) || i <= 0)
                return t;
            var o = y(e, t, r);
            if (!o)
                return t;
            for (var s = (t[0] - e[0]) / 10, u = [-s, s], c = t, l = 0; l < u.length; l++) {
                var p = e[0] + u[l]
                    , f = n(p);
                isFinite(f) || (p = e[0],
                    f = e[1],
                    p = e[0],
                    f = e[1]);
                var h = t[0] + u[l]
                    , d = n(h);
                if (isFinite(d) ? c = [h, d] : (h = t[0],
                    d = t[1]),
                    y([p, f], [h, d], r)) {
                    var m = o[0]
                        , g = o[1];
                    return a.addPoint(m),
                        a.breakSegment(),
                        a.addPoint(g),
                        t
                }
            }
            return c
        }
            , S = function(e, t, r) {
            this.derivative = r,
                this.accumulator = new a.default(t,e,r),
                this.fn = e,
                this.jumpTolerance = t.ytolerance || t.tolerance || 0
        };
        function _(e, t, r) {
            var n = t
                , i = e(n);
            return isFinite(i) || (i = e(n = t + r)),
            isFinite(i) || (i = e(n = t - r)),
                [n, i]
        }
        function O(e, t, r) {
            var n, i, a, o, s = new S(e,t,r), u = t.step / 10, c = t.min, l = _(e, c, u), p = l[0], f = l[1], h = [p, f];
            isFinite(f) && s.accumulator.addPoint([p, f]);
            for (var d = Math.ceil((t.max - t.min) / t.step), m = 1; m <= d; m++)
                p = (n = _(e, (d - m) / d * t.min + m / d * t.max, u))[0],
                    f = n[1],
                    isFinite(f) && isFinite(h[1]) ? (p = (i = b(h, [p, f], s))[0],
                        f = i[1],
                        s.accumulator.addPoint([p, f])) : isFinite(f) && !isFinite(h[1]) ? (o = g.bisectFinite(h[0], h[1], p, f, e)) && (o[0] !== p && s.accumulator.addPoint(o),
                        p = (a = b(o, [p, f], s))[0],
                        f = a[1],
                        s.accumulator.addPoint([p, f])) : !isFinite(f) && isFinite(h[1]) && (o = g.bisectFinite(h[0], h[1], p, f, e)) && ((o = b(h, o, s))[0] !== h[0] && s.accumulator.addPoint(o),
                        s.accumulator.breakSegment()),
                    h = [p, f];
            return s.accumulator.finish()
        }
        function E(e, t, l, p) {
            var r, n, i, f = t.min, a = t.max - t.min, h = t.xtolerance && t.ytolerance ? Math.min(t.xtolerance, t.ytolerance) : t.tolerance ? t.tolerance : 0, o = Math.floor(a / (Math.PI / l));
            function s(e, t) {
                var r = t % 2 == 0 ? 1 : -1;
                if (p || -1 != r) {
                    for (var n = t * (Math.PI / l), i = [f, f + 1, f + 2, f + 3], a = !1, o = 0, s = i.length; o < s; o++) {
                        var u = e(i[o])
                            , c = e(i[o] + n);
                        if (isFinite(u) && isFinite(c) && (a = !0),
                        isFinite(u) !== isFinite(c) || Math.abs(u - r * c) > h)
                            return
                    }
                    if (a)
                        return 1
                }
            }
            for (r = 1; r <= o; r++)
                if (s(e, r)) {
                    for (i = r,
                             n = 2; n * r <= o; n++)
                        s(e, n * r) || (i = void 0);
                    if (i)
                        break
                }
            return i ? i * (Math.PI / l) : null
        }
        function p(e) {
            return [e[1] * Math.cos(e[0]), e[1] * Math.sin(e[0])]
        }
        function T(e, t) {
            return t.map = p,
                O(e, t)
        }
        function L(t, e) {
            if (e.max < e.min)
                return {
                    segments: [],
                    resolved: !0
                };
            var r, n = new o.Accumulator(e), i = e.min, a = t(i);
            return isFinite(a[0]) && isFinite(a[1]) && n.addPoint(a),
                function(e, t) {
                    for (var r = e.min, n = e.max, i = e.step, a = n - r, o = Math.ceil(a / i), s = a / o, u = 0; u < o; u++)
                        t(r + u * s);
                    t(n)
                }(e, function(e) {
                    r = t(e),
                        I(t, i, a, e, r, 10, n),
                        i = e,
                        a = r
                }),
                n.finish()
        }
        function I(e, t, r, n, i, a, o) {
            if (n !== t) {
                var s = o.xtolerance
                    , u = o.ytolerance
                    , c = o.ztolerance
                    , l = x.mean(t, n)
                    , p = e(l)
                    , f = isFinite(r[0]) && isFinite(r[1]) && (2 === r.length || isFinite(r[2]))
                    , h = isFinite(i[0]) && isFinite(i[1]) && (2 === i.length || isFinite(i[2]))
                    , d = isFinite(p[0]) && isFinite(p[1]) && (2 === p.length || isFinite(p[2]));
                if (0 === a || l === t || l === n)
                    return o.breakSegment(),
                        void (h && o.addPoint(i));
                if (f || h)
                    if (f === h) {
                        if (f && d && h) {
                            var m = x.pointToSegmentParameter(p[0], p[1], p[2] || 0, r[0], r[1], r[2] || 0, i[0], i[1], i[2] || 0);
                            if (.2 < m && m < .8 && Math.abs(p[0] - (r[0] + m * (i[0] - r[0]))) <= s && Math.abs(p[1] - (r[1] + m * (i[1] - r[1]))) <= u && (2 === r.length || Math.abs(p[2] - (r[2] + m * (i[2] - r[2]))) <= c))
                                return void o.addPoint(i)
                        }
                        r[0] === p[0] && r[1] === p[1] || I(e, t, r, l, p, a - 1, o),
                        i[0] === p[0] && i[1] === p[1] || I(e, l, p, n, i, a - 1, o)
                    } else {
                        for (var g = t, y = n, v = r, b = i; t !== l && l !== n; )
                            d == f ? (t = l,
                                r = p,
                                f = d) : (n = l,
                                i = p,
                                h = d),
                                p = e(l = t + (n - t) / 2),
                                d = isFinite(p[0]) && isFinite(p[1]) && (2 === p.length || isFinite(p[2]));
                        f ? (I(e, g, v, t, r, a - 1, o),
                            o.breakSegment()) : (o.breakSegment(),
                            o.addPoint(i),
                            I(e, n, i, y, b, a - 1, o))
                    }
            }
        }
        function C(e, t, r) {
            var n = e.viewport.xmin
                , i = e.viewport.xmax
                , a = e.viewport.ymin
                , o = e.viewport.ymax
                , s = e.trigAngleMultiplier || 1
                , u = e.oversample || 4
                , c = 1 / u * (i - n) / e.screen.width
                , l = 1 / u * (o - a) / e.screen.height
                , p = t.domainBound;
            switch (t.graphMode) {
                case D.X:
                    switch ((d = v.intersectDomains(v.knownDomain([a, o]), p)).type) {
                        case "empty":
                            return !1;
                        case "known":
                            a = d.bounds[0],
                                o = d.bounds[1]
                    }
                    h = {
                        min: a,
                        max: o,
                        xtolerance: l,
                        ytolerance: c,
                        step: l
                    };
                    break;
                case D.Y:
                    switch ((d = v.intersectDomains(v.knownDomain([n, i]), p)).type) {
                        case "empty":
                            return !1;
                        case "known":
                            n = d.bounds[0],
                                i = d.bounds[1]
                    }
                    h = {
                        min: n,
                        max: i,
                        xtolerance: c,
                        ytolerance: l,
                        step: c
                    };
                    break;
                case D.POLAR:
                    if (!t.domain)
                        throw new Error("Expected polar graph to have domain");
                    var f, h = {
                        min: t.domain.min,
                        max: t.domain.max,
                        step: 2 * Math.PI / s / 1e3,
                        tolerance: Math.min(c, l)
                    };
                    t.domain.isExplicit || (f = E(r, h, s, "=" === t.operator)) && (h.max = h.min + f),
                        h.step = Math.max(h.step, (h.max - h.min) / 11999);
                    break;
                case D.PARAMETRIC:
                case D.PARAMETRIC_CURVE_3D:
                    var d, m = t.domain ? t.domain.min : 0, g = t.domain ? t.domain.max : 1, y = t.domain ? t.domain.step : .01;
                    switch ((d = v.intersectDomains(v.knownDomain([m, g]), p)).type) {
                        case "empty":
                            return !1;
                        case "known":
                            m = d.bounds[0],
                                g = d.bounds[1]
                    }
                    h = {
                        min: m,
                        max: g,
                        step: y,
                        xtolerance: c,
                        ytolerance: l,
                        ztolerance: Math.min(c, l)
                    };
                    break;
                case D.IMPLICIT:
                    h = {
                        xmin: n,
                        xmax: i,
                        ymin: a,
                        ymax: o,
                        xtolerance: c,
                        ytolerance: l
                    };
                    break;
                case D.Z_3D:
                    return {
                        xmin: -10,
                        xmax: 10,
                        ymin: -10,
                        ymax: 10
                    };
                default:
                    return !1
            }
            return h
        }
        t.default = {
            sampleXYNaive: function(e, t) {
                for (var r, n = new a.default(t,e), i = t.min; i <= t.max + t.step / 2; i += t.step)
                    r = e(i),
                        isFinite(r) ? n.addPoint([i, r]) : n.breakSegment();
                return n.finish()
            },
            sampleLinear: w,
            sampleXY: O,
            findPiPeriod: E,
            samplePolar: T,
            sampleParametricRecursive: L,
            subsampleParametricRecursive: I,
            validateViewState: function(e) {
                if (!e)
                    return !1;
                var t = e.viewport.xmin
                    , r = e.viewport.xmax
                    , n = e.viewport.ymin
                    , i = e.viewport.ymax;
                return !(!isFinite(t) || !isFinite(r) || r <= t) && (!(!isFinite(n) || !isFinite(i) || i <= n) && (!(!isFinite(e.screen.width) || e.screen.width <= 0) && !(!isFinite(e.screen.height) || e.screen.height <= 0)))
            },
            computeDomain: C,
            computeGraphData: function(e) {
                var t, r, n, i, a, o, s, u = e.viewState, c = e.graphInfo, l = e.compiled, p = e.derivative, f = e.discrete, h = e.maxOverride, d = l.fn, m = C(u, c, d), g = c.graphMode;
                if (m) {
                    switch (g) {
                        case D.X:
                        case D.Y:
                            var y, v, b, x, S = p ? p.fn : void 0;
                            x = f ? (y = m.min,
                                v = m.max,
                                b = m.step,
                                function(e) {
                                    for (var t = e.fn, r = e.domain, n = r.min, i = r.max, a = Math.floor(n), o = Math.ceil(i), s = [], u = a; u <= o; u++) {
                                        var c = t(u);
                                        isFinite(u) && isFinite(c) && s.push([u, c])
                                    }
                                    return {
                                        segments: s,
                                        resolved: !0
                                    }
                                }({
                                    fn: d,
                                    domain: {
                                        min: Math.max(y, 0),
                                        max: void 0 !== h ? Math.min(h, v) : v,
                                        step: b
                                    }
                                })) : c.isLinear ? w(c.linearCoefficients, m) : O(d, m, S);
                            break;
                        case D.POLAR:
                            x = T(d, m);
                            break;
                        case D.IMPLICIT:
                            x = M.sampleImplicit(d, m);
                            break;
                        case D.PARAMETRIC:
                            m.step || (m.step = (m.max - m.min) / 1e3),
                                x = m.max === m.min ? P(d, m.min) : c.isLinear ? (r = c.linearCoefficients,
                                    n = m,
                                    i = w(r[0], n),
                                    a = w(r[1], n),
                                    i.segments.length && a.segments.length && 4 === i.segments[0].length && 4 === a.segments[0].length ? {
                                        segments: [[i.segments[0][1], a.segments[0][1], i.segments[0][3], a.segments[0][3]]],
                                        resolved: !0
                                    } : {
                                        segments: [],
                                        resolved: !0
                                    }) : L(d, m);
                            break;
                        case D.PARAMETRIC_CURVE_3D:
                            return m.step || (m.step = (m.max - m.min) / 1e3),
                                x = m.max === m.min ? P(d, m.min) : L(d, m),
                                {
                                    graphMode: D.PARAMETRIC_CURVE_3D,
                                    segments: x.segments,
                                    cacheKey: l.source + ":" + JSON.stringify(m),
                                    color: c.color,
                                    style: "dummy"
                                };
                        case D.Z_3D:
                            return {
                                meshData: function(e, t) {
                                    for (var r = e.fn, n = t.xmin, i = t.xmax, a = t.ymin, o = (i - n) / 30, s = (t.ymax - a) / 30, u = [], c = [], l = [], p = o / 1e3, f = s / 1e3, h = 0; h < 30; h++)
                                        for (var d = 0; d < 30; d++) {
                                            var m = n + h * o
                                                , g = a + d * s
                                                , y = r(m, g);
                                            u.push(m, g, y);
                                            var v = (r(m + p, g) - y) * f
                                                , b = (r(m, g + f) - y) * p
                                                , x = -p * f
                                                , S = Math.sqrt(v * v + b * b + x * x);
                                            c.push(v / S, b / S, x / S)
                                        }
                                    for (h = 0; h < 29; h++)
                                        for (d = 0; d < 29; d++) {
                                            var _ = 30 * d + h
                                                , E = 30 * d + h + 1
                                                , M = 30 * (d + 1) + h
                                                , D = 30 * (d + 1) + h + 1;
                                            l.push(_, M, E),
                                                l.push(M, D, E)
                                        }
                                    return {
                                        cacheKey: e.source + ":" + JSON.stringify(t),
                                        positions: new Float32Array(u),
                                        normals: new Float32Array(c),
                                        faces: new Int16Array(l)
                                    }
                                }(l, m),
                                color: c.color,
                                graphMode: D.Z_3D,
                                poi: {
                                    zeros: {
                                        x: [],
                                        y: []
                                    },
                                    extrema: {
                                        x: [],
                                        y: []
                                    },
                                    intercept: {
                                        x: [],
                                        y: []
                                    }
                                },
                                compiled: l,
                                style: "dummy"
                            };
                        default:
                            throw new Error("Programming Error: unexpected graphmode " + g)
                    }
                    t = x.poi
                } else
                    x = {
                        segments: [],
                        resolved: !0
                    };
                if ((!t || 250 < t.zeros.x.length + t.extrema.x.length + t.intercept.x.length) && (t = {
                    zeros: {
                        x: [],
                        y: []
                    },
                    extrema: {
                        x: [],
                        y: []
                    },
                    intercept: {
                        x: [],
                        y: []
                    }
                }),
                g === D.X)
                    for (var _ in t) {
                        t.hasOwnProperty(_) && (s = t[o = _].y,
                            t[o].y = t[o].x,
                            t[o].x = s)
                    }
                var E = {
                    segments: x.segments,
                    resolved: x.resolved,
                    graphMode: g,
                    color: c.color,
                    style: f ? c.pointStyle : c.lineStyle,
                    lineWidth: c.lineWidth,
                    lineOpacity: c.lineOpacity,
                    operator: c.operator,
                    poi: t,
                    compiled: l
                };
                return g === D.POLAR && (E.sampledDomain = {
                    min: m.min,
                    max: m.max,
                    step: m.step
                }),
                x.fillSegments && (E.fillSegments = x.fillSegments),
                    E
            },
            polygonsFromSegments: function(e, t, r) {
                for (var n = function(e) {
                    var t = e[e.length - 1];
                    return t[t.length - 2]
                }, i = [], a = 0, o = 0, s = [], u = [], c = -1 / 0, l = -1 / 0; ; ) {
                    if (c <= l) {
                        if (a >= t.length)
                            break;
                        u.push(t[a++])
                    }
                    if (l <= c) {
                        if (o >= e.length)
                            break;
                        s.push(e[o++])
                    }
                    c = n(u),
                        l = n(s),
                    x.approx(c, l, 4) && (i.push(function(e, t, r) {
                        var n, i, a, o, s = [], u = null;
                        switch (r) {
                            case D.POLAR:
                                u = p;
                                break;
                            case D.X:
                                u = function(e) {
                                    return [e[1], e[0]]
                                }
                        }
                        for (n = 0; n < e.length; n++)
                            for (o = e[n],
                                     i = 0; i < o.length; i += 2)
                                a = [o[i], o[i + 1]],
                                u && (a = u(a)),
                                    s.push(a[0], a[1]);
                        for (n = t.length - 1; 0 <= n; n--)
                            for (i = (o = t[n]).length - 2; 0 <= i; i -= 2)
                                a = [o[i], o[i + 1]],
                                u && (a = u(a)),
                                    s.push(a[0], a[1]);
                        return s
                    }(s, u, r)),
                        u = [],
                        s = [],
                        l = c = Math.max(c, l))
                }
                return i
            }
        }
    });
    _("core/lib/deepCopy", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.default = function e(t) {
                var r = t;
                if (r && "function" == typeof r.toJSON && (r = r.toJSON()),
                    !r)
                    return r;
                if ("object" != typeof r)
                    return r;
                if (Array.isArray(r))
                    return r.map(e);
                var n = {};
                for (var i in r)
                    r.hasOwnProperty(i) && (n[i] = e(r[i]));
                return n
            }
    });
    _("core/types/styles", ["require", "exports"], function(e, t) {
        "use strict";
        var r, n;
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.LineStyle = t.PointStyle = void 0,
            (r = t.PointStyle || (t.PointStyle = {})).POINT = "POINT",
            r.OPEN = "OPEN",
            r.CROSS = "CROSS",
            (n = t.LineStyle || (t.LineStyle = {})).SOLID = "SOLID",
            n.DASHED = "DASHED",
            n.DOTTED = "DOTTED"
    });
    _("core/math/cdf-branches", ["require", "exports", "tslib", "core/lib/deepCopy", "core/math/plotter", "core/math/domaintypes", "core/types/styles"], function(e, t, S, l, _, p, f) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.makeCDFTopBranches = void 0;
        function E(e) {
            var t = e.viewState
                , r = e.graphInfo
                , n = e.compiled
                , i = e.derivative
                , a = e.bounds
                , o = e.included
                , s = e.discrete
                , u = l.default(r)
                , c = p.intersectDomains(r.domainBound, p.knownDomain(a));
            if ("known" === c.type)
                return u.domainBound = c,
                    s ? u.pointStyle = o ? f.PointStyle.POINT : f.PointStyle.OPEN : u.lineStyle = f.LineStyle.SOLID,
                    _.default.computeGraphData({
                        graphInfo: u,
                        viewState: t,
                        compiled: n,
                        derivative: i,
                        discrete: s
                    })
        }
        t.makeCDFTopBranches = function(e) {
            var t, r, n, i, a, o, s, u, c, l, p = e.viewState, f = e.graphInfo, h = e.compiled, d = e.derivative, m = e.bounds, g = e.discrete, y = e.maxOverride, v = m[0], b = m[1], x = [];
            return g ? (v = Math.ceil(v),
                b = Math.floor(b),
                r = void 0 !== y ? y : 1 / 0,
                v === -1 / 0 && r <= b ? (t = E({
                    bounds: [v, r],
                    included: !0,
                    viewState: p,
                    graphInfo: f,
                    compiled: h,
                    derivative: d,
                    discrete: g
                }),
                    x.push(t)) : v === -1 / 0 && b < 1 / 0 ? (t = E({
                    bounds: [v, b],
                    included: !0,
                    viewState: p,
                    graphInfo: f,
                    compiled: h,
                    derivative: d,
                    discrete: g
                }),
                    x.push(t),
                    x.push(E({
                        bounds: [b + 1, r],
                        included: !1,
                        viewState: p,
                        graphInfo: f,
                        compiled: h,
                        derivative: d,
                        discrete: g
                    }))) : -1 / 0 < v && r <= b ? (t = E({
                    bounds: [v, r],
                    included: !0,
                    viewState: p,
                    graphInfo: f,
                    compiled: h,
                    derivative: d,
                    discrete: g
                }),
                    x.push(E({
                        bounds: [-1 / 0, v - 1],
                        included: !1,
                        viewState: p,
                        graphInfo: f,
                        compiled: h,
                        derivative: d,
                        discrete: g
                    })),
                    x.push(t)) : (t = E({
                    bounds: [v, b],
                    included: !0,
                    viewState: p,
                    graphInfo: f,
                    compiled: h,
                    derivative: d,
                    discrete: g
                }),
                    n = E({
                        bounds: [-1 / 0, v - 1],
                        included: !1,
                        viewState: p,
                        graphInfo: f,
                        compiled: h,
                        derivative: d,
                        discrete: g
                    }),
                    i = E({
                        bounds: [b + 1, r],
                        included: !1,
                        viewState: p,
                        graphInfo: f,
                        compiled: h,
                        derivative: d,
                        discrete: g
                    }),
                    x.push(t),
                    a = void 0,
                n && i && (s = i,
                    u = (o = n).segments,
                    c = s.segments,
                    l = S.__spreadArrays(u, c),
                    a = S.__assign(S.__assign({}, o), {
                        segments: l
                    }),
                    x.push(a)))) : (t = E({
                bounds: [v, b],
                included: !0,
                viewState: p,
                graphInfo: f,
                compiled: h,
                derivative: d,
                discrete: g
            }),
                x.push(_.default.computeGraphData({
                    viewState: p,
                    graphInfo: f,
                    compiled: h,
                    derivative: d
                }))),
                {
                    cdfTopBranch: t,
                    topBranches: x
                }
        }
    });
    _("core/math/copy-defined-pois", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        t.default = function(e) {
            for (var t = [], r = [], n = e.length, i = 0; i < n; i++)
                t.push(e[i][0]),
                    r.push(e[i][1]);
            return {
                defined: {
                    x: t,
                    y: r
                }
            }
        }
    });
    _("core/types/opacity", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.HIGH = t.DEFAULT = t.LOW = void 0,
            t.LOW = .2,
            t.DEFAULT = .4,
            t.HIGH = .8
    });
    _("core/types/slider-loop-modes", ["require", "exports"], function(e, t) {
        "use strict";
        var r, n;
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.getSliderIcon = t.SliderLoopMode = void 0,
            (n = r = t.SliderLoopMode || (t.SliderLoopMode = {})).LOOP_FORWARD_REVERSE = "LOOP_FORWARD_REVERSE",
            n.LOOP_FORWARD = "LOOP_FORWARD",
            n.PLAY_ONCE = "PLAY_ONCE",
            n.PLAY_INDEFINITELY = "PLAY_INDEFINITELY",
            t.getSliderIcon = function(e) {
                switch (e) {
                    case r.LOOP_FORWARD:
                        return "dcg-icon-arrow-one-way";
                    case r.LOOP_FORWARD_REVERSE:
                        return "dcg-icon-arrow-two-way";
                    case r.PLAY_ONCE:
                        return "dcg-icon-arrow-once";
                    case r.PLAY_INDEFINITELY:
                        return "dcg-icon-arrow-infinite"
                }
            }
    });
    _("core/types/label-sizes", ["require", "exports"], function(e, t) {
        "use strict";
        var r;
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.LabelSize = void 0,
            (r = t.LabelSize || (t.LabelSize = {})).SMALL = "small",
            r.MEDIUM = "medium",
            r.LARGE = "large"
    });
    _("core/types/label-orientations", ["require", "exports"], function(e, t) {
        "use strict";
        var r;
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.LabelOrientation = void 0,
            (r = t.LabelOrientation || (t.LabelOrientation = {})).DEFAULT = "default",
            r.LEFT = "left",
            r.RIGHT = "right",
            r.ABOVE = "above",
            r.BELOW = "below"
    });
    _("core/lib/default-spec", ["require", "exports", "underscore", "core/lib/deepCopy"], function(e, t, a, i) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.populateDefaults = t.stripDefaultsAndMaybeReturnUndefined = t.stripDefaults = void 0,
            t.stripDefaults = function(e, t) {
                var r = {};
                for (var n in t)
                    t.hasOwnProperty(n) && (a.isEqual(e[n], t[n]) || (r[n] = t[n]));
                return r
            }
            ,
            t.stripDefaultsAndMaybeReturnUndefined = function(e, t) {
                var r = void 0
                    , n = {};
                for (var i in t)
                    t.hasOwnProperty(i) && (a.isEqual(e[i], t[i]) || (n[i] = t[i],
                        r = n));
                return r
            }
            ,
            t.populateDefaults = function(e, t) {
                t = t || {};
                var r = {};
                for (var n in e)
                    e.hasOwnProperty(n) && !t.hasOwnProperty(n) && (r[n] = i.default(e[n]));
                for (var n in t)
                    t.hasOwnProperty(n) && (r[n] = t[n]);
                return r
            }
    });
    _("core/lib/copy-properties", ["require", "exports", "core/lib/deepCopy"], function(e, t, a) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.makeTrueMap = t.extractPropertiesLike = t.copyAllProperties = t.copyProperties = void 0,
            t.copyProperties = function(e) {
                var t = e.from
                    , r = e.to
                    , n = e.props;
                for (var i in n)
                    n[i] && t.hasOwnProperty(i) && (r[i] = a.default(t[i]))
            }
            ,
            t.copyAllProperties = function(e, t) {
                for (var r in e)
                    e.hasOwnProperty(r) && (t[r] = e[r])
            }
            ,
            t.extractPropertiesLike = function(e, t) {
                var r = {};
                for (var n in t)
                    t.hasOwnProperty(n) && (r[n] = e[n]);
                return r
            }
            ,
            t.makeTrueMap = function(e) {
                var t = {};
                for (var r in e)
                    e.hasOwnProperty(r) && (t[r] = !0);
                return t
            }
    });
    _("core/graphing-calc/json/expression", ["require", "exports", "tslib", "core/types/opacity", "core/types/styles", "core/lib/dragmode", "core/types/slider-loop-modes", "core/types/label-sizes", "core/types/label-orientations", "core/lib/default-spec", "../../lib/copy-properties"], function(e, a, o, t, r, n, i, s, u, c, l) {
        "use strict";
        var p, f;
        function h(e) {
            return l.extractPropertiesLike(e, a.DEFAULTS_DYNAMIC)
        }
        Object.defineProperty(a, "__esModule", {
            value: !0
        }),
            a.computeParsableState = a.areDynamicPropertiesStrictEqual = a.extractDynamicProperties = a.stripDefaults = a.inflateDefaults = a.SLIDER_DEFAULTS = a.DEFAULTS = a.DEFAULTS_DYNAMIC = a.DEFAULT_SLIDER_PERIOD = a.EditableLabelMode = a.CLICKABLEINFO_DEFAULTS = a.VIZ_DEFAULTS = a.CDF_DEFAULTS = void 0,
            a.CDF_DEFAULTS = {
                show: !1,
                min: "",
                max: ""
            },
            a.VIZ_DEFAULTS = {
                breadth: "",
                axisOffset: "",
                alignedAxis: "x",
                showBoxplotOutliers: !0,
                binAlignment: "center",
                dotplotXMode: "exact",
                dotplotSize: "medium",
                histogramMode: ""
            },
            a.CLICKABLEINFO_DEFAULTS = {
                enabled: !1,
                description: "",
                rules: [{
                    id: "1",
                    expression: "",
                    assignment: ""
                }]
            },
            (f = p = a.EditableLabelMode || (a.EditableLabelMode = {})).None = "NONE",
            f.Math = "MATH",
            f.Text = "TEXT",
            a.DEFAULT_SLIDER_PERIOD = 4e3,
            a.DEFAULTS_DYNAMIC = {
                polarDomain: {
                    min: "",
                    max: ""
                },
                parametricDomain: {
                    min: "",
                    max: ""
                },
                cdf: a.CDF_DEFAULTS,
                colorLatex: "",
                fillOpacity: "" + t.DEFAULT,
                lineOpacity: "",
                pointOpacity: "",
                lineWidth: "",
                vizProps: a.VIZ_DEFAULTS,
                clickableInfo: a.CLICKABLEINFO_DEFAULTS
            },
            a.DEFAULTS = o.__assign(o.__assign({
                folderId: "",
                latex: "",
                color: "",
                showLabel: !1,
                label: "",
                hidden: !1,
                secret: !1,
                dragMode: n.DragMode.AUTO,
                labelSize: s.LabelSize.MEDIUM,
                labelOrientation: u.LabelOrientation.DEFAULT,
                verticalLabel: !1,
                suppressTextOutline: !1,
                interactiveLabel: !1,
                editableLabelMode: p.None,
                residualVariable: "",
                isLogModeRegression: !1,
                pointStyle: r.PointStyle.POINT,
                lineStyle: r.LineStyle.SOLID,
                regressionParameters: {},
                displayEvaluationAsFraction: !1,
                slider: {}
            }, a.DEFAULTS_DYNAMIC), {
                points: void 0,
                lines: void 0,
                fill: void 0
            }),
            a.SLIDER_DEFAULTS = {
                hardMin: !1,
                hardMax: !1,
                animationPeriod: a.DEFAULT_SLIDER_PERIOD,
                loopMode: i.SliderLoopMode.LOOP_FORWARD_REVERSE,
                playDirection: 1,
                isPlaying: !1,
                min: "-10",
                max: "10",
                step: ""
            },
            a.inflateDefaults = function(e) {
                return o.__assign(o.__assign(o.__assign({}, a.DEFAULTS), e), {
                    slider: o.__assign(o.__assign({}, a.SLIDER_DEFAULTS), e.slider),
                    cdf: o.__assign(o.__assign({}, a.CDF_DEFAULTS), e.cdf),
                    vizProps: o.__assign(o.__assign({}, a.VIZ_DEFAULTS), e.vizProps),
                    clickableInfo: o.__assign(o.__assign({}, a.CLICKABLEINFO_DEFAULTS), e.clickableInfo)
                })
            }
            ,
            a.stripDefaults = function(e) {
                var t = c.stripDefaults(a.DEFAULTS, o.__assign(o.__assign({}, e), {
                    slider: c.stripDefaults(a.SLIDER_DEFAULTS, e.slider)
                }))
                    , r = c.stripDefaultsAndMaybeReturnUndefined(a.CDF_DEFAULTS, e.cdf);
                void 0 === r ? delete t.cdf : t.cdf = r;
                var n = c.stripDefaultsAndMaybeReturnUndefined(a.VIZ_DEFAULTS, e.vizProps);
                void 0 === n ? delete t.vizProps : t.vizProps = n;
                var i = c.stripDefaultsAndMaybeReturnUndefined(a.CLICKABLEINFO_DEFAULTS, e.clickableInfo);
                return void 0 === i ? delete t.clickableInfo : t.clickableInfo = i,
                    t
            }
            ,
            a.extractDynamicProperties = h,
            a.areDynamicPropertiesStrictEqual = function(e, t) {
                for (var r in a.DEFAULTS_DYNAMIC)
                    if (a.DEFAULTS_DYNAMIC.hasOwnProperty(r) && e[r] !== t[r])
                        return !1;
                return !0
            }
            ,
            a.computeParsableState = function(e) {
                return o.__assign({
                    type: "statement",
                    id: e.id,
                    latex: e.latex,
                    label: e.label,
                    color: e.color,
                    fill: e.fill,
                    points: e.points,
                    lines: e.lines,
                    pointStyle: e.pointStyle,
                    lineStyle: e.lineStyle,
                    dragMode: e.dragMode,
                    labelSize: e.labelSize,
                    labelOrientation: e.labelOrientation,
                    verticalLabel: e.verticalLabel,
                    suppressTextOutline: e.suppressTextOutline,
                    interactiveLabel: e.interactiveLabel,
                    editableLabelMode: e.editableLabelMode,
                    residualVariable: e.residualVariable,
                    regressionParameters: e.regressionParameters,
                    isLogModeRegression: e.isLogModeRegression,
                    showLabel: e.showLabel,
                    shouldGraph: e.hidden,
                    slider: {
                        min: e.slider.hardMin ? e.slider.min : "",
                        max: e.slider.hardMax ? e.slider.max : "",
                        softMin: e.slider.hardMin ? "" : e.slider.min,
                        softMax: e.slider.hardMax ? "" : e.slider.max,
                        step: e.slider.step,
                        isPlayingOnce: e.slider.isPlaying && e.slider.loopMode === i.SliderLoopMode.PLAY_ONCE
                    }
                }, h(e))
            }
    });
    _("core/math/features/graph", ["require", "exports", "parsenodes", "core/math/comparators", "core/math/builtin", "tslib", "core/math/plotter", "core/types/graphmode", "core/lib/dragmode", "core/math/expression-types", "core/math/cdf-branches", "core/math/copy-defined-pois", "core/math/distribution-spec", "core/graphing-calc/json/expression", "core/types/opacity", "core/lib/color-helpers", "core/types/styles", "core/math/types"], function(e, t, g, y, I, C, N, R, B, v, A, V, F, b, x, k, L, S) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var _ = g.List;
        function q(e, t) {
            for (var r = 1 / 0, n = -1 / 0, i = 1 / 0, a = -1 / 0, o = 0, s = t; o < s.length; o++)
                for (var u = s[o], c = 0; c < u.length; c += 2) {
                    var l = u[c]
                        , p = u[c + 1];
                    l < r && (r = l),
                    n < l && (n = l),
                    p < i && (i = p),
                    a < p && (a = p)
                }
            if (isFinite(r) && isFinite(i))
                return {
                    type: e,
                    xmin: r,
                    ymin: i,
                    xmax: n,
                    ymax: a
                }
        }
        function E(e, t, r) {
            var n = {};
            r -= .5 * t;
            for (var i = e.length - 1; 0 <= i; i--) {
                var a = e[i]
                    , o = Math.floor((a - r) / t);
                n[o] ? n[o].data.push(a) : n[o] = {
                    id: o,
                    data: [a],
                    min: o * t + r,
                    max: o * t + r + t,
                    center: o * t + r + t / 2
                }
            }
            return n
        }
        g.Base.prototype._graph = function(D, e, w, P) {
            var O = this;
            if (e instanceof g.SolvedEquation)
                return this._graph(D, e._expression, w, P);
            function t(e) {
                var t = e.editableLabelMode;
                return t === b.EditableLabelMode.Text || t === b.EditableLabelMode.Math
            }
            var r = e.getExpressionType(P.graphMode, e.valueType)
                , n = v.getReconciledExpressionProps(r, {
                points: this.userData.points,
                lines: this.userData.lines,
                fill: this.userData.fill
            });
            switch (P.graphMode) {
                case R.XYPOINT_MOVABLE:
                    var i = z([e.asArray()])
                        , a = this.userData.shouldGraph && n.points
                        , o = this.userData.showLabel && !a;
                    return a ? [{
                        segments: [i],
                        graphMode: P.graphMode,
                        color: k.getDisplayColor(this.userData, this.metaData),
                        style: this.userData.pointStyle,
                        showLabel: !!this.userData.showLabel,
                        labelSize: this.userData.labelSize,
                        labelOrientation: this.userData.labelOrientation,
                        pointOpacity: this.metaData.computedPointOpacity,
                        verticalLabel: this.userData.verticalLabel,
                        suppressTextOutline: this.userData.suppressTextOutline,
                        editableLabel: t(this.userData),
                        labels: this.computedLabels || [],
                        poi: V.default(i),
                        movablePointInfo: []
                    }] : o ? [{
                        segments: [i],
                        graphMode: R.XYPOINT,
                        color: k.getDisplayColor(this.userData, this.metaData),
                        style: this.userData.pointStyle,
                        showLabel: !!this.userData.showLabel,
                        nakedLabel: !0,
                        labelSize: this.userData.labelSize,
                        labelOrientation: this.userData.labelOrientation,
                        pointOpacity: this.metaData.computedPointOpacity,
                        verticalLabel: this.userData.verticalLabel,
                        suppressTextOutline: this.userData.suppressTextOutline,
                        editableLabel: t(this.userData),
                        labels: this.computedLabels || [],
                        poi: V.default(i),
                        showPoint: !1
                    }] : [];
                case R.XYPOINT:
                    var s = []
                        , u = _.wrap(e).mapElements(D, function(e) {
                        return e.asArray()
                    })
                        , c = this.userData.shouldGraph && n.points
                        , l = this.userData.shouldGraph && n.lines
                        , p = this.userData.showLabel && !c && !l;
                    return (this.userData.showLabel || c) && s.push({
                        segments: [z(u)],
                        graphMode: P.graphMode,
                        color: k.getDisplayColor(this.userData, this.metaData),
                        style: this.userData.pointStyle,
                        showLabel: !!this.userData.showLabel,
                        showPoint: c,
                        labelSize: this.userData.labelSize,
                        labelOrientation: this.userData.labelOrientation,
                        pointOpacity: this.metaData.computedPointOpacity,
                        verticalLabel: this.userData.verticalLabel,
                        suppressTextOutline: this.userData.suppressTextOutline,
                        interactiveLabel: !!this.userData.interactiveLabel,
                        editableLabel: t(this.userData),
                        nakedLabel: p,
                        labels: this.computedLabels || [],
                        poi: V.default(u)
                    }),
                    l && s.push({
                        segments: M(u),
                        graphMode: R.PARAMETRIC,
                        color: k.getDisplayColor(this.userData, this.metaData),
                        style: this.userData.lineStyle,
                        lineWidth: this.metaData.computedLineWidth,
                        lineOpacity: this.metaData.computedLineOpacity,
                        poi: {}
                    }),
                        s;
                case R.PARAMETRIC:
                case R.PARAMETRIC_CURVE_3D:
                    var f = this.userData
                        , h = this.metaData
                        , d = []
                        , s = _.wrap(e).mapElements(D, function(e, t) {
                        if (0 === e.getDependencies().length) {
                            var r = z([e.asArray()]);
                            return {
                                segments: [r],
                                graphMode: R.XYPOINT,
                                color: k.getDisplayColor(f, h),
                                style: f.lineStyle,
                                lineWidth: O.metaData.computedLineWidth,
                                lineOpacity: O.metaData.computedLineOpacity,
                                poi: V.default(r)
                            }
                        }
                        var n = e.getCompiledFunction()
                            , i = O.getGraphInfo(D, e, t);
                        return i.graphMode = P.graphMode,
                            i.domain = {
                                min: O.metaData.evaluatedDomainMin,
                                max: O.metaData.evaluatedDomainMax
                            },
                            i.style = O.userData.lineStyle,
                            i.lineWidth = O.metaData.computedLineWidth,
                            i.lineOpacity = O.metaData.computedLineOpacity,
                            N.default.computeGraphData({
                                viewState: w,
                                graphInfo: i,
                                compiled: n
                            })
                    });
                    if (n.fill) {
                        if (s.forEach(function(e) {
                            d.push({
                                segments: e.segments,
                                color: k.getDisplayColor(f, h),
                                fillOpacity: O.metaData.computedFillOpacity,
                                graphMode: R.POLYGONFILL,
                                poi: {}
                            })
                        }),
                            !n.lines)
                            return d;
                        s = s.concat(d)
                    }
                    return s;
                case R.X:
                case R.Y:
                case R.IMPLICIT:
                case R.POLAR:
                case R.Z_3D:
                    var T = []
                        , L = e.valueType === S.Number;
                    return _.wrap(e).eachElement(D, function(e, t) {
                        var r, n = P.graphMode === R.IMPLICIT || P.graphMode === R.Z_3D ? e.getCompiledFunction(["x", "y"]) : e.getCompiledFunction(), i = F.getFunctionSpecFromTree(O), a = i && i.discrete, o = function(e, t) {
                            if (e) {
                                var r, n, i, a, o, s, u, c = e.discrete ? "discreteDistribution" : "continuousDistribution";
                                if ("binomialdist" === e.symbol)
                                    return r = t.args[1].asValue(),
                                        n = 2 < t.args.length ? t.args[2].asValue() : .5,
                                        {
                                            type: c,
                                            xmin: 0,
                                            xmax: r,
                                            ymin: 0,
                                            ymax: l = I.binompdf(n * r, r, n)
                                        };
                                if ("poissondist" === e.symbol)
                                    return {
                                        type: c,
                                        xmin: 0,
                                        xmax: 2.5 * (i = t.args[1].asValue()),
                                        ymin: 0,
                                        ymax: l = Math.max(I.poissonpdf(Math.floor(i), i), I.poissonpdf(Math.ceil(i), i))
                                    };
                                if ("normaldist" === e.symbol)
                                    return i = 1 < t.args.length ? t.args[1].asValue() : 0,
                                        a = 2 < t.args.length ? t.args[2].asValue() : 1,
                                        l = I.normalpdf(i, i, a),
                                        {
                                            type: c,
                                            xmin: i - 2 * Math.abs(a),
                                            xmax: i + 2 * Math.abs(a),
                                            ymin: 0,
                                            ymax: l
                                        };
                                if ("uniformdist" === e.symbol)
                                    return i = ((o = 1 < t.args.length ? t.args[1].asValue() : 0) + (s = 2 < t.args.length ? t.args[2].asValue() : 1)) / 2,
                                        {
                                            type: c,
                                            xmin: o - (u = s - o) / 3,
                                            xmax: s + u / 3,
                                            ymin: 0,
                                            ymax: l = I.uniformpdf(i, o, s)
                                        };
                                if ("tdist" === e.symbol) {
                                    var l, p = t.args[1].asValue();
                                    return {
                                        type: c,
                                        xmin: -3,
                                        xmax: 3,
                                        ymin: 0,
                                        ymax: l = I.tpdf(0, p)
                                    }
                                }
                            }
                        }(i, e);
                        try {
                            r = e.getCompiledDerivative()
                        } catch (e) {}
                        var s = O.getGraphInfo(D, e, t);
                        s.graphMode = P.graphMode,
                            s.style = O.userData.lineStyle,
                            s.lineWidth = O.metaData.computedLineWidth,
                            s.lineOpacity = O.metaData.computedLineOpacity,
                        P.graphMode === R.POLAR && (s.domain = {
                            min: O.metaData.evaluatedDomainMin,
                            max: O.metaData.evaluatedDomainMax,
                            isExplicit: O.metaData.isExplicitDomain
                        });
                        var u = k.getDisplayColor(O.userData, O.metaData)
                            , c = O.metaData.evaluatedCDFMin
                            , l = O.metaData.evaluatedCDFMax;
                        if (isNaN(c) || isNaN(l) || !L) {
                            var p = {
                                viewState: w,
                                graphInfo: s,
                                compiled: n,
                                derivative: r,
                                discrete: a,
                                maxOverride: void 0
                            };
                            i && "binomialdist" === i.symbol && (p.maxOverride = e.args[1].asValue());
                            var f = N.default.computeGraphData(p);
                            o && (f.boundingBox = o);
                            var h, d = k.getDisplayColor(O.userData, O.metaData);
                            f.fillSegments ? (f.fillSegments,
                                h = C.__rest(f, ["fillSegments"]),
                                T.push(h)) : a ? T.push({
                                graphMode: R.XYPOINT,
                                segments: [z(f.segments)],
                                showPoint: O.userData.shouldGraph,
                                color: d,
                                style: f.style,
                                boundingBox: o,
                                poi: V.default(f.segments)
                            }) : T.push(f),
                            s.graphMode === R.IMPLICIT && "=" !== s.operator && T.push({
                                graphMode: R.POLYGONFILL,
                                segments: f.fillSegments,
                                poi: {},
                                color: d
                            })
                        } else {
                            var m = {
                                viewState: w,
                                graphInfo: s,
                                compiled: n,
                                derivative: r,
                                bounds: [c, l],
                                discrete: a,
                                maxOverride: void 0
                            };
                            i && "binomialdist" === i.symbol && (m.maxOverride = e.args[1].asValue());
                            var g, y = A.makeCDFTopBranches(m), v = y.cdfTopBranch, b = y.topBranches;
                            if (b.forEach(function(e) {
                                e && o && (e.boundingBox = o)
                            }),
                                b.every(function(e) {
                                    return void 0 !== e
                                }))
                                if (a)
                                    T = b.map(function(e) {
                                        return {
                                            graphMode: R.XYPOINT,
                                            segments: [z(e.segments)],
                                            showPoint: O.userData.shouldGraph,
                                            color: u,
                                            style: e.style,
                                            poi: V.default(e.segments),
                                            boundingBox: o
                                        }
                                    }),
                                    v && v.segments.length && (g = [],
                                        v.segments.forEach(function(e) {
                                            isNaN(e[0]) || isNaN(e[1]) || g.push([e[0], 0, e[0], e[1]])
                                        }),
                                        T.push({
                                            graphMode: R.PARAMETRIC,
                                            segments: g,
                                            boundingBox: o,
                                            poi: {},
                                            color: u
                                        }));
                                else if (T = b,
                                v && v.segments.length) {
                                    for (var x = void 0, S = void 0, _ = 0; _ < v.segments.length; _++) {
                                        if (4 <= (E = v.segments[_]).length) {
                                            x = E[0];
                                            break
                                        }
                                    }
                                    for (var E, M, _ = v.segments.length - 1; 0 <= _; _--) {
                                        if (4 <= (E = v.segments[_]).length) {
                                            S = E[E.length - 2];
                                            break
                                        }
                                    }
                                    void 0 !== x && void 0 !== S && isFinite(x) && isFinite(S) && (M = N.default.polygonsFromSegments(v.segments, [[x, 0, S, 0]], v.graphMode),
                                        T.push({
                                            graphMode: R.POLYGONFILL,
                                            segments: M,
                                            poi: {},
                                            color: u
                                        }))
                                }
                        }
                    }),
                        T;
                case R.POLYGONFILL:
                case R.VISUALIZATION:
                case R.OBJECT3D:
                case R.NONE:
                    return !1;
                default:
                    var m = P.graphMode;
                    throw new Error("Unexpected graphMode: " + m)
            }
        }
            ,
            g.Base.prototype.graph = function(e, t, r) {
                var n = this.getGraphInfo(e, t);
                return this._graph(e, t, r, n)
            }
            ,
            g.BaseComparator.prototype.graph = function(e, t, r) {
                var n = this.getGraphInfo(e, t)
                    , i = n.graphMode;
                if (i === R.IMPLICIT)
                    return this._graph(e, t, r, n);
                if (i === R.NONE)
                    return !1;
                if (!(t instanceof g.SolvedEquation))
                    return !1;
                var a = this.getOperator()
                    , o = []
                    , s = []
                    , u = !0;
                t._expression.eachElement(e, function(e) {
                    o.push(e.getCompiledFunction());
                    try {
                        s.push(e.getCompiledDerivative())
                    } catch (e) {
                        u = !1
                    }
                }),
                u || (s = void 0);
                for (var c = [], l = [-1, 0, 0, 1], p = o.length, f = 0; f < p; f++) {
                    var h = this.getGraphInfo(e, t._expression.args[f]);
                    h.graphMode = i,
                        h.style = this.userData.lineStyle,
                    n.graphMode === R.POLAR && (h.domain = {
                        min: this.metaData.evaluatedDomainMin,
                        max: this.metaData.evaluatedDomainMax,
                        isExplicit: this.metaData.isExplicitDomain
                    });
                    var d = N.default.computeGraphData({
                        viewState: r,
                        graphInfo: h,
                        compiled: o[f],
                        derivative: s ? s[f] : void 0
                    });
                    d.operator = y.get(y.table[a].inclusive, l[f % 4]),
                        c.push(d)
                }
                for (f = 0; f < p; f += 4) {
                    var m = N.default.polygonsFromSegments(c[f + 1].segments, c[f + 2].segments, i);
                    c.push({
                        graphMode: R.POLYGONFILL,
                        segments: m,
                        poi: {},
                        color: k.getDisplayColor(this.userData, this.metaData)
                    })
                }
                return c
            }
            ,
            g.DoubleInequality.prototype.graph = function(i, e, a) {
                var o = this
                    , s = this.getGraphInfo(i, e);
                if (s.graphMode === R.NONE)
                    return !1;
                var u = []
                    , c = y.get(y.table[this._operators[0]].inclusive, 0)
                    , l = y.get(y.table[this._operators[1]].inclusive, 0)
                    , p = this.userData
                    , f = this.metaData
                    , h = k.getDisplayColor(this.userData, this.metaData);
                return _.eachArgs(i, e._expressions, function(e) {
                    e[0].userData = e[1].userData = p,
                        e[0].metaData = e[1].metaData = f;
                    var t = o._graph(i, e[0], a, s)[0];
                    t.operator = c,
                        u.push(t);
                    var r = o._graph(i, e[1], a, s)[0];
                    r.operator = l,
                        u.push(r);
                    var n = N.default.polygonsFromSegments(t.segments, r.segments, t.graphMode);
                    u.push({
                        graphMode: R.POLYGONFILL,
                        segments: n,
                        poi: {},
                        color: h
                    })
                }),
                    u
            }
            ,
            g.Regression.prototype.graph = function(e, t, r) {
                var n = this.getGraphInfo(e, t);
                return this._graph(e, t.model, r, n)
            }
            ,
            g.Polygon.prototype.graph = function(e, t, r) {
                var n = []
                    , i = void 0 === this.userData.lines || this.userData.lines
                    , a = void 0 === this.userData.fill || this.userData.fill;
                if (!a && !i)
                    return n;
                var o = this.getGraphInfo(e, t)
                    , s = t.args[0].asValue();
                if (!s.length)
                    return n;
                var u = M(C.__spreadArrays(s, [s[0]]));
                return u.length && (a && n.push({
                    segments: u,
                    graphMode: R.POLYGONFILL,
                    poi: {},
                    color: o.color,
                    fillOpacity: this.metaData.computedFillOpacity,
                    style: o.style
                }),
                i && n.push({
                    segments: u,
                    graphMode: R.PARAMETRIC,
                    poi: {},
                    color: o.color,
                    style: this.userData.lineStyle,
                    lineWidth: this.metaData.computedLineWidth,
                    lineOpacity: this.metaData.computedLineOpacity
                })),
                    n
            }
        ;
        function j(e) {
            return Array.prototype.concat.apply([], e)
        }
        function z(e) {
            for (var t = [], r = 0, n = e; r < n.length; r++) {
                var i = n[r]
                    , a = i[0]
                    , o = i[1];
                isNaN(a) || isNaN(o) || t.push(i)
            }
            return t
        }
        function M(e) {
            for (var t = [], r = [], n = 0, i = e; n < i.length; n++) {
                var a = i[n]
                    , o = a[0]
                    , s = a[1];
                isNaN(o) || isNaN(s) ? (4 <= t.length && r.push(t),
                    t = []) : t.push(o, s)
            }
            return 4 <= t.length && r.push(t),
                r
        }
        g.Object3D.prototype.graph = function(e, t, r) {
            var n, i, a, o = this.getGraphInfo(e, t);
            return [{
                segments: [(n = e,
                    i = t,
                    a = [],
                    _.wrap(i).eachElement(n, function(e) {
                        a.push(e.args.map(function(e) {
                            return e.asValue()
                        }))
                    }),
                    a)],
                color: o.color,
                objectName: this._symbol,
                graphMode: R.OBJECT3D
            }]
        }
            ,
            g.Histogram.prototype.graph = function(e, t, r) {
                var n = this.getGraphInfo(e, t)
                    , i = t.args[0].asValue()
                    , a = t.args[1].asValue()
                    , o = E(i, a, this.userData.vizProps && "left" === this.userData.vizProps.binAlignment ? a / 2 : 0)
                    , s = 1;
                this.userData.vizProps && "density" === this.userData.vizProps.histogramMode ? s = 1 / (i.length * a) : this.userData.vizProps && "relative" === this.userData.vizProps.histogramMode && (s = 1 / i.length);
                var u = []
                    , c = [];
                for (var l in o) {
                    var p = o[l]
                        , f = p.data.length;
                    c.push([p.min, 0 * s, p.min, f * s, p.max, f * s, p.max, 0 * s]);
                    var h = 0;
                    o[p.id + 1] && (h = o[p.id + 1].data.length);
                    var d = [p.min, 0 * s, p.min, f * s, p.max, f * s];
                    h < f && d.push(p.max, h * s),
                        u.push(d)
                }
                var m = q("histogram", c);
                return m && a && (m.binWidth = a),
                    [{
                        segments: c,
                        graphMode: R.POLYGONFILL,
                        boundingBox: m,
                        poi: {},
                        color: n.color,
                        fillOpacity: x.DEFAULT
                    }, {
                        segments: u,
                        graphMode: R.Y,
                        poi: {
                            zeros: {
                                x: [],
                                y: []
                            },
                            extrema: {
                                x: [],
                                y: []
                            },
                            intercept: {
                                x: [],
                                y: []
                            }
                        },
                        color: n.color
                    }]
            }
            ,
            g.DotPlot.prototype.graph = function(e, t, r) {
                var n, i = this.getGraphInfo(e, t), a = t.args[1].asValue(), o = this.userData.vizProps && "left" === this.userData.vizProps.binAlignment ? a / 2 : 0, s = E(t.args[0].asValue(), a, o), u = !1, c = [];
                for (var l in s)
                    for (var p, f = (p = s[l]).data.length - 1; 0 <= f; f--)
                        p.center !== p.data[f] && (u = !0);
                if (this.userData.vizProps && "exact" === this.userData.vizProps.dotplotXMode)
                    for (var l in s) {
                        (n = (p = s[l]).data).reverse();
                        for (var h = 0; h < n.length; h++)
                            c.push([n[h], h + 1])
                    }
                else
                    for (var l in s) {
                        n = (p = s[l]).data;
                        for (h = 0; h < n.length; h++)
                            c.push([p.center, h + 1])
                    }
                var d = q("dotplot", c);
                return d && a && (d.ymin = 0,
                    d.xmin -= .5 * a,
                    d.xmax += .5 * a,
                    d.binWidth = a),
                    [{
                        segments: [c],
                        graphMode: R.XYPOINT,
                        boundingBox: d,
                        poi: V.default(c),
                        color: i.color,
                        style: this.userData.pointStyle,
                        pointSize: this.userData.vizProps && this.userData.vizProps.dotplotSize,
                        showPoint: !0,
                        needsDotplotXMode: u
                    }]
            }
            ,
            g.BoxPlot.prototype.graph = function(e, t, r) {
                var n = this.getGraphInfo(e, t)
                    , i = this.metaData.evaluatedAxisOffset
                    , a = this.metaData.evaluatedBreadth
                    , o = t.args[0].asValue();
                if (isNaN(a) || isNaN(i))
                    return !1;
                var s, u, c, l = Math.min.apply(null, o), p = Math.max.apply(null, o), f = I.quartile(o, 1), h = I.quartile(o, 2), d = I.quartile(o, 3), m = i, g = m - a / 2, y = m + a / 2, v = a / 10, b = [];
                this.userData.vizProps.showBoxplotOutliers && (u = f - 1.5 * (s = d - f),
                    c = d + 1.5 * s,
                    l = 1 / 0,
                    p = -1 / 0,
                    o.forEach(function(e) {
                        u <= e && e < l && (l = e),
                        p < e && e <= c && (p = e),
                        (e < u || c < e) && b.push([e, m])
                    }));
                var x = [[f, g, d, g, d, y, f, y, f, g], [h, g, h, y], [f, m, l, m], [d, m, p, m], [l, m - v, l, m + v], [p, m - v, p, m + v]];
                if (this.userData.vizProps && "y" === this.userData.vizProps.alignedAxis) {
                    for (var S = 0, _ = x; S < _.length; S++)
                        for (var E = _[S], M = 0; M < E.length; M += 2) {
                            var D = E[M];
                            E[M] = E[M + 1],
                                E[M + 1] = D
                        }
                    for (var w = 0, P = b; w < P.length; w++) {
                        var O = P[w]
                            , D = O[0];
                        O[0] = O[1],
                            O[1] = D
                    }
                }
                var T = [{
                    segments: x,
                    graphMode: R.PARAMETRIC,
                    boundingBox: q("boxplot", x.concat(b)),
                    poi: {},
                    color: n.color
                }];
                return b.length && T.push({
                    segments: [b],
                    graphMode: R.XYPOINT,
                    color: n.color,
                    style: L.PointStyle.OPEN,
                    showPoint: !0,
                    poi: V.default(b)
                }),
                    T
            }
            ,
            g.Table.prototype.isValueDraggable = function(e, t, r) {
                if (!e.columns[t].isIndependent)
                    return !1;
                var n = this.columns[t].values
                    , i = n && n[r];
                return !(!i || !isFinite(i.asValue()) || 0 !== i._dependencies.length)
            }
            ,
            g.Table.prototype.graph = function(e, t, r) {
                var n = {};
                if (t.columns[0].isError)
                    return n;
                for (var i = t.columns[0], a = i.values, o = 1; o < this.columns.length; o++) {
                    var s = t.columns[o];
                    if (!s.isError) {
                        var u = this.columns[o].header.userData
                            , c = this.columns[o].header.metaData;
                        if (!u.hidden) {
                            for (var l = u.dragMode, p = l === B.DragMode.X || l === B.DragMode.XY, f = l === B.DragMode.Y || l === B.DragMode.XY, h = !!u.points, d = !!u.lines, m = s.isDiscrete(i), g = d && m, y = d && !m, v = [], b = [], x = [], S = [], _ = [], E = [], M = 1 / 0, D = -1 / 0, w = 1 / 0, P = -1 / 0, O = 0; O < a.length; O++) {
                                var T, L, I, C, N = a[O], A = s.values[O];
                                N && A && isFinite(N.asValue()) && isFinite(A.asValue()) ? (T = N.asValue(),
                                    L = A.asValue(),
                                h && (I = p && this.isValueDraggable(t, 0, O),
                                    C = f && this.isValueDraggable(t, o, O),
                                    I || C ? (x.push([T, L]),
                                        S.push({
                                            index: O,
                                            dragX: I,
                                            dragY: C
                                        })) : b.push([T, L])),
                                g && E.push([T, L]),
                                T < M && (M = T),
                                D < T && (D = T),
                                L < w && (w = L),
                                P < L && (P = L)) : g && (1 < E.length && _.push(E),
                                    E = [])
                            }
                            var F, q = {
                                type: "table",
                                xmin: M,
                                xmax: D,
                                ymin: w,
                                ymax: P
                            };
                            x.length && v.push({
                                graphMode: R.XYPOINT_MOVABLE,
                                segments: [x],
                                color: k.getDisplayColor(u, c),
                                tableId: u.tableId,
                                poi: V.default(x),
                                movablePointInfo: S,
                                boundingBox: q,
                                pointOpacity: 1
                            }),
                            b.length && v.push({
                                segments: [b],
                                graphMode: R.XYPOINT,
                                showPoint: !0,
                                poi: V.default(b),
                                color: k.getDisplayColor(u, c),
                                style: u.pointStyle,
                                tableId: u.tableId,
                                boundingBox: q
                            }),
                            (_.length || E.length) && (_.push(E),
                                v.push({
                                    segments: _.map(j),
                                    graphMode: R.PARAMETRIC,
                                    poi: {},
                                    color: k.getDisplayColor(u, c),
                                    style: u.lineStyle,
                                    tableId: u.tableId,
                                    boundingBox: q
                                })),
                            !y || (F = this.columns[o].header.graph(e, t.columns[o].header, r)).length && Array.prototype.push.apply(v, F),
                            v.length && (n[u.id] = v)
                        }
                    }
                }
                return n
            }
            ,
            g.Image.prototype.graph = function(e, t, r) {
                var n = [];
                if (!("OrderedPair" === t.center.type && t.center.args[0].isConstant && t.center.args[1].isConstant && t.radianAngle.isConstant && t.width.isConstant && t.height.isConstant && t.opacity.isConstant))
                    return n;
                for (var i, a, o, s = [], u = [], c = t.width.asValue() / 2, l = t.height.asValue() / 2, p = t.radianAngle.asValue(), f = -1; f <= 1; f++)
                    for (var h = -1; h <= 1; h++) {
                        var d = [t.center.args[0].asValue() + f * c * Math.cos(p) + h * l * Math.sin(p), t.center.args[1].asValue() - f * c * Math.sin(p) + h * l * Math.cos(p)];
                        (i = t.moveStrategy,
                            a = f,
                            o = h,
                        !!i && (0 === a && 0 === o ? "none" !== i[2].type || "none" !== i[3].type : 0 !== a && 0 !== o ? "none" !== i[0].type && "none" !== i[1].type : 0 !== a ? "none" !== i[0].type : 0 !== o && "none" !== i[1].type)) && (s.push(d),
                            u.push([f, h]))
                    }
                return n.push({
                    segments: [s],
                    scaleFactors: [u],
                    graphMode: R.XYPOINT_MOVABLE,
                    color: k.getDisplayColor(this.userData, this.metaData),
                    style: this.userData.style,
                    poi: V.default(s),
                    movablePointInfo: [],
                    pointOpacity: 1
                }),
                    n
            }
    });
    _("core/math/features/elementAt", ["require", "parsenodes", "core/math/builtinframe"], function(e) {
        "use strict";
        var i = e("parsenodes")
            , a = e("core/math/builtinframe");
        function t(e, t) {
            for (var r = 0; r < this.length; r++)
                t(this.elementAt(e, r), r)
        }
        function r(e, t) {
            for (var r = [], n = 0; n < this.length; n++)
                r.push(t(this.elementAt(e, n), n));
            return r
        }
        i.List.prototype.elementAt = function(e, t) {
            return 0 <= (t = Math.floor(t)) && t < this.args.length ? this.args[t] : i.Constant(NaN)
        }
            ,
            i.Broadcast.prototype.elementAt = function(e, t) {
                if ((t = Math.floor(t)) < 0 || t >= this.length)
                    return i.Constant(NaN);
                for (var r = {}, n = 0; n < this._replacedSymbols.length; n++)
                    r[this._replacedSymbols[n]] = this._lists[n].elementAt(e, t);
                return this._expression.substitute(r).getConcreteTree(e, a)
            }
            ,
            i.Broadcast.prototype.asList = function(e) {
                for (var t = [], r = 0; r < this.length; r++)
                    t.push(this.elementAt(e, r));
                return i.List(t)
            }
            ,
            i.List.prototype.eachElement = t,
            i.Broadcast.prototype.eachElement = t,
            i.List.prototype.mapElements = r,
            i.Broadcast.prototype.mapElements = r,
            i.OrderedPair.prototype.elementAt = function(e, t) {
                switch (t) {
                    case 0:
                        return this.args[0];
                    case 1:
                        return this.args[1];
                    default:
                        return i.Constant(NaN)
                }
            }
            ,
            i.RGBColor.prototype.elementAt = function(e, t) {
                switch (t) {
                    case 0:
                        return this.args[0];
                    case 1:
                        return this.args[1];
                    case 2:
                        return this.args[2];
                    default:
                        return i.Constant(NaN)
                }
            }
    });
    _("core/lib/number-to-latex", ["require", "exports"], function(e, t) {
        "use strict";
        function o(e) {
            var t, r, n, i, a, o, s = e + "";
            return /\d+\.?\d*e[\+\-]*\d+/i.test(s) && (t = String(s).toLowerCase().split("e"),
                r = parseFloat(t[0]),
                n = parseInt(t[1], 10),
                i = Math.abs(n),
                a = Math.abs(r).toString().split("."),
                s = n < 0 ? "0." + new Array(i).join("0") + a.join("") : ((o = a[1]) && (i -= o.length),
                a.join("") + new Array(i + 1).join("0")),
            r < 0 && (s = "-" + s)),
                s
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.numberToStatsConfidenceLatex = t.numberToDecimalString = void 0,
            t.default = function(e) {
                if ("string" == typeof e)
                    return e;
                if (void 0 === e)
                    return "";
                var t = e + "";
                return t = (t = t.replace(/1e\+?([-\d]+)/, "10^{$1}")).replace(/([-\d\.]+)e\+?([-\d]+)/, "$1\\cdot 10^{$2}")
            }
            ,
            t.numberToDecimalString = o,
            t.numberToStatsConfidenceLatex = function(e, t) {
                void 0 === t && (t = 2);
                var r, n = o(e), i = n.indexOf(".");
                if (-1 === i)
                    return n;
                for (var a = i + 1; a < n.length; a++)
                    if (r) {
                        if (n[a] !== r)
                            break
                    } else {
                        if ("0" !== n[a] && "9" !== n[a])
                            break;
                        r = n[a]
                    }
                return n.substr(0, Math.max(i + 5, a + t))
            }
    });
    _("core/math/features/printLatex", ["require", "parsenodes", "core/lib/label", "core/lib/number-to-latex"], function(e) {
        "use strict";
        var n = e("parsenodes")
            , t = e("core/lib/label")
            , r = e("core/lib/number-to-latex").default;
        function i() {
            return t.identifierToLatex(this._symbol) + " "
        }
        function a(e) {
            switch (e) {
                case ">":
                    return "\\gt ";
                case "<":
                    return "\\lt ";
                case ">=":
                    return "\\ge ";
                case "<=":
                    return "\\le ";
                case "=":
                    return "="
            }
        }
        function o(e) {
            return e.printLatex()
        }
        function s() {
            switch (this._symbol) {
                case "sqrt":
                    return "\\sqrt{" + this.args[0].printLatex() + "}";
                case "nthroot":
                    return "\\sqrt[" + this.args[1].printLatex() + "]{" + this.args[0].printLatex() + "}";
                case "logbase":
                    return "\\log_{" + this.args[1].printLatex() + "}\\left(" + this.args[0].printLatex() + "\\right)";
                default:
                    return t.identifierToLatex(this._symbol) + "\\left(" + this.args.map(o).join(", ") + "\\right)"
            }
        }
        function u(e) {
            return e.isConstant && !0 === e.asValue()
        }
        n.Identifier.prototype.printLatex = i,
            n.FreeVariable.prototype.printLatex = i,
            n.Constant.prototype.printLatex = function() {
                return r(this.asValue())
            }
            ,
            n.Negative.prototype.printLatex = function() {
                return "-\\left(" + this.args[0].printLatex() + "\\right)"
            }
            ,
            n.Add.prototype.printLatex = function() {
                return "\\left(" + this.args[0].printLatex() + "\\right)+\\left(" + this.args[1].printLatex() + "\\right)"
            }
            ,
            n.PercentOf.prototype.printLatex = function() {
                return this.args[0].printLatex() + " \\% \\operatorname{of} " + this.args[1].printLatex()
            }
            ,
            n.Subtract.prototype.printLatex = function() {
                return "\\left(" + this.args[0].printLatex() + "\\right)-\\left(" + this.args[1].printLatex() + "\\right)"
            }
            ,
            n.Multiply.prototype.printLatex = function() {
                return "\\left(" + this.args[0].printLatex() + "\\right)*\\left(" + this.args[1].printLatex() + "\\right)"
            }
            ,
            n.Divide.prototype.printLatex = function() {
                return "\\frac{" + this.args[0].printLatex() + "}{" + this.args[1].printLatex() + "}"
            }
            ,
            n.Exponent.prototype.printLatex = function() {
                return "\\left(" + this.args[0].printLatex() + "\\right)^{" + this.args[1].printLatex() + "}"
            }
            ,
            n.Assignment.prototype.printLatex = function() {
                return t.identifierToLatex(this._symbol) + "=" + this._expression.printLatex()
            }
            ,
            n.Equation.prototype.printLatex = function() {
                return this._lhs.printLatex() + "=" + this._rhs.printLatex()
            }
            ,
            n.BaseComparator.prototype.printLatex = function() {
                return "\\left(" + this.args[0].printLatex() + "\\right)" + a(this.operator) + "\\left(" + this.args[1].printLatex() + "\\right)"
            }
            ,
            n.DoubleInequality.prototype.printLatex = function() {
                return "\\left(" + this.args[0].printLatex() + "\\right)" + a(this.args[1]) + this.args[2].printLatex() + a(this.args[3]) + "\\left(" + this.args[4].printLatex() + "\\right)"
            }
            ,
            n.And.prototype.printLatex = function() {
                if (!(this.args[0]instanceof n.BaseComparator && this.args[1]instanceof n.BaseComparator))
                    throw new Error("Not implemented");
                if (this.args[0].args[1].printLatex() !== this.args[1].args[0].printLatex())
                    throw new Error("Not implemented");
                return "\\left(" + this.args[0].args[0].printLatex() + "\\right)" + a(this.args[0].operator) + "\\left(" + this.args[0].args[1].printLatex() + "\\right)" + a(this.args[1].operator) + "\\left(" + this.args[1].args[1].printLatex() + "\\right)"
            }
            ,
            n.NativeFunction.prototype.printLatex = s,
            n.TypedFunction.prototype.printLatex = s,
            n.ReducerFunction.prototype.printLatex = s,
            n.ParametrizedReducerFunction.prototype.printLatex = s,
            n.DoubleReducerFunction.prototype.printLatex = s,
            n.FunctionCall.prototype.printLatex = s,
            n.Distribution.prototype.printLatex = s,
            n.SeededFunctionCall.prototype.printLatex = function() {
                return t.identifierToLatex(this._symbol) + "\\left(" + this.args.slice(1).map(o).join(", ") + "\\right)"
            }
            ,
            n.DotAccess.prototype.printLatex = function() {
                return "(" + this.args[0].printLatex() + ").(" + this.args[1].printLatex() + ")"
            }
            ,
            n.DotAccessExponent.prototype.printLatex = function() {
                return "(" + this.args[0].printLatex() + ").(" + this.args[1].printLatex() + ")^{" + this.args[2].printLatex() + "}"
            }
            ,
            n.Prime.prototype.printLatex = function() {
                switch (this.args[0]._symbol) {
                    case "logbase":
                        return "\\log_{" + this.args[0].args[1].printLatex() + "}" + Array(this.order + 1).join("'") + "\\left(" + this.args[0].args[0].printLatex() + "\\right)";
                    default:
                        return t.identifierToLatex(this.args[0]._symbol) + Array(this.order + 1).join("'") + "\\left(" + this.args[0].args.map(o).join(", ") + "\\right)"
                }
            }
            ,
            n.List.prototype.printLatex = function() {
                return "\\left[" + this.args.map(o).join(", ") + "\\right]"
            }
            ,
            n.Range.prototype.printLatex = function() {
                return "\\left[" + this.args[0].args.map(o).join(", ") + " ... " + this.args[1].args.map(o).join(", ") + "\\right]"
            }
            ,
            n.ListAccess.prototype.printLatex = function() {
                return "\\left(" + this.args[0].printLatex() + "\\right)\\left[" + this.args[1].printLatex() + "\\right]"
            }
            ,
            n.OrderedPair.prototype.printLatex = function() {
                return "\\left(" + this.args.map(o).join(", ") + "\\right)"
            }
            ,
            n.Sum.prototype.printLatex = function() {
                return "\\sum_{" + this.args[0].printLatex() + "=" + this.args[1].printLatex() + "}^{" + this.args[2].printLatex() + "}\\left(" + this.args[3].printLatex() + "\\right)"
            }
            ,
            n.Product.prototype.printLatex = function() {
                return "\\prod_{" + this.args[0].printLatex() + "=" + this.args[1].printLatex() + "}^{" + this.args[2].printLatex() + "}\\left(" + this.args[3].printLatex() + "\\right)"
            }
            ,
            n.Integral.prototype.printLatex = function() {
                return "\\int_{" + this.args[1].printLatex() + "}^{" + this.args[2].printLatex() + "}\\left(" + this.args[3].printLatex() + "\\right)d" + this.args[0].printLatex()
            }
            ,
            n.FunctionExponent.prototype.printLatex = function() {
                return this.args[0].printLatex() + "\\left(" + this.args[1].printLatex() + "\\right)^{" + this.args[2].printLatex() + "}"
            }
            ,
            n.FunctionFactorial.prototype.printLatex = function() {
                return this.args[0].printLatex() + "\\left(" + this.args[1].printLatex() + "\\right)!"
            }
            ,
            n.Piecewise.prototype.printLatex = function() {
                var e = this;
                if (u(e.args[0]))
                    return e.args[1].printLatex();
                for (var t, r = ["\\left\\{"]; ; ) {
                    if (u(e.args[0])) {
                        r.push(e.args[1].printLatex());
                        break
                    }
                    if (r.push(e.args[0].printLatex(), ": "),
                    (t = e.args[2]).isConstant && t.isNaN()) {
                        r.push(e.args[1].printLatex());
                        break
                    }
                    if (r.push(e.args[1].printLatex(), ", "),
                        !(e.args[2]instanceof n.Piecewise)) {
                        r.push(e.args[2].printLatex());
                        break
                    }
                    e = e.args[2]
                }
                return r.push("\\right\\}"),
                    r.join("")
            }
            ,
            n.FunctionDefinition.prototype.printLatex = function() {
                return t.identifierToLatex(this._symbol) + "\\left(" + this._argSymbols.map(t.identifierToLatex).join(", ") + "\\right) = " + this._expression.printLatex()
            }
            ,
            n.Derivative.prototype.printLatex = function() {
                return "\\frac{d}{d" + t.identifierToLatex(this._symbol) + "}\\left(" + this.args[0].printLatex() + "\\right)"
            }
            ,
            n.Regression.prototype.printLatex = function() {
                return "\\left(" + this._lhs.printLatex() + "\\right)\\sim\\left(" + this._rhs.printLatex() + "\\right)"
            }
            ,
            n.Polygon.prototype.printLatex = function() {
                return "\\polygon\\left(" + this.args.map(o).join(", ") + "\\right)"
            }
            ,
            n.Histogram.prototype.printLatex = function() {
                return "\\histogram\\left(" + this.args.map(o).join(", ") + "\\right)"
            }
            ,
            n.Object3D.prototype.printLatex = function() {
                return "\\" + this._symbol + "\\left(" + this.args.map(o).join(", ") + "\\right)"
            }
            ,
            n.DotPlot.prototype.printLatex = function() {
                return "\\dotplot\\left(" + this.args.map(o).join(", ") + "\\right)"
            }
            ,
            n.BoxPlot.prototype.printLatex = function() {
                return "\\boxplot\\left(" + this.args.map(o).join(", ") + "\\right)"
            }
            ,
            n.TTest.prototype.printLatex = function() {
                return "\\TTest\\left(" + this.args.map(o).join(", ") + "\\right)"
            }
            ,
            n.IndependentTTest.prototype.printLatex = function() {
                return "\\IndependentTTest\\left(" + this.args.map(o).join(", ") + "\\right)"
            }
            ,
            n.Stats.prototype.printLatex = function() {
                return "\\Stats\\left(" + this.args.map(o).join(", ") + "\\right)"
            }
    });
    _("core/math/features/statistics", ["require", "parsenodes", "core/math/maybe-rational"], function(e) {
        "use strict";
        var r = e("parsenodes")
            , n = r.BuiltInFunction
            , t = e("core/math/maybe-rational").maybeRational
            , i = r.Constant(t(0, 1))
            , a = r.Constant(t(1, 1))
            , o = r.Constant(t(2, 1))
            , s = r.Constant(t(1, 2))
            , u = r.Constant(-1 / 0);
        n.normaldist.prototype.pdf = function(e) {
            return n.normalpdf([e[0], this.args[0], this.args[1]])
        }
            ,
            n.normaldist.prototype.cdf = function(e) {
                var t, r = 1 === e.length ? (t = u,
                    e[0]) : (t = e[0],
                    e[1]);
                return n.normalcdf([t, r, this.args[0], this.args[1]])
            }
            ,
            n.normaldist.prototype.mean = function() {
                return this.args[0]
            }
            ,
            n.normaldist.prototype.median = function() {
                return this.args[0]
            }
            ,
            n.normaldist.prototype.stdev = function() {
                return n.abs([this.args[1]])
            }
            ,
            n.normaldist.prototype.var = function() {
                return r.Exponent([this.args[1], o])
            }
            ,
            n.normaldist.prototype.quantile = function(e) {
                return r.Add([r.Multiply([n.invNorm(e), this.stdev()]), this.mean()])
            }
            ,
            n.normaldist.prototype.sample = function(e) {
                return n.normalSample([e[0], this.args[0], this.args[1]])
            }
            ,
            n.tdist.prototype.pdf = function(e) {
                return n.tpdf([e[0], this.args[0]])
            }
            ,
            n.tdist.prototype.cdf = function(e) {
                var t, r = 1 === e.length ? (t = u,
                    e[0]) : (t = e[0],
                    e[1]);
                return n.tcdf([t, r, this.args[0]])
            }
            ,
            n.tdist.prototype.mean = function() {
                return i
            }
            ,
            n.tdist.prototype.median = function() {
                return i
            }
            ,
            n.tdist.prototype.quantile = function(e) {
                return n.invT([e[0], this.args[0]])
            }
            ,
            n.tdist.prototype.sample = function(e) {
                return n.tSample([e[0], this.args[0]])
            }
            ,
            n.tdist.prototype.stdev = function() {
                return n.sqrt([this.var()])
            }
            ,
            n.tdist.prototype.var = function() {
                var e = this.args[0];
                return r.Piecewise([r.Comparator[">="]([e, o]), r.Divide([e, r.Subtract([e, o])]), r.Constant(NaN)])
            }
            ,
            n.poissondist.prototype.pdf = function(e) {
                return n.poissonpdf([e[0], this.args[0]])
            }
            ,
            n.poissondist.prototype.cdf = function(e) {
                var t, r = 1 === e.length ? (t = u,
                    e[0]) : (t = e[0],
                    e[1]);
                return n.poissoncdf([t, r, this.args[0]])
            }
            ,
            n.poissondist.prototype.mean = function() {
                return this.args[0]
            }
            ,
            n.poissondist.prototype.median = function() {
                return n.invPoisson([s, this.args[0]])
            }
            ,
            n.poissondist.prototype.stdev = function() {
                return n.sqrt([this.args[0]])
            }
            ,
            n.poissondist.prototype.var = function() {
                return this.args[0]
            }
            ,
            n.poissondist.prototype.quantile = function(e) {
                return n.invPoisson([e[0], this.args[0]])
            }
            ,
            n.poissondist.prototype.sample = function(e) {
                return n.poissonSample([e[0], this.args[0]])
            }
            ,
            n.binomialdist.prototype.pdf = function(e) {
                return n.binompdf([e[0], this.args[0], this.args[1]])
            }
            ,
            n.binomialdist.prototype.cdf = function(e) {
                var t, r = 1 === e.length ? (t = u,
                    e[0]) : (t = e[0],
                    e[1]);
                return n.binomcdf([t, r, this.args[0], this.args[1]])
            }
            ,
            n.binomialdist.prototype.mean = function() {
                return r.Multiply([this.args[0], this.args[1]])
            }
            ,
            n.binomialdist.prototype.median = function() {
                return n.invBinom([s, this.args[0], this.args[1]])
            }
            ,
            n.binomialdist.prototype.stdev = function() {
                return n.sqrt([this.var()])
            }
            ,
            n.binomialdist.prototype.var = function() {
                var e = this.args[0]
                    , t = this.args[1];
                return r.Multiply([e, r.Multiply([t, r.Subtract([a, t])])])
            }
            ,
            n.binomialdist.prototype.quantile = function(e) {
                return n.invBinom([e[0], this.args[0], this.args[1]])
            }
            ,
            n.binomialdist.prototype.sample = function(e) {
                return n.binomSample([e[0], this.args[0], this.args[1]])
            }
            ,
            n.uniformdist.prototype.pdf = function(e) {
                return n.uniformpdf([e[0], this.args[0], this.args[1]])
            }
            ,
            n.uniformdist.prototype.cdf = function(e) {
                var t, r = 1 === e.length ? (t = u,
                    e[0]) : (t = e[0],
                    e[1]);
                return n.uniformcdf([t, r, this.args[0], this.args[1]])
            }
            ,
            n.uniformdist.prototype.mean = function() {
                return r.Divide([r.Add([this.args[0], this.args[1]]), o])
            }
            ,
            n.uniformdist.prototype.median = function() {
                return r.Divide([r.Add([this.args[0], this.args[1]]), o])
            }
            ,
            n.uniformdist.prototype.stdev = function() {
                return n.sqrt([this.var()])
            }
            ,
            n.uniformdist.prototype.var = function() {
                return r.Divide([r.Exponent([r.Subtract([this.args[1], this.args[0]]), o]), r.Constant(t(12, 1))])
            }
            ,
            n.uniformdist.prototype.quantile = function(e) {
                return n.invUniform([e[0], this.args[0], this.args[1]])
            }
            ,
            n.uniformdist.prototype.sample = function(e) {
                return n.uniformSample([e[0], this.args[0], this.args[1]])
            }
            ,
            r.List.prototype.sample = function(e) {
                return r.ListAccess([this, r.Add([n.floor([r.Multiply([n.uniformSample([e[0], i, a]), r.Constant(t(this.length, 1))])]), a])])
            }
    });
    _("core/math/features/getExpressionType", ["require", "parsenodes", "core/types/graphmode", "core/math/expression-types", "core/math/types"], function(e) {
        "use strict";
        var t = e("parsenodes")
            , r = e("core/types/graphmode")
            , n = e("core/math/expression-types").ExpressionType
            , i = e("core/math/types");
        t.Base.prototype.getExpressionType = function(e, t) {
            return e === r.X || e === r.Y ? n.X_OR_Y : e === r.XYPOINT || e === r.XYPOINT_MOVABLE ? t === i.Point ? n.SINGLE_POINT : n.POINT_LIST : e === r.PARAMETRIC || e === r.PARAMETRIC_CURVE_3D ? n.PARAMETRIC : e === r.POLAR ? n.POLAR : e === r.IMPLICIT ? n.IMPLICIT : n.X_OR_Y
        }
            ,
            t.Polygon.prototype.getExpressionType = function(e, t) {
                return n.POLYGON
            }
            ,
            t.Histogram.prototype.getExpressionType = function(e, t) {
                return n.HISTOGRAM
            }
            ,
            t.Object3D.prototype.getExpressionType = function(e, t) {
                return n.CUBE
            }
            ,
            t.DotPlot.prototype.getExpressionType = function(e, t) {
                return n.DOTPLOT
            }
            ,
            t.BoxPlot.prototype.getExpressionType = function(e, t) {
                return n.BOXPLOT
            }
    });
    _("core/math/features/findLinearSubset", ["require", "parsenodes", "core/math/maybe-rational"], function(e) {
        "use strict";
        var c = e("parsenodes")
            , t = e("core/math/maybe-rational").maybeRational
            , l = c.Constant(t(0, 1))
            , p = c.Constant(t(-1, 0));
        c.Expression.prototype.findLinearSubset = function(e) {
            for (var t = [], r = 0; r < e.length; r++)
                t.push(!this.dependsOn(e[r]));
            return t
        }
            ,
            c.FreeVariable.prototype.findLinearSubset = function(e) {
                for (var t = [], r = 0; r < e.length; r++)
                    t.push(!0);
                return t
            }
            ,
            c.Add.prototype.findLinearSubset = function(e) {
                for (var t = [], r = this.args[0].findLinearSubset(e), n = this.args[1].findLinearSubset(e), i = 0; i < e.length; i++)
                    t.push(r[i] && n[i]);
                return t
            }
            ,
            c.Subtract.prototype.findLinearSubset = c.Add.prototype.findLinearSubset,
            c.Negative.prototype.findLinearSubset = function(e) {
                return this.args[0].findLinearSubset(e)
            }
            ,
            c.Multiply.prototype.findLinearSubset = function(e) {
                for (var t = this.args[0].findLinearSubset(e).slice(), r = this.args[1].findLinearSubset(e).slice(), n = 0, i = 0, a = 0; a < e.length; a++)
                    t[a] = t[a] && !this.args[1].dependsOn(e[a]),
                    t[a] && (n += 1),
                        r[a] = r[a] && !this.args[0].dependsOn(e[a]),
                    r[a] && (i += 1);
                return i <= n ? t : r
            }
            ,
            c.Divide.prototype.findLinearSubset = function(e) {
                for (var t = this.args[0].findLinearSubset(e), r = [], n = 0; n < e.length; n++)
                    r.push(t[n] && !this.args[1].dependsOn(e[n]));
                return r
            }
            ,
            c.List.prototype.findLinearSubset = function(e) {
                var t = [];
                for (i = 0; i < e.length; i++)
                    t.push(!0);
                for (var r = 0; r < this.args.length; r++)
                    for (var n = this.args[r].findLinearSubset(e), i = 0; i < e.length; i++)
                        t[i] = t[i] && n[i];
                return t
            }
            ,
            c.Broadcast.prototype.findLinearSubset = function(e) {
                for (var t = this._replacedSymbols, r = this._expression, n = this._lists, i = {}, a = 0; a < n.length; a++) {
                    for (var o = n[a].findLinearSubset(e), s = l, u = 0; u < e.length; u++)
                        o[u] ? n[a].dependsOn(e[u]) && (s = c.Add([s, c.FreeVariable(e[u])])) : s = c.Add([s, c.Exponent([c.FreeVariable(e[u]), p])]);
                    i[t[a]] = s
                }
                return r.substitute(i).findLinearSubset(e)
            }
            ,
            c.Piecewise.prototype.findLinearSubset = function(e) {
                for (var t = this.args[0], r = this.args[1].findLinearSubset(e), n = this.args[2].findLinearSubset(e), i = [], a = 0; a < e.length; a++)
                    i.push(!t.dependsOn(e[a]) && r[a] && n[a]);
                return i
            }
    });
    _("core/math/features/deriveRegressionRestrictions", ["require", "parsenodes", "core/math/types", "core/math/domaintypes"], function(e) {
        "use strict";
        var h = e("parsenodes")
            , u = e("core/math/types")
            , a = e("core/math/domaintypes");
        function t(e) {
            for (var t, r = this.args[0], n = this.getDependencies(), i = {}, a = 0; a < n.length; a++)
                if (e.listStatistics.hasOwnProperty(n[a])) {
                    if (void 0 !== t)
                        return {};
                    t = n[a]
                }
            if (void 0 === t)
                return {};
            if (1 !== r.polynomialOrder(t))
                return {};
            var o = r.getPolynomialCoefficients(t)
                , s = o[1]
                , u = o[1].getDependencies();
            if (1 !== u.length)
                return {};
            var c = u[0];
            if (1 !== s.polynomialOrder(c))
                return {};
            var l = e.listStatistics[t]
                , p = (l.max - l.min) / Math.min(l.length - 1, 31)
                , f = Math.PI / p;
            return !isFinite(f) || f <= 0 ? {} : (i[c] = h.Piecewise([h.And([h.Comparator["<="]([h.Constant(0), s]), h.Comparator["<"]([s, h.Constant(f)])]), h.Constant(1), h.Constant(NaN)]).boundDomain(c),
                i)
        }
        h.Base.prototype.deriveRegressionRestrictions = function() {
            return this
        }
            ,
            h.Broadcast.prototype.deriveRegressionRestrictions = function() {
                for (var e = this._replacedSymbols, t = this._expression, r = this._lists, n = {}, i = 0; i < e.length; i++)
                    0 === r[i].getDependencies().length && r[i].valueType === u.ListOfNumber && (n[e[i]] = function(e) {
                        for (var t = 1 / 0, r = -1 / 0, n = e.length, i = 0; i < e.length; i++)
                            t = Math.min(t, e[i]),
                                r = Math.max(r, e[i]);
                        return {
                            min: t,
                            max: r,
                            length: n
                        }
                    }(r[i].asValue()));
                var a, o = t._deriveRegressionRestrictions({
                    listStatistics: n
                });
                for (a in o)
                    if ("known" !== o[a].type)
                        return this;
                var s = t;
                for (a in o)
                    s = function(e, t, r) {
                        if ("known" !== r.type)
                            return e;
                        var n = h.And([h.Comparator["<="]([h.Constant(r.bounds[0]), h.FreeVariable(t)]), h.Comparator["<="]([h.FreeVariable(t), h.Constant(r.bounds[1])])]);
                        return h.Multiply([e, h.Piecewise([n, h.Constant(1), h.Constant(NaN)])])
                    }(s, a, o[a]);
                return h.Broadcast(e, [s].concat(r))
            }
            ,
            h.Base.prototype._deriveRegressionRestrictions = function(e) {
                return {}
            }
            ,
            h.Expression.prototype._deriveRegressionRestrictions = function(e) {
                for (var t = {}, r = 0; r < this.args.length; r++) {
                    var n = this.args[r]._deriveRegressionRestrictions(e);
                    for (var i in n)
                        t[i] = t[i] ? a.intersectDomains(t[i], n[i]) : n[i]
                }
                return t
            }
            ,
            h.BuiltInFunction.sin.prototype._deriveRegressionRestrictions = t,
            h.BuiltInFunction.cos.prototype._deriveRegressionRestrictions = t,
            h.Exponent.prototype._deriveRegressionRestrictions = function(e) {
                for (var t = this.args[0], r = this.args[1], n = t.getDependencies(), i = r.getDependencies(), a = {}, o = !1, s = 0; s < i.length; s++)
                    if (e.listStatistics.hasOwnProperty(i[s])) {
                        o = !0;
                        break
                    }
                if (!o)
                    return {};
                if (1 !== n.length)
                    return {};
                var u = n[0];
                return e.listStatistics.hasOwnProperty(u) || 1 !== t.polynomialOrder(u) ? {} : (a[u] = h.Piecewise([h.Comparator[">="]([t, h.Constant(0)]), h.Constant(1), h.Constant(NaN)]).boundDomain(u),
                    a)
            }
            ,
            h.Piecewise.prototype._deriveRegressionRestrictions = function(e) {
                for (var t = {}, r = this.getDependencies(), n = 0; n < r.length; n++)
                    t[r[n]] = a.unknownDomain();
                return t
            }
    });
    _("core/math/features/reparameterizeRegression", ["require", "parsenodes", "core/math/types"], function(e) {
        "use strict";
        var b = e("parsenodes")
            , i = e("core/math/types");
        function x(e, t) {
            for (var r, n = e.getDependencies(), i = 0; i < n.length; i++)
                if (t.hasOwnProperty(n[i])) {
                    if (void 0 !== r)
                        return;
                    r = n[i]
                }
            return r
        }
        function S(e, t) {
            if (1 === e.polynomialOrder(t)) {
                var r = e.getPolynomialCoefficients(t)
                    , n = r[1]
                    , i = r[0]
                    , a = n.getDependencies();
                if (1 === a.length) {
                    var o = a[0];
                    if (1 === n.polynomialOrder(o)) {
                        var s = i.getDependencies().filter(function(e) {
                            return e !== o
                        });
                        if (1 === s.length) {
                            var u = s[0];
                            if (1 === i.polynomialOrder(u))
                                return [i, n]
                        }
                    }
                }
            }
        }
        function _() {
            for (var e = [], t = 0; t < arguments.length; t++) {
                var r = arguments[t];
                if (void 0 !== r)
                    for (var n = r.getDependencies(), i = 0; i < n.length; i++) {
                        var a = n[i];
                        -1 === e.indexOf(a) && e.push(a)
                    }
            }
            return e
        }
        function p(e, t, r) {
            for (var n = 0; n < e.length; n++)
                if (n !== r)
                    for (var i = e[n], a = 0; a < t.length; a++)
                        for (var o = t[a].model.replacedDependencies, s = 0; s < o.length; s++)
                            if (i.dependsOn(o[s]))
                                return 1
        }
        function f(e) {
            var t, r;
            for (a = 0; a < this.args.length; a++) {
                var n = this.args[a]._reparameterizeRegression(e);
                if (n) {
                    if (void 0 !== r)
                        return;
                    t = n,
                        r = a
                }
            }
            if (void 0 !== r && !p(this.args, t, r)) {
                for (var i = [], a = 0; a < t.length; a++) {
                    var o = t[a];
                    i.push({
                        model: o.model,
                        expression: this.copyWithArgs([].concat(this.args.slice(0, r), o.expression, this.args.slice(r + 1)))
                    })
                }
                return i
            }
        }
        function h(e, t) {
            var r = e.model;
            if ("exp" !== r.type)
                return e;
            if (r.shiftScale)
                return e;
            var n = e.expression
                , i = "Negative" === n.type;
            if (i && (n = n.args[0]),
            "BuiltInFunction['exp']" !== n.type)
                return e;
            var a = n.args[0]
                , o = x(a, t.listStatistics);
            if (void 0 === o)
                return e;
            var s = S(a, o);
            if (!s)
                return e;
            var u = s[0]
                , c = s[1]
                , l = [a.tmpVar(), a.tmpVar()]
                , p = t.listStatistics[o].max - t.listStatistics[o].min
                , f = .5 * (t.listStatistics[o].max + t.listStatistics[o].min)
                , h = b.BuiltInFunction.exp([b.Add([b.Multiply([b.FreeVariable(l[0]), b.Divide([b.Subtract([b.DummyIndex(o), b.Constant(f)]), b.Constant(p)])]), b.FreeVariable(l[1])])]);
            return i && (h = b.Negative([h])),
                {
                    model: {
                        type: "exp",
                        shiftScale: {
                            mulNode: c,
                            addNode: u,
                            newParameterSymbols: l,
                            stats: {
                                range: p,
                                midrange: f
                            }
                        },
                        base: r.base,
                        intercept: r.intercept,
                        replacedDependencies: _(c, u, r.base && r.base.node, r.intercept && r.intercept.node)
                    },
                    expression: h
                }
        }
        function d(e, t, r) {
            var n = e._symbol
                , i = e.args[0]
                , a = x(i, r.listStatistics);
            if (void 0 !== a) {
                var o = S(i, a);
                if (o) {
                    var s = o[0]
                        , u = o[1]
                        , c = t.getDependencies();
                    if (1 === c.length) {
                        var l = c[0];
                        if (!i.dependsOn(l) && 1 === t.polynomialOrder(l)) {
                            var p, f, h, d, m, g, y, v = [e.tmpVar(), e.tmpVar(), e.tmpVar()];
                            return [{
                                model: {
                                    type: "trig",
                                    amplitudeNode: t,
                                    frequencyNode: u,
                                    phaseNode: s,
                                    newParameterSymbols: v,
                                    replacedDependencies: _(t, u, s)
                                },
                                expression: (f = a,
                                    h = v,
                                    d = "cos" === (p = n) ? h[0] : h[1],
                                    m = "cos" === p ? h[1] : h[0],
                                    g = h[2],
                                    y = b.Multiply([b.FreeVariable(g), b.DummyIndex(f)]),
                                    ("sin" === p ? b.Add : b.Subtract)([b.Multiply([b.FreeVariable(d), b.BuiltInFunction.cos([y])]), b.Multiply([b.FreeVariable(m), b.BuiltInFunction.sin([y])])]))
                            }]
                        }
                    }
                }
            }
        }
        b.Base.prototype.reparameterizeRegression = function() {}
            ,
            b.Broadcast.prototype.reparameterizeRegression = function() {
                for (var e = this._replacedSymbols, t = this._lists, r = {}, n = 0; n < e.length; n++)
                    0 === t[n].getDependencies().length && t[n].valueType === i.ListOfNumber && (r[e[n]] = function(e) {
                        for (var t = 1 / 0, r = -1 / 0, n = e.length, i = 0; i < e.length; i++)
                            t = Math.min(t, e[i]),
                                r = Math.max(r, e[i]);
                        return {
                            min: t,
                            max: r,
                            length: n
                        }
                    }(t[n].asValue()));
                return this._reparameterizeRegression({
                    listStatistics: r
                })
            }
            ,
            b.Base.prototype._reparameterizeRegression = function(e) {}
            ,
            b.Expression.prototype._reparameterizeRegression = f,
            b.Exponent.prototype._reparameterizeRegression = function(e) {
                var t = this.args[0]
                    , r = this.args[1]
                    , n = r.getDependencies()
                    , i = t.getDependencies();
                if (function(e, t) {
                    for (var r = e.getDependencies(), n = 0; n < r.length; n++)
                        if (t[r[n]])
                            return 1
                }(r, e.listStatistics)) {
                    if (0 === i.length) {
                        if (t.asValue() < 0)
                            return;
                        return [{
                            model: {
                                type: "exp",
                                replacedDependencies: []
                            },
                            expression: b.BuiltInFunction.exp([b.Multiply([b.BuiltInFunction.ln([t]), r])])
                        }]
                    }
                    if (1 === i.length && !e.listStatistics.hasOwnProperty(i[0]) && -1 === n.indexOf(i[0]) && 1 === t.polynomialOrder(i[0])) {
                        var a = this.tmpVar();
                        return [h({
                            model: {
                                type: "exp",
                                base: {
                                    node: t,
                                    newParameterSymbols: [a]
                                },
                                replacedDependencies: t.getDependencies()
                            },
                            expression: b.BuiltInFunction.exp([b.Multiply([b.FreeVariable(a), r])])
                        }, e)]
                    }
                }
            }
            ,
            b.BuiltInFunction.exp.prototype._reparameterizeRegression = function(e) {
                if (void 0 !== x(this.args[0], e.listStatistics))
                    return [h({
                        model: {
                            type: "exp",
                            replacedDependencies: []
                        },
                        expression: this
                    }, e)]
            }
            ,
            b.Multiply.prototype._reparameterizeRegression = function(e) {
                var t, r, n;
                if ("BuiltInFunction['sin']" === this.args[0].type || "BuiltInFunction['cos']" === this.args[0].type)
                    return d(this.args[0], this.args[1], e);
                if ("BuiltInFunction['sin']" === this.args[1].type || "BuiltInFunction['cos']" === this.args[1].type)
                    return d(this.args[1], this.args[0], e);
                for (n = 0; n < this.args.length; n++) {
                    var i = this.args[n]._reparameterizeRegression(e);
                    if (i) {
                        if (void 0 !== r)
                            return;
                        t = i,
                            r = n
                    }
                }
                if (void 0 !== r && !p(this.args, t, r)) {
                    var a = 1 === r ? 0 : 1
                        , o = this.args[a];
                    if (1 !== t.length)
                        return f.call(this, e);
                    var s = t[0]
                        , u = s.model;
                    if ("exp" !== u.type || "BuiltInFunction['exp']" !== s.expression.type || s.model.shiftScale)
                        return f.call(this, e);
                    var c = o.getDependencies();
                    if (1 !== c.length || 1 !== o.polynomialOrder(c[0]) || e.listStatistics.hasOwnProperty(c[0]))
                        return f.call(this, e);
                    var l = this.tmpVar();
                    return [{
                        model: {
                            type: "exp",
                            replacedDependencies: []
                        },
                        expression: this
                    }, h({
                        model: {
                            type: "exp",
                            base: u.base,
                            intercept: {
                                node: o,
                                newParameterSymbols: [l],
                                sign: 1
                            },
                            replacedDependencies: _(u.base && u.base.node, o)
                        },
                        expression: b.BuiltInFunction.exp([b.Add([s.expression.args[0], b.FreeVariable(l)])])
                    }, e), h({
                        model: {
                            type: "exp",
                            base: u.base,
                            intercept: {
                                node: o,
                                newParameterSymbols: [l],
                                sign: -1
                            },
                            replacedDependencies: _(u.base && u.base.node, o)
                        },
                        expression: b.Negative([b.BuiltInFunction.exp([b.Add([s.expression.args[0], b.FreeVariable(l)])])])
                    }, e)]
                }
            }
    });
    _("parser", ["require", "core/math/baseparser", "core/math/features/getConcreteTree", "core/math/features/getValueType", "core/math/features/typeCheck", "core/math/features/repr", "core/math/features/scalarEvalExpression", "core/math/features/constantcollapsedcopy", "core/math/features/polynomialorder", "core/math/features/polynomialcoefficients", "core/math/features/extractconditions", "core/math/features/piecewiseDependsOn", "core/math/features/bounddomain", "core/math/features/derivative", "core/math/features/substitute", "core/math/features/isImplicit", "core/math/features/solve", "core/math/features/analyze", "core/math/features/analyzeFourFunction", "core/math/features/analyzeScientific", "core/math/features/analyzeSingleExpressionScientific", "core/math/features/getgraphmode", "core/math/features/getgraphinfo", "core/math/features/getMoveStrategy", "core/math/features/getDefaultDragMode", "core/math/features/tableinfo", "core/math/features/tableerror", "core/math/features/graph", "core/math/features/elementAt", "core/math/features/printLatex", "core/math/features/statistics", "core/math/features/getExpressionType", "core/math/features/findLinearSubset", "core/math/features/deriveRegressionRestrictions", "core/math/features/reparameterizeRegression"], function(e) {
        "use strict";
        var t = e("core/math/baseparser");
        return e("core/math/features/getConcreteTree"),
            e("core/math/features/getValueType"),
            e("core/math/features/typeCheck"),
            e("core/math/features/repr"),
            e("core/math/features/scalarEvalExpression"),
            e("core/math/features/constantcollapsedcopy"),
            e("core/math/features/polynomialorder"),
            e("core/math/features/polynomialcoefficients"),
            e("core/math/features/extractconditions"),
            e("core/math/features/piecewiseDependsOn"),
            e("core/math/features/bounddomain"),
            e("core/math/features/derivative"),
            e("core/math/features/substitute"),
            e("core/math/features/isImplicit"),
            e("core/math/features/solve"),
            e("core/math/features/analyze"),
            e("core/math/features/analyzeFourFunction"),
            e("core/math/features/analyzeScientific"),
            e("core/math/features/analyzeSingleExpressionScientific"),
            e("core/math/features/getgraphmode"),
            e("core/math/features/getgraphinfo"),
            e("core/math/features/getMoveStrategy"),
            e("core/math/features/getDefaultDragMode"),
            e("core/math/features/tableinfo"),
            e("core/math/features/tableerror"),
            e("core/math/features/graph"),
            e("core/math/features/elementAt"),
            e("core/math/features/printLatex"),
            e("core/math/features/statistics"),
            e("core/math/features/getExpressionType"),
            e("core/math/features/findLinearSubset"),
            e("core/math/features/deriveRegressionRestrictions"),
            e("core/math/features/reparameterizeRegression"),
            t
    });
    _("core/math/finddependencyorder", ["require", "core/math/builtinframe", "underscore"], function(e) {
        "use strict";
        var b = e("core/math/builtinframe")
            , x = e("underscore");
        return function(a, f, e) {
            var t, r, n, i = [], h = {}, o = {}, s = {}, d = {}, m = 0, g = [], y = [];
            if (!e)
                for (t in e = [],
                    f)
                    f.hasOwnProperty(t) && e.push(t);
            for (t in f)
                if (f.hasOwnProperty(t)) {
                    for (n = f[t].exportPenalty || 0; i.length < n + 1; )
                        i.push([]);
                    i[n].push(t)
                }
            for (n = 0; n < i.length; n++) {
                for (var u = {}, c = 0; c < i[n].length; c++) {
                    t = i[n][c];
                    for (var l = f[t].getLegalExports(a), p = 0; p < l.length; p++)
                        r = l[p],
                        b[r] || h[r] || (u[r] = u[r] || [],
                            u[r].push(t),
                        1 < u[r].length && (o[r] = !0))
                }
                for (r in u)
                    h[r] = u[r]
            }
            for (c = 0; c < e.length; c++)
                d.hasOwnProperty(e[c]) || !function e(t) {
                    d[t] = d[t] || {};
                    var r = d[t];
                    var n;
                    r.id = t;
                    r.index = m;
                    r.lowlink = m;
                    g.push(r);
                    r.instack = !0;
                    m++;
                    var i = f[t].getDependencies();
                    for (var a = 0; a < i.length; a++) {
                        var o = i[a];
                        if (h.hasOwnProperty(o))
                            for (var s = h[o], u = 0; u < s.length; u++) {
                                var c = s[u];
                                d.hasOwnProperty(c) ? (n = d[c]).instack && (r.lowlink = Math.min(r.lowlink, n.index)) : (e(c),
                                    n = d[c],
                                    r.lowlink = Math.min(r.lowlink, n.lowlink))
                            }
                    }
                    if (r.lowlink === r.index)
                        if ((n = g.pop()).instack = !1,
                        n === r)
                            p = r,
                                y.push(p.id);
                        else {
                            for (var l = [n]; (n = g.pop()).instack = !1,
                                l.push(n),
                            n !== r; )
                                ;
                            v(l)
                        }
                    var p
                }(e[c]);
            function v(e) {
                for (var t, r = [], n = e.length - 1; 0 <= n; n--) {
                    t = e[n];
                    var i = f[t.id].getLegalExports(a);
                    Array.prototype.push.apply(r, i),
                        r.push(i[0]),
                        y.push(t.id)
                }
                for ((r = x.unique(r)).sort(),
                         n = 0; n < r.length; n++)
                    s[r[n]] = r
            }
            return {
                resolved: y,
                multiplyDefined: o,
                cyclicallyDefined: s
            }
        }
    });
    _("core/math/findIntersections", ["require", "core/types/graphmode", "./plotter", "parsenodes", "core/math/distance"], function(e) {
        "use strict";
        var _ = e("core/types/graphmode")
            , E = e("./plotter").default
            , i = e("parsenodes")
            , c = e("core/math/distance");
        function M(e) {
            for (var t = [], r = 0; r < e; r++)
                t[r] = {
                    x: [],
                    y: [],
                    intersects: []
                };
            return t
        }
        function D(e, t) {
            t instanceof i.SolvedEquation ? t = t._expression : t instanceof i.OptimizedRegression && (t = t.model);
            var r = []
                , n = [];
            return t instanceof i.DoubleInequality ? i.List.eachArgs(e, t._expressions, function(e) {
                r.push(e[0].getCompiledFunction()),
                    n.push(e[0].isConstant && e[1].isNaN()),
                    r.push(e[1].getCompiledFunction()),
                    n.push(e[1].isConstant && e[1].isNaN())
            }) : i.List.wrap(t).eachElement(e, function(e) {
                r.push(e.getCompiledFunction()),
                    n.push(e.isConstant && e.isNaN())
            }),
                {
                    functions: r,
                    skipIntersecting: n
                }
        }
        function w(e, t, r) {
            for (var n = E.sampleXY(e, t), i = n.poi.zeros, a = n.poi.extrema, o = [], s = 0, u = 0, s = 0; s < i.x.length; s++) {
                for (; u < a.x.length && a.x[u] < i.x[s]; u++)
                    c.approx(a.y[u], 0) && o.push(a.x[u]);
                o.push(i.x[s])
            }
            for (; u < a.x.length; u++)
                c.approx(a.y[u], 0) && o.push(a.x[u]);
            return {
                x: o,
                y: o.map(r)
            }
        }
        return {
            findIntersections: function(e, t, r) {
                var n = e[r]
                    , i = n.getGraphInfo()
                    , a = n.getGraphMode()
                    , o = D(n.policy, n.concreteTree)
                    , s = M(o.functions.length)
                    , u = function(e, t) {
                    var r, n, i = [];
                    for (var a in e) {
                        e.hasOwnProperty(a) && String(a) !== String(t) && e[a].shouldIntersect() && (n = D((r = e[a]).policy, r.concreteTree),
                            i.push({
                                id: a,
                                graphMode: r.getGraphMode(),
                                functions: n.functions,
                                skipIntersecting: n.skipIntersecting
                            }))
                    }
                    return i
                }(e, r);
                if (!u)
                    return s;
                for (var c, l, p, f, h = 0, d = 0; d < u.length; d++)
                    for (var m = u[d], g = 0; g < o.functions.length; g++)
                        if (!o.skipIntersecting[g])
                            for (var y = o.functions[g].fn, v = E.computeDomain(t, i, y), b = 0; b < m.functions.length; b++)
                                if (!u[d].skipIntersecting[b]) {
                                    var x = function(t, r, e, n) {
                                        return e === _.X && n === _.X || e === _.Y && n === _.Y ? function(e) {
                                                return r(e) - t(e)
                                            }
                                            : (e === _.X && n === _.Y || e === _.Y && n === _.X) && function(e) {
                                            return e - r(t(e))
                                        }
                                    }(y, m.functions[b].fn, a, m.graphMode);
                                    if (x) {
                                        var S = w(x, v, y);
                                        if (100 < (h += S.x.length))
                                            return M(o.functions.length);
                                        !function(e, t) {
                                            e.intersects = Array(e.x.length);
                                            for (var r = 0; r < e.x.length; r++)
                                                e.intersects[r] = t
                                        }(S, m.id),
                                            p = S,
                                            f = void 0,
                                        a === _.X && (f = p.y,
                                            p.y = p.x,
                                            p.x = f),
                                            c = s[g],
                                            l = S,
                                            Array.prototype.push.apply(c.x, l.x),
                                            Array.prototype.push.apply(c.y, l.y),
                                            Array.prototype.push.apply(c.intersects, l.intersects)
                                    }
                                }
                return s
            },
            findIndicatorZeros: w
        }
    });
    _("core/math/policyFourFunction", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.PolicySingleExpressionFourFunction = t.PolicyFourFunction = void 0;
        var r = (n.prototype.assignmentForbidden = function(e) {
            return "ans" !== e.slice(0, 3)
        }
            ,
            n.prototype.isValidSlider = function(e) {
                return !1
            }
            ,
            n.prototype.sliderVariables = function() {
                return []
            }
            ,
            n.prototype.graphingEnabled = function() {
                return !1
            }
            ,
            n.prototype.ansEnabled = function() {
                return !this.singleExpression
            }
            ,
            n.prototype.disabledFeatures = function() {
                return ["Sum", "Product", "Integral", "List", "Derivative", "Piecewise", "Exponent", "PercentOf"]
            }
            ,
            n);
        function n(e) {
            this.singleExpression = e.singleExpression
        }
        t.PolicyFourFunction = new r({
            singleExpression: !1
        }),
            t.PolicySingleExpressionFourFunction = new r({
                singleExpression: !0
            })
    });
    _("core/math/policyScientific", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.PolicySingleExpressionScientific = t.PolicyScientific = void 0;
        var r = (n.prototype.assignmentForbidden = function(e) {
            return this.singleExpression ? "ans" !== e.slice(0, 3) : "tmp" === e.slice(0, 3)
        }
            ,
            n.prototype.isValidSlider = function(e) {
                return !1
            }
            ,
            n.prototype.sliderVariables = function() {
                return []
            }
            ,
            n.prototype.graphingEnabled = function() {
                return !1
            }
            ,
            n.prototype.ansEnabled = function() {
                return !this.singleExpression
            }
            ,
            n.prototype.disabledFeatures = function() {
                return this.singleExpression ? ["Sum", "Product", "Integral", "Derivative", "Piecewise", "PercentOf"] : ["Sum", "Product", "Integral", "Derivative", "Piecewise"]
            }
            ,
            n);
        function n(e) {
            this.singleExpression = e.singleExpression
        }
        t.PolicyScientific = new r({
            singleExpression: !1
        }),
            t.PolicySingleExpressionScientific = new r({
                singleExpression: !0
            })
    });
    _("core/math/policyGraphing", ["require", "exports", "./builtinframe", "core/types/graphmode"], function(e, t, r, n) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.PolicyGraphing3D = t.PolicyGraphing = void 0;
        var i = (a.prototype.dimensions = function() {
            return 2
        }
            ,
            a.prototype.assignmentForbidden = function(e) {
                return "x" === e || "y" === e || "theta" === e || "tmp" === e.slice(0, 3) || r.hasOwnProperty(e)
            }
            ,
            a.prototype.isValidSlider = function(e) {
                return "x" === e || "y" === e || "ans" !== e.slice(0, 3) && !this.assignmentForbidden(e)
            }
            ,
            a.prototype.sliderVariables = function(e) {
                var t = this;
                return -1 !== e.indexOf("theta") && (e = e.filter(function(e) {
                    return "r" !== e
                })),
                    e.filter(function(e) {
                        return !t.assignmentForbidden(e) && "ans" !== e.slice(0, 3)
                    })
            }
            ,
            a.prototype.graphingEnabled = function() {
                return !0
            }
            ,
            a.prototype.ansEnabled = function() {
                return !1
            }
            ,
            a.prototype.validRegressionParameter = function(e) {
                return "x" !== e && "y" !== e
            }
            ,
            a.prototype.validLHS = function(e) {
                return "theta" !== e
            }
            ,
            a.prototype.unplottablePolarFunction = function(e, t) {
                return "theta" === e && -1 !== t.indexOf("r")
            }
            ,
            a.prototype.validDoubleInequalitySymbol = function(e) {
                return "x" === e || "y" === e
            }
            ,
            a.prototype.validDoubleInequalityVariables = function(e) {
                return !(2 < e.length) && e.every(this.validDoubleInequalitySymbol)
            }
            ,
            a.prototype.validExpressionVariables = function(e) {
                return 1 === e.length && "x" === e[0]
            }
            ,
            a.prototype.validSolvedVariable = function(e) {
                return "x" === e || "y" === e || "r" === e
            }
            ,
            a.prototype.validImplicitVariables = function(e) {
                switch (e.length) {
                    case 0:
                        return !0;
                    case 1:
                        return "x" === e[0] || "y" === e[0] || "r" === e[0];
                    case 2:
                        return "x" === e[0] && "y" === e[1] || "y" === e[0] && "x" === e[1] || "r" === e[0] && "theta" === e[1] || "theta" === e[0] && "r" === e[1];
                    default:
                        return !1
                }
            }
            ,
            a.prototype.graphableListVariables = function(e, t) {
                return "x" === e || "y" === e || "r" === e || "x" === t || "y" === t
            }
            ,
            a.prototype.validParametricVariable = function(e) {
                return "t" === e
            }
            ,
            a.prototype.validParametricVariables = function(e) {
                return 1 === e.length && this.validParametricVariable(e[0])
            }
            ,
            a.prototype.validInequalityVariables = function(e) {
                switch (e.length) {
                    case 1:
                        return "x" === e[0] || "y" === e[0] || "r" === e[0];
                    case 2:
                        return this.validImplicitVariables(e);
                    default:
                        return !1
                }
            }
            ,
            a.prototype.validFirstColumnVariable = function(e) {
                return "y" !== e && "r" !== e && "theta" !== e && !e.match(/y_(\d+)/)
            }
            ,
            a.prototype.complicatedPolarImplicit = function(e, t) {
                return "theta" === e || "r" === e && 1 !== t
            }
            ,
            a.prototype.constantGraphMode = function(e) {
                return "x" === e ? n.X : "r" === e ? n.POLAR : n.Y
            }
            ,
            a.prototype.graphMode = function(e, t) {
                var r = t[0];
                return "y" === r || "x" === e ? n.X : "r" === e && "theta" === r ? n.POLAR : n.Y
            }
            ,
            a.prototype.tableableAsConstant = function(e) {
                return "x" !== e && "r" !== e && "theta" !== e
            }
            ,
            a.prototype.implicitIndependent = function(e) {
                return "x"
            }
            ,
            a.prototype.implicitDependency = function(e) {
                return 1 !== e.length ? "y" : "y" === e[0] ? "x" : "theta" === e[0] ? "r" : "y"
            }
            ,
            a.prototype.graphableAsConstant = function(e) {
                return "y" === e || "x" === e || "r" === e
            }
            ,
            a.prototype.disabledFeatures = function() {
                return []
            }
            ,
            a);
        function a() {}
        var o = (s.prototype.dimensions = function() {
            return 3
        }
            ,
            s.prototype.assignmentForbidden = function(e) {
                return "x" === e || "y" === e || "z" === e || "tmp" === e.slice(0, 3) || r.hasOwnProperty(e)
            }
            ,
            s.prototype.isValidSlider = function(e) {
                return "x" === e || "y" === e || "z" === e || "ans" !== e.slice(0, 3) && !this.assignmentForbidden(e)
            }
            ,
            s.prototype.sliderVariables = function(e) {
                var t = this;
                return e.filter(function(e) {
                    return !t.assignmentForbidden(e) && "ans" !== e.slice(0, 3)
                })
            }
            ,
            s.prototype.graphingEnabled = function() {
                return !0
            }
            ,
            s.prototype.ansEnabled = function() {
                return !1
            }
            ,
            s.prototype.validRegressionParameter = function(e) {
                return !1
            }
            ,
            s.prototype.validLHS = function(e) {
                return !0
            }
            ,
            s.prototype.unplottablePolarFunction = function(e, t) {
                return !1
            }
            ,
            s.prototype.validDoubleInequalitySymbol = function(e) {
                return !1
            }
            ,
            s.prototype.validDoubleInequalityVariables = function(e) {
                return !1
            }
            ,
            s.prototype.validExpressionVariables = function(e) {
                var t = e.join("");
                return "x" === t || "y" === t || "xy" === t || "yx" === t
            }
            ,
            s.prototype.validSolvedVariable = function(e) {
                return "x" === e || "y" === e || "z" === e
            }
            ,
            s.prototype.validImplicitVariables = function(e) {
                return !1
            }
            ,
            s.prototype.graphableListVariables = function(e, t) {
                return "x" === e || "y" === e || "x" === t || "y" === t
            }
            ,
            s.prototype.validParametricVariable = function(e) {
                return "t" === e
            }
            ,
            s.prototype.validParametricVariables = function(e) {
                return 1 === e.length && this.validParametricVariable(e[0])
            }
            ,
            s.prototype.validInequalityVariables = function(e) {
                return !1
            }
            ,
            s.prototype.validFirstColumnVariable = function(e) {
                return !1
            }
            ,
            s.prototype.complicatedPolarImplicit = function(e, t) {
                return !1
            }
            ,
            s.prototype.constantGraphMode = function(e) {
                return n.Z_3D
            }
            ,
            s.prototype.graphMode = function(e, t) {
                return "z" === e && this.validExpressionVariables(t) ? n.Z_3D : n.NONE
            }
            ,
            s.prototype.tableableAsConstant = function(e) {
                return "x" !== e && "r" !== e
            }
            ,
            s.prototype.implicitIndependent = function(e) {
                return "x"
            }
            ,
            s.prototype.implicitDependency = function(e) {
                if (2 !== e.length)
                    return "z";
                var t = e[0] < e[1] ? e[0] + e[1] : e[1] + e[0];
                return "xy" === t ? "z" : "xz" === t ? "y" : "yz" === t ? "x" : "z"
            }
            ,
            s.prototype.graphableAsConstant = function(e) {
                return "z" === e
            }
            ,
            s.prototype.disabledFeatures = function() {
                return []
            }
            ,
            s);
        function s() {}
        t.PolicyGraphing = new i,
            t.PolicyGraphing3D = new o
    });
    _("core/math/frameFourFunction", ["require", "core/math/parsenode/builtinfunction"], function(e) {
        "use strict";
        var r = e("core/math/parsenode/builtinfunction");
        return {
            getFrame: function(e) {
                var t = {};
                return e.additionalFunctions && -1 !== e.additionalFunctions.indexOf("sqrt") && (t.sqrt = r.sqrt),
                    t
            }
        }
    });
    _("core/math/frameScientific", ["require", "core/math/builtinconstants", "core/math/parsenode/builtinfunction"], function(e) {
        "use strict";
        var n = e("core/math/builtinconstants")
            , i = e("core/math/parsenode/builtinfunction")
            , a = ["pi", "e", "trigAngleMultiplier"]
            , o = ["sqrt", "nthroot", "abs", "ln", "sin", "cos", "tan", "log", "arcsin", "arccos", "arctan", "mean", "round", "stdev", "stdevp", "nCr", "nPr", "exp", "factorial"];
        function t(e, t) {
            for (var r = 0; r < e.length; r++) {
                var n = e[r];
                if (!t.hasOwnProperty(n))
                    throw new Error("Programming Error: key '" + n + "' does not exist in table. Must be one of:\n" + Object.keys(t).join("\n"))
            }
        }
        return t(a, n),
            t(o, i),
            {
                getFrame: function(t) {
                    var r = {};
                    return a.forEach(function(e) {
                        r[e] = n[e]
                    }),
                        o.forEach(function(e) {
                            t.replaceRoundWithReciprocal && "round" === e || (r[e] = i[e])
                        }),
                    t.trigAngleMultiplier && (r.trigAngleMultiplier = t.trigAngleMultiplier),
                        r
                }
            }
    });
    _("core/math/frameSingleExpressionScientific", ["require", "core/math/builtinconstants", "core/math/parsenode/builtinfunction"], function(e) {
        "use strict";
        var r = e("core/math/builtinconstants")
            , n = e("core/math/parsenode/builtinfunction")
            , i = ["pi", "e", "trigAngleMultiplier"]
            , a = ["sqrt", "nthroot", "abs", "ln", "sin", "cos", "tan", "log", "arcsin", "arccos", "arctan", "exp", "factorial"];
        function t(e, t) {
            for (var r = 0; r < e.length; r++) {
                var n = e[r];
                if (!t.hasOwnProperty(n))
                    throw new Error("Programming Error: key '" + n + "' does not exist in table. Must be one of:\n" + Object.keys(t).join("\n"))
            }
        }
        return t(i, r),
            t(a, n),
            {
                getFrame: function(e) {
                    var t = {};
                    return i.forEach(function(e) {
                        t[e] = r[e]
                    }),
                        a.forEach(function(e) {
                            t[e] = n[e]
                        }),
                    e.trigAngleMultiplier && (t.trigAngleMultiplier = e.trigAngleMultiplier),
                        t
                }
            }
    });
    _("core/math/frameGraphing", ["require", "core/math/builtinconstants", "core/math/parsenode/builtinfunction"], function(e) {
        "use strict";
        var n = e("core/math/builtinconstants")
            , i = e("core/math/parsenode/builtinfunction")
            , a = ["csc", "sec", "cot", "arccsc", "arcsec", "arccot", "csch", "sech", "coth", "arccsch", "arcsech", "arccoth", "mad", "cov", "distance", "midpoint"]
            , o = ["erf", "ttest", "tscore", "ittest", "normaldist", "tdist", "poissondist", "binomialdist", "pdf", "cdf", "random", "histogram", "dotplot", "boxplot"]
            , s = ["distance", "midpoint"]
            , u = ["det", "inv", "transpose", "rref", "trace"];
        function t(e, t) {
            for (var r = 0; r < e.length; r++) {
                var n = e[r];
                if (!t.hasOwnProperty(n))
                    throw new Error("Programming Error: key '" + n + "' does not exist in table. Must be one of:\n" + Object.keys(t).join("\n"))
            }
        }
        return t(a, i),
            t(o, i),
            {
                getFrame: function(e) {
                    var t, r = {};
                    for (t in n)
                        n.hasOwnProperty(t) && (r[t] = n[t]);
                    for (t in i)
                        i.hasOwnProperty(t) && (!0 !== e.restrictedFunctions || -1 === a.indexOf(t) || !0 === e.forceEnableGeometryFunctions && -1 !== s.indexOf(t)) && (!1 === e.distributions && -1 !== o.indexOf(t) || -1 === u.indexOf(t) && (r[t] = i[t]));
                    return e.trigAngleMultiplier && (r.trigAngleMultiplier = e.trigAngleMultiplier),
                    e.globalRandomSeed && (r.globalRandomSeed = e.globalRandomSeed),
                    e.initialEvaluation && (r.initialEvaluation = e.initialEvaluation),
                        r
                }
            }
    });
    _("core/math/interpolatedlabel", ["require", "exports", "parsenodes", "core/lib/label", "./policy", "core/math/types"], function(e, t, l, r, p, f) {
        "use strict";
        function h(e) {
            if (e.length < 2)
                return "text";
            var t = e.split("`").length - 1;
            return t < 2 ? "text" : 2 == t && "`" === e[0] && "`" === e[e.length - 1] ? "latex" : "mixed"
        }
        function n(e) {
            if (0 === e.length)
                return [""];
            for (var t = [], r = e.split(/(`)/), n = !1, i = "", a = 0; a < r.length; a++) {
                var o = r[a];
                o.length && ("`" === o ? (i += "`",
                (n = !n) || (t.push(i),
                    i = "")) : (i += o,
                n || (t.push(i),
                    i = "")))
            }
            return i.length && t.push(i),
                t
        }
        function i(e) {
            for (var t, r, n = "\\$({" + ["[a-zA-Z][0-9]*", "[a-zA-Z]_[a-zA-Z0-9]+", "[a-zA-Z]_\\{[a-zA-Z0-9]+\\}"].join("})|\\$({") + "})", i = new RegExp(n,"g"), a = [], o = 0; r = i.exec(e); ) {
                o < (t = r.index) && a.push(e.substr(o, t - o));
                var s = r[0]
                    , u = s.replace(/[{}\$]/g, "").replace(/^([a-zA-Z])([0-9]+)$/, "$1_$2");
                a.push({
                    symbol: u,
                    str: s
                }),
                    o = r.index + s.length
            }
            return o < e.length && a.push(e.substr(o)),
                {
                    raw: e,
                    parts: a
                }
        }
        function d(e, t) {
            return t ? "{" + r.truncatedLatexLabel(e, {
                bigCutoff: 1e7,
                digits: 8
            }) + "}" : r.truncatedPlainmathLabel(e, {
                bigCutoff: 1e7,
                digits: 8
            })
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.interpolate = t.parse = t.chunkLabel = t.classifyLabelText = void 0,
            t.classifyLabelText = h,
            t.chunkLabel = n,
            t.parse = function(e) {
                return n(e).map(i)
            }
            ,
            t.interpolate = function(e, t, r) {
                return e.map(function(e) {
                    return function(e, t, r) {
                        for (var n = [], i = "latex" === h(e.raw), a = 0, o = e.parts; a < o.length; a++) {
                            var s = o[a];
                            if ("string" == typeof s)
                                n.push(s);
                            else {
                                var u, c = l.Identifier(s.symbol).tryGetConcreteTree(p.defaultPolicy, t);
                                if (c.valueType === f.Number) {
                                    if ("number" == typeof (u = c.asValue())) {
                                        n.push(d(u, i));
                                        continue
                                    }
                                } else if (c.valueType === f.ListOfNumber && c.args[r]) {
                                    if ("number" == typeof (u = c.args[r].asValue())) {
                                        n.push(d(u, i));
                                        continue
                                    }
                                }
                                i ? n.push("{?}") : n.push("?")
                            }
                        }
                        return n.join("")
                    }(e, t, r)
                }).join("")
            }
    });
    _("core/math/getCLSymbolMap", ["require", "exports", "underscore", "core/lib/label"], function(e, t, g, y) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.getCLSymbolMap = void 0,
            t.getCLSymbolMap = function() {
                var e = {}
                    , t = {}
                    , r = {}
                    , n = [];
                for (var i in this.statements) {
                    if (this.statements.hasOwnProperty(i))
                        switch ((p = this.statements[i]).type) {
                            case "Error":
                                break;
                            case "Regression":
                                r[i] = [],
                                    n.push(i);
                                break;
                            default:
                                var a = p.getLegalExports(this.policy);
                                if (a) {
                                    for (var o = 0, s = a; o < s.length; o++) {
                                        var u = s[o];
                                        0 < p.exportPenalty ? t[u] = i : e[u] = i
                                    }
                                    r[i] = g.difference(p.getDependencies(), p.getDummyDependencies(), a)
                                }
                        }
                }
                for (var c = 0, l = n; c < l.length; c++) {
                    var i = l[c]
                        , p = this.statements[i]
                        , f = y.latexToIdentifier(p.userData.residualVariable);
                    f && (t[f] = i);
                    for (var h, d = p.getDependencies().slice(), m = {}, u = void 0; u = d.pop(); ) {
                        m[u] || (m[u] = !0,
                            (h = e[u] || t[u]) ? (d.push.apply(d, r[h]),
                                r[i].push(u)) : t[u] = i)
                    }
                }
                return {
                    exportMap: e,
                    weakExportMap: t,
                    dependencyMap: r
                }
            }
    });
    _("core/types/line-width", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.THICK = t.DEFAULT = t.THIN = void 0,
            t.THIN = 1,
            t.DEFAULT = 2.5,
            t.THICK = 5
    });
    _("core/types/point-opacity", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.DEFAULT = void 0,
            t.DEFAULT = .9
    });
    _("core/math/context", ["require", "exports", "parser", "parsenodes", "./finddependencyorder", "./errormsg", "./workerconfig", "./findIntersections", "core/vendor/d3-color", "./policyFourFunction", "./policyScientific", "./policyGraphing", "./frameFourFunction", "./frameScientific", "./frameSingleExpressionScientific", "./frameGraphing", "tslib", "underscore", "./plotter", "core/types/graphmode", "./interpolatedlabel", "./expression-types", "./getCLSymbolMap", "./distribution-spec", "./maybe-rational", "core/lib/number-to-latex", "core/lib/label", "./functions", "core/types/line-width", "./evaluationstate", "core/types/point-opacity", "core/math/types"], function(e, t, z, r, M, k, n, i, a, o, s, u, c, l, p, f, U, h, d, D, G, w, m, W, g, j, Y, y, v, P, b, X) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.Context = void 0;
        var H = r.Constant
            , x = r.Seed
            , O = r.FunctionCall
            , Z = r.Image
            , K = r.Simulation
            , $ = r.Slider
            , Q = r.Table
            , J = r.TableColumn
            , T = r.FreeVariable
            , S = i.findIntersections
            , _ = {
            fourFunction: o.PolicyFourFunction,
            scientific: s.PolicyScientific,
            singleExpressionScientific: s.PolicySingleExpressionScientific,
            singleExpressionFourFunction: o.PolicySingleExpressionFourFunction,
            graphing: u.PolicyGraphing,
            graphing_3d: u.PolicyGraphing3D
        }
            , E = {
            fourFunction: c,
            singleExpressionFourFunction: c,
            scientific: l,
            singleExpressionScientific: p,
            graphing: f,
            graphing_3d: f
        };
        function ee(e, t) {
            for (var r = "id" + e, n = 0, i = t || []; n < i.length; n++) {
                var a = i[n];
                r += "::" + a[0] + a[1]
            }
            return r
        }
        var L = H(g.maybeRational(0, 1))
            , I = H(g.maybeRational(1, 1))
            , C = H(NaN);
        function te(e, t) {
            return e ? "0" === e ? L : "1" === e ? I : z.parse(e, t) : C
        }
        function re(e, t) {
            if (e)
                return z.parse(e, t)
        }
        function N(e) {
            return "ans" !== e.slice(0, 3)
        }
        function A(e, t) {
            var r = e.multiplyDefined
                , n = e.cyclicallyDefined;
            for (var i in r)
                r.hasOwnProperty(i) && (t[i] = k.multiplyDefined(i));
            for (var i in n)
                n.hasOwnProperty(i) && (t[i] = k.cycle(n[i].filter(N)))
        }
        function F(e, t, r) {
            for (var n = 0, i = r; n < i.length; n++) {
                var a = i[n];
                e[a] || (e[a] = []),
                    e[a].push(t)
            }
        }
        function q(e, t, r) {
            if (r.extraDepNodes)
                for (var n = 0, i = r.extraDepNodes; n < i.length; n++) {
                    var a = i[n];
                    a && F(e, t, a.getDependencies())
                }
            if (r.clickableRules)
                for (var o = 0, s = r.clickableRules; o < s.length; o++) {
                    var u = s[o];
                    u.assignment && F(e, t, u.assignment.getDependencies()),
                    u.expression && F(e, t, u.expression.getDependencies())
                }
        }
        var ne = {
            lineWidth: {
                parseNode: "lineWidth",
                valueOutputProp: "computedLineWidth",
                validOutputProp: "line_width_valid",
                default: function() {
                    return v.DEFAULT
                },
                shouldEvaluate: void 0,
                seed: "lw"
            },
            lineOpacity: {
                parseNode: "lineOpacity",
                valueOutputProp: "computedLineOpacity",
                validOutputProp: "line_opacity_valid",
                default: void 0,
                shouldEvaluate: void 0,
                seed: "lo"
            },
            pointOpacity: {
                parseNode: "pointOpacity",
                valueOutputProp: "computedPointOpacity",
                validOutputProp: "point_opacity_valid",
                default: function(e, t) {
                    var r = e.rawTree
                        , n = e.concreteTree;
                    return r.getGraphMode(t, n) === D.XYPOINT_MOVABLE ? 1 : b.DEFAULT
                },
                shouldEvaluate: void 0,
                seed: "po"
            },
            fillOpacity: {
                parseNode: "fillOpacity",
                valueOutputProp: "computedFillOpacity",
                validOutputProp: "fill_opacity_valid",
                default: void 0,
                shouldEvaluate: function(e) {
                    return e === w.ExpressionType.POLYGON || e === w.ExpressionType.PARAMETRIC
                },
                seed: "fo"
            }
        };
        function R(e, t, r, n) {
            var i = ne[n]
                , a = e.evaluationState
                , o = e.rawTree.metaData
                , s = i.default && i.default(e, t)
                , u = function(e, t, r, n) {
                var i = {}
                    , a = !0
                    , o = NaN;
                if (r)
                    for (var s = r.tryGetConcreteTree(e, t), o = +s.asValue(), u = 0, c = s.getDependencies(); u < c.length; u++) {
                        i[c[u]] = !0
                    }
                return isFinite(o) || (a = !1,
                    o = NaN),
                r || (a = !0,
                void 0 !== n && (o = n)),
                    {
                        value: o,
                        valid: a,
                        missingVarsMap: i
                    }
            }(t, r, o[i.parseNode], s);
            o[i.valueOutputProp] = u.value,
                a[i.validOutputProp] = u.valid,
                P.addSliderPrompts(a, t, u.missingVarsMap)
        }
        function B(e) {
            return a.rgb(e[0], e[1], e[2]).formatHex()
        }
        function V(e, t, r, n, i) {
            var a;
            if (e) {
                for (var o, s = e.tryGetConcreteTree(n, i), u = s.asValue(), c = {}, l = 0, p = s.getDependencies(); l < p.length; l++) {
                    c[p[l]] = !0
                }
                P.addSliderPrompts(r, n, c),
                (a = !(!u || s.valueType !== X.RGBColor)) && (o = s && s.valueType === X.RGBColor ? B(u) : u.map(B),
                    t.colorLatexValue = o,
                    r.color_latex_value = o)
            } else
                a = !0;
            r.color_latex_valid = a
        }
        var ie = (ae.prototype.invalidate = function() {
            for (var e in this.statements)
                this.statements.hasOwnProperty(e) && this.markAsDirtyRoot(e);
            this.currentStatus = {},
                this.analysis = {},
                this.parent_frame = E[this.evaluationMode].getFrame({
                    restrictedFunctions: this.restrictedFunctions,
                    forceEnableGeometryFunctions: this.forceEnableGeometryFunctions,
                    replaceRoundWithReciprocal: this.replaceRoundWithReciprocal,
                    distributions: this.distributions,
                    additionalFunctions: this.additionalFunctions,
                    trigAngleMultiplier: H(this.use_degrees ? Math.PI / 180 : g.maybeRational(1, 1)),
                    initialEvaluation: H(this.initialEvaluation ? 1 : 0),
                    globalRandomSeed: x(this.globalRandomSeedString || "")
                }),
                this.frame = Object.create(this.parent_frame),
                this.lastFrame = Object.create(this.parent_frame),
                this.regressionFrame = Object.create(this.parent_frame)
        }
            ,
            ae.prototype.processChangeSet = function(e) {
                var t = {
                    intersections: {},
                    graphs: {}
                };
                e.isCompleteState && (this.invalidate(),
                    this.statements = {},
                    this.currentLabel = {});
                var r = !!e.isCompleteState && !e.isUndoRedoState;
                r !== this.initialEvaluation && (this.initialEvaluation = r,
                    this.invalidate()),
                e.viewState && this.setViewState(e.viewState),
                e.hasOwnProperty("degreeMode") && this.setDegreeMode(e.degreeMode),
                e.hasOwnProperty("globalRandomSeed") && this.setGlobalRandomSeed(e.globalRandomSeed),
                e.hasOwnProperty("evaluationMode") && this.setEvaluationMode(e.evaluationMode),
                e.hasOwnProperty("additionalFunctions") && this.setAdditionalFunctions(e.additionalFunctions),
                e.hasOwnProperty("restrictedFunctions") && this.setRestrictedFunctions(e.restrictedFunctions),
                e.hasOwnProperty("forceEnableGeometryFunctions") && this.setForceEnableGeometryFunctions(e.forceEnableGeometryFunctions),
                e.hasOwnProperty("distributions") && this.setDistributions(e.distributions),
                e.hasOwnProperty("functionDefinition") && this.setFunctionDefinition(e.functionDefinition),
                e.hasOwnProperty("replaceRoundWithReciprocal") && this.setReplaceRoundWithReciprocal(e.replaceRoundWithReciprocal),
                e.hasOwnProperty("pointsOfInterest") && this.setWorkerConfigProperty("pointsOfInterest", e.pointsOfInterest),
                e.hasOwnProperty("plotSingleVariableImplicitEquations") && this.setWorkerConfigProperty("plotSingleVariableImplicitEquations", e.plotSingleVariableImplicitEquations),
                e.hasOwnProperty("plotImplicits") && this.setWorkerConfigProperty("plotImplicits", e.plotImplicits),
                e.hasOwnProperty("plotInequalities") && this.setWorkerConfigProperty("plotInequalities", e.plotInequalities),
                e.hasOwnProperty("sliders") && this.setWorkerConfigProperty("sliders", e.sliders),
                e.hasOwnProperty("intersectId") && (this.intersectId = e.intersectId),
                    this.processStatements(e, t),
                    this.updateAnalysis(),
                e.hasOwnProperty("intersectId") && this._updateIntersections(e.intersectId, t);
                var n = this._publishAllStatuses();
                return this._computeAllLabels(),
                    this._graphAllChanged(t),
                    this.unpublishedIds = {},
                    {
                        syncId: e.syncId,
                        isCompleteState: e.isCompleteState,
                        intersectionChanges: t.intersections,
                        statusChanges: n,
                        graphChanges: t.graphs
                    }
            }
            ,
            ae.prototype.processStatements = function(e, t) {
                if (e.statements)
                    for (var r in e.statements) {
                        var n = e.statements[r];
                        if (null === n) {
                            var i = void 0;
                            if (!e.isCompleteState && this.statements.hasOwnProperty(r) && (i = this.statements[r].getAllIds()),
                                this.removeStatement(r, t),
                            !e.isCompleteState && i)
                                for (var a = 0, o = i; a < o.length; a++) {
                                    var s = o[a];
                                    t.graphs[s] = void 0
                                }
                        } else
                            this.addStatement(n, t)
                    }
            }
            ,
            ae.prototype.setViewState = function(e) {
                if (!h.isEqual(e, this.viewState))
                    for (var t in this.viewState = e,
                        this.statements)
                        this.statements.hasOwnProperty(t) && (this.unpublishedIds[t] = !0)
            }
            ,
            ae.prototype.getViewState = function() {
                if (this.viewState) {
                    var e = Object.create(this.viewState);
                    return this.parent_frame && this.parent_frame.trigAngleMultiplier ? e.trigAngleMultiplier = this.parent_frame.trigAngleMultiplier.asValue() : e.trigAngleMultiplier = 1,
                        e
                }
            }
            ,
            ae.prototype.setDegreeMode = function(e) {
                this.use_degrees = e,
                    this.invalidate()
            }
            ,
            ae.prototype.setGlobalRandomSeed = function(e) {
                this.globalRandomSeedString = e,
                    this.parent_frame.globalRandomSeed = x(e),
                    this.dirtyExportedSymbolRoots.globalRandomSeed = !0
            }
            ,
            ae.prototype.setEvaluationMode = function(e) {
                this.evaluationMode = e,
                    this.policy = _[e],
                    this.invalidate()
            }
            ,
            ae.prototype.setAdditionalFunctions = function(e) {
                this.additionalFunctions = e,
                    this.invalidate()
            }
            ,
            ae.prototype.setRestrictedFunctions = function(e) {
                this.restrictedFunctions = e,
                    this.invalidate()
            }
            ,
            ae.prototype.setForceEnableGeometryFunctions = function(e) {
                this.forceEnableGeometryFunctions = e,
                    this.invalidate()
            }
            ,
            ae.prototype.setDistributions = function(e) {
                this.distributions = e,
                    this.invalidate()
            }
            ,
            ae.prototype.setFunctionDefinition = function(e) {
                this.functionDefinition = e,
                    this.invalidate()
            }
            ,
            ae.prototype.setReplaceRoundWithReciprocal = function(e) {
                this.replaceRoundWithReciprocal = e,
                    this.invalidate()
            }
            ,
            ae.prototype.setWorkerConfigProperty = function(e, t) {
                t !== n[e] && (n[e] = t,
                    this.invalidate())
            }
            ,
            ae.prototype._publishAllStatuses = function() {
                var e, t = {}, r = this.currentStatus;
                for (var n in this.currentStatus = {},
                    this.unpublishedIds)
                    this.analysis.hasOwnProperty(n) && (e = this.analysis[n].evaluationState,
                    JSON.stringify(e) !== JSON.stringify(r[n]) && (t[n] = e),
                        this.currentStatus[n] = e);
                return t
            }
            ,
            ae.prototype._computeAllLabels = function() {
                for (var e in this.currentLabel) {
                    var t = this.statements[e];
                    if (t) {
                        var r = t.tryGetConcreteTree(this.policy, this.frame)
                            , n = 1;
                        r.valueType === X.ListOfPoint && (n = r.args.length);
                        for (var i = [], a = 0; a < n; a++)
                            i.push(G.interpolate(this.currentLabel[e], this.frame, a));
                        h.isEqual(i, t.computedLabels) || (t.computedLabels = i,
                            this.unpublishedIds[e] = !0)
                    }
                }
            }
            ,
            ae.prototype._graphAllChanged = function(e) {
                var t = this.getViewState()
                    , r = !1;
                if (d.default.validateViewState(t)) {
                    for (var n in this.unpublishedIds)
                        if (this.analysis.hasOwnProperty(n)) {
                            var i = this.analysis[n]
                                , a = i.evaluationState.expression_type
                                , o = a === w.ExpressionType.SINGLE_POINT || a === w.ExpressionType.POINT_LIST;
                            if (i.rawTree.isTable)
                                for (var s = i.graph(t), u = 0, c = i.rawTree.getAllIds(); u < c.length; u++) {
                                    var l = c[u];
                                    s[l] ? this._notifyGraphComputed(l, s[l], e) : this._notifyGraphRemoved(l, e)
                                }
                            else
                                i.evaluationState.is_graphable && (i.rawTree.userData.shouldGraph || i.rawTree.userData.showLabel && o) ? (this._notifyGraphComputed(n, i.graph(t), e),
                                this.intersectId === n && (r = !0)) : this._notifyGraphRemoved(n, e)
                        }
                    h.keys(this.unpublishedIds).length && void 0 !== this.intersectId && (this.unpublishedIds.hasOwnProperty(this.intersectId) || (r = !0)),
                    r && this._updateIntersections(this.intersectId, e)
                }
            }
            ,
            ae.prototype._notifyGraphRemoved = function(e, t) {
                t.graphs[e] = void 0
            }
            ,
            ae.prototype._notifyGraphComputed = function(e, t, r) {
                y.dehydrateGraphData(t),
                    r.graphs[e] = t
            }
            ,
            ae.prototype._updateIntersections = function(e, t) {
                var r;
                this.viewState && (this.analysis[e] && this.analysis[e].shouldIntersect() ? (r = S(this.analysis, this.viewState, e),
                    t.intersections[e] = r) : t.intersections[e] = [])
            }
            ,
            ae.prototype.getDisabledFeatures = function() {
                var e = this.policy.disabledFeatures()
                    , t = !1 === this.functionDefinition ? e.concat("FunctionDefinition") : e
                    , r = this.additionalFunctions || [];
                return t = t.filter(function(e) {
                    return !("Exponent" === e && -1 !== r.indexOf("exponent") || "PercentOf" === e && -1 !== r.indexOf("percent"))
                })
            }
            ,
            ae.prototype.areFractionsDisallowed = function() {
                var e = this.evaluationMode;
                return !("fourFunction" !== e && "singleExpressionFourFunction" !== e || this.additionalFunctions && -1 !== this.additionalFunctions.indexOf("fraction"))
            }
            ,
            ae.prototype.addStatement = function(e, t) {
                var r = this;
                if (e) {
                    var n = e.id;
                    this.markExportsDirty(n),
                        this.markAsDirtyRoot(n);
                    var i, a, o, s, u, c, l, p, f = {
                        index: this.policy.ansEnabled() ? e.index : void 0,
                        disabledFeatures: this.getDisabledFeatures(),
                        disallowFrac: this.areFractionsDisallowed(),
                        seedPrefix: ee(n)
                    }, h = {
                        extraDepNodes: []
                    };
                    switch (e.type) {
                        case "table":
                            var d = [];
                            this.statements.hasOwnProperty(n) && (d = this.statements[n].getAllIds()),
                                e.shouldGraph = !0;
                            for (var m = e.columns, g = [], y = 0, v = 0, b = m; v < b.length; v++)
                                 var x = b[v]
                                     , y = Math.max(x.values.length, y);
                            for (var S = 0; S < m.length; S++) {
                                for (var _, E = void 0, M = void 0, x = m[S], D = z.parse(x.latex, U.__assign(U.__assign({}, f), {
                                    seedPrefix: ee(n, [["tr", 0], ["tc", S]])
                                })), E = [], w = -1, P = 0; P < m[S].values.length; P++)
                                    x.values[P].replace(/\\space/g, "").match(/\S/) ? (E.push(z.parse(x.values[P], U.__assign(U.__assign({}, f), {
                                        seedPrefix: ee(n, [["tr", P + 1], ["tc", S]])
                                    }))),
                                        w = P) : E.push(H(NaN));
                                E = E.slice(0, w + 1),
                                    (M = J(D, y, E)).id = x.id,
                                M.header && (M.header.userData = x,
                                    M.header.metaData = {
                                        extraDepNodes: []
                                    },
                                x.colorLatex && (_ = z.parse(x.colorLatex, U.__assign(U.__assign({}, f), {
                                    seedPrefix: ee(n, [["tr", 0], ["tc", S], ["cl", S]])
                                })),
                                    M.header.metaData.colorLatex = _,
                                    M.header.metaData.extraDepNodes.push(_))),
                                    g.push(M)
                            }
                            this.statements[n] = Q(g);
                            var O = this.statements[n].getAllIds();
                            d.forEach(function(e) {
                                -1 === O.indexOf(e) && r._notifyGraphRemoved(e, t)
                            });
                            break;
                        case "image":
                            var T = "-\\trigAngleMultiplier*(" + e.angle + ")"
                                , L = z.parse(e.center, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["ic", n]])
                            }))
                                , I = z.parse(T, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["ia", n]])
                            }))
                                , C = z.parse(e.width, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["iw", n]])
                            }))
                                , N = z.parse(e.height, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["ih", n]])
                            }))
                                , A = z.parse(e.opacity, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["io", n]])
                            }));
                            this.statements[n] = Z({
                                center: L,
                                radianAngle: I,
                                width: C,
                                height: N,
                                opacity: A
                            });
                            break;
                        case "simulation":
                            var F = z.parse(e.fps || "60", U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["fps", n]])
                            }));
                            this.statements[n] = K(F);
                            break;
                        default:
                            for (var q in this.statements[n] = z.parse(e.latex, f),
                                ne) {
                                var R, B = q;
                                e[B] && (R = re(e[B], U.__assign(U.__assign({}, f), {
                                    seedPrefix: ee(n, [[ne[B].seed, n]])
                                })),
                                    h[B] = R,
                                    h.extraDepNodes.push(R))
                            }
                            e.colorLatex && (R = re(e.colorLatex, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["ac", n]])
                            })),
                                h.colorLatex = R,
                                h.extraDepNodes.push(R)),
                            e.polarDomain && e.polarDomain.min && (h.polarDomainMin = te(e.polarDomain.min, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["lm", n]])
                            })),
                                h.extraDepNodes.push(h.polarDomainMin)),
                            e.polarDomain && e.polarDomain.max && (h.polarDomainMax = te(e.polarDomain.max, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["lM", n]])
                            })),
                                h.extraDepNodes.push(h.polarDomainMax)),
                            e.parametricDomain && e.parametricDomain.min && (h.parametricDomainMin = te(e.parametricDomain.min, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["lm", n]])
                            })),
                                h.extraDepNodes.push(h.parametricDomainMin)),
                            e.parametricDomain && e.parametricDomain.max && (h.parametricDomainMax = te(e.parametricDomain.max, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["lM", n]])
                            })),
                                h.extraDepNodes.push(h.parametricDomainMax)),
                            e.vizProps && (e.vizProps.axisOffset && (h.vizAxisOffset = te(e.vizProps.axisOffset, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["vo", n]])
                            })),
                                h.extraDepNodes.push(h.vizAxisOffset)),
                            e.vizProps.breadth && (h.vizBreadth = te(e.vizProps.breadth, U.__assign(U.__assign({}, f), {
                                seedPrefix: ee(n, [["vb", n]])
                            })),
                                h.extraDepNodes.push(h.vizBreadth))),
                            e.cdf && e.cdf.show && (i = W.parseToplevelFunction(e.latex)) && "distribution" === i.type && (h.distributionSpec = i,
                                h.cdfMin = re(e.cdf.min, U.__assign(U.__assign({}, f), {
                                    seedPrefix: ee(n, [["lm", n]])
                                })),
                                h.extraDepNodes.push(h.cdfMin),
                                h.cdfMax = re(e.cdf.max, U.__assign(U.__assign({}, f), {
                                    seedPrefix: ee(n, [["lM", n]])
                                })),
                                h.extraDepNodes.push(h.cdfMax)),
                            this.statements[n].shouldPromoteToSlider(this.policy) && (o = !(!(a = e.slider) || !a.isPlayingOnce),
                                s = re(a && a.softMin, f),
                                u = re(a && a.softMax, f),
                                c = re(a && a.min, U.__assign(U.__assign({}, f), {
                                    seedPrefix: ee(n, [["lm", n]])
                                })),
                                l = re(a && a.max, U.__assign(U.__assign({}, f), {
                                    seedPrefix: ee(n, [["lM", n]])
                                })),
                                p = re(a && a.step, U.__assign(U.__assign({}, f), {
                                    seedPrefix: ee(n, [["ls", n]])
                                })),
                                this.statements[n] = $(this.statements[n], {
                                    sliderMin: c,
                                    sliderMax: l,
                                    sliderStep: p,
                                    sliderIsPlayingOnce: o,
                                    sliderSoftMin: s,
                                    sliderSoftMax: u
                                }))
                    }
                    var V = e.clickableInfo;
                    V && V.enabled && (h.clickableRules = (V.rules || []).map(function(e) {
                        return {
                            ruleId: e.id,
                            assignment: re(e.assignment, f),
                            expression: re(e.expression, f)
                        }
                    })),
                        this.statements[n].userData = e,
                        this.statements[n].metaData = h;
                    var k, j = e.label;
                    j ? (k = this.currentLabel[n]) && k.raw === j || (this.currentLabel[n] = G.parse(j)) : delete this.currentLabel[n]
                }
            }
            ,
            ae.prototype.removeStatement = function(e, t) {
                var r, n = this.statements[e];
                n && (this.markExportsDirty(e),
                    n.isTable ? (r = this,
                        n.getAllIds().forEach(function(e) {
                            r._notifyGraphRemoved(e, t)
                        })) : this._notifyGraphRemoved(e, t),
                    delete this.currentLabel[e],
                    delete this.statements[e],
                    delete this.analysis[e])
            }
            ,
            ae.prototype.markExportsDirty = function(e) {
                if (this.statements[e]) {
                    this.statements[e].isRegression && (this.markedRegressionDirty = !0);
                    for (var t = 0, r = this.statements[e].getLegalExports(this.policy); t < r.length; t++) {
                        var n = r[t];
                        this.dirtyExportedSymbolRoots[n] = !0
                    }
                }
            }
            ,
            ae.prototype.markAsDirtyRoot = function(e) {
                this.dirtyStatementRoots[e] = !0
            }
            ,
            ae.prototype.getFrame = function() {
                return this.updateAnalysis(),
                    this.frame
            }
            ,
            ae.prototype.getAnalysis = function() {
                return this.updateAnalysis(),
                    this.analysis
            }
            ,
            ae.prototype.getEvaluationState = function(e) {
                if (this.updateAnalysis(),
                    this.analysis[e])
                    return this.analysis[e].evaluationState
            }
            ,
            ae.prototype._updateRegressions = function(e) {
                var t = this.frame
                    , r = this.lastFrame
                    , n = this.regressionFrame
                    , i = [];
                for (var a in e)
                    e.hasOwnProperty(a) && e[a].isRegression && i.push(a);
                var o = this;
                i.sort(function(e, t) {
                    var r = o.statements[e].userData && o.statements[e].userData.residualVariable
                        , n = o.statements[t].userData && o.statements[t].userData.residualVariable;
                    return r && !n ? -1 : n && !r ? 1 : 0
                });
                var s = M(this.policy, e, i);
                A(s, n);
                for (var u = {}, c = 0, l = s.resolved; c < l.length; c++) {
                    var p, a = l[c];
                    this.statements[a].isRegression ? (this.analysis[a] = e[a].analyze(this.policy, n, t, r, u),
                        this.analysis[a].exportTo(this.policy, t),
                        delete e[a]) : (p = e[a].tryGetConcreteTree(this.policy, n),
                        e[a].exportTo(this.policy, p, n),
                        u[a] = {
                            rawTree: e[a],
                            concreteTree: p
                        })
                }
            }
            ,
            ae.prototype.buildSymbolToExpressionDirtyMap = function() {
                var e = {};
                for (var t in this.statements)
                    if (this.statements.hasOwnProperty(t)) {
                        var r = this.statements[t]
                            , n = r.metaData;
                        if (F(e, t, r.getDependencies()),
                            F(e, t, r.getLegalExports(this.policy)),
                        r.isRegression && r.userData && r.userData.residualVariable && F(e, t, [Y.latexToIdentifier(r.userData.residualVariable)]),
                            q(e, t, n),
                        r.isTable && r.columns)
                            for (var i = 0; i < r.columns.length; i++) {
                                var a = r.columns[i];
                                a.header && a.header.metaData && q(e, t, a.header.metaData)
                            }
                    }
                return e
            }
            ,
            ae.prototype.getDirtyIdsAndSymbols = function(e) {
                var t = {}
                    , r = {}
                    , n = this.markedRegressionDirty
                    , i = []
                    , a = [];
                for (var o in this.dirtyStatementRoots)
                    this.dirtyStatementRoots[o] && (r[o] = !0,
                        i.push(o));
                for (var s in this.dirtyExportedSymbolRoots)
                    this.dirtyExportedSymbolRoots[s] && (t[s] = !0,
                        a.push(s));
                for (; i.length || a.length; ) {
                    for (; i.length; ) {
                        var o = i.pop()
                            , u = this.statements[o];
                        if (u) {
                            u.isRegression && (n = !0);
                            for (var c = 0, l = u.getLegalExports(this.policy); c < l.length; c++)
                                t[s = l[c]] || (t[s] = !0,
                                    a.push(s))
                        }
                    }
                    for (; a.length; ) {
                        var p = e[s = a.pop()];
                        if (p)
                            for (var f = 0, h = p; f < h.length; f++)
                                r[o = h[f]] || (r[o] = !0,
                                    i.push(o))
                    }
                }
                return {
                    ids: r,
                    symbols: t,
                    hasDirtyRegression: n
                }
            }
            ,
            ae.prototype.updateAnalysis = function() {
                var e = this.buildSymbolToExpressionDirtyMap()
                    , t = this.getDirtyIdsAndSymbols(e)
                    , r = {};
                if (t.hasDirtyRegression) {
                    for (var n in this.statements)
                        this.statements[n] && (r[n] = this.statements[n]);
                    this.frame = Object.create(this.parent_frame),
                        this.regressionFrame = Object.create(this.parent_frame)
                } else {
                    var i = t.ids;
                    for (var n in i)
                        this.statements[n] && (r[n] = this.statements[n]);
                    var a = t.symbols;
                    for (var o in a)
                        a[o] && (delete this.frame[o],
                            delete this.regressionFrame[o])
                }
                for (var n in r)
                    r[n] && (this.unpublishedIds[n] = !0);
                this.markedRegressionDirty = !1,
                    this.dirtyExportedSymbolRoots = {},
                    this.dirtyStatementRoots = {};
                var s = this.analysis
                    , u = this.frame;
                "graphing" === this.evaluationMode && this._updateRegressions(r);
                var c = M(this.policy, r);
                A(c, u);
                for (var l, p, f, h = c.resolved, d = 0, m = h; d < m.length; d++)
                    switch (n = m[d],
                        this.evaluationMode) {
                        case "fourFunction":
                        case "singleExpressionFourFunction":
                            s[n] = this.statements[n].analyzeFourFunction(this.policy, u, s),
                                s[n].exportTo(this.policy, u);
                            break;
                        case "scientific":
                            s[n] = this.statements[n].analyzeScientific(this.policy, u, s),
                                s[n].exportTo(this.policy, u);
                            break;
                        case "singleExpressionScientific":
                            s[n] = this.statements[n].analyzeSingleExpressionScientific(this.policy, u, s),
                                s[n].exportTo(this.policy, u);
                            break;
                        case "graphing":
                        case "graphing_3d":
                            if (u.r) {
                                var g = Object.create(u);
                                if (g.r = T("r"),
                                    s[n] = this.statements[n].analyze(this.policy, g, s),
                                s[n].getGraphMode() === D.POLAR) {
                                    s[n].exportTo(this.policy, u);
                                    continue
                                }
                            }
                            s[n] = this.statements[n].analyze(this.policy, u, s),
                                s[n].exportTo(this.policy, u)
                    }
                if ("graphing" === this.evaluationMode || "graphing_3d" === this.evaluationMode)
                    for (var y = 0, v = h; y < v.length; y++) {
                        var n = v[y]
                            , b = s[n]
                            , x = b.evaluationState.expression_type;
                        for (var S in ne) {
                            var _ = S
                                , E = ne[_];
                            E.shouldEvaluate && !E.shouldEvaluate(x) || R(b, this.policy, u, _)
                        }
                        !function(e, t, r) {
                            var n, i;
                            if (e.rawTree.isTable && e.evaluationState.column_data && e.rawTree.columns)
                                for (var a = 0; a < e.evaluationState.column_data.length; a++)
                                    n = e.evaluationState.column_data[a],
                                        V((i = e.rawTree.columns[a].header.metaData).colorLatex, i, n, t, r);
                            else
                                n = e.evaluationState,
                                    V((i = e.rawTree.metaData).colorLatex, i, n, t, r)
                        }(b, this.policy, u),
                        function(e) {
                            var t = e.evaluationState.expression_type
                                , r = e.rawTree.userData;
                            if (r.clickableInfo && r.clickableInfo.enabled) {
                                if (e.rawTree.isImage)
                                    return 1;
                                if (e.rawTree.isSimulation)
                                    return 1;
                                if (e.getGraphMode() !== D.XYPOINT_MOVABLE)
                                    return w.isClickableExpressionType(t)
                            }
                        }(b) && function(e, F, q) {
                            var R = e.evaluationState
                                , t = e.rawTree
                                , B = {}
                                , V = {};
                            R.clickableinfo_data = {},
                                t.metaData.clickableRules.forEach(function(e) {
                                    var t, r, n, i, a, o, s, u, c = e.assignment, l = e.expression, p = {};
                                    if (R.clickableinfo_data[e.ruleId] = p,
                                        c) {
                                        "Identifier" === c.type ? "Slider" === (s = (o = q[(a = c)._symbol]) && o.type) || "Assignment" === s ? (t = a._symbol,
                                            (u = V[t]) ? (n = k.clickableObjectAlreadyAssigned(t).getError(),
                                            !0 !== u && (delete u.identifier,
                                                delete u.latex,
                                                u.error = k.clickableObjectAlreadyAssigned(t).getError(),
                                                V[t] = !0)) : V[t] = p) : n = k.clickableObjectAssignmentNotDefined(a._symbol).getError() : n = k.clickableObjectAssignmentNotIdentifier().getError();
                                        for (var f = 0, h = c.tryGetConcreteTree(F, q).getDependencies(); f < h.length; f++) {
                                            var d = h[f];
                                            B[d] = !0
                                        }
                                    }
                                    if (l) {
                                        var m = l.tryGetConcreteTree(F, q);
                                        if (m.valueType === X.Number) {
                                            var g = +m.asValue();
                                            isNaN(g) || (r = j.default(g))
                                        } else if (m.valueType === X.ListOfNumber) {
                                            for (var y = [], v = !0, b = 0, x = m.args; b < x.length; b++) {
                                                if ((L = x[b]).valueType !== X.Number) {
                                                    v = !1;
                                                    break
                                                }
                                                var S = +L.asValue();
                                                y.push(j.default(S)),
                                                isNaN(S) && (v = !1)
                                            }
                                            v && (r = "\\left[" + y.join(",") + "\\right]")
                                        } else if (m.valueType === X.Point) {
                                            for (var _ = [], E = !0, M = 0, D = m.args; M < D.length; M++) {
                                                if ((L = D[M]).valueType !== X.Number) {
                                                    E = !1;
                                                    break
                                                }
                                                if (S = +L.asValue(),
                                                    isNaN(S)) {
                                                    E = !1;
                                                    break
                                                }
                                                _.push(j.default(S))
                                            }
                                            E && (r = "\\left(" + _.join(",") + "\\right)")
                                        } else if (m.valueType === X.ListOfPoint) {
                                            for (var v = !0, w = [], P = 0, O = m.args; P < O.length; P++) {
                                                var T = O[P];
                                                if (T.valueType !== X.Point) {
                                                    v = !1;
                                                    break
                                                }
                                                for (var L, _ = [], E = !0, I = 0, C = T.args; I < C.length; I++) {
                                                    if ((L = C[I]).valueType !== X.Number) {
                                                        E = !1;
                                                        break
                                                    }
                                                    if (S = +L.asValue(),
                                                        isNaN(S)) {
                                                        E = !1;
                                                        break
                                                    }
                                                    _.push(j.default(S))
                                                }
                                                if (!E) {
                                                    v = !1;
                                                    break
                                                }
                                                w.push("\\left(" + _.join(",") + "\\right)")
                                            }
                                            v && (r = "\\left[" + w.join(",") + "\\right]")
                                        } else
                                            m.valueType === X.EmptyList && (r = "\\left[\\right]");
                                        r || (i = k.clickableObjectInvalidExpression().getError());
                                        for (var N = 0, A = m.getDependencies(); N < A.length; N++)
                                            d = A[N],
                                                B[d] = !0
                                    }
                                    n ? p.error = n : i ? p.error = i : t && r && (p.identifier = t,
                                        p.latex = Y.identifierToLatex(t) + "=" + r)
                                }),
                                P.addSliderPrompts(R, F, B)
                        }(b, this.policy, u),
                            x === w.ExpressionType.PARAMETRIC || x === w.ExpressionType.POLAR ? function(e, t, r) {
                                var n = e.evaluationState
                                    , i = e.rawTree
                                    , a = n.expression_type === w.ExpressionType.POLAR ? i.metaData.polarDomainMin : i.metaData.parametricDomainMin
                                    , o = n.expression_type === w.ExpressionType.POLAR ? i.metaData.polarDomainMax : i.metaData.parametricDomainMax
                                    , s = {}
                                    , u = NaN
                                    , c = NaN
                                    , l = !1;
                                if (a) {
                                    l = !0;
                                    var p = a.tryGetConcreteTree(t, r);
                                    p.isConstant && (u = +p.asValue());
                                    for (var f = 0, h = p.getDependencies(); f < h.length; f++)
                                        s[h[f]] = !0
                                } else
                                    u = 0;
                                if (o) {
                                    l = !0;
                                    var d = o.tryGetConcreteTree(t, r);
                                    d.isConstant && (c = +d.asValue());
                                    for (var m = 0, g = d.getDependencies(); m < g.length; m++)
                                        s[g[m]] = !0
                                } else
                                    n.expression_type === w.ExpressionType.PARAMETRIC ? c = 1 : n.expression_type === w.ExpressionType.POLAR && (c = 12 * Math.PI / r.trigAngleMultiplier.asValue());
                                var y = !0
                                    , v = !0;
                                isFinite(u) || (y = !1,
                                    u = NaN),
                                isFinite(c) || (v = !1,
                                    c = NaN),
                                    y ? v ? c < u && (v = y = !1,
                                        n.error = k.domainMaxLessThanMin().getError()) : n.error = k.domainMaxInvalid().getError() : n.error = k.domainMinInvalid().getError(),
                                    i.metaData.evaluatedDomainMin = u,
                                    i.metaData.evaluatedDomainMax = c,
                                n.expression_type === w.ExpressionType.POLAR && (i.metaData.isExplicitDomain = l),
                                    n.domain_min_number = u,
                                    n.domain_max_number = c,
                                    n.domain_min_valid = y,
                                    n.domain_max_valid = v,
                                n.expression_type === w.ExpressionType.PARAMETRIC && (delete s.t,
                                    P.addSliderPrompts(n, t, s))
                            }(b, this.policy, u) : x === w.ExpressionType.BOXPLOT ? function(e, t, r) {
                                var n = e.evaluationState
                                    , i = e.rawTree
                                    , a = i.metaData.vizAxisOffset
                                    , o = i.metaData.vizBreadth
                                    , s = {}
                                    , u = NaN
                                    , c = NaN;
                                if (a) {
                                    var l = a.tryGetConcreteTree(t, r);
                                    l.isConstant && (u = +l.asValue());
                                    for (var p = 0, f = l.getDependencies(); p < f.length; p++)
                                        s[f[p]] = !0
                                } else
                                    u = 1;
                                if (o) {
                                    var h = o.tryGetConcreteTree(t, r);
                                    h.isConstant && (c = +h.asValue());
                                    for (var d = 0, m = h.getDependencies(); d < m.length; d++)
                                        s[m[d]] = !0
                                } else
                                    c = 1;
                                var g = !0
                                    , y = !0;
                                isFinite(u) || (g = !1,
                                    u = NaN),
                                isFinite(c) || (y = !1,
                                    c = NaN),
                                    g ? y || (n.error = k.boxplotBreadthInvalid().getError()) : n.error = k.boxplotOffsetInvalid().getError(),
                                    i.metaData.evaluatedAxisOffset = u,
                                    i.metaData.evaluatedBreadth = c,
                                    n.viz_values = {
                                        axisOffset: u,
                                        breadth: c
                                    },
                                    n.viz_valids = {
                                        axisOffset: g,
                                        breadth: y
                                    },
                                    P.addSliderPrompts(n, t, s)
                            }(b, this.policy, u) : (f = p = void 0,
                                p = (l = b).rawTree.userData,
                                f = l.rawTree.metaData,
                            p.cdf && p.cdf.show && f.distributionSpec && function(e, t, r) {
                                var n = e.evaluationState
                                    , i = e.rawTree
                                    , a = i.metaData.cdfMin
                                    , o = i.metaData.cdfMax
                                    , s = {}
                                    , u = NaN
                                    , c = NaN
                                    , l = "Assignment" === i.type ? i._expression : i
                                    , p = l && l.metaData && l.metaData.distributionSpec;
                                if (a) {
                                    var f = a.tryGetConcreteTree(t, r);
                                    f.isConstant && (u = +f.asValue());
                                    for (var h = 0, d = f.getDependencies(); h < d.length; h++)
                                        s[d[h]] = !0
                                } else
                                    u = -1 / 0;
                                if (o) {
                                    var m = o.tryGetConcreteTree(t, r);
                                    m.isConstant && (c = +m.asValue());
                                    for (var g = 0, y = m.getDependencies(); g < y.length; g++)
                                        s[y[g]] = !0
                                } else
                                    c = 1 / 0;
                                var v, b = !0, x = !0;
                                isNaN(u) && (b = !1,
                                    u = NaN),
                                isNaN(c) && (x = !1,
                                    c = NaN),
                                    b ? x ? c < u && (x = b = !1,
                                        n.error = k.cdfMaxLessThanMin().getError()) : n.error = k.cdfMaxInvalid().getError() : n.error = k.cdfMinInvalid().getError(),
                                b && x && (v = O("cdf", [l, H(u), H(c)]),
                                    n.cdf_evaluation = +v.tryGetConcreteTree(t, r).asValue());
                                var S, _ = -1 / 0, E = 1 / 0;
                                p && (p.discrete && (_ = 0),
                                "binomialdist" === p.symbol && l.args && l.args[0] && (S = +l.args[0].asValue(),
                                isFinite(S) && (E = S))),
                                    i.metaData.evaluatedCDFMin = u,
                                    i.metaData.evaluatedCDFMax = c,
                                    n.cdf_min_valid = b,
                                    n.cdf_max_valid = x,
                                    n.cdf_min_default = _,
                                    n.cdf_max_default = E,
                                    n.is_single_identifier = !1,
                                    P.addSliderPrompts(n, t, s)
                            }(b, this.policy, u))
                    }
                for (var o in (e.globalRandomSeed || []).forEach(function(e) {
                    s[e].evaluationState.depends_on_random_seed = !0
                }),
                    this.lastFrame = Object.create(this.parent_frame),
                    u)
                    u.hasOwnProperty(o) && (this.lastFrame[o] = u[o])
            }
            ,
            ae);
        function ae() {
            this.getCLSymbolMap = m.getCLSymbolMap,
                this.statements = {},
                this.analysis = {},
                this.currentStatus = {},
                this.currentLabel = {},
                this.unpublishedIds = {},
                this.intersectId = void 0,
                this.dirtyExportedSymbolRoots = {},
                this.dirtyStatementRoots = {},
                this.markedRegressionDirty = !1,
                this.use_degrees = !1,
                this.initialEvaluation = !1,
                this.setEvaluationMode("graphing"),
                this.setRestrictedFunctions(!1),
                this.setForceEnableGeometryFunctions(!1),
                this.setFunctionDefinition(!0),
                this.setReplaceRoundWithReciprocal(!1),
                this.setDistributions(!0),
                this.invalidate()
        }
        t.Context = ie
    });
    _("core/graphing-calc/migrations/0", ["require"], function(e) {
        "use strict";
        var i = {
            expression: !0,
            table: !0,
            image: !0,
            folder: !0,
            text: !0
        };
        function a(e) {
            return e.replace(/\\(total|length|mean|median|quantile|stdev|stddev|stdDev|stdevp|stddevp|stdDevP|var|variance|cov|corr|ceil|floor|round|abs|mod|lcm|mcm|mcd|nCr|nPr|signum|sign|arcsinh|arccosh|arctanh|arccsch|arcsech|arccoth|arccsc|arcsec|arccot)/g, "\\operatorname{$1}")
        }
        function o(e) {
            var t = {};
            for (var r in e)
                e.hasOwnProperty(r) && (t[r] = "latex" === r ? a(e[r]) : "values" === r ? e[r].map(a) : e[r]);
            return t
        }
        function r(e) {
            var t, r = function(e) {
                if (e.type) {
                    if (i.hasOwnProperty(e.type))
                        return e.type;
                    throw new Error("Invalid item type: '" + e.type + "'.")
                }
                return void 0 !== e.text ? "text" : void 0 !== e.columns || void 0 !== e.headings ? "table" : "expression"
            }(e), n = {};
            switch (r) {
                case "expression":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = "latex" === t ? a(e[t]) : e[t]);
                    return n.type = r,
                        n;
                case "table":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = "columns" === t ? e[t].map(o) : e[t]);
                    return n.type = r,
                        n;
                case "image":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = "width" === t || "height" === t || "x" === t || "y" === t ? a(e[t]) : e[t]);
                    return n.type = r,
                        n;
                case "text":
                case "folder":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = e[t]);
                    return n.type = r,
                        n
            }
        }
        var n = {
            none: "NONE",
            both: "BOTH",
            positive: "POSITIVE"
        };
        return function(e) {
            if (e.version)
                throw new Error("Unexpected version: " + e.version);
            var t = {};
            return t.graph = function(e) {
                var t = {};
                for (var r in e)
                    e.hasOwnProperty(r) && "xAxisArrows" !== r && "yAxisArrows" !== r && (t[r] = e[r]);
                return t.xAxisArrowMode = n[e.xAxisArrows || "none"],
                    t.yAxisArrowMode = n[e.yAxisArrows || "none"],
                    t
            }(e.graph),
                t.expressions = {
                    list: e.expressions.list.map(r)
                },
                t.version = 0,
                t
        }
    });
    _("core/graphing-calc/migrations/1", ["require"], function(e) {
        "use strict";
        function i(e) {
            return e.replace(/\\(sech|csch)/g, "\\operatorname{$1}")
        }
        function a(e) {
            var t = {};
            for (var r in e)
                e.hasOwnProperty(r) && (t[r] = "latex" === r ? i(e[r]) : "values" === r ? e[r].map(i) : e[r]);
            return t
        }
        function r(e) {
            var t, r = e.type, n = {};
            switch (r) {
                case "expression":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = "latex" === t ? i(e[t]) : e[t]);
                    return n;
                case "table":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = "columns" === t ? e[t].map(a) : e[t]);
                    return n;
                case "image":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = "width" === t || "height" === t || "x" === t || "y" === t ? i(e[t]) : e[t]);
                    return n;
                case "text":
                case "folder":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = e[t]);
                    return n;
                default:
                    throw new Error("Unexpected expression type: " + r)
            }
        }
        return function(e) {
            if (e.version)
                throw new Error("Unexpected version: " + e.version);
            var t = {};
            return t.graph = e.graph,
                t.expressions = {
                    list: e.expressions.list.map(r)
                },
                t.version = 1,
                t
        }
    });
    _("core/graphing-calc/migrations/2", ["require", "core/lib/color-helpers"], function(e) {
        "use strict";
        var t = e("core/lib/color-helpers").colors
            , r = "#C0504D"
            , n = "#4F81BD"
            , i = "#9BBB59"
            , a = "#8064A2"
            , o = "#F79646"
            , s = "#000000";
        function u(e) {
            switch (e) {
                case r:
                    return t.RED;
                case n:
                    return t.BLUE;
                case i:
                    return t.GREEN;
                case a:
                    return t.PURPLE;
                case o:
                    return t.ORANGE;
                case s:
                    return t.BLACK;
                default:
                    return e
            }
        }
        function c(e) {
            var t = {};
            for (var r in e)
                e.hasOwnProperty(r) && (t[r] = "color" === r ? u(e[r]) : e[r]);
            return t
        }
        function l(e) {
            var t, r = e.type, n = {};
            switch (r) {
                case "expression":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = "color" === t ? u(e[t]) : e[t]);
                    return n;
                case "table":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = "columns" === t ? e[t].map(c) : e[t]);
                    return n;
                case "image":
                case "text":
                case "folder":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = e[t]);
                    return n;
                default:
                    throw new Error("Unexpected expression type: " + r)
            }
        }
        return function(e) {
            if (1 < e.version)
                throw new Error("Unexpected version: " + e.version);
            var t = {};
            return t.graph = e.graph,
                t.expressions = {
                    list: e.expressions.list.map(l)
                },
                t.version = 2,
                t
        }
    });
    _("core/graphing-calc/migrations/3", ["require"], function(e) {
        "use strict";
        function i(e) {
            if ("string" == typeof e)
                return e;
            if (void 0 === e)
                return "";
            var t = e + "";
            return t = (t = t.replace(/1e\+?([-\d]+)/, "10^{$1}")).replace(/([-\d\.]+)e\+?([-\d]+)/, "$1\\cdot 10^{$2}")
        }
        function r(e) {
            var t, r = e.type, n = {};
            switch (r) {
                case "expression":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = "sliderMax" === t || "sliderMin" === t || "sliderInterval" === t ? i(e[t]) : "domain" === t ? {
                            max: i(e[t].max),
                            min: i(e[t].min)
                        } : e[t]);
                    return n.hasOwnProperty("sliderMin") && void 0 === n.sliderInterval && (n.sliderInterval = ""),
                        n;
                case "image":
                case "table":
                case "text":
                case "folder":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = e[t]);
                    return n;
                default:
                    throw new Error("Unexpected expression type: " + r)
            }
        }
        return function(e) {
            if (2 < e.version)
                throw new Error("Unexpected version: " + e.version);
            var t = {};
            return t.graph = e.graph,
                t.expressions = {
                    list: e.expressions.list.map(r)
                },
                t.version = 3,
                t
        }
    });
    _("core/graphing-calc/migrations/4", ["require"], function(e) {
        "use strict";
        function i(e) {
            switch (e) {
                case "point":
                    return "POINT";
                case "cross":
                    return "CROSS";
                case "open":
                    return "OPEN";
                case "normal":
                    return "SOLID";
                case "dashed":
                    return "DASHED";
                case "dotted":
                    return "DOTTED";
                default:
                    return e
            }
        }
        function a(e) {
            var t = {};
            for (var r in e)
                e.hasOwnProperty(r) && (t[r] = "style" === r ? i(e[r]) : e[r]);
            return t
        }
        function r(e) {
            var t, r = e.type, n = {};
            switch (r) {
                case "expression":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = "style" === t ? i(e[t]) : e[t]);
                    return n;
                case "table":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = "columns" === t ? e[t].map(a) : e[t]);
                    return n;
                case "image":
                case "text":
                case "folder":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = e[t]);
                    return n;
                default:
                    throw new Error("Unexpected expression type: " + r)
            }
        }
        return function(e) {
            if (3 !== e.version)
                throw new Error("Unexpected version: " + e.version);
            var t = {};
            return t.graph = e.graph,
                t.expressions = {
                    list: e.expressions.list.map(r)
                },
                t.version = 4,
                t
        }
    });
    _("core/graphing-calc/validate-state", ["require", "exports", "core/lib/deepCopy"], function(e, t, r) {
        "use strict";
        function n(e) {
            for (var t, r, n, i, a = function(e) {
                for (var t = 0, r = 0, n = e; r < n.length; r++) {
                    var i = n[r];
                    if (t = h(t, i.id),
                    "table" === i.type)
                        for (var a = 0, o = i.columns; a < o.length; a++) {
                            var s = o[a];
                            h(t, s.id)
                        }
                }
                return t
            }(e) + 1, o = {}, s = 0, u = e; s < u.length; s++) {
                var c = u[s];
                if (i = void 0,
                (n = c).slider && ("number" == typeof (i = n.slider).min && (i.min = "" + i.min),
                "number" == typeof i.max && (i.max = "" + i.max),
                "number" == typeof i.step && (i.step = "" + i.step)),
                "string" != typeof n.id && (n.id = "" + n.id),
                "folder" === c.type)
                    t = c.id,
                    o[c.id] && (c.id = "" + a,
                        a += 1),
                        r = c.id,
                        o[c.id] = !0,
                    c.hasOwnProperty("folderId") && delete c.folderId;
                else {
                    if (void 0 !== t && c.folderId === t ? c.folderId = r : (c.folderId && (c.folderId = ""),
                        r = t = void 0),
                    "table" === c.type)
                        for (var l = 0, p = c.columns; l < p.length; l++) {
                            var f = p[l];
                            o[f.id] && (f.id = "" + a,
                                a += 1),
                                o[f.id] = !0
                        }
                    o[c.id] && (c.id = "" + a,
                        a += 1),
                        o[c.id] = !0
                }
            }
        }
        function h(e, t) {
            var r = parseFloat(t);
            return r !== Math.floor(r) ? e : Math.max(e, r)
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.validateState = void 0,
            t.validateState = function(e) {
                var t = r.default(e);
                return n(t.expressions.list),
                    t
            }
    });
    _("core/graphing-calc/migrations/back-migration", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.default = function(e) {
                if (9 !== e.version)
                    throw new Error("Unexpected version: " + e.version);
                var t = e.expressions.list.map(function(e) {
                    return e
                });
                return {
                    version: 8,
                    graph: e.graph,
                    randomSeed: e.randomSeed,
                    expressions: {
                        list: t
                    }
                }
            }
    });
    _("core/graphing-calc/migrations/5", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.migrateState = void 0;
        function u(e) {
            var t = {};
            for (var r in e)
                e.hasOwnProperty(r) && "showPoints" !== r && "showLine" !== r && (t[r] = e[r]);
            return void 0 === e.showPoints && void 0 === e.showLine || (e.showPoints && e.showLine ? t.columnMode = "POINTS_AND_LINES" : e.showPoints ? t.columnMode = "POINTS" : e.showLine ? t.columnMode = "LINES" : (t.hidden = !0,
                t.columnMode = "POINTS")),
                t
        }
        function r(e) {
            var t, r = e.type, n = {};
            switch (r) {
                case "expression":
                    for (t in void 0 === e.hidden ? e.hasOwnProperty("graphed") ? n.hidden = !e.graphed : e.hasOwnProperty("userRequestedGraphing") ? n.hidden = "never" === e.userRequestedGraphing : n.hidden = !1 : n.hidden = e.hidden,
                        e)
                        e.hasOwnProperty(t) && "graphed" !== t && "userRequestedGraphing" !== t && "hidden" !== t && "slider" !== t && ("color" !== t ? "style" !== t ? "sliderInterval" !== t ? n[t] = e[t] : n.sliderInterval = "undefined" === e.sliderInterval ? "" : e.sliderInterval : n.style = "normal" === e.style ? "SOLID" : e.style : "object" == typeof e.color ? n.color = e.color.value : n.color = e.color);
                    return n;
                case "table":
                    if (e.headings || e.columns) {
                        var i = e.headings ? e.headings : e.columns;
                        if (n.columns = i.map(u),
                            e.rows)
                            for (var a = 0; a < n.columns.length; a++) {
                                var o = n.columns[a];
                                o.values = [];
                                for (var s = 0; s < e.rows.length; s++)
                                    o.values.push(e.rows[s][a])
                            }
                    }
                    for (t in e)
                        e.hasOwnProperty(t) && "rows" !== t && "headings" !== t && "columns" !== t && (n[t] = e[t]);
                    return n;
                case "image":
                case "text":
                case "folder":
                    for (t in e)
                        e.hasOwnProperty(t) && (n[t] = e[t]);
                    return n;
                default:
                    throw new Error("Unexpected expression type: " + r)
            }
        }
        t.migrateState = function(e) {
            if (4 !== e.version)
                throw new Error("Unexpected version: " + e.version);
            return {
                version: 5,
                graph: function(e) {
                    var t, r = {};
                    for (var n in e)
                        if (e.hasOwnProperty(n))
                            switch (t = e[n],
                                n) {
                                case "showAxes":
                                    r.showXAxis = t,
                                        r.showYAxis = t;
                                    break;
                                case "showLabels":
                                    r.xAxisNumbers = t,
                                        r.yAxisNumbers = t,
                                        r.polarNumbers = t;
                                    break;
                                case "labelXMode":
                                    r.xAxisStep = "pi" === t ? Math.PI : 0;
                                    break;
                                case "labelYMode":
                                    r.yAxisStep = "pi" === t ? Math.PI : 0;
                                    break;
                                default:
                                    r[n] = t
                            }
                    return r
                }(e.graph),
                expressions: {
                    list: e.expressions.list.map(r)
                }
            }
        }
    });
    _("core/math/evaluate-single-expression", ["require", "exports", "parser", "core/math/builtinframe", "core/math/parsenode/constant", "core/math/policy"], function(e, t, n, i, a, o) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.default = function(e, t) {
                if (/^\s*(\-|\+)?([0-9]+(\.[0-9]+)?)\s*$/.test(e))
                    return parseFloat(e);
                var r = Object.create(i);
                return r.trigAngleMultiplier = a(t ? Math.PI / 180 : 1),
                    +n.parse(e).tryGetConcreteTree(o.defaultPolicy, r).asValue()
            }
    });
    _("core/graphing-calc/migrations/6", ["require", "exports", "core/lib/deepCopy", "underscore", "core/math/sliders", "core/math/evaluate-single-expression"], function(e, t, s, y, v, b) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.migrateState = void 0;
        function x(e) {
            var t = {};
            for (var r in e)
                if (e.hasOwnProperty(r) && "style" !== r)
                    if ("values" === r && (t[r] = e[r].map(function(e) {
                        return e ? "" + e : ""
                    })),
                    "columnMode" !== r || e.hasOwnProperty("points") || e.hasOwnProperty("lines"))
                        t[r] = e[r];
                    else
                        switch (e[r]) {
                            case "LINES":
                                t.points = !1,
                                    t.lines = !0;
                                break;
                            case "POINTS_AND_LINES":
                                t.points = !0,
                                    t.lines = !0;
                                break;
                            default:
                                t.points = !0,
                                    t.lines = !1
                        }
            return t.hasOwnProperty("pointStyle") || (t.pointStyle = "POINT"),
            t.hasOwnProperty("lineStyle") || (t.lineStyle = "SOLID"),
                t.id = "" + t.id,
                t
        }
        var S = {
            sliderMin: "min",
            sliderMax: "max",
            sliderInterval: "step",
            sliderHardMin: "hardMin",
            sliderHardMax: "hardMax",
            sliderAnimationPeriod: "animationPeriod",
            sliderLoopMode: "loopMode",
            sliderPlayDirection: "playDirection",
            sliderIsPlaying: "isPlaying"
        };
        function _(e) {
            var t = function(e) {
                if (!((t = e).length < 2) && "`" === t[0] && "`" === t[t.length - 1])
                    return {
                        raw: e,
                        parts: [e]
                    };
                for (var t, r, n, i = "({" + ["[a-zA-Z][0-9]*", "[a-zA-Z]_[a-zA-Z0-9]+", "[a-zA-Z]_\\{[a-zA-Z0-9]+\\}"].join("})|({") + "})", a = new RegExp(i,"g"), o = [], s = 0; n = a.exec(e); ) {
                    s < (r = n.index) && o.push(e.substr(s, r - s));
                    var u = n[0]
                        , c = u.replace(/[{}\$]/g, "").replace(/^([a-zA-Z])([0-9]+)$/, "$1_$2");
                    o.push({
                        symbol: c,
                        str: u
                    }),
                        s = n.index + u.length
                }
                return s < e.length && o.push(e.substr(s)),
                    {
                        raw: e,
                        parts: o
                    }
            }(e)
                , r = "";
            return y.each(t.parts, function(e) {
                r += "object" == typeof e && e.str ? "$" + e.str : e
            }),
                r
        }
        function u(e, t, r, n) {
            var i, a, o, s, u, c, l, p, f, h, d, m = e.type, g = {};
            switch (m) {
                case "folder":
                    for (i in e)
                        e.hasOwnProperty(i) && ("memberIds" === i || (g[i] = e[i]));
                    break;
                case "expression":
                    for (i in e) {
                        e.hasOwnProperty(i) && ("style" !== i || e.hasOwnProperty("pointStyle") || e.hasOwnProperty("lineStyle") ? (S.hasOwnProperty(i) ? (g.slider = g.slider || {},
                            g.slider[S[i]] = e[i]) : g[i] = e[i],
                        e.label && (g.label = _(e.label))) : (a = e[i],
                            y.contains(["POINT", "OPEN", "CROSS"], a) ? (g.pointStyle = a,
                                g.lineStyle = "SOLID") : y.contains(["SOLID", "DASHED", "DOTTED"], a) ? (g.pointStyle = "POINT",
                                g.lineStyle = a) : (g.pointStyle = "POINT",
                                g.lineStyle = "SOLID")))
                    }
                    g.latex && g.slider && !g.slider.isPlaying && (s = n,
                    2 === (h = (o = g).latex.split("=")).length && (u = b.default(h[1], s),
                    isFinite(u) && (c = o.slider.hardMin ? b.default(o.slider.min || "-10", s) : void 0,
                        l = o.slider.hardMax ? b.default(o.slider.max || "10", s) : void 0,
                        p = o.slider.step ? b.default(o.slider.step, s) : void 0,
                    (f = v.determineWhichLimitsAreCompatibleWithValue({
                        target: u,
                        step: p,
                        hardMin: c,
                        hardMax: l
                    })).min || (delete o.slider.hardMin,
                        delete o.slider.min),
                    f.max || (delete o.slider.hardMax,
                        delete o.slider.max),
                    f.step || delete o.slider.step))),
                    g.hasOwnProperty("fillOpacity") || (g.fillOpacity = .4),
                    !1 === g.label && (g.label = ""),
                    g.labelSize || (g.labelSize = "medium"),
                    g.labelOrientation || (g.labelOrientation = "default"),
                    g.verticalLabel || (g.verticalLabel = !1),
                    g.interactiveLabel || (g.interactiveLabel = !1);
                    break;
                case "image":
                    for (i in e)
                        e.hasOwnProperty(i) && "x" !== i && "y" !== i && (g[i] = e[i]);
                    g.center = "\\left(" + (e.x || "0") + "," + (e.y || "0") + "\\right)",
                        g.angle = e.angle || "0",
                        g.foreground = !!g.foreground;
                    break;
                case "text":
                    for (i in e)
                        e.hasOwnProperty(i) && (g[i] = e[i]);
                    break;
                case "table":
                    for (i in e)
                        e.hasOwnProperty(i) && (g[i] = "columns" === i ? e[i].map(x) : e[i]);
                    break;
                default:
                    throw new Error("Unexpected expression type: " + m)
            }
            return g.id = "" + g.id,
                "folder" === e.type ? (t.folderId = g.id,
                    t.memberIds = e.memberIds,
                    g.folderId = "") : (d = r[g.id],
                    t.memberIds && t.memberIds[d] ? g.folderId = t.folderId : (g.folderId = "",
                        t.folderId = void 0,
                        t.memberIds = void 0)),
                g
        }
        t.migrateState = function(e) {
            if (5 !== e.version)
                throw new Error("Unexpected version: " + e.version);
            var t = !(!e.graph || !e.graph.degreeMode)
                , r = e.expressions.list
                , n = -1
                , i = {}
                , a = {}
                , o = {};
            return {
                version: 6,
                graph: e.graph,
                expressions: {
                    list: r.map(function(e) {
                        return i[e.id] ? (-1 === n && (n = function(e) {
                            for (var t = 0, r = /^[0-9]+$/, n = e.length - 1; 0 <= n; n--) {
                                var i, a = e[n], o = a.id;
                                if (r.test(o) && t < (i = parseInt(o, 10)) && (t = i),
                                "table" === a.type && a.columns)
                                    for (var s = a.columns.length - 1; 0 <= s; s--)
                                        o = a.columns[s].id,
                                        r.test(o) && t < (i = parseInt(o, 10)) && (t = i)
                            }
                            return t + 1
                        }(r)),
                            a[n] = e.id,
                            (e = s.default(e)).id = n + "",
                            n += 1) : a[e.id] = e.id,
                            i[e.id] = !0,
                            u(e, o, a, t)
                    })
                }
            }
        }
    });
    _("core/graphing-calc/migrations/7", ["require", "exports", "tslib"], function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.default = function(e) {
                if (6 !== e.version)
                    throw new Error("Unexpected version: " + e.version);
                var t = e.expressions.list.map(function(e) {
                    if ("expression" === e.type && e.domain) {
                        var t = r.__assign(r.__assign({}, e), {
                            parametricDomain: {
                                min: e.domain.min,
                                max: e.domain.max
                            }
                        });
                        return delete t.domain,
                            t
                    }
                    return e
                });
                return {
                    version: 7,
                    randomSeed: e.randomSeed,
                    graph: e.graph,
                    expressions: {
                        list: t
                    }
                }
            }
    });
    _("core/lib/random-seed", ["require", "exports", "core/lib/md5"], function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.default = function() {
                var e = new Uint8Array(16);
                if ("undefined" != typeof crypto)
                    crypto.getRandomValues(e);
                else {
                    if ("undefined" == typeof msCrypto)
                        return r(Date.now().toString());
                    msCrypto.getRandomValues(e)
                }
                return Array.prototype.slice.call(e).map(function(e) {
                    return 1 === (t = e.toString(16)).length ? "0" + t : t;
                    var t
                }).join("")
            }
    });
    _("core/graphing-calc/migrations/8", ["require", "exports", "tslib", "core/lib/random-seed", "core/lib/deepCopy"], function(e, t, u, r, c) {
        "use strict";
        function l(e) {
            var t = e.split("_");
            return 2 === t.length && t[1] && 1 === t[1].length ? t[0] + "_{" + t[1] + "}" : e
        }
        function p(e) {
            return (e = c.default(e)).rules || !e.assignment && !e.expression || (e.rules = [{
                id: "1",
                assignment: e.assignment || "",
                expression: e.expression || ""
            }]),
                delete e.assignment,
                delete e.expression,
                e
        }
        function f(e) {
            return e.replace(/\\operatorname(?:\{stdev\}p|\{stddev\}p|\{stdDev\}P|\{var\}iance)/g, function(e) {
                switch (e) {
                    case "\\operatorname{stdev}p":
                        return "\\operatorname{stdevp}";
                    case "\\operatorname{stddev}p":
                        return "\\operatorname{stddevp}";
                    case "\\operatorname{stdDev}P":
                        return "\\operatorname{stdDevP}";
                    case "\\operatorname{var}iance":
                        return "\\operatorname{variance}";
                    default:
                        return ""
                }
            })
        }
        function h(e) {
            var t = e.latex
                , r = e.values
                , n = u.__assign({}, e);
            return t && (n.latex = f(t),
                n.latex = l(n.latex)),
            r && (n.values = r.map(function(e) {
                return e ? f(e) : ""
            })),
                n
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.default = function(e) {
                if (7 !== e.version)
                    throw new Error("Unexpected version: " + e.version);
                var t = e.expressions.list.map(function(e) {
                    if ("image" === e.type) {
                        var t, r = u.__assign(u.__assign({}, e), {
                            opacity: ""
                        });
                        for (var n in e.hasOwnProperty("stringOpacity") ? r.opacity = e.stringOpacity : e.hasOwnProperty("opacity") ? r.opacity = e.opacity + "" : delete r.opacity,
                        e.clickableInfo && (r.clickableInfo = p(e.clickableInfo)),
                            delete r.stringOpacity,
                            e) {
                            "x" !== n && "y" !== n && "width" !== n && "height" !== n || (t = e[n]) && (r[n] = f(t))
                        }
                        return r
                    }
                    if ("expression" !== e.type)
                        return "table" === e.type ? (i = e).columns ? u.__assign(u.__assign({}, i), {
                            columns: i.columns.map(h)
                        }) : i : e;
                    var i, r = u.__assign(u.__assign({}, e), {
                        fillOpacity: "",
                        lineStyle: "SOLID"
                    });
                    if ("SINGLE_PIXEL" === e.lineStyle ? r.lineWidth = "1" : e.hasOwnProperty("lineStyle") ? r.lineStyle = e.lineStyle : delete r.lineStyle,
                    r.hasOwnProperty("lineWidth") || (r.lineWidth = ""),
                    r.hasOwnProperty("lineOpacity") || (r.lineOpacity = ""),
                    r.hasOwnProperty("pointOpacity") || (r.pointOpacity = ""),
                    r.hasOwnProperty("colorLatex") || (r.colorLatex = ""),
                    "string" == typeof e.latex && (r.latex = f(e.latex)),
                    e.latex && (r.latex = f(e.latex)),
                        e.hasOwnProperty("stringFillOpacity") ? r.fillOpacity = e.stringFillOpacity : e.hasOwnProperty("fillOpacity") ? r.fillOpacity = e.fillOpacity + "" : delete r.fillOpacity,
                    r.slider && e.slider && e.slider.newLoopMode && (r.slider = c.default(r.slider),
                        r.slider.loopMode = e.slider.newLoopMode,
                        delete r.slider.newLoopMode),
                    r.residualVariable && (r.residualVariable = l(r.residualVariable)),
                        r.regressionParameters)
                        for (var a in r.regressionParameters = {},
                            e.regressionParameters) {
                            var o = l(a)
                                , s = e.regressionParameters[a];
                            r.regressionParameters[o] = s
                        }
                    return e.clickableInfo && (r.clickableInfo = p(e.clickableInfo)),
                        r
                });
                return {
                    version: 8,
                    randomSeed: e.randomSeed || r.default(),
                    graph: e.graph,
                    expressions: {
                        list: t
                    }
                }
            }
    });
    _("core/graphing-calc/migrations/9", ["require", "exports", "core/lib/random-seed"], function(e, t, r) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.default = function(e) {
                if (8 !== e.version)
                    throw new Error("Unexpected version: " + e.version);
                var t = e.expressions.list.map(function(e) {
                    return e
                });
                return {
                    version: 9,
                    randomSeed: e.randomSeed || r.default(),
                    graph: e.graph,
                    expressions: {
                        list: t
                    }
                }
            }
    });
    _("core/graphing-calc/migrate-state", ["require", "exports", "./migrations/0", "./migrations/1", "./migrations/2", "./migrations/3", "./migrations/4", "core/graphing-calc/validate-state", "./migrations/back-migration", "./migrations/5", "./migrations/6", "./migrations/7", "./migrations/8", "./migrations/9"], function(e, t, r, n, i, a, o, s, u, c, l, p, f, h) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.migrateToPersisted = t.migrateToLatest = t.currentVersion = t.persistedVersion = void 0;
        var d = [r, n, i, a, o, c.migrateState, l.migrateState, p.default, f.default, h.default];
        function m(e) {
            if (e.version > t.currentVersion)
                return "undefined" != typeof console && console.warn && console.warn("Loading saved state with version " + e.version + " but last known version is " + t.currentVersion + ". States saved in a newer version of the calculator may not load correctly in an older version of the calculator."),
                    s.validateState(e);
            if (e.hasOwnProperty("version") && !d[e.version])
                return "undefined" != typeof console && console.warn && console.warn("State has invalid version " + e.version + ". If a version is present, it should be a non-negative integer less than or equal to " + t.currentVersion + "."),
                    s.validateState(e);
            for (e.hasOwnProperty("version") || (e = d[0](e)); e.version < t.currentVersion; )
                e = d[e.version + 1](e);
            return s.validateState(e)
        }
        t.persistedVersion = 8,
            t.currentVersion = 9,
            t.migrateToLatest = m,
            t.migrateToPersisted = function(e) {
                return u.default(m(e))
            }
    });
    _("core/graphing-calc/json/table", ["require", "exports", "tslib", "core/lib/default-spec", "core/types/styles", "core/lib/dragmode"], function(e, r, n, t, i, a) {
        "use strict";
        Object.defineProperty(r, "__esModule", {
            value: !0
        }),
            r.computeParsableState = r.stripDefaults = r.inflateDefaults = r.COLUMN_DEFAULTS = r.DEFAULTS = void 0,
            r.DEFAULTS = {
                folderId: "",
                secret: !1,
                columns: []
            },
            r.COLUMN_DEFAULTS = {
                latex: "",
                color: "",
                hidden: !1,
                values: [],
                points: !0,
                lines: !1,
                dragMode: a.DragMode.NONE,
                pointStyle: i.PointStyle.POINT,
                lineStyle: i.LineStyle.SOLID,
                colorLatex: ""
            },
            r.inflateDefaults = function(e) {
                var t = n.__assign(n.__assign({}, r.DEFAULTS), e);
                return t.columns = t.columns.map(function(e) {
                    return n.__assign(n.__assign({}, r.COLUMN_DEFAULTS), e)
                }),
                    t
            }
            ,
            r.stripDefaults = function(e) {
                return e = n.__assign(n.__assign({}, e), {
                    columns: e.columns.map(function(e) {
                        return t.stripDefaults(r.COLUMN_DEFAULTS, e)
                    })
                }),
                    t.stripDefaults(r.DEFAULTS, e)
            }
            ,
            r.computeParsableState = function(t) {
                return {
                    type: "table",
                    id: t.id,
                    columns: t.columns.map(function(e) {
                        return n.__assign(n.__assign({}, e), {
                            tableId: t.id
                        })
                    })
                }
            }
    });
    _("core/graphing-calc/json/simulation", ["require", "exports", "tslib", "core/lib/default-spec", "core/lib/copy-properties"], function(e, n, t, i, r) {
        "use strict";
        function a(e) {
            return r.extractPropertiesLike(e, n.DEFAULTS_DYNAMIC)
        }
        Object.defineProperty(n, "__esModule", {
            value: !0
        }),
            n.computeParsableState = n.extractDynamicProperties = n.stripDefaults = n.inflateDefaults = n.DEFAULTS = n.DEFAULTS_DYNAMIC = n.CLICKABLEINFO_DEFAULTS = void 0,
            n.CLICKABLEINFO_DEFAULTS = {
                enabled: !0,
                description: "",
                rules: [{
                    id: "1",
                    expression: "",
                    assignment: ""
                }]
            },
            n.DEFAULTS_DYNAMIC = {
                clickableInfo: n.CLICKABLEINFO_DEFAULTS,
                fps: ""
            },
            n.DEFAULTS = t.__assign({
                folderId: "",
                secret: !1,
                isPlaying: !1
            }, n.DEFAULTS_DYNAMIC),
            n.inflateDefaults = function(e) {
                return t.__assign(t.__assign(t.__assign({}, n.DEFAULTS), e), {
                    clickableInfo: t.__assign(t.__assign({}, n.CLICKABLEINFO_DEFAULTS), e.clickableInfo)
                })
            }
            ,
            n.stripDefaults = function(e) {
                var t = i.stripDefaults(n.DEFAULTS, e)
                    , r = i.stripDefaultsAndMaybeReturnUndefined(n.CLICKABLEINFO_DEFAULTS, e.clickableInfo);
                return void 0 === r ? delete t.clickableInfo : t.clickableInfo = r,
                    t
            }
            ,
            n.extractDynamicProperties = a,
            n.computeParsableState = function(e) {
                return t.__assign(t.__assign({
                    type: "simulation",
                    id: e.id
                }, a(e)), {
                    guid: "",
                    index: 0
                })
            }
    });
    _("core/cl-calculator", ["require", "exports", "core/graphing-calc/migrate-state", "core/graphing-calc/json/expression", "core/graphing-calc/json/table", "core/graphing-calc/json/simulation"], function(e, t, u, c, l, p) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.CLCalculator = void 0,
            t.CLCalculator = function(e) {
                var t = u.migrateToLatest(e)
                    , i = {}
                    , r = t.graph.degreeMode
                    , n = t.randomSeed;
                function a(e) {
                    switch (e.type) {
                        case void 0:
                        case "expression":
                            var t = c.computeParsableState(c.inflateDefaults(e));
                            i[t.id] = t;
                            break;
                        case "table":
                            var r = l.computeParsableState(l.inflateDefaults(e));
                            i[r.id] = r;
                            break;
                        case "simulation":
                            var n = p.computeParsableState(p.inflateDefaults(e));
                            i[n.id] = n;
                            break;
                        case "folder":
                        case "text":
                        case "image":
                            break;
                        default:
                            return e
                    }
                }
                for (var o = 0, s = t.expressions.list; o < s.length; o++) {
                    a(s[o])
                }
                return {
                    setExpression: function(e) {
                        a(e)
                    },
                    getChangeSet: function() {
                        return {
                            statements: i,
                            isCompleteState: !0,
                            degreeMode: r,
                            globalRandomSeed: n
                        }
                    }
                }
            }
    });
    _("core/math/tree-queries/count-numbers", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.countNumbers = void 0,
            t.countNumbers = function e(t, r) {
                switch (t.type) {
                    case "Mul":
                    case "Div":
                    case "Prime":
                    case "Call":
                    case "ImplicitCall":
                    case "Dot":
                    case "Pipes":
                    case "Sqrt":
                    case "Nthroot":
                    case "Frac":
                    case "Derivative":
                    case "Integral":
                    case "EmptyIntegral":
                    case "Sum":
                    case "Product":
                    case "Piecewise":
                    case "Paren":
                    case "Juxt":
                    case "Superscript":
                    case "Bang":
                    case "Index":
                    case "Equals":
                    case "Inequality":
                    case "Tilde":
                    case "Pos":
                    case "Neg":
                    case "Add":
                    case "Sub":
                    case "List":
                    case "Seq":
                    case "Colon":
                    case "Ellipsis":
                    case "PercentOf":
                        for (var n = 0, i = 0, a = t.args; i < a.length; i++)
                            n += e(a[i], r);
                        return n;
                    case "Decimal":
                        return void 0 === r || parseFloat(t.val) === r ? 1 : 0;
                    case "MixedNumber":
                        return void 0 === r ? 3 : (n = 0,
                        parseFloat(t.whole) === r && (n += 1),
                        parseFloat(t.num) === r && (n += 1),
                        parseFloat(t.den) === r && (n += 1),
                            n);
                    case "Letter":
                    case "EmptyPiecewise":
                    case "Cmd":
                    case "EmptyRangeEnd":
                        return 0;
                    case "Subscript":
                        return e(t.args[0], r);
                    case "InequalityChain":
                        n = 0,
                            n += e(t.first, r);
                        for (var o = 0, s = t.chain; o < s.length; o++)
                            n += e(s[o].args[0], r);
                        return n;
                    default:
                        throw "Unexpected surface node " + t.type + "."
                }
            }
    });
    _("core/graphing-calc/diffs/longest-subsequence", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.findLongestSubsequence = void 0,
            t.findLongestSubsequence = function(e) {
                for (var t = e.length, r = new Array(t), n = new Array(t + 1), i = 0, a = 0; a < t; a++) {
                    var o = void 0;
                    if (e[n[i]] < e[a])
                        o = i + 1;
                    else {
                        for (var s = 1, u = i - 1; s <= u; ) {
                            var c = Math.ceil((s + u) / 2);
                            e[n[c]] < e[a] ? s = c + 1 : u = c - 1
                        }
                        o = s
                    }
                    r[a] = n[o - 1],
                        n[o] = a,
                    i < o && (i = o)
                }
                for (var l = new Array(i), p = n[i], a = i - 1; 0 <= a; a--)
                    l[a] = e[p],
                        p = r[p];
                return l
            }
    });
    _("core/graphing-calc/diffs/calculate-diff", ["require", "exports", "underscore", "./longest-subsequence"], function(e, t, d, m) {
        "use strict";
        var g, r;
        function y(e, t, r) {
            var n, i = {};
            for (var a in e) {
                e.hasOwnProperty(a) && (t.hasOwnProperty(a) ? (n = function(e, t, r, n) {
                    if (d.isArray(e) && d.isArray(t)) {
                        if (r === g.EXPRESSIONS && "list" === n || r === g.TABLE_EXPRESSION && "columns" === n)
                            return function(t, e) {
                                for (var r = {}, n = {}, i = 0; i < t.length; i++) {
                                    if (void 0 !== n[t[i].id])
                                        return {
                                            s: e
                                        };
                                    n[t[i].id] = i
                                }
                                for (var a = {}, i = 0; i < e.length; i++) {
                                    if (void 0 !== a[e[i].id])
                                        return {
                                            s: e
                                        };
                                    a[e[i].id] = i
                                }
                                for (var o = function(e, t, r) {
                                    for (var n = {}, i = t.filter(function(e) {
                                        return void 0 !== r[e.id]
                                    }).map(function(e) {
                                        return r[e.id]
                                    }), a = m.findLongestSubsequence(i), o = 0, s = a; o < s.length; o++) {
                                        var u = s[o];
                                        n[e[u].id] = !0
                                    }
                                    return n
                                }(t, e, n), s = 0, u = 0; u < t.length; u++) {
                                    var c, l, p, f, h = t[u];
                                    o[h.id] ? (c = a[h.id],
                                        l = e[c],
                                        p = {},
                                    s !== c && (p.a = e.slice(s, c).map(function(e) {
                                        return v(t, n, e)
                                    })),
                                    d.isEqual(h, l) || (f = "table" === h.type && "table" === l.type,
                                        p.e = y(h, l, f ? g.TABLE_EXPRESSION : g.OTHER)),
                                    d.isEmpty(p) || (r[u] = p),
                                        s = c + 1) : r[u] = {
                                        d: 1
                                    }
                                }
                                s < e.length && (r[t.length] = {
                                    a: e.slice(s, e.length).map(function(e) {
                                        return v(t, n, e)
                                    })
                                });
                                if (d.isEmpty(r))
                                    return;
                                return {
                                    l: r
                                }
                            }(e, t);
                        if (!d.isEqual(e, t))
                            return {
                                s: t
                            }
                    } else if (d.isObject(e) && d.isObject(t)) {
                        var i = y(e, t, function(e, t) {
                            return e === g.ROOT && "expressions" === t ? g.EXPRESSIONS : g.OTHER
                        }(r, n));
                        if (!d.isEmpty(i))
                            return {
                                e: i
                            }
                    } else if (!d.isEqual(e, t))
                        return {
                            s: t
                        };
                    return
                }(e[a], t[a], r, a)) && (i[a] = n) : i[a] = {
                    d: 1
                })
            }
            for (var a in t)
                t.hasOwnProperty(a) && !e.hasOwnProperty(a) && (i[a] = {
                    s: t[a]
                });
            return i
        }
        function v(e, t, r) {
            if (t[r.id]) {
                var n = e[t[r.id]]
                    , i = {
                    f: t[r.id]
                };
                return d.isEqual(n, r) || (i.e = y(n, r, g.OTHER)),
                    {
                        m: i
                    }
            }
            return {
                s: r
            }
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.calculateDiff = void 0,
            (r = g = g || {})[r.ROOT = 0] = "ROOT",
            r[r.EXPRESSIONS = 1] = "EXPRESSIONS",
            r[r.TABLE_EXPRESSION = 2] = "TABLE_EXPRESSION",
            r[r.OTHER = 3] = "OTHER",
            t.calculateDiff = function(e, t) {
                return y(e, t, g.ROOT)
            }
    });
    _("core/graphing-calc/diffs/apply-diff", ["require", "exports", "underscore", "../../lib/deepCopy"], function(e, t, o, r) {
        "use strict";
        function s(e, t) {
            for (var r = 0, n = o.keys(t); r < n.length; r++) {
                var i = n[r]
                    , a = t[i];
                a.hasOwnProperty("s") ? e[i] = a.s : a.hasOwnProperty("d") ? delete e[i] : a.hasOwnProperty("l") ? e[i] = function(e, t) {
                    for (var r = [], n = 0; n < e.length; n++) {
                        var i = t[n];
                        i && i.a && r.push.apply(r, u(e, i.a)),
                            i && i.e ? r.push(s(e[n], i.e)) : i && i.d || r.push(e[n])
                    }
                    var a = t[e.length];
                    a && a.a && r.push.apply(r, u(e, a.a));
                    return r
                }(e[i], a.l) : a.hasOwnProperty("e") && (e[i] = s(e[i], a.e))
            }
            return e
        }
        function u(e, t) {
            for (var r = [], n = 0, i = t; n < i.length; n++) {
                var a, o = i[n];
                o.hasOwnProperty("s") ? r.push(o.s) : o.hasOwnProperty("m") && (a = e[o.m.f],
                    o.m.e ? r.push(s(a, o.m.e)) : r.push(a))
            }
            return r
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.applyDiff = void 0,
            t.applyDiff = function(e, t) {
                return s(r.default(e), t)
            }
    });
    _("core/graphing-calc/translation/common", ["require", "exports"], function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.mutateString = t.deserializeTranslationKey = t.serializeTranslationKey = void 0,
            t.serializeTranslationKey = function(e) {
                return "expression" === e.location || "object" === e.location ? e.location + ":" + e.id + ":" + e.path : e.location + ":" + e.path
            }
            ,
            t.deserializeTranslationKey = function(e) {
                function t() {
                    return new Error("Invalid key: " + e)
                }
                var r = e.split(":")
                    , n = r[0];
                if (!n)
                    throw t();
                if ("expression" != n && "settings" != n && "object" != n)
                    throw t();
                if ("settings" == n) {
                    if (2 != r.length)
                        throw t();
                    return {
                        location: n,
                        path: r[1]
                    }
                }
                if (3 != r.length)
                    throw t();
                return {
                    location: n,
                    id: r[1],
                    path: r[2]
                }
            }
            ,
            t.mutateString = function(e, t, r) {
                if (e)
                    for (var n = t.split("."), i = e, a = 0; a < n.length; a++) {
                        var o = n[a];
                        if (!i[o])
                            break;
                        a == n.length - 1 && "string" == typeof i[o] ? i[o] = r : i = i[o]
                    }
            }
    });
    _("core/graphing-calc/translation/translator", ["require", "exports", "tslib", "../../lib/deepCopy", "./common"], function(e, t, s, f, h) {
        "use strict";
        function g(a, o) {
            return function(e, t, r, n) {
                var i;
                e && (i = h.serializeTranslationKey(s.__assign(s.__assign({}, o), {
                    path: t
                })),
                    a[i] = {
                        value: e,
                        type: r,
                        context: n
                    })
            }
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.applyLocalizationMap = t.extractLocalizationMap = void 0,
            t.extractLocalizationMap = function(e) {
                var t, r, n, i, a, o, s = {};
                if ("graph" == e.type) {
                    for (var u = 0, c = e.graphState.expressions.list; u < c.length; u++) {
                        var l = function(e) {
                            var t, r, n, i, a = {}, o = g(a, {
                                location: "expression",
                                id: e.id
                            });
                            switch (e.type) {
                                case "expression":
                                    o(e.label, "label", "string", "expression-list-expression-label"),
                                        o(null === (t = e.clickableInfo) || void 0 === t ? void 0 : t.description, "clickableInfo.description", "string", "expression-list-expression-clickable-description");
                                    break;
                                case "image":
                                    o(e.image_url, "image_url", "image", "expression-list-image-url"),
                                        o(null === (r = e.clickableInfo) || void 0 === r ? void 0 : r.description, "clickableInfo.description", "string", "expression-list-image-clickable-description"),
                                        o(null === (n = e.clickableInfo) || void 0 === n ? void 0 : n.hoveredImage, "clickableInfo.hoveredImage", "image", "expression-list-image-clickable-hovered"),
                                        o(null === (i = e.clickableInfo) || void 0 === i ? void 0 : i.depressedImage, "clickableInfo.depressedImage", "image", "expression-list-image-clickable-depressed");
                                    break;
                                case "text":
                                    o(e.text, "text", "string", "expression-list-note-text");
                                    break;
                                case "folder":
                                    o(e.title, "title", "string", "expression-list-folder-title")
                            }
                            return a
                        }(c[u]);
                        for (var p in l)
                            s[p] = l[p]
                    }
                    var f = (i = e.graphState,
                        (o = g(a = {}, {
                            location: "settings"
                        }))(i.graph.xAxisLabel, "xAxisLabel", "string", "settings-xaxis-label"),
                        o(i.graph.yAxisLabel, "yAxisLabel", "string", "settings-yaxis-label"),
                        a);
                    for (var p in f)
                        s[p] = f[p]
                } else {
                    var h = e.geometryState.objects;
                    for (var d in h) {
                        var m = (t = h[d],
                            n = r = void 0,
                            (n = g(r = {}, {
                                location: "object",
                                id: t.id
                            }))(t.label, "label", "string", "geometry-object-label"),
                        "image" === t.type && n(t.url, "url", "image", "geometry-object-image-url"),
                            r);
                        for (var p in m)
                            s[p] = m[p]
                    }
                }
                return s
            }
            ,
            t.applyLocalizationMap = function(e, t, r) {
                var n, i, a = f.default(e);
                if ("graph" === r) {
                    for (var o, s = {}, u = 0, c = null !== (i = null === (n = a.expressions) || void 0 === n ? void 0 : n.list) && void 0 !== i ? i : []; u < c.length; u++) {
                        var l = c[u];
                        s[l.id] = l
                    }
                    for (var p in t) {
                        "expression" == (o = h.deserializeTranslationKey(p)).location ? h.mutateString(s[o.id], o.path, t[p].value) : h.mutateString(a.graph, o.path, t[p].value)
                    }
                } else if (a.objects)
                    for (var p in t) {
                        "object" == (o = h.deserializeTranslationKey(p)).location && h.mutateString(a.objects[o.id], o.path, t[p].value)
                    }
                return a
            }
    });
    _("core/mathtools", ["require", "exports", "parser", "core/math/builtinframe", "parsenodes", "core/math/context", "core/cl-calculator", "core/math/parser/latex-parser", "core/math/parser/expression-parser", "core/math/tree-queries/count-numbers", "core/lib/color-helpers", "core/math/policyGraphing", "core/math/policyScientific", "core/math/policyFourFunction", "core/lib/label", "core/graphing-calc/diffs/calculate-diff", "core/graphing-calc/diffs/apply-diff", "core/graphing-calc/migrate-state", "core/math/types", "core/graphing-calc/translation/translator"], function(e, t, r, n, i, a, o, s, u, c, l, p, f, h, d, m, g, y, v, b) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        }),
            t.applyLocalizationMap = t.extractLocalizationMap = t.migrateToLatest = t.applyDiff = t.calculateDiff = t.CLCalculator = t.colorHelpers = t.policies = t.parseNodes = t.types = t.builtInFrame = t.context = t.treeQueries = t.expressionParser = t.parser = t.Label = void 0,
            Object.defineProperty(t, "CLCalculator", {
                enumerable: !0,
                get: function() {
                    return o.CLCalculator
                }
            }),
            t.colorHelpers = l,
            t.Label = d,
            Object.defineProperty(t, "calculateDiff", {
                enumerable: !0,
                get: function() {
                    return m.calculateDiff
                }
            }),
            Object.defineProperty(t, "applyDiff", {
                enumerable: !0,
                get: function() {
                    return g.applyDiff
                }
            }),
            Object.defineProperty(t, "migrateToLatest", {
                enumerable: !0,
                get: function() {
                    return y.migrateToLatest
                }
            }),
            Object.defineProperty(t, "extractLocalizationMap", {
                enumerable: !0,
                get: function() {
                    return b.extractLocalizationMap
                }
            }),
            Object.defineProperty(t, "applyLocalizationMap", {
                enumerable: !0,
                get: function() {
                    return b.applyLocalizationMap
                }
            }),
            t.parser = {
                parse: function(e, t) {
                    return null == e && (e = ""),
                        r.parse(e, t)
                }
            },
            t.expressionParser = {
                parse: function(e) {
                    if (null != e)
                        return u.parse(s.parse(e))
                }
            },
            t.treeQueries = {
                countNumbers: c.countNumbers
            },
            t.context = a.Context,
            t.builtInFrame = n,
            t.types = v,
            t.parseNodes = i,
            t.policies = {
                graphing: p.PolicyGraphing,
                scientific: f.PolicyScientific,
                fourFunction: h.PolicyFourFunction
            }
    });
    return t("core/mathtools")
});
define("core/lib/simpleevaluator", ["require", "exports", "underscore", "core/lib/mathtools"], function(require, exports, _, mathtools) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var SimpleEvaluator = function() {
        function SimpleEvaluator() {
            this.cache = {};
            this.context = new mathtools.context
        }
        SimpleEvaluator.prototype.analyze = function(latex, vars) {
            if (vars === void 0) {
                vars = {}
            }
            var cacheKey = this.cacheKey(latex, vars);
            if (!!this.cache[cacheKey]) {
                return this.cache[cacheKey]
            }
            var statements = {};
            var statementCount = 0;
            var safeLatex = typeof latex == "string" ? latex : "";
            statements["" + statementCount] = {
                id: "" + statementCount,
                latex: safeLatex
            };
            statementCount++;
            for (var i in vars) {
                if (vars.hasOwnProperty(i)) {
                    statements["" + statementCount] = {
                        id: "" + statementCount,
                        latex: i + " = " + vars[i]
                    };
                    statementCount++
                }
            }
            var results = this.context.processChangeSet({
                isCompleteState: true,
                statements: statements
            });
            var response = results.statusChanges[0];
            if (!response) {
                response = {
                    error: "Unable to analyze."
                }
            }
            this.cache[cacheKey] = response;
            return response
        }
        ;
        SimpleEvaluator.prototype.cacheKey = function(latex, vars) {
            return JSON.stringify(vars) + latex
        }
        ;
        SimpleEvaluator.prototype.evaluate = function(latex, vars) {
            var analysis = this.analyze(latex, vars);
            if (analysis.error) {
                return new Error(analysis.error)
            } else if (_.isNumber(analysis.constant_value)) {
                return analysis.constant_value
            } else {
                return new Error("unknown error")
            }
        }
        ;
        SimpleEvaluator.prototype.isEvaluable = function(latex, vars) {
            return !!this.analyze(latex, vars).is_evaluable
        }
        ;
        return SimpleEvaluator
    }();
    exports.SimpleEvaluator = SimpleEvaluator
});
define("core/lib/evaluator-helpers", ["require", "exports", "./simpleevaluator", "./log"], function(require, exports, simpleevaluator_1, log_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _trimLatex = function(latex) {
        latex = latex.replace(/(.*?)([\\ ]*)$/, "$1");
        latex = latex.replace(/(.*?)([a-z]+)([\\ ]*)$/, "$1");
        latex = latex.replace(/(.*?)([a-z]+)\^([\d\-\.]+)$/, "$1");
        latex = latex.replace(/(.*?)\\frac\{([a-z]+)\}\{([a-z]+)\}$/, "$1");
        latex = latex.replace(/^\\\$/, "");
        return latex
    };
    exports.evaluateRawLatex = function(latex, evaluator) {
        if (latex && typeof latex != "string") {
            log_1.err("evaluateRawLatex", "Expected latex to be string | undefined but it was " + typeof latex)
        }
        if (!latex || typeof latex != "string") {
            return undefined
        }
        var numericValue = evaluator.evaluate(latex);
        if (typeof numericValue != "number" || !isFinite(numericValue)) {
            latex = _trimLatex(latex);
            numericValue = evaluator.evaluate(latex)
        }
        if (typeof numericValue != "number" || !isFinite(numericValue)) {
            latex = _trimLatex(latex);
            if (latex.match(/^-?\d{1,3}(,\d\d\d)*(\.\d+)?$/)) {
                latex = latex.replace(/,/g, "")
            }
            numericValue = evaluator.evaluate(latex)
        }
        if (typeof numericValue != "number" || !isFinite(numericValue)) {
            return undefined
        }
        return numericValue
    }
    ;
    var evaluator = undefined;
    function computeNumericValueFromLatex(latex) {
        if (latex === undefined)
            return NaN;
        evaluator = evaluator || new simpleevaluator_1.SimpleEvaluator;
        var value = exports.evaluateRawLatex(latex, evaluator);
        return value == null ? NaN : value
    }
    exports.computeNumericValueFromLatex = computeNumericValueFromLatex
});
define("core/computation-layer/library/patterns.matching", ["require", "exports", "tslib", "core/lib/assert-unreachable", "core/lib/mathtools", "core/lib/evaluator-helpers"], function(require, exports, tslib_1, assert_unreachable_1, mathtools_1, evaluator_helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function matchPattern(pattern, tree, parentOptions) {
        if (!pattern || !tree) {
            return undefined
        }
        if (tree.type == "Err") {
            return undefined
        }
        var options = updateOptions(parentOptions, pattern);
        var latex = stringFromSpan(tree.span);
        while (tree.type == "Paren") {
            if (options.rejectParens)
                return undefined;
            tree = tree.args[0]
        }
        switch (pattern.type) {
            case "number":
                return matchNumberPattern(pattern, latex, tree);
            case "sum":
                return matchSumPattern(pattern, latex, tree, options);
            case "exponent":
                return matchExponentPattern(pattern, latex, tree, options);
            case "fraction":
                return matchFractionPattern(pattern, latex, tree, options);
            case "negative":
                return matchNegativePattern(pattern, latex, tree, options);
            case "radical":
                return matchRadicalPattern(pattern, latex, tree, options);
            case "difference":
                return matchDifferencePattern(pattern, latex, tree, options);
            case "product":
                return matchProductPattern(pattern, latex, tree, options);
            case "contains":
                return matchContainsPattern(pattern, latex, tree, options);
            case "literal":
                return matchLiteralPattern(pattern, latex, tree);
            case "expression":
                return matchExpressionPattern(pattern, latex, tree);
            case "or":
                return matchOrPattern(pattern, latex, tree, options);
            case "scientific":
                return matchScientificPattern(pattern, latex, tree);
            case "mixedNumber":
                return matchMixedNumberPattern(pattern, latex, tree);
            default:
                throw assert_unreachable_1.assertUnreachable(pattern)
        }
    }
    exports.matchPattern = matchPattern;
    function stringFromSpan(span) {
        return span.input.slice(span.start, span.end)
    }
    function nodesEquivalent(a, b) {
        var A = JSON.stringify(a, function(k, v) {
            return k == "span" ? undefined : v
        });
        var B = JSON.stringify(b, function(k, v) {
            return k == "span" ? undefined : v
        });
        return A == B
    }
    function matchTermsToPatterns(terms, patterns, options) {
        var matches = [];
        for (var patternIdx = 0; patternIdx < patterns.length; patternIdx++) {
            var patternToMatch = patterns[patternIdx];
            if (patternToMatch.type == "repeated") {
                var localMatches = {
                    type: "repeated",
                    matches: []
                };
                var min = patternToMatch.min || 0;
                var max = patternToMatch.max || Infinity;
                for (var termIdx = 0; termIdx < terms.length; termIdx++) {
                    var termToMatch = terms[termIdx];
                    var match = matchPattern(patternToMatch.pattern, termToMatch, options);
                    if (match) {
                        terms.splice(termIdx, 1);
                        termIdx--;
                        localMatches.matches.push(match);
                        if (localMatches.matches.length >= max) {
                            break
                        }
                    } else if (options.strictOrder) {
                        break
                    }
                }
                if (localMatches.matches.length < min)
                    return undefined;
                matches.push(localMatches)
            } else {
                var matched = false;
                for (var termIdx = 0; termIdx < terms.length; termIdx++) {
                    var termToMatch = terms[termIdx];
                    var match = matchPattern(patternToMatch, termToMatch, options);
                    if (match) {
                        matched = true;
                        terms.splice(termIdx, 1);
                        matches.push(match);
                        break
                    }
                    if (options.strictOrder)
                        break
                }
                if (!matched)
                    return undefined
            }
        }
        if (terms.length > 0) {
            return undefined
        }
        return matches
    }
    function extractSumTerms(tree, options) {
        if (tree.type == "Paren" && !options.rejectParens) {
            return extractSumTerms(tree.args[0], options)
        }
        if (tree.type == "Add") {
            return tslib_1.__spreadArrays(extractSumTerms(tree.args[0], options), extractSumTerms(tree.args[1], options))
        }
        return [tree]
    }
    function extractSumPatterns(pattern) {
        var args = [];
        for (var _i = 0, _a = unstubTerms(pattern.terms) || []; _i < _a.length; _i++) {
            var term = _a[_i];
            if (term.type == "sum") {
                args.push.apply(args, extractSumPatterns(term))
            } else {
                args.push(term)
            }
        }
        return args
    }
    function extractProductTerms(tree) {
        if (tree.type == "Paren") {
            return extractProductTerms(tree.args[0])
        }
        if (tree.type == "Mul") {
            return tslib_1.__spreadArrays(extractProductTerms(tree.args[0]), extractProductTerms(tree.args[1]))
        }
        if (tree.type == "Juxt") {
            return tslib_1.__spreadArrays(extractProductTerms(tree.args[0]), extractProductTerms(tree.args[1]))
        }
        return [tree]
    }
    function extractProductPatterns(pattern) {
        var args = [];
        for (var _i = 0, _a = pattern.terms || []; _i < _a.length; _i++) {
            var term = _a[_i];
            if (term.type == "product") {
                args.push.apply(args, extractProductPatterns(term))
            } else {
                args.push(term)
            }
        }
        return args
    }
    function matchSumPattern(pattern, latex, tree, options) {
        if (!tree)
            return undefined;
        var terms = matchTermsToPatterns(extractSumTerms(tree, options), extractSumPatterns(pattern), tslib_1.__assign(tslib_1.__assign({}, options), {
            strictOrder: !!pattern.strictOrder
        }));
        return terms ? {
            type: "sum",
            latex: latex,
            terms: stubPatternMatches(terms)
        } : undefined
    }
    function matchProductPattern(pattern, latex, tree, options) {
        if (!tree)
            return undefined;
        var terms = matchTermsToPatterns(extractProductTerms(tree), extractProductPatterns(pattern), tslib_1.__assign(tslib_1.__assign({}, options), {
            strictOrder: !!pattern.strictOrder
        }));
        return terms ? {
            type: "product",
            latex: latex,
            terms: stubPatternMatches(terms)
        } : undefined
    }
    function matchContainsPattern(pattern, latex, tree, options) {
        var match = findPatternWithinTree(unstubPattern(pattern.terms[0]), tree, options);
        return match ? {
            type: "contains",
            latex: latex,
            terms: [stubPatternMatch(match)]
        } : undefined
    }
    function findPatternWithinTree(pattern, tree, options) {
        if (tree == undefined)
            return undefined;
        var match = matchPattern(pattern, tree, options);
        if (match)
            return match;
        if (tree.type == "Letter" || tree.type == "Decimal" || tree.type == "MixedNumber" || tree.type === "EmptyRangeEnd") {
            return
        }
        if (tree.type == "InequalityChain" || tree.type == "EmptyPiecewise" || tree.type == "Cmd") {
            return
        } else {
            for (var _i = 0, _a = tree.args || []; _i < _a.length; _i++) {
                var subtree = _a[_i];
                if (subtree.type == "Alphanumeric")
                    return;
                var match_1 = findPatternWithinTree(pattern, subtree, options);
                if (match_1)
                    return match_1
            }
        }
        return undefined
    }
    function matchOrPattern(pattern, latex, tree, options) {
        for (var _i = 0, _a = pattern.options; _i < _a.length; _i++) {
            var option = _a[_i];
            if (matchPattern(unstubPattern(option), tree, options)) {
                return {
                    type: "or",
                    latex: latex
                }
            }
        }
        return undefined
    }
    function matchNumberPattern(pattern, latex, tree) {
        if (tree.type == "Neg") {
            tree = tree.args[0]
        }
        if (tree.type == "Decimal" || tree.type == "MixedNumber") {
            if (pattern.integerOnly || pattern.conditions) {
                var value = evaluator_helpers_1.computeNumericValueFromLatex(latex);
                if (pattern.integerOnly && value % 1 != 0)
                    return undefined;
                if (pattern.conditions) {
                    for (var _i = 0, _a = pattern.conditions; _i < _a.length; _i++) {
                        var condition = _a[_i];
                        var ctx = new mathtools_1.context;
                        ctx.processChangeSet({
                            statements: [{
                                id: "condition",
                                latex: "f(x)=\\{" + condition + "\\}"
                            }]
                        });
                        var probe = mathtools_1.parser.parse("f(" + latex + ")");
                        var concrete = probe.tryGetConcreteTree(mathtools_1.policies.graphing, ctx.frame);
                        var out = concrete.asValue();
                        if (out != 1)
                            return undefined
                    }
                }
            }
            return {
                type: "number",
                latex: latex
            }
        }
        return undefined
    }
    function matchExponentPattern(pattern, latex, tree, options) {
        if (tree.type == "Superscript") {
            var base = matchPattern(unstubPattern(pattern.base), tree.args[0], options);
            var power = matchPattern(unstubPattern(pattern.power), tree.args[1], options);
            return base && power ? {
                type: "exponent",
                base: stubPatternMatch(base),
                power: stubPatternMatch(power),
                latex: latex
            } : undefined
        }
        return undefined
    }
    function matchFractionPattern(pattern, latex, tree, options) {
        if (tree.type == "Frac") {
            var numerator = matchPattern(unstubPattern(pattern.numerator), tree.args[0], options);
            var denominator = matchPattern(unstubPattern(pattern.denominator), tree.args[1], options);
            return numerator && denominator ? {
                type: "fraction",
                numerator: stubPatternMatch(numerator),
                denominator: stubPatternMatch(denominator),
                latex: latex
            } : undefined
        }
        return undefined
    }
    function matchRadicalPattern(pattern, latex, tree, options) {
        if (pattern.degree) {
            if (tree.type != "Nthroot")
                return undefined;
            var degree = matchPattern(unstubPattern(pattern.degree), tree.args[0], options);
            var radicand = matchPattern(unstubPattern(pattern.radicand), tree.args[1], options);
            return radicand && degree ? {
                type: "radical",
                latex: latex,
                radicand: stubPatternMatch(radicand),
                degree: stubPatternMatch(degree)
            } : undefined
        } else {
            if (tree.type != "Sqrt")
                return undefined;
            var radicand = matchPattern(unstubPattern(pattern.radicand), tree.args[0], options);
            return radicand ? {
                type: "radical",
                latex: latex,
                radicand: stubPatternMatch(radicand)
            } : undefined
        }
    }
    function matchNegativePattern(pattern, latex, tree, options) {
        if (tree.type != "Neg")
            return undefined;
        var negated = matchPattern(unstubPattern(pattern.negated), tree.args[0], options);
        return negated ? {
            type: "negative",
            latex: latex,
            negated: stubPatternMatch(negated)
        } : undefined
    }
    function matchDifferencePattern(pattern, latex, tree, options) {
        if (tree.type == "Sub") {
            var minuend = matchPattern(unstubPattern(pattern.minuend), tree.args[0], options);
            var subtrahend = matchPattern(unstubPattern(pattern.subtrahend), tree.args[1], options);
            return subtrahend && minuend ? {
                type: "difference",
                subtrahend: stubPatternMatch(subtrahend),
                minuend: stubPatternMatch(minuend),
                latex: latex
            } : undefined
        }
        return undefined
    }
    function latexEqual(latex1, latex2) {
        var parsed1 = mathtools_1.expressionParser.parse(latex1);
        var parsed2 = mathtools_1.expressionParser.parse(latex2);
        if (parsed1.type == "Err" || parsed2.type == "Err") {
            return false
        }
        return nodesEquivalent(parsed1, parsed2)
    }
    exports.latexEqual = latexEqual;
    function matchLiteralPattern(pattern, latex, tree) {
        var parsedTarget = mathtools_1.expressionParser.parse(pattern.text);
        if (parsedTarget.type == "Err") {
            return undefined
        }
        if (nodesEquivalent(parsedTarget, tree)) {
            return {
                type: "literal",
                latex: latex
            }
        }
        return undefined
    }
    function matchExpressionPattern(_pattern, latex, tree) {
        if (tree.type == "Err")
            return undefined;
        return {
            type: "expression",
            latex: latex
        }
    }
    function matchMantissa(tree) {
        var sign = 1;
        if (tree.type == "Neg") {
            tree = tree.args[0];
            sign = -1
        }
        if (tree.type != "Decimal")
            return undefined;
        var n = parseFloat(stringFromSpan(tree.span));
        if (n < 1)
            return undefined;
        if (n >= 10)
            return undefined;
        return n * sign
    }
    function matchMixedNumberPattern(_pattern, latex, tree) {
        if (tree.type != "MixedNumber")
            return undefined;
        return {
            type: "mixedNumber",
            latex: latex,
            whole: +tree.whole,
            numerator: +tree.num,
            denominator: +tree.den
        }
    }
    function matchScientificPattern(_pattern, latex, tree) {
        if (tree.type != "Mul")
            return undefined;
        var pow = tree.args[1];
        if (pow.type != "Superscript")
            return undefined;
        var mantissa = matchMantissa(tree.args[0]);
        if (mantissa == undefined)
            return undefined;
        var base = pow.args[0];
        if (base.type != "Decimal")
            return undefined;
        if (parseFloat(stringFromSpan(base.span)) != 10)
            return undefined;
        var exp = pow.args[1];
        var expSign = 1;
        if (exp.type == "Neg") {
            expSign = -1;
            exp = exp.args[0]
        }
        if (exp.type != "Decimal")
            return undefined;
        var expMag = parseFloat(stringFromSpan(exp.span));
        if (expMag != Math.round(expMag))
            return undefined;
        return {
            type: "scientific",
            latex: latex,
            coefficient: mantissa,
            exponent: expMag * expSign
        }
    }
    function updateOptions(parentOptions, pattern) {
        var locallySetOptions = {};
        if ("rejectParens"in pattern) {
            locallySetOptions.rejectParens = !!pattern.rejectParens
        }
        if ("strictOrder"in pattern) {
            locallySetOptions.strictOrder = !!pattern.strictOrder
        }
        return tslib_1.__assign(tslib_1.__assign({}, parentOptions), locallySetOptions)
    }
    function stubPatternMatch(patternMatch) {
        return patternMatch
    }
    function stubPatternMatches(patternMatches) {
        return patternMatches
    }
    function unstubTerms(terms) {
        return terms
    }
    function unstubPattern(pattern) {
        return pattern
    }
});
define("core/computation-layer/library/builtin", ["require", "exports", "underscore", "core/lib/i18n", "../helpers", "./patterns.matching", "core/computation-layer/cl-types"], function(require, exports, _, i18n_1, helpers_1, patterns_matching_1, cl_types_1) {
    "use strict";
    var _a, _b;
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.STRING_CONCAT_FN_NAME = "stringConcat";
    exports.STRING_INTERP_FN_NAME = "stringInterpolation";
    exports.INTERPOLATE_FN_NAME = "interpolate";
    exports.library = {
        functions: (_a = {
            copy: {
                internal: true,
                version: "v2",
                description: function() {
                    return i18n_1.EMPTY
                },
                lookup: function(spec) {
                    if (spec.length !== 1) {
                        throw Error("Copy function only accepts one argument")
                    }
                    return {
                        valueType: spec[0].type,
                        body: function(x) {
                            return x
                        }
                    }
                }
            }
        },
            _a[exports.STRING_CONCAT_FN_NAME] = {
                internal: true,
                description: function() {
                    return i18n_1.EMPTY
                },
                version: "v2",
                lookup: function(argSpecs) {
                    for (var _i = 0, argSpecs_1 = argSpecs; _i < argSpecs_1.length; _i++) {
                        var spec = argSpecs_1[_i];
                        if (!(cl_types_1.Types.string.matches(spec.type) || cl_types_1.Types.number.matches(spec.type) || cl_types_1.Types.latex.matches(spec.type))) {
                            throw Error("Unexpected type in string: " + spec.type)
                        }
                    }
                    return {
                        valueType: cl_types_1.Types.string,
                        body: function() {
                            var args = [];
                            for (var _i = 0; _i < arguments.length; _i++) {
                                args[_i] = arguments[_i]
                            }
                            var parts = [];
                            for (var _a = 0, args_1 = args; _a < args_1.length; _a++) {
                                var arg = args_1[_a];
                                if (helpers_1.isCLStringType(arg)) {
                                    parts.push.apply(parts, arg.parts)
                                } else {
                                    parts.push(arg)
                                }
                            }
                            return {
                                type: "string",
                                parts: parts
                            }
                        }
                    }
                }
            },
            _a[exports.STRING_INTERP_FN_NAME] = {
                internal: true,
                description: function() {
                    return i18n_1.EMPTY
                },
                version: "v2",
                lookup: function(argSpecs) {
                    for (var _i = 0, argSpecs_2 = argSpecs; _i < argSpecs_2.length; _i++) {
                        var spec = argSpecs_2[_i];
                        if (!(cl_types_1.Types.string.matches(spec.type) || cl_types_1.Types.number.matches(spec.type))) {
                            throw Error("Unexpected type in " + exports.STRING_INTERP_FN_NAME + ": " + spec.type)
                        }
                    }
                    return {
                        valueType: cl_types_1.Types.partialInterpolation,
                        body: function() {
                            var args = [];
                            for (var _i = 0; _i < arguments.length; _i++) {
                                args[_i] = arguments[_i]
                            }
                            var parts = [];
                            for (var _a = 0, args_2 = args; _a < args_2.length; _a++) {
                                var arg = args_2[_a];
                                if (helpers_1.isCLStringType(arg)) {
                                    if (!(arg.parts.length == 1 && typeof arg.parts[0] == "string")) {
                                        throw new Error("stringInterpolation expects only plain strings")
                                    }
                                    parts.push(arg.parts[0])
                                } else if (typeof arg == "number") {
                                    if (arg < 0 || arg % 1 != 0) {
                                        throw new Error("stringInterpolation expects positive integers, but got " + arg)
                                    }
                                    parts.push(arg)
                                } else {
                                    throw new Error("Unexpected value in " + exports.STRING_INTERP_FN_NAME + ": " + arg)
                                }
                            }
                            return {
                                parts: parts
                            }
                        }
                    }
                }
            },
            _a.latexConcat = {
                internal: true,
                description: function() {
                    return i18n_1.EMPTY
                },
                version: "v2",
                lookup: function(argSpecs) {
                    for (var _i = 0, argSpecs_3 = argSpecs; _i < argSpecs_3.length; _i++) {
                        var spec = argSpecs_3[_i];
                        if (!(cl_types_1.Types.number.matches(spec.type) || cl_types_1.Types.latex.matches(spec.type))) {
                            throw Error("Unexpected type in latex interpolation: " + spec.type)
                        }
                    }
                    return {
                        valueType: cl_types_1.Types.latex,
                        body: function() {
                            var args = [];
                            for (var _i = 0; _i < arguments.length; _i++) {
                                args[_i] = arguments[_i]
                            }
                            var latex = "";
                            for (var _a = 0, args_3 = args; _a < args_3.length; _a++) {
                                var arg = args_3[_a];
                                if (arg == undefined || typeof arg == "number" && isNaN(arg)) {
                                    latex += "undefined"
                                } else if (helpers_1.isCLStringType(arg)) {
                                    latex += helpers_1.synthesizeStringInternal(arg)
                                } else if (helpers_1.isCLLatexType(arg)) {
                                    latex += arg.latex
                                } else {
                                    latex += arg
                                }
                            }
                            return {
                                latex: latex
                            }
                        }
                    }
                }
            },
            _a.choose = {
                internal: true,
                version: "v2",
                description: function() {
                    return i18n_1.EMPTY
                },
                lookup: function(argSpecs) {
                    var _a;
                    if (argSpecs.length < 3)
                        throw new Error("Incomplete when/otherwise clause");
                    var valueSpecs = (_a = _.partition(argSpecs, function(_v, i) {
                        return !!(i % 2) || i + 1 === argSpecs.length
                    }),
                        _a[0])
                        , conditionSpecs = _a[1];
                    for (var _i = 0, conditionSpecs_1 = conditionSpecs; _i < conditionSpecs_1.length; _i++) {
                        var conditionSpec = conditionSpecs_1[_i];
                        if (!cl_types_1.Types.boolean.matches(conditionSpec.type)) {
                            throw new Error("Every 'when' must be followed by a boolean condition")
                        }
                    }
                    var outputValueType = valueSpecs[0].type;
                    if (outputValueType.matches(cl_types_1.Types.latex) && _.any(valueSpecs, function(s) {
                        return s.type.matches(cl_types_1.Types.string)
                    })) {
                        outputValueType = cl_types_1.Types.string
                    }
                    var warnings = [];
                    for (var _b = 0, valueSpecs_1 = valueSpecs; _b < valueSpecs_1.length; _b++) {
                        var valueSpec = valueSpecs_1[_b];
                        if (!outputValueType.matches(valueSpec.type)) {
                            if (outputValueType.matches(cl_types_1.Types.string) && valueSpec.type.matches(cl_types_1.Types.latex)) {} else {
                                throw Error("Mismatched types in choose - " + outputValueType.toString() + " and " + valueSpec.toString() + " differ")
                            }
                        }
                    }
                    return {
                        valueType: outputValueType,
                        warnings: warnings,
                        desiredArgTypes: _.range(argSpecs.length).map(function(i) {
                            if (!!(i % 2) || i + 1 == argSpecs.length) {
                                return outputValueType
                            } else {
                                return cl_types_1.Types.boolean
                            }
                        }),
                        body: function() {
                            var args = [];
                            for (var _i = 0; _i < arguments.length; _i++) {
                                args[_i] = arguments[_i]
                            }
                            var condition, index, j, len, ref;
                            ref = args.slice(0, -1);
                            for (index = j = 0,
                                     len = ref.length; j < len; index = j += 2) {
                                condition = ref[index];
                                if (condition) {
                                    return args[index + 1]
                                }
                            }
                            return args[args.length - 1]
                        }
                    }
                }
            },
            _a.and = {
                version: "v3",
                internal: true,
                description: function() {
                    return i18n_1.i18n.s("cl-docs-description-lib-and")
                },
                argTypes: [cl_types_1.Types.boolean, cl_types_1.Types.boolean],
                outputType: cl_types_1.Types.boolean,
                value: function(a, b) {
                    return a && b
                }
            },
            _a.or = {
                version: "v3",
                internal: true,
                description: function() {
                    return i18n_1.i18n.s("cl-docs-description-lib-or")
                },
                argTypes: [cl_types_1.Types.boolean, cl_types_1.Types.boolean],
                outputType: cl_types_1.Types.boolean,
                value: function(a, b) {
                    return a || b
                }
            },
            _a.not = {
                version: "v3",
                description: function() {
                    return i18n_1.i18n.s("cl-docs-description-lib-not")
                },
                argTypes: [cl_types_1.Types.boolean],
                outputType: cl_types_1.Types.boolean,
                noUndefinedArgs: true,
                value: function(a) {
                    return !a
                }
            },
            _a.isDefined = {
                version: "v2",
                description: function() {
                    return i18n_1.i18n.s("cl-docs-description-lib-is-defined")
                },
                lookup: function(argSpecs) {
                    if (argSpecs.length !== 1) {
                        throw Error("isDefined takes a 1 argument.  I got " + argSpecs.length)
                    }
                    return {
                        valueType: cl_types_1.Types.boolean,
                        body: function(a) {
                            return a != null && !_.isNaN(a)
                        }
                    }
                }
            },
            _a.isUndefined = {
                version: "v2",
                description: function() {
                    return i18n_1.i18n.s("cl-docs-description-lib-is-undefined")
                },
                lookup: function(argSpecs) {
                    if (argSpecs.length !== 1) {
                        throw Error("isUndefined takes a 1 argument.  I got " + argSpecs.length)
                    }
                    return {
                        valueType: cl_types_1.Types.boolean,
                        body: function(a) {
                            return !(a != null) || _.isNaN(a)
                        }
                    }
                }
            },
            _a.firstDefinedValue = {
                version: "v2",
                description: function() {
                    return i18n_1.i18n.s("cl-docs-description-lib-first-defined-value")
                },
                lookup: function(argSpecs) {
                    if (argSpecs.length == 0) {
                        throw new Error("firstDefinedValue requires at least one argument.")
                    }
                    var desiredValueType = argSpecs[0].type;
                    if (_.any(argSpecs, function(s) {
                        return s.type.matches(cl_types_1.Types.string)
                    })) {
                        desiredValueType = cl_types_1.Types.string
                    }
                    var warnings = [];
                    for (var _i = 0, argSpecs_4 = argSpecs; _i < argSpecs_4.length; _i++) {
                        var argSpec = argSpecs_4[_i];
                        if (!desiredValueType.matches(argSpec.type)) {
                            if (desiredValueType.matches(cl_types_1.Types.string) && argSpec.type.matches(cl_types_1.Types.latex)) {} else {
                                throw new Error("All arguments to firstDefinedValue must be the same type" + (desiredValueType.type + " doesn't match " + argSpec.type.type))
                            }
                        }
                    }
                    return {
                        valueType: desiredValueType,
                        warnings: warnings,
                        desiredArgTypes: _.range(argSpecs.length).map(function() {
                            return desiredValueType
                        }),
                        body: function() {
                            var values = [];
                            for (var _i = 0; _i < arguments.length; _i++) {
                                values[_i] = arguments[_i]
                            }
                            var j, len, value;
                            for (j = 0,
                                     len = values.length; j < len; j++) {
                                value = values[j];
                                if (value != null && !_.isNaN(value)) {
                                    return value
                                }
                            }
                            return void 0
                        }
                    }
                }
            },
            _a.eq = {
                version: "v2",
                description: function() {
                    return i18n_1.EMPTY
                },
                internal: true,
                lookup: function(argSpecs) {
                    var a, b;
                    if (argSpecs.length !== 2) {
                        throw Error("Equality test requires two objects.  I got " + argSpecs.length)
                    }
                    a = argSpecs[0].type,
                        b = argSpecs[1].type;
                    var comparisonType = a;
                    if (!(a.matches(cl_types_1.Types.number) || a.matches(cl_types_1.Types.string) || a.matches(cl_types_1.Types.latex))) {
                        throw Error("Equality checks only work for numbers, strings and latex right now")
                    }
                    if (comparisonType.matches(cl_types_1.Types.latex)) {
                        comparisonType = cl_types_1.Types.string
                    }
                    var warnings = [];
                    for (var _i = 0, argSpecs_5 = argSpecs; _i < argSpecs_5.length; _i++) {
                        var argSpec = argSpecs_5[_i];
                        var param = argSpec.type;
                        if (!param.matches(comparisonType)) {
                            if (param.matches(cl_types_1.Types.latex) && comparisonType.matches(cl_types_1.Types.string)) {} else {
                                throw Error("Objects of different types are never equal (in this case " + a + " and " + b)
                            }
                        }
                    }
                    return {
                        valueType: cl_types_1.Types.boolean,
                        warnings: warnings,
                        desiredArgTypes: [a, b],
                        body: function(a, b) {
                            if (a == undefined || b == undefined) {
                                return false
                            }
                            if (helpers_1.isCLLatexType(a) && helpers_1.isCLLatexType(b)) {
                                return patterns_matching_1.latexEqual(a.latex, b.latex)
                            }
                            var compareA = helpers_1.isCLStringType(a) ? helpers_1.synthesizeStringInternal(a) : helpers_1.isCLLatexType(a) ? a.latex : a;
                            var compareB = helpers_1.isCLStringType(b) ? helpers_1.synthesizeStringInternal(b) : helpers_1.isCLLatexType(b) ? b.latex : b;
                            return compareA === compareB
                        }
                    }
                }
            },
            _a.isBlank = {
                version: "v2",
                description: function() {
                    return i18n_1.i18n.s("cl-docs-description-lib-is-blank")
                },
                lookup: function(argSpecs) {
                    if (argSpecs.length != 1) {
                        throw new Error("isBlank expects a single parameter")
                    }
                    if (!(cl_types_1.Types.string.matches(argSpecs[0].type) || cl_types_1.Types.latex.matches(argSpecs[0].type))) {
                        throw new Error("isBlank accepts a string or latex, but got " + argSpecs[0].type)
                    }
                    return {
                        valueType: cl_types_1.Types.boolean,
                        body: function(a) {
                            if (a == undefined) {
                                return true
                            }
                            var trimmed;
                            if (helpers_1.isCLLatexType(a)) {
                                trimmed = a.latex.trim()
                            } else if (helpers_1.isCLStringType(a)) {
                                trimmed = helpers_1.synthesizeStringInternal(a).trim()
                            } else {
                                throw new Error("Internal error. isBlank expected argument of string or latex type but got " + a)
                            }
                            return trimmed.length == 0
                        }
                    }
                }
            },
            _a),
        types: {
            partialInterpolation: (_b = {},
                _b[exports.INTERPOLATE_FN_NAME] = {
                    internal: true,
                    version: "v2",
                    description: function() {
                        return i18n_1.EMPTY
                    },
                    lookup: function(argSpecs) {
                        var argumentTypes = argSpecs.map(function(s) {
                            return s.type
                        }).slice(1).slice(0);
                        for (var _i = 0, argumentTypes_1 = argumentTypes; _i < argumentTypes_1.length; _i++) {
                            var type = argumentTypes_1[_i];
                            if (!(cl_types_1.Types.string.matches(type) || cl_types_1.Types.number.matches(type) || cl_types_1.Types.latex.matches(type))) {
                                throw Error("Unexpected type in partialInterpolation.interpolate: " + type)
                            }
                        }
                        return {
                            valueType: cl_types_1.Types.string,
                            body: function(partialInterpolation) {
                                var args = [];
                                for (var _i = 1; _i < arguments.length; _i++) {
                                    args[_i - 1] = arguments[_i]
                                }
                                var parts = [];
                                for (var _a = 0, _b = partialInterpolation.parts; _a < _b.length; _a++) {
                                    var part = _b[_a];
                                    if (typeof part == "string") {
                                        parts.push(part)
                                    } else if (typeof part == "number") {
                                        var arg = args[part - 1];
                                        if (helpers_1.isCLStringType(arg)) {
                                            parts.push.apply(parts, arg.parts)
                                        } else {
                                            parts.push(arg)
                                        }
                                    } else {
                                        throw new Error("Unexpected part type in partialInterpolation: " + typeof part)
                                    }
                                }
                                return {
                                    type: "string",
                                    parts: parts
                                }
                            }
                        }
                    }
                },
                _b)
        },
        constants: {}
    };
    function addComparator(name, symbol, fn) {
        exports.library.functions[name] = {
            internal: true,
            version: "v2",
            description: function() {
                return i18n_1.EMPTY
            },
            lookup: function(argSpecs) {
                if (argSpecs.length !== 2) {
                    throw Error(symbol + " operator requires two objects.  I got " + argSpecs.length)
                }
                var a = argSpecs[0].type;
                var b = argSpecs[1].type;
                if (!(cl_types_1.Types.number.matches(a) && cl_types_1.Types.number.matches(b))) {
                    throw Error(symbol + " operator can only compare numbers. I see '" + a + " " + symbol + " " + b + "'")
                }
                return {
                    valueType: cl_types_1.Types.boolean,
                    body: fn
                }
            }
        }
    }
    addComparator("gt", ">", function(a, b) {
        return a > b
    });
    addComparator("gte", ">=", function(a, b) {
        return a >= b
    });
    addComparator("lt", "<", function(a, b) {
        return a < b
    });
    addComparator("lte", "<=", function(a, b) {
        return a <= b
    });
    function castLatexToString(x) {
        return x ? {
            type: "string",
            parts: [x]
        } : undefined
    }
    exports.castLatexToString = castLatexToString;
    function castStringToLatex(x) {
        return x ? {
            latex: helpers_1.synthesizeStringInternal(x)
        } : undefined
    }
    exports.castStringToLatex = castStringToLatex
});
define("core/prosemirror/prosemirror-helpers", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.splitOnRegex = function(text, regex) {
        var result = [];
        var pos = 0;
        var match;
        while (match = regex.exec(text)) {
            var start = match.index;
            var end = start + match[0].length;
            if (start > pos) {
                result.push({
                    matched: false,
                    text: text.substr(pos, start - pos),
                    start: pos,
                    end: start
                })
            }
            result.push({
                matched: true,
                text: text.substr(start, end - start),
                start: start,
                end: end
            });
            pos = end
        }
        if (pos < text.length) {
            result.push({
                matched: false,
                text: text.substr(pos),
                start: pos,
                end: text.length
            })
        }
        return result
    }
    ;
    function clipboardTextSerializer(slice) {
        var from = -1;
        var to = slice.content.size;
        var blockSeparator = "\n\n";
        var text = "";
        var skipNextNewline = true;
        slice.content.descendants(function(node, pos) {
            if (node.isText) {
                text += node.text.slice(Math.max(from, pos) - pos, to - pos)
            } else {
                switch (node.type.name) {
                    case "paragraph":
                        if (!skipNextNewline) {
                            text += blockSeparator
                        }
                        skipNextNewline = false;
                        break;
                    case "mq":
                    case "interp":
                        text += node.type.spec.toDOM(node).toString();
                        return false
                }
            }
            return true
        });
        return text
    }
    exports.clipboardTextSerializer = clipboardTextSerializer
});
define("core/prosemirror/prosemirror-serialize", ["require", "exports", "./prosemirror-helpers", "prosemirror-model"], function(require, exports, prosemirror_helpers_1, prosemirror_model_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.MQ_REGEX = /`[^`]*`/gi;
    exports.INTERP_REGEX = /\$\{[^\}]*\}/gi;
    exports.RAW_LINK_REGEX = /(\bhttps?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|])/gi;
    exports.MD_LINK_REGEX = /\[([^\[\]]+)\]\((https?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|])\)/gi;
    function hasNonWhitespaceContent(node) {
        if (node.text && node.text.trim().length > 0)
            return true;
        if (node.isLeaf)
            return false;
        for (var i = 0; i < node.childCount; i++) {
            if (hasNonWhitespaceContent(node.child(i)))
                return true
        }
        return false
    }
    exports.hasNonWhitespaceContent = hasNonWhitespaceContent;
    function hasNonWhitespaceContentJSON(node) {
        if (node.text && node.text.trim().length > 0)
            return true;
        if (!node.content)
            return false;
        for (var i = 0; i < node.content.length; i++) {
            var child = node.content[i];
            if (child && hasNonWhitespaceContentJSON(child))
                return true
        }
        return false
    }
    exports.hasNonWhitespaceContentJSON = hasNonWhitespaceContentJSON;
    exports.nodeToString = function(node) {
        if (node.isLeaf) {
            return node.textContent
        } else {
            var childText_1 = [];
            node.content.forEach(function(child) {
                childText_1.push(exports.nodeToString(child))
            });
            var nodeText = void 0;
            if (node.type.name == "doc") {
                nodeText = childText_1.join("\n")
            } else {
                nodeText = childText_1.join("")
            }
            if (node.type.name == "mq" && nodeText.length) {
                nodeText = "`" + nodeText + "`"
            }
            return nodeText
        }
    }
    ;
    exports.serializedNodeToString = function(node) {
        if (node.text) {
            return node.text
        } else {
            var childText_2 = [];
            if (!node.content)
                return "";
            node.content.forEach(function(child) {
                childText_2.push(exports.serializedNodeToString(child))
            });
            var nodeText = void 0;
            if (node.type == "doc") {
                nodeText = childText_2.join("\n")
            } else {
                nodeText = childText_2.join("")
            }
            if (node.type == "mq" && nodeText.length) {
                nodeText = "`" + nodeText + "`"
            }
            if (node.type == "list_item") {
                nodeText = "   " + nodeText
            }
            if (node.type === "bullet_list") {
                nodeText = nodeText.split("").join("\n").trim()
            }
            return nodeText
        }
    }
    ;
    exports.stringToSerializedNode = function(text) {
        var lines = text.split("\n").map(function(line) {
            var contents = [];
            prosemirror_helpers_1.splitOnRegex(line, exports.MQ_REGEX).forEach(function(result) {
                if (result.matched) {
                    var textNode = void 0;
                    if (result.text.length > 2) {
                        textNode = {
                            type: "text",
                            text: result.text.substr(1, result.text.length - 2)
                        };
                        contents.push({
                            type: "mq",
                            content: [textNode]
                        })
                    }
                } else {
                    contents.push({
                        type: "text",
                        text: result.text
                    })
                }
            });
            return {
                type: "paragraph",
                content: contents
            }
        });
        return {
            type: "doc",
            content: lines
        }
    }
    ;
    exports.stringToNode = function(text, outputSchema) {
        return prosemirror_model_1.Node.fromJSON(outputSchema, exports.stringToSerializedNode(text))
    }
    ;
    function blockParser(inlineContent, schema, blockData) {
        var blockContent = [[]];
        var blockIndex = 0;
        inlineContent.forEach(function(node) {
            if (node.isText && node.text.indexOf("\n") !== -1) {
                prosemirror_helpers_1.splitOnRegex(node.text, /\n/g).forEach(function(result) {
                    if (result.matched) {
                        blockContent.push([]);
                        blockIndex++
                    } else {
                        blockContent[blockIndex].push(schema.text(result.text))
                    }
                })
            } else {
                blockContent[blockIndex].push(node)
            }
        });
        var blocks = [];
        for (var _i = 0, blockContent_1 = blockContent; _i < blockContent_1.length; _i++) {
            var block = blockContent_1[_i];
            var blockType = blockData ? blockData.type : "paragraph";
            var newBlock = schema.nodes[blockType].create(undefined, block);
            if (blockData) {
                newBlock.attrs = blockData.attrs
            }
            blocks.push(newBlock)
        }
        return blocks
    }
    function createMqNode(text, schema) {
        var textNode;
        if (text.length > 2) {
            textNode = schema.text(text.substr(1, text.length - 2))
        }
        return schema.nodes.mq.create(undefined, textNode)
    }
    function createInterpNode(text, schema) {
        var interpExpr = text.slice(2, text.length - 1);
        return schema.nodes.interp.create({
            interpExpr: interpExpr
        })
    }
    function createMdLinkNode(text, schema) {
        var linkInfo = text.split("](");
        var displayText = linkInfo[0].slice(1);
        var urlText = linkInfo[1].slice(0, -1);
        var linkMark = schema.marks["link"].create({
            href: urlText
        });
        return schema.text(displayText).mark([linkMark])
    }
    function createRawLinkNode(text, schema) {
        var linkMark = schema.marks["link"].create({
            href: text
        });
        return schema.text(text).mark([linkMark])
    }
    exports.stringToNodes = function(text, outputSchema, parsingSchema) {
        if (!parsingSchema) {
            parsingSchema = outputSchema
        }
        var inlineNodes = [{
            name: "mq",
            regex: exports.MQ_REGEX,
            create: createMqNode
        }];
        if (parsingSchema.nodes.interp) {
            inlineNodes.push({
                name: "interp",
                regex: exports.INTERP_REGEX,
                create: createInterpNode
            })
        }
        if (!!parsingSchema.marks["link"]) {
            inlineNodes.push({
                name: "link",
                regex: exports.MD_LINK_REGEX,
                create: createMdLinkNode
            });
            inlineNodes.push({
                name: "link",
                regex: exports.RAW_LINK_REGEX,
                create: createRawLinkNode
            })
        }
        function parseInline(text, idx) {
            if (idx === void 0) {
                idx = 0
            }
            var contents = [];
            prosemirror_helpers_1.splitOnRegex(text, inlineNodes[idx].regex).forEach(function(result) {
                if (result.matched) {
                    try {
                        contents.push(inlineNodes[idx].create(result.text, outputSchema))
                    } catch (e) {
                        throw new Error("Could not serialize " + inlineNodes[idx].name + " as it is not on the outputSchema")
                    }
                } else {
                    if (idx + 1 < inlineNodes.length) {
                        contents = contents.concat(parseInline(result.text, idx + 1))
                    } else {
                        contents.push(outputSchema.text(result.text))
                    }
                }
            });
            return contents
        }
        return parseInline(text)
    }
    ;
    exports.stringToBlockNodes = function(text, outputSchema, parsingSchema, blockData) {
        var inlineNodes = exports.stringToNodes(text, outputSchema, parsingSchema);
        return blockParser(inlineNodes, outputSchema, blockData)
    }
});
define("prosemirror-schema-basic/index", ["require", "exports", "module", "prosemirror-model"], function(require, exports, module) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var prosemirrorModel = require("prosemirror-model");
    var pDOM = ["p", 0]
        , blockquoteDOM = ["blockquote", 0]
        , hrDOM = ["hr"]
        , preDOM = ["pre", ["code", 0]]
        , brDOM = ["br"];
    var nodes = {
        doc: {
            content: "block+"
        },
        paragraph: {
            content: "inline*",
            group: "block",
            parseDOM: [{
                tag: "p"
            }],
            toDOM: function toDOM() {
                return pDOM
            }
        },
        blockquote: {
            content: "block+",
            group: "block",
            defining: true,
            parseDOM: [{
                tag: "blockquote"
            }],
            toDOM: function toDOM() {
                return blockquoteDOM
            }
        },
        horizontal_rule: {
            group: "block",
            parseDOM: [{
                tag: "hr"
            }],
            toDOM: function toDOM() {
                return hrDOM
            }
        },
        heading: {
            attrs: {
                level: {
                    default: 1
                }
            },
            content: "inline*",
            group: "block",
            defining: true,
            parseDOM: [{
                tag: "h1",
                attrs: {
                    level: 1
                }
            }, {
                tag: "h2",
                attrs: {
                    level: 2
                }
            }, {
                tag: "h3",
                attrs: {
                    level: 3
                }
            }, {
                tag: "h4",
                attrs: {
                    level: 4
                }
            }, {
                tag: "h5",
                attrs: {
                    level: 5
                }
            }, {
                tag: "h6",
                attrs: {
                    level: 6
                }
            }],
            toDOM: function toDOM(node) {
                return ["h" + node.attrs.level, 0]
            }
        },
        code_block: {
            content: "text*",
            marks: "",
            group: "block",
            code: true,
            defining: true,
            parseDOM: [{
                tag: "pre",
                preserveWhitespace: "full"
            }],
            toDOM: function toDOM() {
                return preDOM
            }
        },
        text: {
            group: "inline"
        },
        image: {
            inline: true,
            attrs: {
                src: {},
                alt: {
                    default: null
                },
                title: {
                    default: null
                }
            },
            group: "inline",
            draggable: true,
            parseDOM: [{
                tag: "img[src]",
                getAttrs: function getAttrs(dom) {
                    return {
                        src: dom.getAttribute("src"),
                        title: dom.getAttribute("title"),
                        alt: dom.getAttribute("alt")
                    }
                }
            }],
            toDOM: function toDOM(node) {
                var ref = node.attrs;
                var src = ref.src;
                var alt = ref.alt;
                var title = ref.title;
                return ["img", {
                    src: src,
                    alt: alt,
                    title: title
                }]
            }
        },
        hard_break: {
            inline: true,
            group: "inline",
            selectable: false,
            parseDOM: [{
                tag: "br"
            }],
            toDOM: function toDOM() {
                return brDOM
            }
        }
    };
    var emDOM = ["em", 0]
        , strongDOM = ["strong", 0]
        , codeDOM = ["code", 0];
    var marks = {
        link: {
            attrs: {
                href: {},
                title: {
                    default: null
                }
            },
            inclusive: false,
            parseDOM: [{
                tag: "a[href]",
                getAttrs: function getAttrs(dom) {
                    return {
                        href: dom.getAttribute("href"),
                        title: dom.getAttribute("title")
                    }
                }
            }],
            toDOM: function toDOM(node) {
                var ref = node.attrs;
                var href = ref.href;
                var title = ref.title;
                return ["a", {
                    href: href,
                    title: title
                }, 0]
            }
        },
        em: {
            parseDOM: [{
                tag: "i"
            }, {
                tag: "em"
            }, {
                style: "font-style=italic"
            }],
            toDOM: function toDOM() {
                return emDOM
            }
        },
        strong: {
            parseDOM: [{
                tag: "strong"
            }, {
                tag: "b",
                getAttrs: function(node) {
                    return node.style.fontWeight != "normal" && null
                }
            }, {
                style: "font-weight",
                getAttrs: function(value) {
                    return /^(bold(er)?|[5-9]\d{2,})$/.test(value) && null
                }
            }],
            toDOM: function toDOM() {
                return strongDOM
            }
        },
        code: {
            parseDOM: [{
                tag: "code"
            }],
            toDOM: function toDOM() {
                return codeDOM
            }
        }
    };
    var schema = new prosemirrorModel.Schema({
        nodes: nodes,
        marks: marks
    });
    exports.marks = marks;
    exports.nodes = nodes;
    exports.schema = schema
});
define("prosemirror-schema-basic", ["prosemirror-schema-basic/index"], function(main) {
    return main
});
define("core/prosemirror/mq-schema", ["require", "exports", "orderedmap", "prosemirror-model", "prosemirror-schema-basic"], function(require, exports, OrderedMap, prosemirror_model_1, prosemirror_schema_basic_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.mqSpec = {
        inline: true,
        group: "inline",
        content: "text*",
        selectable: true,
        toDOM: function(node) {
            return "`" + node.textContent + "`"
        }
    };
    exports.mqSchema = new prosemirror_model_1.Schema({
        nodes: OrderedMap.from({
            doc: prosemirror_schema_basic_1.nodes.doc,
            paragraph: prosemirror_schema_basic_1.nodes.paragraph,
            text: prosemirror_schema_basic_1.nodes.text,
            mq: exports.mqSpec
        })
    })
});
define("core/prosemirror/link-mark-spec", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.link = {
        attrs: {
            href: {},
            title: {
                default: null
            },
            target: {
                default: "_blank"
            }
        },
        inclusive: false,
        parseDOM: [{
            tag: "a[href]",
            getAttrs: function(dom) {
                return {
                    href: dom.getAttribute("href"),
                    title: dom.getAttribute("title")
                }
            }
        }],
        toDOM: function(node) {
            var _a = node.attrs
                , href = _a.href
                , title = _a.title
                , target = _a.target;
            return ["a", {
                href: href,
                title: title,
                target: target,
                class: "blue-link"
            }, 0]
        }
    }
});
define("core/prosemirror/interp-node-spec", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.interpSpec = {
        content: "inline*",
        attrs: {
            interpExpr: {
                default: ""
            }
        },
        group: "inline",
        inline: true,
        selectable: true,
        toDOM: function(node) {
            return "${" + node.attrs.interpExpr + "}"
        }
    }
});
define("core/lib/rich-text", ["require", "exports", "orderedmap", "prosemirror-model", "prosemirror-schema-basic", "../prosemirror/link-mark-spec", "../prosemirror/mq-schema", "../prosemirror/interp-node-spec", "prosemirror-schema-list"], function(require, exports, OrderedMap, prosemirror_model_1, prosemirror_schema_basic_1, link_mark_spec_1, mq_schema_1, interp_node_spec_1, prosemirror_schema_list_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var SCHEMA_COMPONENTS = ["doc", "paragraph", "text", "heading", "mq", "interp", "image", "list", "link", "em", "strong"];
    function makeSchema(doc, components) {
        var nodeMap = {
            doc: doc
        };
        var markMap = {};
        for (var _i = 0, components_1 = components; _i < components_1.length; _i++) {
            var component = components_1[_i];
            switch (component) {
                case "paragraph":
                case "text":
                case "heading":
                case "image":
                    nodeMap[component] = prosemirror_schema_basic_1.nodes[component];
                    break;
                case "mq":
                    nodeMap[component] = mq_schema_1.mqSpec;
                    break;
                case "interp":
                    nodeMap[component] = interp_node_spec_1.interpSpec;
                    break;
                case "em":
                case "strong":
                    markMap[component] = prosemirror_schema_basic_1.marks[component];
                    break;
                case "link":
                    markMap[component] = link_mark_spec_1.link;
                    break
            }
        }
        var nodes = OrderedMap.from(nodeMap);
        if (components.indexOf("list") !== -1) {
            nodes = prosemirror_schema_list_1.addListNodes(nodes, "paragraph block*", "block")
        }
        var marks;
        if (Object.keys(markMap).length !== 0) {
            marks = OrderedMap.from(markMap)
        }
        return new prosemirror_model_1.Schema({
            nodes: nodes,
            marks: marks
        })
    }
    exports.schemas = {
        document: {
            schema: makeSchema(prosemirror_schema_basic_1.nodes.doc, SCHEMA_COMPONENTS),
            version: 3
        },
        lesson: {
            schema: makeSchema(prosemirror_schema_basic_1.nodes.doc, ["paragraph", "text", "heading", "mq", "image", "list", "link", "em", "strong"]),
            version: 1
        },
        section: {
            schema: makeSchema(prosemirror_schema_basic_1.nodes.doc, ["paragraph", "text", "mq", "link", "em", "strong"]),
            version: 1
        },
        heading: {
            schema: makeSchema({
                content: "heading"
            }, ["heading", "text", "mq", "link", "em", "strong"]),
            version: 1
        }
    }
});
define("core/prosemirror/prosemirror-interpolation", ["require", "exports", "prosemirror-model", "core/computation-layer/helpers", "core/computation-layer/library/builtin", "prosemirror-state", "./prosemirror-serialize", "./mq-schema", "core/lib/rich-text"], function(require, exports, prosemirror_model_1, helpers_1, builtin_1, prosemirror_state_1, prosemirror_serialize_1, mq_schema_1, rich_text_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function createInterpMap(doc) {
        var interpMap = {};
        doc.descendants(function(node, pos, parent) {
            if (node.type.name === "interp") {
                if (interpMap[pos]) {
                    throw new Error("Attempted to record a unique interpolation node at position " + pos + " when one already exists.")
                }
                interpMap[pos] = {
                    from: pos,
                    to: pos + node.nodeSize,
                    interpExpr: node.attrs.interpExpr,
                    block: {
                        type: parent.type.name,
                        attrs: parent.attrs
                    },
                    marks: node.marks
                }
            }
        });
        return interpMap
    }
    exports.createInterpMap = createInterpMap;
    function getCLValueMap(interpMap, runtime, componentId) {
        var clValues = {};
        for (var key in interpMap) {
            var interpExpr = interpMap[key].interpExpr;
            if (!clValues[interpExpr]) {
                clValues[interpExpr] = getInterpValueAsString(runtime, componentId, interpExpr)
            }
        }
        return clValues
    }
    exports.getCLValueMap = getCLValueMap;
    function getInterpValueAsString(runtime, componentId, varName) {
        var node = runtime.getNodeFromVariable(componentId, varName);
        if (node === undefined || node.value === undefined)
            return;
        var valueType = node.analysis.valueType.type;
        switch (valueType) {
            case "string":
                return helpers_1.synthesizeStringForContent(node.value);
            case "number":
                return node.value.toString();
            case "latex":
                return helpers_1.synthesizeStringForContent(builtin_1.castLatexToString(node.value));
            default:
                return
        }
    }
    function makeNewInterpolationState(state, interpMap, clValues) {
        var newInterpMap = {};
        var tr = state.tr;
        var _loop_1 = function(key) {
            var from = tr.mapping.map(interpMap[key].from);
            var to = tr.mapping.map(interpMap[key].to);
            var _a = interpMap[key]
                , interpExpr = _a.interpExpr
                , block = _a.block
                , marks = _a.marks;
            var value = clValues[interpExpr];
            if (!value) {
                value = " "
            }
            var lines = value.split("\n");
            var newNodes = [];
            var newNodeSize = 0;
            var firstLine = prosemirror_serialize_1.stringToNodes(lines[0], state.schema, mq_schema_1.mqSchema);
            newNodes.push.apply(newNodes, firstLine);
            newNodeSize += prosemirror_model_1.Fragment.fromArray(firstLine).size;
            var placeholder = void 0;
            if (lines.length === 2) {
                placeholder = state.schema.nodes[block.type].create();
                newNodes.push(placeholder)
            } else if (lines.length > 2) {
                var middleString = lines.slice(1, -1).join("\n");
                var middleBlockNodes = prosemirror_serialize_1.stringToBlockNodes(middleString, state.schema, mq_schema_1.mqSchema, block);
                newNodes.push.apply(newNodes, middleBlockNodes);
                newNodeSize += prosemirror_model_1.Fragment.fromArray(middleBlockNodes).size
            }
            if (lines.length > 1) {
                var lastLine = prosemirror_serialize_1.stringToNodes(lines[lines.length - 1], state.schema, mq_schema_1.mqSchema);
                newNodes.push.apply(newNodes, lastLine);
                newNodeSize += prosemirror_model_1.Fragment.fromArray(lastLine).size + 2
            }
            tr = tr.replaceWith(from, to, newNodes);
            if (placeholder) {
                var placeholderPos = from + prosemirror_model_1.Fragment.fromArray(firstLine).size;
                tr = tr.deleteRange(placeholderPos, placeholderPos + placeholder.nodeSize)
            }
            to = from + newNodeSize;
            marks.forEach(function(mark) {
                tr = tr.addMark(from, to, mark)
            });
            tr.doc.nodesBetween(from, to, function(node, pos) {
                if (node.type.name === "mq" && node.marks.length > 0) {
                    marks.forEach(function(mark) {
                        tr = tr.removeMark(pos, pos + node.nodeSize, mark)
                    })
                }
            });
            if (lines.length > 1) {
                var resolveTo = tr.doc.resolve(to);
                tr = tr.replaceWith(resolveTo.before(), resolveTo.after(), state.schema.nodes[block.type].create(block.attrs, resolveTo.parent.content))
            }
            if (newInterpMap[from]) {
                throw new Error("Attempted to record a unique interpolation node at position " + from + " when one already exists.")
            }
            newInterpMap[from] = {
                from: from,
                to: to,
                interpExpr: interpExpr,
                block: block,
                marks: marks
            }
        };
        for (var key in interpMap) {
            _loop_1(key)
        }
        return {
            newInterpMap: newInterpMap,
            tr: tr
        }
    }
    exports.makeNewInterpolationState = makeNewInterpolationState;
    function interpolateSerializedDoc(serializedDoc, runtime, componentId) {
        var doc = prosemirror_model_1.Node.fromJSON(rich_text_1.schemas.document.schema, serializedDoc);
        var state = prosemirror_state_1.EditorState.create({
            schema: rich_text_1.schemas.document.schema,
            doc: doc
        });
        var interpMap = createInterpMap(doc);
        var clValues = getCLValueMap(interpMap, runtime, componentId);
        var tr = makeNewInterpolationState(state, interpMap, clValues).tr;
        var newState = state.apply(tr);
        return newState.doc.toJSON()
    }
    exports.interpolateSerializedDoc = interpolateSerializedDoc
});
define("activitybuilder/components/shared/prosemirror/interp-helpers", ["require", "exports", "prosemirror-state", "core/computation-layer/cl-types", "core/prosemirror/prosemirror-interpolation"], function(require, exports, prosemirror_state_1, cl_types_1, prosemirror_interpolation_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.interpAction = function(state, dispatch) {
        if (!state.schema.nodes.interp) {
            return false
        }
        var currentPos = state.selection.$anchor.pos;
        if (state.doc.textBetween(currentPos - 1, currentPos) !== "$") {
            return false
        }
        var node = state.schema.nodes.interp.create();
        var replace = state.tr.replaceWith(currentPos - 1, currentPos, node);
        var sel;
        try {
            sel = prosemirror_state_1.NodeSelection.create(replace.doc, currentPos - 1)
        } catch (e) {
            return false
        }
        var select = replace.setSelection(sel).scrollIntoView();
        if (dispatch) {
            dispatch(select)
        }
        return true
    }
    ;
    exports.makeInterpBackspaceCommand = function(getInterpolationExprs) {
        return function(state, onAction) {
            if (!state.selection.empty) {
                return false
            }
            var nodeBefore = state.selection.$from.nodeBefore;
            if (nodeBefore && nodeBefore.type.name == "interp") {
                var tr = state.tr.setSelection(prosemirror_state_1.NodeSelection.create(state.doc, state.selection.from - nodeBefore.nodeSize));
                if (getInterpolationExprs().indexOf(nodeBefore.attrs.interpExpr) !== -1) {
                    tr.deleteSelection()
                }
                if (onAction != undefined) {
                    onAction(tr)
                }
                return true
            } else {
                return false
            }
        }
    }
    ;
    function getInterpExprs(runtime, componentId) {
        var interpExprs = [];
        var variables = runtime.analysis.variables[componentId];
        for (var varName in variables) {
            var node = runtime.analysis.nodes[variables[varName]];
            if (cl_types_1.Types.string.matches(node.valueType) || cl_types_1.Types.number.matches(node.valueType) || cl_types_1.Types.latex.matches(node.valueType)) {
                interpExprs.push(varName)
            }
        }
        return interpExprs
    }
    exports.getInterpExprs = getInterpExprs;
    function updateInterpolation(view, interpMap, runtime, componentId) {
        var clValues = prosemirror_interpolation_1.getCLValueMap(interpMap, runtime, componentId);
        var _a = prosemirror_interpolation_1.makeNewInterpolationState(view.state, interpMap, clValues)
            , newInterpMap = _a.newInterpMap
            , tr = _a.tr;
        view.dispatch(tr);
        return newInterpMap
    }
    exports.updateInterpolation = updateInterpolation
});
define("activitybuilder/components/shared/prosemirror/paste-plugin", ["require", "exports", "prosemirror-state", "prosemirror-model", "core/prosemirror/prosemirror-helpers"], function(require, exports, prosemirror_state_1, prosemirror_model_1, prosemirror_helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.makePlugin = function(regex, transformMatch) {
        var transform = function(fragment, parent) {
            var transformed = [];
            fragment.forEach(function(child) {
                if (child.isText) {
                    var text = child.text;
                    prosemirror_helpers_1.splitOnRegex(text, regex).forEach(function(result) {
                        if (result.matched) {
                            transformed.push(transformMatch(child, result.start, result.end, parent))
                        } else {
                            transformed.push(child.cut(result.start, result.end))
                        }
                    })
                } else {
                    transformed.push(child.copy(transform(child.content, child)))
                }
            });
            return prosemirror_model_1.Fragment.fromArray(transformed)
        };
        return new prosemirror_state_1.Plugin({
            props: {
                transformPasted: function(slice) {
                    return new prosemirror_model_1.Slice(transform(slice.content),slice.openStart,slice.openEnd)
                }
            }
        })
    }
});
define("activitybuilder/components/shared/prosemirror/math-paste-plugin", ["require", "exports", "./paste-plugin", "core/prosemirror/prosemirror-serialize"], function(require, exports, paste_plugin_1, prosemirror_serialize_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.mathPastePlugin = paste_plugin_1.makePlugin(prosemirror_serialize_1.MQ_REGEX, function(child, start, end) {
        var schema = child.type.schema;
        var mqType = schema.nodes.mq;
        if (start + 1 < end - 1) {
            return mqType.create(undefined, child.cut(start + 1, end - 1), child.marks)
        } else {
            return mqType.create(undefined, undefined, child.marks)
        }
    })
});
define("activitybuilder/components/shared/prosemirror/activity-link-plugin", ["require", "exports", "prosemirror-state", "./helpers"], function(require, exports, prosemirror_state_1, helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.activityLinkPlugin = new prosemirror_state_1.Plugin({
        appendTransaction: function(_transactions, _oldState, newState) {
            var matches = [];
            newState.doc.content.forEach(function(node, offset) {
                if (node.type.name == "paragraph") {
                    node.content.forEach(function(child) {
                        if (child.type.name == "text") {
                            var match = void 0;
                            while (match = helpers_1.ACTIVITY_URL_REGEX.exec(child.text)) {
                                matches.push({
                                    child: child,
                                    offset: offset,
                                    match: match
                                })
                            }
                        }
                    })
                }
            });
            if (matches.length) {
                matches.reverse();
                var tr_1 = newState.tr;
                matches.forEach(function(_a) {
                    var child = _a.child
                        , offset = _a.offset
                        , match = _a.match;
                    var start = match.index;
                    var end = start + match[0].length;
                    var schema = child.type.schema;
                    var activityType = schema.nodes.activity;
                    var newNode = activityType.create(undefined, child.cut(start, end));
                    tr_1 = tr_1.replaceWith(offset + start + 1, offset + end + 1, newNode)
                });
                return tr_1
            } else {
                return undefined
            }
        }
    })
});
define("activitybuilder/components/shared/prosemirror/link-plugin", ["require", "exports", "./paste-plugin", "core/prosemirror/prosemirror-serialize"], function(require, exports, paste_plugin_1, prosemirror_serialize_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.rawLinkPastePlugin = paste_plugin_1.makePlugin(prosemirror_serialize_1.RAW_LINK_REGEX, function(child, start, end) {
        var link = child.type.schema.marks["link"];
        var text = child.text;
        var urlText = text.slice(start, end);
        return child.cut(start, end).mark(link.create({
            href: urlText
        }).addToSet(child.marks))
    });
    exports.mdLinkPastePlugin = paste_plugin_1.makePlugin(prosemirror_serialize_1.MD_LINK_REGEX, function(child, start, end) {
        var link = child.type.schema.marks["link"];
        var text = child.text;
        var linkInfo = text.split("](");
        var urlText = linkInfo[1].slice(0, -1);
        return child.type.schema.text(linkInfo[0].slice(1)).cut(start, end).mark(link.create({
            href: urlText
        }).addToSet(child.marks))
    })
});
define("shared/alp/collaboration-helpers", ["require", "exports", "lib/i18n"], function(require, exports, i18n) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function getAuthor(activity) {
        if (activity.source == "desmos") {
            return {}
        }
        var user = activity.user;
        if (activity.ancestors && activity.ancestors[0] && activity.ancestors[0].user) {
            user = activity.ancestors[0].user
        }
        if (!user)
            return {};
        if (!user.displayName) {
            user.displayName = "id" + user.id
        }
        return user
    }
    exports.getAuthor = getAuthor;
    function isByDesmos(activity) {
        var author = getAuthor(activity);
        if (activity.authorTags.indexOf("cpm") >= 0)
            return false;
        return activity.source === "desmos" || author && author.id == "55fb1831efe3b67f175ca4a2" || activity.authorTags.indexOf("desmos") > -1
    }
    exports.isByDesmos = isByDesmos;
    function getCollaboration(activity) {
        if (activity.source == "desmos") {
            return i18n.EMPTY
        }
        if (!activity.ancestors || activity.ancestors.length === 0)
            return i18n.EMPTY;
        var activityAuthor = activity.ancestors[0].user || activity.user;
        var contributors = [];
        if (activity.user.id !== activityAuthor.id && activity.user.displayName) {
            contributors.push(activity.user.displayName)
        }
        activity.ancestors.forEach(function(ancestor) {
            if (ancestor.user.id !== activityAuthor.id && ancestor.user.displayName && contributors.indexOf(ancestor.user.displayName) === -1)
                contributors.push(ancestor.user.displayName)
        });
        if (contributors.length === 0)
            return i18n.EMPTY;
        var collab = i18n.EMPTY;
        if (contributors.length === 1) {
            collab = i18n.s("alp-label-edited-with-love-one-author", {
                author: i18n.raw(contributors[0])
            })
        } else if (contributors.length === 2) {
            collab = i18n.s("alp-label-edited-with-love-two-authors", {
                author1: i18n.raw(contributors[0]),
                author2: i18n.raw(contributors[1])
            })
        } else {
            var last = i18n.raw(contributors.pop() || "");
            var authorList = i18n.raw(contributors.join(", ") || "");
            collab = i18n.s("alp-label-edited-with-love-many-authors", {
                authorList: authorList,
                last: last
            })
        }
        return collab
    }
    exports.getCollaboration = getCollaboration
});
define("loadcss!shared/dcgviews/rich-text", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/dcgviews/rich-text.css", decodeURIComponent(".dcg-rich-text%20%7B%0A%20%20white-space%3A%20pre-wrap%3B%0A%7D%0A.dcg-rich-text%20.blue-link%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20max-width%3A%20100%25%3B%0A%20%20word-break%3A%20break-all%3B%0A%20%20vertical-align%3A%20bottom%3B%0A%7D%0A.dcg-rich-text%20.partner-cobranding%20img%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20height%3A%2028px%3B%0A%20%20position%3A%20relative%3B%0A%20%20top%3A%207px%3B%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20930px)%20%7B%0A%20%20.dcg-rich-text%20.blue-link%20%7B%0A%20%20%20%20max-width%3A%20540px%3B%0A%20%20%7D%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20660px)%20%7B%0A%20%20.dcg-rich-text%20.blue-link%20%7B%0A%20%20%20%20max-width%3A%20300px%3B%0A%20%20%7D%0A%7D%0A"))
});
define("shared/dcgviews/rich-text", ["require", "exports", "tslib", "dcgview", "underscore", "lib/retain-lang", "loadcss!./rich-text"], function(require, exports, tslib_1, DCGView, _, retain_lang_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var HTTP_LINK_REGEX = /(\bhttps?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|])/gi;
    var MARKDOWN_LINK_REGEX = new RegExp("\\[([^\\]]*)\\]\\(" + HTTP_LINK_REGEX.source + "\\)","ig");
    var BARE_LINK_OR_MARKDOWN_LINK = new RegExp("(?:" + MARKDOWN_LINK_REGEX.source + ")|(?:" + HTTP_LINK_REGEX.source + ")","ig");
    var RichText = function(_super) {
        tslib_1.__extends(RichText, _super);
        function RichText() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        RichText.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("span", {
                didMount: function(node) {
                    _this.root = node;
                    _this.updateRichText()
                },
                willUnmount: function() {
                    return delete _this.root
                },
                class: function() {
                    return tslib_1.__assign({
                        "dcg-rich-text": true
                    }, _this.props.class && _this.props.class() || {})
                }
            })
        }
        ;
        RichText.prototype.updateRichText = function() {
            if (!this.root)
                return;
            var text = this.props.text();
            if (text === this.lastText) {
                return
            }
            this.lastText = text;
            var escapedPoorText = _.escape(text);
            var richText;
            if (this.props.disableLinks && this.props.disableLinks()) {
                richText = escapedPoorText
            } else {
                richText = escapedPoorText.replace(BARE_LINK_OR_MARKDOWN_LINK, function(_, mdContent, mdUrl, bareUrl) {
                    var url = retain_lang_1.retainLang(mdUrl ? mdUrl : bareUrl);
                    var content = mdUrl ? mdContent : bareUrl;
                    return "<a href='" + url + "' target='_blank' class='blue-link'>" + content + "</a>"
                })
            }
            richText = richText.replace(/###CPM COLLABORATION###/, "<div class='partner-cobranding cpm-cobranding'><img src='/fingerprinted/static/img/CPMLogo-c1541b18ba5ac96aaed8788bc482d87d02e8ca67.png' /> Made in collaboration with <a href='//cpm.org' class='blue-link' target='_blank'>CPM</a>.</div>");
            richText = richText.replace(/###NYT COLLABORATION###/, "<div class='partner-cobranding nyt-asa-cobranding'>Made in collaboration with <img src='/fingerprinted/static/img/NYTlogo-378c5ad4552e4c944cf5824498d473a145820c29.png' /> <a href='https://www.nytimes.com/column/whats-going-on-in-this-graph' class='blue-link' target='_blank'>The New York Times Learning Network</a> and <img src='/fingerprinted/static/img/ASAlogo-ca85b14818a35327dfae920e06fe6be2c6accea4.png' /><a href='https://www.amstat.org/ASA/Whats-Going-on-in-this-Graph.aspx' class='blue-link' target='_blank'>The American Statistical Association</a>.</div>");
            this.root.innerHTML = richText
        }
        ;
        RichText.prototype.didUpdate = function() {
            this.updateRichText()
        }
        ;
        return RichText
    }(DCGView.Class);
    exports.RichText = RichText
});
define("activitybuilder/components/shared/text-with-math/math-helpers", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.isMathInGoodState = function(text) {
        if (text != null) {
            var matches = text.match(/`/g);
            var ticks = matches != null && matches.length || 0;
            return ticks % 2 == 0
        }
        return true
    }
    ;
    var backtickRegex = /`[^`]*`/g;
    exports.getRanges = function(source) {
        var ranges = [];
        if (source == null || source.length == 0) {
            return ranges
        }
        var i = 0;
        var match;
        while (match = backtickRegex.exec(source)) {
            var text_1 = source.slice(i, match.index);
            if (text_1.length > 0) {
                ranges.push({
                    from: i,
                    to: match.index,
                    type: "text",
                    text: text_1
                })
            }
            i = match.index + match[0].length;
            ranges.push({
                from: match.index,
                to: i,
                type: "math",
                text: match[0].slice(1, -1)
            })
        }
        var text = source.slice(i);
        if (text.length > 0) {
            ranges.push({
                from: i,
                to: source.length,
                type: "text",
                text: text
            })
        }
        return ranges
    }
});
define("loadcss!activitybuilder/components/shared/text-with-math/mixed-text-display", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/activitybuilder/components/shared/text-with-math/mixed-text-display.css", decodeURIComponent(".mixed-text-display%20%7B%0A%20%20white-space%3A%20pre-wrap%3B%0A%7D%0A.mixed-text-display%20.dcg-mq-math-mode%2C%0A.mixed-text-display%20.nobr%20%7B%0A%20%20white-space%3A%20nowrap%3B%0A%7D%0A.mixed-text-display%20.empty-text%20%7B%0A%20%20color%3A%20%23bbb%3B%0A%7D%0A.mixed-text-display%20.dcg-mq-root-block%2C%0A.mixed-text-display%20.dcg-mq-math-mode%20.dcg-mq-root-block%20%7B%0A%20%20overflow%3A%20visible%3B%0A%20%20vertical-align%3A%20baseline%3B%0A%7D%0A"))
});
define("activitybuilder/components/shared/text-with-math/mixed-text-display", ["require", "exports", "tslib", "dcgview", "shared/dcgviews/rich-text", "mathquill", "./math-helpers", "loadcss!./mixed-text-display"], function(require, exports, tslib_1, DCGView, rich_text_1, MathQuill, math_helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , For = _a.For
        , If = _a.If;
    var Mathquill = function(_super) {
        tslib_1.__extends(Mathquill, _super);
        function Mathquill() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        Mathquill.prototype.template = function() {
            var optionalOnTap = this.props.onTap ? {
                onTap: this.props.onTap
            } : {};
            return DCGView.createElement("span", tslib_1.__assign({
                didMount: this.bindFn(this.rootDidMount)
            }, optionalOnTap))
        }
        ;
        Mathquill.prototype.rootDidMount = function(root) {
            this.rootNode = root;
            this.mathquill = MathQuill.StaticMath(this.rootNode);
            this.didUpdate()
        }
        ;
        Mathquill.prototype.shouldUpdate = function() {
            return false
        }
        ;
        Mathquill.prototype.didUpdate = function() {
            if (this.mathquill) {
                this.mathquill.latex(this.props.latex())
            }
        }
        ;
        return Mathquill
    }(DCGView.Class);
    var MixedTextDisplay = function(_super) {
        tslib_1.__extends(MixedTextDisplay, _super);
        function MixedTextDisplay() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        MixedTextDisplay.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("span", {
                class: DCGView.const("mixed-text-display")
            }, DCGView.createElement(For, {
                each: this.bindFn(this.getComponents),
                key: function(x) {
                    return x.id
                }
            }, DCGView.createElement("span", {
                class: DCGView.const("nobr")
            }, function(range) {
                if (range.type === "text") {
                    return DCGView.createElement(rich_text_1.RichText, {
                        text: function() {
                            return range.value
                        },
                        disableLinks: function() {
                            return !!(_this.props.disableLinks && _this.props.disableLinks())
                        }
                    })
                } else {
                    var optionalOnTap = _this.props.onTapMathquill ? {
                        onTap: function() {
                            return _this.props.onTapMathquill({
                                idx: range.idx
                            })
                        }
                    } : {};
                    return DCGView.createElement(Mathquill, tslib_1.__assign({
                        latex: function() {
                            return range.value
                        }
                    }, optionalOnTap))
                }
            })), DCGView.createElement(If, {
                predicate: function() {
                    return _this.getComponents().length === 0
                }
            }, function() {
                return DCGView.createElement("span", {
                    class: DCGView.const("empty-text")
                }, function() {
                    return typeof _this.props.placeholder === "function" ? _this.props.placeholder() : undefined
                })
            }))
        }
        ;
        MixedTextDisplay.prototype.getComponents = function() {
            var ranges;
            var content = this.props.content();
            if (content && this.props.trimWhitespace && this.props.trimWhitespace()) {
                content = content.trim().replace(/(\r?\n){3,}/g, "\n\n")
            }
            if (content && math_helpers_1.isMathInGoodState(content)) {
                ranges = math_helpers_1.getRanges(content)
            } else {
                var c = content || "";
                ranges = [{
                    from: 0,
                    to: c.length,
                    type: "text",
                    text: c
                }]
            }
            return ranges.map(function(range, i) {
                return {
                    type: range.type,
                    value: range.text,
                    idx: i,
                    id: i + " " + range.text
                }
            })
        }
        ;
        return MixedTextDisplay
    }(DCGView.Class);
    exports.MixedTextDisplay = MixedTextDisplay
});
define("teacher-spa/data/activity-time-estimates", ["require", "exports", "../../lib/i18n"], function(require, exports, i18n) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.estimateChoices = [{
        key: undefined,
        text: function() {
            return i18n.s("ab-edit-label-time-estimate-choose-one")
        }
    }, {
        key: 15,
        text: function() {
            return i18n.s("ab-edit-label-time-estimate-15-30")
        }
    }, {
        key: 30,
        text: function() {
            return i18n.s("ab-edit-label-time-estimate-30-45")
        }
    }, {
        key: 45,
        text: function() {
            return i18n.s("ab-edit-label-time-estimate-45-60")
        }
    }, {
        key: 60,
        text: function() {
            return i18n.s("ab-edit-label-time-estimate-60-plus")
        }
    }]
});
define("teacher-spa/data/activity-categories", ["require", "exports", "lib/i18n"], function(require, exports, i18n) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.categoryChoices = [{
        key: undefined,
        text: function() {
            return i18n.s("ab-edit-label-activity-category-choose-one")
        }
    }, {
        key: "intro",
        text: function() {
            return i18n.s("ab-edit-label-activity-category-introduction")
        }
    }, {
        key: "development",
        text: function() {
            return i18n.s("ab-edit-label-activity-category-development")
        }
    }, {
        key: "practice",
        text: function() {
            return i18n.s("ab-edit-label-activity-category-practice")
        }
    }, {
        key: "application",
        text: function() {
            return i18n.s("ab-edit-label-activity-category-application")
        }
    }]
});
define("loadcss!shared/dcgviews/dropdown/dropdown-popover", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/dcgviews/dropdown/dropdown-popover.css", decodeURIComponent(".dropdown-popover-container%20%7B%0A%20%20position%3A%20relative%3B%0A%20%20display%3A%20inline-block%3B%0A%7D%0A.dropdown-container%20%7B%0A%20%20z-index%3A%2031%3B%0A%20%20background%3A%20%23fff%3B%0A%20%20border%3A%201px%20solid%20%23ccc%3B%0A%20%20border-radius%3A%205px%3B%0A%20%20color%3A%20%23bbb%3B%0A%7D%0A.dropdown-container%3Anot(.dropdown-pops-up)%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20100%25%3B%0A%20%20right%3A%200%3B%0A%20%20-webkit-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-moz-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-o-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-ms-animation%3A%20fadeInDown%200.2s%3B%0A%20%20animation%3A%20fadeInDown%200.2s%3B%0A%20%20-webkit-box-shadow%3A%200%205px%2010px%20rgba(0%2C0%2C0%2C0.2)%3B%0A%20%20box-shadow%3A%200%205px%2010px%20rgba(0%2C0%2C0%2C0.2)%3B%0A%7D%0A.dropdown-container.dropdown-pops-up%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20bottom%3A%20100%25%3B%0A%20%20right%3A%200%3B%0A%20%20-webkit-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-moz-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-o-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-ms-animation%3A%20fadeInDown%200.2s%3B%0A%20%20animation%3A%20fadeInDown%200.2s%3B%0A%20%20-webkit-box-shadow%3A%200%20-5px%2010px%20rgba(0%2C0%2C0%2C0.2)%3B%0A%20%20box-shadow%3A%200%20-5px%2010px%20rgba(0%2C0%2C0%2C0.2)%3B%0A%7D%0A"))
});
define("shared/dcgviews/dropdown/dropdown-popover", ["require", "exports", "tslib", "dcgview", "jquery", "lib/i18n", "underscore", "loadcss!./dropdown-popover"], function(require, exports, tslib_1, DCGView, $, i18n, _) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var If = DCGView.Components.If;
    var DropdownPopover = function(_super) {
        tslib_1.__extends(DropdownPopover, _super);
        function DropdownPopover() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        DropdownPopover.prototype.init = function() {
            this.showDropdown = false;
            if (!this.children || this.children.length !== 1 || typeof this.children[0] !== "function") {
                throw new Error("<DropdownPopover> expects a single child that is a function")
            }
        }
        ;
        DropdownPopover.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                class: function() {
                    var _a;
                    return _a = {
                        "dropdown-popover-container": true
                    },
                        _a[_this.props.class === undefined ? "" : _this.props.class()] = _this.props.class !== undefined,
                        _a
                },
                didMount: this.bindFn(this.didMountDropdown),
                didUnmount: this.bindFn(this.didUnmountDropdown)
            }, DCGView.createElement("div", {
                role: DCGView.const("link"),
                tabindex: DCGView.const(0),
                "aria-label": this.bindFn(this.getTitle),
                "aria-expanded": this.bindFn(this.isDropdownOpen),
                didMount: function(anchor) {
                    return _this.anchor = anchor
                },
                class: function() {
                    return {
                        "anchor-container": true,
                        isOpen: _this.isDropdownOpen()
                    }
                },
                onTap: function(evt) {
                    _this.openedFromKeyboard = evt.device === "keyboard";
                    _this.setDropdownOpen(!_this.isDropdownOpen())
                }
            }, this.props.anchor()), DCGView.createElement(If, {
                predicate: this.bindFn(this.isDropdownOpen)
            }, function() {
                return DCGView.createElement("div", {
                    class: function() {
                        return {
                            "dropdown-container": true,
                            "dropdown-pops-up": _this.props.popUp && _this.props.popUp()
                        }
                    },
                    didMount: function(node) {
                        if (_this.props.dropdownDidMount) {
                            _this.props.dropdownDidMount(node)
                        }
                    }
                }, _this.children[0]())
            }))
        }
        ;
        DropdownPopover.prototype.didMountDropdown = function(node) {
            var _this = this;
            this.listenerId = _.uniqueId("dropdown-container");
            $(document.body).on("dcg-tap." + this.listenerId, function(event) {
                if (event.target === node || $.contains(node, event.target)) {
                    return
                }
                if (_this.isDropdownOpen()) {
                    var dropdownContainer = $(node).find(".dropdown-container")[0];
                    if ($.contains(dropdownContainer, event.target)) {
                        return
                    }
                    var rect = dropdownContainer.getBoundingClientRect();
                    if (event.clientX > rect.left && event.clientX < rect.right && event.clientY > rect.top && event.clientY < rect.bottom) {
                        return
                    }
                    _this.setDropdownOpen(false);
                    return
                }
            });
            $(document).on("scroll." + this.listenerId, function() {
                if (!_this.openedFromKeyboard && _this.isDropdownOpen()) {
                    _this.setDropdownOpen(false)
                }
            })
        }
        ;
        DropdownPopover.prototype.didUnmountDropdown = function() {
            this.showDropdown = false;
            $(document.body).off("." + this.listenerId);
            $(document).off("." + this.listenerId)
        }
        ;
        DropdownPopover.prototype.getTitle = function() {
            if (!this.props.title) {
                return i18n.s("ab-edit-button-more-options-menu")
            }
            return this.props.title()
        }
        ;
        DropdownPopover.prototype.isDropdownOpen = function() {
            if (this.props.controlled) {
                return this.props.controlled().isOpen
            }
            return this.showDropdown
        }
        ;
        DropdownPopover.prototype.setDropdownOpen = function(isOpen) {
            if (this.props.disabled && this.props.disabled()) {
                return
            }
            if (this.props.controlled) {
                this.props.controlled().setDropdownOpen(isOpen)
            } else {
                this.showDropdown = isOpen;
                this.update()
            }
        }
        ;
        return DropdownPopover
    }(DCGView.Class);
    exports.DropdownPopover = DropdownPopover
});
define("loadcss!shared/dcgviews/dropdown/options-dropdown", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/dcgviews/dropdown/options-dropdown.css", decodeURIComponent(".options-dropdown%20%7B%0A%20%20padding%3A%2010px%3B%0A%7D%0A.options-dropdown%20.dropdown-explanations%20%7B%0A%20%20font-size%3A%2080%25%3B%0A%20%20padding%3A%203px%207px%3B%0A%20%20min-width%3A%20190px%3B%0A%7D%0A.options-dropdown%20.dropdown-explanations%20.explanation%20%7B%0A%20%20margin-bottom%3A%205px%3B%0A%7D%0A.options-dropdown%20.dropdown-explanations%20.explanation%20a%20%7B%0A%20%20color%3A%20%234781b9%3B%0A%20%20white-space%3A%20nowrap%3B%0A%20%20margin-bottom%3A%205px%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%20%7B%0A%20%20padding%3A%207px%3B%0A%20%20display%3A%20block%3B%0A%20%20color%3A%20%23666%3B%0A%20%20text-decoration%3A%20none%3B%0A%20%20white-space%3A%20nowrap%3B%0A%20%20white-space%3A%20nowrap%3B%0A%20%20overflow%3A%20hidden%3B%0A%20%20-o-text-overflow%3A%20ellipsis%3B%0A%20%20text-overflow%3A%20ellipsis%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).selected%2C%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).dcg-hovered%2C%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).dcg-depressed%20%7B%0A%20%20color%3A%20%23000%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).selected%20span%2C%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).dcg-hovered%20span%2C%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).dcg-depressed%20span%20%7B%0A%20%20text-decoration%3A%20underline%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).red-link%20%7B%0A%20%20color%3A%20%23c0504d%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).red-link.dcg-hovered%20%7B%0A%20%20color%3A%20%23ad1a1a%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).red-link.dcg-depressed%20%7B%0A%20%20color%3A%20%23860606%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).blue-link%20%7B%0A%20%20color%3A%20%234781b9%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).blue-link.dcg-hovered%20%7B%0A%20%20color%3A%20%23004f9b%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%3Anot(.dropdown-choice-disabled).blue-link.dcg-depressed%20%7B%0A%20%20color%3A%20%23033b70%3B%0A%7D%0A.options-dropdown%20.dropdown-choice.dropdown-choice-disabled%20%7B%0A%20%20color%3A%20%23bbb%3B%0A%20%20cursor%3A%20default%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%20.option-icon-container%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20width%3A%2020px%3B%0A%20%20text-align%3A%20center%3B%0A%20%20margin-right%3A%2010px%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%20.option-icon-container%20.option-icon%20%7B%0A%20%20font-size%3A%2090%25%3B%0A%7D%0A.options-dropdown%20.dropdown-choice%20.option-subtitle%20%7B%0A%20%20display%3A%20block%3B%0A%20%20margin-left%3A%2030px%3B%0A%20%20font-size%3A%2080%25%3B%0A%20%20text-decoration%3A%20underline%3B%0A%7D%0A"))
});
define("shared/dcgviews/dropdown/options-dropdown", ["require", "exports", "tslib", "lib/i18n", "dcgview", "./dropdown-popover", "loadcss!./options-dropdown"], function(require, exports, tslib_1, i18n, DCGView, dropdown_popover_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , For = _a.For
        , If = _a.If
        , IfDefined = _a.IfDefined
        , Switch = _a.Switch;
    var OptionsDropdown = function(_super) {
        tslib_1.__extends(OptionsDropdown, _super);
        function OptionsDropdown() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        OptionsDropdown.prototype.init = function() {
            this.showDropdown = false
        }
        ;
        OptionsDropdown.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(dropdown_popover_1.DropdownPopover, {
                dropdownDidMount: this.props.dropdownDidMount,
                anchor: this.props.anchor,
                class: this.props.class,
                controlled: this.props.controlled || function() {
                    return {
                        isOpen: _this.showDropdown,
                        setDropdownOpen: _this.bindFn(_this.setDropdownOpen)
                    }
                }
                ,
                title: this.props.title,
                disabled: this.props.disabled
            }, function() {
                return DCGView.createElement(For, {
                    each: _this.props.options,
                    key: function(opt) {
                        return opt.key ? opt.key : opt.title()
                    }
                }, DCGView.createElement("div", {
                    role: DCGView.const("list"),
                    class: function() {
                        var _a;
                        return _a = {
                            "options-dropdown": true
                        },
                            _a[_this.props.class === undefined ? "" : _this.props.class()] = _this.props.class !== undefined,
                            _a
                    }
                }, function(option) {
                    return DCGView.createElement("div", {
                        role: DCGView.const("listitem"),
                        class: DCGView.const("dropdown-option-container")
                    }, DCGView.createElement(Switch, {
                        key: function() {
                            return !!option.href
                        }
                    }, function(hasHref) {
                        if (hasHref) {
                            return DCGView.createElement("a", {
                                "aria-disabled": function() {
                                    return option.disabled
                                },
                                class: function() {
                                    var _a;
                                    return _a = {},
                                        _a[option.class || ""] = !!option.class,
                                        _a["dropdown-choice"] = true,
                                        _a["dropdown-choice-disabled"] = option.disabled,
                                        _a
                                },
                                onTap: function() {
                                    return !option.disabled && _this.tapOption(option)
                                },
                                href: function() {
                                    return option.href !== undefined ? option.href : ""
                                },
                                target: function() {
                                    return option.target !== undefined ? option.target : ""
                                },
                                rel: function() {
                                    return option.noreferrer ? "noreferrer noopener" : ""
                                }
                            }, DCGView.createElement(If, {
                                predicate: function() {
                                    return option.icon != null
                                }
                            }, function() {
                                return DCGView.createElement("div", {
                                    class: DCGView.const("option-icon-container")
                                }, DCGView.createElement("i", {
                                    "aria-hidden": DCGView.const("true"),
                                    class: function() {
                                        return option.icon + " option-icon"
                                    }
                                }))
                            }), option.title)
                        } else {
                            return DCGView.createElement("div", {
                                role: DCGView.const("link"),
                                tabindex: DCGView.const(0),
                                "aria-disabled": function() {
                                    return option.disabled
                                },
                                class: function() {
                                    var _a;
                                    return _a = {},
                                        _a[option.class || ""] = !!option.class,
                                        _a["dropdown-choice"] = true,
                                        _a["dropdown-choice-disabled"] = option.disabled,
                                        _a
                                },
                                onTap: function() {
                                    return !option.disabled && _this.tapOption(option)
                                }
                            }, DCGView.createElement(If, {
                                predicate: function() {
                                    return option.icon != null
                                }
                            }, function() {
                                return DCGView.createElement("div", {
                                    class: DCGView.const("option-icon-container")
                                }, DCGView.createElement("i", {
                                    "aria-hidden": DCGView.const("true"),
                                    class: function() {
                                        return option.icon + " option-icon"
                                    }
                                }))
                            }), DCGView.createElement("span", {
                                class: DCGView.const("option-title")
                            }, option.title), IfDefined(function() {
                                return option.subtitle && option.subtitle()
                            }, function(subtitle) {
                                return DCGView.createElement("span", {
                                    class: DCGView.const("option-subtitle")
                                }, subtitle)
                            }))
                        }
                    }), DCGView.createElement(If, {
                        predicate: function() {
                            return !!option.explanations
                        }
                    }, function() {
                        return DCGView.createElement(For, {
                            each: function() {
                                return option.explanations || []
                            },
                            key: function(i) {
                                return i.flag
                            }
                        }, DCGView.createElement("div", {
                            class: DCGView.const("dropdown-explanations")
                        }, function(i) {
                            return DCGView.createElement("div", {
                                class: DCGView.const("explanation")
                            }, function() {
                                return i.explanation
                            }, DCGView.const(" "), DCGView.createElement(If, {
                                predicate: function() {
                                    return !!i.link
                                }
                            }, function() {
                                return DCGView.createElement("a", {
                                    class: DCGView.const("learn-more"),
                                    href: function() {
                                        return i.link !== undefined ? i.link : ""
                                    },
                                    target: DCGView.const("_blank")
                                }, function() {
                                    return i.linkText ? i.linkText : i18n.s("global-button-learn-more-capitalized")
                                })
                            }))
                        }))
                    }))
                }))
            })
        }
        ;
        OptionsDropdown.prototype.tapOption = function(option) {
            var _this = this;
            if (!option.preventClose) {
                this.showDropdown = false
            }
            if (option.action !== undefined)
                option.action();
            if (option.href) {
                setTimeout(function() {
                    return _this.update()
                }, 0)
            }
        }
        ;
        OptionsDropdown.prototype.setDropdownOpen = function(isOpen) {
            this.showDropdown = isOpen;
            this.update()
        }
        ;
        return OptionsDropdown
    }(DCGView.Class);
    exports.OptionsDropdown = OptionsDropdown
});
define("loadcss!shared/dcgviews/dropdown/dot-dot-options-dropdown", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/dcgviews/dropdown/dot-dot-options-dropdown.css", decodeURIComponent(".dot-dot-dropdown-container%20.dot-dot-dropdown-anchor%20%7B%0A%20%20line-height%3A%2040px%3B%0A%7D%0A.dot-dot-dropdown-container%20.dot-dot-dropdown-anchor%20.dot-dot-container%20%7B%0A%20%20display%3A%20block%3B%0A%20%20width%3A%2030px%3B%0A%20%20height%3A%2040px%3B%0A%20%20padding-top%3A%2011px%3B%0A%20%20cursor%3A%20pointer%3B%0A%7D%0A.dot-dot-dropdown-container%20.dot-dot-dropdown-anchor%20.dot-dot-container%20span%20%7B%0A%20%20width%3A%204px%3B%0A%20%20height%3A%204px%3B%0A%20%20background%3A%20rgba(0%2C0%2C0%2C0.3)%3B%0A%20%20border-radius%3A%204px%3B%0A%20%20display%3A%20inline-block%3B%0A%20%20float%3A%20left%3B%0A%20%20clear%3A%20left%3B%0A%20%20margin-left%3A%2013px%3B%0A%20%20margin-bottom%3A%203px%3B%0A%7D%0A.dot-dot-dropdown-container%20.anchor-container.dcg-hovered%20.dot-dot-dropdown-anchor%20.dot-dot-container%20span%20%7B%0A%20%20background%3A%20rgba(0%2C0%2C0%2C0.5)%3B%0A%7D%0A.dot-dot-dropdown-container%20.anchor-container.isOpen%20.dot-dot-dropdown-anchor%20.dot-dot-container%20span%2C%0A.dot-dot-dropdown-container%20.anchor-container.dcg-depressed%20.dot-dot-dropdown-anchor%20.dot-dot-container%20span%20%7B%0A%20%20background%3A%20rgba(0%2C0%2C0%2C0.8)%3B%0A%7D%0A"))
});
define("shared/dcgviews/dropdown/dot-dot-options-dropdown", ["require", "exports", "tslib", "lib/i18n", "dcgview", "shared/dcgviews/dropdown/options-dropdown", "loadcss!./dot-dot-options-dropdown"], function(require, exports, tslib_1, i18n, DCGView, options_dropdown_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var DotDotOptionsDropdown = function(_super) {
        tslib_1.__extends(DotDotOptionsDropdown, _super);
        function DotDotOptionsDropdown() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        DotDotOptionsDropdown.prototype.template = function() {
            var _this = this;
            var dotDotAnchor = DCGView.createElement("div", {
                class: DCGView.const("dot-dot-dropdown-anchor")
            }, DCGView.createElement("div", {
                "aria-label": this.bindFn(this.getAriaLabel),
                class: DCGView.const("dot-dot-container")
            }, DCGView.createElement("span", null), DCGView.createElement("span", null), DCGView.createElement("span", null)));
            return DCGView.createElement("div", {
                class: DCGView.const("dot-dot-dropdown-container"),
                role: function() {
                    return _this.props.role && _this.props.role()
                }
            }, DCGView.createElement(options_dropdown_1.OptionsDropdown, {
                anchor: this.const(dotDotAnchor),
                options: this.props.dropdownOptions,
                class: this.props.class
            }))
        }
        ;
        DotDotOptionsDropdown.prototype.getAriaLabel = function() {
            if (this.props.ariaLabel) {
                return this.props.ariaLabel()
            }
            return i18n.s("global-label-options")
        }
        ;
        return DotDotOptionsDropdown
    }(DCGView.Class);
    exports.DotDotOptionsDropdown = DotDotOptionsDropdown
});
define("void-elements", {
    area: true,
    base: true,
    br: true,
    col: true,
    embed: true,
    hr: true,
    img: true,
    input: true,
    keygen: true,
    link: true,
    menuitem: true,
    meta: true,
    param: true,
    source: true,
    track: true,
    wbr: true
});
define("html-parse-stringify2/lib/parse-tag", ["require", "exports", "module", "void-elements"], function(require, exports, module) {
    var attrRE = /([\w-]+)|=|(['"])([.\s\S]*?)\2/g;
    var voidElements = require("void-elements");
    module.exports = function(tag) {
        var i = 0;
        var key;
        var expectingValueAfterEquals = true;
        var res = {
            type: "tag",
            name: "",
            voidElement: false,
            attrs: {},
            children: []
        };
        tag.replace(attrRE, function(match) {
            if (match === "=") {
                expectingValueAfterEquals = true;
                i++;
                return
            }
            if (!expectingValueAfterEquals) {
                if (key) {
                    res.attrs[key] = key
                }
                key = match
            } else {
                if (i === 0) {
                    if (voidElements[match] || tag.charAt(tag.length - 2) === "/") {
                        res.voidElement = true
                    }
                    res.name = match
                } else {
                    res.attrs[key] = match.replace(/^['"]|['"]$/g, "");
                    key = undefined
                }
            }
            i++;
            expectingValueAfterEquals = false
        });
        return res
    }
});
define("html-parse-stringify2/lib/parse", ["require", "exports", "module", "./parse-tag"], function(require, exports, module) {
    var tagRE = /(?:<!--[\S\s]*?-->|<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>)/g;
    var parseTag = require("./parse-tag");
    var empty = Object.create ? Object.create(null) : {};
    function pushTextNode(list, html, level, start, ignoreWhitespace) {
        var end = html.indexOf("<", start);
        var content = html.slice(start, end === -1 ? undefined : end);
        if (/^\s*$/.test(content)) {
            content = " "
        }
        if (!ignoreWhitespace && end > -1 && level + list.length >= 0 || content !== " ") {
            list.push({
                type: "text",
                content: content
            })
        }
    }
    module.exports = function parse(html, options) {
        options || (options = {});
        options.components || (options.components = empty);
        var result = [];
        var current;
        var level = -1;
        var arr = [];
        var byTag = {};
        var inComponent = false;
        html.replace(tagRE, function(tag, index) {
            if (inComponent) {
                if (tag !== "</" + current.name + ">") {
                    return
                } else {
                    inComponent = false
                }
            }
            var isOpen = tag.charAt(1) !== "/";
            var isComment = tag.indexOf("\x3c!--") === 0;
            var start = index + tag.length;
            var nextChar = html.charAt(start);
            var parent;
            if (isOpen && !isComment) {
                level++;
                current = parseTag(tag);
                if (current.type === "tag" && options.components[current.name]) {
                    current.type = "component";
                    inComponent = true
                }
                if (!current.voidElement && !inComponent && nextChar && nextChar !== "<") {
                    pushTextNode(current.children, html, level, start, options.ignoreWhitespace)
                }
                byTag[current.tagName] = current;
                if (level === 0) {
                    result.push(current)
                }
                parent = arr[level - 1];
                if (parent) {
                    parent.children.push(current)
                }
                arr[level] = current
            }
            if (isComment || !isOpen || current.voidElement) {
                if (!isComment) {
                    level--
                }
                if (!inComponent && nextChar !== "<" && nextChar) {
                    parent = level === -1 ? result : arr[level].children;
                    pushTextNode(parent, html, level, start, options.ignoreWhitespace)
                }
            }
        });
        if (!result.length && html.length) {
            pushTextNode(result, html, 0, 0, options.ignoreWhitespace)
        }
        return result
    }
});
define("html-parse-stringify2/lib/stringify", ["require", "exports", "module"], function(require, exports, module) {
    function attrString(attrs) {
        var buff = [];
        for (var key in attrs) {
            buff.push(key + '="' + attrs[key] + '"')
        }
        if (!buff.length) {
            return ""
        }
        return " " + buff.join(" ")
    }
    function stringify(buff, doc) {
        switch (doc.type) {
            case "text":
                return buff + doc.content;
            case "tag":
                buff += "<" + doc.name + (doc.attrs ? attrString(doc.attrs) : "") + (doc.voidElement ? "/>" : ">");
                if (doc.voidElement) {
                    return buff
                }
                return buff + doc.children.reduce(stringify, "") + "</" + doc.name + ">"
        }
    }
    module.exports = function(doc) {
        return doc.reduce(function(token, rootEl) {
            return token + stringify("", rootEl)
        }, "")
    }
});
define("html-parse-stringify2/index", ["require", "exports", "module", "./lib/parse", "./lib/stringify"], function(require, exports, module) {
    module.exports = {
        parse: require("./lib/parse"),
        stringify: require("./lib/stringify")
    }
});
define("html-parse-stringify2", ["html-parse-stringify2/index"], function(main) {
    return main
});
define("vendor/l10n-tools/localize-serializer", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.variableRegexp = /\{\$([a-zA-Z0-9\-]+([a-zA-Z0-9\-]+_)*[a-zA-Z0-9\-]+)\}/;
    function serializeToTemplateString(root, ctx) {
        var bindingCount = 0;
        var elementCount = 0;
        var knownBindingNames = {};
        var knownViewNames = {};
        var templateString = serialize(root);
        if (!/^<0>/.test(templateString) || !/<\/0>$/.test(templateString)) {
            throw new Error("Expected template string to start and end with <0> and </0>, but found " + JSON.stringify(templateString))
        }
        return templateString.slice(3, -4).trim();
        function serialize(node) {
            if (ctx.isConst(node)) {
                return escapeSpecialFluentCharacters(ctx.getConstValue(node))
            } else if (ctx.isNamedBinding(node)) {
                var name = getUniqueName(knownBindingNames, ctx.getBindingName(node));
                var variable = "{$" + name + "}";
                if (!exports.variableRegexp.test(variable)) {
                    throw new Error("Invalid <Localize> variable: " + variable + ".")
                }
                if (ctx.addBinding)
                    ctx.addBinding(name, node);
                knownBindingNames[name] = true;
                return variable
            } else if (node !== root && ctx.isView(node)) {
                var name = getUniqueName(knownViewNames, ctx.getViewName(node));
                if (!/[a-zA-Z0-9\-_]/.test(name)) {
                    throw new Error("Invalid <Localize> subview identifier: " + name + ".")
                }
                if (ctx.addView)
                    ctx.addView(name, node);
                knownViewNames[name] = true;
                return "<" + name + "/>"
            } else if (ctx.isBinding(node)) {
                var name = getUniqueName(knownBindingNames, "v" + bindingCount++);
                var variable = "{$" + name + "}";
                if (ctx.addBinding)
                    ctx.addBinding(name, node);
                knownBindingNames[name] = true;
                return variable
            } else {
                var name = "" + elementCount++;
                if (ctx.addElement)
                    ctx.addElement(name, node);
                var serializedChildren_1 = [];
                ctx.forEachChild(node, function(child) {
                    serializedChildren_1.push(serialize(child))
                });
                knownViewNames[name] = true;
                return serializedChildren_1.length > 0 ? "<" + name + ">" + serializedChildren_1.join("") + "</" + name + ">" : "<" + name + "/>"
            }
        }
        function getUniqueName(knownNames, baseName) {
            var counter = 0;
            var candidate = baseName;
            while (knownNames[candidate]) {
                candidate = baseName + "-" + ++counter
            }
            return candidate
        }
    }
    exports.serializeToTemplateString = serializeToTemplateString;
    function escapeSpecialFluentCharacters(text) {
        return text.replace(/\{|\}/g, function(match) {
            return '{"' + match + '"}'
        }).replace(/(^|[\s\n]+)(\[|\]|\.)/g, function(_match, whitespace, character) {
            return whitespace + '{"' + character + '"}'
        })
    }
});
define("shared/dcgviews/localize", ["require", "exports", "tslib", "dcgview", "html-parse-stringify2", "../../vendor/l10n-tools/localize-serializer", "core/lib/i18n", "bugsnag"], function(require, exports, tslib_1, DCGView, html_parse_stringify2_1, localize_serializer_1, i18n_1, bugsnag_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function isNamedBinding(fn) {
        return fn.__DCGViewLocalizeBindingName
    }
    function isNamedSubview(fn) {
        return typeof fn === "function" && fn.__DCGViewLocalizeViewName
    }
    var Localize = function(_super) {
        tslib_1.__extends(Localize, _super);
        function Localize() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        Localize.prototype.init = function() {
            var _this = this;
            this.viewMap = {};
            this.elementMap = {};
            this.bindingMap = {};
            var i18n_ = this.props.i18n ? this.props.i18n() : i18n_1.i18n;
            this.translatedString = function() {
                var vars = {};
                for (var identifier in _this.bindingMap) {
                    vars[identifier] = i18n_1.i18n.raw("{$" + identifier + "}")
                }
                return i18n_.s(_this.props.key(), vars)
            }
            ;
            this.templateString = this.serializeToTemplateString(DCGView.createElement("div", null, this.children));
            if (this.props.onTemplateString) {
                this.props.onTemplateString(this.templateString)
            }
        }
        ;
        Localize.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(DCGView.Components.Switch, {
                key: function() {
                    return getParseableTemplateString(_this.translatedString())
                }
            }, function(templateString) {
                return _this.renderDeserializedTemplateNode(_this.parseAndValidate(templateString))
            })
        }
        ;
        Localize.variable = function(alias, bindingFn) {
            var namedBinding = function() {
                return bindingFn()
            };
            namedBinding.__DCGViewLocalizeBindingName = alias;
            return namedBinding
        }
        ;
        Localize.subview = function(alias, createView) {
            var subview = function() {
                return createView()
            };
            subview.__DCGViewLocalizeViewName = alias;
            return subview
        }
        ;
        Localize.prototype.parseAndValidate = function(templateString) {
            var parsed = html_parse_stringify2_1.parse(templateString);
            var actualBindings = {};
            var actualElements = {};
            visit(parsed);
            for (var name in this.elementMap) {
                if (!actualElements[name]) {
                    bugsnag_1.Bugsnag.notify("Missing element " + name + ' in translated <Localize> template "' + templateString + '" (original: ' + this.templateString + ").");
                    return html_parse_stringify2_1.parse(getParseableTemplateString(this.templateString))
                }
            }
            for (var name in this.bindingMap) {
                if (!actualBindings[name]) {
                    bugsnag_1.Bugsnag.notify("Missing binding " + name + ' in translated <Localize> template "' + templateString + '" (original: ' + this.templateString + ").");
                    return html_parse_stringify2_1.parse(getParseableTemplateString(this.templateString))
                }
            }
            return parsed;
            function visit(node) {
                if (Array.isArray(node)) {
                    for (var _i = 0, node_1 = node; _i < node_1.length; _i++) {
                        var child = node_1[_i];
                        visit(child)
                    }
                    return
                }
                if (node.name === "token") {
                    actualBindings[node.attrs.id] = true
                } else if (node.type !== "text") {
                    actualElements[node.name] = true;
                    visit(node.children)
                }
            }
        }
        ;
        Localize.prototype.renderDeserializedTemplateNode = function(node) {
            var _this = this;
            if (Array.isArray(node)) {
                return node.map(function(n) {
                    return _this.renderDeserializedTemplateNode(n)
                })
            }
            if (node.type === "text") {
                return DCGView.const(node.content || "")
            } else if (node.name === "token") {
                var binding = this.bindingMap[node.attrs.id];
                if (!binding) {
                    bugsnag_1.Bugsnag.notify("Unknown binding " + node.attrs.id + " in <Localize> template " + this.translatedString());
                    return function() {
                        return ""
                    }
                }
                return binding
            } else {
                if (this.elementMap[node.name]) {
                    var element = this.elementMap[node.name];
                    var children = node.children.map(function(child) {
                        return _this.renderDeserializedTemplateNode(child)
                    });
                    return createElement(element.type, element.attrs, children)
                } else if (this.viewMap[node.name]) {
                    return this.viewMap[node.name]()
                } else {
                    bugsnag_1.Bugsnag.notify("Unknown element " + node.attrs.id + " in <Localize> template " + this.translatedString());
                    return createElement("span", {}, [])
                }
            }
        }
        ;
        Localize.prototype.serializeToTemplateString = function(node) {
            var _this = this;
            return localize_serializer_1.serializeToTemplateString(node, {
                isView: isNamedSubview,
                isConst: isConst,
                isBinding: function(n) {
                    return typeof n === "function"
                },
                isNamedBinding: isNamedBinding,
                getConstValue: function(n) {
                    return n()
                },
                getBindingName: function(n) {
                    return n.__DCGViewLocalizeBindingName
                },
                getViewName: function(n) {
                    return n.__DCGViewLocalizeViewName
                },
                addBinding: function(identifier, node) {
                    _this.bindingMap[identifier] = node
                },
                addElement: function(identifier, node) {
                    _this.elementMap[identifier] = {
                        type: node.tagName,
                        attrs: node.attrs
                    }
                },
                addView: function(identifier, node) {
                    if (_this.viewMap[identifier]) {
                        throw new Error("Unexpected duplicate view " + identifier + ".")
                    }
                    _this.viewMap[identifier] = node
                },
                forEachChild: function(node, cb) {
                    for (var _i = 0, _a = node.children; _i < _a.length; _i++) {
                        var child = _a[_i];
                        if (!isConst(child) && typeof child !== "function" && child._isDCGView) {
                            throw new Error("Bare DCGViews are not allowed inside <Localize>. Use Localize.subview().")
                        }
                        cb(child)
                    }
                }
            })
        }
        ;
        return Localize
    }(DCGView.Class);
    exports.Localize = Localize;
    function isConst(x) {
        return typeof x === "function" && x.isDCGViewConst
    }
    function createElement(type, props, children) {
        var d = DCGView;
        return d.createElement(type, props, children)
    }
    function getParseableTemplateString(templateString) {
        var translated = "<0>" + templateString + "</0>";
        return translated.replace(new RegExp(localize_serializer_1.variableRegexp.source,"g"), function(_, identifier) {
            return '<token id="' + identifier + '"/>'
        })
    }
});
define("loadcss!shared-components/modal", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared-components/modal.css", decodeURIComponent(".dcg-shared-modal-cover%20%7B%0A%20%20position%3A%20fixed%3B%0A%20%20top%3A%200%3B%0A%20%20left%3A%200%3B%0A%20%20width%3A%20100%25%3B%0A%20%20height%3A%20100%25%3B%0A%20%20z-index%3A%2020%3B%0A%2F**%0A%20%20*%20%20layout%20of%20the%20various%20modal%20types%0A%20%20*%2F%0A%7D%0A.dcg-shared-modal-cover%20.dcg-shared-modal-background%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%200%3B%0A%20%20left%3A%200%3B%0A%20%20bottom%3A%200%3B%0A%20%20right%3A%200%3B%0A%20%20background%3A%20rgba(0%2C0%2C0%2C0.7)%3B%0A%7D%0A.dcg-shared-modal-cover%20.dcg-shared-modal-transition-container%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-pack%3A%20center%3B%0A%20%20-moz-box-pack%3A%20center%3B%0A%20%20-o-box-pack%3A%20center%3B%0A%20%20-ms-flex-pack%3A%20center%3B%0A%20%20-webkit-justify-content%3A%20center%3B%0A%20%20justify-content%3A%20center%3B%0A%7D%0A.dcg-shared-modal-cover%20.dcg-shared-modal%20%7B%0A%20%20position%3A%20relative%3B%0A%7D%0A.dcg-shared-modal-cover.dcg-shared-modal-wide%20.dcg-shared-modal%2C%0A.dcg-shared-modal-cover.dcg-shared-modal-medium%20.dcg-shared-modal%2C%0A.dcg-shared-modal-cover.dcg-shared-modal-narrow%20.dcg-shared-modal%20%7B%0A%20%20-webkit-animation%3A%20dcgSharedFadeInDown%200.3s%3B%0A%20%20-moz-animation%3A%20dcgSharedFadeInDown%200.3s%3B%0A%20%20-o-animation%3A%20dcgSharedFadeInDown%200.3s%3B%0A%20%20-ms-animation%3A%20dcgSharedFadeInDown%200.3s%3B%0A%20%20animation%3A%20dcgSharedFadeInDown%200.3s%3B%0A%7D%0A.dcg-shared-modal-cover.dcg-shared-modal-background%2C%0A.dcg-shared-modal-cover.dcg-shared-modal-fullscreen%20.dcg-shared-modal%20%7B%0A%20%20-webkit-animation%3A%20dcgSharedFadeIn%200.3s%3B%0A%20%20-moz-animation%3A%20dcgSharedFadeIn%200.3s%3B%0A%20%20-o-animation%3A%20dcgSharedFadeIn%200.3s%3B%0A%20%20-ms-animation%3A%20dcgSharedFadeIn%200.3s%3B%0A%20%20animation%3A%20dcgSharedFadeIn%200.3s%3B%0A%7D%0A.dcg-shared-modal-cover.dcg-shared-modal-wide%20.dcg-shared-modal-transition-container%2C%0A.dcg-shared-modal-cover.dcg-shared-modal-medium%20.dcg-shared-modal-transition-container%2C%0A.dcg-shared-modal-cover.dcg-shared-modal-narrow%20.dcg-shared-modal-transition-container%20%7B%0A%20%20margin-top%3A%2030px%3B%0A%7D%0A.dcg-shared-modal-cover.dcg-shared-modal-wide%20.dcg-shared-modal-contents-wrapper%2C%0A.dcg-shared-modal-cover.dcg-shared-modal-medium%20.dcg-shared-modal-contents-wrapper%2C%0A.dcg-shared-modal-cover.dcg-shared-modal-narrow%20.dcg-shared-modal-contents-wrapper%20%7B%0A%20%20max-height%3A%20calc(100vh%20-%2060px)%3B%0A%20%20overflow-y%3A%20auto%3B%0A%7D%0A.dcg-shared-modal-cover.dcg-shared-modal-wide%20.dcg-shared-modal%20%7B%0A%20%20width%3A%20800px%3B%0A%7D%0A.dcg-shared-modal-cover.dcg-shared-modal-medium%20.dcg-shared-modal%20%7B%0A%20%20width%3A%20650px%3B%0A%7D%0A.dcg-shared-modal-cover.dcg-shared-modal-narrow%20.dcg-shared-modal%20%7B%0A%20%20width%3A%20500px%3B%0A%7D%0A.dcg-shared-modal-cover.dcg-shared-modal-fullscreen%20.dcg-shared-modal%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%2030px%3B%0A%20%20bottom%3A%2030px%3B%0A%20%20left%3A%2030px%3B%0A%20%20right%3A%2030px%3B%0A%7D%0A.dcg-shared-modal-cover.dcg-shared-modal-fullscreen%20.dcg-shared-modal%20.dcg-shared-modal-contents-wrapper%20%7B%0A%20%20overflow-y%3A%20auto%3B%0A%20%20overflow-x%3A%20hidden%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%200%3B%0A%20%20left%3A%200%3B%0A%20%20bottom%3A%200%3B%0A%20%20right%3A%200%3B%0A%7D%0A.dcg-shared-modal-cover%20.dcg-shared-close-cross%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-28px%3B%0A%20%20right%3A%20-28px%3B%0A%20%20display%3A%20inline-block%3B%0A%20%20padding-top%3A%202px%3B%0A%20%20font-size%3A%20110%25%3B%0A%20%20width%3A%2032px%3B%0A%20%20height%3A%2032px%3B%0A%20%20line-height%3A%2032px%3B%0A%20%20text-align%3A%20center%3B%0A%20%20border-radius%3A%2050%25%3B%0A%20%20color%3A%20%23fff%3B%0A%20%20opacity%3A%200.9%3B%0A%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D90)%22%3B%0A%20%20filter%3A%20alpha(opacity%3D90)%3B%0A%7D%0A.dcg-shared-modal-cover%20.dcg-shared-close-cross.dcg-hovered%20%7B%0A%20%20opacity%3A%201%3B%0A%20%20-ms-filter%3A%20none%3B%0A%20%20filter%3A%20none%3B%0A%20%20background%3A%20rgba(255%2C255%2C255%2C0.15)%3B%0A%7D%0A.dcg-shared-modal-cover%20.dcg-shared-close-cross.dcg-depressed%20%7B%0A%20%20opacity%3A%201%3B%0A%20%20-ms-filter%3A%20none%3B%0A%20%20filter%3A%20none%3B%0A%20%20background%3A%20rgba(255%2C255%2C255%2C0.3)%3B%0A%7D%0A.dcg-shared-modal-cover%20.dcg-shared-modal-contents-wrapper%20%7B%0A%20%20padding%3A%2030px%3B%0A%20%20background%3A%20%23fff%3B%0A%20%20border-radius%3A%206px%3B%0A%20%20-webkit-box-shadow%3A%200%200%2010px%20rgba(0%2C0%2C0%2C0.5)%3B%0A%20%20box-shadow%3A%200%200%2010px%20rgba(0%2C0%2C0%2C0.5)%3B%0A%7D%0A.dcg-shared-modal-cover%20.dcg-shared-modal-error-message%20%7B%0A%20%20text-align%3A%20center%3B%0A%20%20font-size%3A%2090%25%3B%0A%20%20background%3A%20rgba(192%2C80%2C77%2C0.1)%3B%0A%20%20line-height%3A%2024px%3B%0A%20%20border%3A%201px%20solid%20rgba(192%2C80%2C77%2C0.5)%3B%0A%20%20border-radius%3A%203px%3B%0A%20%20color%3A%20%23c0504d%3B%0A%20%20-webkit-animation%3A%20fadeIn%200.3s%3B%0A%20%20-moz-animation%3A%20fadeIn%200.3s%3B%0A%20%20-o-animation%3A%20fadeIn%200.3s%3B%0A%20%20-ms-animation%3A%20fadeIn%200.3s%3B%0A%20%20animation%3A%20fadeIn%200.3s%3B%0A%7D%0A.dcg-shared-modal-cover%20h1%20%7B%0A%20%20padding%3A%200%3B%0A%20%20margin%3A%200%200%2010px%3B%0A%20%20font-weight%3A%20normal%3B%0A%20%20font-size%3A%2024px%3B%0A%7D%0A.dcg-shared-modal-cover%20h1%3Anot(.dcg-shared-left-align-title)%20%7B%0A%20%20text-align%3A%20center%3B%0A%7D%0A.dcg-shared-modal-cover%20h1.dcg-shared-left-align-title%20%7B%0A%20%20text-align%3A%20left%3B%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20850px)%20%7B%0A%20%20.dcg-shared-modal-cover.dcg-shared-modal-wide%20.dcg-shared-modal%20%7B%0A%20%20%20%20width%3A%20auto%3B%0A%20%20%20%20margin%3A%200%3B%0A%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20top%3A%2030px%3B%0A%20%20%20%20left%3A%2037px%3B%0A%20%20%20%20right%3A%2037px%3B%0A%20%20%7D%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20700px)%20%7B%0A%20%20.dcg-shared-modal-cover.dcg-shared-modal-medium%20.dcg-shared-modal%20%7B%0A%20%20%20%20width%3A%20auto%3B%0A%20%20%20%20margin%3A%200%3B%0A%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20top%3A%2030px%3B%0A%20%20%20%20left%3A%2037px%3B%0A%20%20%20%20right%3A%2037px%3B%0A%20%20%7D%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20600px)%20%7B%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover%20.dcg-shared-modal-background%20%7B%0A%20%20%20%20background%3A%20%23333%3B%0A%20%20%7D%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-wide%20.dcg-shared-modal-transition-container%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-medium%20.dcg-shared-modal-transition-container%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-narrow%20.dcg-shared-modal-transition-container%20%7B%0A%20%20%20%20margin-top%3A%200%3B%0A%20%20%7D%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-wide%20.dcg-shared-modal%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-fullscreen%20.dcg-shared-modal%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-medium%20.dcg-shared-modal%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-narrow%20.dcg-shared-modal%20%7B%0A%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20top%3A%2042px%3B%0A%20%20%20%20left%3A%200%3B%0A%20%20%20%20right%3A%200%3B%0A%20%20%20%20bottom%3A%200%3B%0A%20%20%20%20width%3A%20auto%3B%0A%20%20%20%20margin%3A%200%3B%0A%20%20%7D%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-wide%20.dcg-shared-modal%20.dcg-shared-close-cross%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-fullscreen%20.dcg-shared-modal%20.dcg-shared-close-cross%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-medium%20.dcg-shared-modal%20.dcg-shared-close-cross%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-narrow%20.dcg-shared-modal%20.dcg-shared-close-cross%20%7B%0A%20%20%20%20right%3A%205px%3B%0A%20%20%20%20top%3A%20-38px%3B%0A%20%20%7D%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-wide%20.dcg-shared-modal%20.dcg-shared-modal-contents-wrapper%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-fullscreen%20.dcg-shared-modal%20.dcg-shared-modal-contents-wrapper%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-medium%20.dcg-shared-modal%20.dcg-shared-modal-contents-wrapper%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover.dcg-shared-modal-narrow%20.dcg-shared-modal%20.dcg-shared-modal-contents-wrapper%20%7B%0A%20%20%20%20border-radius%3A%200%3B%0A%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20top%3A%200%3B%0A%20%20%20%20left%3A%200%3B%0A%20%20%20%20bottom%3A%200%3B%0A%20%20%20%20right%3A%200%3B%0A%20%20%20%20overflow-y%3A%20auto%3B%0A%20%20%20%20overflow-x%3A%20hidden%3B%0A%20%20%20%20max-height%3A%20none%3B%0A%20%20%7D%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover%3Anot(.dcg-shared-has-close-button).dcg-shared-modal-wide%20.dcg-shared-modal%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover%3Anot(.dcg-shared-has-close-button).dcg-shared-modal-fullscreen%20.dcg-shared-modal%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover%3Anot(.dcg-shared-has-close-button).dcg-shared-modal-medium%20.dcg-shared-modal%2C%0A%20%20.dcg-shared-modal-container%20.dcg-shared-modal-cover%3Anot(.dcg-shared-has-close-button).dcg-shared-modal-narrow%20.dcg-shared-modal%20%7B%0A%20%20%20%20top%3A%200%3B%0A%20%20%7D%0A%7D%0A%40-moz-keyframes%20dcgSharedFadeInDown%20%7B%0A%20%200%25%20%7B%0A%20%20%20%20opacity%3A%200%3B%0A%20%20%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D0)%22%3B%0A%20%20%20%20filter%3A%20alpha(opacity%3D0)%3B%0A%20%20%20%20-webkit-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-moz-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-o-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-ms-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%7D%0A%20%20100%25%20%7B%0A%20%20%20%20opacity%3A%201%3B%0A%20%20%20%20-ms-filter%3A%20none%3B%0A%20%20%20%20filter%3A%20none%3B%0A%20%20%7D%0A%7D%0A%40-webkit-keyframes%20dcgSharedFadeInDown%20%7B%0A%20%200%25%20%7B%0A%20%20%20%20opacity%3A%200%3B%0A%20%20%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D0)%22%3B%0A%20%20%20%20filter%3A%20alpha(opacity%3D0)%3B%0A%20%20%20%20-webkit-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-moz-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-o-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-ms-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%7D%0A%20%20100%25%20%7B%0A%20%20%20%20opacity%3A%201%3B%0A%20%20%20%20-ms-filter%3A%20none%3B%0A%20%20%20%20filter%3A%20none%3B%0A%20%20%7D%0A%7D%0A%40-o-keyframes%20dcgSharedFadeInDown%20%7B%0A%20%200%25%20%7B%0A%20%20%20%20opacity%3A%200%3B%0A%20%20%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D0)%22%3B%0A%20%20%20%20filter%3A%20alpha(opacity%3D0)%3B%0A%20%20%20%20-webkit-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-moz-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-o-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-ms-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%7D%0A%20%20100%25%20%7B%0A%20%20%20%20opacity%3A%201%3B%0A%20%20%20%20-ms-filter%3A%20none%3B%0A%20%20%20%20filter%3A%20none%3B%0A%20%20%7D%0A%7D%0A%40keyframes%20dcgSharedFadeInDown%20%7B%0A%20%200%25%20%7B%0A%20%20%20%20opacity%3A%200%3B%0A%20%20%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D0)%22%3B%0A%20%20%20%20filter%3A%20alpha(opacity%3D0)%3B%0A%20%20%20%20-webkit-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-moz-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-o-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20-ms-transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%20%20transform%3A%20translate(0%2C%20-10px)%3B%0A%20%20%7D%0A%20%20100%25%20%7B%0A%20%20%20%20opacity%3A%201%3B%0A%20%20%20%20-ms-filter%3A%20none%3B%0A%20%20%20%20filter%3A%20none%3B%0A%20%20%7D%0A%7D%0A%40-moz-keyframes%20dcgSharedFadeIn%20%7B%0A%20%200%25%20%7B%0A%20%20%20%20opacity%3A%200%3B%0A%20%20%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D0)%22%3B%0A%20%20%20%20filter%3A%20alpha(opacity%3D0)%3B%0A%20%20%7D%0A%20%20100%25%20%7B%0A%20%20%20%20opacity%3A%201%3B%0A%20%20%20%20-ms-filter%3A%20none%3B%0A%20%20%20%20filter%3A%20none%3B%0A%20%20%7D%0A%7D%0A%40-webkit-keyframes%20dcgSharedFadeIn%20%7B%0A%20%200%25%20%7B%0A%20%20%20%20opacity%3A%200%3B%0A%20%20%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D0)%22%3B%0A%20%20%20%20filter%3A%20alpha(opacity%3D0)%3B%0A%20%20%7D%0A%20%20100%25%20%7B%0A%20%20%20%20opacity%3A%201%3B%0A%20%20%20%20-ms-filter%3A%20none%3B%0A%20%20%20%20filter%3A%20none%3B%0A%20%20%7D%0A%7D%0A%40-o-keyframes%20dcgSharedFadeIn%20%7B%0A%20%200%25%20%7B%0A%20%20%20%20opacity%3A%200%3B%0A%20%20%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D0)%22%3B%0A%20%20%20%20filter%3A%20alpha(opacity%3D0)%3B%0A%20%20%7D%0A%20%20100%25%20%7B%0A%20%20%20%20opacity%3A%201%3B%0A%20%20%20%20-ms-filter%3A%20none%3B%0A%20%20%20%20filter%3A%20none%3B%0A%20%20%7D%0A%7D%0A%40keyframes%20dcgSharedFadeIn%20%7B%0A%20%200%25%20%7B%0A%20%20%20%20opacity%3A%200%3B%0A%20%20%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D0)%22%3B%0A%20%20%20%20filter%3A%20alpha(opacity%3D0)%3B%0A%20%20%7D%0A%20%20100%25%20%7B%0A%20%20%20%20opacity%3A%201%3B%0A%20%20%20%20-ms-filter%3A%20none%3B%0A%20%20%20%20filter%3A%20none%3B%0A%20%20%7D%0A%7D%0A"))
});
define("loadcss!shared-components/dcg-shared-icons", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared-components/dcg-shared-icons.css", decodeURIComponent("%2F*%20stylelint-disable%20*%2F%0A%0A%40font-face%20%7B%0A%20%20font-family%3A%20'dcg-shared-icons'%3B%0A%20%20src%3A%20url(%22data%3Aapplication%2Fx-font-ttf%3Bcharset%3Dutf-8%3Bbase64%2CAAEAAAALAIAAAwAwT1MvMg8SBfgAAAC8AAAAYGNtYXAXVtKOAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5Zi%2FH1EAAAAF4AAARIGhlYWQZhhObAAASmAAAADZoaGVhB7wDzQAAEtAAAAAkaG10eCYABLoAABL0AAAAMGxvY2EZthV2AAATJAAAABptYXhwABUBjQAAE0AAAAAgbmFtZVEHz5IAABNgAAAB8nBvc3QAAwAAAAAVVAAAACAAAwPHAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBwPA%2F8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qf%2F%2Ff%2F%2FAAAAAAAg6QD%2F%2Ff%2F%2FAAH%2F4xcEAAMAAQAAAAAAAAAAAAAAAQAB%2F%2F8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAAIAMYAnAM6AuYABQAtAFYAbgCLALsA6wEbAAABJzUeARcXBgcOAQcGIwYnLgEnJiceATMyNjcWFx4BFxYzMjY3PgE3HgEzPgE3Aw4BBwYUFS4BJy4BIyIHDgEHBgcUBhUiJicuASMiBgc2Nz4BNzYzMhYXKgEjIgYHDgEHDgEHJzI2NzI2MT4BNxcHFBYXIT4BNTA0NTQmJy4BJyUUFhceARcFIQ4BFScOAQcOAQcOAQciBiMqATEuAScuAScuATU5ATU8ATE%2BATc%2BATMxPgEzMhYXMTQUMRcOAQcOAQcOAQciBiMqATEuAScuAScuATU5ATU8ATE%2BATc%2BATMxPgEzNhYVMTQUMSEOAQcOAQcOAQciBiMqATEuAScuAScuATU5ATU8ATE%2BATc%2BATMxPgEzNhYVMTQUMQMeRBkhCgQJGxpNMDA1NjEwTRkaCQUJAwgOBgkWFkEoKC0tUiEfKggHDQgFCQWgBgwDAgQEAxYwGisnKD8XFwoCAgUCBQkFBQkDChsaTS8wNSNCrgEEAQULAwQDAgIFBEAFCwQBAwUKAkQ%2BBAP%2BSgQDAwQDBwUBWAMDBAYF%2FtMBiQYFBgIDAQQJBQEFAgMEAgEFBQcFBQkDAgIBBwQEBAMFBwUSGQJrAgMCAwkFAQYBBAMCAgQFCAQFCQMCAwIGBQMFAwUHBRMa%2FeICAwIDCQUBBgEDBAIBBQUHBQUJAwIDAgYFAwUDBQcFEhsCCXsCGz8jfjQrLEASEgESE0AsLDMCAwUCKyUlNRAPHx0bRigFAgMCBAE%2BBQ8IAwUDAgMCCQoPDjIjIigDBAIBAgEDAwEzKyw%2FEhEP3QMCAQECAgUBdQMBAgMHBXk6Bg0EBA0GAQEHDQgFCgKoBgwFBQsDlgYLBtMFBwUFCQMCAQECAQMCAwkFBQkDAgIFBgwFAwQBAxkSAgLZBQgEBQkEAQECAgIDAQQJBQQGBwIBBQcMBQMDAgICGxEBAQUIBAUJBAEBAgICAwEECQUEBgcCAQUHDAUDAwICAhsRAQEAAAAABgAtAKsD1QOkAB0AvgDaAPsBAAEFAAAlDgEjIiYnLgEnLgEnNz4BMR4BFx4BMzI2NzAWHwElFSImJyYGBw4BBw4BMQ4BBw4BIwcOASciJi8BLgExLgExMCYnLgEnLgEnLgEnLgEjDgEHIgYxBw4BBw4BBw4BByIGIwYmJy4BJzUeARceARcwFhceATMyNjcwNjcwNj8BPgExPgE3PgE3PgE3PgEzNjIxNhYXHgEfAR4BFzgBFzAyFTgBMR4BFzAWFx4BMxY2NzA2Nz4BNzA2Nz4BMzIWFwUwBg8BLgEnJicuAScmJz4BNxYXHgEXFhceARcBBgcOAQcGBw4BByImJy4BMT4BNz4BNzY3PgE3NjceARcFIyc3MwU%2FAScjAmkdNyAQIBAQHw8QGw4mAgkNFwsQJxoOHw8hCxIBbAMEAwwVCgoICgkQFSsYAR8CEQ0cDgwWCwsSLgYPEAMCCgEFCgcEDQYKEQkMEwgBFBEIEggNHRAIEAgBJgoaMxUKEAgQKQcGFAgHBAMECgkaCQcCEgETDB0FCQMIEAgGEggDEwEFDRYqEw0WDBkCEQUCAgUNAxAECRQLDhwLJAkVKBYXAwUfBwsWCf1lGwgTER4MEhARHg0ODA0fEgsNDR0RERMMGQ8CYgwODR0REBMRNCECEAoJHQEEAR8uExEPEB0PDw8RIA%2F88TwLKx4CzzkLKB7aGhUHCAgTDQ8gEScBCREdCw8aDAwcBwz3TQMCAwMFBQYICA8VLRIBFAYFAwEIBQYKKgYPEAMCCQIFCQUFCQMFBAIGBQ8RCBIIDxsLBQoFDAUUDgcNCGkQKAYHCwQCAgEBCwYFAg8CEwkdAwkDBwwHBggDAQUCAg4LCBMJGgMSBQICBQsDDQIGCQIOCR8KEygQDQIDCQEDDxgIEyNHHioqK1YrLCwOGQgpLCxbLy4uGzsfAcArLS5cLy4uLG43AQQDFgMGAjBlMSkrK1wxMDUFEA0THhEnAx0NAAAAAAQAyQDxA2QChAAkAE8AjwEEAAAlMSImLwEHBiYnJjY%2FAT4BMx4BHwETPgEzITIWFRQGIyEDDgEjJRUUBg8BDgEHBhQVFAYjIiY1NDY3MT4BNyMqATEUBgcVIzU3NTMVMBYzFw8BIzU0Nj8BPgE1NCYnLgEjIgYHDgEHHgEVFAYHDgEjIiY1NDY3PgEzMhYXHgEVFAYHDgEPATMyNjc0Njc1MxUlFAYHDgEjIiYnLgE1NDY3PgEzMhYXHgEVFAYHDgEHHgEzHgEzMjY3PgE1NCYnLgErASImNTQ2NzE6ATMyNjc%2BATU0JicuASMiBgcyFhUeARUUBgcOASMiJicuATU0Njc%2BATMyFhceARUUBgcOAQceARceARUBLwYMAS8HBhMEBQIHHAMLBQUGBCaJAwkHAYIKCw0I%2FouYAQwGAesDAigHCQECCgoMBxMRBQ4JPAgGBAMLCQ0LFU2pC3UDATgOEAQFBQwIBwoFAwYBCAkEAwMHBQkMCQgIFg0OFwoJCgYFAwwINC0KCAEDAhX%2B3AkICBMMCREICQgDAQQGAwMHAwMBAwMCAwICBAMFCQUHBwMCAwMCAwcHDQQEBAcBAwIGCAMDAwICAQcFBgwDAgICAwMCAQcFAwYDAgMJCAcPCAgQCAgJBQUDBwMFCQMGB%2FEGB2IGBQIHBhMFFQMBAQcEVAEHBQUNCAoL%2FuAFBusHAwYBOAgYDwkgFQkMEQQcORwHEw0CCQ0ECTcEBgICiT4JAwYCPRAgDgoOBgcGAwMEBgMCCQgFBwMEAwwKCxUICAkJCAgYDQkRCAUMCDIBAgEJDQQCtgwRCAYHBgUHEAkDCAIDAwICAwcDAwgCAQECAQMCAgYEBQsICAoFBQYFAwIFAgYFBA0GBQcDAwMDAwMBAgYFAwcDAwEDAQIGBQgPBQUDAwUFDwgIDggDBgIBBwQKEAgAAAMBLQC%2BAs0CwADVAVsBigAAASoBIyIGByIGBzEwBhUxMAYVMCIjMQ4BBw4BBzEHDgEnIiYnLgEjLgEnMCYvAS4BJy4BJy4BJzIWMy4BIzoBMyoBIzEqASsBIgYHDgEHDgEHNw4BBzgBNw4BBw4BBzEHMCIVMTAiBzEwBgcwBhU5Ag4BIzgBIzkBIiYnMhYzLgEnOQEwIiMuAScuATcyNjccARcxHgEXHgEXMTA2Nz4BNz4BNzgBMy4BJy4BJz4BMTAWFw4BBw4BBxQGFTAyFx4BFx4BMzEzPgE3PgE3MDQ3MhYzFgYHBxQwNQYwNw4BIzEOAQcOAQcOAQcxDgEHOQE4ASMxMCIVIgYjMTAiFTEjMCIjMCIjMSMOASciJic5AzAiIzEuAScxLgEnLgEvAS4BJy4BJwYmIyIGBzEOASMOAQcOAQcOAQcOAQciBiMyNjMOASMyNjcOAQciJiceARc2Nz4BNzY3KgExBw4BIzEiJicuAScwMjc%2BAT8BPgE3MDQ3MR4BFx4BMzI2NzgBFx4BFwYWFzQwFTECwAIDAQUHAwIDAgICAQEKEAgFCAQCBQ0GBQkDAgMBBAUCAQECAgQDAwQEAw4GAgEBCBIKAgUCBAcEAgECAgEBAgMHBQUJAwICAwECBQoEAgUCAgIBAQEBAwQKBQIDBAQCAQIFCAQBAgMHBBAPAwgNBwILGQ8FDAgBAgEDAgIIAwIGCwQQGAlET1BFCxkNCBQNAgEBBAcEAgUCAg4VCBAYCwIGDggFCAoLAQEBAwICAwECAwIBAgEKEQwCAgEBAgICAQEBAgIGCwYFCgQBAggNBgMFAwIDAQUBBgECBgMGCAMFBwMBBAECBQIDBwUGCwgDBwMCAQEBAQIGDQUFCgUECAMHCgcrawgGFhY4HR0UAgOCCxkNDRkNBg0FAQIDBgMDAQECAgUJBQcQCwcMBwIFCQMCAwEByQMCAgIBAQEBBxEIAwkDAgQGAQMEAQMDBAMBAgIBBAMDBgICDAMCBQYBAgEDAgMHBQIBBAECBQkDAgUCAgICAQEBAQQDAQECAgQDAwYELHRGAQEBBAEoTyUNHg8BAgEDAgIIAw0ZCyZOIw0vLw0rSyEVKhQCAQICAwYBAgEXLhMmTycCAgIyWyYgAgICAgIBAQECAQQBAgECCRIHAgICAgICAwMFCgcDBgECAwIEAQYBAgMCAwEEAwEDAgUCAwgDBwoFAQYBAgIEAwMCAgECAQFZSgUCDQ03LCxASQoLDAsHDQgCAwcDAgIBAQEBCAoFBwoEBAIFBgIBAwICAgAAAAAGAMIAhgM8Au8AHwAtAE4AZgB1AI0AACUWFAcOAS8BBwYiJy4BPwEnJjQ3PgEfATc2MhceAQ8BAzMyNjU0JisBIgYVFBYnMhYVFAYrARUUBiMiJj0BIyImNTQ2OwE1NDYzMhYdATMDFAYHDgEjIiYnLgE1NDY3PgEzMhYXHgE3FAYrASImNTQ2OwEeARUnFAYHDgEjIiYnLgE1NDY3PgEzMhYXHgEDFwcHBhMHOToGEwcGAgg6OgYGBxMGOjkHEwYHAQg5ic8KDg4KzwkODqEJDAwJUQ0LCQ5RCg4MDFEOCQoOUUIGBQUNCAYPBAUGBgUEDQgIDQUFBlkMCc8KDg0LzQsMWQYFBQ0ICA0EBQYGBQQNCAcOBQUGwAYUBgYCCDo6BgYGFAY6OQcTBgcBCDk5BwcGEwc5AWIOCQoODgoJDi0OCgoNUQoODAxRDAsKDlEJDAwJUf4iCA0FBQYGBQUNCAgMBQUGBgUGDUkKDgwMCQ4CDAlPCA0FBQYGBQUNCAgMBQUGBgUGDQAAAAABAAYAUQP6Ay8APAAAATYWFx4BFxYGBwYHDgEHBgcOASMiJicmJy4BJyYnLgE1NDY3PgEXHgEXHgEXHgEzMjY3Njc%2BATc2Nz4BNwNxICUVDh8CAS4ROzo6dDo6OhIuGB4%2FEh4fHz4fHx8NGiMODyEdFyMPK0otAxoDBS8ILiwsVywrLg0kEwMvBiQTDx4THS0SOzo6dDo6OhIuRhIeHh49IB8hDRoVGx0ODyUDASkNK0gtAx8xCC4sLVgtLCwPJAUAAAAAAQAL%2F8kD9wO3AGIAACUUBgcOAScuAScmJy4BJyYnBgcOAQcGBw4BJy4BJy4BNz4BNzY3PgE3NjcmJy4BJyYnLgEnJjY3PgEXHgEXFhceARcWFzY3PgE3Njc%2BARceARceAQcOAQcGBw4BBwYHAR4BFQP3Ig8QJiMbNhEgIiJEISEfIiIiQyMiIxU3JRYhCxArCAY6Ex8jI0YhIh0eISFFIyIhEzoGCCcSECslGDIRISIhQiAgHyIiIUIiISMUPCUVIA0SKAcFORUgIiJEIiEgAREVPEsdIA4QLAUDOhQgIiJFIiIfICEhQyIiIxVBBQMhDRAqIRozEyAiI0YiIh4bISFGIyIfETIYJSgREC8MBjoTISEhQyAhHyAgIUMiIiIVQQUDIQ0RKSEdMBMgIyJGIiIg%2FvMSNB4ABAD%2BAMADAgK%2BAA8AHwA4AFEAAAEjIiY9ATQ2OwEyFh0BFAYXIyImPQE0NjsBMhYdARQGBSMiJjURNDY7ATIWFRQGKwERMzIWFRQGIyEzMjY1ETQmKwEiBhUUFjsBESMiBhUUFjMBzzwJEA4LPAoQD5M8ChAPCzwJEBD%2B6kkLDhAJSQsPEAotLQsPDwsBQEkLDhAJSQsPEAotLQsPDwsB1w8LPAkQDgs8Cw%2BbDgs8ChAPCzwLDnwQCgHKCw8QCgkQ%2FmoQCQoSEAoBygsPEAoJEP5qEAkKEgAAAQAAAAEAAC2kOatfDzz1AAsEAAAAAADbNmePAAAAANs2Z48AAP%2FJA%2FoDtwAAAAgAAgAAAAAAAAABAAADwP%2FAAAAEAAAAAAAD%2BgABAAAAAAAAAAAAAAAAAAAADAQAAAAAAAAAAAAAAAIAAAAEAADGBAAALQQAAMkEAAEtBAAAwgQAAAYEAAALBAAA%2FgAAAAAACgAUAB4BoAMWBHgGYAcmB4gIJAiQAAAAAQAAAAwBiwAIAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABABAAAAABAAAAAAACAAcAsQABAAAAAAADABAAUQABAAAAAAAEABAAxgABAAAAAAAFAAsAMAABAAAAAAAGABAAgQABAAAAAAAKABoA9gADAAEECQABACAAEAADAAEECQACAA4AuAADAAEECQADACAAYQADAAEECQAEACAA1gADAAEECQAFABYAOwADAAEECQAGACAAkQADAAEECQAKADQBEGRjZy1zaGFyZWQtaWNvbnMAZABjAGcALQBzAGgAYQByAGUAZAAtAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGRjZy1zaGFyZWQtaWNvbnMAZABjAGcALQBzAGgAYQByAGUAZAAtAGkAYwBvAG4Ac2RjZy1zaGFyZWQtaWNvbnMAZABjAGcALQBzAGgAYQByAGUAZAAtAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmRjZy1zaGFyZWQtaWNvbnMAZABjAGcALQBzAGgAYQByAGUAZAAtAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA%3D%22)%20format('truetype')%3B%0A%20%20font-weight%3A%20normal%3B%0A%20%20font-style%3A%20normal%3B%0A%20%20font-display%3A%20block%3B%0A%7D%0A%0A%5Bclass%5E%3D%22dcg-shared-icon-%22%5D%2C%20%5Bclass*%3D%22%20dcg-shared-icon-%22%5D%20%7B%0A%20%20%2F*%20use%20!important%20to%20prevent%20issues%20with%20browser%20extensions%20that%20change%20fonts%20*%2F%0A%20%20font-family%3A%20'dcg-shared-icons'%20!important%3B%0A%20%20speak%3A%20never%3B%0A%20%20font-style%3A%20normal%3B%0A%20%20font-weight%3A%20normal%3B%0A%20%20font-variant%3A%20normal%3B%0A%20%20text-transform%3A%20none%3B%0A%20%20line-height%3A%201%3B%0A%0A%20%20%2F*%20Better%20Font%20Rendering%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20*%2F%0A%20%20-webkit-font-smoothing%3A%20antialiased%3B%0A%20%20-moz-osx-font-smoothing%3A%20grayscale%3B%0A%7D%0A%0A.dcg-shared-icon-matrix%3Abefore%20%7B%0A%20%20content%3A%20%22%5Ce907%22%3B%0A%7D%0A.dcg-shared-icon-check%3Abefore%20%7B%0A%20%20content%3A%20%22%5Ce905%22%3B%0A%7D%0A.dcg-shared-icon-remove%3Abefore%20%7B%0A%20%20content%3A%20%22%5Ce906%22%3B%0A%7D%0A.dcg-shared-icon-graphing%3Abefore%20%7B%0A%20%20content%3A%20%22%5Ce901%22%3B%0A%7D%0A.dcg-shared-icon-geometry%3Abefore%20%7B%0A%20%20content%3A%20%22%5Ce900%22%3B%0A%7D%0A.dcg-shared-icon-scientific%3Abefore%20%7B%0A%20%20content%3A%20%22%5Ce902%22%3B%0A%7D%0A.dcg-shared-icon-test-mode%3Abefore%20%7B%0A%20%20content%3A%20%22%5Ce903%22%3B%0A%7D%0A.dcg-shared-icon-four-function%3Abefore%20%7B%0A%20%20content%3A%20%22%5Ce904%22%3B%0A%7D%0A"))
});
define("shared-components/modal", ["require", "exports", "tslib", "dcgview", "jquery", "loadcss!./modal", "loadcss!./dcg-shared-icons", "jquery.tipsy"], function(require, exports, tslib_1, DCGView, $) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var If = DCGView.Components.If;
    var Modal = function(_super) {
        tslib_1.__extends(Modal, _super);
        function Modal() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        Modal.prototype.init = function() {
            this.i18n = this.props.i18n()
        }
        ;
        Modal.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                class: DCGView.const("dcg-shared-modal-container")
            }, DCGView.createElement("div", {
                class: function() {
                    return {
                        "dcg-shared-modal-cover": true,
                        "dcg-shared-has-close-button": _this.showX(),
                        "dcg-shared-modal-fullscreen": _this.props.size() === "fullscreen",
                        "dcg-shared-modal-wide": _this.props.size() === "wide",
                        "dcg-shared-modal-medium": _this.props.size() === "medium",
                        "dcg-shared-modal-narrow": _this.props.size() === "narrow"
                    }
                }
            }, DCGView.createElement("div", {
                class: DCGView.const("dcg-shared-modal-background"),
                onTap: this.props.onClose
            }), DCGView.createElement("div", {
                class: DCGView.const("dcg-shared-modal-transition-container")
            }, DCGView.createElement("div", {
                class: DCGView.const("dcg-shared-modal"),
                role: DCGView.const("dialog"),
                "aria-label": function() {
                    return _this.props.ariaLabel ? _this.props.ariaLabel() : ""
                }
            }, DCGView.createElement(If, {
                predicate: function() {
                    return !!_this.props.showX
                }
            }, function() {
                return DCGView.createElement("div", {
                    role: DCGView.const("link"),
                    tabindex: DCGView.const("0"),
                    "aria-label": function() {
                        return _this.i18n.s("shared-button-close-dialog")
                    },
                    tooltip: function() {
                        return _this.i18n.s("shared-button-close-dialog")
                    },
                    didMount: function(el) {
                        return $(el).tipsy()
                    },
                    class: DCGView.const("dcg-shared-close-cross"),
                    onTap: _this.props.onClose
                }, DCGView.createElement("i", {
                    class: DCGView.const("dcg-shared-icon-remove"),
                    "aria-hidden": DCGView.const("true")
                }))
            }), DCGView.createElement("div", {
                class: DCGView.const("dcg-shared-modal-contents-wrapper")
            }, DCGView.createElement(If, {
                predicate: function() {
                    return !!_this.props.title()
                }
            }, function() {
                return DCGView.createElement("h1", {
                    class: function() {
                        return {
                            "dcg-shared-modal-title": true,
                            "dcg-shared-left-align-title": _this.leftAlignTitle()
                        }
                    }
                }, function() {
                    return _this.props.title()
                })
            }), DCGView.createElement("div", {
                class: DCGView.const("dcg-shared-modal-scrollable-content")
            }, this.children))))))
        }
        ;
        Modal.prototype.showX = function() {
            return !!this.props.showX && this.props.showX()
        }
        ;
        Modal.prototype.leftAlignTitle = function() {
            return !!this.props.leftAlignTitle && this.props.leftAlignTitle()
        }
        ;
        Modal.prototype.onClose = function() {
            if (this.props.onClose)
                this.props.onClose()
        }
        ;
        return Modal
    }(DCGView.Class);
    exports.Modal = Modal
});
define("loadcss!shared/dcgviews/shared-confirmation-modal", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/dcgviews/shared-confirmation-modal.css", decodeURIComponent(".shared-confirmation-modal-contents%20.confirmation-modal-message%20%7B%0A%20%20padding%3A%205px%200%3B%0A%7D%0A.shared-confirmation-modal-contents%20.confirmation-modal-message%20b%20%7B%0A%20%20font-family%3A%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%20%20font-weight%3A%20600%3B%0A%7D%0A.shared-confirmation-modal-contents%20.modal-error-message%20%7B%0A%20%20line-height%3A%2024px%3B%0A%20%20text-align%3A%20center%3B%0A%20%20font-size%3A%2090%25%3B%0A%20%20background%3A%20rgba(192%2C80%2C77%2C0.1)%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%3A%201px%20solid%20rgba(192%2C80%2C77%2C0.5)%3B%0A%20%20border-radius%3A%203px%3B%0A%20%20color%3A%20%23c0504d%3B%0A%20%20-webkit-animation%3A%20fadeIn%200.3s%3B%0A%20%20-moz-animation%3A%20fadeIn%200.3s%3B%0A%20%20-o-animation%3A%20fadeIn%200.3s%3B%0A%20%20-ms-animation%3A%20fadeIn%200.3s%3B%0A%20%20animation%3A%20fadeIn%200.3s%3B%0A%7D%0A.shared-confirmation-modal-contents%20.confirmation-modal-actions%20%7B%0A%20%20text-align%3A%20right%3B%0A%20%20margin-top%3A%2010px%3B%0A%7D%0A.shared-confirmation-modal-contents%20.confirmation-modal-actions%20.dark-gray-link%20%7B%0A%20%20padding-right%3A%2020px%3B%0A%7D%0A"))
});
define("shared/dcgviews/delete-modal", ["require", "exports", "tslib", "shared/dcgviews/localize", "lib/i18n", "dcgview", "shared-components/modal", "loadcss!./shared-confirmation-modal"], function(require, exports, tslib_1, localize_1, i18n, DCGView, modal_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var If = DCGView.Components.If;
    var DeleteModal = function(_super) {
        tslib_1.__extends(DeleteModal, _super);
        function DeleteModal() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        DeleteModal.prototype.template = function() {
            var _this = this;
            var title = function() {
                return i18n.s("teacher-title-delete-activity")
            };
            return DCGView.createElement(If, {
                predicate: this.props.visible
            }, function() {
                return DCGView.createElement(modal_1.Modal, {
                    title: title,
                    size: _this.const("narrow"),
                    showX: _this.const(true),
                    leftAlignTitle: _this.const(true),
                    onClose: _this.props.onClose,
                    i18n: function() {
                        return i18n
                    }
                }, DCGView.createElement("div", {
                    class: DCGView.const("shared-confirmation-modal-contents")
                }, DCGView.createElement("div", {
                    class: DCGView.const("confirmation-modal-message")
                }, DCGView.createElement(localize_1.Localize, {
                    key: _this.const("teacher-prompt-confirm-delete-activity")
                }, DCGView.const("Are you sure you want to delete"), DCGView.const(" "), DCGView.createElement("b", null, localize_1.Localize.variable("title", function() {
                    return i18n.raw(_this.props.activity().title)
                })), DCGView.const("? This cannot be undone!"))), DCGView.createElement(If, {
                    predicate: function() {
                        return !!_this.props.activity().errorMessage
                    }
                }, function() {
                    return DCGView.createElement("div", {
                        class: DCGView.const("modal-error-message")
                    }, function() {
                        return i18n.raw(_this.props.activity().errorMessage)
                    })
                }), DCGView.createElement("div", {
                    class: DCGView.const("confirmation-modal-actions")
                }, DCGView.createElement("span", {
                    class: DCGView.const("dark-gray-link"),
                    onTap: _this.props.onClose
                }, function() {
                    return i18n.s("global-button-cancel")
                }), DCGView.createElement("div", {
                    class: function() {
                        return {
                            "cancel-button": true,
                            "btn-red": true,
                            disabled: _this.props.activity().deleting
                        }
                    },
                    onTap: _this.bindFn(_this.onDelete)
                }, function() {
                    return i18n.s("global-button-delete")
                }))))
            })
        }
        ;
        DeleteModal.prototype.onDelete = function() {
            this.props.dispatch({
                type: "delete-activity",
                activityId: this.props.activity().id,
                deleteURL: this.props.activity().deleteURL
            })
        }
        ;
        return DeleteModal
    }(DCGView.Class);
    exports.DeleteModal = DeleteModal
});
define("loadcss!shared/alp/share-modal", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/alp/share-modal.css", decodeURIComponent(".share-modal-container%20.share-link%20%7B%0A%20%20margin%3A%2020px%200%3B%0A%7D%0A.share-modal-container%20.share-link%20.share-link-text%20%7B%0A%20%20margin-bottom%3A%205px%3B%0A%20%20color%3A%20%23666%3B%0A%7D%0A.share-modal-container%20.share-link%20.activity-url%20%7B%0A%20%20border-radius%3A%205px%3B%0A%20%20font-size%3A%20100%25%3B%0A%20%20padding%3A%2010px%3B%0A%20%20width%3A%20100%25%3B%0A%7D%0A.share-modal-container%20.exclusive-activity-warning%20%7B%0A%20%20padding%3A%2010px%205px%3B%0A%20%20font-family%3A%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%20%20font-weight%3A%20600%3B%0A%20%20color%3A%20%23666%3B%0A%7D%0A.share-modal-container%20.social-share-links%20%7B%0A%20%20margin-top%3A%2020px%3B%0A%7D%0A.share-modal-container%20.social-share-links%20.social-share-text%20%7B%0A%20%20color%3A%20%23666%3B%0A%20%20display%3A%20block%3B%0A%7D%0A.share-modal-container%20.social-share-links%20.twitter-container%2C%0A.share-modal-container%20.social-share-links%20.facebook-container%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20width%3A%20calc(50%25%20-%205px)%3B%0A%20%20text-align%3A%20center%3B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%20%20padding%3A%2010px%3B%0A%20%20margin-top%3A%2010px%3B%0A%20%20border-radius%3A%205px%3B%0A%20%20text-decoration%3A%20none%3B%0A%7D%0A.share-modal-container%20.social-share-links%20.twitter-container%20i%2C%0A.share-modal-container%20.social-share-links%20.facebook-container%20i%20%7B%0A%20%20padding-right%3A%206px%3B%0A%7D%0A.share-modal-container%20.social-share-links%20.btn-blue-outline%3Afirst-of-type%20%7B%0A%20%20margin-right%3A%2010px%3B%0A%7D%0A"))
});
define("shared/alp/share-modal", ["require", "exports", "tslib", "lib/i18n", "dcgview", "shared-components/modal", "lib/retain-lang", "jquery", "browser", "loadcss!./share-modal"], function(require, exports, tslib_1, i18n, DCGView, modal_1, retain_lang_1, $, Browser) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , Switch = _a.Switch
        , If = _a.If;
    var ShareModal = function(_super) {
        tslib_1.__extends(ShareModal, _super);
        function ShareModal() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ShareModal.prototype.template = function() {
            var _this = this;
            var partnerActivity = this.props.partnerActivity() || "";
            var title = function() {
                return i18n.s("alp-title-share-this-activity")
            };
            var useThisLink = function() {
                return i18n.s("alp-message-use-this-link")
            };
            return DCGView.createElement(If, {
                predicate: this.props.visible
            }, function() {
                return DCGView.createElement(modal_1.Modal, {
                    title: title,
                    size: _this.const("narrow"),
                    showX: _this.const(true),
                    leftAlignTitle: _this.const(true),
                    onClose: _this.props.onClose,
                    i18n: function() {
                        return i18n
                    }
                }, DCGView.createElement("div", {
                    class: DCGView.const("share-modal-container")
                }, DCGView.createElement("div", {
                    class: DCGView.const("share-link")
                }, DCGView.createElement("div", {
                    class: DCGView.const("share-link-text")
                }, useThisLink), DCGView.createElement("input", {
                    "aria-label": useThisLink,
                    class: DCGView.const("activity-url blue-outline"),
                    didMount: _this.bindFn(_this.didMountLink),
                    onTap: _this.bindFn(_this.selectLink)
                })), DCGView.createElement(Switch, {
                    key: function() {
                        return partnerActivity !== ""
                    }
                }, function(isPartnerActivity) {
                    if (isPartnerActivity) {
                        return DCGView.createElement("div", {
                            class: DCGView.const("exclusive-activity-warning")
                        }, function() {
                            return i18n.s("teacher-label-activity-tag", {
                                tag: i18n.raw(partnerActivity)
                            })
                        })
                    } else {
                        return DCGView.createElement("div", {
                            class: DCGView.const("social-share-links")
                        }, DCGView.createElement("div", {
                            class: DCGView.const("social-share-text")
                        }, function() {
                            return i18n.s("alp-message-share-social-media")
                        }), DCGView.createElement("a", {
                            class: DCGView.const("facebook-container btn-blue-outline"),
                            href: _this.bindFn(_this.getFacebookLink),
                            target: DCGView.const("blank")
                        }, DCGView.createElement("i", {
                            class: DCGView.const("pillow-icon-facebook")
                        }), DCGView.createElement("span", {
                            class: DCGView.const("facebook-text")
                        }, function() {
                            return i18n.raw("Facebook")
                        })), DCGView.createElement("a", {
                            class: DCGView.const("twitter-container btn-blue-outline"),
                            href: _this.bindFn(_this.getTwitterLink),
                            target: DCGView.const("blank")
                        }, DCGView.createElement("i", {
                            class: DCGView.const("pillow-icon-twitter")
                        }), DCGView.createElement("span", {
                            class: DCGView.const("tweet-text")
                        }, function() {
                            return i18n.raw("Twitter")
                        })))
                    }
                })))
            })
        }
        ;
        ShareModal.prototype.updateActivityLink = function() {
            this.$link.val(this.getActivityUrl())
        }
        ;
        ShareModal.prototype.getTwitterLink = function() {
            var text = "Check out this @Desmos activity: " + this.props.activity().title + "!";
            var uri = encodeURI(text).replace("#", "%23");
            return "https://twitter.com/intent/tweet?text=" + uri + "&url=" + this.getActivityUrl()
        }
        ;
        ShareModal.prototype.getFacebookLink = function() {
            return "https://www.facebook.com/sharer/sharer.php?u=" + this.getActivityUrl()
        }
        ;
        ShareModal.prototype.getActivityUrl = function() {
            var collectionsQuery = "";
            if (this.props.parentCollectionIds().length) {
                collectionsQuery = "?collections=" + this.props.parentCollectionIds().join(",")
            }
            return retain_lang_1.retainLang("https://teacher.desmos.com/" + this.props.activity().infoURL + collectionsQuery)
        }
        ;
        ShareModal.prototype.didMountLink = function(node) {
            this.$link = $(node);
            this.updateActivityLink();
            if (!Browser.SHOULD_NOT_AUTOFOCUS) {
                this.selectLink()
            }
        }
        ;
        ShareModal.prototype.selectLink = function() {
            this.$link.select()
        }
        ;
        return ShareModal
    }(DCGView.Class);
    exports.ShareModal = ShareModal
});
define("lib/date_helpers", ["require", "exports", "core/lib/i18n", "core/lib/assert-unreachable"], function(require, exports, i18n_1, assert_unreachable_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function parseMongoId(mongoId) {
        return new Date(parseInt(mongoId.substring(0, 8), 16) * 1e3)
    }
    exports.parseMongoId = parseMongoId;
    function prettyDate(date, options) {
        if (options === void 0) {
            options = {
                showYear: true
            }
        }
        return i18n_1.i18n.date(date, options)
    }
    exports.prettyDate = prettyDate;
    function prettyTime(date) {
        return i18n_1.i18n.time(date)
    }
    exports.prettyTime = prettyTime;
    function timeFromNow(date, nowOverride) {
        var now = nowOverride || new Date;
        var diff = (now.getTime() - date.getTime()) / 1e3;
        var type = diff < 0 ? "time-in" : "time-ago";
        diff = Math.abs(diff);
        var SEC_ARRAY = [60, 60, 24, 7, 365 / 7];
        var idx = 0;
        for (; diff >= SEC_ARRAY[idx] && idx < SEC_ARRAY.length; idx++) {
            diff /= SEC_ARRAY[idx]
        }
        diff = Math.floor(diff);
        if (type === "time-ago") {
            switch (idx) {
                case 0:
                    return i18n_1.i18n.s("global-label-timeago-seconds-ago");
                case 1:
                    return i18n_1.i18n.s("global-label-timeago-minutes-ago", {
                        m: diff
                    });
                case 2:
                    return i18n_1.i18n.s("global-label-timeago-hours-ago", {
                        h: diff
                    });
                case 3:
                    return i18n_1.i18n.s("global-label-timeago-days-ago", {
                        d: diff
                    });
                case 4:
                    if (diff >= 4) {
                        return i18n_1.i18n.s("global-label-timeago-months-ago", {
                            m: getMonthDifference(now, date)
                        })
                    }
                    return i18n_1.i18n.s("global-label-timeago-weeks-ago", {
                        w: diff
                    });
                case 5:
                    return i18n_1.i18n.s("global-label-timeago-years-ago", {
                        y: diff
                    });
                default:
                    throw new Error("Expected index to be an integer from 0 to 6, but got " + idx + " instead")
            }
        } else if (type === "time-in") {
            switch (idx) {
                case 0:
                    return i18n_1.i18n.s("global-label-timeago-in-seconds");
                case 1:
                    return i18n_1.i18n.s("global-label-timeago-in-minutes", {
                        m: diff
                    });
                case 2:
                    return i18n_1.i18n.s("global-label-timeago-in-hours", {
                        h: diff
                    });
                case 3:
                    return i18n_1.i18n.s("global-label-timeago-in-days", {
                        d: diff
                    });
                case 4:
                    if (diff >= 4) {
                        return i18n_1.i18n.s("global-label-timeago-in-months", {
                            m: getMonthDifference(now, date)
                        })
                    }
                    return i18n_1.i18n.s("global-label-timeago-in-weeks", {
                        w: diff
                    });
                case 5:
                    return i18n_1.i18n.s("global-label-timeago-in-years", {
                        y: diff
                    });
                default:
                    throw new Error("Expected index to be an integer from 0 to 6, but got " + idx + " instead")
            }
        } else {
            return assert_unreachable_1.assertUnreachable(type)
        }
    }
    exports.timeFromNow = timeFromNow;
    function getMonthDifference(d1, d2) {
        var m1 = d1.getFullYear() * 12 + d1.getMonth();
        var m2 = d2.getFullYear() * 12 + d2.getMonth();
        return Math.abs(m1 - m2)
    }
    function isSameDay(date, comparisonDay) {
        return date.getFullYear() === comparisonDay.getFullYear() && date.getMonth() === comparisonDay.getMonth() && date.getDate() === comparisonDay.getDate()
    }
    function dateIsFromYesterday(date) {
        var now = Date.now();
        var yesterday = new Date(now);
        yesterday.setDate(new Date(now).getDate() - 1);
        return isSameDay(date, yesterday)
    }
    exports.dateIsFromYesterday = dateIsFromYesterday;
    function dateIsFromToday(date) {
        var today = new Date(Date.now());
        return isSameDay(date, today)
    }
    exports.dateIsFromToday = dateIsFromToday;
    function dateIsFromThisYear(date) {
        var now = new Date(Date.now());
        return date.getFullYear() === now.getFullYear()
    }
    exports.dateIsFromThisYear = dateIsFromThisYear
});
define("shared/alp/edit-warning-modal", ["require", "exports", "tslib", "lib/i18n", "dcgview", "shared-components/modal", "lib/date_helpers", "loadcss!shared/dcgviews/shared-confirmation-modal"], function(require, exports, tslib_1, i18n, DCGView, modal_1, dateHelpers) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , IfElse = _a.IfElse
        , If = _a.If;
    var EditWarningModal = function(_super) {
        tslib_1.__extends(EditWarningModal, _super);
        function EditWarningModal() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        EditWarningModal.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(If, {
                predicate: this.props.visible
            }, function() {
                return DCGView.createElement(modal_1.Modal, {
                    title: function() {
                        return _this.getModalHeader()
                    },
                    size: _this.const("narrow"),
                    showX: _this.const(true),
                    leftAlignTitle: _this.const(true),
                    onClose: _this.props.onClose,
                    i18n: function() {
                        return i18n
                    }
                }, DCGView.createElement("div", {
                    class: DCGView.const("shared-confirmation-modal-contents")
                }, IfElse(function() {
                    return !!_this.props.activity().curriculumActivityLocation
                }, {
                    true: function() {
                        return DCGView.createElement("div", {
                            class: DCGView.const("confirmation-modal-message")
                        }, DCGView.createElement("b", null, function() {
                            return _this.getLessonTitle()
                        }), DCGView.const(" "), function() {
                            return i18n.raw("is in the Desmos Middle School Math Pilot.")
                        })
                    },
                    false: function() {
                        return DCGView.createElement("div", {
                            class: DCGView.const("confirmation-modal-message")
                        }, DCGView.createElement("b", null, function() {
                            return _this.getLessonTitle()
                        }), DCGView.const(" "), function() {
                            return i18n.raw("is in the search pool.")
                        })
                    }
                }), IfElse(function() {
                    return _this.someoneElsesDraft()
                }, {
                    true: function() {
                        return DCGView.createElement("div", null, DCGView.createElement("div", {
                            class: DCGView.const("confirmation-modal-message")
                        }, function() {
                            var messages = _this.notYourDraftMessages();
                            return !!messages ? messages[0] : i18n.raw("")
                        }), DCGView.createElement("div", {
                            class: DCGView.const("confirmation-modal-message")
                        }, function() {
                            var messages = _this.notYourDraftMessages();
                            return !!messages ? messages[1] : i18n.raw("")
                        }))
                    },
                    false: function() {
                        return DCGView.createElement("div", {
                            class: DCGView.const("confirmation-modal-message")
                        }, function() {
                            return i18n.s("teacher-prompt-edit-desmos-activity-warning")
                        })
                    }
                }), DCGView.createElement("div", {
                    class: DCGView.const("confirmation-modal-actions")
                }, DCGView.createElement("span", {
                    class: DCGView.const("dark-gray-link"),
                    onTap: _this.props.onClose
                }, function() {
                    return i18n.s("global-button-cancel")
                }), DCGView.createElement("a", {
                    role: DCGView.const("button"),
                    href: function() {
                        return "/" + _this.props.activity().activityName + "/custom/" + _this.props.activity()._id + "/edit"
                    },
                    class: function() {
                        return {
                            "dcg-edit-button": true,
                            "btn-blue": !_this.someoneElsesDraft(),
                            "btn-red": _this.someoneElsesDraft()
                        }
                    }
                }, function() {
                    return i18n.s("teacher-button-edit-desmos-activity")
                }))))
            })
        }
        ;
        EditWarningModal.prototype.lastDraftOwner = function() {
            var lesson = this.props.lesson && this.props.lesson();
            if (!lesson)
                return undefined;
            var tDraft = lesson.edit_ts;
            var tPublished = lesson.activity === "activitybuilder" && lesson.publishedTimestamp;
            if (!!tDraft && !!tPublished && new Date(tDraft) > new Date(tPublished)) {
                return lesson.draftAuthor
            }
            return undefined
        }
        ;
        EditWarningModal.prototype.someoneElsesDraft = function() {
            var currentUser = this.props.resources().user;
            var draftAuthor = this.lastDraftOwner();
            return !!draftAuthor && draftAuthor.id !== currentUser.id
        }
        ;
        EditWarningModal.prototype.notYourDraftMessages = function() {
            var lesson = this.props.lesson && this.props.lesson();
            var draftAuthor = this.lastDraftOwner();
            if (!draftAuthor)
                return undefined;
            if (!lesson)
                return undefined;
            var tDraft = lesson.edit_ts;
            var editDate = new Date(tDraft);
            var dateString = dateHelpers.timeFromNow(editDate);
            var draftAuthorName = draftAuthor.displayName ? i18n.raw(draftAuthor.displayName) : i18n.raw("teaching team");
            var draftMessage1 = i18n.s("teacher-message-draft-on-desmos-activity-part-1", {
                draftAuthorName: draftAuthorName,
                date: i18n.raw(dateString)
            });
            var draftMessage2 = i18n.s("teacher-message-draft-on-desmos-activity-part-2", {
                draftAuthorName: draftAuthorName
            });
            return [draftMessage1, draftMessage2]
        }
        ;
        EditWarningModal.prototype.getLessonTitle = function() {
            return i18n.raw(this.props.activity().title || "")
        }
        ;
        EditWarningModal.prototype.getModalHeader = function() {
            return i18n.s("teacher-heading-edit-activity")
        }
        ;
        return EditWarningModal
    }(DCGView.Class);
    exports.EditWarningModal = EditWarningModal
});
define("activitybuilder/ts-controller", ["require", "exports", "tslib", "underscore"], function(require, exports, tslib_1, _) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var Controller = function() {
        function Controller(resources) {
            var _this = this;
            this.subControllers = {};
            this.resources = resources;
            this.id = _.uniqueId("controller_");
            this.controllerStatus = undefined;
            this.dispatch = function(action) {
                _this.resources.dispatch(tslib_1.__assign(tslib_1.__assign({}, action), {
                    path: _this.getPath()
                }))
            }
        }
        Controller.prototype.getId = function() {
            return this.getPath().join(".")
        }
        ;
        Controller.prototype.getPath = function() {
            return [this.id]
        }
        ;
        Controller.prototype.myAction = function(action) {
            var path = action.path;
            if (path == null) {
                return false
            }
            var myPath = this.getPath();
            return _.isEqual(myPath, path.slice(0, myPath.length))
        }
        ;
        Controller.prototype.addSubController = function(key, sub) {
            this.subControllers[key] = sub
        }
        ;
        Controller.prototype.removeSubController = function(key) {
            var subcontroller = this.subControllers[key];
            if (subcontroller != undefined) {
                subcontroller.exit()
            }
            delete this.subControllers[key]
        }
        ;
        Controller.prototype.myDependencies = function() {
            return []
        }
        ;
        Controller.prototype.getDependencies = function() {
            var deps = this.myDependencies();
            for (var _i = 0, _a = _.values(this.subControllers); _i < _a.length; _i++) {
                var sub = _a[_i];
                deps = deps.concat(sub.getDependencies())
            }
            return deps
        }
        ;
        Controller.prototype.handleDispatch = function(action, onUpdateDone) {
            if (!this.checkAsyncDependencyStatus()) {
                return
            }
            for (var _i = 0, _a = _.values(this.subControllers); _i < _a.length; _i++) {
                var sub = _a[_i];
                sub.handleDispatch(action, onUpdateDone)
            }
            this.ownHandleDispatch(action, onUpdateDone)
        }
        ;
        Controller.prototype.ownHandleDispatch = function(_action, _onUpdateDone) {}
        ;
        Controller.prototype.onDepsLoaded = function() {}
        ;
        Controller.prototype.exit = function() {
            for (var _i = 0, _a = _.keys(this.subControllers); _i < _a.length; _i++) {
                var subKey = _a[_i];
                this.removeSubController(subKey)
            }
        }
        ;
        Controller.prototype.checkAsyncDependencyStatus = function() {
            var deps = this.getDependencies();
            if (this.resources.asyncController.anyFailed(deps)) {
                this.controllerStatus = "failed";
                return false
            }
            if (!this.resources.asyncController.allDefined(deps)) {
                this.controllerStatus = "loading";
                this.resources.asyncController.load(deps);
                if (!this.resources.asyncController.hasLoaderRegistered()) {
                    throw new Error("Main didn't yet add an on-load callback")
                }
                return false
            }
            if (this.controllerStatus !== "entered") {
                this.onDepsLoaded();
                this.controllerStatus = "entered"
            }
            return true
        }
        ;
        return Controller
    }();
    exports.Controller = Controller
});
define("lib/tools", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function assertLoaded(request) {
        if (request.status === "loaded") {
            return request.response
        } else {
            throw new Error("Expected request to be loaded, but it was " + request.status)
        }
    }
    exports.assertLoaded = assertLoaded;
    function responseProp(requestProp) {
        return function() {
            return assertLoaded(requestProp())
        }
    }
    exports.responseProp = responseProp;
    function typedBind(fn, that) {
        return fn["bind"](that)
    }
    exports.typedBind = typedBind;
    function dec2hex(dec) {
        return ("0" + dec.toString(16)).substr(-2)
    }
    exports.dec2hex = dec2hex;
    function generateId(len) {
        var arr = new Uint8Array((len || 40) / 2);
        (window.crypto || window.msCrypto).getRandomValues(arr);
        var result = [];
        for (var i = 0; i < arr.length; i++) {
            result[i] = dec2hex(arr[i])
        }
        return result.join("")
    }
    exports.generateId = generateId;
    function startsWith(word, prefix) {
        return word.slice(0, prefix.length) == prefix
    }
    exports.startsWith = startsWith
});
define("shared/alp/collaborate-controller", ["require", "exports", "tslib", "lib/i18n", "lib/ajaxmanager", "activitybuilder/ts-controller", "underscore", "lib/tools"], function(require, exports, tslib_1, i18n, ajaxmanager_1, ts_controller_1, _, tools_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var CollaborateController = function(_super) {
        tslib_1.__extends(CollaborateController, _super);
        function CollaborateController(resources, activity) {
            var _this = _super.call(this, resources) || this;
            _this.activity = activity;
            _this.ajax = new ajaxmanager_1.AjaxManager;
            _this.collaboratorEmail = "";
            _this.initiallyLoading = true;
            _this.errorLoading = false;
            _this.error = i18n.EMPTY;
            _this.fetchCollaborators();
            return _this
        }
        CollaborateController.prototype.confirmRemoveCollaborator = function(collaboratorId) {
            this.ajax.JSON("/" + this.activity.activityName + "/custom/" + this.activity._id + "/collaborate/remove", {
                key: "remove-collaborator"
            }, {
                collaboratorId: collaboratorId
            }).done(tools_1.typedBind(this.onRequestDone, this)).fail(tools_1.typedBind(this.onRemoveFail, this));
            this.dispatch({
                type: "render"
            })
        }
        ;
        CollaborateController.prototype.submitCollaboratorEmail = function() {
            if (this.submitDisabled())
                return;
            this.error = i18n.EMPTY;
            this.ajax.JSON("/" + this.activity.activityName + "/custom/" + this.activity._id + "/collaborate/add", {
                key: "add-collaborator"
            }, {
                email: this.collaboratorEmail
            }).done(tools_1.typedBind(this.onRequestDone, this)).fail(tools_1.typedBind(this.onAddFail, this));
            this.dispatch({
                type: "render"
            })
        }
        ;
        CollaborateController.prototype.updateCollaboratorEmail = function(email) {
            this.collaboratorEmail = email;
            this.error = i18n.EMPTY;
            this.dispatch({
                type: "render"
            })
        }
        ;
        CollaborateController.prototype.fetchCollaborators = function() {
            var _this = this;
            this.ajax.JSON("/" + this.activity.activityName + "/custom/" + this.activity._id + "/collaborate/get", {
                key: "get-collaborators"
            }, {}).done(function(collaborators) {
                _this.initiallyLoading = false;
                _this.onRequestDone(collaborators);
                _this.dispatch({
                    type: "render"
                })
            }).fail(function() {
                _this.initiallyLoading = false;
                _this.errorLoading = true;
                _this.dispatch({
                    type: "render"
                })
            })
        }
        ;
        CollaborateController.prototype.onRequestDone = function(collaborators) {
            this.collaboratorEmail = "";
            this.collaboratorData = collaborators;
            this.collaboratorEmails = _.pluck(_.values(this.collaboratorData), "email");
            if (this.resources.user.id !== this.activity.user.id && !(this.resources.user.id && !!this.collaboratorData[this.resources.user.id]) && !this.resources.user.isTeamDesmos())
                window.location.reload();
            this.dispatch({
                type: "render"
            })
        }
        ;
        CollaborateController.prototype.requestInFlight = function() {
            return !!this.ajax.findRequestByKey("get-collaborators") || !!this.ajax.findRequestByKey("add-collaborator") || !!this.ajax.findRequestByKey("remove-collaborator")
        }
        ;
        CollaborateController.prototype.onAddFail = function(err) {
            if (err.reason == "nouser") {
                this.error = i18n.s("teacher-error-collaborate-no-existing-user")
            } else {
                this.error = i18n.s("alp-error-collaborate-add-error")
            }
            this.dispatch({
                type: "render"
            })
        }
        ;
        CollaborateController.prototype.onRemoveFail = function() {
            this.error = i18n.s("alp-error-collaborate-remove-error");
            this.dispatch({
                type: "render"
            })
        }
        ;
        CollaborateController.prototype.submitDisabled = function() {
            var email = this.collaboratorEmail;
            if (!email.match(/.+@.+/))
                return true;
            if (email === this.resources.user.email)
                return true;
            if (this.collaboratorEmails && this.collaboratorEmails.indexOf(email) >= 0)
                return true;
            return this.requestInFlight()
        }
        ;
        CollaborateController.prototype.collaboratorIds = function() {
            if (!this.collaboratorData)
                return [];
            return _.keys(this.collaboratorData)
        }
        ;
        CollaborateController.prototype.getAuthorId = function() {
            return this.activity.user.id
        }
        ;
        CollaborateController.prototype.getCollaborator = function(collaboratorId) {
            if (!this.collaboratorData)
                return {
                    email: ""
                };
            return this.collaboratorData[collaboratorId] || {
                email: ""
            }
        }
        ;
        CollaborateController.prototype.exit = function() {
            this.resources.dispatcher.unregister(this.dispatchToken);
            this.ajax.abortOpenRequests()
        }
        ;
        return CollaborateController
    }(ts_controller_1.Controller);
    exports.CollaborateController = CollaborateController
});
define("loadcss!shared/alp/collaborator-row", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/alp/collaborator-row.css", decodeURIComponent(".collaborator-row%20%7B%0A%20%20border-top%3A%201px%20solid%20%23ccc%3B%0A%7D%0A.collaborator-row%3Alast-of-type%20%7B%0A%20%20border-bottom%3A%201px%20solid%20%23ccc%3B%0A%7D%0A.collaborator-row%20.collaborator-row-interior%20%7B%0A%20%20padding%3A%2010px%205px%3B%0A%7D%0A.collaborator-row%20.collaborator-row-interior%20.you-tag%20%7B%0A%20%20color%3A%20%23999%3B%0A%20%20margin-left%3A%205px%3B%0A%7D%0A.collaborator-row%20.start-remove-collaborator%20%7B%0A%20%20color%3A%20%23c0504d%3B%0A%20%20float%3A%20right%3B%0A%20%20text-decoration%3A%20underline%3B%0A%7D%0A.collaborator-row%20.start-remove-collaborator.dcg-hovered%20%7B%0A%20%20color%3A%20%23ad1a1a%3B%0A%7D%0A.collaborator-row%20.collaborator-confirm-remove%20%7B%0A%20%20background%3A%20rgba(192%2C80%2C77%2C0.2)%3B%0A%20%20padding%3A%205px%208px%3B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20line-height%3A%201.2em%3B%0A%20%20-webkit-box-align%3A%20center%3B%0A%20%20-moz-box-align%3A%20center%3B%0A%20%20-o-box-align%3A%20center%3B%0A%20%20-ms-flex-align%3A%20center%3B%0A%20%20-webkit-align-items%3A%20center%3B%0A%20%20align-items%3A%20center%3B%0A%7D%0A.collaborator-row%20.collaborator-confirm-remove%20.collaborator-confirm-remove-message%20%7B%0A%20%20-webkit-box-flex%3A%201%3B%0A%20%20-moz-box-flex%3A%201%3B%0A%20%20-o-box-flex%3A%201%3B%0A%20%20box-flex%3A%201%3B%0A%20%20-webkit-flex%3A%201%3B%0A%20%20-ms-flex%3A%201%3B%0A%20%20flex%3A%201%3B%0A%20%20font-size%3A%2090%25%3B%0A%7D%0A.collaborator-row%20.collaborator-confirm-remove%20.collaborator-confirm-remove-options%20.cancel-link%20%7B%0A%20%20text-decoration%3A%20underline%3B%0A%20%20color%3A%20%23666%3B%0A%20%20padding-right%3A%2015px%3B%0A%7D%0A.collaborator-row%20.collaborator-confirm-remove%20.collaborator-confirm-remove-options%20.cancel-link.dcg-hovered%2C%0A.collaborator-row%20.collaborator-confirm-remove%20.collaborator-confirm-remove-options%20.cancel-link.dcg-depressed%20%7B%0A%20%20color%3A%20%23333%3B%0A%7D%0A.collaborator-row%20.collaborator-confirm-remove%20.collaborator-confirm-remove-options%20.btn-red%20%7B%0A%20%20padding%3A%205px%2010px%3B%0A%20%20font-size%3A%20100%25%3B%0A%20%20line-height%3A%20initial%3B%0A%7D%0A"))
});
define("shared/alp/collaborator-row", ["require", "exports", "tslib", "lib/i18n", "dcgview", "loadcss!./collaborator-row"], function(require, exports, tslib_1, i18n, DCGView) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , Switch = _a.Switch
        , If = _a.If;
    var CollaboratorRow = function(_super) {
        tslib_1.__extends(CollaboratorRow, _super);
        function CollaboratorRow() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        CollaboratorRow.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                role: DCGView.const("listitem"),
                class: DCGView.const("collaborator-row")
            }, DCGView.createElement(Switch, {
                key: this.bindFn(this.rowType)
            }, function(rowType) {
                switch (rowType) {
                    case "owner":
                        return DCGView.createElement("div", {
                            class: DCGView.const("collaborator-author collaborator-row-interior")
                        }, function() {
                            return i18n.raw(_this.props.collaboratorEmail())
                        }, DCGView.createElement("span", {
                            class: DCGView.const("owner-tag")
                        }, function() {
                            return i18n.s("teacher-label-owner")
                        }));
                    case "collaboratorConfirm":
                        return DCGView.createElement("div", {
                            class: DCGView.const("collaborator-confirm-remove collaborator-row-interior")
                        }, DCGView.createElement("div", {
                            class: DCGView.const("collaborator-confirm-remove-message")
                        }, function() {
                            return _this.props.collaboratorEmail() ? i18n.s("alp-prompt-confirm-remove-collaborator-with-email", {
                                email: i18n.raw(_this.props.collaboratorEmail())
                            }) : i18n.s("alp-prompt-confirm-remove-collaborator-without-email")
                        }), DCGView.createElement("div", {
                            class: DCGView.const("collaborator-confirm-remove-options")
                        }, DCGView.createElement("span", {
                            role: DCGView.const("button"),
                            tabindex: DCGView.const("0"),
                            class: DCGView.const("cancel-link cancel-remove-collaborator"),
                            onTap: _this.bindFn(_this.bindFn(_this.onCancel))
                        }, function() {
                            return i18n.s("global-button-cancel")
                        }), DCGView.createElement("span", {
                            role: DCGView.const("button"),
                            tabindex: DCGView.const("0"),
                            class: function() {
                                return {
                                    "btn-red": true,
                                    "confirm-remove-collaborator": true,
                                    disabled: _this.isDeleting
                                }
                            },
                            onTap: _this.bindFn(_this.onRemove)
                        }, function() {
                            return i18n.s("global-button-remove")
                        })));
                    case "collaborator":
                        return DCGView.createElement("div", {
                            class: DCGView.const("collaborator-row-interior")
                        }, DCGView.createElement("span", {
                            class: DCGView.const("collaborator-email")
                        }, function() {
                            return _this.props.collaboratorEmail() ? i18n.raw(_this.props.collaboratorEmail()) : i18n.s("alp-label-collaborator-no-email")
                        }), DCGView.createElement(If, {
                            predicate: function() {
                                return !!_this.props.isUser && _this.props.isUser()
                            }
                        }, function() {
                            return DCGView.createElement("span", {
                                class: DCGView.const("you-tag")
                            }, function() {
                                return i18n.s("teacher-label-you-tag")
                            })
                        }), DCGView.createElement(If, {
                            predicate: function() {
                                return !_this.props.hideRemoveLink
                            }
                        }, function() {
                            return DCGView.createElement("span", {
                                role: DCGView.const("link"),
                                tabindex: DCGView.const("0"),
                                class: DCGView.const("link-red start-remove-collaborator"),
                                onTap: _this.bindFn(_this.onStartRemove)
                            }, function() {
                                return i18n.s("global-button-remove")
                            })
                        }))
                }
            }))
        }
        ;
        CollaboratorRow.prototype.rowType = function() {
            if (this.props.isAuthor && this.props.isAuthor()) {
                return "owner"
            }
            if (this.isConfirming) {
                return "collaboratorConfirm"
            }
            return "collaborator"
        }
        ;
        CollaboratorRow.prototype.onCancel = function() {
            this.isConfirming = false;
            this.isDeleting = false;
            this.update()
        }
        ;
        CollaboratorRow.prototype.onRemove = function() {
            if (!this.props.onRemove)
                return;
            this.isDeleting = true;
            this.update();
            this.props.onRemove()
        }
        ;
        CollaboratorRow.prototype.onStartRemove = function() {
            this.isConfirming = true;
            this.update()
        }
        ;
        return CollaboratorRow
    }(DCGView.Class);
    exports.CollaboratorRow = CollaboratorRow
});
define("loadcss!shared/alp/add-email-view", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/alp/add-email-view.css", decodeURIComponent(".collaborate-error-message%20%7B%0A%20%20text-align%3A%20center%3B%0A%20%20font-size%3A%2090%25%3B%0A%20%20background%3A%20rgba(192%2C80%2C77%2C0.1)%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%3A%201px%20solid%20rgba(192%2C80%2C77%2C0.5)%3B%0A%20%20border-radius%3A%203px%3B%0A%20%20color%3A%20%23c0504d%3B%0A%20%20-webkit-animation%3A%20fadeIn%200.3s%3B%0A%20%20-moz-animation%3A%20fadeIn%200.3s%3B%0A%20%20-o-animation%3A%20fadeIn%200.3s%3B%0A%20%20-ms-animation%3A%20fadeIn%200.3s%3B%0A%20%20animation%3A%20fadeIn%200.3s%3B%0A%20%20line-height%3A%201.2em%3B%0A%7D%0A.loading-collaborators%20%7B%0A%20%20-webkit-animation%3A%20pulse%202s%20infinite%3B%0A%20%20-moz-animation%3A%20pulse%202s%20infinite%3B%0A%20%20-o-animation%3A%20pulse%202s%20infinite%3B%0A%20%20-ms-animation%3A%20pulse%202s%20infinite%3B%0A%20%20animation%3A%20pulse%202s%20infinite%3B%0A%7D%0A.add-email-container%20%7B%0A%20%20width%3A%20100%25%3B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20margin%3A%2010px%200%3B%0A%7D%0A.add-email-container%20input%20%7B%0A%20%20-webkit-box-flex%3A%201%3B%0A%20%20-moz-box-flex%3A%201%3B%0A%20%20-o-box-flex%3A%201%3B%0A%20%20-ms-box-flex%3A%201%3B%0A%20%20box-flex%3A%201%3B%0A%20%20-webkit-flex-grow%3A%201%3B%0A%20%20flex-grow%3A%201%3B%0A%20%20font-size%3A%20100%25%3B%0A%20%20padding%3A%205px%2010px%3B%0A%7D%0A.add-email-container%20.btn-blue%20%7B%0A%20%20margin-left%3A%205px%3B%0A%7D%0A"))
});
define("shared/alp/add-email-view", ["require", "exports", "tslib", "lib/i18n", "dcgview", "jquery", "browser", "keys", "loadcss!./add-email-view"], function(require, exports, tslib_1, i18n, DCGView, $, Browser, Keys) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , Input = _a.Input
        , If = _a.If
        , Switch = _a.Switch;
    var AddEmailView = function(_super) {
        tslib_1.__extends(AddEmailView, _super);
        function AddEmailView() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        AddEmailView.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(Switch, {
                key: this.bindFn(this.getStatus)
            }, function(status) {
                switch (status) {
                    case "loaded":
                        return DCGView.createElement("div", null, DCGView.createElement("div", {
                            class: DCGView.const("add-email-container")
                        }, DCGView.createElement(Input, {
                            onInput: function(val) {
                                return _this.props.controller().updateCollaboratorEmail(val)
                            },
                            "aria-label": function() {
                                return i18n.s("alp-label-email-address")
                            },
                            placeholder: function() {
                                return i18n.s("alp-placeholder-email-address")
                            },
                            value: function() {
                                return _this.props.controller().collaboratorEmail
                            },
                            class: function() {
                                return {
                                    "blue-outline": true
                                }
                            },
                            didMount: _this.bindFn(_this.didMountInput),
                            didUnmount: _this.bindFn(_this.didUnmountInput),
                            disabled: function() {
                                return _this.props.controller().requestInFlight()
                            }
                        }), DCGView.createElement("div", {
                            role: DCGView.const("button"),
                            tabindex: function() {
                                return _this.props.controller().submitDisabled() ? -1 : 0
                            },
                            "aria-disabled": function() {
                                return _this.props.controller().submitDisabled()
                            },
                            class: function() {
                                return {
                                    "btn-blue": true,
                                    "submit-collaborator": true,
                                    disabled: _this.props.controller().submitDisabled()
                                }
                            },
                            onTap: function() {
                                return _this.props.controller().submitCollaboratorEmail()
                            }
                        }, function() {
                            return i18n.s("alp-button-add-collaborator")
                        })), DCGView.createElement(If, {
                            predicate: function() {
                                return !!_this.props.controller().error
                            }
                        }, function() {
                            return DCGView.createElement("div", {
                                "aria-live": DCGView.const("assertive"),
                                "aria-atomic": DCGView.const("true"),
                                class: DCGView.const("collaborate-error-message")
                            }, function() {
                                return _this.props.controller().error
                            })
                        }));
                    case "loading":
                        return DCGView.createElement("div", {
                            class: DCGView.const("loading-collaborators")
                        }, function() {
                            return i18n.s("global-message-loading")
                        });
                    case "error":
                        return DCGView.createElement("div", {
                            class: DCGView.const("collaborate-error-message"),
                            "aria-live": DCGView.const("assertive"),
                            "aria-atomic": DCGView.const("true")
                        }, function() {
                            return i18n.s("global-message-error-loading")
                        })
                }
            })
        }
        ;
        AddEmailView.prototype.getStatus = function() {
            if (this.props.controller().initiallyLoading)
                return "loading";
            if (this.props.controller().errorLoading)
                return "error";
            return "loaded"
        }
        ;
        AddEmailView.prototype.didMountInput = function(el) {
            var _this = this;
            if (!Browser.SHOULD_NOT_AUTOFOCUS) {
                el.focus()
            }
            $(el).on("keydown", function(evt) {
                if (Keys.lookup(evt) === Keys.ENTER) {
                    _this.props.controller().submitCollaboratorEmail()
                }
            })
        }
        ;
        AddEmailView.prototype.didUnmountInput = function(el) {
            $(el).off("keydown")
        }
        ;
        return AddEmailView
    }(DCGView.Class);
    exports.AddEmailView = AddEmailView
});
define("loadcss!shared/alp/collaborate-modal", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/alp/collaborate-modal.css", decodeURIComponent(".collaborate-container%20%7B%0A%20%20padding%3A%2020px%3B%0A%7D%0A.collaborate-container%20.collaborate-header%20%7B%0A%20%20color%3A%20%23000%3B%0A%20%20font-size%3A%20160%25%3B%0A%7D%0A.collaborate-container%20.collaborate-description%20%7B%0A%20%20color%3A%20%23666%3B%0A%20%20margin%3A%2010px%200%2020px%3B%0A%7D%0A.collaborate-container%20.collaborate-description%20.blue-link%20%7B%0A%20%20margin-left%3A%205px%3B%0A%7D%0A.collaborate-container%20.dividing-line%20%7B%0A%20%20height%3A%201px%3B%0A%20%20background-color%3A%20%23ccc%3B%0A%20%20width%3A%20100%25%3B%0A%7D%0A.collaborate-container%20.blue-outline%20%7B%0A%20%20width%3A%20300px%3B%0A%7D%0A.collaborate-container%20.owner-tag%20%7B%0A%20%20float%3A%20right%3B%0A%20%20color%3A%20%23999%3B%0A%7D%0A.collaborate-container%20.add-collaborator-title%20%7B%0A%20%20margin-top%3A%2020px%3B%0A%20%20font-size%3A%20110%25%3B%0A%7D%0A.collaborate-container%20.add-email-container%20%7B%0A%20%20margin%3A%205px%200%3B%0A%7D%0A"))
});
define("shared/alp/collaborate-modal", ["require", "exports", "tslib", "lib/i18n", "dcgview", "shared/dcgviews/modal", "./collaborate-controller", "./collaborator-row", "./add-email-view", "shared/dcgviews/localize", "loadcss!./collaborate-modal"], function(require, exports, tslib_1, i18n, DCGView, modal_1, collaborate_controller_1, collaborator_row_1, add_email_view_1, localize_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , IfElse = _a.IfElse
        , For = _a.For;
    var CollaborateModal = function(_super) {
        tslib_1.__extends(CollaborateModal, _super);
        function CollaborateModal() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        CollaborateModal.prototype.getController = function() {
            if (this.controller)
                return this.controller;
            this.controller = new collaborate_controller_1.CollaborateController(this.props.sharedResources(),this.props.activity());
            return this.controller
        }
        ;
        CollaborateModal.prototype.template = function() {
            var _this = this;
            var title = function() {
                return i18n.s("alp-title-collaborate")
            };
            return DCGView.createElement(modal_1.Modal, {
                ariaLabel: title,
                className: this.const("share-modal narrow-width"),
                visible: this.props.visible,
                onClose: this.props.onClose,
                showX: this.const(true)
            }, function() {
                return DCGView.createElement("div", {
                    class: function() {
                        return {
                            "collaborate-container": true,
                            disabled: _this.getController().requestInFlight()
                        }
                    }
                }, DCGView.createElement("div", {
                    role: DCGView.const("heading"),
                    "aria-level": DCGView.const("1"),
                    class: DCGView.const("collaborate-header")
                }, title), DCGView.createElement("div", {
                    class: DCGView.const("collaborate-description")
                }, DCGView.createElement(localize_1.Localize, {
                    key: _this.const("alp-message-collaborate-description")
                }, DCGView.const("Collaborators can:"), DCGView.createElement("ul", null, DCGView.createElement("li", null, DCGView.const("Edit "), DCGView.createElement("b", null, DCGView.const("or delete")), DCGView.const(" the activity.")), DCGView.createElement("li", null, DCGView.const("Add or remove collaborators.")), DCGView.createElement("li", null, DCGView.const("Find the activity in their Custom section."))), DCGView.const("Only one person can edit the activity at a time."), DCGView.createElement("a", {
                    href: DCGView.const("//learn.desmos.com/collaborate"),
                    class: DCGView.const("blue-link"),
                    target: DCGView.const("_blank")
                }, function() {
                    return i18n.s("global-button-learn-more")
                }))), IfElse(function() {
                    return _this.getController().collaboratorIds().length > 0
                }, {
                    true: function() {
                        return DCGView.createElement(For, {
                            each: function() {
                                return _this.getController().collaboratorIds()
                            }
                        }, DCGView.createElement("div", {
                            role: DCGView.const("list"),
                            class: DCGView.const("collaborators-list")
                        }, function(collaboratorId) {
                            return DCGView.createElement(collaborator_row_1.CollaboratorRow, {
                                collaboratorEmail: function() {
                                    return _this.getCollaboratorEmail(collaboratorId)
                                },
                                onRemove: function() {
                                    return _this.getController().confirmRemoveCollaborator(collaboratorId)
                                },
                                isAuthor: function() {
                                    return _this.getController().getAuthorId() === collaboratorId
                                },
                                isUser: function() {
                                    return _this.props.sharedResources().user.id === collaboratorId
                                }
                            })
                        }))
                    },
                    false: function() {
                        return DCGView.createElement("div", {
                            class: DCGView.const("dividing-line")
                        })
                    }
                }), DCGView.createElement("div", {
                    role: DCGView.const("heading"),
                    class: DCGView.const("add-collaborator-title"),
                    "aria-level": DCGView.const("2")
                }, function() {
                    return i18n.s("alp-heading-add-collaborator")
                }), DCGView.createElement(add_email_view_1.AddEmailView, {
                    controller: function() {
                        return _this.getController()
                    }
                }))
            })
        }
        ;
        CollaborateModal.prototype.getCollaboratorEmail = function(id) {
            var collaborator = this.getController().getCollaborator(id);
            if (collaborator.email)
                return collaborator.email;
            return ""
        }
        ;
        return CollaborateModal
    }(DCGView.Class);
    exports.CollaborateModal = CollaborateModal
});
define("shared/models/activity-cache", ["require", "exports", "lib/i18n"], function(require, exports, i18n) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var ActivityCache = function() {
        function ActivityCache(dispatcher) {
            var _this = this;
            this.dispatcher = dispatcher;
            this.activities = {};
            this.errors = {};
            this.dispatchToken = this.dispatcher.register(function(action) {
                switch (action.type) {
                    case "delete-activity":
                        var toDelete = _this.activities[action.activityId];
                        if (!toDelete) {
                            return
                        }
                        delete _this.errors[toDelete.id];
                        break;
                    case "activity-deleted":
                        delete _this.activities[action.activityId];
                        break;
                    case "delete-activity-failed":
                        var activity = _this.activities[action.activityId];
                        if (!activity) {
                            return
                        }
                        _this.errors[action.activityId] = i18n.s("teacher-error-deleting-activity");
                        break
                }
            })
        }
        ActivityCache.prototype.clear = function() {
            this.activities = {};
            this.errors = {}
        }
        ;
        ActivityCache.prototype.addActivities = function(activities) {
            for (var _i = 0, activities_1 = activities; _i < activities_1.length; _i++) {
                var activity = activities_1[_i];
                this.activities[activity.id] = activity
            }
        }
        ;
        ActivityCache.prototype.remove = function() {
            this.dispatcher.unregister(this.dispatchToken)
        }
        ;
        return ActivityCache
    }();
    exports.ActivityCache = ActivityCache
});
define("shared/models/activity-store", ["require", "exports", "tslib", "underscore", "lib/ajaxmanager", "./activity-cache", "lib/i18n", "bugsnag", "shared-types"], function(require, exports, tslib_1, _, ajaxmanager_1, activity_cache_1, i18n, bugsnag_1, shared_types_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var ActivityStore = function() {
        function ActivityStore(dispatcher) {
            var _this = this;
            this.dispatcher = dispatcher;
            this.pendingCustomRequests = {};
            this.loadingCustomRequests = {};
            this.deletedActivities = {};
            this.ajax = new ajaxmanager_1.AjaxManager;
            this.userCache = new activity_cache_1.ActivityCache(this.dispatcher);
            this.desmosCache = new activity_cache_1.ActivityCache(this.dispatcher);
            this.customIdCache = new activity_cache_1.ActivityCache(this.dispatcher);
            this.dispatcher.register(function(action) {
                _this.dispatcher.waitFor([_this.userCache.dispatchToken, _this.desmosCache.dispatchToken, _this.customIdCache.dispatchToken]);
                switch (action.type) {
                    case "user-update":
                        _this.updateUserCache(action.user);
                        break;
                    case "activity-deleted":
                        _this.clearCache();
                        break;
                    case "activities-loaded":
                        _this.clearCache();
                        break
                }
            })
        }
        ActivityStore.prototype.requestByNormalizedId = function(normalizedId) {
            var activity = this.getData().activities[normalizedId];
            if (activity) {
                return {
                    status: "loaded",
                    response: activity
                }
            }
            if (normalizedId.indexOf("desmos") > -1) {
                this.requestDesmos();
                return {
                    status: "loading"
                }
            } else {
                var id = normalizedId.split("custom:")[1];
                return this.requestCustom(id)
            }
        }
        ;
        ActivityStore.prototype.requestCustom = function(customId) {
            var activity = this.getData().activities["custom:" + customId];
            if (activity) {
                return {
                    status: "loaded",
                    response: activity
                }
            }
            if (this.deletedActivities[customId]) {
                return {
                    status: "error",
                    type: "deleted",
                    err: i18n.s("teacher-message-activity-deleted"),
                    deletedActivity: this.deletedActivities[customId]
                }
            }
            if (this.customIdCache.activities[customId]) {
                return {
                    status: "loaded",
                    response: this.customIdCache.activities[customId]
                }
            }
            if (this.customIdCache.errors[customId]) {
                return {
                    status: "error",
                    type: "unknown",
                    err: this.customIdCache.errors[customId]
                }
            }
            if (!this.loadingCustomRequests[customId] && !this.pendingCustomRequests[customId]) {
                this.pendingCustomRequests[customId] = true;
                this.scheduleCustomActivityRequest()
            }
            return {
                status: "loading"
            }
        }
        ;
        ActivityStore.prototype.scheduleCustomActivityRequest = function() {
            var _this = this;
            if (this.scheduledCustomRequest)
                return;
            this.scheduledCustomRequest = setTimeout(function() {
                _this.scheduledCustomRequest = undefined;
                var customIdsRequested = {};
                var count = 0;
                for (var id in _this.pendingCustomRequests) {
                    customIdsRequested[id] = true;
                    _this.loadingCustomRequests[id] = true;
                    delete _this.pendingCustomRequests[id];
                    count++;
                    if (count >= shared_types_1.MAX_ACTIVITY_LIST_SIZE)
                        break
                }
                _this.ajax.JSON("/activity-meta/custom", {
                    retry: 1e3
                }, {
                    customIds: _.keys(customIdsRequested)
                }).done(function(data) {
                    if (data) {
                        _this.customIdCache.addActivities(data.activities);
                        for (var _i = 0, _a = data.activities; _i < _a.length; _i++) {
                            var customId = _a[_i].customId;
                            delete customIdsRequested[customId];
                            delete _this.loadingCustomRequests[customId]
                        }
                        for (var _b = 0, _c = data.deletedActivities || []; _b < _c.length; _b++) {
                            var deleted = _c[_b];
                            _this.deletedActivities[deleted.customId] = deleted;
                            delete customIdsRequested[deleted.customId]
                        }
                    } else {
                        bugsnag_1.Bugsnag.notify("Expected data from /activity-meta/custom route, but got none.")
                    }
                    for (var id in customIdsRequested) {
                        _this.customIdCache.errors[id] = i18n.raw("Activity not found for id " + id);
                        bugsnag_1.Bugsnag.notify("Activity id " + id + " not fetched from /activity-meta/custom")
                    }
                    if (!_.isEmpty(_this.pendingCustomRequests)) {
                        _this.scheduleCustomActivityRequest()
                    }
                    _this.dispatcher.dispatch({
                        type: "activities-loaded"
                    })
                }).fail(function(err) {
                    for (var id in customIdsRequested) {
                        _this.customIdCache.errors[id] = err;
                        delete _this.loadingCustomRequests[id]
                    }
                    _this.dispatcher.dispatch({
                        type: "activities-loaded"
                    })
                })
            }, 0)
        }
        ;
        ActivityStore.prototype.requestDesmos = function() {
            if (!this.desmosActivitiesRequested) {
                this.desmosActivitiesRequested = true;
                this.fetchActivities(this.desmosCache, "/teacher/data/activities/desmos-and-curated", {
                    "collections-next": true
                })
            }
        }
        ;
        ActivityStore.prototype.requestUser = function(user) {
            this.userActivitiesRequested = true;
            this.updateUserCache(user)
        }
        ;
        ActivityStore.prototype.updateUserCache = function(user) {
            var userFingerprint = user == undefined ? "loggedout" : user.id + ";" + (user.roles || []).join(",") + ";" + (user.licenses || []).map(function(l) {
                return JSON.stringify(l)
            }).join(",");
            if (!this.userActivitiesRequested) {
                return
            }
            if (userFingerprint !== this.userFingerprint) {
                this.userFingerprint = userFingerprint;
                this.ajax.abort("/teacher/data/activities/user");
                this.userCache.clear();
                if (user) {
                    this.fetchActivities(this.userCache, "/teacher/data/activities/user", {})
                }
                this.clearCache()
            }
        }
        ;
        ActivityStore.prototype.fetchActivities = function(cache, url, payload) {
            var _this = this;
            this.ajax.JSON(url, {
                retry: 1e3,
                key: url
            }, payload).done(function(activities) {
                cache.addActivities(activities || []);
                _this.dispatcher.dispatch({
                    type: "activities-loaded"
                })
            })
        }
        ;
        ActivityStore.prototype.filterIds = function(predicate) {
            var _a = this.getData()
                , activities = _a.activities
                , sortedIds = _a.sortedIds;
            return _.filter(sortedIds, function(id) {
                return predicate(activities[id])
            })
        }
        ;
        ActivityStore.prototype.getData = function() {
            if (!this.mergedCache) {
                this.mergedCache = this.computeMergedCache()
            }
            return this.mergedCache
        }
        ;
        ActivityStore.prototype.clearCache = function() {
            delete this.mergedCache
        }
        ;
        ActivityStore.prototype.computeMergedCache = function() {
            var activities = tslib_1.__assign(tslib_1.__assign(tslib_1.__assign({}, this.userCache.activities), this.desmosCache.activities), this.customIdCache.activities);
            var sortedActivities = _.sortBy(_.values(activities), function(a) {
                if (a.source == "custom") {
                    return -new Date(a.edit_ts)
                } else {
                    return -new Date(0)
                }
            });
            var sortedIds = _.pluck(sortedActivities, "id");
            var stateKey = sortedIds.join("");
            return {
                activities: activities,
                sortedIds: sortedIds,
                sortedActivities: sortedActivities,
                stateKey: stateKey
            }
        }
        ;
        return ActivityStore
    }();
    exports.ActivityStore = ActivityStore;
    function partnerExclusive(activity, user) {
        if (activity.licenseAccess === "preview")
            return undefined;
        var isCPM = user && user.hasCPMLicense() && !!_.find(activity.licenses, function(license) {
            return license.type == "product" && (license.productId == "cpm-cc1" || license.productId == "cpm-cc2" || license.productId == "cpm-cc3")
        });
        var isEurekaPilotActivity = !!_.find(activity.licenses, function(license) {
            return license.type == "product" && (license.productId == "eureka-pilot-7" || license.productId == "eureka-pilot-8")
        });
        var isIMPilot = !!_.find(activity.licenses, function(license) {
            return license.type == "product" && license.productId == "im-pilot"
        });
        if (isCPM) {
            return "CPM"
        }
        if (isEurekaPilotActivity && user.hasLicenses(activity.licenses)) {
            return "Eureka"
        }
        if (isIMPilot && user.hasLicenses(activity.licenses)) {
            return "IM Pilot"
        }
        if (activity.licenses.length > 0 && user.hasLicenses(activity.licenses)) {
            return "Desmos Classroom"
        }
        return undefined
    }
    exports.partnerExclusive = partnerExclusive
});
define("shared/alp/actions-controller", ["require", "exports", "tslib", "activitybuilder/ts-controller"], function(require, exports, tslib_1, ts_controller_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var ActionsController = function(_super) {
        tslib_1.__extends(ActionsController, _super);
        function ActionsController(resources) {
            var _this = _super.call(this, resources) || this;
            _this.deleteModalVisible = false;
            _this.shareModalVisible = false;
            _this.collaborateModalVisible = false;
            _this.editWarningModalVisible = false;
            _this.discardDraftVisible = false;
            _this.dispatchToken = _this.resources.dispatcher.register(function(action) {
                if (_this.myAction(action)) {
                    switch (action.type) {
                        case "set-activity-delete-modal":
                            _this.deleteModalVisible = action.modalVisible;
                            break;
                        case "set-activity-share-modal":
                            _this.shareModalVisible = action.modalVisible;
                            break;
                        case "set-activity-collaborate-modal":
                            _this.collaborateModalVisible = action.modalVisible;
                            break;
                        case "set-edit-warning-modal":
                            _this.editWarningModalVisible = action.modalVisible;
                            break;
                        case "set-discard-draft-modal":
                            _this.discardDraftVisible = action.modalVisible;
                            break
                    }
                }
            });
            return _this
        }
        ActionsController.prototype.exit = function() {
            this.resources.dispatcher.unregister(this.dispatchToken)
        }
        ;
        return ActionsController
    }(ts_controller_1.Controller);
    exports.ActionsController = ActionsController
});
define("lib/window-location-proxy", ["require", "exports", "./retain-lang"], function(require, exports, retain_lang_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.href = window.location.href;
    var historyChangeCbs = [];
    function notifyHistoryChange() {
        for (var _i = 0, historyChangeCbs_1 = historyChangeCbs; _i < historyChangeCbs_1.length; _i++) {
            var cb = historyChangeCbs_1[_i];
            cb()
        }
    }
    function addHistoryChangeCb(cb) {
        historyChangeCbs.push(cb)
    }
    exports.addHistoryChangeCb = addHistoryChangeCb;
    function clearHistoryChangeCallbacks() {
        historyChangeCbs = []
    }
    exports.clearHistoryChangeCallbacks = clearHistoryChangeCallbacks;
    function replace(url) {
        var result = window.location.replace(retain_lang_1.retainLang(url));
        notifyHistoryChange();
        return result
    }
    exports.replace = replace;
    function assign(url) {
        var result = window.location.assign(retain_lang_1.retainLang(url));
        notifyHistoryChange();
        return result
    }
    exports.assign = assign;
    function historyPushState(stateObj, title, url) {
        var result = window.history.pushState(stateObj, title, retain_lang_1.retainLang(url));
        notifyHistoryChange();
        return result
    }
    exports.historyPushState = historyPushState;
    function historyReplaceState(stateObj, title, url) {
        var result = window.history.replaceState(stateObj, title, retain_lang_1.retainLang(url));
        notifyHistoryChange();
        return result
    }
    exports.historyReplaceState = historyReplaceState
});
define("loadcss!shared/alp/actions-menu", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/alp/actions-menu.css", decodeURIComponent(".actions-dropdown.options-dropdown%20%7B%0A%20%20min-width%3A%20160px%3B%0A%7D%0A.actions-dropdown.options-dropdown%3Aafter%20%7B%0A%20%20content%3A%20%22%22%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-9px%3B%0A%20%20right%3A%205px%3B%0A%20%20border-width%3A%209px%3B%0A%20%20border-top-width%3A%200%3B%0A%20%20border-style%3A%20solid%3B%0A%20%20border-color%3A%20transparent%20transparent%20%23fff%3B%0A%20%20line-height%3A%200%3B%0A%20%20z-index%3A%20zindex%3B%0A%7D%0A.actions-dropdown.options-dropdown%3Abefore%20%7B%0A%20%20content%3A%20%22%22%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-10px%3B%0A%20%20right%3A%204px%3B%0A%20%20border-width%3A%2010px%3B%0A%20%20border-top-width%3A%200%3B%0A%20%20border-style%3A%20solid%3B%0A%20%20border-color%3A%20transparent%20transparent%20%23ccc%3B%0A%20%20line-height%3A%200%3B%0A%7D%0A"))
});
define("shared/alp/actions-menu", ["require", "exports", "tslib", "lib/i18n", "dcgview", "shared/dcgviews/dropdown/dot-dot-options-dropdown", "shared/dcgviews/delete-modal", "shared/alp/share-modal", "shared/alp/edit-warning-modal", "shared/alp/collaborate-modal", "shared/models/activity-store", "./actions-controller", "lib/window-location-proxy", "loadcss!./actions-menu"], function(require, exports, tslib_1, i18n, DCGView, dot_dot_options_dropdown_1, delete_modal_1, share_modal_1, edit_warning_modal_1, collaborate_modal_1, activity_store_1, actions_controller_1, WindowLocationProxy) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var ActionsMenu = function(_super) {
        tslib_1.__extends(ActionsMenu, _super);
        function ActionsMenu() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ActionsMenu.prototype.template = function() {
            var _this = this;
            this.controller = new actions_controller_1.ActionsController(this.props.alpResources());
            return DCGView.createElement("div", null, DCGView.createElement(delete_modal_1.DeleteModal, {
                visible: function() {
                    return _this.controller.deleteModalVisible
                },
                activity: this.props.activity,
                dispatch: this.controller.dispatch,
                onClose: function() {
                    return _this.controller.dispatch({
                        type: "set-activity-delete-modal",
                        modalVisible: false
                    })
                }
            }), DCGView.createElement(edit_warning_modal_1.EditWarningModal, {
                visible: function() {
                    return _this.controller.editWarningModalVisible
                },
                activity: this.props.activity,
                onClose: function() {
                    return _this.controller.dispatch({
                        type: "set-edit-warning-modal",
                        modalVisible: false
                    })
                },
                lesson: this.props.lesson,
                resources: this.props.alpResources
            }), DCGView.createElement(share_modal_1.ShareModal, {
                visible: function() {
                    return _this.controller.shareModalVisible
                },
                activity: this.props.activity,
                parentCollectionIds: this.props.parentCollectionIds,
                partnerActivity: function() {
                    return activity_store_1.partnerExclusive(_this.props.activity(), _this.props.alpResources().user)
                },
                onClose: function() {
                    return _this.controller.dispatch({
                        type: "set-activity-share-modal",
                        modalVisible: false
                    })
                }
            }), DCGView.createElement(collaborate_modal_1.CollaborateModal, {
                visible: function() {
                    return _this.controller.collaborateModalVisible
                },
                sharedResources: this.props.alpResources,
                activity: this.props.activity,
                onClose: function() {
                    return _this.controller.dispatch({
                        type: "set-activity-collaborate-modal",
                        modalVisible: false
                    })
                }
            }), DCGView.createElement(dot_dot_options_dropdown_1.DotDotOptionsDropdown, {
                dropdownOptions: this.actionsList.bind(this),
                class: this.const("actions-dropdown")
            }))
        }
        ;
        ActionsMenu.prototype.willUnmount = function() {
            this.controller.exit();
            delete this.controller
        }
        ;
        ActionsMenu.prototype.isImportantDesmosActivity = function() {
            return this.props.activity().teamDesmosAuthored && (!!this.props.activity().curriculumActivityLocation || this.props.activity().searchable)
        }
        ;
        ActionsMenu.prototype.actionsList = function() {
            var _this = this;
            var options = [];
            var user = this.props.alpResources().user;
            var activity = this.props.activity();
            var canEdit = user.owns(activity);
            var shareDisabled = activity.private;
            if (canEdit) {
                if (this.isImportantDesmosActivity()) {
                    if (this.props.onALP()) {
                        options.push({
                            title: function() {
                                return i18n.s("teacher-button-edit-desmos-activity")
                            },
                            icon: "pillow-icon-pencil",
                            class: "edit-activity-link blue-link",
                            action: function() {
                                return _this.controller.dispatch({
                                    type: "set-edit-warning-modal",
                                    modalVisible: true
                                })
                            },
                            href: undefined
                        })
                    }
                } else {
                    options.push({
                        title: function() {
                            return i18n.s("alp-button-edit-activity")
                        },
                        icon: "pillow-icon-pencil",
                        class: "edit-activity-link blue-link",
                        href: "/" + activity.activityName + "/custom/" + activity._id + "/edit"
                    })
                }
            }
            if (canEdit) {
                options.push({
                    title: function() {
                        return i18n.s("alp-button-collaborate")
                    },
                    icon: "pillow-icon-people",
                    class: "collaborate-link",
                    action: function() {
                        return _this.controller.dispatch({
                            type: "set-activity-collaborate-modal",
                            modalVisible: true
                        })
                    },
                    href: undefined
                })
            }
            var shareOption = {
                title: function() {
                    return i18n.s("alp-button-share-activity")
                },
                icon: "pillow-icon-share",
                class: "share-activity-link",
                action: function() {
                    return _this.controller.dispatch({
                        type: "set-activity-share-modal",
                        modalVisible: true
                    })
                },
                href: undefined
            };
            if (shareDisabled) {
                shareOption.disabled = true;
                shareOption.action = function() {}
                ;
                shareOption.explanations = [{
                    flag: "",
                    explanation: i18n.s("alp-message-share-disabled")
                }]
            }
            options.push(shareOption);
            var reasonsToDisableDuplicate = this.props.activity().activityName === "activitybuilder" ? this.props.showDuplicate() : [];
            var duplicateDisabled = reasonsToDisableDuplicate.length > 0;
            if (this.props.onALP() || canEdit) {
                var option = {
                    title: function() {
                        return i18n.s("alp-button-copy-and-edit")
                    },
                    icon: "pillow-icon-duplicate",
                    class: "copy-link",
                    action: this.copy.bind(this),
                    href: undefined
                };
                if (duplicateDisabled) {
                    option.disabled = true;
                    option.explanations = reasonsToDisableDuplicate
                }
                options.push(option)
            }
            if (user.isTeamDesmos() && this.props.onALP()) {
                options.push({
                    title: function() {
                        return i18n.s("teacher-label-alp-menu-view-original")
                    },
                    icon: "pillow-icon-undo",
                    class: "link-to-original",
                    action: function() {},
                    href: "/" + activity.activityName + "/custom/" + (activity.ancestors && activity.ancestors[0] && activity.ancestors[0]._id)
                });
                options.push({
                    title: function() {
                        return i18n.s("teacher-label-open-readonly-editor")
                    },
                    icon: "pillow-icon-labs",
                    href: "/activitybuilder/custom/" + this.props.activity()._id + "/edit-readonly/published"
                })
            }
            if (user.isAdmin) {
                options.push({
                    title: function() {
                        return i18n.s("teacher-label-alp-menu-activity-data")
                    },
                    icon: "pillow-icon-clipboard",
                    class: "activity-data-link",
                    action: function() {},
                    href: "https://desmos.looker.com/dashboards/5?Activity%20ID=" + activity._id
                })
            }
            if (user.isTeamDesmos() && !activity.private && this.props.onALP()) {
                options.push({
                    title: function() {
                        return i18n.s("teacher-label-alp-menu-permissions")
                    },
                    icon: "pillow-icon-check",
                    class: "permissions-link",
                    action: function() {
                        return _this.props.alpResources().dispatch({
                            type: "toggle-permissions-area"
                        })
                    },
                    href: undefined
                })
            }
            if (this.canViewAuthorSettings()) {
                options.push({
                    title: function() {
                        return i18n.s("teacher-label-alp-menu-authorship-settings")
                    },
                    icon: "pillow-icon-person",
                    class: "author-settings-link",
                    action: this.authorSettings.bind(this),
                    href: undefined
                })
            }
            if (canEdit) {
                options.push({
                    title: function() {
                        return i18n.s("alp-button-delete-activity")
                    },
                    icon: "pillow-icon-remove",
                    class: "delete-activity-link red-link",
                    action: function() {
                        return _this.controller.dispatch({
                            type: "set-activity-delete-modal",
                            modalVisible: true
                        })
                    },
                    href: undefined
                })
            }
            return options
        }
        ;
        ActionsMenu.prototype.canViewAuthorSettings = function() {
            if (this.props.alpResources().user.isTeamDesmos() || this.props.alpResources().user.hasRole("cpmAuthor")) {
                return !this.props.activity().private && this.props.onALP() && this.props.alpResources().user.owns(this.props.activity())
            }
            return false
        }
        ;
        ActionsMenu.prototype.copy = function() {
            if (this.props.alpResources().user.loggedIn) {
                WindowLocationProxy.assign("/" + this.props.activity().activityName + "/custom/" + this.props.activity()._id + "/copy")
            } else {
                this.props.alpResources().headerController.dispatch({
                    type: "update-mode",
                    mode: "login",
                    message: i18n.s("alp-button-copy-instance-denied")
                })
            }
        }
        ;
        ActionsMenu.prototype.authorSettings = function() {
            this.props.alpResources().dispatch({
                type: "toggle-author-settings"
            })
        }
        ;
        return ActionsMenu
    }(DCGView.Class);
    exports.ActionsMenu = ActionsMenu
});
define("loadcss!teacher-spa/activity-ribbon", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/teacher-spa/activity-ribbon.css", decodeURIComponent(".activity-ribbon-container%20%7B%0A%20%20width%3A%20100px%3B%0A%20%20height%3A%20100px%3B%0A%20%20overflow%3A%20hidden%3B%0A%20%20font-size%3A%2080%25%3B%0A%7D%0A.activity-ribbon-container%20i%20%7B%0A%20%20font-size%3A%2070%25%3B%0A%7D%0A.activity-ribbon-container%3A%3Abefore%2C%0A.activity-ribbon-container%3A%3Aafter%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20z-index%3A%20-1%3B%0A%20%20content%3A%20''%3B%0A%20%20display%3A%20block%3B%0A%20%20border-top-color%3A%20transparent%3B%0A%20%20border-left-color%3A%20transparent%3B%0A%7D%0A.activity-ribbon-container%3A%3Abefore%20%7B%0A%20%20top%3A%200%3B%0A%20%20right%3A%2027px%3B%0A%7D%0A.activity-ribbon-container%3A%3Aafter%20%7B%0A%20%20bottom%3A%2027px%3B%0A%20%20left%3A%200%3B%0A%7D%0A.activity-ribbon-container%20.activity-ribbon%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%2015px%3B%0A%20%20right%3A%2015px%3B%0A%20%20width%3A%20115px%3B%0A%20%20padding%3A%205px%200%3B%0A%20%20-webkit-box-shadow%3A%200%201px%201px%20rgba(0%2C0%2C0%2C0.2)%3B%0A%20%20box-shadow%3A%200%201px%201px%20rgba(0%2C0%2C0%2C0.2)%3B%0A%20%20color%3A%20%23fff%3B%0A%20%20text-align%3A%20center%3B%0A%20%20-webkit-transform%3A%20rotate(-45deg)%3B%0A%20%20-moz-transform%3A%20rotate(-45deg)%3B%0A%20%20-o-transform%3A%20rotate(-45deg)%3B%0A%20%20-ms-transform%3A%20rotate(-45deg)%3B%0A%20%20transform%3A%20rotate(-45deg)%3B%0A%7D%0A.activity-ribbon-container%20.activity-ribbon.private-ribbon%20%7B%0A%20%20background-color%3A%20%2315b097%3B%0A%7D%0A.activity-ribbon-container%20.activity-ribbon.curriculum-preview-ribbon%20%7B%0A%20%20background-color%3A%20%23999%3B%0A%7D%0A.activity-ribbon-container%20.activity-ribbon.curriculum-runnable-ribbon%20%7B%0A%20%20background-color%3A%20%234781b9%3B%0A%7D%0A.activity-thumb-container%20%7B%0A%20%20z-index%3A%201%3B%0A%7D%0A.activity-thumb-container%20.activity-ribbon-container%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-5px%3B%0A%20%20left%3A%20-5px%3B%0A%7D%0A.activity-thumb-container%20.activity-ribbon-container.private-ribbon-container%3A%3Abefore%2C%0A.activity-thumb-container%20.activity-ribbon-container.private-ribbon-container%3A%3Aafter%20%7B%0A%20%20border%3A%205px%20solid%20%230f8371%3B%0A%7D%0A.activity-thumb-container%20.activity-ribbon-container.curriculum-preview-ribbon-container%3A%3Abefore%2C%0A.activity-thumb-container%20.activity-ribbon-container.curriculum-preview-ribbon-container%3A%3Aafter%20%7B%0A%20%20border%3A%205px%20solid%20%23666%3B%0A%7D%0A.activity-thumb-container%20.activity-ribbon-container.curriculum-runnable-ribbon-container%3A%3Abefore%2C%0A.activity-thumb-container%20.activity-ribbon-container.curriculum-runnable-ribbon-container%3A%3Aafter%20%7B%0A%20%20border%3A%205px%20solid%20%2335608a%3B%0A%7D%0A.card-contents%20.activity-ribbon-container%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-7px%3B%0A%20%20left%3A%20-7px%3B%0A%7D%0A.card-contents%20.activity-ribbon-container.private-ribbon-container%3A%3Abefore%2C%0A.card-contents%20.activity-ribbon-container.private-ribbon-container%3A%3Aafter%20%7B%0A%20%20border%3A%207px%20solid%20%230f8371%3B%0A%7D%0A.card-contents%20.activity-ribbon-container.curriculum-preview-ribbon-container%3A%3Abefore%2C%0A.card-contents%20.activity-ribbon-container.curriculum-preview-ribbon-container%3A%3Aafter%20%7B%0A%20%20border%3A%207px%20solid%20%23666%3B%0A%7D%0A.card-contents%20.activity-ribbon-container.curriculum-runnable-ribbon-container%3A%3Abefore%2C%0A.card-contents%20.activity-ribbon-container.curriculum-runnable-ribbon-container%3A%3Aafter%20%7B%0A%20%20border%3A%207px%20solid%20%2335608a%3B%0A%7D%0A"))
});
define("teacher-spa/activity-ribbon", ["require", "exports", "tslib", "lib/i18n", "dcgview", "core/lib/assert-unreachable", "loadcss!./activity-ribbon"], function(require, exports, tslib_1, i18n, DCGView, assert_unreachable_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var If = DCGView.Components.If;
    var ActivityRibbon = function(_super) {
        tslib_1.__extends(ActivityRibbon, _super);
        function ActivityRibbon() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ActivityRibbon.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                class: function() {
                    return {
                        "activity-ribbon-container": true,
                        "private-ribbon-container": _this.props.ribbonType() === "private",
                        "curriculum-preview-ribbon-container": _this.props.ribbonType() === "curriculum-preview",
                        "curriculum-runnable-ribbon-container": _this.props.ribbonType() === "curriculum-runnable"
                    }
                }
            }, DCGView.createElement("div", {
                class: function() {
                    return {
                        "activity-ribbon": true,
                        "private-ribbon": _this.props.ribbonType() === "private",
                        "curriculum-preview-ribbon": _this.props.ribbonType() === "curriculum-preview",
                        "curriculum-runnable-ribbon": _this.props.ribbonType() === "curriculum-runnable"
                    }
                }
            }, DCGView.createElement(If, {
                predicate: function() {
                    return _this.props.ribbonType() === "private"
                }
            }, function() {
                return DCGView.createElement("i", {
                    class: DCGView.const("pillow-icon-lock")
                })
            }), DCGView.const(" "), function() {
                return _this.getRibbonText()
            }))
        }
        ;
        ActivityRibbon.prototype.getRibbonText = function() {
            var ribbonType = this.props.ribbonType();
            switch (ribbonType) {
                case "private":
                    return i18n.s("teacher-label-private-activity");
                case "curriculum-preview":
                    return i18n.s("teacher-label-preview-activity");
                case "curriculum-runnable":
                    return i18n.s("teacher-label-try-it-activity");
                default:
                    return assert_unreachable_1.assertUnreachable(ribbonType)
            }
        }
        ;
        return ActivityRibbon
    }(DCGView.Class);
    exports.ActivityRibbon = ActivityRibbon
});
define("core/lib/rich-text-helpers", ["require", "exports", "tslib", "../prosemirror/prosemirror-serialize", "prosemirror-model", "./rich-text", "./log", "./assert-unreachable"], function(require, exports, tslib_1, prosemirror_serialize_1, prosemirror_model_1, rich_text_1, log_1, assert_unreachable_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function updateRichTextVersion(richText) {
        var schema = rich_text_1.schemas[richText.schemaKey];
        if (richText.version === schema.version)
            return richText;
        var doc = prosemirror_model_1.Node.fromJSON(schema.schema, richText.content);
        return richTextFromNode(richText.schemaKey, doc)
    }
    exports.updateRichTextVersion = updateRichTextVersion;
    function getNodeFromRichText(richText) {
        return prosemirror_model_1.Node.fromJSON(getSchemaFromRichText(richText), richText.content)
    }
    exports.getNodeFromRichText = getNodeFromRichText;
    function getSchemaFromRichText(richText) {
        return rich_text_1.schemas[richText.schemaKey].schema
    }
    exports.getSchemaFromRichText = getSchemaFromRichText;
    function richTextFromNode(schemaKey, node) {
        return {
            schemaKey: schemaKey,
            version: rich_text_1.schemas[schemaKey].version,
            content: node.toJSON()
        }
    }
    exports.richTextFromNode = richTextFromNode;
    function richTextFromText(schemaKey, text) {
        var schema = rich_text_1.schemas[schemaKey].schema;
        var paragraphNodeType;
        var key = schemaKey;
        switch (key) {
            case "heading":
                paragraphNodeType = schema.nodes["heading"];
                break;
            case "document":
            case "section":
            case "lesson":
                paragraphNodeType = schema.nodes["paragraph"];
                break;
            default:
                assert_unreachable_1.assertUnreachable(key)
        }
        var lines = text.trim().split("\n").map(function(line) {
            return paragraphNodeType.create(undefined, prosemirror_serialize_1.stringToNodes(line, schema))
        });
        var node = schema.nodes[schema.spec.topNode || "doc"].create(undefined, lines);
        return {
            schemaKey: schemaKey,
            version: rich_text_1.schemas[schemaKey].version,
            content: node.toJSON()
        }
    }
    exports.richTextFromText = richTextFromText;
    function richTextFromLatex(latex) {
        var innerTextContent = latex.length > 0 ? [{
            type: "text",
            text: latex
        }] : [];
        return {
            schemaKey: "document",
            version: 1,
            content: {
                type: "doc",
                content: [{
                    type: "mq",
                    content: innerTextContent
                }]
            }
        }
    }
    exports.richTextFromLatex = richTextFromLatex;
    function sliceParagraphs(doc, start, end) {
        if (doc.content.type !== "doc") {
            log_1.warn("RichTextParseError", "Expected RichText<document> root to be of type 'doc', but found " + doc.content.type + " instead");
            return doc
        }
        var children = doc.content.content || [];
        return tslib_1.__assign(tslib_1.__assign({}, doc), {
            content: tslib_1.__assign(tslib_1.__assign({}, doc.content), {
                content: children.slice(start, end)
            })
        })
    }
    exports.sliceParagraphs = sliceParagraphs
});
define("i18n", ["require", "exports", "tslib", "lib/i18n"], function(require, exports, tslib_1, i18n_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    tslib_1.__exportStar(i18n_1, exports)
});
define("loadcss!teacher-spa/collections/collection-colors", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/teacher-spa/collections/collection-colors.css", decodeURIComponent(".collections-bg-blue%20%7B%0A%20%20background-color%3A%20%234f87bf%3B%0A%7D%0A.collections-bg-purple%20%7B%0A%20%20background-color%3A%20%238551c1%3B%0A%7D%0A.collections-bg-coral%20%7B%0A%20%20background-color%3A%20%23e56776%3B%0A%7D%0A.collections-bg-green%20%7B%0A%20%20background-color%3A%20%2336a37c%3B%0A%7D%0A.collections-bg-orange%20%7B%0A%20%20background-color%3A%20%23ce754d%3B%0A%7D%0A.collections-bg-pink%20%7B%0A%20%20background-color%3A%20%23c651a6%3B%0A%7D%0A.collections-bg-teal%20%7B%0A%20%20background-color%3A%20%233e9b96%3B%0A%7D%0A.activity-details-container%20.collections-bg-blue.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.collections-bg-blue.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%234679ab%3B%0A%7D%0A.activity-details-container%20.collections-bg-blue.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.collections-bg-blue.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%233b658f%3B%0A%7D%0A.activity-details-container%20.collections-bg-purple.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.collections-bg-purple.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%237748ad%3B%0A%7D%0A.activity-details-container%20.collections-bg-purple.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.collections-bg-purple.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%23633c90%3B%0A%7D%0A.activity-details-container%20.collections-bg-coral.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.collections-bg-coral.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%23cd5c69%3B%0A%7D%0A.activity-details-container%20.collections-bg-coral.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.collections-bg-coral.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%23ab4d58%3B%0A%7D%0A.activity-details-container%20.collections-bg-green.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.collections-bg-green.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%2330926f%3B%0A%7D%0A.activity-details-container%20.collections-bg-green.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.collections-bg-green.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%23287a5c%3B%0A%7D%0A.activity-details-container%20.collections-bg-orange.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.collections-bg-orange.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%23b86945%3B%0A%7D%0A.activity-details-container%20.collections-bg-orange.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.collections-bg-orange.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%239a5739%3B%0A%7D%0A.activity-details-container%20.collections-bg-pink.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.collections-bg-pink.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%23b14895%3B%0A%7D%0A.activity-details-container%20.collections-bg-pink.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.collections-bg-pink.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%23943c7c%3B%0A%7D%0A.activity-details-container%20.collections-bg-teal.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.collections-bg-teal.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%23378b86%3B%0A%7D%0A.activity-details-container%20.collections-bg-teal.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.collections-bg-teal.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%232e7470%3B%0A%7D%0A.collection-option-container%20.collections-bg-blue%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%234f87bf%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%234f87bf%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%234f87bf%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.collections-bg-blue%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%234f87bf%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%234f87bf%3B%0A%7D%0A.collection-option-container%20.collections-bg-blue%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(79%2C135%2C191%2C0.2)%3B%0A%7D%0A.collection-option-container%20.collections-bg-purple%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%238551c1%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%238551c1%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%238551c1%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.collections-bg-purple%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%238551c1%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%238551c1%3B%0A%7D%0A.collection-option-container%20.collections-bg-purple%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(133%2C81%2C193%2C0.2)%3B%0A%7D%0A.collection-option-container%20.collections-bg-coral%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%23e56776%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%23e56776%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%23e56776%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.collections-bg-coral%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%23e56776%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%23e56776%3B%0A%7D%0A.collection-option-container%20.collections-bg-coral%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(229%2C103%2C118%2C0.2)%3B%0A%7D%0A.collection-option-container%20.collections-bg-green%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%2336a37c%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%2336a37c%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%2336a37c%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.collections-bg-green%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%2336a37c%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%2336a37c%3B%0A%7D%0A.collection-option-container%20.collections-bg-green%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(54%2C163%2C124%2C0.2)%3B%0A%7D%0A.collection-option-container%20.collections-bg-orange%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%23ce754d%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%23ce754d%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%23ce754d%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.collections-bg-orange%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%23ce754d%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%23ce754d%3B%0A%7D%0A.collection-option-container%20.collections-bg-orange%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(206%2C117%2C77%2C0.2)%3B%0A%7D%0A.collection-option-container%20.collections-bg-pink%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%23c651a6%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%23c651a6%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%23c651a6%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.collections-bg-pink%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%23c651a6%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%23c651a6%3B%0A%7D%0A.collection-option-container%20.collections-bg-pink%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(198%2C81%2C166%2C0.2)%3B%0A%7D%0A.collection-option-container%20.collections-bg-teal%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%233e9b96%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%233e9b96%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%233e9b96%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.collections-bg-teal%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%233e9b96%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%233e9b96%3B%0A%7D%0A.collection-option-container%20.collections-bg-teal%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(62%2C155%2C150%2C0.2)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.collections-bg-blue%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(79%2C135%2C191%2C0)%200%25%2C%20rgba(79%2C135%2C191%2C0.9)%2050%25%2C%20%234f87bf%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(79%2C135%2C191%2C0)%200%25%2C%20rgba(79%2C135%2C191%2C0.9)%2050%25%2C%20%234f87bf%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(79%2C135%2C191%2C0)%200%25%2C%20rgba(79%2C135%2C191%2C0.9)%2050%25%2C%20%234f87bf%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(79%2C135%2C191%2C0)%200%25%2C%20rgba(79%2C135%2C191%2C0.9)%2050%25%2C%20%234f87bf%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(79%2C135%2C191%2C0)%200%25%2C%20rgba(79%2C135%2C191%2C0.9)%2050%25%2C%20%234f87bf%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.collections-bg-purple%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(133%2C81%2C193%2C0)%200%25%2C%20rgba(133%2C81%2C193%2C0.9)%2050%25%2C%20%238551c1%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(133%2C81%2C193%2C0)%200%25%2C%20rgba(133%2C81%2C193%2C0.9)%2050%25%2C%20%238551c1%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(133%2C81%2C193%2C0)%200%25%2C%20rgba(133%2C81%2C193%2C0.9)%2050%25%2C%20%238551c1%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(133%2C81%2C193%2C0)%200%25%2C%20rgba(133%2C81%2C193%2C0.9)%2050%25%2C%20%238551c1%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(133%2C81%2C193%2C0)%200%25%2C%20rgba(133%2C81%2C193%2C0.9)%2050%25%2C%20%238551c1%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.collections-bg-coral%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(229%2C103%2C118%2C0)%200%25%2C%20rgba(229%2C103%2C118%2C0.9)%2050%25%2C%20%23e56776%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(229%2C103%2C118%2C0)%200%25%2C%20rgba(229%2C103%2C118%2C0.9)%2050%25%2C%20%23e56776%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(229%2C103%2C118%2C0)%200%25%2C%20rgba(229%2C103%2C118%2C0.9)%2050%25%2C%20%23e56776%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(229%2C103%2C118%2C0)%200%25%2C%20rgba(229%2C103%2C118%2C0.9)%2050%25%2C%20%23e56776%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(229%2C103%2C118%2C0)%200%25%2C%20rgba(229%2C103%2C118%2C0.9)%2050%25%2C%20%23e56776%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.collections-bg-green%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(54%2C163%2C124%2C0)%200%25%2C%20rgba(54%2C163%2C124%2C0.9)%2050%25%2C%20%2336a37c%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(54%2C163%2C124%2C0)%200%25%2C%20rgba(54%2C163%2C124%2C0.9)%2050%25%2C%20%2336a37c%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(54%2C163%2C124%2C0)%200%25%2C%20rgba(54%2C163%2C124%2C0.9)%2050%25%2C%20%2336a37c%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(54%2C163%2C124%2C0)%200%25%2C%20rgba(54%2C163%2C124%2C0.9)%2050%25%2C%20%2336a37c%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(54%2C163%2C124%2C0)%200%25%2C%20rgba(54%2C163%2C124%2C0.9)%2050%25%2C%20%2336a37c%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.collections-bg-orange%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(206%2C117%2C77%2C0)%200%25%2C%20rgba(206%2C117%2C77%2C0.9)%2050%25%2C%20%23ce754d%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(206%2C117%2C77%2C0)%200%25%2C%20rgba(206%2C117%2C77%2C0.9)%2050%25%2C%20%23ce754d%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(206%2C117%2C77%2C0)%200%25%2C%20rgba(206%2C117%2C77%2C0.9)%2050%25%2C%20%23ce754d%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(206%2C117%2C77%2C0)%200%25%2C%20rgba(206%2C117%2C77%2C0.9)%2050%25%2C%20%23ce754d%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(206%2C117%2C77%2C0)%200%25%2C%20rgba(206%2C117%2C77%2C0.9)%2050%25%2C%20%23ce754d%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.collections-bg-pink%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(198%2C81%2C166%2C0)%200%25%2C%20rgba(198%2C81%2C166%2C0.9)%2050%25%2C%20%23c651a6%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(198%2C81%2C166%2C0)%200%25%2C%20rgba(198%2C81%2C166%2C0.9)%2050%25%2C%20%23c651a6%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(198%2C81%2C166%2C0)%200%25%2C%20rgba(198%2C81%2C166%2C0.9)%2050%25%2C%20%23c651a6%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(198%2C81%2C166%2C0)%200%25%2C%20rgba(198%2C81%2C166%2C0.9)%2050%25%2C%20%23c651a6%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(198%2C81%2C166%2C0)%200%25%2C%20rgba(198%2C81%2C166%2C0.9)%2050%25%2C%20%23c651a6%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.collections-bg-teal%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(62%2C155%2C150%2C0)%200%25%2C%20rgba(62%2C155%2C150%2C0.9)%2050%25%2C%20%233e9b96%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(62%2C155%2C150%2C0)%200%25%2C%20rgba(62%2C155%2C150%2C0.9)%2050%25%2C%20%233e9b96%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(62%2C155%2C150%2C0)%200%25%2C%20rgba(62%2C155%2C150%2C0.9)%2050%25%2C%20%233e9b96%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(62%2C155%2C150%2C0)%200%25%2C%20rgba(62%2C155%2C150%2C0.9)%2050%25%2C%20%233e9b96%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(62%2C155%2C150%2C0)%200%25%2C%20rgba(62%2C155%2C150%2C0.9)%2050%25%2C%20%233e9b96%20100%25)%3B%0A%7D%0A"))
});
define("loadcss!teacher-spa/collections/book-collection-colors", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/teacher-spa/collections/book-collection-colors.css", decodeURIComponent(".book-collections-bg-yellow%20%7B%0A%20%20background-color%3A%20%23e6c652%3B%0A%7D%0A.book-collections-bg-yellow.book-collection-info-container%20%7B%0A%20%20border%3A%201px%20solid%20rgba(124%2C100%2C30%2C0.5)%3B%0A%7D%0A.book-collections-bg-yellow.unit-icon%20%7B%0A%20%20border%3A%203px%20solid%20%237c641e%3B%0A%20%20color%3A%20%237c641e%3B%0A%7D%0A.book-collections-bg-blue%20%7B%0A%20%20background-color%3A%20%2367a6e5%3B%0A%7D%0A.book-collections-bg-blue.book-collection-info-container%20%7B%0A%20%20border%3A%201px%20solid%20rgba(0%2C64%2C127%2C0.5)%3B%0A%7D%0A.book-collections-bg-blue.unit-icon%20%7B%0A%20%20border%3A%203px%20solid%20%2300407f%3B%0A%20%20color%3A%20%2300407f%3B%0A%7D%0A.book-collections-bg-purple%20%7B%0A%20%20background-color%3A%20%23ad80e0%3B%0A%7D%0A.book-collections-bg-purple.book-collection-info-container%20%7B%0A%20%20border%3A%201px%20solid%20rgba(60%2C0%2C128%2C0.5)%3B%0A%7D%0A.book-collections-bg-purple.unit-icon%20%7B%0A%20%20border%3A%203px%20solid%20%233c0080%3B%0A%20%20color%3A%20%233c0080%3B%0A%7D%0A.book-collections-bg-red%20%7B%0A%20%20background-color%3A%20%23e56776%3B%0A%7D%0A.book-collections-bg-red.book-collection-info-container%20%7B%0A%20%20border%3A%201px%20solid%20rgba(127%2C0%2C15%2C0.5)%3B%0A%7D%0A.book-collections-bg-red.unit-icon%20%7B%0A%20%20border%3A%203px%20solid%20%237f000f%3B%0A%20%20color%3A%20%237f000f%3B%0A%7D%0A.book-collections-bg-green%20%7B%0A%20%20background-color%3A%20%236cd8b2%3B%0A%7D%0A.book-collections-bg-green.book-collection-info-container%20%7B%0A%20%20border%3A%201px%20solid%20rgba(0%2C103%2C67%2C0.5)%3B%0A%7D%0A.book-collections-bg-green.unit-icon%20%7B%0A%20%20border%3A%203px%20solid%20%23006743%3B%0A%20%20color%3A%20%23006743%3B%0A%7D%0A.book-collections-bg-orange%20%7B%0A%20%20background-color%3A%20%23e6865b%3B%0A%7D%0A.book-collections-bg-orange.book-collection-info-container%20%7B%0A%20%20border%3A%201px%20solid%20rgba(118%2C46%2C16%2C0.5)%3B%0A%7D%0A.book-collections-bg-orange.unit-icon%20%7B%0A%20%20border%3A%203px%20solid%20%23762e10%3B%0A%20%20color%3A%20%23762e10%3B%0A%7D%0A.book-collections-bg-pink%20%7B%0A%20%20background-color%3A%20%23e673c6%3B%0A%7D%0A.book-collections-bg-pink.book-collection-info-container%20%7B%0A%20%20border%3A%201px%20solid%20rgba(128%2C0%2C92%2C0.5)%3B%0A%7D%0A.book-collections-bg-pink.unit-icon%20%7B%0A%20%20border%3A%203px%20solid%20%2380005c%3B%0A%20%20color%3A%20%2380005c%3B%0A%20%20background-color%3A%20%23e673c6%3B%0A%7D%0A.book-collections-bg-teal%20%7B%0A%20%20background-color%3A%20%236cd9d3%3B%0A%7D%0A.book-collections-bg-teal.book-collection-info-container%20%7B%0A%20%20border%3A%201px%20solid%20rgba(0%2C103%2C99%2C0.5)%3B%0A%7D%0A.book-collections-bg-teal.unit-icon%20%7B%0A%20%20border%3A%203px%20solid%20%23006763%3B%0A%20%20color%3A%20%23006763%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-yellow.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.book-collections-bg-yellow.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%23a68304%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-yellow.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.book-collections-bg-yellow.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%237c641e%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-blue.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.book-collections-bg-blue.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%232e78c2%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-blue.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.book-collections-bg-blue.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%2300407f%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-purple.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.book-collections-bg-purple.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%23752fc5%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-purple.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.book-collections-bg-purple.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%233c0080%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-red.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.book-collections-bg-red.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%23cb384a%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-red.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.book-collections-bg-red.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%237f000f%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-green.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.book-collections-bg-green.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%23018859%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-green.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.book-collections-bg-green.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%23006743%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-orange.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.book-collections-bg-orange.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%23c94e17%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-orange.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.book-collections-bg-orange.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%23762e10%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-pink.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.book-collections-bg-pink.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%23b2258b%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-pink.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.book-collections-bg-pink.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%2380005c%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-teal.collection-tag.dcg-hovered%2C%0A.collection-option-container%20.book-collections-bg-teal.in-collection.dcg-hovered%20%7B%0A%20%20background-color%3A%20%2300847d%3B%0A%7D%0A.activity-details-container%20.book-collections-bg-teal.collection-tag.dcg-depressed%2C%0A.collection-option-container%20.book-collections-bg-teal.in-collection.dcg-depressed%20%7B%0A%20%20background-color%3A%20%23006763%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-yellow%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%2367a6e5%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%23e6c652%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%23e6c652%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-yellow%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%23e6c652%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%23e6c652%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-yellow%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(230%2C198%2C82%2C0.2)%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-blue%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%2367a6e5%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%2367a6e5%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%2367a6e5%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-blue%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%2367a6e5%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%2367a6e5%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-blue%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(103%2C166%2C229%2C0.2)%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-purple%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%23ad80e0%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%23ad80e0%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%23ad80e0%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-purple%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%23ad80e0%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%23ad80e0%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-purple%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(173%2C128%2C224%2C0.2)%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-red%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%23e56776%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%23e56776%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%23e56776%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-red%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%23e56776%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%23e56776%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-red%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(229%2C103%2C118%2C0.2)%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-green%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%236cd8b2%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%236cd8b2%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%236cd8b2%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-green%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%236cd8b2%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%236cd8b2%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-green%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(108%2C216%2C178%2C0.2)%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-orange%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%23e6865b%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%23e6865b%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%23e6865b%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-orange%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%23e6865b%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%23e6865b%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-orange%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(230%2C134%2C91%2C0.2)%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-pink%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%23e673c6%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%23e673c6%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%23e673c6%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-pink%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%23e673c6%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%23e673c6%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-pink%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(230%2C115%2C198%2C0.2)%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-teal%3Anot(.in-collection)%20%7B%0A%20%20color%3A%20%236cd9d3%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%236cd9d3%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%236cd9d3%3B%0A%20%20background%3A%20%23fff%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-teal%3Anot(.in-collection).dcg-hovered%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%236cd9d3%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%236cd9d3%3B%0A%7D%0A.collection-option-container%20.book-collections-bg-teal%3Anot(.in-collection).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(108%2C217%2C211%2C0.2)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.book-collections-bg-yellow%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(230%2C198%2C82%2C0)%200%25%2C%20rgba(230%2C198%2C82%2C0.9)%2050%25%2C%20%23e6c652%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(230%2C198%2C82%2C0)%200%25%2C%20rgba(230%2C198%2C82%2C0.9)%2050%25%2C%20%23e6c652%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(230%2C198%2C82%2C0)%200%25%2C%20rgba(230%2C198%2C82%2C0.9)%2050%25%2C%20%23e6c652%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(230%2C198%2C82%2C0)%200%25%2C%20rgba(230%2C198%2C82%2C0.9)%2050%25%2C%20%23e6c652%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(230%2C198%2C82%2C0)%200%25%2C%20rgba(230%2C198%2C82%2C0.9)%2050%25%2C%20%23e6c652%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.book-collections-bg-blue%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(103%2C166%2C229%2C0)%200%25%2C%20rgba(103%2C166%2C229%2C0.9)%2050%25%2C%20%2367a6e5%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(103%2C166%2C229%2C0)%200%25%2C%20rgba(103%2C166%2C229%2C0.9)%2050%25%2C%20%2367a6e5%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(103%2C166%2C229%2C0)%200%25%2C%20rgba(103%2C166%2C229%2C0.9)%2050%25%2C%20%2367a6e5%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(103%2C166%2C229%2C0)%200%25%2C%20rgba(103%2C166%2C229%2C0.9)%2050%25%2C%20%2367a6e5%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(103%2C166%2C229%2C0)%200%25%2C%20rgba(103%2C166%2C229%2C0.9)%2050%25%2C%20%2367a6e5%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.book-collections-bg-purple%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(173%2C128%2C224%2C0)%200%25%2C%20rgba(173%2C128%2C224%2C0.9)%2050%25%2C%20%23ad80e0%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(173%2C128%2C224%2C0)%200%25%2C%20rgba(173%2C128%2C224%2C0.9)%2050%25%2C%20%23ad80e0%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(173%2C128%2C224%2C0)%200%25%2C%20rgba(173%2C128%2C224%2C0.9)%2050%25%2C%20%23ad80e0%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(173%2C128%2C224%2C0)%200%25%2C%20rgba(173%2C128%2C224%2C0.9)%2050%25%2C%20%23ad80e0%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(173%2C128%2C224%2C0)%200%25%2C%20rgba(173%2C128%2C224%2C0.9)%2050%25%2C%20%23ad80e0%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.book-collections-bg-red%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(229%2C103%2C118%2C0)%200%25%2C%20rgba(229%2C103%2C118%2C0.9)%2050%25%2C%20%23e56776%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(229%2C103%2C118%2C0)%200%25%2C%20rgba(229%2C103%2C118%2C0.9)%2050%25%2C%20%23e56776%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(229%2C103%2C118%2C0)%200%25%2C%20rgba(229%2C103%2C118%2C0.9)%2050%25%2C%20%23e56776%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(229%2C103%2C118%2C0)%200%25%2C%20rgba(229%2C103%2C118%2C0.9)%2050%25%2C%20%23e56776%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(229%2C103%2C118%2C0)%200%25%2C%20rgba(229%2C103%2C118%2C0.9)%2050%25%2C%20%23e56776%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.book-collections-bg-green%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(108%2C216%2C178%2C0)%200%25%2C%20rgba(108%2C216%2C178%2C0.9)%2050%25%2C%20%236cd8b2%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(108%2C216%2C178%2C0)%200%25%2C%20rgba(108%2C216%2C178%2C0.9)%2050%25%2C%20%236cd8b2%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(108%2C216%2C178%2C0)%200%25%2C%20rgba(108%2C216%2C178%2C0.9)%2050%25%2C%20%236cd8b2%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(108%2C216%2C178%2C0)%200%25%2C%20rgba(108%2C216%2C178%2C0.9)%2050%25%2C%20%236cd8b2%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(108%2C216%2C178%2C0)%200%25%2C%20rgba(108%2C216%2C178%2C0.9)%2050%25%2C%20%236cd8b2%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.book-collections-bg-orange%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(230%2C134%2C91%2C0)%200%25%2C%20rgba(230%2C134%2C91%2C0.9)%2050%25%2C%20%23e6865b%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(230%2C134%2C91%2C0)%200%25%2C%20rgba(230%2C134%2C91%2C0.9)%2050%25%2C%20%23e6865b%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(230%2C134%2C91%2C0)%200%25%2C%20rgba(230%2C134%2C91%2C0.9)%2050%25%2C%20%23e6865b%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(230%2C134%2C91%2C0)%200%25%2C%20rgba(230%2C134%2C91%2C0.9)%2050%25%2C%20%23e6865b%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(230%2C134%2C91%2C0)%200%25%2C%20rgba(230%2C134%2C91%2C0.9)%2050%25%2C%20%23e6865b%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.book-collections-bg-pink%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(230%2C115%2C198%2C0)%200%25%2C%20rgba(230%2C115%2C198%2C0.9)%2050%25%2C%20%23e673c6%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(230%2C115%2C198%2C0)%200%25%2C%20rgba(230%2C115%2C198%2C0.9)%2050%25%2C%20%23e673c6%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(230%2C115%2C198%2C0)%200%25%2C%20rgba(230%2C115%2C198%2C0.9)%2050%25%2C%20%23e673c6%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(230%2C115%2C198%2C0)%200%25%2C%20rgba(230%2C115%2C198%2C0.9)%2050%25%2C%20%23e673c6%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(230%2C115%2C198%2C0)%200%25%2C%20rgba(230%2C115%2C198%2C0.9)%2050%25%2C%20%23e673c6%20100%25)%3B%0A%7D%0A.collection-view-page%20.collection-description-container%20.fade-out.book-collections-bg-teal%20%7B%0A%20%20background%3A%20-webkit-linear-gradient(rgba(108%2C217%2C211%2C0)%200%25%2C%20rgba(108%2C217%2C211%2C0.9)%2050%25%2C%20%236cd9d3%20100%25)%3B%0A%20%20background%3A%20-moz-linear-gradient(rgba(108%2C217%2C211%2C0)%200%25%2C%20rgba(108%2C217%2C211%2C0.9)%2050%25%2C%20%236cd9d3%20100%25)%3B%0A%20%20background%3A%20-o-linear-gradient(rgba(108%2C217%2C211%2C0)%200%25%2C%20rgba(108%2C217%2C211%2C0.9)%2050%25%2C%20%236cd9d3%20100%25)%3B%0A%20%20background%3A%20-ms-linear-gradient(rgba(108%2C217%2C211%2C0)%200%25%2C%20rgba(108%2C217%2C211%2C0.9)%2050%25%2C%20%236cd9d3%20100%25)%3B%0A%20%20background%3A%20linear-gradient(rgba(108%2C217%2C211%2C0)%200%25%2C%20rgba(108%2C217%2C211%2C0.9)%2050%25%2C%20%236cd9d3%20100%25)%3B%0A%7D%0A"))
});
define("teacher-spa/collections/helpers", ["require", "exports", "tslib", "shared-types", "underscore", "i18n", "core/lib/assert-unreachable", "core/prosemirror/prosemirror-serialize", "loadcss!./collection-colors", "loadcss!./book-collection-colors"], function(require, exports, tslib_1, shared_types_1, _, i18n, assert_unreachable_1, prosemirror_serialize_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.COLLECTION_COLORS = ["blue", "purple", "coral", "orange", "green", "pink", "teal"];
    function getTranslatedColorName(color) {
        switch (color) {
            case "blue":
                return i18n.s("teacher-label-collection-aria-color-blue");
            case "purple":
                return i18n.s("teacher-label-collection-aria-color-purple");
            case "coral":
                return i18n.s("teacher-label-collection-aria-color-coral");
            case "orange":
                return i18n.s("teacher-label-collection-aria-color-orange");
            case "green":
                return i18n.s("teacher-label-collection-aria-color-green");
            case "pink":
                return i18n.s("teacher-label-collection-aria-color-pink");
            case "teal":
                return i18n.s("teacher-label-collection-aria-color-teal");
            default:
                return i18n.s("teacher-label-collection-aria-color-unknown")
        }
    }
    exports.getTranslatedColorName = getTranslatedColorName;
    function getClassForCollectionColor(color) {
        switch (color) {
            case "blue":
                return "collections-bg-blue";
            case "purple":
                return "collections-bg-purple";
            case "coral":
                return "collections-bg-coral";
            case "green":
                return "collections-bg-green";
            case "orange":
                return "collections-bg-orange";
            case "pink":
                return "collections-bg-pink";
            case "teal":
                return "collections-bg-teal";
            default:
                assert_unreachable_1.assertUnreachable(color);
                return ""
        }
    }
    exports.getClassForCollectionColor = getClassForCollectionColor;
    function getColorClassForCollection(collection) {
        var _a;
        if (collection.sharing === "book") {
            var unitNumber = ((_a = collection.bookData) === null || _a === void 0 ? void 0 : _a.unitNumber) || "";
            return getClassForBookCollectionColor(unitNumber)
        }
        return getClassForCollectionColor(collection.color)
    }
    exports.getColorClassForCollection = getColorClassForCollection;
    function getClassForBookCollectionColor(unitNumberStr) {
        var colorMap = {
            yellow: "book-collections-bg-yellow",
            blue: "book-collections-bg-blue",
            purple: "book-collections-bg-purple",
            red: "book-collections-bg-red",
            green: "book-collections-bg-green",
            orange: "book-collections-bg-orange",
            pink: "book-collections-bg-pink",
            teal: "book-collections-bg-teal"
        };
        var availableColors = Object.keys(colorMap);
        var unitNumber = parseInt(unitNumberStr);
        if (_.isNaN(unitNumber)) {
            return colorMap.blue
        }
        return colorMap[availableColors[(unitNumber - 1) % availableColors.length]]
    }
    function getVisibleCollectionItems(items, activities, subcollections, user) {
        return items.filter(function(item) {
            if (shared_types_1.isCollectionSectionDivider(item))
                return true;
            if (shared_types_1.isSubcollection(item)) {
                return !!subcollections[item.collectionId]
            }
            var activity = activities[item];
            if (!activity) {
                return false
            }
            return isVisibleForUser(activity, user)
        })
    }
    exports.getVisibleCollectionItems = getVisibleCollectionItems;
    function isVisibleForUser(activity, user) {
        if (user && user.isAdmin)
            return true;
        if (activity.source === "custom" && activity.private) {
            if (!user || !user.id)
                return false;
            if (!(activity.user.id === user.id || activity.collaborators.indexOf(user.id) >= 0 || activity.teamDesmosAuthored && user.isTeamDesmos())) {
                return false
            }
        }
        if (!hasRequiredLicenses(user, activity))
            return false;
        return true
    }
    exports.isVisibleForUser = isVisibleForUser;
    function getVisibleActivityIds(items, activities, user) {
        return getVisibleCollectionItems(items, activities, {}, user).filter(function(item) {
            return typeof item === "string"
        })
    }
    exports.getVisibleActivityIds = getVisibleActivityIds;
    function shouldShowPrivateActivityWarning(user, collectionWithActivityData) {
        if (collectionWithActivityData.collection.sharing === "private")
            return false;
        var visibleForAnonymousUser = getVisibleActivityIds(collectionWithActivityData.collection.activityIds, collectionWithActivityData.activities, undefined);
        var visibleForOwner = getVisibleActivityIds(collectionWithActivityData.collection.activityIds, collectionWithActivityData.activities, user);
        if (collectionWithActivityData.collection.sharing === "book") {
            var hasPrivateActivity = visibleForOwner.some(function(activityId) {
                var activity = collectionWithActivityData.activities[activityId];
                return activity.source === "custom" && activity.private
            });
            return hasPrivateActivity
        }
        return visibleForAnonymousUser.length !== visibleForOwner.length
    }
    exports.shouldShowPrivateActivityWarning = shouldShowPrivateActivityWarning;
    function hasRequiredLicenses(user, activity) {
        if (user && user.isTeamDesmos())
            return true;
        if (activity.licenseAccess === "preview")
            return true;
        var _loop_1 = function(requiredLicense) {
            if (!user)
                return {
                    value: false
                };
            if (!user.licenses.some(function(license) {
                return _.isEqual(requiredLicense, license)
            })) {
                return {
                    value: false
                }
            }
        };
        for (var _i = 0, _a = activity.licenses; _i < _a.length; _i++) {
            var requiredLicense = _a[_i];
            var state_1 = _loop_1(requiredLicense);
            if (typeof state_1 === "object")
                return state_1.value
        }
        return true
    }
    function hasDescription(collection) {
        return collection.description && prosemirror_serialize_1.hasNonWhitespaceContentJSON(collection.description.content)
    }
    exports.hasDescription = hasDescription;
    exports.shareSettingsMap = {
        private: {
            icon: "pillow-icon-lock",
            title: function() {
                return i18n.s("teacher-label-collection-private")
            },
            subtitle: function() {
                return i18n.s("teacher-description-collection-share-setting-private")
            }
        },
        "shared-link": {
            icon: "pillow-icon-link",
            title: function() {
                return i18n.s("teacher-label-collection-share-setting-link")
            },
            subtitle: function() {
                return i18n.s("teacher-description-collection-share-setting-link")
            }
        },
        featured: {
            icon: "pillow-icon-people",
            title: function() {
                return i18n.s("teacher-label-collection-share-setting-featured")
            },
            subtitle: function() {
                return i18n.s("teacher-description-collection-share-setting-featured")
            }
        },
        "featured-sidebar": {
            icon: "pillow-icon-hamburger",
            title: function() {
                return i18n.raw("Featured + Sidebar")
            },
            subtitle: function() {
                return i18n.s("teacher-description-collection-share-setting-sidebar")
            }
        },
        book: {
            icon: "pillow-icon-book",
            title: function() {
                return i18n.raw("Book")
            },
            subtitle: function() {
                return i18n.raw("Use for unit-level collections")
            }
        },
        "book-sidebar": {
            icon: "pillow-icon-book",
            title: function() {
                return i18n.raw("Book + Sidebar")
            },
            subtitle: function() {
                return i18n.raw("Use for toplevel collection, shown in the Sidebar (ie Math 7)")
            }
        }
    };
    exports.ACTIVITY_URL_REGEX_WITH_PARAM = /^https?:\/\/teacher-?\w*\.desmos.com:?\w*\/(((activitybuilder|polygraph)\/custom\/[0-9a-fA-F]{24})|(carnival|centralpark|waterline|carnival|tilepile|pennycircle|desman|marbleslides-\w*|polygraph-(\w|-)*))(\?.*)?$/i;
    exports.COLLECTION_URL_REGEX_WITH_PARAM = /^https?:\/\/teacher-?\w*\.desmos.com:?\w*\/collection\/[0-9a-fA-F]{24}(\?.*)?$/i;
    var COLLECTION_URL_REGEX = /^https?:\/\/teacher-?\w*\.desmos.com:?\w*\/collection\/[0-9a-fA-F]{24}$/i;
    function getCollectionIdFromUrl(url) {
        if (url.indexOf("?") > -1) {
            url = url.slice(0, url.lastIndexOf("?"))
        }
        if (!COLLECTION_URL_REGEX.test(url)) {
            throw new Error("Expected url " + url + " to be a valid collection url")
        }
        return url.split("/")[4]
    }
    exports.getCollectionIdFromUrl = getCollectionIdFromUrl;
    function validateParentToChildCollectionList(collectionStore, parentIds, child) {
        var parentCollectionRequests = {};
        for (var _i = 0, parentIds_1 = parentIds; _i < parentIds_1.length; _i++) {
            var parentId = parentIds_1[_i];
            parentCollectionRequests[parentId] = collectionStore.requestCollection(parentId, {
                immediate: false
            })
        }
        if (parentIds.some(function(id) {
            return parentCollectionRequests[id].status === "loading"
        })) {
            return {
                status: "loading"
            }
        }
        var validatedParentIds = [];
        parentIds.forEach(function(collectionId, idx) {
            var parentReq = parentCollectionRequests[collectionId];
            if (parentReq.status === "error") {
                validatedParentIds = []
            } else if (parentReq.status === "loaded") {
                var parentCollection = parentReq.response;
                var nextChild_1 = idx < parentIds.length - 1 ? {
                    type: "subcollection",
                    collectionId: parentIds[idx + 1]
                } : child;
                var invalidOrdering = shared_types_1.isSubcollection(nextChild_1) ? !parentCollection.activityIds.some(function(child) {
                    return shared_types_1.isSubcollection(child) && child.collectionId === nextChild_1.collectionId
                }) : parentCollection.activityIds.indexOf(nextChild_1) === -1;
                if (invalidOrdering) {
                    validatedParentIds = []
                } else {
                    validatedParentIds.push(collectionId)
                }
            }
        });
        return {
            status: "loaded",
            response: validatedParentIds
        }
    }
    exports.validateParentToChildCollectionList = validateParentToChildCollectionList;
    function requestSidebarData(collectionStore, activityStore, validatedParentIds, child, user) {
        var _a, _b;
        var childItems = {};
        var childRequests = {};
        var toplevelCollectionsRequest = undefined;
        var collectionIds = shared_types_1.isSubcollection(child) ? tslib_1.__spreadArrays(validatedParentIds, [child.collectionId]) : validatedParentIds;
        var toplevelCollections = [];
        for (var _i = 0, collectionIds_1 = collectionIds; _i < collectionIds_1.length; _i++) {
            var collectionId = collectionIds_1[_i];
            var collectionRequest = collectionStore.requestCollectionWithActivityData(collectionId);
            if (collectionRequest.status === "loading") {
                return {
                    status: "loading"
                }
            }
            if (collectionRequest.status === "error") {
                continue
            }
            var _c = collectionRequest.response
                , collection = _c.collection
                , activities = _c.activities
                , subcollections = _c.subcollections;
            childItems[collectionId] = getVisibleCollectionItems(collection.activityIds, activities, subcollections, user);
            for (var _d = 0, _e = childItems[collectionId]; _d < _e.length; _d++) {
                var item = _e[_d];
                if (shared_types_1.isCollectionSectionDivider(item))
                    continue;
                if (shared_types_1.isSubcollection(item)) {
                    childRequests[item.collectionId] = collectionStore.requestCollection(item.collectionId, {
                        immediate: false
                    })
                } else {
                    childRequests[item] = activityStore.requestByNormalizedId(item)
                }
            }
            if (collectionId === collectionIds[0] && collection.sharing === "book" && collection.isShownInSidebar) {
                toplevelCollectionsRequest = collectionStore.requestBookCollectionIds()
            }
        }
        if (Object.keys(childRequests).some(function(requestId) {
            return childRequests[requestId].status === "loading"
        }) || ((_a = toplevelCollectionsRequest) === null || _a === void 0 ? void 0 : _a.status) === "loading") {
            return {
                status: "loading"
            }
        }
        if (((_b = toplevelCollectionsRequest) === null || _b === void 0 ? void 0 : _b.status) === "loaded") {
            toplevelCollections = toplevelCollectionsRequest.response.filter(function(collectionId) {
                var req = collectionStore.requestCollection(collectionId, {
                    immediate: false
                });
                if (req.status === "loaded") {
                    return req.response.isShownInSidebar
                }
                return false
            })
        }
        for (var parentId in childItems) {
            childItems[parentId] = childItems[parentId].filter(function(item) {
                if (shared_types_1.isCollectionSectionDivider(item))
                    return true;
                var id = typeof item === "string" ? item : item.collectionId;
                return childRequests[id].status === "loaded"
            })
        }
        return {
            status: "loaded",
            response: {
                parentIds: validatedParentIds,
                childItems: childItems,
                toplevelCollections: toplevelCollections
            }
        }
    }
    exports.requestSidebarData = requestSidebarData;
    function hasBookParentCollection(collectionStore, collectionIds) {
        if (!collectionIds.length) {
            return false
        }
        var id = collectionIds.length - 1;
        var collection = collectionStore.requestCollection(collectionIds[id]);
        if (collection.status !== "loaded") {
            throw new Error("Expected collection " + id + " to be loaded")
        }
        return collection.response.sharing === "book"
    }
    exports.hasBookParentCollection = hasBookParentCollection
});
define("teacher-spa/collections/new-collection-controller", ["require", "exports", "tslib", "activitybuilder/ts-controller", "core/lib/rich-text-helpers", "./helpers"], function(require, exports, tslib_1, ts_controller_1, rich_text_helpers_1, helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var NewCollectionController = function(_super) {
        tslib_1.__extends(NewCollectionController, _super);
        function NewCollectionController(resources) {
            var _this = _super.call(this, resources) || this;
            _this.resources = resources;
            _this.initLocalState();
            _this.dispatchToken = _this.resources.dispatcher.register(function(action) {
                if (action.type === "set-collection-description") {
                    _this.description = rich_text_helpers_1.richTextFromNode("document", action.doc)
                } else if (action.type === "set-collection-title") {
                    _this.title = action.title
                } else if (action.type === "set-collection-color") {
                    _this.color = action.color
                } else if (action.type === "set-collection-sharing") {
                    _this.sharing = action.sharing
                } else if (action.type === "save-collection") {
                    _this.isSaveInFlight = true;
                    _this.resources.getCollectionStore().createCollection({
                        title: _this.title,
                        color: _this.color,
                        description: _this.description,
                        sharing: _this.sharing
                    }).fail(function() {}).done(function() {
                        _this.initLocalState()
                    }).always(function() {
                        _this.isSaveInFlight = false
                    })
                }
            });
            return _this
        }
        NewCollectionController.prototype.initLocalState = function() {
            this.title = "";
            this.color = helpers_1.COLLECTION_COLORS[(new Date).getTime() % helpers_1.COLLECTION_COLORS.length];
            this.description = rich_text_helpers_1.richTextFromText("document", "");
            this.sharing = "shared-link"
        }
        ;
        NewCollectionController.prototype.isSaveDisabled = function() {
            return this.isSaveInFlight || this.title.length === 0
        }
        ;
        NewCollectionController.prototype.getTitle = function() {
            return this.title
        }
        ;
        NewCollectionController.prototype.getColor = function() {
            return this.color
        }
        ;
        NewCollectionController.prototype.getSharing = function() {
            return this.sharing
        }
        ;
        NewCollectionController.prototype.getDescription = function() {
            return this.description
        }
        ;
        NewCollectionController.prototype.exit = function() {
            this.resources.dispatcher.unregister(this.dispatchToken);
            _super.prototype.exit.call(this)
        }
        ;
        return NewCollectionController
    }(ts_controller_1.Controller);
    exports.NewCollectionController = NewCollectionController
});
define("loadcss!teacher-spa/collections/collection-bullet", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/teacher-spa/collections/collection-bullet.css", decodeURIComponent(".collection-bullet%20%7B%0A%20%20height%3A%2030px%3B%0A%20%20width%3A%2030px%3B%0A%20%20border-radius%3A%2050%25%3B%0A%20%20display%3A%20inline-block%3B%0A%20%20margin-right%3A%205px%3B%0A%7D%0A"))
});
define("loadcss!teacher-spa/group-activity-card", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/teacher-spa/group-activity-card.css", decodeURIComponent(".group-activity-card%20%7B%0A%20%20margin-bottom%3A%2015px%3B%0A%20%20width%3A%20100%25%3B%0A%20%20vertical-align%3A%20top%3B%0A%20%20display%3A%20inline-block%3B%0A%20%20position%3A%20relative%3B%0A%20%20border-radius%3A%207px%3B%0A%20%20background%3A%20%23f2f2f2%3B%0A%20%20border%3A%201px%20solid%20%23e2e2e2%3B%0A%7D%0A.group-activity-card.dcg-hovered%20%7B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%7D%0A.group-activity-card.dcg-depressed%20%7B%0A%20%20background%3A%20%23ebebeb%3B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%7D%0A.group-activity-card%3Anot(.collection-card)%20.description-content%20%7B%0A%20%20padding%3A%200%2015px%3B%0A%20%20width%3A%20calc(100%25%20-%20140px)%3B%0A%7D%0A.group-activity-card%20.card-contents%20%7B%0A%20%20margin%3A%2015px%3B%0A%7D%0A.group-activity-card%20.card-contents%20.description-content%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20vertical-align%3A%20top%3B%0A%7D%0A.group-activity-card%20.card-contents%20.description-content%20.group-activity-card-title%20%7B%0A%20%20color%3A%20%23666%3B%0A%20%20font-family%3A%20%22Sanchez%22%2C%20%22Helvetica%20Neue%20Light%22%2C%20%22HelveticaNeue-Light%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%20%20max-width%3A%20100%25%3B%0A%20%20white-space%3A%20nowrap%3B%0A%20%20overflow%3A%20hidden%3B%0A%20%20-o-text-overflow%3A%20ellipsis%3B%0A%20%20text-overflow%3A%20ellipsis%3B%0A%7D%0A.group-activity-card%20.card-contents%20.description-content%20.group-activity-card-title%3Anot(.collection-title)%20%7B%0A%20%20font-size%3A%20120%25%3B%0A%7D%0A.group-activity-card%20.card-contents%20.description-content%20.group-activity-card-activity-num%2C%0A.group-activity-card%20.card-contents%20.description-content%20.group-activity-card-description%20%7B%0A%20%20margin-top%3A%205px%3B%0A%20%20color%3A%20%23666%3B%0A%20%20font-size%3A%2090%25%3B%0A%7D%0A.group-activity-card%20.card-contents%20.description-content%20.group-activity-card-activity-num%20%7B%0A%20%20margin-right%3A%205px%3B%0A%20%20display%3A%20inline-block%3B%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20500px)%20%7B%0A%20%20.group-activity-card%20.group-activity-card-description%20%7B%0A%20%20%20%20display%3A%20none%3B%0A%20%20%7D%0A%7D%0A"))
});
define("teacher-spa/collections/collection-bullet", ["require", "exports", "tslib", "dcgview", "./helpers", "loadcss!./collection-bullet", "loadcss!./../group-activity-card"], function(require, exports, tslib_1, DCGView, helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var CollectionBullet = function(_super) {
        tslib_1.__extends(CollectionBullet, _super);
        function CollectionBullet() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        CollectionBullet.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                "aria-label": function() {
                    return helpers_1.getTranslatedColorName(_this.props.color())
                },
                class: function() {
                    var _a;
                    return _a = {
                        "collection-bullet": true
                    },
                        _a[helpers_1.getClassForCollectionColor(_this.props.color())] = true,
                        _a
                },
                style: function() {
                    return _this.props.size ? {
                        width: _this.props.size(),
                        height: _this.props.size()
                    } : {}
                }
            })
        }
        ;
        return CollectionBullet
    }(DCGView.Class);
    exports.CollectionBullet = CollectionBullet
});
define("loadcss!shared/dcgviews/share-settings-chooser", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/dcgviews/share-settings-chooser.css", decodeURIComponent(".share-settings-chooser%20.share-settings-title%20%7B%0A%20%20color%3A%20%23666%3B%0A%20%20font-size%3A%20130%25%3B%0A%20%20margin-bottom%3A%205px%3B%0A%7D%0A.share-settings-chooser%20.dcg-segmented-control-btn%20%7B%0A%20%20-webkit-box-orient%3A%20vertical%3B%0A%20%20-moz-box-orient%3A%20vertical%3B%0A%20%20-o-box-orient%3A%20vertical%3B%0A%20%20-webkit-flex-direction%3A%20column%3B%0A%20%20-ms-flex-direction%3A%20column%3B%0A%20%20flex-direction%3A%20column%3B%0A%7D%0A.share-settings-chooser%20.dcg-segmented-control-btn%20.title%20%7B%0A%20%20font-size%3A%20110%25%3B%0A%7D%0A.share-settings-chooser%20.dcg-segmented-control-btn%20.title%20.pillow-icon-lock%20%7B%0A%20%20font-size%3A%2080%25%3B%0A%7D%0A.share-settings-chooser%20.dcg-segmented-control-btn%20.title%20.pillow-icon-link%20%7B%0A%20%20font-size%3A%2090%25%3B%0A%20%20position%3A%20relative%3B%0A%20%20top%3A%20-2px%3B%0A%7D%0A.share-settings-chooser%20.dcg-segmented-control-btn%20.subtitle%20%7B%0A%20%20font-size%3A%2090%25%3B%0A%7D%0A"))
});
define("shared/dcgviews/share-settings-chooser", ["require", "exports", "tslib", "dcgview", "lib/i18n", "lib/class-names", "loadcss!./share-settings-chooser"], function(require, exports, tslib_1, DCGView, i18n, class_names_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var ShareSettingsChooser = function(_super) {
        tslib_1.__extends(ShareSettingsChooser, _super);
        function ShareSettingsChooser() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ShareSettingsChooser.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                class: function() {
                    return class_names_1.classNames("share-settings-chooser", _this.props.class)
                }
            }, DCGView.createElement("div", {
                class: DCGView.const("share-settings-title")
            }, function() {
                return i18n.s("global-heading-share-settings")
            }), DCGView.createElement("div", {
                class: DCGView.const("dcg-segmented-control-layout")
            }, DCGView.createElement("div", {
                role: DCGView.const("button"),
                tabindex: DCGView.const("0"),
                "aria-pressed": function() {
                    return _this.props.selectedOption() === "shared-link"
                },
                class: function() {
                    return {
                        "set-shared-button": true,
                        "dcg-segmented-control-btn": true,
                        "is-selected": _this.props.selectedOption() === "shared-link",
                        "dcg-padded-segmented-control-btn": true
                    }
                },
                onTap: function() {
                    return _this.props.onSelect("shared-link")
                }
            }, DCGView.createElement("div", {
                class: DCGView.const("title")
            }, DCGView.createElement("i", {
                class: DCGView.const("pillow-icon-link")
            }), function() {
                return i18n.s("global-label-share-setting-link")
            }), DCGView.createElement("div", {
                class: DCGView.const("subtitle")
            }, function() {
                return i18n.s("global-description-share-setting-link")
            })), DCGView.createElement("div", {
                role: DCGView.const("button"),
                tabindex: DCGView.const("0"),
                "aria-pressed": function() {
                    return _this.props.selectedOption() === "private"
                },
                class: function() {
                    return {
                        "set-private-button": true,
                        "dcg-segmented-control-btn": true,
                        "is-selected": _this.props.selectedOption() === "private",
                        "dcg-padded-segmented-control-btn": true
                    }
                },
                onTap: function() {
                    return _this.props.onSelect("private")
                }
            }, DCGView.createElement("div", {
                class: DCGView.const("title")
            }, DCGView.createElement("i", {
                class: DCGView.const("pillow-icon-lock")
            }), function() {
                return i18n.s("global-label-share-setting-private")
            }), DCGView.createElement("div", {
                class: DCGView.const("subtitle")
            }, function() {
                return i18n.s("global-description-share-setting-private")
            }))))
        }
        ;
        return ShareSettingsChooser
    }(DCGView.Class);
    exports.ShareSettingsChooser = ShareSettingsChooser
});
define("loadcss!teacher-spa/collections/list", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/teacher-spa/collections/list.css", decodeURIComponent(".collections-empty-state%20%7B%0A%20%20text-align%3A%20center%3B%0A%20%20color%3A%20%23666%3B%0A%20%20font-size%3A%20120%25%3B%0A%20%20margin%3A%201em%200%3B%0A%7D%0A.collections-empty-state%20img%20%7B%0A%20%20display%3A%20block%3B%0A%20%20width%3A%20200px%3B%0A%20%20margin%3A%200%20auto%2020px%3B%0A%7D%0A.collections-list-page%20.collection-card-container%20%7B%0A%20%20position%3A%20relative%3B%0A%7D%0A.collections-list-page%20.collection-card-container%20.collection-actions-menu%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%2015px%3B%0A%20%20right%3A%200%3B%0A%20%20padding-right%3A%2010px%3B%0A%7D%0A"))
});
define("loadcss!teacher-spa/collections/collection-modals", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/teacher-spa/collections/collection-modals.css", decodeURIComponent(".collection-modal%20.collection-header%20%7B%0A%20%20font-size%3A%20160%25%3B%0A%20%20color%3A%20%23666%3B%0A%7D%0A.collection-modal%20.collection-title%20%7B%0A%20%20padding%3A%205px%205px%2010px%3B%0A%7D%0A.collection-modal%20.collection-title%20input%20%7B%0A%20%20display%3A%20block%3B%0A%20%20width%3A%20100%25%3B%0A%20%20margin-bottom%3A%2010px%3B%0A%7D%0A.collection-modal%20.collection-title%20input%3A%3Aplaceholder%20%7B%0A%20%20color%3A%20%23999%3B%0A%7D%0A.collection-modal%20.collection-title%20.create-alignment-submit%20%7B%0A%20%20float%3A%20right%3B%0A%20%20margin-bottom%3A%2010px%3B%0A%7D%0A.collection-modal%20.delete-message%20%7B%0A%20%20margin-left%3A%205px%3B%0A%20%20line-height%3A%202em%3B%0A%7D%0A.collection-modal%20.delete-actions%20%7B%0A%20%20text-align%3A%20right%3B%0A%20%20margin-top%3A%2010px%3B%0A%7D%0A.collection-modal%20.delete-actions%20.cancel-link%20%7B%0A%20%20color%3A%20%23666%3B%0A%20%20text-decoration%3A%20underline%3B%0A%20%20margin-right%3A%2010px%3B%0A%20%20padding%3A%205px%3B%0A%7D%0A.collection-modal%20.delete-actions%20.cancel-link.dcg-hovered%20%7B%0A%20%20color%3A%20%23333%3B%0A%7D%0A.collection-modal%20.delete-actions%20.cancel-link.dcg-depressed%20%7B%0A%20%20color%3A%20%23000%3B%0A%7D%0A"))
});
define("loadcss!teacher-spa/collections/new-collection-modal", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/teacher-spa/collections/new-collection-modal.css", decodeURIComponent(".collection-modal%20%7B%0A%20%20padding%3A%2020px%3B%0A%7D%0A.collection-modal%20h1%20%7B%0A%20%20text-align%3A%20left%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20padding-top%3A%2010px%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20input%20%7B%0A%20%20font-family%3A%20%22Sanchez%22%2C%20%22Helvetica%20Neue%20Light%22%2C%20%22HelveticaNeue-Light%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%20%20-webkit-box-flex%3A%201%3B%0A%20%20-moz-box-flex%3A%201%3B%0A%20%20-o-box-flex%3A%201%3B%0A%20%20box-flex%3A%201%3B%0A%20%20-webkit-flex%3A%201%3B%0A%20%20-ms-flex%3A%201%3B%0A%20%20flex%3A%201%3B%0A%20%20font-size%3A%2030px%3B%0A%20%20border-color%3A%20%23fff%3B%0A%20%20border-bottom%3A%201px%20solid%20%23ccc%3B%0A%20%20border-radius%3A%200%3B%0A%20%20padding%3A%200%3B%0A%20%20position%3A%20relative%3B%0A%20%20top%3A%20-5px%3B%0A%20%20white-space%3A%20nowrap%3B%0A%20%20overflow%3A%20hidden%3B%0A%20%20-o-text-overflow%3A%20ellipsis%3B%0A%20%20text-overflow%3A%20ellipsis%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20input%3A%3A-webkit-input-placeholder%20%7B%0A%20%20color%3A%20%23666%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20input%3A-moz-placeholder%20%7B%0A%20%20color%3A%20%23666%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20input%3A%3A-moz-placeholder%20%7B%0A%20%20color%3A%20%23666%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20input%3A-ms-input-placeholder%20%7B%0A%20%20color%3A%20%23666%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20input%3A%3Aplaceholder%20%7B%0A%20%20color%3A%20%23999%3B%0A%20%20font-style%3A%20italic%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20input.dcg-hovered%20%7B%0A%20%20border-bottom%3A%201px%20solid%20%23999%3B%0A%20%20-webkit-box-shadow%3A%200%201px%200%20%23999%3B%0A%20%20box-shadow%3A%200%201px%200%20%23999%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20input%3Afocus%20%7B%0A%20%20border-bottom%3A%201px%20solid%20%234781b9%3B%0A%20%20-webkit-box-shadow%3A%200%201px%200%20%234781b9%3B%0A%20%20box-shadow%3A%200%201px%200%20%234781b9%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20.color-picker%20%7B%0A%20%20position%3A%20relative%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20.color-picker%20.color-bullet-container%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20margin-right%3A%2010px%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20.color-picker%20.color-bullet-container%20.pillow-icon-caret-down%20%7B%0A%20%20color%3A%20%23ccc%3B%0A%20%20font-size%3A%2080%25%3B%0A%20%20position%3A%20relative%3B%0A%20%20top%3A%20-6px%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20.color-picker%20.color-bullet-container%20.pillow-icon-caret-down%3A.dgc-hovered%20%7B%0A%20%20color%3A%20%23aaa%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20.color-picker.active%20.pillow-icon-caret-down%20%7B%0A%20%20color%3A%20%23777%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20.color-picker%20.color-selector%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%2035px%3B%0A%20%20left%3A%20-10px%3B%0A%20%20background%3A%20%23fff%3B%0A%20%20border%3A%201px%20solid%20%23e2e2e2%3B%0A%20%20-webkit-box-shadow%3A%200%205px%2010px%20rgba(0%2C0%2C0%2C0.15)%3B%0A%20%20box-shadow%3A%200%205px%2010px%20rgba(0%2C0%2C0%2C0.15)%3B%0A%20%20border-radius%3A%205px%3B%0A%20%20padding%3A%2010px%205px%205px%3B%0A%20%20-webkit-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-moz-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-o-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-ms-animation%3A%20fadeInDown%200.2s%3B%0A%20%20animation%3A%20fadeInDown%200.2s%3B%0A%20%20z-index%3A%201%3B%0A%20%20white-space%3A%20nowrap%3B%0A%20%20text-align%3A%20left%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20.color-picker%20.color-selector%3Aafter%20%7B%0A%20%20content%3A%20%22%22%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-8px%3B%0A%20%20left%3A%2016px%3B%0A%20%20border-width%3A%208px%3B%0A%20%20border-top-width%3A%200%3B%0A%20%20border-style%3A%20solid%3B%0A%20%20border-color%3A%20transparent%20transparent%20%23fff%3B%0A%20%20line-height%3A%200%3B%0A%20%20z-index%3A%20zindex%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20.color-picker%20.color-selector%3Abefore%20%7B%0A%20%20content%3A%20%22%22%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-9px%3B%0A%20%20left%3A%2015px%3B%0A%20%20border-width%3A%209px%3B%0A%20%20border-top-width%3A%200%3B%0A%20%20border-style%3A%20solid%3B%0A%20%20border-color%3A%20transparent%20transparent%20%23e2e2e2%3B%0A%20%20line-height%3A%200%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20.color-picker%20.color-selector%20.color-option%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20width%3A%2030px%3B%0A%20%20height%3A%2030px%3B%0A%20%20border-radius%3A%2050%25%3B%0A%20%20border%3A%202px%20solid%20%23fff%3B%0A%20%20cursor%3A%20pointer%3B%0A%20%20margin%3A%200px%203px%200%3B%0A%7D%0A.collection-modal%20.collection-edit-header%20.color-picker%20.color-selector%20.color-option.selected%20%7B%0A%20%20-webkit-box-shadow%3A%200%200%200%202px%20%23999%3B%0A%20%20box-shadow%3A%200%200%200%202px%20%23999%3B%0A%7D%0A.collection-modal%20.input-title%20%7B%0A%20%20color%3A%20%23666%3B%0A%20%20font-size%3A%20130%25%3B%0A%20%20margin-bottom%3A%205px%3B%0A%7D%0A.collection-modal%20.collection-sharing%20%7B%0A%20%20margin%3A%2020px%200%2040px%3B%0A%7D%0A.collection-modal%20.collection-sharing%20.private-activity-warning%20%7B%0A%20%20margin-top%3A%2010px%3B%0A%20%20color%3A%20%23666%3B%0A%7D%0A.collection-modal%20.collection-sharing%20.private-activity-warning%20i%20%7B%0A%20%20color%3A%20%23fa824c%3B%0A%20%20margin-right%3A%205px%3B%0A%20%20font-size%3A%2080%25%3B%0A%7D%0A.collection-modal%20.collection-description%20.ProseMirror%20%7B%0A%20%20padding%3A%2010px%3B%0A%20%20min-height%3A%206em%3B%0A%20%20max-height%3A%2012em%3B%0A%20%20overflow%3A%20auto%3B%0A%7D%0A.collection-modal%20.collection-description%20.dcg-prosemirror-editor%20%7B%0A%20%20border%3A%201px%20solid%20%23bbb%3B%0A%20%20border-radius%3A%205px%200%205px%205px%3B%0A%20%20z-index%3A%201%3B%0A%7D%0A.collection-modal%20.collection-description%20.dcg-prosemirror-editor.dcg-focused%20%7B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%7D%0A.collection-modal%20.save-button-container%20%7B%0A%20%20text-align%3A%20right%3B%0A%20%20margin-top%3A%2020px%3B%0A%7D%0A"))
});
define("teacher-spa/collections/new-collection-modal", ["require", "exports", "tslib", "lib/i18n", "dcgview", "jquery", "shared/dcgviews/modal", "./new-collection-controller", "activitybuilder/components/shared/prosemirror/rich-text-view", "./collection-bullet", "./helpers", "keys", "lib/evt-delegator", "shared/dcgviews/share-settings-chooser", "loadcss!./list", "loadcss!./../group-activity-card", "loadcss!./collection-modals", "loadcss!./new-collection-modal"], function(require, exports, tslib_1, i18n, DCGView, $, modal_1, new_collection_controller_1, rich_text_view_1, collection_bullet_1, helpers_1, Keys, evt_delegator_1, share_settings_chooser_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , If = _a.If
        , For = _a.For
        , Input = _a.Input;
    var NewCollectionModal = function(_super) {
        tslib_1.__extends(NewCollectionModal, _super);
        function NewCollectionModal() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        NewCollectionModal.prototype.init = function() {
            this.controller = new new_collection_controller_1.NewCollectionController(this.props.resources())
        }
        ;
        NewCollectionModal.prototype.didUnmount = function() {
            this.controller.exit()
        }
        ;
        NewCollectionModal.prototype.modalDidMount = function() {
            var _this = this;
            this.handleDocumentClick = function(e) {
                if (!_this.showColorPicker)
                    return;
                if (!e.originalEvent.target)
                    return;
                if ($(e.originalEvent.target).closest(".color-selector").length)
                    return;
                _this.showColorPicker = false;
                _this.update()
            }
        }
        ;
        NewCollectionModal.prototype.modalDidUnmount = function() {
            this.unsub()
        }
        ;
        NewCollectionModal.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(modal_1.Modal, {
                ariaLabel: function() {
                    return i18n.s("teacher-button-new-collection")
                },
                visible: function() {
                    return _this.props.visible()
                },
                className: this.const("new-collection-modal fixed-width"),
                showX: function() {
                    return true
                },
                onClose: this.props.onClose
            }, function() {
                return DCGView.createElement("div", {
                    class: DCGView.const("new-collection-modal-contents collection-modal"),
                    didMount: function() {
                        return _this.modalDidMount()
                    },
                    didUnmount: function() {
                        return _this.modalDidUnmount()
                    }
                }, DCGView.createElement("div", {
                    class: DCGView.const("collection-edit-view"),
                    didMount: function(el) {
                        _this.$root = $(el);
                        _this.unsub = evt_delegator_1.Delegator.push(_this.bindFn(_this.handleKeydown));
                        if (_this.controller.getTitle().length === 0) {
                            _this.$root.find(".collection-title").focus()
                        }
                    }
                }, DCGView.createElement("h1", {
                    class: DCGView.const("collection-header")
                }, function() {
                    return i18n.s("teacher-button-new-collection")
                }), DCGView.createElement("div", {
                    class: DCGView.const("collection-edit-header")
                }, DCGView.createElement("div", {
                    class: function() {
                        return {
                            "color-picker": true,
                            active: _this.showColorPicker
                        }
                    }
                }, DCGView.createElement("div", {
                    role: DCGView.const("button"),
                    tabindex: DCGView.const("0"),
                    "aria-expanded": function() {
                        return !!_this.showColorPicker
                    },
                    class: DCGView.const("color-bullet-container"),
                    onTap: function() {
                        _this.showColorPicker = true;
                        _this.update()
                    }
                }, DCGView.createElement(collection_bullet_1.CollectionBullet, {
                    color: function() {
                        return _this.controller.getColor()
                    },
                    size: _this.const("30px")
                }), DCGView.createElement("i", {
                    class: DCGView.const("pillow-icon-caret-down")
                })), DCGView.createElement(If, {
                    predicate: function() {
                        return _this.showColorPicker
                    }
                }, function() {
                    return DCGView.createElement(For, {
                        each: _this.const(helpers_1.COLLECTION_COLORS)
                    }, DCGView.createElement("div", {
                        role: DCGView.const("list"),
                        class: DCGView.const("color-selector"),
                        didMount: function() {
                            return $(document).on("dcg-tapstart", _this.handleDocumentClick)
                        },
                        willUnmount: function() {
                            return $(document).off("dcg-tapstart", _this.handleDocumentClick)
                        }
                    }, function(color) {
                        return DCGView.createElement("div", {
                            role: DCGView.const("listitem")
                        }, DCGView.createElement("span", {
                            role: DCGView.const("button"),
                            tabindex: DCGView.const("0"),
                            "aria-pressed": function() {
                                return _this.controller.getColor() === color
                            },
                            class: function() {
                                return {
                                    "color-option": true,
                                    selected: _this.controller.getColor() === color
                                }
                            },
                            onTap: function() {
                                return _this.controller.dispatch({
                                    type: "set-collection-color",
                                    color: color
                                })
                            }
                        }, DCGView.createElement(collection_bullet_1.CollectionBullet, {
                            color: _this.const(color),
                            size: _this.const("100%")
                        })))
                    }))
                })), DCGView.createElement(Input, {
                    class: _this.const("blue-outline collection-title"),
                    type: _this.const("text"),
                    "aria-label": function() {
                        return i18n.s("teacher-label-collection-title")
                    },
                    placeholder: function() {
                        return i18n.s("teacher-placeholder-untitled-collection")
                    },
                    value: function() {
                        return _this.controller.getTitle()
                    },
                    onInput: function(text) {
                        return _this.controller.dispatch({
                            type: "set-collection-title",
                            title: text
                        })
                    }
                })), DCGView.createElement(share_settings_chooser_1.ShareSettingsChooser, {
                    selectedOption: function() {
                        var shareSetting = _this.controller.getSharing();
                        return shareSetting === "featured" || shareSetting === "book" ? undefined : shareSetting
                    },
                    onSelect: function(shareSetting) {
                        return _this.controller.dispatch({
                            type: "set-collection-sharing",
                            sharing: shareSetting
                        })
                    },
                    class: _this.const("collection-sharing")
                }), DCGView.createElement("div", {
                    class: DCGView.const("input-title")
                }, function() {
                    return i18n.s("teacher-label-collection-description")
                }), DCGView.createElement("div", {
                    class: DCGView.const("collection-description")
                }, DCGView.createElement(rich_text_view_1.RichTextEditView, {
                    content: function() {
                        return _this.controller.getDescription()
                    },
                    resources: _this.props.resources,
                    editable: _this.const(true),
                    focusOnMount: _this.const(false),
                    onInput: function(state) {
                        _this.controller.dispatch({
                            type: "set-collection-description",
                            doc: state.doc
                        })
                    }
                })), DCGView.createElement("div", {
                    class: DCGView.const("save-button-container")
                }, DCGView.createElement("div", {
                    role: DCGView.const("button"),
                    tabindex: function() {
                        return _this.controller.isSaveDisabled() ? "-1" : "0"
                    },
                    "aria-disabled": function() {
                        return _this.controller.isSaveDisabled()
                    },
                    class: function() {
                        return {
                            "btn-blue": true,
                            disabled: _this.controller.isSaveDisabled()
                        }
                    },
                    onTap: _this.bindFn(_this.submit)
                }, function() {
                    return i18n.s("teacher-button-create-new-collection")
                }))))
            })
        }
        ;
        NewCollectionModal.prototype.handleKeydown = function(evt, stopHandling) {
            var _this = this;
            if ($(evt.target).closest(".collection-title").length > 0 && Keys.lookup(evt) === Keys.ENTER && !(evt.metaKey || evt.ctrlKey)) {
                setTimeout(function() {
                    _this.$root.find(".collection-description [contenteditable]").focus()
                }, 0);
                stopHandling()
            } else if (Keys.lookup(evt) === Keys.ENTER && (evt.metaKey || evt.ctrlKey)) {
                this.submit();
                stopHandling()
            } else if (Keys.lookup(evt) === Keys.ESCAPE) {
                this.props.onClose();
                stopHandling()
            }
        }
        ;
        NewCollectionModal.prototype.submit = function() {
            if (this.controller.isSaveDisabled())
                return;
            this.controller.dispatch({
                type: "save-collection"
            });
            this.props.onClose()
        }
        ;
        return NewCollectionModal
    }(DCGView.Class);
    exports.NewCollectionModal = NewCollectionModal
});
define("loadcss!teacher-spa/collections/add-to-collection", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/teacher-spa/collections/add-to-collection.css", decodeURIComponent(".activity-card-container%20%7B%0A%20%20position%3A%20relative%3B%0A%7D%0A.activity-card-container%20.activity-actions-dropdown-container%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-10px%3B%0A%20%20right%3A%205px%3B%0A%7D%0A.activity-card-container%20.activity-actions-dropdown-container%20.dropdown-choice%20%7B%0A%20%20padding%3A%200%207px%3B%0A%7D%0A.add-to-collection-dropdown-container%20%7B%0A%20%20position%3A%20relative%3B%0A%20%20display%3A%20inline-block%3B%0A%7D%0A.add-to-collection-dropdown-container%20.add-to-collection-button%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%7D%0A.add-to-collection-dropdown-container%20.activity-main-action%3Anot(.in-collection)%3Anot(.disabled).dcg-hovered%2C%0A.add-to-collection-dropdown-container%20.activity-main-action%3Anot(.in-collection)%3Anot(.disabled).dcg-depressed%20%7B%0A%20%20color%3A%20%234781b9%3B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%7D%0A.add-to-collection-dropdown-container%20.activity-main-action%3Anot(.in-collection)%3Anot(.disabled).dcg-depressed%20%7B%0A%20%20background%3A%20rgba(71%2C129%2C185%2C0.25)%3B%0A%7D%0A.add-to-collection-dropdown-container%20.activity-main-action.disabled%20%7B%0A%20%20opacity%3A%200.5%3B%0A%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D50)%22%3B%0A%20%20filter%3A%20alpha(opacity%3D50)%3B%0A%20%20cursor%3A%20default%3B%0A%7D%0A.add-to-collection-dropdown-container%20.activity-main-action.in-collection%20%7B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%20%20color%3A%20%234781b9%3B%0A%7D%0A.add-to-collection-dropdown-container%20.activity-main-action.in-collection.dcg-hovered%2C%0A.add-to-collection-dropdown-container%20.activity-main-action.in-collection.dcg-depressed%20%7B%0A%20%20color%3A%20%23004f9b%3B%0A%20%20border%3A%201px%20solid%20%23004f9b%3B%0A%7D%0A.add-to-collection-menu%20%7B%0A%20%20z-index%3A%2031%3B%0A%20%20background%3A%20%23fff%3B%0A%20%20border%3A%201px%20solid%20%23ccc%3B%0A%20%20border-radius%3A%205px%3B%0A%20%20padding%3A%2015px%2015px%200%3B%0A%20%20-webkit-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-moz-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-o-animation%3A%20fadeInDown%200.2s%3B%0A%20%20-ms-animation%3A%20fadeInDown%200.2s%3B%0A%20%20animation%3A%20fadeInDown%200.2s%3B%0A%20%20color%3A%20%23666%3B%0A%20%20-webkit-box-shadow%3A%200%205px%2010px%20rgba(0%2C0%2C0%2C0.2)%3B%0A%20%20box-shadow%3A%200%205px%2010px%20rgba(0%2C0%2C0%2C0.2)%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%2040px%3B%0A%20%20right%3A%200%3B%0A%20%20min-width%3A%20230px%3B%0A%20%20line-height%3A%20initial%3B%0A%20%20-webkit-user-select%3A%20none%3B%0A%20%20-moz-user-select%3A%20none%3B%0A%20%20-ms-user-select%3A%20none%3B%0A%20%20user-select%3A%20none%3B%0A%20%20-moz-user-select%3A%20-moz-none%3B%0A%7D%0A.add-to-collection-menu%3Aafter%20%7B%0A%20%20content%3A%20%22%22%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-9px%3B%0A%20%20right%3A%207px%3B%0A%20%20border-width%3A%209px%3B%0A%20%20border-top-width%3A%200%3B%0A%20%20border-style%3A%20solid%3B%0A%20%20border-color%3A%20transparent%20transparent%20%23fff%3B%0A%20%20line-height%3A%200%3B%0A%20%20z-index%3A%20zindex%3B%0A%7D%0A.add-to-collection-menu%3Abefore%20%7B%0A%20%20content%3A%20%22%22%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-10px%3B%0A%20%20right%3A%206px%3B%0A%20%20border-width%3A%2010px%3B%0A%20%20border-top-width%3A%200%3B%0A%20%20border-style%3A%20solid%3B%0A%20%20border-color%3A%20transparent%20transparent%20%23ccc%3B%0A%20%20line-height%3A%200%3B%0A%7D%0A.add-to-collection-menu%20.empty-collections%20%7B%0A%20%20margin-bottom%3A%2015px%3B%0A%20%20font-style%3A%20italic%3B%0A%20%20color%3A%20%23666%3B%0A%20%20font-size%3A%2090%25%3B%0A%7D%0A.add-to-collection-menu%20.empty-collections%20img%20%7B%0A%20%20display%3A%20block%3B%0A%20%20width%3A%2060px%3B%0A%20%20margin%3A%200%20auto%2010px%3B%0A%7D%0A.add-to-collection-menu%20.available-collections%20%7B%0A%20%20max-height%3A%20160px%3B%0A%20%20overflow-y%3A%20auto%3B%0A%20%20margin-bottom%3A%2015px%3B%0A%7D%0A.add-to-collection-menu%20.available-collections%20.collection-option-container%20%7B%0A%20%20display%3A%20block%3B%0A%7D%0A.add-to-collection-menu%20.available-collections%20.collection-option%20%7B%0A%20%20margin%3A%204px%202px%3B%0A%20%20vertical-align%3A%20middle%3B%0A%20%20display%3A%20inline-block%3B%0A%20%20border-radius%3A%2010px%3B%0A%20%20color%3A%20rgba(255%2C255%2C255%2C0.9)%3B%0A%20%20font-size%3A%2080%25%3B%0A%20%20padding%3A%203px%207px%3B%0A%20%20max-width%3A%20185px%3B%0A%20%20white-space%3A%20nowrap%3B%0A%20%20overflow%3A%20hidden%3B%0A%20%20-o-text-overflow%3A%20ellipsis%3B%0A%20%20text-overflow%3A%20ellipsis%3B%0A%7D%0A.add-to-collection-menu%20.available-collections%20.collection-option%20i.pillow-icon-error%20%7B%0A%20%20font-size%3A%2080%25%3B%0A%20%20margin-right%3A%205px%3B%0A%7D%0A.add-to-collection-menu%20.dcg-ap-component-checkbox.disabled%20%7B%0A%20%20opacity%3A%200.5%3B%0A%20%20-ms-filter%3A%20%22progid%3ADXImageTransform.Microsoft.Alpha(Opacity%3D50)%22%3B%0A%20%20filter%3A%20alpha(opacity%3D50)%3B%0A%7D%0A.add-to-collection-menu%20.error-message%20%7B%0A%20%20text-align%3A%20center%3B%0A%20%20font-size%3A%2090%25%3B%0A%20%20background%3A%20rgba(192%2C80%2C77%2C0.1)%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%3A%201px%20solid%20rgba(192%2C80%2C77%2C0.5)%3B%0A%20%20border-radius%3A%203px%3B%0A%20%20color%3A%20%23c0504d%3B%0A%20%20-webkit-animation%3A%20fadeIn%200.3s%3B%0A%20%20-moz-animation%3A%20fadeIn%200.3s%3B%0A%20%20-o-animation%3A%20fadeIn%200.3s%3B%0A%20%20-ms-animation%3A%20fadeIn%200.3s%3B%0A%20%20animation%3A%20fadeIn%200.3s%3B%0A%20%20margin-bottom%3A%205px%3B%0A%7D%0A.add-to-collection-menu%20.saving-animation%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-align%3A%20center%3B%0A%20%20-moz-box-align%3A%20center%3B%0A%20%20-o-box-align%3A%20center%3B%0A%20%20-ms-flex-align%3A%20center%3B%0A%20%20-webkit-align-items%3A%20center%3B%0A%20%20align-items%3A%20center%3B%0A%20%20-webkit-box-pack%3A%20center%3B%0A%20%20-moz-box-pack%3A%20center%3B%0A%20%20-o-box-pack%3A%20center%3B%0A%20%20-ms-flex-pack%3A%20center%3B%0A%20%20-webkit-justify-content%3A%20center%3B%0A%20%20justify-content%3A%20center%3B%0A%7D%0A.add-to-collection-menu%20.saving-animation%20.pillow-spinner%20%7B%0A%20%20margin-right%3A%2010px%3B%0A%7D%0A.add-to-collection-menu%20.menu-title%20%7B%0A%20%20text-transform%3A%20uppercase%3B%0A%20%20color%3A%20%23999%3B%0A%20%20margin-bottom%3A%207.5px%3B%0A%20%20font-size%3A%2095%25%3B%0A%7D%0A.add-to-collection-menu%20.btn-blue%20%7B%0A%20%20display%3A%20block%3B%0A%20%20text-align%3A%20center%3B%0A%20%20margin-bottom%3A%2015px%3B%0A%7D%0A.add-to-collection-menu%20.new-collection%20%7B%0A%20%20border-top%3A%201px%20solid%20%23ccc%3B%0A%20%20padding%3A%2015px%202px%3B%0A%20%20margin-top%3A%2015px%3B%0A%20%20color%3A%20%234781b9%3B%0A%20%20cursor%3A%20pointer%3B%0A%7D%0A.add-to-collection-menu%20.new-collection%20i%20%7B%0A%20%20font-size%3A%2090%25%3B%0A%7D%0A.add-to-collection-menu%20.new-collection%20span%20%7B%0A%20%20margin-left%3A%207px%3B%0A%7D%0A.add-to-collection-menu%20.new-collection.dcg-hovered%20%7B%0A%20%20color%3A%20%23004f9b%3B%0A%7D%0A.add-to-collection-menu%20.new-collection.dcg-hovered%20span%20%7B%0A%20%20text-decoration%3A%20underline%3B%0A%7D%0A.add-to-collection-menu%20.new-collection.dcg-depressed%20%7B%0A%20%20color%3A%20%23033b70%3B%0A%7D%0A"))
});
define("loadcss!shared/dcgviews/activity-main-action", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/dcgviews/activity-main-action.css", decodeURIComponent(".activity-main-action%20%7B%0A%20%20color%3A%20%23999%3B%0A%20%20font-size%3A%2090%25%3B%0A%20%20padding%3A%2010px%3B%0A%20%20cursor%3A%20pointer%3B%0A%20%20border-radius%3A%205px%3B%0A%7D%0A.activity-main-action%3Anot(.selected)%20%7B%0A%20%20background%3A%20%23fff%3B%0A%20%20border%3A%201px%20solid%20%23bbb%3B%0A%7D%0A"))
});
define("teacher-spa/collections/add-to-collection", ["require", "exports", "tslib", "lib/i18n", "jquery", "dcgview", "./new-collection-modal", "activitybuilder/ts-controller", "./helpers", "underscore", "shared/dcgviews/dropdown/dot-dot-options-dropdown", "bugsnag", "loadcss!./add-to-collection", "loadcss!./../../shared/dcgviews/activity-main-action"], function(require, exports, tslib_1, i18n, $, DCGView, new_collection_modal_1, ts_controller_1, helpers_1, _, dot_dot_options_dropdown_1, bugsnag_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , SwitchUnion = _a.SwitchUnion
        , If = _a.If
        , IfElse = _a.IfElse
        , For = _a.For
        , Switch = _a.Switch;
    var AddToCollectionController = function(_super) {
        tslib_1.__extends(AddToCollectionController, _super);
        function AddToCollectionController(resources, activityId) {
            var _this = _super.call(this, resources) || this;
            _this.activityId = activityId;
            _this.menuState = {
                status: "closed"
            };
            _this.dispatchToken = resources.dispatcher.register(function(action, onUpdateDone) {
                return _this.handleDispatch(action, onUpdateDone)
            });
            return _this
        }
        AddToCollectionController.prototype.getPath = function() {
            return [this.activityId]
        }
        ;
        AddToCollectionController.prototype.ownHandleDispatch = function(action) {
            var _this = this;
            if (action.type === "owned-collections-updated" && this.menuState.status !== "closed") {
                for (var _i = 0, _a = action.modified.concat(action.removed); _i < _a.length; _i++) {
                    var id = _a[_i];
                    delete this.menuState.changes[id]
                }
            }
            if (!this.myAction(action))
                return;
            if (action.type === "add-to-collections-menu") {
                if (action.step === "start" && this.menuState.status === "closed") {
                    this.menuState = {
                        status: "editing",
                        changes: {},
                        isSaveInFlight: false
                    };
                    this.newCollectionModalVisible = false
                } else if (action.step === "cancel" && this.menuState.status !== "closed" && !this.menuState.isSaveInFlight) {
                    this.menuState = {
                        status: "closed"
                    };
                    this.newCollectionModalVisible = false
                } else if (action.step === "update" && this.menuState.status !== "closed" && !this.menuState.isSaveInFlight) {
                    var collectionId = action.value.collectionId;
                    var changes = tslib_1.__assign({}, this.menuState.changes);
                    if (collectionId in changes) {
                        delete changes[collectionId]
                    } else {
                        changes[collectionId] = !this.isChecked(collectionId)
                    }
                    this.menuState.changes = changes
                } else if (action.step === "finish") {
                    this.newCollectionModalVisible = false;
                    if (this.menuState.status !== "editing" && this.menuState.status !== "error") {
                        throw new Error("Should only save add-to-collections menu from editing or error state")
                    }
                    var data = this.getData();
                    if (data.status !== "loaded") {
                        throw new Error("Should only save add-to-collections menu when data is loaded.")
                    }
                    var collectionIds = data.response.collectionIds;
                    var changes = tslib_1.__assign({}, this.menuState.changes);
                    for (var _b = 0, collectionIds_1 = collectionIds; _b < collectionIds_1.length; _b++) {
                        var id = collectionIds_1[_b];
                        if (!this.hasChanges(id)) {
                            delete changes[id]
                        }
                    }
                    var attemptedUpdateCount_1 = _.keys(changes).length;
                    this.menuState = tslib_1.__assign(tslib_1.__assign({}, this.menuState), {
                        isSaveInFlight: true
                    });
                    this.resources.getCollectionStore().setCollectionsForActivity(this.activityId, tslib_1.__assign({}, changes)).then(function(result) {
                        if (!result)
                            throw new Error("JQuery promises are annoying.");
                        if (_.isEmpty(result.skippedDueToEditing)) {
                            _this.menuState = {
                                status: "closed"
                            }
                        } else {
                            _this.menuState = {
                                status: "error",
                                changes: {},
                                attemptedUpdateCount: attemptedUpdateCount_1,
                                skippedDueToEditing: result.skippedDueToEditing,
                                isSaveInFlight: false
                            }
                        }
                        _this.resources.dispatch({
                            type: "update-all"
                        })
                    }).fail(function() {
                        _this.menuState = {
                            status: "closed"
                        };
                        _this.resources.dispatch({
                            type: "update-all"
                        })
                    })
                }
            } else if (action.type === "toggle-new-collection-modal") {
                this.newCollectionModalVisible = !this.newCollectionModalVisible
            } else if (action.type === "remove-activity-from-collection") {
                var updatedCollection = {};
                updatedCollection[action.collectionId] = false;
                this.resources.getCollectionStore().setCollectionsForActivity(this.activityId, updatedCollection)
            }
        }
        ;
        AddToCollectionController.prototype.getData = function() {
            var allCollections = this.resources.getCollectionStore().requestUserCollectionIds();
            var collectionsForActivity = this.resources.getCollectionStore().getCollectionsForActivity(this.activityId);
            if (allCollections.status !== "loaded") {
                return allCollections
            } else if (collectionsForActivity.status !== "loaded") {
                return collectionsForActivity
            } else {
                return {
                    status: "loaded",
                    response: {
                        collectionIds: allCollections.response,
                        collectionsForActivity: collectionsForActivity.response
                    }
                }
            }
        }
        ;
        AddToCollectionController.prototype.hasChanges = function(id) {
            var data = this.getData();
            if (data.status !== "loaded" || this.menuState.status === "closed") {
                return false
            }
            return !!data.response.collectionsForActivity[id] !== this.isChecked(id)
        }
        ;
        AddToCollectionController.prototype.isChecked = function(id) {
            var data = this.getData();
            if (data.status !== "loaded" || this.menuState.status === "closed") {
                return false
            }
            return id in this.menuState.changes ? !!this.menuState.changes[id] : !!data.response.collectionsForActivity[id]
        }
        ;
        AddToCollectionController.prototype.isSubmitEnabled = function() {
            if (this.menuState.status === "closed" || this.menuState.isSaveInFlight)
                return false;
            var data = this.getData();
            if (data.status !== "loaded") {
                return false
            }
            for (var _i = 0, _a = data.response.collectionIds; _i < _a.length; _i++) {
                var id = _a[_i];
                if (this.hasChanges(id)) {
                    return true
                }
            }
            return false
        }
        ;
        AddToCollectionController.prototype.getAddToCollectionMenuState = function() {
            return this.menuState
        }
        ;
        AddToCollectionController.prototype.isNewCollectionModalVisiblle = function() {
            return this.newCollectionModalVisible
        }
        ;
        AddToCollectionController.prototype.destroy = function() {
            this.resources.dispatcher.unregister(this.dispatchToken);
            this.exit()
        }
        ;
        return AddToCollectionController
    }(ts_controller_1.Controller);
    var ActivityCollectionOptions = function(_super) {
        tslib_1.__extends(ActivityCollectionOptions, _super);
        function ActivityCollectionOptions() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ActivityCollectionOptions.prototype.init = function() {
            this.controller = new AddToCollectionController(this.props.resources(),this.props.activityId())
        }
        ;
        ActivityCollectionOptions.prototype.willUnmount = function() {
            this.controller.destroy()
        }
        ;
        ActivityCollectionOptions.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", null, IfElse(function() {
                return !!_this.props.isCollectionAuthor && _this.props.isCollectionAuthor() && _this.hasParentCollections()
            }, {
                true: function() {
                    return DCGView.createElement("div", {
                        class: DCGView.const("activity-actions-dropdown-container")
                    }, SwitchUnion("status", function() {
                        return _this.controller.getData()
                    })({
                        loading: function() {
                            return DCGView.createElement("div", null)
                        },
                        error: function() {
                            return DCGView.createElement("div", null)
                        },
                        loaded: function() {
                            return DCGView.createElement(dot_dot_options_dropdown_1.DotDotOptionsDropdown, {
                                class: function() {
                                    return "activity-actions-dropdown"
                                },
                                dropdownOptions: function() {
                                    return [{
                                        title: function() {
                                            return i18n.s("teacher-button-remove-from-collection")
                                        },
                                        icon: "pillow-icon-remove",
                                        class: "activity-option-remove",
                                        action: function() {
                                            _this.controller.dispatch({
                                                type: "remove-activity-from-collection",
                                                activityId: _this.props.activityId(),
                                                collectionId: _this.immediateParentCollection()
                                            })
                                        }
                                    }]
                                }
                            })
                        }
                    }))
                },
                false: function() {
                    return DCGView.createElement(AddToCollectionButton, {
                        controller: function() {
                            return _this.controller
                        },
                        resources: _this.props.resources,
                        activityId: _this.props.activityId,
                        activityUrl: _this.props.activityUrl
                    })
                }
            }))
        }
        ;
        ActivityCollectionOptions.prototype.immediateParentCollection = function() {
            if (!this.props.collectionIds || !this.props.collectionIds().length) {
                throw new Error("Expected activity " + this.props.activityId() + " to have a collection parent but it doesn't have one")
            }
            return this.props.collectionIds()[this.props.collectionIds().length - 1]
        }
        ;
        ActivityCollectionOptions.prototype.hasParentCollections = function() {
            return !!(this.props.collectionIds && this.props.collectionIds().length)
        }
        ;
        return ActivityCollectionOptions
    }(DCGView.Class);
    exports.ActivityCollectionOptions = ActivityCollectionOptions;
    var AddToCollectionButton = function(_super) {
        tslib_1.__extends(AddToCollectionButton, _super);
        function AddToCollectionButton() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        AddToCollectionButton.prototype.template = function() {
            var _this = this;
            var title = function() {
                return i18n.s("teacher-title-add-to-collections")
            };
            return DCGView.createElement(If, {
                predicate: function() {
                    return true
                }
            }, function() {
                return DCGView.createElement("div", {
                    class: DCGView.const("add-to-collection-dropdown-container"),
                    didMount: _this.bindFn(_this.didMountDropdown),
                    willUnmount: _this.bindFn(_this.willUnmountDropdown)
                }, DCGView.createElement("div", {
                    role: DCGView.const("link"),
                    tabindex: function() {
                        return _this.props.controller().getData().status !== "loaded" ? "-1" : "0"
                    },
                    "aria-disabled": function() {
                        return _this.props.controller().getData().status !== "loaded"
                    },
                    "aria-expanded": function() {
                        return _this.props.controller().getAddToCollectionMenuState().status !== "closed"
                    },
                    class: function() {
                        return {
                            "anchor-container": true,
                            isOpen: _this.props.controller().getAddToCollectionMenuState().status !== "closed",
                            "add-to-collection-button": true,
                            disabled: _this.props.controller().getData().status !== "loaded"
                        }
                    },
                    onTap: function() {
                        if (_this.isDisabled())
                            return;
                        if (!_this.props.resources().user.loggedIn) {
                            _this.props.resources().headerController.dispatch({
                                type: "update-mode",
                                mode: "login"
                            })
                        } else {
                            _this.props.controller().dispatch(_this.props.controller().getAddToCollectionMenuState().status === "closed" ? {
                                type: "add-to-collections-menu",
                                step: "start"
                            } : {
                                type: "add-to-collections-menu",
                                step: "cancel"
                            })
                        }
                    }
                }, DCGView.createElement("i", {
                    class: function() {
                        return {
                            "pillow-icon-plus": true,
                            "activity-main-action": true,
                            "in-collection": _this.isInSomeOwnedCollection(),
                            disabled: _this.isDisabled()
                        }
                    }
                })), DCGView.createElement(If, {
                    predicate: function() {
                        return _this.props.controller().getAddToCollectionMenuState().status !== "closed"
                    }
                }, function() {
                    return DCGView.createElement("div", {
                        class: DCGView.const("add-to-collection-menu")
                    }, DCGView.createElement("div", {
                        class: DCGView.const("menu-title"),
                        role: DCGView.const("heading"),
                        "aria-level": DCGView.const("2")
                    }, title), SwitchUnion("status", function() {
                        return _this.props.controller().getData()
                    })({
                        loading: function() {
                            return DCGView.createElement("div", {
                                class: DCGView.const("loading-message")
                            }, function() {
                                return i18n.s("global-message-loading")
                            })
                        },
                        error: function(request) {
                            return DCGView.createElement("div", {
                                class: DCGView.const("error-message")
                            }, function() {
                                return i18n.raw(request().err)
                            })
                        },
                        loaded: function(request) {
                            return DCGView.createElement(AddToCollectionMenu, {
                                resources: _this.props.resources,
                                list: function() {
                                    return request().response.collectionIds
                                },
                                collectionsForActivity: function() {
                                    return request().response.collectionsForActivity
                                },
                                controller: _this.props.controller
                            })
                        }
                    }), DCGView.createElement("div", {
                        class: DCGView.const("new-collection"),
                        role: DCGView.const("button"),
                        tabindex: DCGView.const("0"),
                        onTap: function() {
                            _this.props.controller().dispatch({
                                type: "toggle-new-collection-modal"
                            })
                        }
                    }, DCGView.createElement("i", {
                        class: DCGView.const("pillow-icon-plus")
                    }), DCGView.createElement("span", null, function() {
                        return i18n.s("teacher-button-new-collection")
                    })), DCGView.createElement(new_collection_modal_1.NewCollectionModal, {
                        resources: _this.props.resources,
                        visible: function() {
                            return _this.props.controller().isNewCollectionModalVisiblle()
                        },
                        onClose: function() {
                            _this.props.controller().dispatch({
                                type: "toggle-new-collection-modal"
                            })
                        }
                    }))
                }))
            })
        }
        ;
        AddToCollectionButton.prototype.didMountDropdown = function(node) {
            var _this = this;
            this.id = _.uniqueId("collectionsdropdown");
            $("body").on("dcg-tapstart." + this.id, function(e) {
                var menuState = _this.props.controller().getAddToCollectionMenuState();
                if (menuState.status === "closed" || menuState.isSaveInFlight) {
                    return
                }
                if (_this.props.controller().isNewCollectionModalVisiblle())
                    return;
                if (!e.originalEvent.target)
                    return;
                if ($(e.originalEvent.target).closest(node).length)
                    return;
                if ($(e.originalEvent.target).closest(".new-collection-modal").length) {
                    return
                }
                _this.props.controller().dispatch({
                    type: "add-to-collections-menu",
                    step: "cancel"
                });
                _this.update()
            })
        }
        ;
        AddToCollectionButton.prototype.willUnmountDropdown = function() {
            $("body").off("." + this.id)
        }
        ;
        AddToCollectionButton.prototype.isDisabled = function() {
            var data = this.props.controller().getData();
            if (data.status === "error" && data.statusCode !== 401) {
                bugsnag_1.Bugsnag.notify("Unexpected error loading collections for activity " + this.props.activityId() + ": " + data.err);
                return true
            }
            return false
        }
        ;
        AddToCollectionButton.prototype.isInSomeOwnedCollection = function() {
            var request = this.props.controller().getData();
            if (request.status !== "loaded")
                return false;
            for (var collectionId in request.response.collectionsForActivity) {
                var collectionReq = this.props.resources().getCollectionStore().requestCollection(collectionId);
                if (collectionReq.status !== "loaded")
                    return false;
                if (collectionReq.response.isTeamDesmosAuthored)
                    continue;
                if (collectionReq.response.user.id === this.props.resources().user.id)
                    return true
            }
            return false
        }
        ;
        return AddToCollectionButton
    }(DCGView.Class);
    var AddToCollectionMenu = function(_super) {
        tslib_1.__extends(AddToCollectionMenu, _super);
        function AddToCollectionMenu() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        AddToCollectionMenu.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", null, DCGView.createElement(Switch, {
                key: function() {
                    return _this.props.list().length === 0
                }
            }, function(noCollections) {
                if (noCollections) {
                    return DCGView.createElement("div", {
                        class: DCGView.const("empty-collections")
                    }, DCGView.createElement("img", {
                        src: DCGView.const("/fingerprinted/static/img/collections_empty-5a7df4fbecb0ea11f855c34acf4b1b112c3c21ef.png"),
                        alt: function() {
                            return i18n.s("teacher-label-empty-collection")
                        }
                    }), function() {
                        return i18n.s("teacher-message-no-collections")
                    })
                } else {
                    return DCGView.createElement("div", null, DCGView.createElement(For, {
                        each: function() {
                            return _this.getAvailableCollections()
                        }
                    }, DCGView.createElement("div", {
                        class: DCGView.const("available-collections"),
                        role: DCGView.const("list")
                    }, function(id) {
                        return DCGView.createElement("div", {
                            class: DCGView.const("collection-option-container"),
                            role: DCGView.const("listitem")
                        }, DCGView.createElement("div", {
                            role: DCGView.const("checkbox"),
                            tabindex: DCGView.const("0"),
                            "aria-checked": function() {
                                return _this.props.controller().isChecked(id)
                            },
                            class: function() {
                                var _a;
                                return _a = {
                                    "collection-option": true
                                },
                                    _a[helpers_1.getColorClassForCollection(_this.getLoadedCollection(id))] = true,
                                    _a["in-collection"] = _this.props.controller().isChecked(id),
                                    _a["not-in-collection"] = !_this.props.controller().isChecked(id),
                                    _a["has-error"] = _this.showWarningIcon(id),
                                    _a
                            },
                            onTap: function() {
                                _this.props.controller().dispatch({
                                    type: "add-to-collections-menu",
                                    step: "update",
                                    value: {
                                        collectionId: id
                                    }
                                })
                            }
                        }, DCGView.createElement(If, {
                            predicate: function() {
                                return _this.showWarningIcon(id)
                            }
                        }, function() {
                            return DCGView.createElement("i", {
                                class: DCGView.const("pillow-icon-error")
                            })
                        }), function() {
                            return i18n.raw(_this.getLoadedCollection(id).title)
                        }))
                    })), DCGView.createElement("div", {
                        class: function() {
                            return {
                                "btn-blue": true,
                                disabled: !_this.props.controller().isSubmitEnabled()
                            }
                        },
                        "aria-disabled": function() {
                            return !_this.props.controller().isSubmitEnabled()
                        },
                        role: DCGView.const("button"),
                        tabindex: function() {
                            return _this.props.controller().isSubmitEnabled() ? "0" : "-1"
                        },
                        onTap: function() {
                            return _this.submit()
                        }
                    }, IfElse(function() {
                        return _this.getState().isSaveInFlight
                    }, {
                        true: function() {
                            return DCGView.createElement("div", {
                                class: DCGView.const("saving-animation")
                            }, DCGView.createElement("span", {
                                class: DCGView.const("pillow-spinner-dark")
                            }), function() {
                                return i18n.s("teacher-message-add-to-collection-saving")
                            })
                        },
                        false: function() {
                            return DCGView.createElement("span", null, function() {
                                return i18n.s("global-button-save")
                            })
                        }
                    })), SwitchUnion("status", function() {
                        return _this.getState()
                    })({
                        editing: function() {
                            return DCGView.createElement("span", null)
                        },
                        error: function(state) {
                            return DCGView.createElement("div", {
                                class: DCGView.const("error-message")
                            }, function() {
                                if (state().attemptedUpdateCount === 1) {
                                    return i18n.s("teacher-error-add-to-single-collection-while-editing")
                                } else if (_.keys(state().skippedDueToEditing).length === 1) {
                                    return i18n.s("teacher-error-add-to-multiple-collections-while-editing-one")
                                } else {
                                    return i18n.s("teacher-error-add-to-multiple-collections-while-editing-many", {
                                        count: _.keys(state().skippedDueToEditing).length
                                    })
                                }
                            })
                        }
                    }))
                }
            }))
        }
        ;
        AddToCollectionMenu.prototype.getState = function() {
            var state = this.props.controller().getAddToCollectionMenuState();
            if (state.status === "closed") {
                throw new Error("Menu state should not be closed.")
            }
            return state
        }
        ;
        AddToCollectionMenu.prototype.getLoadedCollection = function(id) {
            var req = this.props.resources().getCollectionStore().requestCollection(id);
            if (req.status != "loaded") {
                throw new Error("Expected collection " + id + " to be loaded.")
            }
            return req.response
        }
        ;
        AddToCollectionMenu.prototype.getAvailableCollections = function() {
            var _this = this;
            return this.props.list().filter(function(id) {
                var collection = _this.getLoadedCollection(id);
                return !collection.isTeamDesmosAuthored && collection.user.id === _this.props.resources().user.id
            })
        }
        ;
        AddToCollectionMenu.prototype.showWarningIcon = function(id) {
            var state = this.props.controller().getAddToCollectionMenuState();
            if (state.status !== "error")
                return false;
            return !!state.skippedDueToEditing && !!state.skippedDueToEditing[id]
        }
        ;
        AddToCollectionMenu.prototype.submit = function() {
            if (!this.props.controller().isSubmitEnabled())
                return;
            this.props.controller().dispatch({
                type: "add-to-collections-menu",
                step: "finish"
            })
        }
        ;
        return AddToCollectionMenu
    }(DCGView.Class)
});
define("loadcss!teacher-spa/collections/activity-collection-tags", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/teacher-spa/collections/activity-collection-tags.css", decodeURIComponent(".activity-collection-tags%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20font-size%3A%2090%25%3B%0A%7D%0A.activity-collection-tags%20.collection-tag%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20vertical-align%3A%20middle%3B%0A%20%20border-radius%3A%2010px%3B%0A%20%20margin%3A%203px%206px%203px%200%3B%0A%20%20text-decoration%3A%20none%3B%0A%20%20color%3A%20rgba(255%2C255%2C255%2C0.9)%3B%0A%20%20padding%3A%203px%207px%3B%0A%20%20max-width%3A%20150px%3B%0A%20%20white-space%3A%20nowrap%3B%0A%20%20overflow%3A%20hidden%3B%0A%20%20-o-text-overflow%3A%20ellipsis%3B%0A%20%20text-overflow%3A%20ellipsis%3B%0A%7D%0A"))
});
define("teacher-spa/collections/activity-collection-tags", ["require", "exports", "tslib", "lib/i18n", "dcgview", "./helpers", "bugsnag", "loadcss!./activity-collection-tags"], function(require, exports, tslib_1, i18n, DCGView, helpers_1, bugsnag_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var For = DCGView.Components.For;
    var ActivityCollectionTags = function(_super) {
        tslib_1.__extends(ActivityCollectionTags, _super);
        function ActivityCollectionTags() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ActivityCollectionTags.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(For, {
                each: function() {
                    return _this.getCollectionIds()
                }
            }, DCGView.createElement("div", {
                class: DCGView.const("activity-collection-tags")
            }, function(collectionId) {
                return DCGView.createElement("a", {
                    href: function() {
                        return "/collection/" + collectionId
                    },
                    class: function() {
                        var _a;
                        return _a = {
                            "collection-tag": true
                        },
                            _a[helpers_1.getColorClassForCollection(_this.assertCollection(collectionId))] = true,
                            _a
                    }
                }, function() {
                    return i18n.raw(_this.assertCollection(collectionId).title)
                })
            }))
        }
        ;
        ActivityCollectionTags.prototype.assertCollection = function(collectionId) {
            var req = this.props.resources().getCollectionStore().requestCollection(collectionId);
            if (req.status !== "loaded") {
                throw new Error("Expected collection " + collectionId + " to be loaded.")
            }
            return req.response
        }
        ;
        ActivityCollectionTags.prototype.getCollectionIds = function() {
            var req = this.getCollectionsForActivity();
            if (req.status === "error") {
                if (req.statusCode !== 401) {
                    bugsnag_1.Bugsnag.notify(req.err)
                }
                return []
            } else if (req.status === "loading") {
                return []
            } else {
                var ids = [];
                for (var id in req.response) {
                    if (req.response[id]) {
                        ids.push(id)
                    }
                }
                return ids
            }
        }
        ;
        ActivityCollectionTags.prototype.getCollectionsForActivity = function() {
            return this.props.resources().getCollectionStore().getCollectionsForActivity(this.props.activityId())
        }
        ;
        return ActivityCollectionTags
    }(DCGView.Class);
    exports.ActivityCollectionTags = ActivityCollectionTags
});
define("loadcss!teacher-spa/activity-card", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/teacher-spa/activity-card.css", decodeURIComponent(".activity-card-large%2C%0A.activity-card-placeholder%20%7B%0A%20%20width%3A%20100%25%3B%0A%20%20vertical-align%3A%20top%3B%0A%20%20display%3A%20inline-block%3B%0A%20%20position%3A%20relative%3B%0A%20%20margin-bottom%3A%2015px%3B%0A%20%20border-radius%3A%207px%3B%0A%20%20margin-right%3A%205px%3B%0A%7D%0A.activity-card-placeholder%20%7B%0A%20%20-webkit-animation%3A%20pulse%202s%20infinite%3B%0A%20%20-moz-animation%3A%20pulse%202s%20infinite%3B%0A%20%20-o-animation%3A%20pulse%202s%20infinite%3B%0A%20%20-ms-animation%3A%20pulse%202s%20infinite%3B%0A%20%20animation%3A%20pulse%202s%20infinite%3B%0A%20%20background%3A%20%23fff%3B%0A%20%20border%3A%202px%20solid%20%23e2e2e2%3B%0A%7D%0A.activity-card-placeholder.short-placeholder%20%7B%0A%20%20height%3A%2080px%3B%0A%7D%0A.activity-card-placeholder%3Anot(.short-placeholder)%20%7B%0A%20%20height%3A%20110px%3B%0A%7D%0A.activity-card-large%20.activity-thumb%20%7B%0A%20%20border-radius%3A%205px%3B%0A%20%20vertical-align%3A%20top%3B%0A%20%20border%3A%201px%20solid%20%23e2e2e2%3B%0A%7D%0A.activity-card-large%20.bg-lock-overlay%20%7B%0A%20%20color%3A%20%23999%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%2015px%3B%0A%20%20left%3A%2015px%3B%0A%20%20border-radius%3A%205px%3B%0A%20%20text-align%3A%20center%3B%0A%20%20padding%3A%2010px%208px%3B%0A%20%20background-color%3A%20rgba(255%2C255%2C255%2C0.8)%3B%0A%7D%0A.activity-card-large%20.bg-lock-overlay%20i.pillow-icon-lock%20%7B%0A%20%20font-size%3A%2060px%3B%0A%20%20text-shadow%3A%200%201px%20rgba(0%2C0%2C0%2C0.4)%2C%200%20-1px%20rgba(255%2C255%2C255%2C0.2)%3B%0A%7D%0A.activity-card-large%20.bg-lock-overlay%20i.pillow-icon-lock.small-lock%20%7B%0A%20%20font-size%3A%2030px%3B%0A%7D%0A.activity-card-large%20.description-content%20%7B%0A%20%20padding-left%3A%2015px%3B%0A%20%20display%3A%20inline-block%3B%0A%20%20vertical-align%3A%20top%3B%0A%20%20color%3A%20%23666%3B%0A%7D%0A.activity-card-large%20.activity-card-title%20div%20%7B%0A%20%20color%3A%20%23666%3B%0A%20%20font-family%3A%20%22Sanchez%22%2C%20%22Helvetica%20Neue%20Light%22%2C%20%22HelveticaNeue-Light%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%20%20display%3A%20inline-block%3B%0A%7D%0A.activity-card-large%20.activity-card-actions-container%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%2015px%3B%0A%20%20right%3A%200%3B%0A%20%20padding-right%3A%2010px%3B%0A%7D%0A.activity-card-large%20.activity-card-actions-container%20.activity-main-action-container%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20line-height%3A%2040px%3B%0A%20%20height%3A%2040px%3B%0A%20%20margin-right%3A%2010px%3B%0A%7D%0A.activity-card-large%20.activity-card-actions-container%20.actions-menu-container%20%7B%0A%20%20float%3A%20right%3B%0A%7D%0A.activity-card-large%20.activity-card-description%2C%0A.activity-card-large%20.activity-card-author-section%20%7B%0A%20%20font-size%3A%2095%25%3B%0A%7D%0A.activity-card-large%20.activity-card-author-section%20%7B%0A%20%20margin-top%3A%205px%3B%0A%20%20color%3A%20%23666%3B%0A%20%20padding-right%3A%2090px%3B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-lines%3A%20multiple%3B%0A%20%20-moz-box-lines%3A%20multiple%3B%0A%20%20-o-box-lines%3A%20multiple%3B%0A%20%20-webkit-flex-wrap%3A%20wrap%3B%0A%20%20-ms-flex-wrap%3A%20wrap%3B%0A%20%20flex-wrap%3A%20wrap%3B%0A%20%20-webkit-box-align%3A%20center%3B%0A%20%20-moz-box-align%3A%20center%3B%0A%20%20-o-box-align%3A%20center%3B%0A%20%20-ms-flex-align%3A%20center%3B%0A%20%20-webkit-align-items%3A%20center%3B%0A%20%20align-items%3A%20center%3B%0A%7D%0A.activity-card-large%20.activity-card-author-section%20.activity-card-author-container%2C%0A.activity-card-large%20.activity-card-author-section%20.time-and-category%20%7B%0A%20%20max-width%3A%20100%25%3B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-lines%3A%20multiple%3B%0A%20%20-moz-box-lines%3A%20multiple%3B%0A%20%20-o-box-lines%3A%20multiple%3B%0A%20%20-webkit-flex-wrap%3A%20wrap%3B%0A%20%20-ms-flex-wrap%3A%20wrap%3B%0A%20%20flex-wrap%3A%20wrap%3B%0A%20%20-webkit-box-align%3A%20center%3B%0A%20%20-moz-box-align%3A%20center%3B%0A%20%20-o-box-align%3A%20center%3B%0A%20%20-ms-flex-align%3A%20center%3B%0A%20%20-webkit-align-items%3A%20center%3B%0A%20%20align-items%3A%20center%3B%0A%7D%0A.activity-card-large%20.activity-card-author-section%20.time-estimate%2C%0A.activity-card-large%20.activity-card-author-section%20.activity-type%20%7B%0A%20%20padding%3A%200%208px%3B%0A%20%20border-left%3A%201px%20solid%20%23999%3B%0A%7D%0A.activity-card-large%20.activity-card-author-section%20.author-name%2C%0A.activity-card-large%20.activity-card-author-section%20.author-tag%20%7B%0A%20%20margin-right%3A%208px%3B%0A%7D%0A.activity-card-large%20.activity-card-author-section%20.author-name%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20white-space%3A%20nowrap%3B%0A%20%20white-space%3A%20nowrap%3B%0A%20%20overflow%3A%20hidden%3B%0A%20%20-o-text-overflow%3A%20ellipsis%3B%0A%20%20text-overflow%3A%20ellipsis%3B%0A%7D%0A.activity-card-large%20.activity-card-author-section%20.author-tag%20%7B%0A%20%20display%3A%20inline-block%3B%0A%20%20font-size%3A%2090%25%3B%0A%20%20padding%3A%201px%206px%3B%0A%20%20border%3A%201px%20solid%3B%0A%20%20border-radius%3A%2010px%3B%0A%7D%0A.activity-card-large%20.activity-card-author-section%20.by-desmos%20%7B%0A%20%20color%3A%20%234781b9%3B%0A%7D%0A.activity-card-large%20.activity-card-author-section%20.by-cpm%20%7B%0A%20%20color%3A%20%23233368%3B%0A%7D%0A.activity-card-large%20.activity-card-author-section%20.by-you%2C%0A.activity-card-large%20.activity-card-author-section%20.edited-by-you%2C%0A.activity-card-large%20.activity-card-author-section%20.team-desmos%20%7B%0A%20%20color%3A%20%2315b097%3B%0A%7D%0A.activity-card-large%20.activity-card-author-section%20.searchable-tag%20%7B%0A%20%20color%3A%20%2383629e%3B%0A%7D%0A.activity-card-large%20%7B%0A%20%20border%3A%201px%20solid%20%23e2e2e2%3B%0A%7D%0A.activity-card-large%20.card-background%20%7B%0A%20%20position%3A%20relative%3B%0A%20%20text-decoration%3A%20none%3B%0A%20%20display%3A%20block%3B%0A%20%20border%3A%201px%20solid%20transparent%3B%0A%20%20background%3A%20%23f2f2f2%3B%0A%7D%0A.activity-card-large%20.card-background.dcg-hovered%20%7B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%7D%0A.activity-card-large%20.card-background.dcg-depressed%20%7B%0A%20%20background%3A%20%23ebebeb%3B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%7D%0A.activity-card-large%20.card-background.dcg-hovered%2C%0A.activity-card-large%20.card-background.dcg-depressed%20%7B%0A%20%20border-radius%3A%207px%3B%0A%7D%0A.activity-card-large%20.card-contents%20%7B%0A%20%20margin%3A%2015px%3B%0A%7D%0A.activity-card-large%20.card-contents%20.activity-thumb%20%7B%0A%20%20width%3A%2080px%3B%0A%20%20height%3A%2080px%3B%0A%7D%0A.activity-card-large%20.card-contents%20.activity-thumb.small-thumb%20%7B%0A%20%20width%3A%2050px%3B%0A%20%20height%3A%2050px%3B%0A%7D%0A.activity-card-large%20.card-contents%20.description-content%20%7B%0A%20%20width%3A%20calc(100%25%20-%2080px)%3B%0A%7D%0A.activity-card-large%20.card-contents%20.activity-card-title%20%7B%0A%20%20font-size%3A%20130%25%3B%0A%20%20padding-right%3A%2090px%3B%0A%7D%0A.activity-card-large%20.card-contents.book-activity-card%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%7D%0A.activity-card-large%20.card-contents.book-activity-card%20.description-content%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-orient%3A%20vertical%3B%0A%20%20-moz-box-orient%3A%20vertical%3B%0A%20%20-o-box-orient%3A%20vertical%3B%0A%20%20-webkit-flex-direction%3A%20column%3B%0A%20%20-ms-flex-direction%3A%20column%3B%0A%20%20flex-direction%3A%20column%3B%0A%20%20-webkit-box-pack%3A%20center%3B%0A%20%20-moz-box-pack%3A%20center%3B%0A%20%20-o-box-pack%3A%20center%3B%0A%20%20-ms-flex-pack%3A%20center%3B%0A%20%20-webkit-justify-content%3A%20center%3B%0A%20%20justify-content%3A%20center%3B%0A%7D%0A.activity-card-large%20.card-contents.book-activity-card%20.activity-thumb%20%7B%0A%20%20width%3A%2050px%3B%0A%20%20height%3A%2050px%3B%0A%7D%0A.activity-card-actions-container%20.dot-dot-dropdown-container%20.activity-actions-dropdown.options-dropdown%3Aafter%20%7B%0A%20%20content%3A%20%22%22%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-9px%3B%0A%20%20right%3A%205px%3B%0A%20%20border-width%3A%209px%3B%0A%20%20border-top-width%3A%200%3B%0A%20%20border-style%3A%20solid%3B%0A%20%20border-color%3A%20transparent%20transparent%20%23fff%3B%0A%20%20line-height%3A%200%3B%0A%20%20z-index%3A%20zindex%3B%0A%7D%0A.activity-card-actions-container%20.dot-dot-dropdown-container%20.activity-actions-dropdown.options-dropdown%3Abefore%20%7B%0A%20%20content%3A%20%22%22%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-10px%3B%0A%20%20right%3A%204px%3B%0A%20%20border-width%3A%2010px%3B%0A%20%20border-top-width%3A%200%3B%0A%20%20border-style%3A%20solid%3B%0A%20%20border-color%3A%20transparent%20transparent%20%23ccc%3B%0A%20%20line-height%3A%200%3B%0A%7D%0A.activity-card-actions-container%20.dot-dot-dropdown-container%20.activity-actions-dropdown.options-dropdown%20.activity-option-remove%20%7B%0A%20%20color%3A%20%23c0504d%3B%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20800px)%20%7B%0A%20%20.activity-card-large%20.activity-card-author-section%20.author-name%2C%0A%20%20.activity-card-large%20.activity-card-author-section%20.author-tag%2C%0A%20%20.activity-card-large%20.activity-card-author-section%20.collection-tag%2C%0A%20%20.activity-card-large%20.activity-card-author-section%20.time-and-category%2C%0A%20%20.activity-card-large%20.activity-card-author-section%20.activity-collection-tags%20%7B%0A%20%20%20%20margin-bottom%3A%208px%3B%0A%20%20%7D%0A%20%20.activity-card-large%20.activity-card-author-section%20.activity-collection-tags%20%7B%0A%20%20%20%20-webkit-box-flex%3A%201%3B%0A%20%20%20%20-moz-box-flex%3A%201%3B%0A%20%20%20%20-o-box-flex%3A%201%3B%0A%20%20%20%20box-flex%3A%201%3B%0A%20%20%20%20-webkit-flex%3A%201%201%20100%25%3B%0A%20%20%20%20-ms-flex%3A%201%201%20100%25%3B%0A%20%20%20%20flex%3A%201%201%20100%25%3B%0A%20%20%20%20margin-bottom%3A%200%3B%0A%20%20%7D%0A%20%20.activity-card-large%20.activity-card-author-section%20.activity-collection-tags%20.collection-tag%20%7B%0A%20%20%20%20margin-top%3A%200%3B%0A%20%20%7D%0A%20%20.activity-card-large%20.activity-card-author-section%20.author-tags%20%7B%0A%20%20%20%20height%3A%20max-content%3B%0A%20%20%7D%0A%20%20.activity-card-large%20.activity-card-author-section%20.time-and-category%20%7B%0A%20%20%20%20display%3A%20block%3B%0A%20%20%7D%0A%20%20.activity-card-large%20.activity-card-author-section%20.time-and-category%20.time-estimate%20%7B%0A%20%20%20%20border-left%3A%20none%3B%0A%20%20%20%20padding-left%3A%200%3B%0A%20%20%7D%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20500px)%20%7B%0A%20%20.activity-card-large%20.activity-card-description%20%7B%0A%20%20%20%20display%3A%20none%3B%0A%20%20%7D%0A%20%20.activity-card-large%20.activity-card-description%20.card-contents%20.activity-thumb%20%7B%0A%20%20%20%20width%3A%2060px%3B%0A%20%20%20%20height%3A%2060px%3B%0A%20%20%7D%0A%20%20.activity-card-large%20.activity-card-description%20.card-contents%20.description-content%20%7B%0A%20%20%20%20width%3A%20calc(100%25%20-%2060px)%3B%0A%20%20%7D%0A%20%20.activity-card-large%20.activity-card-actions-container%20.bookmark-container%20%7B%0A%20%20%20%20margin-right%3A%200px%3B%0A%20%20%7D%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20400px)%20%7B%0A%20%20.activity-card-large%20.card-contents%20.activity-thumb%20%7B%0A%20%20%20%20width%3A%2050px%3B%0A%20%20%20%20height%3A%2050px%3B%0A%20%20%7D%0A%20%20.activity-card-large%20.card-contents%20.description-content%20%7B%0A%20%20%20%20width%3A%20calc(100%25%20-%2050px)%3B%0A%20%20%7D%0A%20%20.activity-card-author-section%20.time-estimate%2C%0A%20%20.activity-card-author-section%20.activity-type%20%7B%0A%20%20%20%20display%3A%20none%3B%0A%20%20%7D%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20320px)%20%7B%0A%20%20.activity-card-large%20.card-contents%20.description-content%20.activity-title-content%20%7B%0A%20%20%20%20font-size%3A%20100%25%3B%0A%20%20%20%20max-width%3A%20100%25%3B%0A%20%20%20%20white-space%3A%20nowrap%3B%0A%20%20%20%20overflow%3A%20hidden%3B%0A%20%20%20%20-o-text-overflow%3A%20ellipsis%3B%0A%20%20%20%20text-overflow%3A%20ellipsis%3B%0A%20%20%7D%0A%7D%0A"))
});
define("teacher-spa/activity-card", ["require", "exports", "tslib", "lib/i18n", "jquery", "dcgview", "shared/alp/collaboration-helpers", "activitybuilder/components/shared/text-with-math/mixed-text-display", "underscore", "./data/activity-time-estimates", "./data/activity-categories", "shared/alp/actions-menu", "./activity-ribbon", "shared/models/activity-store", "./collections/add-to-collection", "./collections/activity-collection-tags", "shared/dcgviews/tooltip", "./collections/helpers", "loadcss!./activity-card"], function(require, exports, tslib_1, i18n, $, DCGView, collaborationHelpers, mixed_text_display_1, _, activity_time_estimates_1, activity_categories_1, actions_menu_1, activity_ribbon_1, activity_store_1, add_to_collection_1, activity_collection_tags_1, tooltip_1, helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , Switch = _a.Switch
        , If = _a.If
        , IfElse = _a.IfElse;
    var ActivityCardHeader = function(_super) {
        tslib_1.__extends(ActivityCardHeader, _super);
        function ActivityCardHeader() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ActivityCardHeader.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("h2", {
                class: DCGView.const("activity-card-title")
            }, DCGView.createElement(Switch, {
                key: this.bindFn(this.privateByOtherUser)
            }, function(privateOther) {
                if (privateOther) {
                    return DCGView.createElement("span", null, function() {
                        return i18n.s("teacher-message-private-activity")
                    })
                } else {
                    return DCGView.createElement("div", {
                        class: DCGView.const("activity-title-content")
                    }, function() {
                        return i18n.raw(_this.getTitleText())
                    })
                }
            }))
        }
        ;
        ActivityCardHeader.prototype.isOwner = function() {
            return this.props.resources().user.owns(this.props.activity())
        }
        ;
        ActivityCardHeader.prototype.privateByOtherUser = function() {
            return this.props.activity().private && !this.isOwner()
        }
        ;
        ActivityCardHeader.prototype.getTitleText = function() {
            return this.props.activity().titlePrefix + this.props.activity().title
        }
        ;
        return ActivityCardHeader
    }(DCGView.Class);
    var LoadedActivityCard = function(_super) {
        tslib_1.__extends(LoadedActivityCard, _super);
        function LoadedActivityCard() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        LoadedActivityCard.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                class: function() {
                    var _a;
                    return _a = {
                        "activity-card-large": true
                    },
                        _a["activity-card-id-" + _this.props.activity().id.replace(":", "-")] = true,
                        _a
                }
            }, DCGView.createElement("a", {
                draggable: function() {
                    return !_this.hasParentCollections()
                },
                didMount: this.bindFn(this.didMountCard),
                class: DCGView.const("card-background"),
                href: function() {
                    return _this.getHref()
                }
            }, DCGView.createElement("div", {
                class: function() {
                    return {
                        "card-contents": true,
                        "book-activity-card": _this.isInBookCollection()
                    }
                }
            }, DCGView.createElement(If, {
                predicate: function() {
                    return _this.props.activity().private && _this.isOwner()
                }
            }, function() {
                return DCGView.createElement(activity_ribbon_1.ActivityRibbon, {
                    ribbonType: _this.const("private")
                })
            }), DCGView.createElement("img", {
                class: function() {
                    return {
                        "activity-thumb": true,
                        "small-thumb": _this.props.shortStyling()
                    }
                },
                draggable: DCGView.const("false"),
                src: function() {
                    return _this.props.activity().thumbURL
                },
                "aria-hidden": DCGView.const("true")
            }), DCGView.createElement(If, {
                predicate: this.bindFn(this.privateByOtherUser)
            }, function() {
                return DCGView.createElement("div", {
                    class: function() {
                        return {
                            "bg-lock-overlay": true,
                            "small-lock": _this.props.shortStyling()
                        }
                    }
                }, DCGView.createElement("i", {
                    "aria-hidden": DCGView.const("true"),
                    class: DCGView.const("pillow-icon-lock")
                }))
            }), DCGView.createElement("div", {
                class: DCGView.const("description-content")
            }, DCGView.createElement(ActivityCardHeader, tslib_1.__assign({}, this.props)), IfElse(function() {
                return _this.isInBookCollection()
            }, {
                true: function() {
                    return DCGView.createElement(BookActivityCardContent, {
                        activity: _this.props.activity
                    })
                },
                false: function() {
                    return DCGView.createElement("div", {
                        class: DCGView.const("activity-card-author-section")
                    }, DCGView.createElement("div", {
                        class: DCGView.const("activity-card-author-container")
                    }, DCGView.createElement(If, {
                        predicate: function() {
                            return !_this.hasAuthorTag() && !!_this.displayAuthorName()
                        }
                    }, function() {
                        return DCGView.createElement("div", {
                            class: DCGView.const("author-name")
                        }, DCGView.const(" "), function() {
                            return i18n.s("teacher-label-by-author", {
                                author: i18n.raw(_this.displayAuthorName() || "")
                            })
                        })
                    }), DCGView.createElement("div", {
                        class: DCGView.const("author-tags")
                    }, DCGView.createElement(If, {
                        predicate: function() {
                            return _this.props.resources().user.isTeamDesmos() && _this.props.activity().searchable
                        }
                    }, function() {
                        return DCGView.createElement("div", {
                            class: function() {
                                return {
                                    "author-tag": true,
                                    "searchable-tag": true
                                }
                            }
                        }, function() {
                            return i18n.s("teacher-label-activity-tag-searchable")
                        })
                    }), DCGView.createElement(If, {
                        predicate: function() {
                            return _this.isDesmos()
                        }
                    }, function() {
                        return DCGView.createElement("div", {
                            class: function() {
                                return {
                                    "author-tag": true,
                                    "by-desmos": true
                                }
                            }
                        }, function() {
                            return i18n.s("teacher-label-by-desmos")
                        })
                    }), DCGView.createElement(If, {
                        predicate: function() {
                            return _this.isCPMAuthor()
                        }
                    }, function() {
                        return DCGView.createElement("div", {
                            class: function() {
                                return {
                                    "author-tag": true,
                                    "by-cpm": true
                                }
                            }
                        }, function() {
                            return i18n.s("teacher-label-activity-tag-by-cpm")
                        })
                    }), DCGView.createElement(If, {
                        predicate: function() {
                            return !!_this.tagClass()
                        }
                    }, function() {
                        return DCGView.createElement("div", {
                            class: function() {
                                var _a;
                                return _a = {
                                    "author-tag": true
                                },
                                    _a[_this.tagClass()] = true,
                                    _a
                            }
                        }, function() {
                            return _this.tagText()
                        })
                    }))), DCGView.createElement("div", {
                        class: DCGView.const("time-and-category")
                    }, DCGView.createElement(If, {
                        predicate: function() {
                            return !!_this.props.activity().timeEstimate
                        }
                    }, function() {
                        return DCGView.createElement("span", {
                            class: DCGView.const("time-estimate")
                        }, function() {
                            return _this.timeEstimateText()
                        })
                    }), DCGView.createElement(If, {
                        predicate: function() {
                            return !!_this.props.activity().category
                        }
                    }, function() {
                        return DCGView.createElement("span", {
                            class: DCGView.const("activity-type")
                        }, function() {
                            return _this.categoryText()
                        })
                    })), DCGView.createElement(If, {
                        predicate: function() {
                            return !!activity_store_1.partnerExclusive(_this.props.activity(), _this.props.resources().user)
                        }
                    }, function() {
                        var exclusiveTag = activity_store_1.partnerExclusive(_this.props.activity(), _this.props.resources().user);
                        return DCGView.createElement(tooltip_1.Tooltip, {
                            tooltip: function() {
                                return i18n.s("teacher-label-activity-tag", {
                                    tag: i18n.raw(exclusiveTag)
                                })
                            }
                        }, DCGView.createElement("i", {
                            class: DCGView.const("pillow-icon-lock exclusive-tag")
                        }))
                    }), DCGView.createElement(If, {
                        predicate: function() {
                            return !_this.hasParentCollections()
                        }
                    }, function() {
                        return DCGView.createElement(activity_collection_tags_1.ActivityCollectionTags, {
                            activityId: _this.props.id,
                            resources: _this.props.resources
                        })
                    }))
                }
            }), DCGView.createElement(If, {
                predicate: function() {
                    return _this.showDescription()
                }
            }, function() {
                return DCGView.createElement("div", {
                    class: DCGView.const("activity-card-description")
                }, DCGView.createElement(mixed_text_display_1.MixedTextDisplay, {
                    content: function() {
                        return _this.description()
                    }
                }))
            })))), DCGView.createElement("div", {
                class: DCGView.const("activity-card-actions-container")
            }, DCGView.createElement("div", {
                class: DCGView.const("bookmark-container activity-main-action-container")
            }, DCGView.createElement(If, {
                predicate: function() {
                    return _this.showCollectionOptions()
                }
            }, function() {
                return DCGView.createElement(add_to_collection_1.ActivityCollectionOptions, {
                    resources: _this.props.resources,
                    activityId: _this.props.id,
                    activityUrl: function() {
                        return _this.props.activity().infoURL
                    },
                    isCollectionAuthor: _this.props.isCollectionAuthor,
                    collectionIds: _this.props.collectionIds
                })
            })), DCGView.createElement(If, {
                predicate: function() {
                    return !_this.privateByOtherUser() && !_this.hasParentCollections()
                }
            }, function() {
                return DCGView.createElement("div", {
                    class: DCGView.const("actions-menu-container")
                }, DCGView.createElement(actions_menu_1.ActionsMenu, {
                    onALP: _this.const(false),
                    activity: function() {
                        return _this.props.activity()
                    },
                    alpResources: _this.props.resources,
                    showDuplicate: _this.const([]),
                    parentCollectionIds: function() {
                        return _this.hasParentCollections() ? _this.props.collectionIds() : []
                    }
                }))
            })))
        }
        ;
        LoadedActivityCard.prototype.hasParentCollections = function() {
            return this.props.collectionIds && this.props.collectionIds().length
        }
        ;
        LoadedActivityCard.prototype.isInBookCollection = function() {
            if (!this.props.collectionIds || !this.props.resources().user.hasCurriculumCollections()) {
                return false
            }
            return helpers_1.hasBookParentCollection(this.props.resources().getCollectionStore(), this.props.collectionIds())
        }
        ;
        LoadedActivityCard.prototype.showDescription = function() {
            return !this.props.shortStyling() && !this.privateByOtherUser() && !this.isInBookCollection()
        }
        ;
        LoadedActivityCard.prototype.getHref = function() {
            var parentIds = this.props.collectionIds && this.props.collectionIds();
            if (parentIds && parentIds.length) {
                return "/" + this.props.activity().infoURL + "?collections=" + parentIds.join(",")
            }
            return "/" + this.props.activity().infoURL
        }
        ;
        LoadedActivityCard.prototype.showCollectionOptions = function() {
            if (this.isInBookCollection()) {
                return false
            }
            if (this.props.isCollectionAuthor && this.props.isCollectionAuthor()) {
                return false
            }
            return !this.privateByOtherUser()
        }
        ;
        LoadedActivityCard.prototype.description = function() {
            var exclusiveTag = activity_store_1.partnerExclusive(this.props.activity(), this.props.resources().user);
            if (!!exclusiveTag && exclusiveTag === "CPM") {
                return this.props.activity().description
            }
            return this.props.activity().description.split(/\n/gm)[0]
        }
        ;
        LoadedActivityCard.prototype.didMountCard = function(node) {
            $(node).on("dragstart", function(evt) {
                evt.originalEvent.dataTransfer.clearData("text/html")
            })
        }
        ;
        LoadedActivityCard.prototype.hasAuthorTag = function() {
            return this.isCPMAuthor() || this.isDesmos() || this.isAuthor()
        }
        ;
        LoadedActivityCard.prototype.isCPMAuthor = function() {
            return this.props.activity().authorTags.indexOf("cpm") > -1
        }
        ;
        LoadedActivityCard.prototype.privateByOtherUser = function() {
            return this.props.activity().private && !this.isOwner()
        }
        ;
        LoadedActivityCard.prototype.timeEstimateText = function() {
            var _this = this;
            var estimate = _.find(activity_time_estimates_1.estimateChoices, function(t) {
                return t.key === _this.props.activity().timeEstimate
            });
            return estimate != null ? estimate.text() : undefined
        }
        ;
        LoadedActivityCard.prototype.categoryText = function() {
            var _this = this;
            var category = _.find(activity_categories_1.categoryChoices, function(t) {
                return t.key === _this.props.activity().category
            });
            return category != null ? category.text() : undefined
        }
        ;
        LoadedActivityCard.prototype.displayAuthorName = function() {
            var author = collaborationHelpers.getAuthor(this.props.activity());
            return author && author.displayName
        }
        ;
        LoadedActivityCard.prototype.isDesmos = function() {
            return collaborationHelpers.isByDesmos(this.props.activity())
        }
        ;
        LoadedActivityCard.prototype.isAuthor = function() {
            var author = collaborationHelpers.getAuthor(this.props.activity());
            var user = this.props.resources().user;
            return user && author && user.id && author.id && user.id == author.id
        }
        ;
        LoadedActivityCard.prototype.isOwner = function() {
            return this.props.resources().user.owns(this.props.activity())
        }
        ;
        LoadedActivityCard.prototype.tagClass = function() {
            if (this.isAuthor()) {
                return "by-you"
            } else if (this.isOwner()) {
                return "edited-by-you"
            } else {
                return undefined
            }
        }
        ;
        LoadedActivityCard.prototype.tagText = function() {
            var type = this.tagClass();
            switch (type) {
                case "by-you":
                    return i18n.s("teacher-label-created-by-you");
                case "edited-by-you":
                    return i18n.s("teacher-label-edited-by-you")
            }
            return undefined
        }
        ;
        return LoadedActivityCard
    }(DCGView.Class);
    var ActivityCard = function(_super) {
        tslib_1.__extends(ActivityCard, _super);
        function ActivityCard() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ActivityCard.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(Switch, {
                key: function() {
                    return _this.activityRequest().status
                }
            }, function() {
                var request = _this.activityRequest();
                switch (request.status) {
                    case "loaded":
                        return DCGView.createElement(LoadedActivityCard, {
                            resources: _this.props.resources,
                            id: _this.props.normalizedActivityId,
                            shortStyling: function() {
                                return !!_this.props.shortStyling && _this.props.shortStyling()
                            },
                            activity: function() {
                                return request.response
                            },
                            collectionIds: _this.props.collectionIds,
                            isCollectionAuthor: _this.props.isCollectionAuthor || _this.const(false)
                        });
                    case "loading":
                        return DCGView.createElement("div", {
                            class: function() {
                                return {
                                    "activity-card-placeholder": true,
                                    "short-placeholder": _this.props.shortStyling && _this.props.shortStyling()
                                }
                            }
                        });
                    case "error":
                        return DCGView.createElement("div", {
                            class: DCGView.const("error")
                        }, function() {
                            return i18n.raw(request.err)
                        })
                }
            })
        }
        ;
        ActivityCard.prototype.activityRequest = function() {
            return this.props.resources().getActivityStore().requestByNormalizedId(this.props.normalizedActivityId())
        }
        ;
        return ActivityCard
    }(DCGView.Class);
    exports.ActivityCard = ActivityCard;
    var BookActivityCardContent = function(_super) {
        tslib_1.__extends(BookActivityCardContent, _super);
        function BookActivityCardContent() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        BookActivityCardContent.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                class: DCGView.const("book-activity-content")
            }, DCGView.createElement(mixed_text_display_1.MixedTextDisplay, {
                content: function() {
                    return _this.getSubtitleString()
                }
            }))
        }
        ;
        BookActivityCardContent.prototype.getSubtitleString = function() {
            var lessonNumber = this.props.activity().lessonNumber;
            var subtitle = this.props.activity().subtitle;
            if (!!lessonNumber && !!subtitle) {
                return "Lesson " + lessonNumber + ": " + subtitle
            } else if (!!lessonNumber) {
                return "Lesson " + lessonNumber
            } else {
                return subtitle || ""
            }
        }
        ;
        return BookActivityCardContent
    }(DCGView.Class)
});
define("alignment-tools", ["require", "exports"], function(require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.getActivityIdFromURL = function(url) {
        if (url.indexOf("?") > -1) {
            url = url.slice(0, url.lastIndexOf("?"))
        }
        var activity = url.split("/")[3];
        if (activity == "activitybuilder") {
            var id = url.split("/")[5];
            return "custom:" + id
        } else if (activity == "polygraph") {
            var id = url.split("/")[5];
            return "custom:" + id
        } else {
            return "desmos:" + activity
        }
    }
    ;
    exports.extractIdsFromDoc = function(doc) {
        var ids = [];
        doc.content.forEach(function(node) {
            if (node.type == "activity" && node.content && node.content[0] && node.content[0].type == "text") {
                ids.push(exports.getActivityIdFromURL(node.content[0].text))
            }
        });
        return ids
    }
});
define("loadcss!activitybuilder/components/shared/prosemirror/activity-node", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/activitybuilder/components/shared/prosemirror/activity-node.css", decodeURIComponent(".activity-card-node%20%7B%0A%20%20position%3A%20relative%3B%0A%20%20-webkit-user-select%3A%20all%3B%0A%20%20-moz-user-select%3A%20all%3B%0A%20%20-ms-user-select%3A%20all%3B%0A%20%20user-select%3A%20all%3B%0A%20%20margin%3A%2010px%200%3B%0A%7D%0A.activity-card-node%20.activity-card-large%20%7B%0A%20%20-webkit-user-select%3A%20none%3B%0A%20%20-moz-user-select%3A%20none%3B%0A%20%20-ms-user-select%3A%20none%3B%0A%20%20user-select%3A%20none%3B%0A%7D%0A.activity-card-node%20.dcg-mq-bg%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%200%3B%0A%20%20left%3A%200%3B%0A%20%20bottom%3A%200%3B%0A%20%20right%3A%200%3B%0A%20%20width%3A%20100%25%3B%0A%20%20height%3A%20calc(100%25%20-%2015px)%3B%0A%20%20pointer-events%3A%20none%3B%0A%20%20-webkit-user-select%3A%20all%3B%0A%20%20-moz-user-select%3A%20all%3B%0A%20%20-ms-user-select%3A%20all%3B%0A%20%20user-select%3A%20all%3B%0A%7D%0A.activity-card-node.ProseMirror-selectednode%20%7B%0A%20%20outline%3A%200%3B%0A%20%20border%3A%200%3B%0A%7D%0A.dcg-prosemirror-editor%3Anot(.dcg-read-only)%20.activity-card-node%20%7B%0A%20%20cursor%3A%20move%3B%0A%7D%0A.dcg-prosemirror-editor%3Anot(.dcg-read-only)%20.activity-card-node.ProseMirror-selectednode%20.activity-card-large%20%7B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%7D%0A.dcg-prosemirror-editor%3Anot(.dcg-read-only)%20.activity-card-node%20.card-background%20%7B%0A%20%20pointer-events%3A%20none%3B%0A%7D%0A"))
});
define("activitybuilder/components/shared/prosemirror/activity-node", ["require", "exports", "tslib", "dcgview", "touchtracking", "jquery", "teacher-spa/activity-card", "alignment-tools", "loadcss!./activity-node"], function(require, exports, tslib_1, DCGView, touchtracking, $, activity_card_1, alignment_tools_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.activitySpec = {
        group: "block",
        content: "text*",
        draggable: true,
        isolating: true,
        marks: "",
        atom: true,
        toDOM: function(node) {
            return ["p", node.textContent]
        }
    };
    exports.bindResourcesToNodeView = function(resources) {
        return function(node, view, getPos) {
            return new ActivityNodeView(node,view,getPos,resources)
        }
    }
    ;
    var ActivityNodeView = function() {
        function ActivityNodeView(node, view, getPos, resources) {
            var _this = this;
            this.node = node;
            this.view = view;
            this.getPos = getPos;
            this.resources = resources;
            this.dom = $('<div class="activity-card-node">').get(0);
            $(this.dom).appendTo(document.body);
            var activityId = alignment_tools_1.getActivityIdFromURL(node.textContent);
            var idProp = function() {
                return activityId
            };
            var resourcesProp = function() {
                return _this.resources
            };
            var BoundCard = function(_super) {
                tslib_1.__extends(BoundCard, _super);
                function BoundCard() {
                    return _super !== null && _super.apply(this, arguments) || this
                }
                BoundCard.prototype.template = function() {
                    return DCGView.createElement(activity_card_1.ActivityCard, {
                        normalizedActivityId: idProp,
                        resources: resourcesProp
                    })
                }
                ;
                return BoundCard
            }(DCGView.Class);
            var dcgView = DCGView.mountToNode(BoundCard, this.dom, undefined);
            this.viewToken = this.resources.dispatcher.pushView(dcgView);
            touchtracking.monitor(this.dom);
            var img = $('<img class="dcg-mq-bg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAAAtJREFUCB1jYAACAAAFAAGNu5vzAAAAAElFTkSuQmCC">').get(0);
            $(img).appendTo(this.dom)
        }
        ActivityNodeView.prototype.destroy = function() {
            this.resources.dispatcher.removeView(this.viewToken)
        }
        ;
        ActivityNodeView.prototype.stopEvent = function() {
            return !!(this.view.props.editable && !this.view.props.editable(this.view.state))
        }
        ;
        return ActivityNodeView
    }()
});
define("activitybuilder/components/shared/prosemirror/alignment-schema", ["require", "exports", "tslib", "orderedmap", "prosemirror-model", "prosemirror-schema-list", "core/prosemirror/mq-schema", "./activity-node", "prosemirror-schema-basic", "core/prosemirror/link-mark-spec"], function(require, exports, tslib_1, OrderedMap, prosemirror_model_1, prosemirror_schema_list_1, mq_schema_1, activity_node_1, prosemirror_schema_basic_1, link_mark_spec_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.titleSpec = {
        group: "block",
        content: "text*",
        toDOM: function(node) {
            return node.textContent
        }
    };
    exports.alignmentSchema = new prosemirror_model_1.Schema({
        nodes: prosemirror_schema_list_1.addListNodes(OrderedMap.from({
            doc: prosemirror_schema_basic_1.nodes.doc,
            paragraph: prosemirror_schema_basic_1.nodes.paragraph,
            text: prosemirror_schema_basic_1.nodes.text,
            title: exports.titleSpec,
            heading: tslib_1.__assign(tslib_1.__assign({}, prosemirror_schema_basic_1.nodes.heading), {
                marks: "",
                content: "text*"
            }),
            mq: mq_schema_1.mqSpec,
            activity: activity_node_1.activitySpec
        }), "paragraph block*", "block"),
        marks: OrderedMap.from({
            link: link_mark_spec_1.link,
            em: prosemirror_schema_basic_1.marks.em,
            strong: prosemirror_schema_basic_1.marks.strong,
            medium: {
                toDOM: function() {
                    return ["medium"]
                },
                parseDOM: [{
                    tag: "medium"
                }],
                excludes: "large"
            },
            large: {
                toDOM: function() {
                    return ["large"]
                },
                parseDOM: [{
                    tag: "large"
                }],
                excludes: "medium"
            }
        })
    })
});
define("prosemirror-gapcursor/index", ["require", "exports", "module", "prosemirror-keymap", "prosemirror-state", "prosemirror-view", "prosemirror-model"], function(require, exports, module) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var prosemirrorKeymap = require("prosemirror-keymap");
    var prosemirrorState = require("prosemirror-state");
    var prosemirrorView = require("prosemirror-view");
    var prosemirrorModel = require("prosemirror-model");
    var GapCursor = function(Selection) {
        function GapCursor($pos) {
            Selection.call(this, $pos, $pos)
        }
        if (Selection)
            GapCursor.__proto__ = Selection;
        GapCursor.prototype = Object.create(Selection && Selection.prototype);
        GapCursor.prototype.constructor = GapCursor;
        GapCursor.prototype.map = function map(doc, mapping) {
            var $pos = doc.resolve(mapping.map(this.head));
            return GapCursor.valid($pos) ? new GapCursor($pos) : Selection.near($pos)
        }
        ;
        GapCursor.prototype.content = function content() {
            return prosemirrorModel.Slice.empty
        }
        ;
        GapCursor.prototype.eq = function eq(other) {
            return other instanceof GapCursor && other.head == this.head
        }
        ;
        GapCursor.prototype.toJSON = function toJSON() {
            return {
                type: "gapcursor",
                pos: this.head
            }
        }
        ;
        GapCursor.fromJSON = function fromJSON(doc, json) {
            if (typeof json.pos != "number") {
                throw new RangeError("Invalid input for GapCursor.fromJSON")
            }
            return new GapCursor(doc.resolve(json.pos))
        }
        ;
        GapCursor.prototype.getBookmark = function getBookmark() {
            return new GapBookmark(this.anchor)
        }
        ;
        GapCursor.valid = function valid($pos) {
            var parent = $pos.parent;
            if (parent.isTextblock || !closedBefore($pos) || !closedAfter($pos)) {
                return false
            }
            var override = parent.type.spec.allowGapCursor;
            if (override != null) {
                return override
            }
            var deflt = parent.contentMatchAt($pos.index()).defaultType;
            return deflt && deflt.isTextblock
        }
        ;
        GapCursor.findFrom = function findFrom($pos, dir, mustMove) {
            search: for (; ; ) {
                if (!mustMove && GapCursor.valid($pos)) {
                    return $pos
                }
                var pos = $pos.pos
                    , next = null;
                for (var d = $pos.depth; ; d--) {
                    var parent = $pos.node(d);
                    if (dir > 0 ? $pos.indexAfter(d) < parent.childCount : $pos.index(d) > 0) {
                        next = parent.child(dir > 0 ? $pos.indexAfter(d) : $pos.index(d) - 1);
                        break
                    } else if (d == 0) {
                        return null
                    }
                    pos += dir;
                    var $cur = $pos.doc.resolve(pos);
                    if (GapCursor.valid($cur)) {
                        return $cur
                    }
                }
                for (; ; ) {
                    var inside = dir > 0 ? next.firstChild : next.lastChild;
                    if (!inside) {
                        if (next.isAtom && !next.isText && !prosemirrorState.NodeSelection.isSelectable(next)) {
                            $pos = $pos.doc.resolve(pos + next.nodeSize * dir);
                            mustMove = false;
                            continue search
                        }
                        break
                    }
                    next = inside;
                    pos += dir;
                    var $cur$1 = $pos.doc.resolve(pos);
                    if (GapCursor.valid($cur$1)) {
                        return $cur$1
                    }
                }
                return null
            }
        }
        ;
        return GapCursor
    }(prosemirrorState.Selection);
    GapCursor.prototype.visible = false;
    prosemirrorState.Selection.jsonID("gapcursor", GapCursor);
    var GapBookmark = function GapBookmark(pos) {
        this.pos = pos
    };
    GapBookmark.prototype.map = function map(mapping) {
        return new GapBookmark(mapping.map(this.pos))
    }
    ;
    GapBookmark.prototype.resolve = function resolve(doc) {
        var $pos = doc.resolve(this.pos);
        return GapCursor.valid($pos) ? new GapCursor($pos) : prosemirrorState.Selection.near($pos)
    }
    ;
    function closedBefore($pos) {
        for (var d = $pos.depth; d >= 0; d--) {
            var index = $pos.index(d);
            if (index == 0) {
                continue
            }
            for (var before = $pos.node(d).child(index - 1); ; before = before.lastChild) {
                if (before.childCount == 0 && !before.inlineContent || before.isAtom || before.type.spec.isolating) {
                    return true
                }
                if (before.inlineContent) {
                    return false
                }
            }
        }
        return true
    }
    function closedAfter($pos) {
        for (var d = $pos.depth; d >= 0; d--) {
            var index = $pos.indexAfter(d)
                , parent = $pos.node(d);
            if (index == parent.childCount) {
                continue
            }
            for (var after = parent.child(index); ; after = after.firstChild) {
                if (after.childCount == 0 && !after.inlineContent || after.isAtom || after.type.spec.isolating) {
                    return true
                }
                if (after.inlineContent) {
                    return false
                }
            }
        }
        return true
    }
    var gapCursor = function() {
        return new prosemirrorState.Plugin({
            props: {
                decorations: drawGapCursor,
                createSelectionBetween: function createSelectionBetween(_view, $anchor, $head) {
                    if ($anchor.pos == $head.pos && GapCursor.valid($head)) {
                        return new GapCursor($head)
                    }
                },
                handleClick: handleClick,
                handleKeyDown: handleKeyDown
            }
        })
    };
    var handleKeyDown = prosemirrorKeymap.keydownHandler({
        ArrowLeft: arrow("horiz", -1),
        ArrowRight: arrow("horiz", 1),
        ArrowUp: arrow("vert", -1),
        ArrowDown: arrow("vert", 1)
    });
    function arrow(axis, dir) {
        var dirStr = axis == "vert" ? dir > 0 ? "down" : "up" : dir > 0 ? "right" : "left";
        return function(state, dispatch, view) {
            var sel = state.selection;
            var $start = dir > 0 ? sel.$to : sel.$from
                , mustMove = sel.empty;
            if (sel instanceof prosemirrorState.TextSelection) {
                if (!view.endOfTextblock(dirStr) || $start.depth == 0) {
                    return false
                }
                mustMove = false;
                $start = state.doc.resolve(dir > 0 ? $start.after() : $start.before())
            }
            var $found = GapCursor.findFrom($start, dir, mustMove);
            if (!$found) {
                return false
            }
            if (dispatch) {
                dispatch(state.tr.setSelection(new GapCursor($found)))
            }
            return true
        }
    }
    function handleClick(view, pos, event) {
        if (!view.editable) {
            return false
        }
        var $pos = view.state.doc.resolve(pos);
        if (!GapCursor.valid($pos)) {
            return false
        }
        var ref = view.posAtCoords({
            left: event.clientX,
            top: event.clientY
        });
        var inside = ref.inside;
        if (inside > -1 && prosemirrorState.NodeSelection.isSelectable(view.state.doc.nodeAt(inside))) {
            return false
        }
        view.dispatch(view.state.tr.setSelection(new GapCursor($pos)));
        return true
    }
    function drawGapCursor(state) {
        if (!(state.selection instanceof GapCursor)) {
            return null
        }
        var node = document.createElement("div");
        node.className = "ProseMirror-gapcursor";
        return prosemirrorView.DecorationSet.create(state.doc, [prosemirrorView.Decoration.widget(state.selection.head, node, {
            key: "gapcursor"
        })])
    }
    exports.GapCursor = GapCursor;
    exports.gapCursor = gapCursor
});
define("prosemirror-gapcursor", ["prosemirror-gapcursor/index"], function(main) {
    return main
});
(function(definition) {
        "use strict";
        if (typeof bootstrap === "function") {
            bootstrap("promise", definition)
        } else if (typeof exports === "object" && typeof module === "object") {
            module.exports = definition()
        } else if (typeof define === "function" && define.amd) {
            define("q", definition)
        } else if (typeof ses !== "undefined") {
            if (!ses.ok()) {
                return
            } else {
                ses.makeQ = definition
            }
        } else if (typeof window !== "undefined" || typeof self !== "undefined") {
            var global = typeof window !== "undefined" ? window : self;
            var previousQ = global.Q;
            global.Q = definition();
            global.Q.noConflict = function() {
                global.Q = previousQ;
                return this
            }
        } else {
            throw new Error("This environment was not anticipated by Q. Please file a bug.")
        }
    }
)(function() {
    "use strict";
    var hasStacks = false;
    try {
        throw new Error
    } catch (e) {
        hasStacks = !!e.stack
    }
    var qStartingLine = captureLine();
    var qFileName;
    var noop = function() {};
    var nextTick = function() {
        var head = {
            task: void 0,
            next: null
        };
        var tail = head;
        var flushing = false;
        var requestTick = void 0;
        var isNodeJS = false;
        var laterQueue = [];
        function flush() {
            var task, domain;
            while (head.next) {
                head = head.next;
                task = head.task;
                head.task = void 0;
                domain = head.domain;
                if (domain) {
                    head.domain = void 0;
                    domain.enter()
                }
                runSingle(task, domain)
            }
            while (laterQueue.length) {
                task = laterQueue.pop();
                runSingle(task)
            }
            flushing = false
        }
        function runSingle(task, domain) {
            try {
                task()
            } catch (e) {
                if (isNodeJS) {
                    if (domain) {
                        domain.exit()
                    }
                    setTimeout(flush, 0);
                    if (domain) {
                        domain.enter()
                    }
                    throw e
                } else {
                    setTimeout(function() {
                        throw e
                    }, 0)
                }
            }
            if (domain) {
                domain.exit()
            }
        }
        nextTick = function(task) {
            tail = tail.next = {
                task: task,
                domain: isNodeJS && process.domain,
                next: null
            };
            if (!flushing) {
                flushing = true;
                requestTick()
            }
        }
        ;
        if (typeof process === "object" && process.toString() === "[object process]" && process.nextTick) {
            isNodeJS = true;
            requestTick = function() {
                process.nextTick(flush)
            }
        } else if (typeof setImmediate === "function") {
            if (typeof window !== "undefined") {
                requestTick = setImmediate.bind(window, flush)
            } else {
                requestTick = function() {
                    setImmediate(flush)
                }
            }
        } else if (typeof MessageChannel !== "undefined" && !window.DisableQMessageChannelForTests) {
            var channel = new MessageChannel;
            channel.port1.onmessage = function() {
                requestTick = requestPortTick;
                channel.port1.onmessage = flush;
                flush()
            }
            ;
            var requestPortTick = function() {
                channel.port2.postMessage(0)
            };
            requestTick = function() {
                setTimeout(flush, 0);
                requestPortTick()
            }
        } else {
            requestTick = function() {
                setTimeout(flush, 0)
            }
        }
        nextTick.runAfter = function(task) {
            laterQueue.push(task);
            if (!flushing) {
                flushing = true;
                requestTick()
            }
        }
        ;
        return nextTick
    }();
    var call = Function.call;
    function uncurryThis(f) {
        return function() {
            return call.apply(f, arguments)
        }
    }
    var array_slice = uncurryThis(Array.prototype.slice);
    var array_reduce = uncurryThis(Array.prototype.reduce || function(callback, basis) {
        var index = 0
            , length = this.length;
        if (arguments.length === 1) {
            do {
                if (index in this) {
                    basis = this[index++];
                    break
                }
                if (++index >= length) {
                    throw new TypeError
                }
            } while (1)
        }
        for (; index < length; index++) {
            if (index in this) {
                basis = callback(basis, this[index], index)
            }
        }
        return basis
    }
    );
    var array_indexOf = uncurryThis(Array.prototype.indexOf || function(value) {
        for (var i = 0; i < this.length; i++) {
            if (this[i] === value) {
                return i
            }
        }
        return -1
    }
    );
    var array_map = uncurryThis(Array.prototype.map || function(callback, thisp) {
        var self = this;
        var collect = [];
        array_reduce(self, function(undefined, value, index) {
            collect.push(callback.call(thisp, value, index, self))
        }, void 0);
        return collect
    }
    );
    var object_create = Object.create || function(prototype) {
            function Type() {}
            Type.prototype = prototype;
            return new Type
        }
    ;
    var object_hasOwnProperty = uncurryThis(Object.prototype.hasOwnProperty);
    var object_keys = Object.keys || function(object) {
            var keys = [];
            for (var key in object) {
                if (object_hasOwnProperty(object, key)) {
                    keys.push(key)
                }
            }
            return keys
        }
    ;
    var object_toString = uncurryThis(Object.prototype.toString);
    function isObject(value) {
        return value === Object(value)
    }
    function isStopIteration(exception) {
        return object_toString(exception) === "[object StopIteration]" || exception instanceof QReturnValue
    }
    var QReturnValue;
    if (typeof ReturnValue !== "undefined") {
        QReturnValue = ReturnValue
    } else {
        QReturnValue = function(value) {
            this.value = value
        }
    }
    var STACK_JUMP_SEPARATOR = "From previous event:";
    function makeStackTraceLong(error, promise) {
        if (hasStacks && promise.stack && typeof error === "object" && error !== null && error.stack && error.stack.indexOf(STACK_JUMP_SEPARATOR) === -1) {
            var stacks = [];
            for (var p = promise; !!p; p = p.source) {
                if (p.stack) {
                    stacks.unshift(p.stack)
                }
            }
            stacks.unshift(error.stack);
            var concatedStacks = stacks.join("\n" + STACK_JUMP_SEPARATOR + "\n");
            error.stack = filterStackString(concatedStacks)
        }
    }
    function filterStackString(stackString) {
        var lines = stackString.split("\n");
        var desiredLines = [];
        for (var i = 0; i < lines.length; ++i) {
            var line = lines[i];
            if (!isInternalFrame(line) && !isNodeFrame(line) && line) {
                desiredLines.push(line)
            }
        }
        return desiredLines.join("\n")
    }
    function isNodeFrame(stackLine) {
        return stackLine.indexOf("(module.js:") !== -1 || stackLine.indexOf("(node.js:") !== -1
    }
    function getFileNameAndLineNumber(stackLine) {
        var attempt1 = /at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);
        if (attempt1) {
            return [attempt1[1], Number(attempt1[2])]
        }
        var attempt2 = /at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);
        if (attempt2) {
            return [attempt2[1], Number(attempt2[2])]
        }
        var attempt3 = /.*@(.+):(\d+)$/.exec(stackLine);
        if (attempt3) {
            return [attempt3[1], Number(attempt3[2])]
        }
    }
    function isInternalFrame(stackLine) {
        var fileNameAndLineNumber = getFileNameAndLineNumber(stackLine);
        if (!fileNameAndLineNumber) {
            return false
        }
        var fileName = fileNameAndLineNumber[0];
        var lineNumber = fileNameAndLineNumber[1];
        return fileName === qFileName && lineNumber >= qStartingLine && lineNumber <= qEndingLine
    }
    function captureLine() {
        if (!hasStacks) {
            return
        }
        try {
            throw new Error
        } catch (e) {
            var lines = e.stack.split("\n");
            var firstLine = lines[0].indexOf("@") > 0 ? lines[1] : lines[2];
            var fileNameAndLineNumber = getFileNameAndLineNumber(firstLine);
            if (!fileNameAndLineNumber) {
                return
            }
            qFileName = fileNameAndLineNumber[0];
            return fileNameAndLineNumber[1]
        }
    }
    function deprecate(callback, name, alternative) {
        return function() {
            if (typeof console !== "undefined" && typeof console.warn === "function") {
                console.warn(name + " is deprecated, use " + alternative + " instead.", new Error("").stack)
            }
            return callback.apply(callback, arguments)
        }
    }
    function Q(value) {
        if (value instanceof Promise) {
            return value
        }
        if (isPromiseAlike(value)) {
            return coerce(value)
        } else {
            return fulfill(value)
        }
    }
    Q.resolve = Q;
    Q.nextTick = nextTick;
    Q.longStackSupport = true;
    if (typeof process === "object" && process && process.env && process.env.Q_DEBUG) {
        Q.longStackSupport = true
    }
    Q.defer = defer;
    function defer() {
        var messages = [], progressListeners = [], resolvedPromise;
        var deferred = object_create(defer.prototype);
        var promise = object_create(Promise.prototype);
        promise.promiseDispatch = function(resolve, op, operands) {
            var args = array_slice(arguments);
            if (messages) {
                messages.push(args);
                if (op === "when" && operands[1]) {
                    progressListeners.push(operands[1])
                }
            } else {
                Q.nextTick(function() {
                    resolvedPromise.promiseDispatch.apply(resolvedPromise, args)
                })
            }
        }
        ;
        promise.valueOf = function() {
            if (messages) {
                return promise
            }
            var nearerValue = nearer(resolvedPromise);
            if (isPromise(nearerValue)) {
                resolvedPromise = nearerValue
            }
            return nearerValue
        }
        ;
        promise.inspect = function() {
            if (!resolvedPromise) {
                return {
                    state: "pending"
                }
            }
            return resolvedPromise.inspect()
        }
        ;
        if (Q.longStackSupport && hasStacks) {
            try {
                throw new Error
            } catch (e) {
                promise.stack = e.stack.substring(e.stack.indexOf("\n") + 1)
            }
        }
        function become(newPromise) {
            resolvedPromise = newPromise;
            promise.source = newPromise;
            array_reduce(messages, function(undefined, message) {
                Q.nextTick(function() {
                    newPromise.promiseDispatch.apply(newPromise, message)
                })
            }, void 0);
            messages = void 0;
            progressListeners = void 0
        }
        deferred.promise = promise;
        deferred.resolve = function(value) {
            if (resolvedPromise) {
                return
            }
            become(Q(value))
        }
        ;
        deferred.fulfill = function(value) {
            if (resolvedPromise) {
                return
            }
            become(fulfill(value))
        }
        ;
        deferred.reject = function(reason) {
            if (resolvedPromise) {
                return
            }
            become(reject(reason))
        }
        ;
        deferred.notify = function(progress) {
            if (resolvedPromise) {
                return
            }
            array_reduce(progressListeners, function(undefined, progressListener) {
                Q.nextTick(function() {
                    progressListener(progress)
                })
            }, void 0)
        }
        ;
        return deferred
    }
    defer.prototype.makeNodeResolver = function() {
        var self = this;
        return function(error, value) {
            if (error) {
                self.reject(error)
            } else if (arguments.length > 2) {
                self.resolve(array_slice(arguments, 1))
            } else {
                self.resolve(value)
            }
        }
    }
    ;
    Q.Promise = promise;
    Q.promise = promise;
    function promise(resolver) {
        if (typeof resolver !== "function") {
            throw new TypeError("resolver must be a function.")
        }
        var deferred = defer();
        try {
            resolver(deferred.resolve, deferred.reject, deferred.notify)
        } catch (reason) {
            deferred.reject(reason)
        }
        return deferred.promise
    }
    promise.race = race;
    promise.all = all;
    promise.reject = reject;
    promise.resolve = Q;
    Q.passByCopy = function(object) {
        return object
    }
    ;
    Promise.prototype.passByCopy = function() {
        return this
    }
    ;
    Q.join = function(x, y) {
        return Q(x).join(y)
    }
    ;
    Promise.prototype.join = function(that) {
        return Q([this, that]).spread(function(x, y) {
            if (x === y) {
                return x
            } else {
                throw new Error("Q can't join: not the same: " + x + " " + y)
            }
        })
    }
    ;
    Q.race = race;
    function race(answerPs) {
        return promise(function(resolve, reject) {
            for (var i = 0, len = answerPs.length; i < len; i++) {
                Q(answerPs[i]).then(resolve, reject)
            }
        })
    }
    Promise.prototype.race = function() {
        return this.then(Q.race)
    }
    ;
    Q.makePromise = Promise;
    function Promise(descriptor, fallback, inspect) {
        if (fallback === void 0) {
            fallback = function(op) {
                return reject(new Error("Promise does not support operation: " + op))
            }
        }
        if (inspect === void 0) {
            inspect = function() {
                return {
                    state: "unknown"
                }
            }
        }
        var promise = object_create(Promise.prototype);
        promise.promiseDispatch = function(resolve, op, args) {
            var result;
            try {
                if (descriptor[op]) {
                    result = descriptor[op].apply(promise, args)
                } else {
                    result = fallback.call(promise, op, args)
                }
            } catch (exception) {
                result = reject(exception)
            }
            if (resolve) {
                resolve(result)
            }
        }
        ;
        promise.inspect = inspect;
        if (inspect) {
            var inspected = inspect();
            if (inspected.state === "rejected") {
                promise.exception = inspected.reason
            }
            promise.valueOf = function() {
                var inspected = inspect();
                if (inspected.state === "pending" || inspected.state === "rejected") {
                    return promise
                }
                return inspected.value
            }
        }
        return promise
    }
    Promise.prototype.toString = function() {
        return "[object Promise]"
    }
    ;
    Promise.prototype.then = function(fulfilled, rejected, progressed) {
        var self = this;
        var deferred = defer();
        var done = false;
        function _fulfilled(value) {
            try {
                return typeof fulfilled === "function" ? fulfilled(value) : value
            } catch (exception) {
                return reject(exception)
            }
        }
        function _rejected(exception) {
            if (typeof rejected === "function") {
                makeStackTraceLong(exception, self);
                try {
                    return rejected(exception)
                } catch (newException) {
                    return reject(newException)
                }
            }
            return reject(exception)
        }
        function _progressed(value) {
            return typeof progressed === "function" ? progressed(value) : value
        }
        Q.nextTick(function() {
            self.promiseDispatch(function(value) {
                if (done) {
                    return
                }
                done = true;
                deferred.resolve(_fulfilled(value))
            }, "when", [function(exception) {
                if (done) {
                    return
                }
                done = true;
                deferred.resolve(_rejected(exception))
            }
            ])
        });
        self.promiseDispatch(void 0, "when", [void 0, function(value) {
            var newValue;
            var threw = false;
            try {
                newValue = _progressed(value)
            } catch (e) {
                threw = true;
                if (Q.onerror) {
                    Q.onerror(e)
                } else {
                    throw e
                }
            }
            if (!threw) {
                deferred.notify(newValue)
            }
        }
        ]);
        return deferred.promise
    }
    ;
    Q.tap = function(promise, callback) {
        return Q(promise).tap(callback)
    }
    ;
    Promise.prototype.tap = function(callback) {
        callback = Q(callback);
        return this.then(function(value) {
            return callback.fcall(value).thenResolve(value)
        })
    }
    ;
    Q.when = when;
    function when(value, fulfilled, rejected, progressed) {
        return Q(value).then(fulfilled, rejected, progressed)
    }
    Promise.prototype.thenResolve = function(value) {
        return this.then(function() {
            return value
        })
    }
    ;
    Q.thenResolve = function(promise, value) {
        return Q(promise).thenResolve(value)
    }
    ;
    Promise.prototype.thenReject = function(reason) {
        return this.then(function() {
            throw reason
        })
    }
    ;
    Q.thenReject = function(promise, reason) {
        return Q(promise).thenReject(reason)
    }
    ;
    Q.nearer = nearer;
    function nearer(value) {
        if (isPromise(value)) {
            var inspected = value.inspect();
            if (inspected.state === "fulfilled") {
                return inspected.value
            }
        }
        return value
    }
    Q.isPromise = isPromise;
    function isPromise(object) {
        return object instanceof Promise
    }
    Q.isPromiseAlike = isPromiseAlike;
    function isPromiseAlike(object) {
        return isObject(object) && typeof object.then === "function"
    }
    Q.isPending = isPending;
    function isPending(object) {
        return isPromise(object) && object.inspect().state === "pending"
    }
    Promise.prototype.isPending = function() {
        return this.inspect().state === "pending"
    }
    ;
    Q.isFulfilled = isFulfilled;
    function isFulfilled(object) {
        return !isPromise(object) || object.inspect().state === "fulfilled"
    }
    Promise.prototype.isFulfilled = function() {
        return this.inspect().state === "fulfilled"
    }
    ;
    Q.isRejected = isRejected;
    function isRejected(object) {
        return isPromise(object) && object.inspect().state === "rejected"
    }
    Promise.prototype.isRejected = function() {
        return this.inspect().state === "rejected"
    }
    ;
    var unhandledReasons = [];
    var unhandledRejections = [];
    var reportedUnhandledRejections = [];
    var trackUnhandledRejections = true;
    function resetUnhandledRejections() {
        unhandledReasons.length = 0;
        unhandledRejections.length = 0;
        if (!trackUnhandledRejections) {
            trackUnhandledRejections = true
        }
    }
    function trackRejection(promise, reason) {
        if (!trackUnhandledRejections) {
            return
        }
        if (typeof process === "object" && typeof process.emit === "function") {
            Q.nextTick.runAfter(function() {
                if (array_indexOf(unhandledRejections, promise) !== -1) {
                    process.emit("unhandledRejection", reason, promise);
                    reportedUnhandledRejections.push(promise)
                }
            })
        }
        unhandledRejections.push(promise);
        if (reason && typeof reason.stack !== "undefined") {
            unhandledReasons.push(reason.stack)
        } else {
            unhandledReasons.push("(no stack) " + reason)
        }
    }
    function untrackRejection(promise) {
        if (!trackUnhandledRejections) {
            return
        }
        var at = array_indexOf(unhandledRejections, promise);
        if (at !== -1) {
            if (typeof process === "object" && typeof process.emit === "function") {
                Q.nextTick.runAfter(function() {
                    var atReport = array_indexOf(reportedUnhandledRejections, promise);
                    if (atReport !== -1) {
                        process.emit("rejectionHandled", unhandledReasons[at], promise);
                        reportedUnhandledRejections.splice(atReport, 1)
                    }
                })
            }
            unhandledRejections.splice(at, 1);
            unhandledReasons.splice(at, 1)
        }
    }
    Q.resetUnhandledRejections = resetUnhandledRejections;
    Q.getUnhandledReasons = function() {
        return unhandledReasons.slice()
    }
    ;
    Q.stopUnhandledRejectionTracking = function() {
        resetUnhandledRejections();
        trackUnhandledRejections = false
    }
    ;
    resetUnhandledRejections();
    Q.reject = reject;
    function reject(reason) {
        var rejection = Promise({
            when: function(rejected) {
                if (rejected) {
                    untrackRejection(this)
                }
                return rejected ? rejected(reason) : this
            }
        }, function fallback() {
            return this
        }, function inspect() {
            return {
                state: "rejected",
                reason: reason
            }
        });
        trackRejection(rejection, reason);
        return rejection
    }
    Q.fulfill = fulfill;
    function fulfill(value) {
        return Promise({
            when: function() {
                return value
            },
            get: function(name) {
                return value[name]
            },
            set: function(name, rhs) {
                value[name] = rhs
            },
            delete: function(name) {
                delete value[name]
            },
            post: function(name, args) {
                if (name === null || name === void 0) {
                    return value.apply(void 0, args)
                } else {
                    return value[name].apply(value, args)
                }
            },
            apply: function(thisp, args) {
                return value.apply(thisp, args)
            },
            keys: function() {
                return object_keys(value)
            }
        }, void 0, function inspect() {
            return {
                state: "fulfilled",
                value: value
            }
        })
    }
    function coerce(promise) {
        var deferred = defer();
        Q.nextTick(function() {
            try {
                promise.then(deferred.resolve, deferred.reject, deferred.notify)
            } catch (exception) {
                deferred.reject(exception)
            }
        });
        return deferred.promise
    }
    Q.master = master;
    function master(object) {
        return Promise({
            isDef: function() {}
        }, function fallback(op, args) {
            return dispatch(object, op, args)
        }, function() {
            return Q(object).inspect()
        })
    }
    Q.spread = spread;
    function spread(value, fulfilled, rejected) {
        return Q(value).spread(fulfilled, rejected)
    }
    Promise.prototype.spread = function(fulfilled, rejected) {
        return this.all().then(function(array) {
            return fulfilled.apply(void 0, array)
        }, rejected)
    }
    ;
    Q.async = async;
    function async(makeGenerator) {
        return function() {
            function continuer(verb, arg) {
                var result;
                if (typeof StopIteration === "undefined") {
                    try {
                        result = generator[verb](arg)
                    } catch (exception) {
                        return reject(exception)
                    }
                    if (result.done) {
                        return Q(result.value)
                    } else {
                        return when(result.value, callback, errback)
                    }
                } else {
                    try {
                        result = generator[verb](arg)
                    } catch (exception) {
                        if (isStopIteration(exception)) {
                            return Q(exception.value)
                        } else {
                            return reject(exception)
                        }
                    }
                    return when(result, callback, errback)
                }
            }
            var generator = makeGenerator.apply(this, arguments);
            var callback = continuer.bind(continuer, "next");
            var errback = continuer.bind(continuer, "throw");
            return callback()
        }
    }
    Q.spawn = spawn;
    function spawn(makeGenerator) {
        Q.done(Q.async(makeGenerator)())
    }
    Q["return"] = _return;
    function _return(value) {
        throw new QReturnValue(value)
    }
    Q.promised = promised;
    function promised(callback) {
        return function() {
            return spread([this, all(arguments)], function(self, args) {
                return callback.apply(self, args)
            })
        }
    }
    Q.dispatch = dispatch;
    function dispatch(object, op, args) {
        return Q(object).dispatch(op, args)
    }
    Promise.prototype.dispatch = function(op, args) {
        var self = this;
        var deferred = defer();
        Q.nextTick(function() {
            self.promiseDispatch(deferred.resolve, op, args)
        });
        return deferred.promise
    }
    ;
    Q.get = function(object, key) {
        return Q(object).dispatch("get", [key])
    }
    ;
    Promise.prototype.get = function(key) {
        return this.dispatch("get", [key])
    }
    ;
    Q.set = function(object, key, value) {
        return Q(object).dispatch("set", [key, value])
    }
    ;
    Promise.prototype.set = function(key, value) {
        return this.dispatch("set", [key, value])
    }
    ;
    Q.del = Q["delete"] = function(object, key) {
        return Q(object).dispatch("delete", [key])
    }
    ;
    Promise.prototype.del = Promise.prototype["delete"] = function(key) {
        return this.dispatch("delete", [key])
    }
    ;
    Q.mapply = Q.post = function(object, name, args) {
        return Q(object).dispatch("post", [name, args])
    }
    ;
    Promise.prototype.mapply = Promise.prototype.post = function(name, args) {
        return this.dispatch("post", [name, args])
    }
    ;
    Q.send = Q.mcall = Q.invoke = function(object, name) {
        return Q(object).dispatch("post", [name, array_slice(arguments, 2)])
    }
    ;
    Promise.prototype.send = Promise.prototype.mcall = Promise.prototype.invoke = function(name) {
        return this.dispatch("post", [name, array_slice(arguments, 1)])
    }
    ;
    Q.fapply = function(object, args) {
        return Q(object).dispatch("apply", [void 0, args])
    }
    ;
    Promise.prototype.fapply = function(args) {
        return this.dispatch("apply", [void 0, args])
    }
    ;
    Q["try"] = Q.fcall = function(object) {
        return Q(object).dispatch("apply", [void 0, array_slice(arguments, 1)])
    }
    ;
    Promise.prototype.fcall = function() {
        return this.dispatch("apply", [void 0, array_slice(arguments)])
    }
    ;
    Q.fbind = function(object) {
        var promise = Q(object);
        var args = array_slice(arguments, 1);
        return function fbound() {
            return promise.dispatch("apply", [this, args.concat(array_slice(arguments))])
        }
    }
    ;
    Promise.prototype.fbind = function() {
        var promise = this;
        var args = array_slice(arguments);
        return function fbound() {
            return promise.dispatch("apply", [this, args.concat(array_slice(arguments))])
        }
    }
    ;
    Q.keys = function(object) {
        return Q(object).dispatch("keys", [])
    }
    ;
    Promise.prototype.keys = function() {
        return this.dispatch("keys", [])
    }
    ;
    Q.all = all;
    function all(promises) {
        return when(promises, function(promises) {
            var pendingCount = 0;
            var deferred = defer();
            array_reduce(promises, function(undefined, promise, index) {
                var snapshot;
                if (isPromise(promise) && (snapshot = promise.inspect()).state === "fulfilled") {
                    promises[index] = snapshot.value
                } else {
                    ++pendingCount;
                    when(promise, function(value) {
                        promises[index] = value;
                        if (--pendingCount === 0) {
                            deferred.resolve(promises)
                        }
                    }, deferred.reject, function(progress) {
                        deferred.notify({
                            index: index,
                            value: progress
                        })
                    })
                }
            }, void 0);
            if (pendingCount === 0) {
                deferred.resolve(promises)
            }
            return deferred.promise
        })
    }
    Promise.prototype.all = function() {
        return all(this)
    }
    ;
    Q.any = any;
    function any(promises) {
        if (promises.length === 0) {
            return Q.resolve()
        }
        var deferred = Q.defer();
        var pendingCount = 0;
        array_reduce(promises, function(prev, current, index) {
            var promise = promises[index];
            pendingCount++;
            when(promise, onFulfilled, onRejected, onProgress);
            function onFulfilled(result) {
                deferred.resolve(result)
            }
            function onRejected() {
                pendingCount--;
                if (pendingCount === 0) {
                    deferred.reject(new Error("Q can't get fulfillment value from any promise, all " + "promises were rejected."))
                }
            }
            function onProgress(progress) {
                deferred.notify({
                    index: index,
                    value: progress
                })
            }
        }, undefined);
        return deferred.promise
    }
    Promise.prototype.any = function() {
        return any(this)
    }
    ;
    Q.allResolved = deprecate(allResolved, "allResolved", "allSettled");
    function allResolved(promises) {
        return when(promises, function(promises) {
            promises = array_map(promises, Q);
            return when(all(array_map(promises, function(promise) {
                return when(promise, noop, noop)
            })), function() {
                return promises
            })
        })
    }
    Promise.prototype.allResolved = function() {
        return allResolved(this)
    }
    ;
    Q.allSettled = allSettled;
    function allSettled(promises) {
        return Q(promises).allSettled()
    }
    Promise.prototype.allSettled = function() {
        return this.then(function(promises) {
            return all(array_map(promises, function(promise) {
                promise = Q(promise);
                function regardless() {
                    return promise.inspect()
                }
                return promise.then(regardless, regardless)
            }))
        })
    }
    ;
    Q.fail = Q["catch"] = function(object, rejected) {
        return Q(object).then(void 0, rejected)
    }
    ;
    Promise.prototype.fail = Promise.prototype["catch"] = function(rejected) {
        return this.then(void 0, rejected)
    }
    ;
    Q.progress = progress;
    function progress(object, progressed) {
        return Q(object).then(void 0, void 0, progressed)
    }
    Promise.prototype.progress = function(progressed) {
        return this.then(void 0, void 0, progressed)
    }
    ;
    Q.fin = Q["finally"] = function(object, callback) {
        return Q(object)["finally"](callback)
    }
    ;
    Promise.prototype.fin = Promise.prototype["finally"] = function(callback) {
        if (!callback || typeof callback.apply !== "function") {
            throw new Error("Q can't apply finally callback")
        }
        callback = Q(callback);
        return this.then(function(value) {
            return callback.fcall().then(function() {
                return value
            })
        }, function(reason) {
            return callback.fcall().then(function() {
                throw reason
            })
        })
    }
    ;
    Q.done = function(object, fulfilled, rejected, progress) {
        return Q(object).done(fulfilled, rejected, progress)
    }
    ;
    Promise.prototype.done = function(fulfilled, rejected, progress) {
        var onUnhandledError = function(error) {
            Q.nextTick(function() {
                makeStackTraceLong(error, promise);
                if (Q.onerror) {
                    Q.onerror(error)
                } else {
                    throw error
                }
            })
        };
        var promise = fulfilled || rejected || progress ? this.then(fulfilled, rejected, progress) : this;
        if (typeof process === "object" && process && process.domain) {
            onUnhandledError = process.domain.bind(onUnhandledError)
        }
        promise.then(void 0, onUnhandledError)
    }
    ;
    Q.timeout = function(object, ms, error) {
        return Q(object).timeout(ms, error)
    }
    ;
    Promise.prototype.timeout = function(ms, error) {
        var deferred = defer();
        var timeoutId = setTimeout(function() {
            if (!error || "string" === typeof error) {
                error = new Error(error || "Timed out after " + ms + " ms");
                error.code = "ETIMEDOUT"
            }
            deferred.reject(error)
        }, ms);
        this.then(function(value) {
            clearTimeout(timeoutId);
            deferred.resolve(value)
        }, function(exception) {
            clearTimeout(timeoutId);
            deferred.reject(exception)
        }, deferred.notify);
        return deferred.promise
    }
    ;
    Q.delay = function(object, timeout) {
        if (timeout === void 0) {
            timeout = object;
            object = void 0
        }
        return Q(object).delay(timeout)
    }
    ;
    Promise.prototype.delay = function(timeout) {
        return this.then(function(value) {
            var deferred = defer();
            setTimeout(function() {
                deferred.resolve(value)
            }, timeout);
            return deferred.promise
        })
    }
    ;
    Q.nfapply = function(callback, args) {
        return Q(callback).nfapply(args)
    }
    ;
    Promise.prototype.nfapply = function(args) {
        var deferred = defer();
        var nodeArgs = array_slice(args);
        nodeArgs.push(deferred.makeNodeResolver());
        this.fapply(nodeArgs).fail(deferred.reject);
        return deferred.promise
    }
    ;
    Q.nfcall = function(callback) {
        var args = array_slice(arguments, 1);
        return Q(callback).nfapply(args)
    }
    ;
    Promise.prototype.nfcall = function() {
        var nodeArgs = array_slice(arguments);
        var deferred = defer();
        nodeArgs.push(deferred.makeNodeResolver());
        this.fapply(nodeArgs).fail(deferred.reject);
        return deferred.promise
    }
    ;
    Q.nfbind = Q.denodeify = function(callback) {
        if (callback === undefined) {
            throw new Error("Q can't wrap an undefined function")
        }
        var baseArgs = array_slice(arguments, 1);
        return function() {
            var nodeArgs = baseArgs.concat(array_slice(arguments));
            var deferred = defer();
            nodeArgs.push(deferred.makeNodeResolver());
            Q(callback).fapply(nodeArgs).fail(deferred.reject);
            return deferred.promise
        }
    }
    ;
    Promise.prototype.nfbind = Promise.prototype.denodeify = function() {
        var args = array_slice(arguments);
        args.unshift(this);
        return Q.denodeify.apply(void 0, args)
    }
    ;
    Q.nbind = function(callback, thisp) {
        var baseArgs = array_slice(arguments, 2);
        return function() {
            var nodeArgs = baseArgs.concat(array_slice(arguments));
            var deferred = defer();
            nodeArgs.push(deferred.makeNodeResolver());
            function bound() {
                return callback.apply(thisp, arguments)
            }
            Q(bound).fapply(nodeArgs).fail(deferred.reject);
            return deferred.promise
        }
    }
    ;
    Promise.prototype.nbind = function() {
        var args = array_slice(arguments, 0);
        args.unshift(this);
        return Q.nbind.apply(void 0, args)
    }
    ;
    Q.nmapply = Q.npost = function(object, name, args) {
        return Q(object).npost(name, args)
    }
    ;
    Promise.prototype.nmapply = Promise.prototype.npost = function(name, args) {
        var nodeArgs = array_slice(args || []);
        var deferred = defer();
        nodeArgs.push(deferred.makeNodeResolver());
        this.dispatch("post", [name, nodeArgs]).fail(deferred.reject);
        return deferred.promise
    }
    ;
    Q.nsend = Q.nmcall = Q.ninvoke = function(object, name) {
        var nodeArgs = array_slice(arguments, 2);
        var deferred = defer();
        nodeArgs.push(deferred.makeNodeResolver());
        Q(object).dispatch("post", [name, nodeArgs]).fail(deferred.reject);
        return deferred.promise
    }
    ;
    Promise.prototype.nsend = Promise.prototype.nmcall = Promise.prototype.ninvoke = function(name) {
        var nodeArgs = array_slice(arguments, 1);
        var deferred = defer();
        nodeArgs.push(deferred.makeNodeResolver());
        this.dispatch("post", [name, nodeArgs]).fail(deferred.reject);
        return deferred.promise
    }
    ;
    Q.nodeify = nodeify;
    function nodeify(object, nodeback) {
        return Q(object).nodeify(nodeback)
    }
    Promise.prototype.nodeify = function(nodeback) {
        if (nodeback) {
            this.then(function(value) {
                Q.nextTick(function() {
                    nodeback(null, value)
                })
            }, function(error) {
                Q.nextTick(function() {
                    nodeback(error)
                })
            })
        } else {
            return this
        }
    }
    ;
    Q.noConflict = function() {
        throw new Error("Q.noConflict only works when Q is used as a global")
    }
    ;
    var qEndingLine = captureLine();
    return Q
});
(function($) {
        "use strict";
        var loadImage = function(file, callback, options) {
            var img = document.createElement("img"), url, oUrl;
            img.onerror = callback;
            img.onload = function() {
                if (oUrl && !(options && options.noRevoke)) {
                    loadImage.revokeObjectURL(oUrl)
                }
                if (callback) {
                    callback(loadImage.scale(img, options))
                }
            }
            ;
            if (loadImage.isInstanceOf("Blob", file) || loadImage.isInstanceOf("File", file)) {
                url = oUrl = loadImage.createObjectURL(file);
                img._type = file.type
            } else if (typeof file === "string") {
                url = file;
                if (options && options.crossOrigin) {
                    img.crossOrigin = options.crossOrigin
                }
            } else {
                return false
            }
            if (url) {
                img.src = url;
                return img
            }
            return loadImage.readFile(file, function(e) {
                var target = e.target;
                if (target && target.result) {
                    img.src = target.result
                } else {
                    if (callback) {
                        callback(e)
                    }
                }
            })
        }
            , urlAPI = window.createObjectURL && window || window.URL && URL.revokeObjectURL && URL || window.webkitURL && webkitURL;
        loadImage.isInstanceOf = function(type, obj) {
            return Object.prototype.toString.call(obj) === "[object " + type + "]"
        }
        ;
        loadImage.transformCoordinates = function() {
            return
        }
        ;
        loadImage.getTransformedOptions = function(img, options) {
            var aspectRatio = options.aspectRatio, newOptions, i, width, height;
            if (!aspectRatio) {
                return options
            }
            newOptions = {};
            for (i in options) {
                if (options.hasOwnProperty(i)) {
                    newOptions[i] = options[i]
                }
            }
            newOptions.crop = true;
            width = img.naturalWidth || img.width;
            height = img.naturalHeight || img.height;
            if (width / height > aspectRatio) {
                newOptions.maxWidth = height * aspectRatio;
                newOptions.maxHeight = height
            } else {
                newOptions.maxWidth = width;
                newOptions.maxHeight = width / aspectRatio
            }
            return newOptions
        }
        ;
        loadImage.renderImageToCanvas = function(canvas, img, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight) {
            canvas.getContext("2d").drawImage(img, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);
            return canvas
        }
        ;
        loadImage.hasCanvasOption = function(options) {
            return options.canvas || options.crop || options.aspectRatio
        }
        ;
        loadImage.scale = function(img, options) {
            options = options || {};
            var canvas = document.createElement("canvas"), useCanvas = img.getContext || loadImage.hasCanvasOption(options) && canvas.getContext, width = img.naturalWidth || img.width, height = img.naturalHeight || img.height, destWidth = width, destHeight = height, maxWidth, maxHeight, minWidth, minHeight, sourceWidth, sourceHeight, sourceX, sourceY, tmp, scaleUp = function() {
                var scale = Math.max((minWidth || destWidth) / destWidth, (minHeight || destHeight) / destHeight);
                if (scale > 1) {
                    destWidth = destWidth * scale;
                    destHeight = destHeight * scale
                }
            }, scaleDown = function() {
                var scale = Math.min((maxWidth || destWidth) / destWidth, (maxHeight || destHeight) / destHeight);
                if (scale < 1) {
                    destWidth = destWidth * scale;
                    destHeight = destHeight * scale
                }
            };
            if (useCanvas) {
                options = loadImage.getTransformedOptions(img, options);
                sourceX = options.left || 0;
                sourceY = options.top || 0;
                if (options.sourceWidth) {
                    sourceWidth = options.sourceWidth;
                    if (options.right !== undefined && options.left === undefined) {
                        sourceX = width - sourceWidth - options.right
                    }
                } else {
                    sourceWidth = width - sourceX - (options.right || 0)
                }
                if (options.sourceHeight) {
                    sourceHeight = options.sourceHeight;
                    if (options.bottom !== undefined && options.top === undefined) {
                        sourceY = height - sourceHeight - options.bottom
                    }
                } else {
                    sourceHeight = height - sourceY - (options.bottom || 0)
                }
                destWidth = sourceWidth;
                destHeight = sourceHeight
            }
            maxWidth = options.maxWidth;
            maxHeight = options.maxHeight;
            minWidth = options.minWidth;
            minHeight = options.minHeight;
            if (useCanvas && maxWidth && maxHeight && options.crop) {
                destWidth = maxWidth;
                destHeight = maxHeight;
                tmp = sourceWidth / sourceHeight - maxWidth / maxHeight;
                if (tmp < 0) {
                    sourceHeight = maxHeight * sourceWidth / maxWidth;
                    if (options.top === undefined && options.bottom === undefined) {
                        sourceY = (height - sourceHeight) / 2
                    }
                } else if (tmp > 0) {
                    sourceWidth = maxWidth * sourceHeight / maxHeight;
                    if (options.left === undefined && options.right === undefined) {
                        sourceX = (width - sourceWidth) / 2
                    }
                }
            } else {
                if (options.contain || options.cover) {
                    minWidth = maxWidth = maxWidth || minWidth;
                    minHeight = maxHeight = maxHeight || minHeight
                }
                if (options.cover) {
                    scaleDown();
                    scaleUp()
                } else {
                    scaleUp();
                    scaleDown()
                }
            }
            if (useCanvas) {
                canvas.width = destWidth;
                canvas.height = destHeight;
                loadImage.transformCoordinates(canvas, options);
                return loadImage.renderImageToCanvas(canvas, img, sourceX, sourceY, sourceWidth, sourceHeight, 0, 0, destWidth, destHeight)
            }
            img.width = destWidth;
            img.height = destHeight;
            return img
        }
        ;
        loadImage.createObjectURL = function(file) {
            return urlAPI ? urlAPI.createObjectURL(file) : false
        }
        ;
        loadImage.revokeObjectURL = function(url) {
            return urlAPI ? urlAPI.revokeObjectURL(url) : false
        }
        ;
        loadImage.readFile = function(file, callback, method) {
            if (window.FileReader) {
                var fileReader = new FileReader;
                fileReader.onload = fileReader.onerror = callback;
                method = method || "readAsDataURL";
                if (fileReader[method]) {
                    fileReader[method](file);
                    return fileReader
                }
            }
            return false
        }
        ;
        if (typeof define === "function" && define.amd) {
            define("load-image", [], function() {
                return loadImage
            })
        } else {
            $.loadImage = loadImage
        }
    }
)(this);
(function(factory) {
        "use strict";
        if (typeof define === "function" && define.amd) {
            define("load-image-orientation", ["load-image"], factory)
        } else {
            factory(window.loadImage)
        }
    }
)(function(loadImage) {
    "use strict";
    var originalHasCanvasOption = loadImage.hasCanvasOption
        , originalTransformCoordinates = loadImage.transformCoordinates
        , originalGetTransformedOptions = loadImage.getTransformedOptions;
    loadImage.hasCanvasOption = function(options) {
        return originalHasCanvasOption.call(loadImage, options) || options.orientation
    }
    ;
    loadImage.transformCoordinates = function(canvas, options) {
        originalTransformCoordinates.call(loadImage, canvas, options);
        var ctx = canvas.getContext("2d")
            , width = canvas.width
            , height = canvas.height
            , orientation = options.orientation;
        if (!orientation || orientation > 8) {
            return
        }
        if (orientation > 4) {
            canvas.width = height;
            canvas.height = width
        }
        switch (orientation) {
            case 2:
                ctx.translate(width, 0);
                ctx.scale(-1, 1);
                break;
            case 3:
                ctx.translate(width, height);
                ctx.rotate(Math.PI);
                break;
            case 4:
                ctx.translate(0, height);
                ctx.scale(1, -1);
                break;
            case 5:
                ctx.rotate(.5 * Math.PI);
                ctx.scale(1, -1);
                break;
            case 6:
                ctx.rotate(.5 * Math.PI);
                ctx.translate(0, -height);
                break;
            case 7:
                ctx.rotate(.5 * Math.PI);
                ctx.translate(width, -height);
                ctx.scale(-1, 1);
                break;
            case 8:
                ctx.rotate(-.5 * Math.PI);
                ctx.translate(-width, 0);
                break
        }
    }
    ;
    loadImage.getTransformedOptions = function(img, opts) {
        var options = originalGetTransformedOptions.call(loadImage, img, opts), orientation = options.orientation, newOptions, i;
        if (!orientation || orientation > 8 || orientation === 1) {
            return options
        }
        newOptions = {};
        for (i in options) {
            if (options.hasOwnProperty(i)) {
                newOptions[i] = options[i]
            }
        }
        switch (options.orientation) {
            case 2:
                newOptions.left = options.right;
                newOptions.right = options.left;
                break;
            case 3:
                newOptions.left = options.right;
                newOptions.top = options.bottom;
                newOptions.right = options.left;
                newOptions.bottom = options.top;
                break;
            case 4:
                newOptions.top = options.bottom;
                newOptions.bottom = options.top;
                break;
            case 5:
                newOptions.left = options.top;
                newOptions.top = options.left;
                newOptions.right = options.bottom;
                newOptions.bottom = options.right;
                break;
            case 6:
                newOptions.left = options.top;
                newOptions.top = options.right;
                newOptions.right = options.bottom;
                newOptions.bottom = options.left;
                break;
            case 7:
                newOptions.left = options.bottom;
                newOptions.top = options.right;
                newOptions.right = options.top;
                newOptions.bottom = options.left;
                break;
            case 8:
                newOptions.left = options.bottom;
                newOptions.top = options.left;
                newOptions.right = options.top;
                newOptions.bottom = options.right;
                break
        }
        if (options.orientation > 4) {
            newOptions.maxWidth = options.maxHeight;
            newOptions.maxHeight = options.maxWidth;
            newOptions.minWidth = options.minHeight;
            newOptions.minHeight = options.minWidth;
            newOptions.sourceWidth = options.sourceHeight;
            newOptions.sourceHeight = options.sourceWidth
        }
        return newOptions
    }
});
(function(factory) {
        "use strict";
        if (typeof define === "function" && define.amd) {
            define("load-image-meta", ["load-image"], factory)
        } else {
            factory(window.loadImage)
        }
    }
)(function(loadImage) {
    "use strict";
    var hasblobSlice = window.Blob && (Blob.prototype.slice || Blob.prototype.webkitSlice || Blob.prototype.mozSlice);
    loadImage.blobSlice = hasblobSlice && function() {
        var slice = this.slice || this.webkitSlice || this.mozSlice;
        return slice.apply(this, arguments)
    }
    ;
    loadImage.metaDataParsers = {
        jpeg: {
            65505: []
        }
    };
    loadImage.parseMetaData = function(file, callback, options) {
        options = options || {};
        var that = this
            , maxMetaDataSize = options.maxMetaDataSize || 262144
            , data = {}
            , noMetaData = !(window.DataView && file && file.size >= 12 && file.type === "image/jpeg" && loadImage.blobSlice);
        if (noMetaData || !loadImage.readFile(loadImage.blobSlice.call(file, 0, maxMetaDataSize), function(e) {
            if (e.target.error) {
                console.log(e.target.error);
                callback(data);
                return
            }
            var buffer = e.target.result, dataView = new DataView(buffer), offset = 2, maxOffset = dataView.byteLength - 4, headLength = offset, markerBytes, markerLength, parsers, i;
            if (dataView.getUint16(0) === 65496) {
                while (offset < maxOffset) {
                    markerBytes = dataView.getUint16(offset);
                    if (markerBytes >= 65504 && markerBytes <= 65519 || markerBytes === 65534) {
                        markerLength = dataView.getUint16(offset + 2) + 2;
                        if (offset + markerLength > dataView.byteLength) {
                            console.log("Invalid meta data: Invalid segment size.");
                            break
                        }
                        parsers = loadImage.metaDataParsers.jpeg[markerBytes];
                        if (parsers) {
                            for (i = 0; i < parsers.length; i += 1) {
                                parsers[i].call(that, dataView, offset, markerLength, data, options)
                            }
                        }
                        offset += markerLength;
                        headLength = offset
                    } else {
                        break
                    }
                }
                if (!options.disableImageHead && headLength > 6) {
                    if (buffer.slice) {
                        data.imageHead = buffer.slice(0, headLength)
                    } else {
                        data.imageHead = new Uint8Array(buffer).subarray(0, headLength)
                    }
                }
            } else {
                console.log("Invalid JPEG file: Missing JPEG marker.")
            }
            callback(data)
        }, "readAsArrayBuffer")) {
            callback(data)
        }
    }
});
(function(factory) {
        "use strict";
        if (typeof define === "function" && define.amd) {
            define("load-image-ios", ["load-image"], factory)
        } else {
            factory(window.loadImage)
        }
    }
)(function(loadImage) {
    "use strict";
    if (!window.navigator || !window.navigator.platform || !/iP(hone|od|ad)/.test(window.navigator.platform)) {
        return
    }
    var originalRenderMethod = loadImage.renderImageToCanvas;
    loadImage.detectSubsampling = function(img) {
        var canvas, context;
        if (img.width * img.height > 1024 * 1024) {
            canvas = document.createElement("canvas");
            canvas.width = canvas.height = 1;
            context = canvas.getContext("2d");
            context.drawImage(img, -img.width + 1, 0);
            return context.getImageData(0, 0, 1, 1).data[3] === 0
        }
        return false
    }
    ;
    loadImage.detectVerticalSquash = function(img, subsampled) {
        var naturalHeight = img.naturalHeight || img.height, canvas = document.createElement("canvas"), context = canvas.getContext("2d"), data, sy, ey, py, alpha;
        if (subsampled) {
            naturalHeight /= 2
        }
        canvas.width = 1;
        canvas.height = naturalHeight;
        context.drawImage(img, 0, 0);
        data = context.getImageData(0, 0, 1, naturalHeight).data;
        sy = 0;
        ey = naturalHeight;
        py = naturalHeight;
        while (py > sy) {
            alpha = data[(py - 1) * 4 + 3];
            if (alpha === 0) {
                ey = py
            } else {
                sy = py
            }
            py = ey + sy >> 1
        }
        return py / naturalHeight || 1
    }
    ;
    loadImage.renderImageToCanvas = function(canvas, img, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight) {
        if (img._type === "image/jpeg") {
            var context = canvas.getContext("2d"), tmpCanvas = document.createElement("canvas"), tileSize = 1024, tmpContext = tmpCanvas.getContext("2d"), subsampled, vertSquashRatio, tileX, tileY;
            tmpCanvas.width = tileSize;
            tmpCanvas.height = tileSize;
            context.save();
            subsampled = loadImage.detectSubsampling(img);
            if (subsampled) {
                sourceX /= 2;
                sourceY /= 2;
                sourceWidth /= 2;
                sourceHeight /= 2
            }
            vertSquashRatio = loadImage.detectVerticalSquash(img, subsampled);
            if (subsampled || vertSquashRatio !== 1) {
                sourceY *= vertSquashRatio;
                destWidth = Math.ceil(tileSize * destWidth / sourceWidth);
                destHeight = Math.ceil(tileSize * destHeight / sourceHeight / vertSquashRatio);
                destY = 0;
                tileY = 0;
                while (tileY < sourceHeight) {
                    destX = 0;
                    tileX = 0;
                    while (tileX < sourceWidth) {
                        tmpContext.clearRect(0, 0, tileSize, tileSize);
                        tmpContext.drawImage(img, sourceX, sourceY, sourceWidth, sourceHeight, -tileX, -tileY, sourceWidth, sourceHeight);
                        context.drawImage(tmpCanvas, 0, 0, tileSize, tileSize, destX, destY, destWidth, destHeight);
                        tileX += tileSize;
                        destX += destWidth
                    }
                    tileY += tileSize;
                    destY += destHeight
                }
                context.restore();
                return canvas
            }
        }
        return originalRenderMethod(canvas, img, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight)
    }
});
(function(factory) {
        "use strict";
        if (typeof define === "function" && define.amd) {
            define("load-image-exif", ["load-image", "load-image-meta"], factory)
        } else {
            factory(window.loadImage)
        }
    }
)(function(loadImage) {
    "use strict";
    loadImage.ExifMap = function() {
        return this
    }
    ;
    loadImage.ExifMap.prototype.map = {
        Orientation: 274
    };
    loadImage.ExifMap.prototype.get = function(id) {
        return this[id] || this[this.map[id]]
    }
    ;
    loadImage.getExifThumbnail = function(dataView, offset, length) {
        var hexData, i, b;
        if (!length || offset + length > dataView.byteLength) {
            console.log("Invalid Exif data: Invalid thumbnail data.");
            return
        }
        hexData = [];
        for (i = 0; i < length; i += 1) {
            b = dataView.getUint8(offset + i);
            hexData.push((b < 16 ? "0" : "") + b.toString(16))
        }
        return "data:image/jpeg,%" + hexData.join("%")
    }
    ;
    loadImage.exifTagTypes = {
        1: {
            getValue: function(dataView, dataOffset) {
                return dataView.getUint8(dataOffset)
            },
            size: 1
        },
        2: {
            getValue: function(dataView, dataOffset) {
                return String.fromCharCode(dataView.getUint8(dataOffset))
            },
            size: 1,
            ascii: true
        },
        3: {
            getValue: function(dataView, dataOffset, littleEndian) {
                return dataView.getUint16(dataOffset, littleEndian)
            },
            size: 2
        },
        4: {
            getValue: function(dataView, dataOffset, littleEndian) {
                return dataView.getUint32(dataOffset, littleEndian)
            },
            size: 4
        },
        5: {
            getValue: function(dataView, dataOffset, littleEndian) {
                return dataView.getUint32(dataOffset, littleEndian) / dataView.getUint32(dataOffset + 4, littleEndian)
            },
            size: 8
        },
        9: {
            getValue: function(dataView, dataOffset, littleEndian) {
                return dataView.getInt32(dataOffset, littleEndian)
            },
            size: 4
        },
        10: {
            getValue: function(dataView, dataOffset, littleEndian) {
                return dataView.getInt32(dataOffset, littleEndian) / dataView.getInt32(dataOffset + 4, littleEndian)
            },
            size: 8
        }
    };
    loadImage.exifTagTypes[7] = loadImage.exifTagTypes[1];
    loadImage.getExifValue = function(dataView, tiffOffset, offset, type, length, littleEndian) {
        var tagType = loadImage.exifTagTypes[type], tagSize, dataOffset, values, i, str, c;
        if (!tagType) {
            console.log("Invalid Exif data: Invalid tag type.");
            return
        }
        tagSize = tagType.size * length;
        dataOffset = tagSize > 4 ? tiffOffset + dataView.getUint32(offset + 8, littleEndian) : offset + 8;
        if (dataOffset + tagSize > dataView.byteLength) {
            console.log("Invalid Exif data: Invalid data offset.");
            return
        }
        if (length === 1) {
            return tagType.getValue(dataView, dataOffset, littleEndian)
        }
        values = [];
        for (i = 0; i < length; i += 1) {
            values[i] = tagType.getValue(dataView, dataOffset + i * tagType.size, littleEndian)
        }
        if (tagType.ascii) {
            str = "";
            for (i = 0; i < values.length; i += 1) {
                c = values[i];
                if (c === "\0") {
                    break
                }
                str += c
            }
            return str
        }
        return values
    }
    ;
    loadImage.parseExifTag = function(dataView, tiffOffset, offset, littleEndian, data) {
        var tag = dataView.getUint16(offset, littleEndian);
        data.exif[tag] = loadImage.getExifValue(dataView, tiffOffset, offset, dataView.getUint16(offset + 2, littleEndian), dataView.getUint32(offset + 4, littleEndian), littleEndian)
    }
    ;
    loadImage.parseExifTags = function(dataView, tiffOffset, dirOffset, littleEndian, data) {
        var tagsNumber, dirEndOffset, i;
        if (dirOffset + 6 > dataView.byteLength) {
            console.log("Invalid Exif data: Invalid directory offset.");
            return
        }
        tagsNumber = dataView.getUint16(dirOffset, littleEndian);
        dirEndOffset = dirOffset + 2 + 12 * tagsNumber;
        if (dirEndOffset + 4 > dataView.byteLength) {
            console.log("Invalid Exif data: Invalid directory size.");
            return
        }
        for (i = 0; i < tagsNumber; i += 1) {
            this.parseExifTag(dataView, tiffOffset, dirOffset + 2 + 12 * i, littleEndian, data)
        }
        return dataView.getUint32(dirEndOffset, littleEndian)
    }
    ;
    loadImage.parseExifData = function(dataView, offset, length, data, options) {
        if (options.disableExif) {
            return
        }
        var tiffOffset = offset + 10, littleEndian, dirOffset, thumbnailData;
        if (dataView.getUint32(offset + 4) !== 1165519206) {
            return
        }
        if (tiffOffset + 8 > dataView.byteLength) {
            console.log("Invalid Exif data: Invalid segment size.");
            return
        }
        if (dataView.getUint16(offset + 8) !== 0) {
            console.log("Invalid Exif data: Missing byte alignment offset.");
            return
        }
        switch (dataView.getUint16(tiffOffset)) {
            case 18761:
                littleEndian = true;
                break;
            case 19789:
                littleEndian = false;
                break;
            default:
                console.log("Invalid Exif data: Invalid byte alignment marker.");
                return
        }
        if (dataView.getUint16(tiffOffset + 2, littleEndian) !== 42) {
            console.log("Invalid Exif data: Missing TIFF marker.");
            return
        }
        dirOffset = dataView.getUint32(tiffOffset + 4, littleEndian);
        data.exif = new loadImage.ExifMap;
        dirOffset = loadImage.parseExifTags(dataView, tiffOffset, tiffOffset + dirOffset, littleEndian, data);
        if (dirOffset && !options.disableExifThumbnail) {
            thumbnailData = {
                exif: {}
            };
            dirOffset = loadImage.parseExifTags(dataView, tiffOffset, tiffOffset + dirOffset, littleEndian, thumbnailData);
            if (thumbnailData.exif[513]) {
                data.exif.Thumbnail = loadImage.getExifThumbnail(dataView, tiffOffset + thumbnailData.exif[513], thumbnailData.exif[514])
            }
        }
        if (data.exif[34665] && !options.disableExifSub) {
            loadImage.parseExifTags(dataView, tiffOffset, tiffOffset + data.exif[34665], littleEndian, data)
        }
        if (data.exif[34853] && !options.disableExifGps) {
            loadImage.parseExifTags(dataView, tiffOffset, tiffOffset + data.exif[34853], littleEndian, data)
        }
    }
    ;
    loadImage.metaDataParsers.jpeg[65505].push(loadImage.parseExifData)
});
(function(factory) {
        "use strict";
        if (typeof define === "function" && define.amd) {
            define("load-image-exif-map", ["load-image", "load-image-exif"], factory)
        } else {
            factory(window.loadImage)
        }
    }
)(function(loadImage) {
    "use strict";
    loadImage.ExifMap.prototype.tags = {
        256: "ImageWidth",
        257: "ImageHeight",
        34665: "ExifIFDPointer",
        34853: "GPSInfoIFDPointer",
        40965: "InteroperabilityIFDPointer",
        258: "BitsPerSample",
        259: "Compression",
        262: "PhotometricInterpretation",
        274: "Orientation",
        277: "SamplesPerPixel",
        284: "PlanarConfiguration",
        530: "YCbCrSubSampling",
        531: "YCbCrPositioning",
        282: "XResolution",
        283: "YResolution",
        296: "ResolutionUnit",
        273: "StripOffsets",
        278: "RowsPerStrip",
        279: "StripByteCounts",
        513: "JPEGInterchangeFormat",
        514: "JPEGInterchangeFormatLength",
        301: "TransferFunction",
        318: "WhitePoint",
        319: "PrimaryChromaticities",
        529: "YCbCrCoefficients",
        532: "ReferenceBlackWhite",
        306: "DateTime",
        270: "ImageDescription",
        271: "Make",
        272: "Model",
        305: "Software",
        315: "Artist",
        33432: "Copyright",
        36864: "ExifVersion",
        40960: "FlashpixVersion",
        40961: "ColorSpace",
        40962: "PixelXDimension",
        40963: "PixelYDimension",
        42240: "Gamma",
        37121: "ComponentsConfiguration",
        37122: "CompressedBitsPerPixel",
        37500: "MakerNote",
        37510: "UserComment",
        40964: "RelatedSoundFile",
        36867: "DateTimeOriginal",
        36868: "DateTimeDigitized",
        37520: "SubSecTime",
        37521: "SubSecTimeOriginal",
        37522: "SubSecTimeDigitized",
        33434: "ExposureTime",
        33437: "FNumber",
        34850: "ExposureProgram",
        34852: "SpectralSensitivity",
        34855: "PhotographicSensitivity",
        34856: "OECF",
        34864: "SensitivityType",
        34865: "StandardOutputSensitivity",
        34866: "RecommendedExposureIndex",
        34867: "ISOSpeed",
        34868: "ISOSpeedLatitudeyyy",
        34869: "ISOSpeedLatitudezzz",
        37377: "ShutterSpeedValue",
        37378: "ApertureValue",
        37379: "BrightnessValue",
        37380: "ExposureBias",
        37381: "MaxApertureValue",
        37382: "SubjectDistance",
        37383: "MeteringMode",
        37384: "LightSource",
        37385: "Flash",
        37396: "SubjectArea",
        37386: "FocalLength",
        41483: "FlashEnergy",
        41484: "SpatialFrequencyResponse",
        41486: "FocalPlaneXResolution",
        41487: "FocalPlaneYResolution",
        41488: "FocalPlaneResolutionUnit",
        41492: "SubjectLocation",
        41493: "ExposureIndex",
        41495: "SensingMethod",
        41728: "FileSource",
        41729: "SceneType",
        41730: "CFAPattern",
        41985: "CustomRendered",
        41986: "ExposureMode",
        41987: "WhiteBalance",
        41988: "DigitalZoomRatio",
        41989: "FocalLengthIn35mmFilm",
        41990: "SceneCaptureType",
        41991: "GainControl",
        41992: "Contrast",
        41993: "Saturation",
        41994: "Sharpness",
        41995: "DeviceSettingDescription",
        41996: "SubjectDistanceRange",
        42016: "ImageUniqueID",
        42032: "CameraOwnerName",
        42033: "BodySerialNumber",
        42034: "LensSpecification",
        42035: "LensMake",
        42036: "LensModel",
        42037: "LensSerialNumber",
        0: "GPSVersionID",
        1: "GPSLatitudeRef",
        2: "GPSLatitude",
        3: "GPSLongitudeRef",
        4: "GPSLongitude",
        5: "GPSAltitudeRef",
        6: "GPSAltitude",
        7: "GPSTimeStamp",
        8: "GPSSatellites",
        9: "GPSStatus",
        10: "GPSMeasureMode",
        11: "GPSDOP",
        12: "GPSSpeedRef",
        13: "GPSSpeed",
        14: "GPSTrackRef",
        15: "GPSTrack",
        16: "GPSImgDirectionRef",
        17: "GPSImgDirection",
        18: "GPSMapDatum",
        19: "GPSDestLatitudeRef",
        20: "GPSDestLatitude",
        21: "GPSDestLongitudeRef",
        22: "GPSDestLongitude",
        23: "GPSDestBearingRef",
        24: "GPSDestBearing",
        25: "GPSDestDistanceRef",
        26: "GPSDestDistance",
        27: "GPSProcessingMethod",
        28: "GPSAreaInformation",
        29: "GPSDateStamp",
        30: "GPSDifferential",
        31: "GPSHPositioningError"
    };
    loadImage.ExifMap.prototype.stringValues = {
        ExposureProgram: {
            0: "Undefined",
            1: "Manual",
            2: "Normal program",
            3: "Aperture priority",
            4: "Shutter priority",
            5: "Creative program",
            6: "Action program",
            7: "Portrait mode",
            8: "Landscape mode"
        },
        MeteringMode: {
            0: "Unknown",
            1: "Average",
            2: "CenterWeightedAverage",
            3: "Spot",
            4: "MultiSpot",
            5: "Pattern",
            6: "Partial",
            255: "Other"
        },
        LightSource: {
            0: "Unknown",
            1: "Daylight",
            2: "Fluorescent",
            3: "Tungsten (incandescent light)",
            4: "Flash",
            9: "Fine weather",
            10: "Cloudy weather",
            11: "Shade",
            12: "Daylight fluorescent (D 5700 - 7100K)",
            13: "Day white fluorescent (N 4600 - 5400K)",
            14: "Cool white fluorescent (W 3900 - 4500K)",
            15: "White fluorescent (WW 3200 - 3700K)",
            17: "Standard light A",
            18: "Standard light B",
            19: "Standard light C",
            20: "D55",
            21: "D65",
            22: "D75",
            23: "D50",
            24: "ISO studio tungsten",
            255: "Other"
        },
        Flash: {
            0: "Flash did not fire",
            1: "Flash fired",
            5: "Strobe return light not detected",
            7: "Strobe return light detected",
            9: "Flash fired, compulsory flash mode",
            13: "Flash fired, compulsory flash mode, return light not detected",
            15: "Flash fired, compulsory flash mode, return light detected",
            16: "Flash did not fire, compulsory flash mode",
            24: "Flash did not fire, auto mode",
            25: "Flash fired, auto mode",
            29: "Flash fired, auto mode, return light not detected",
            31: "Flash fired, auto mode, return light detected",
            32: "No flash function",
            65: "Flash fired, red-eye reduction mode",
            69: "Flash fired, red-eye reduction mode, return light not detected",
            71: "Flash fired, red-eye reduction mode, return light detected",
            73: "Flash fired, compulsory flash mode, red-eye reduction mode",
            77: "Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
            79: "Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",
            89: "Flash fired, auto mode, red-eye reduction mode",
            93: "Flash fired, auto mode, return light not detected, red-eye reduction mode",
            95: "Flash fired, auto mode, return light detected, red-eye reduction mode"
        },
        SensingMethod: {
            1: "Undefined",
            2: "One-chip color area sensor",
            3: "Two-chip color area sensor",
            4: "Three-chip color area sensor",
            5: "Color sequential area sensor",
            7: "Trilinear sensor",
            8: "Color sequential linear sensor"
        },
        SceneCaptureType: {
            0: "Standard",
            1: "Landscape",
            2: "Portrait",
            3: "Night scene"
        },
        SceneType: {
            1: "Directly photographed"
        },
        CustomRendered: {
            0: "Normal process",
            1: "Custom process"
        },
        WhiteBalance: {
            0: "Auto white balance",
            1: "Manual white balance"
        },
        GainControl: {
            0: "None",
            1: "Low gain up",
            2: "High gain up",
            3: "Low gain down",
            4: "High gain down"
        },
        Contrast: {
            0: "Normal",
            1: "Soft",
            2: "Hard"
        },
        Saturation: {
            0: "Normal",
            1: "Low saturation",
            2: "High saturation"
        },
        Sharpness: {
            0: "Normal",
            1: "Soft",
            2: "Hard"
        },
        SubjectDistanceRange: {
            0: "Unknown",
            1: "Macro",
            2: "Close view",
            3: "Distant view"
        },
        FileSource: {
            3: "DSC"
        },
        ComponentsConfiguration: {
            0: "",
            1: "Y",
            2: "Cb",
            3: "Cr",
            4: "R",
            5: "G",
            6: "B"
        },
        Orientation: {
            1: "top-left",
            2: "top-right",
            3: "bottom-right",
            4: "bottom-left",
            5: "left-top",
            6: "right-top",
            7: "right-bottom",
            8: "left-bottom"
        }
    };
    loadImage.ExifMap.prototype.getText = function(id) {
        var value = this.get(id);
        switch (id) {
            case "LightSource":
            case "Flash":
            case "MeteringMode":
            case "ExposureProgram":
            case "SensingMethod":
            case "SceneCaptureType":
            case "SceneType":
            case "CustomRendered":
            case "WhiteBalance":
            case "GainControl":
            case "Contrast":
            case "Saturation":
            case "Sharpness":
            case "SubjectDistanceRange":
            case "FileSource":
            case "Orientation":
                return this.stringValues[id][value];
            case "ExifVersion":
            case "FlashpixVersion":
                return String.fromCharCode(value[0], value[1], value[2], value[3]);
            case "ComponentsConfiguration":
                return this.stringValues[id][value[0]] + this.stringValues[id][value[1]] + this.stringValues[id][value[2]] + this.stringValues[id][value[3]];
            case "GPSVersionID":
                return value[0] + "." + value[1] + "." + value[2] + "." + value[3]
        }
        return String(value)
    }
    ;
    (function(exifMapPrototype) {
            var tags = exifMapPrototype.tags, map = exifMapPrototype.map, prop;
            for (prop in tags) {
                if (tags.hasOwnProperty(prop)) {
                    map[tags[prop]] = prop
                }
            }
        }
    )(loadImage.ExifMap.prototype);
    loadImage.ExifMap.prototype.getAll = function() {
        var map = {}, prop, id;
        for (prop in this) {
            if (this.hasOwnProperty(prop)) {
                id = this.tags[prop];
                if (id) {
                    map[id] = this.getText(id)
                }
            }
        }
        return map
    }
});
(function() {
        define("lib/load-image-all", ["require", "load-image-orientation", "load-image-meta", "load-image-ios", "load-image-exif", "load-image-exif-map", "load-image"], function(require) {
            require("load-image-orientation");
            require("load-image-meta");
            require("load-image-ios");
            require("load-image-exif");
            require("load-image-exif-map");
            return require("load-image")
        })
    }
).call(this);
define("lib/load-image", ["require", "exports", "lib/load-image-all", "q"], function(require, exports, LoadImage, Q) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var QUALITY_PARAMETERS = [.92, .86, .8, .7, .6, .5, .4, .3, .2, .1];
    function recompressJPEG(canvas, maxFileSize) {
        var compressedDataURL;
        for (var _i = 0, QUALITY_PARAMETERS_1 = QUALITY_PARAMETERS; _i < QUALITY_PARAMETERS_1.length; _i++) {
            var quality = QUALITY_PARAMETERS_1[_i];
            compressedDataURL = canvas.toDataURL("image/jpeg", quality);
            if (compressedDataURL.length < maxFileSize) {
                return compressedDataURL
            }
        }
        return compressedDataURL
    }
    function recompressPNG(canvas, maxFileSize) {
        var fileSize = canvas.toDataURL().length;
        var scaledWidth = canvas.width;
        var scaledHeight = canvas.height;
        var scaledCanvas = document.createElement("canvas");
        var compressedDataURL;
        for (var compressionAttempts = 0; compressionAttempts < 2; compressionAttempts++) {
            var scaleFactor = Math.sqrt(maxFileSize / fileSize);
            scaledWidth = Math.round(scaleFactor * scaledWidth);
            scaledHeight = Math.round(scaleFactor * scaledHeight);
            scaledCanvas.height = scaledHeight;
            scaledCanvas.width = scaledWidth;
            var ctx = scaledCanvas.getContext("2d");
            if (ctx) {
                ctx.drawImage(canvas, 0, 0, scaledWidth, scaledHeight);
                compressedDataURL = scaledCanvas.toDataURL();
                fileSize = compressedDataURL.length;
                if (fileSize < maxFileSize) {
                    return compressedDataURL
                }
            } else {
                throw new Error("could not obtain 2d context for scaled canvas")
            }
        }
        return compressedDataURL
    }
    function dataUrlToBlob(dataUrl) {
        var arr = dataUrl.split(",");
        var mime = arr[0].match(/:(.*?);/)[1];
        var bstr = atob(arr[1]);
        var n = bstr.length;
        var u8arr = new Uint8Array(n);
        while (n--) {
            u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr],{
            type: mime
        })
    }
    exports.dataUrlToBlob = dataUrlToBlob;
    function compressDataUrl(dataUrl) {
        var blob = dataUrlToBlob(dataUrl);
        return Q.nfapply(imageFileToDataURL, [blob])
    }
    exports.compressDataUrl = compressDataUrl;
    function imageFileToDataURL(fileOrBlob, cb) {
        LoadImage.parseMetaData(fileOrBlob, function(data) {
            var orientation;
            if (data.exif) {
                orientation = data.exif.get("Orientation")
            }
            var loadImageOptions = {
                orientation: orientation,
                canvas: true,
                maxWidth: 1600,
                maxHeight: 1600
            };
            LoadImage(fileOrBlob, function(canvas) {
                var maxFileSize = 2e5;
                var compressedDataURL;
                if (fileOrBlob.type === "image/jpeg") {
                    compressedDataURL = recompressJPEG(canvas, maxFileSize)
                } else {
                    compressedDataURL = canvas.toDataURL();
                    if (compressedDataURL.length > maxFileSize) {
                        compressedDataURL = compressedDataURL.length > .75 * canvas.width * canvas.height ? recompressJPEG(canvas, maxFileSize) : recompressPNG(canvas, maxFileSize)
                    }
                }
                cb(null, compressedDataURL)
            }, loadImageOptions)
        }, {
            maxMetaDataSize: 262144,
            disableImageHead: false
        })
    }
    exports.imageFileToDataURL = imageFileToDataURL
});
define("lib/aws-tools", ["require", "exports", "tslib", "jquery", "q", "lib/load-image"], function(require, exports, tslib_1, $, Q, load_image_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var textError = function(promise) {
        return promise.catch(function(reason) {
            throw new Error("Failed aws upload: " + reason.status + ". Are you online?")
        })
    };
    var verifyFile = function(type, size) {
        var err;
        if (!/^image\/(jpe?g|png|gif)$/i.test(type)) {
            err = "Invalid file type. Please use a jpeg, png or gif image."
        }
        if (!(size < 1024 * 1024 * 10)) {
            err = "File size exceeds 10MB"
        }
        if (err) {
            return Q.Promise(function() {
                throw new Error(err)
            })
        }
        return Q()
    };
    exports.uploadDataUrl = function(dataUrl, options) {
        var payload = {
            url: dataUrl,
            keyPrefix: options.keyPrefix
        };
        var imgType = (dataUrl.match(/image\/(jpe?g|png|gif)/i) || [])[0];
        var promise = verifyFile(imgType, dataUrl.length).then(function() {
            return Q($.ajax({
                type: "POST",
                contentType: "application/json",
                url: "/s3/uploadDataUrl",
                data: JSON.stringify(payload)
            }))
        });
        return textError(promise)
    }
    ;
    exports.uploadImageFile = function(file, options) {
        return verifyFile(file.type, file.size).then(function() {
            var formData = new FormData;
            formData.append("file1", file);
            formData.append("keyPrefix", options.keyPrefix);
            return $.ajax({
                type: "POST",
                url: "/s3/uploadImageFile",
                data: formData,
                cache: false,
                contentType: false,
                processData: false
            })
        })
    }
    ;
    exports.uploadCompressedImageFile = function(fileOrBlob, options) {
        return verifyFile(fileOrBlob.type, fileOrBlob.size).then(function() {
            return Q.Promise(function(resolve, reject) {
                load_image_1.imageFileToDataURL(fileOrBlob, function(err, dataUrl) {
                    if (err != null) {
                        return reject(err)
                    }
                    resolve(dataUrl)
                })
            })
        }).then(function(dataUrl) {
            return exports.uploadDataUrl(dataUrl, options)
        })
    }
    ;
    function uploadPrivateImageFile(fileOrBlob, path, studentInfo) {
        return tslib_1.__awaiter(this, void 0, Promise, function() {
            var dataUrl;
            return tslib_1.__generator(this, function(_a) {
                switch (_a.label) {
                    case 0:
                        return [4, Q.Promise(function(resolve, reject) {
                            load_image_1.imageFileToDataURL(fileOrBlob, function(err, dataUrl) {
                                if (err != null) {
                                    return reject(err)
                                }
                                resolve(dataUrl)
                            })
                        })];
                    case 1:
                        dataUrl = _a.sent();
                        return [2, uploadPrivateDataUrl(dataUrl, path, studentInfo)]
                }
            })
        })
    }
    exports.uploadPrivateImageFile = uploadPrivateImageFile;
    function uploadPrivateDataUrl(rawUrl, path, studentInfo) {
        return tslib_1.__awaiter(this, void 0, Promise, function() {
            var compressedUrl, imgType, res, e_1;
            return tslib_1.__generator(this, function(_a) {
                switch (_a.label) {
                    case 0:
                        return [4, load_image_1.compressDataUrl(rawUrl)];
                    case 1:
                        compressedUrl = _a.sent();
                        imgType = (compressedUrl.match(/image\/(jpe?g|png|gif)/i) || [])[0];
                        return [4, verifyFile(imgType, compressedUrl.length)];
                    case 2:
                        _a.sent();
                        _a.label = 3;
                    case 3:
                        _a.trys.push([3, 5, , 6]);
                        return [4, Q($.ajax({
                            type: "POST",
                            contentType: "application/json",
                            url: "/private-uploads/upload/" + path,
                            data: JSON.stringify(tslib_1.__assign({
                                dataUrl: compressedUrl
                            }, studentInfo))
                        }))];
                    case 4:
                        res = _a.sent();
                        return [2, res];
                    case 5:
                        e_1 = _a.sent();
                        throw new Error("Failed private aws upload: " + e_1.status + ". Are you online?");
                    case 6:
                        return [2]
                }
            })
        })
    }
    exports.uploadPrivateDataUrl = uploadPrivateDataUrl;
    var verifyPDF = function(type, size) {
        var err;
        if (!/^application\/pdf$/i.test(type)) {
            err = "Invalid file type. Please use a PDF."
        }
        if (!(size < 1024 * 1024 * 10)) {
            err = "File must be less than 10MB."
        }
        if (err) {
            return Q.Promise(function() {
                throw new Error(err)
            })
        }
        return Q()
    };
    exports.uploadPDFFile = function(file, options) {
        return verifyPDF(file.type, file.size).then(function() {
            var formData = new FormData;
            formData.append("file1", file);
            formData.append("keyPrefix", options.keyPrefix);
            return $.ajax({
                type: "POST",
                url: "/s3/uploadPDFFile",
                data: formData,
                cache: false,
                contentType: false,
                processData: false
            })
        })
    }
    ;
    var verifyCaptionFile = function(name, type, size) {
        var err;
        if (!/\.vtt$/i.test(name) && type !== "type/vtt") {
            err = "Invalid file type. Please use a VTT file."
        }
        if (!(size < 1024 * 1024 * 10)) {
            err = "File must be less than 10MB."
        }
        if (err) {
            return Q.Promise(function() {
                throw new Error(err)
            })
        }
        return Q()
    };
    function uploadCaptionFile(file, options) {
        return verifyCaptionFile(file.name, file.type, file.size).then(function() {
            var formData = new FormData;
            formData.append("file1", file);
            formData.append("keyPrefix", options.keyPrefix);
            return $.ajax({
                type: "POST",
                url: "/s3/uploadCaptionFile",
                data: formData,
                cache: false,
                contentType: false,
                processData: false
            })
        })
    }
    exports.uploadCaptionFile = uploadCaptionFile
});
define("loadcss!activitybuilder/components/shared/custom-url-editor", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/activitybuilder/components/shared/custom-url-editor.css", decodeURIComponent(".dcg-custom-url-editor%20%7B%0A%20%20padding%3A%2020px%3B%0A%7D%0A.dcg-custom-url-editor%20.dcg-segmented-control-layout%20%7B%0A%20%20margin-bottom%3A%2020px%3B%0A%7D%0A.dcg-custom-url-editor%20.dcg-custom-url-input%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-orient%3A%20vertical%3B%0A%20%20-moz-box-orient%3A%20vertical%3B%0A%20%20-o-box-orient%3A%20vertical%3B%0A%20%20-webkit-flex-direction%3A%20column%3B%0A%20%20-ms-flex-direction%3A%20column%3B%0A%20%20flex-direction%3A%20column%3B%0A%7D%0A.dcg-custom-url-editor%20.dcg-custom-url-warning%20%7B%0A%20%20padding%3A%2010px%3B%0A%20%20background%3A%20rgba(192%2C80%2C77%2C0.1)%3B%0A%20%20border%3A%201px%20solid%20rgba(192%2C80%2C77%2C0.5)%3B%0A%20%20border-radius%3A%203px%3B%0A%20%20margin-bottom%3A%2020px%3B%0A%7D%0A.dcg-custom-url-editor%20.dcg-custom-url-input-container%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-orient%3A%20vertical%3B%0A%20%20-moz-box-orient%3A%20vertical%3B%0A%20%20-o-box-orient%3A%20vertical%3B%0A%20%20-webkit-flex-direction%3A%20column%3B%0A%20%20-ms-flex-direction%3A%20column%3B%0A%20%20flex-direction%3A%20column%3B%0A%7D%0A.dcg-custom-url-editor%20.dcg-custom-url-input-container%20.custom-url-input%2C%0A.dcg-custom-url-editor%20.dcg-custom-url-input-container%20.dcg-custom-url-footer%20%7B%0A%20%20margin-top%3A%2010px%3B%0A%7D%0A.dcg-custom-url-editor%20.dcg-custom-url-input-container%20.custom-url-input%20%7B%0A%20%20font-size%3A%2016px%3B%0A%7D%0A.dcg-custom-url-editor%20.dcg-custom-url-input-container%20.dcg-custom-url-footer%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-pack%3A%20end%3B%0A%20%20-moz-box-pack%3A%20end%3B%0A%20%20-o-box-pack%3A%20end%3B%0A%20%20-ms-flex-pack%3A%20end%3B%0A%20%20-webkit-justify-content%3A%20flex-end%3B%0A%20%20justify-content%3A%20flex-end%3B%0A%7D%0A.dcg-custom-url-editor%20.dcg-custom-url-input-container%20.dcg-custom-url-footer.has-file-upload%20%7B%0A%20%20-webkit-box-pack%3A%20justify%3B%0A%20%20-moz-box-pack%3A%20justify%3B%0A%20%20-o-box-pack%3A%20justify%3B%0A%20%20-ms-flex-pack%3A%20justify%3B%0A%20%20-webkit-justify-content%3A%20space-between%3B%0A%20%20justify-content%3A%20space-between%3B%0A%7D%0A.dcg-custom-url-editor%20.dcg-custom-url-input-container%20.dcg-custom-url-footer%20input%5Btype%3D%22file%22%5D%20%7B%0A%20%20display%3A%20none%3B%0A%7D%0A.dcg-custom-url-editor%20.dcg-custom-url-input-container%20.dcg-custom-url-buttons%20%7B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-align%3A%20center%3B%0A%20%20-moz-box-align%3A%20center%3B%0A%20%20-o-box-align%3A%20center%3B%0A%20%20-ms-flex-align%3A%20center%3B%0A%20%20-webkit-align-items%3A%20center%3B%0A%20%20align-items%3A%20center%3B%0A%7D%0A.dcg-custom-url-editor%20.dcg-custom-url-input-container%20.dcg-cancel-button%20%7B%0A%20%20margin-right%3A%2010px%3B%0A%7D%0A"))
});
define("activitybuilder/components/shared/custom-url-editor", ["require", "exports", "tslib", "lib/i18n", "jquery", "dcgview", "browser", "underscore", "lib/ajaxmanager", "lib/class-names", "shared/dcgviews/localize", "loadcss!./custom-url-editor"], function(require, exports, tslib_1, i18n, $, DCGView, Browser, _, ajaxmanager_1, class_names_1, localize_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , If = _a.If
        , IfDefined = _a.IfDefined
        , Input = _a.Input;
    var ajax = new ajaxmanager_1.AjaxManager;
    var CustomUrlEditor = function(_super) {
        tslib_1.__extends(CustomUrlEditor, _super);
        function CustomUrlEditor() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        CustomUrlEditor.prototype.init = function() {
            this.urlInputValue = this.props.initialValue && this.props.initialValue() || "";
            var enabledMediaTypes = this.props.enabledMediaTypes();
            if (enabledMediaTypes === "image-and-video") {
                this.urlType = "image"
            } else {
                this.urlType = enabledMediaTypes
            }
            this.submitInProgress = false
        }
        ;
        CustomUrlEditor.prototype.template = function() {
            var _this = this;
            var id = _.uniqueId("fileinput_");
            return DCGView.createElement("div", {
                class: DCGView.const("dcg-custom-url-editor")
            }, IfDefined(function() {
                return _this.warning
            }, function() {
                return DCGView.createElement("div", {
                    class: DCGView.const("dcg-custom-url-warning")
                }, function() {
                    return _this.warning
                })
            }), DCGView.createElement("div", {
                class: DCGView.const("dcg-custom-url-input-container")
            }, DCGView.createElement("label", {
                class: DCGView.const("custom-url-label")
            }, this.bindFn(this.getInputLabel)), DCGView.createElement(Input, {
                class: this.const("blue-outline custom-url-input"),
                onInput: this.bindFn(this.setImageUrl),
                value: function() {
                    return _this.urlInputValue
                },
                placeholder: function() {
                    return i18n.s("image-edit-placeholder-enter-url")
                },
                didMount: function(node) {
                    if (_this.props.focusOnMount() && !Browser.SHOULD_NOT_AUTOFOCUS) {
                        node.focus();
                        node.select()
                    }
                }
            }), DCGView.createElement("div", {
                class: function() {
                    return class_names_1.classNames("dcg-custom-url-footer", {
                        "has-file-upload": !!_this.props.onFile
                    })
                }
            }, DCGView.createElement(If, {
                predicate: function() {
                    return !!_this.props.onFile
                }
            }, function() {
                return DCGView.createElement("div", {
                    class: DCGView.const("dcg-custom-url-file-upload")
                }, DCGView.createElement(localize_1.Localize, {
                    key: _this.const("ab-edit-message-upload-image-file")
                }, DCGView.createElement("label", {
                    ariaLabel: function() {
                        return i18n.s("ab-edit-button-upload-media-file")
                    },
                    role: DCGView.const("button"),
                    tabindex: DCGView.const(0),
                    class: DCGView.const("dcg-upload-image-label blue-link"),
                    for: _this.const(id)
                }, DCGView.const("Upload a file")), DCGView.createElement("input", {
                    type: DCGView.const("file"),
                    id: _this.const(id),
                    accept: DCGView.const("image/*"),
                    didMount: _this.bindFn(_this.didMountFile),
                    willUnmount: _this.bindFn(_this.willUnmountFile)
                }), DCGView.const(" "), DCGView.const("to be hosted on Desmos.")))
            }), DCGView.createElement("div", {
                class: DCGView.const("dcg-custom-url-buttons")
            }, DCGView.createElement(If, {
                predicate: function() {
                    return !!_this.props.onCancel
                }
            }, function() {
                return DCGView.createElement("span", {
                    role: DCGView.const("button"),
                    tabindex: DCGView.const(0),
                    class: DCGView.const("blue-link dcg-cancel-button"),
                    onTap: _this.props.onCancel
                }, function() {
                    return i18n.s("global-button-cancel")
                })
            }), DCGView.createElement("span", {
                role: DCGView.const("button"),
                tabindex: DCGView.const(0),
                "aria-disabled": function() {
                    return !_this.urlInputValue || _this.submitInProgress
                },
                class: function() {
                    return {
                        "btn-blue": true,
                        "dcg-textarea-submit-button": true,
                        disabled: !_this.urlInputValue
                    }
                },
                onTap: this.bindFn(this.submit)
            }, function() {
                return i18n.s("global-button-submit")
            })))))
        }
        ;
        CustomUrlEditor.prototype.getInputLabel = function() {
            if (this.urlType === "image") {
                return i18n.s("image-edit-label-custom-url")
            } else {
                return i18n.s("video-edit-label-custom-url")
            }
        }
        ;
        CustomUrlEditor.prototype.setImageUrl = function(value) {
            this.urlInputValue = value;
            this.warning = undefined;
            this.update()
        }
        ;
        CustomUrlEditor.prototype.setWarningMessage = function(warning) {
            this.warning = warning;
            this.update()
        }
        ;
        CustomUrlEditor.prototype.didMountFile = function(node) {
            var _this = this;
            var onFile = this.props.onFile;
            if (!onFile) {
                return
            }
            this.$file = $(node);
            this.$file.on("change", function(evt) {
                var file = evt.target.files[0];
                if (!!file) {
                    _this.$file.val("");
                    onFile(file)
                }
            });
            this.$file.on("mockUpload", function(_evt, blob) {
                onFile(blob)
            })
        }
        ;
        CustomUrlEditor.prototype.willUnmountFile = function() {
            if (this.$file) {
                this.$file.off()
            }
        }
        ;
        CustomUrlEditor.prototype.submit = function() {
            return tslib_1.__awaiter(this, void 0, void 0, function() {
                var url;
                var _this = this;
                return tslib_1.__generator(this, function(_a) {
                    if (!this.urlInputValue || this.submitInProgress) {
                        return [2]
                    }
                    url = this.urlInputValue;
                    this.submitInProgress = true;
                    return [2, ajax.GET(this.urlInputValue).then(function(_response, _textStatus, jqXhr) {
                        var contentType = jqXhr.getResponseHeader("content-type");
                        if (_this.fileIsImage(contentType) || _this.fileIsGif(contentType)) {
                            _this.props.setUrl({
                                mediaType: "image",
                                url: url
                            })
                        } else if (_this.fileIsVideo(contentType)) {
                            if (_this.props.enabledMediaTypes() === "image-and-video") {
                                _this.props.setUrl({
                                    mediaType: "video",
                                    url: url,
                                    codec: contentType
                                })
                            } else {
                                _this.setWarningMessage(i18n.s("image-edit-warning-video-found"))
                            }
                        } else {
                            _this.setWarningMessage(i18n.s("ab-edit-warning-custom-url-type"))
                        }
                    }).fail(function() {
                        return _this.setWarningMessage(i18n.s("ab-edit-warning-custom-url-failure"))
                    }).always(function() {
                        return _this.submitInProgress = false
                    })]
                })
            })
        }
        ;
        CustomUrlEditor.prototype.fileIsVideo = function(contentType) {
            return !!contentType.match(/video/)
        }
        ;
        CustomUrlEditor.prototype.fileIsImage = function(contentType) {
            return !!contentType.match(/image/)
        }
        ;
        CustomUrlEditor.prototype.fileIsGif = function(contentType) {
            return !!contentType.match(/gif/)
        }
        ;
        return CustomUrlEditor
    }(DCGView.Class);
    exports.CustomUrlEditor = CustomUrlEditor
});
define("loadcss!activitybuilder/components/shared/custom-url-modal", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/activitybuilder/components/shared/custom-url-modal.css", decodeURIComponent(".dcg-custom-url-modal-contents%20.modal-header%20%7B%0A%20%20color%3A%20%23666%3B%0A%7D%0A"))
});
define("activitybuilder/components/shared/custom-url-modal", ["require", "exports", "tslib", "lib/i18n", "dcgview", "shared/dcgviews/modal", "./custom-url-editor", "loadcss!./custom-url-modal"], function(require, exports, tslib_1, i18n, DCGView, modal_1, custom_url_editor_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var CustomUrlModal = function(_super) {
        tslib_1.__extends(CustomUrlModal, _super);
        function CustomUrlModal() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        CustomUrlModal.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(modal_1.Modal, {
                ariaLabel: function() {
                    return i18n.s("ab-edit-heading-modal")
                },
                className: this.const("dcg-custom-url-modal fixed-width"),
                visible: this.props.visible,
                onClose: this.props.onClose,
                showX: this.const(true)
            }, function() {
                return DCGView.createElement("div", {
                    class: DCGView.const("dcg-custom-url-modal-contents")
                }, DCGView.createElement("h1", {
                    class: DCGView.const("modal-header")
                }, function() {
                    return i18n.s("ab-edit-title-custom-image-url")
                }), DCGView.createElement(custom_url_editor_1.CustomUrlEditor, tslib_1.__assign({}, _this.props)))
            })
        }
        ;
        return CustomUrlModal
    }(DCGView.Class);
    exports.CustomUrlModal = CustomUrlModal
});
define("loadcss!shared/dcgviews/image-drop-box", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/shared/dcgviews/image-drop-box.css", decodeURIComponent(".image-drop-box%20%7B%0A%20%20border-radius%3A%204px%3B%0A%20%20-webkit-background-size%3A%20fill%3B%0A%20%20-moz-background-size%3A%20fill%3B%0A%20%20background-size%3A%20fill%3B%0A%20%20text-align%3A%20center%3B%0A%20%20position%3A%20relative%3B%0A%20%20overflow%3A%20hidden%3B%0A%20%20display%3A%20-webkit-box%3B%0A%20%20display%3A%20-moz-box%3B%0A%20%20display%3A%20-webkit-flex%3B%0A%20%20display%3A%20-ms-flexbox%3B%0A%20%20display%3A%20box%3B%0A%20%20display%3A%20flex%3B%0A%20%20-webkit-box-align%3A%20center%3B%0A%20%20-moz-box-align%3A%20center%3B%0A%20%20-o-box-align%3A%20center%3B%0A%20%20-ms-flex-align%3A%20center%3B%0A%20%20-webkit-align-items%3A%20center%3B%0A%20%20align-items%3A%20center%3B%0A%20%20-webkit-box-pack%3A%20center%3B%0A%20%20-moz-box-pack%3A%20center%3B%0A%20%20-o-box-pack%3A%20center%3B%0A%20%20-ms-flex-pack%3A%20center%3B%0A%20%20-webkit-justify-content%3A%20center%3B%0A%20%20justify-content%3A%20center%3B%0A%20%20border%3A%201px%20solid%20%23bbb%3B%0A%7D%0A.image-drop-box%20.dropbox%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%200%3B%0A%20%20left%3A%200%3B%0A%20%20bottom%3A%200%3B%0A%20%20right%3A%200%3B%0A%20%20background-position%3A%20center%20center%3B%0A%20%20background-repeat%3A%20no-repeat%3B%0A%7D%0A.image-drop-box%20.drop-image-text%20%7B%0A%20%20font-size%3A%2018px%3B%0A%20%20max-width%3A%2080%25%3B%0A%20%20pointer-events%3A%20none%3B%0A%7D%0A.image-drop-box%20.drop-image-text%20.dropbox-status-message%20%7B%0A%20%20color%3A%20%23bbb%3B%0A%20%20text-shadow%3A%20-1px%20-1px%200%20%23fff%2C%20-1px%201px%200%20%23fff%2C%201px%20-1px%200%20%23fff%2C%201px%201px%200%20%23fff%2C%200%20-1px%200%20%23fff%2C%200%201px%200%20%23fff%2C%201px%200%200%20%23fff%2C%20-1px%200%200%20%23fff%3B%0A%20%20z-index%3A%201%3B%0A%20%20position%3A%20relative%3B%0A%7D%0A.image-drop-box%20.drop-image-text%20.error%20%7B%0A%20%20color%3A%20%23c0504d%3B%0A%7D%0A.image-drop-box%3Anot(.has-image)%20%7B%0A%20%20cursor%3A%20pointer%3B%0A%7D%0A.image-drop-box.dcg-hovered%3Anot(.has-image)%20%7B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%7D%0A.image-drop-box.dcg-hovered%3Anot(.has-image)%20.drop-image-message%20%7B%0A%20%20color%3A%20%234781b9%3B%0A%7D%0A.image-drop-box.dcg-depressed%3Anot(.dragover)%3Anot(.has-image)%20.dropbox%20%7B%0A%20%20border-color%3A%20%23004f9b%3B%0A%7D%0A.image-drop-box.dcg-depressed%3Anot(.dragover)%3Anot(.has-image)%20.drop-image-message%20%7B%0A%20%20color%3A%20%23004f9b%3B%0A%7D%0A.image-drop-box.dragover%20%7B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%7D%0A.image-drop-box.dragover%20.drop-image-message%20%7B%0A%20%20color%3A%20%234781b9%3B%0A%7D%0A.image-drop-box%20input%5Btype%3D%22file%22%5D%20%7B%0A%20%20display%3A%20none%3B%0A%7D%0A.image-dropbox-container%20%7B%0A%20%20position%3A%20relative%3B%0A%7D%0A.image-dropbox-container%20.delete-img%20%7B%0A%20%20font-size%3A%2013px%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%200%3B%0A%20%20right%3A%200%3B%0A%20%20width%3A%2036px%3B%0A%20%20height%3A%2036px%3B%0A%20%20line-height%3A%2036px%3B%0A%20%20font-size%3A%2020px%3B%0A%20%20text-align%3A%20center%3B%0A%20%20z-index%3A%202%3B%0A%20%20-webkit-animation%3A%20fadeIn%200.3s%3B%0A%20%20-moz-animation%3A%20fadeIn%200.3s%3B%0A%20%20-o-animation%3A%20fadeIn%200.3s%3B%0A%20%20-ms-animation%3A%20fadeIn%200.3s%3B%0A%20%20animation%3A%20fadeIn%200.3s%3B%0A%20%20color%3A%20%23bbb%3B%0A%20%20cursor%3A%20pointer%3B%0A%20%20text-shadow%3A%20-1px%20-1px%200%20%23fff%2C%20-1px%201px%200%20%23fff%2C%201px%20-1px%200%20%23fff%2C%201px%201px%200%20%23fff%2C%200%20-1px%200%20%23fff%2C%200%201px%200%20%23fff%2C%201px%200%200%20%23fff%2C%20-1px%200%200%20%23fff%3B%0A%7D%0A.image-dropbox-container%20.delete-img.dcg-hovered%20%7B%0A%20%20color%3A%20%23c0504d%3B%0A%7D%0A.image-dropbox-container%20.delete-img.dcg-depressed%20%7B%0A%20%20color%3A%20%23ad1a1a%3B%0A%7D%0A.image-dropbox-container%20.dcg-image-edit%20%7B%0A%20%20cursor%3A%20pointer%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%200%3B%0A%20%20right%3A%200%3B%0A%20%20bottom%3A%200%3B%0A%20%20left%3A%200%3B%0A%7D%0A"))
});
define("shared/dcgviews/image-drop-box", ["require", "exports", "tslib", "lib/i18n", "jquery", "lib/aws-tools", "dcgview", "activitybuilder/components/shared/custom-url-modal", "loadcss!./image-drop-box"], function(require, exports, tslib_1, i18n, $, awsTools, DCGView, custom_url_modal_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var _a = DCGView.Components
        , If = _a.If
        , IfElse = _a.IfElse;
    function withDefault(f, val) {
        if (typeof f == "function") {
            return f()
        }
        return val
    }
    var ImageDropBox = function(_super) {
        tslib_1.__extends(ImageDropBox, _super);
        function ImageDropBox() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ImageDropBox.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                class: DCGView.const("image-dropbox-container")
            }, DCGView.createElement("div", {
                class: function() {
                    return {
                        "image-drop-box": true,
                        dragover: !!_this.dragOver,
                        "has-image": _this.getUrlImg() != null && !_this.dragOver
                    }
                }
            }, DCGView.createElement("div", {
                didMount: this.bindFn(this.didMountBox),
                class: DCGView.const("dropbox"),
                style: function() {
                    return {
                        "background-image": _this.getBgImg(),
                        "background-size": withDefault(_this.props.backgroundSize, "contain"),
                        opacity: _this.getUrlImg() == null ? .4 : undefined
                    }
                }
            }, IfElse(function() {
                return !!_this.props.allowCustomUrls && _this.props.allowCustomUrls()
            }, {
                true: function() {
                    return DCGView.createElement("div", {
                        class: DCGView.const("dcg-image-edit"),
                        onTap: _this.bindFn(_this.toggleCustomUrlModal)
                    }, DCGView.createElement(custom_url_modal_1.CustomUrlModal, {
                        visible: function() {
                            return _this.customUrlModalVisible
                        },
                        onClose: _this.bindFn(_this.toggleCustomUrlModal),
                        onCancel: _this.bindFn(_this.toggleCustomUrlModal),
                        enabledMediaTypes: _this.const("image"),
                        setUrl: function(value) {
                            _this.props.onInsert(value.url);
                            _this.toggleCustomUrlModal()
                        },
                        onFile: _this.bindFn(_this.handleFile),
                        initialValue: _this.props.img,
                        focusOnMount: _this.const(true)
                    }))
                },
                false: function() {
                    return DCGView.createElement("input", {
                        type: DCGView.const("file"),
                        accept: DCGView.const("image/*"),
                        didMount: _this.bindFn(_this.didMountFile),
                        tabindex: function() {
                            return _this.props.tabindex ? _this.props.tabindex() : 0
                        }
                    })
                }
            })), DCGView.createElement(If, {
                predicate: function() {
                    return !withDefault(_this.props.hideDelete, false) && (_this.amPending() || _this.getUrlImg() != null) && !_this.dragOver
                }
            }, function() {
                return DCGView.createElement("span", {
                    class: DCGView.const("delete-img"),
                    onTap: function() {
                        return _this.delete()
                    }
                }, DCGView.createElement("i", {
                    class: DCGView.const("pillow-icon-remove")
                }))
            }), DCGView.createElement("div", {
                class: DCGView.const("drop-image-text")
            }, DCGView.createElement(If, {
                predicate: function() {
                    return !!_this.error
                }
            }, function() {
                return DCGView.createElement("div", {
                    class: DCGView.const("error")
                }, function() {
                    return i18n.raw(_this.error || "")
                })
            }), DCGView.createElement("div", {
                class: DCGView.const("dropbox-status-message")
            }, function() {
                return function() {
                    switch (false) {
                        case !_this.error:
                            return i18n.EMPTY;
                        case !_this.dragOver:
                            return i18n.s("global-label-drop-image-here");
                        case !_this.amPending():
                            return i18n.s("global-label-uploading-your-image");
                        case !(_this.getUrlImg() == null):
                            return i18n.s("global-label-add-image-drag-or-click-upload");
                        default:
                            return i18n.EMPTY
                    }
                }()
            }))))
        }
        ;
        ImageDropBox.prototype.getBgImg = function() {
            if (this.dragOver || this.amPending()) {
                return undefined
            }
            if (this.getUrlImg() != null) {
                return this.getUrlImg()
            }
            if (typeof this.props.defaultBackgroundImg === "function") {
                return "url(" + this.props.defaultBackgroundImg() + ")"
            }
            return undefined
        }
        ;
        ImageDropBox.prototype.didMountBox = function(node) {
            var _this = this;
            this.$box = $(node);
            this.$box.on("dragenter", function() {
                _this.dragOver = true;
                return _this.update()
            });
            this.$box.on("dragleave", function() {
                _this.dragOver = false;
                return _this.update()
            });
            this.$box.on("drop", function(evt) {
                _this.dragOver = false;
                _this.dismiss();
                var files = evt.originalEvent.dataTransfer && evt.originalEvent.dataTransfer.files;
                if ((files != null ? files[0] : undefined) != null) {
                    return _this.handleFile(files[0])
                }
            });
            return this.$box.on("dcg-tap", function() {
                if (_this.getUrlImg() != null || !_this.$file || _this.props.allowCustomUrls && _this.props.allowCustomUrls()) {
                    return
                }
                return _this.$file.click()
            })
        }
        ;
        ImageDropBox.prototype.didMountFile = function(node) {
            var _this = this;
            this.$file = $(node);
            this.$file.on("change", function(evt) {
                _this.dismiss();
                var target = evt.target;
                _this.handleFile(target.files[0]);
                _this.$file.val("")
            });
            this.$file.on("mockUpload", function(_evt, url) {
                _this.props.onInsert(url)
            });
            this.$file.on("mockFile", function(_evt, file) {
                _this.handleFile(file)
            })
        }
        ;
        ImageDropBox.prototype.delete = function() {
            this.dismiss();
            if (this.props.onDelete != undefined) {
                this.props.onDelete()
            }
        }
        ;
        ImageDropBox.prototype.didMount = function() {
            return $(document).on("dragstart drag dragend dragenter dragover dragleave drop", function(evt) {
                evt.preventDefault();
                return evt.stopPropagation()
            })
        }
        ;
        ImageDropBox.prototype.dismiss = function() {
            this.error = undefined;
            this.uploadPromise = undefined;
            if (typeof this.props.onCancel === "function") {
                this.props.onCancel()
            }
            this.notifyPromise();
            this.update()
        }
        ;
        ImageDropBox.prototype.amPending = function() {
            return this.uploadPromise != null ? this.uploadPromise.isPending() : undefined
        }
        ;
        ImageDropBox.prototype.notifyPromise = function() {
            if (typeof this.props.onPromise === "function") {
                this.props.onPromise(this.uploadPromise)
            }
        }
        ;
        ImageDropBox.prototype.upload = function(file, opts) {
            if (!!file.type.match(/gif$/)) {
                return awsTools.uploadImageFile(file, opts)
            } else {
                return awsTools.uploadCompressedImageFile(file, opts)
            }
        }
        ;
        ImageDropBox.prototype.handleFile = function(file) {
            var _this = this;
            var uploadPromise;
            this.uploadPromise = uploadPromise = this.upload(file, {
                keyPrefix: this.props.keyPrefix()
            }).then(function(url) {
                if (_this.uploadPromise === uploadPromise) {
                    _this.error = undefined;
                    _this.props.onInsert(url);
                    _this.uploadPromise = undefined;
                    _this.notifyPromise();
                    _this.update()
                }
                if (_this.props.onInsertSuccess) {
                    _this.props.onInsertSuccess()
                }
            });
            this.update();
            this.notifyPromise();
            this.uploadPromise.catch(function(err) {
                if (_this.uploadPromise === uploadPromise) {
                    _this.error = err;
                    _this.uploadPromise = undefined;
                    _this.update();
                    _this.notifyPromise()
                }
            }).done()
        }
        ;
        ImageDropBox.prototype.toggleCustomUrlModal = function() {
            this.customUrlModalVisible = !this.customUrlModalVisible;
            if (this.props.onModalToggle) {
                this.props.onModalToggle(this.customUrlModalVisible)
            }
            this.update()
        }
        ;
        ImageDropBox.prototype.getUrlImg = function() {
            var img = this.props.img();
            if (img != null) {
                return "url(" + img + ")"
            }
            return undefined
        }
        ;
        return ImageDropBox
    }(DCGView.Class);
    exports.ImageDropBox = ImageDropBox
});
define("activitybuilder/components/shared/prosemirror/img-helpers", ["require", "exports", "tslib", "./helpers"], function(require, exports, tslib_1, helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.imageInsertAction = function(imageSrc, state, onAction) {
        if (!helpers_1.selectionContainsOnlyNodeTypes(state, tslib_1.__spreadArrays(helpers_1.textNodes, ["mq", "interp", "img"])))
            return false;
        var node = state.schema.nodes.image.create({
            src: imageSrc
        });
        var replace = state.tr.replaceSelectionWith(node);
        if (onAction != undefined) {
            onAction(replace)
        }
        return true
    }
});
define("activitybuilder/components/shared/prosemirror/image-menu-item-modal", ["require", "exports", "tslib", "dcgview", "i18n", "shared/dcgviews/image-drop-box", "./img-helpers", "shared/dcgviews/modal"], function(require, exports, tslib_1, DCGView, i18n, image_drop_box_1, img_helpers_1, modal_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var ImageMenuItemModal = function(_super) {
        tslib_1.__extends(ImageMenuItemModal, _super);
        function ImageMenuItemModal() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ImageMenuItemModal.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(modal_1.Modal, {
                visible: function() {
                    return _this.props.controller().imageModalVisible
                },
                ariaLabel: function() {
                    return i18n.s("prosemirror-label-upload-image")
                },
                className: this.const("pm-image-upload-modal narrow-width"),
                onClose: function() {
                    return _this.props.controller().hideImageModal()
                },
                showX: this.const(true)
            }, function() {
                return DCGView.createElement("div", {
                    class: DCGView.const("pm-image-upload-modal-contents")
                }, DCGView.createElement(image_drop_box_1.ImageDropBox, {
                    img: function() {
                        return undefined
                    },
                    onInsert: function(url) {
                        return _this.onInsert(url)
                    },
                    onInsertSuccess: function() {
                        return _this.props.controller().hideImageModal()
                    },
                    keyPrefix: _this.props.keyPrefix
                }))
            })
        }
        ;
        ImageMenuItemModal.prototype.onInsert = function(url) {
            img_helpers_1.imageInsertAction(url, this.props.proseMirrorView().state, this.props.proseMirrorView().dispatch)
        }
        ;
        return ImageMenuItemModal
    }(DCGView.Class);
    exports.ImageMenuItemModal = ImageMenuItemModal
});
define("loadcss!prosemirror", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/prosemirror.css", decodeURIComponent(".ProseMirror%20%7B%0A%20%20position%3A%20relative%3B%0A%7D%0A%0A.ProseMirror%20%7B%0A%20%20word-wrap%3A%20break-word%3B%0A%20%20white-space%3A%20pre-wrap%3B%0A%20%20white-space%3A%20break-spaces%3B%0A%20%20-webkit-font-variant-ligatures%3A%20none%3B%0A%20%20font-variant-ligatures%3A%20none%3B%0A%20%20font-feature-settings%3A%20%22liga%22%200%3B%20%2F*%20the%20above%20doesn't%20seem%20to%20work%20in%20Edge%20*%2F%0A%7D%0A%0A.ProseMirror%20pre%20%7B%0A%20%20white-space%3A%20pre-wrap%3B%0A%7D%0A%0A.ProseMirror%20li%20%7B%0A%20%20position%3A%20relative%3B%0A%7D%0A%0A.ProseMirror-hideselection%20*%3A%3Aselection%20%7B%20background%3A%20transparent%3B%20%7D%0A.ProseMirror-hideselection%20*%3A%3A-moz-selection%20%7B%20background%3A%20transparent%3B%20%7D%0A.ProseMirror-hideselection%20%7B%20caret-color%3A%20transparent%3B%20%7D%0A%0A.ProseMirror-selectednode%20%7B%0A%20%20outline%3A%202px%20solid%20%238cf%3B%0A%7D%0A%0A%2F*%20Make%20sure%20li%20selections%20wrap%20around%20markers%20*%2F%0A%0Ali.ProseMirror-selectednode%20%7B%0A%20%20outline%3A%20none%3B%0A%7D%0A%0Ali.ProseMirror-selectednode%3Aafter%20%7B%0A%20%20content%3A%20%22%22%3B%0A%20%20position%3A%20absolute%3B%0A%20%20left%3A%20-32px%3B%0A%20%20right%3A%20-2px%3B%20top%3A%20-2px%3B%20bottom%3A%20-2px%3B%0A%20%20border%3A%202px%20solid%20%238cf%3B%0A%20%20pointer-events%3A%20none%3B%0A%7D%0A"))
});
define("loadcss!activitybuilder/components/shared/prosemirror/prosemirror-custom", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/activitybuilder/components/shared/prosemirror/prosemirror-custom.css", decodeURIComponent(".prosemirror-container%20%7B%0A%20%20line-height%3A%201.2em%3B%0A%20%20position%3A%20relative%3B%0A%7D%0A.prosemirror-container%20.dcg-prosemirror-editor%20%7B%0A%20%20-webkit-animation%3A%20fadeIn%200.3s%3B%0A%20%20-moz-animation%3A%20fadeIn%200.3s%3B%0A%20%20-o-animation%3A%20fadeIn%200.3s%3B%0A%20%20-ms-animation%3A%20fadeIn%200.3s%3B%0A%20%20animation%3A%20fadeIn%200.3s%3B%0A%20%20position%3A%20relative%3B%0A%20%20z-index%3A%200%3B%0A%7D%0A.prosemirror-container%20.dcg-prosemirror-editor%20.ProseMirror%20%7B%0A%20%20outline%3A%20none%3B%0A%7D%0A.prosemirror-container%20.dcg-prosemirror-editor%20p%20%7B%0A%20%20margin%3A%200%3B%0A%20%20padding%3A%200%3B%0A%7D%0A.prosemirror-container%20.dcg-prosemirror-editor%20ul%20%7B%0A%20%20margin%3A%2010px%200%3B%0A%20%20padding%3A%200%2010px%3B%0A%20%20list-style-position%3A%20outside%3B%0A%7D%0A.prosemirror-container%20.dcg-prosemirror-editor%20ul%20li%20%7B%0A%20%20margin-left%3A%2012px%3B%0A%7D%0A"))
});
define("loadcss!prosemirror-gapcursor/gapcursor", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/vendor/prosemirror/gapcursor//gapcursor.css", decodeURIComponent(".ProseMirror-gapcursor%20%7B%0A%20%20display%3A%20none%3B%0A%20%20pointer-events%3A%20none%3B%0A%20%20position%3A%20absolute%3B%0A%7D%0A%0A.ProseMirror-gapcursor%3Aafter%20%7B%0A%20%20content%3A%20%22%22%3B%0A%20%20display%3A%20block%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-2px%3B%0A%20%20width%3A%2020px%3B%0A%20%20border-top%3A%201px%20solid%20black%3B%0A%20%20animation%3A%20ProseMirror-cursor-blink%201.1s%20steps(2%2C%20start)%20infinite%3B%0A%7D%0A%0A%40keyframes%20ProseMirror-cursor-blink%20%7B%0A%20%20to%20%7B%0A%20%20%20%20visibility%3A%20hidden%3B%0A%20%20%7D%0A%7D%0A%0A.ProseMirror-focused%20.ProseMirror-gapcursor%20%7B%0A%20%20display%3A%20block%3B%0A%7D%0A"))
});
define("activitybuilder/components/shared/prosemirror/prosemirror", ["require", "exports", "tslib", "dcgview", "jquery", "prosemirror-state", "prosemirror-view", "prosemirror-keymap", "prosemirror-commands", "prosemirror-schema-list", "underscore", "touchtracking", "./sub-manager", "./mq-node", "./prosemirror-menu", "./mq-helpers", "./interp-helpers", "./math-paste-plugin", "./activity-link-plugin", "./link-plugin", "./alignment-schema", "prosemirror-history", "prosemirror-gapcursor", "core/prosemirror/prosemirror-helpers", "./image-menu-item-modal", "loadcss!prosemirror", "loadcss!./prosemirror-custom", "loadcss!prosemirror-gapcursor/gapcursor"], function(require, exports, tslib_1, DCGView, $, prosemirror_state_1, prosemirror_view_1, prosemirror_keymap_1, prosemirror_commands_1, prosemirror_schema_list_1, _, touchtracking, sub_manager_1, mq_node_1, prosemirror_menu_1, mq_helpers_1, interp_helpers_1, math_paste_plugin_1, activity_link_plugin_1, link_plugin_1, alignment_schema_1, prosemirror_history_1, prosemirror_gapcursor_1, prosemirror_helpers_1, image_menu_item_modal_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var If = DCGView.Components.If;
    prosemirror_commands_1.baseKeymap["`"] = mq_helpers_1.mqAction;
    prosemirror_commands_1.baseKeymap["Backspace"] = prosemirror_commands_1.chainCommands(mq_helpers_1.backspaceCommand, prosemirror_commands_1.baseKeymap["Backspace"]);
    prosemirror_commands_1.baseKeymap["Delete"] = prosemirror_commands_1.chainCommands(mq_helpers_1.deleteCommand, prosemirror_commands_1.baseKeymap["Delete"]);
    prosemirror_commands_1.baseKeymap["Mod-z"] = prosemirror_history_1.undo;
    prosemirror_commands_1.baseKeymap["Shift-Mod-z"] = prosemirror_history_1.redo;
    var mac = typeof navigator != "undefined" ? /Mac/.test(navigator.platform) : false;
    if (!mac) {
        prosemirror_commands_1.baseKeymap["Mod-y"] = prosemirror_history_1.redo
    }
    var ProseMirrorView = function(_super) {
        tslib_1.__extends(ProseMirrorView, _super);
        function ProseMirrorView() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        ProseMirrorView.prototype.template = function() {
            var _this = this;
            var menu = function() {
                return DCGView.createElement("div", {
                    class: DCGView.const("dcg-do-not-blur")
                }, DCGView.createElement(prosemirror_menu_1.ProseMirrorMenu, {
                    editorView: function() {
                        return _this.proseMirrorView
                    },
                    staticMenu: _this.props.staticMenu,
                    label: _this.props.label,
                    hasFocus: _this.bindFn(_this.hasFocus),
                    controller: function() {
                        return _this.menuController
                    },
                    subManager: function() {
                        return _this.subManager
                    }
                }))
            };
            return DCGView.createElement("div", {
                class: DCGView.const("prosemirror-container")
            }, DCGView.createElement(If, {
                predicate: function() {
                    return _this.showMenu() && _this.positionMenuAboveInput()
                }
            }, menu), DCGView.createElement("div", {
                class: function() {
                    return {
                        "dcg-prosemirror-editor": true,
                        "dcg-read-only": !_this.props.editable(),
                        "dcg-focused": _this.hasFocus()
                    }
                },
                didMount: function(node) {
                    return _this.containerDidMount(node)
                },
                willUnmount: function() {
                    return _this.containerWillUnmount()
                }
            }), DCGView.createElement(If, {
                predicate: function() {
                    return _this.showMenu() && !_this.positionMenuAboveInput()
                }
            }, menu), DCGView.createElement(If, {
                predicate: function() {
                    return _this.hasImgOption()
                }
            }, function() {
                return DCGView.createElement(image_menu_item_modal_1.ImageMenuItemModal, {
                    controller: function() {
                        return _this.menuController
                    },
                    proseMirrorView: function() {
                        return _this.proseMirrorView
                    },
                    keyPrefix: function() {
                        return _this.getUploadKeyPrefix()
                    }
                })
            }))
        }
        ;
        ProseMirrorView.prototype.showMenu = function() {
            return this.menuController != undefined && this.proseMirrorView != undefined && this.subManager != undefined && this.props.editable() && !(this.props.suppressMenu && this.props.suppressMenu())
        }
        ;
        ProseMirrorView.prototype.hasImgOption = function() {
            var options = this.props.menuOptions();
            return this.showMenu() && !!options.img && options.img.enable
        }
        ;
        ProseMirrorView.prototype.getUploadKeyPrefix = function() {
            return this.props.imageUploadKeyPrefix ? this.props.imageUploadKeyPrefix() : "activitybuilder/"
        }
        ;
        ProseMirrorView.prototype.positionMenuAboveInput = function() {
            return !!(this.props.positionMenuAboveInput && this.props.positionMenuAboveInput())
        }
        ;
        ProseMirrorView.prototype.hasFocus = function() {
            if (!this.node)
                return false;
            return this.node.contains(document.activeElement)
        }
        ;
        ProseMirrorView.prototype.containerDidMount = function(node) {
            var _this = this;
            this.node = node;
            if (this.props.editable()) {
                touchtracking.ignore(node)
            }
            if (this.props.onKey) {
                $(node).on("keydown", function(e) {
                    var selection = _this.proseMirrorView.state.selection;
                    if (!selection.empty || !_this.props.onKey)
                        return;
                    var isAtBeginning = selection.from - 1 === 0;
                    var isAtEnd = prosemirror_state_1.Selection.atEnd(_this.proseMirrorView.state.doc).head === selection.to;
                    _this.props.onKey(e, isAtBeginning, isAtEnd)
                })
            }
            this.subManager = new sub_manager_1.SubManager;
            if (this.props.interpExprs) {
                var interpBackspaceCommand = interp_helpers_1.makeInterpBackspaceCommand(this.props.interpExprs);
                prosemirror_commands_1.baseKeymap["Backspace"] = prosemirror_commands_1.chainCommands(mq_helpers_1.backspaceCommand, interpBackspaceCommand, prosemirror_commands_1.baseKeymap["Backspace"])
            }
            var localKeymap = tslib_1.__assign(tslib_1.__assign({}, prosemirror_commands_1.baseKeymap), {
                Enter: prosemirror_commands_1.chainCommands(prosemirror_schema_list_1.splitListItem(this.props.config().schema.nodes.list_item), prosemirror_commands_1.baseKeymap["Enter"])
            });
            if (this.props.config().schema.marks.strong) {
                localKeymap = _.extend(localKeymap, {
                    "Mod-b": prosemirror_commands_1.toggleMark(this.props.config().schema.marks.strong)
                })
            }
            if (this.props.config().schema.marks.em) {
                localKeymap = _.extend(localKeymap, {
                    "Mod-i": prosemirror_commands_1.toggleMark(this.props.config().schema.marks.em)
                })
            }
            if (this.props.keyMapOverrides) {
                localKeymap = _.extend(localKeymap, this.props.keyMapOverrides())
            }
            var plugins = tslib_1.__spreadArrays([math_paste_plugin_1.mathPastePlugin, prosemirror_keymap_1.keymap(localKeymap), prosemirror_history_1.history(), prosemirror_gapcursor_1.gapCursor()], this.props.config().plugins || []);
            var config = {
                schema: this.props.config().schema,
                plugins: plugins
            };
            if (this.props.config().schema == alignment_schema_1.alignmentSchema) {
                config.plugins.push(link_plugin_1.rawLinkPastePlugin);
                config.plugins.push(activity_link_plugin_1.activityLinkPlugin)
            }
            var state = prosemirror_state_1.EditorState.create(config);
            var initialDoc = this.props.doc();
            if (initialDoc) {
                state = state.apply(state.tr.replaceWith(0, 2, initialDoc.content))
            }
            var nodeViews = {};
            switch (this.props.editable()) {
                case true:
                    nodeViews = {
                        mq: function(node, view, getPos) {
                            return new mq_node_1.MqEditableNodeView(node,view,getPos,_this.subManager,_this.props.resources().scientificKeypadController)
                        }
                    };
                    break;
                case false:
                    nodeViews = {
                        mq: function(node, view, getPos) {
                            return new mq_node_1.MqStaticNodeView(node,view,getPos)
                        }
                    };
                    break
            }
            var configNodeViews = this.props.config().nodeViews;
            if (configNodeViews) {
                var _loop_1 = function(nodeType) {
                    nodeViews[nodeType] = function(node, view, getPos) {
                        return configNodeViews[nodeType](node, view, getPos, _this.subManager)
                    }
                };
                for (var nodeType in configNodeViews) {
                    _loop_1(nodeType)
                }
            }
            this.proseMirrorView = new prosemirror_view_1.EditorView(node,{
                state: state,
                dispatchTransaction: function(tr) {
                    _this.proseMirrorView.updateState(_this.proseMirrorView.state.apply(tr));
                    _this.subManager.invoke(tr)
                },
                nodeViews: nodeViews,
                handleDOMEvents: {
                    focus: function() {
                        requestAnimationFrame(function() {
                            return _this.props.resources().dispatch({
                                type: "update-all"
                            })
                        });
                        if (_this.props.onFocus)
                            _this.props.onFocus(_this.node);
                        return false
                    },
                    blur: function() {
                        requestAnimationFrame(function() {
                            return _this.props.resources().dispatch({
                                type: "update-all"
                            })
                        });
                        if (_this.props.onBlur)
                            _this.props.onBlur(_this.node, _this.proseMirrorView.state);
                        return false
                    }
                },
                editable: this.props.editable,
                clipboardTextSerializer: prosemirror_helpers_1.clipboardTextSerializer,
                attributes: {
                    class: "dcg-prosemirror-view"
                },
                transformPastedHTML: function(html) {
                    return html.replace(/<br\s*\/>/g, "<p></p>")
                }
            });
            this.proseMirrorView.dom.pm = this.proseMirrorView;
            if (this.props.editable()) {
                this.proseMirrorView.dom.setAttribute("tabIndex", "0")
            }
            if (this.props.proseMirrorViewDidMount) {
                this.props.proseMirrorViewDidMount(this.proseMirrorView)
            }
            if (this.props.focusOnMount()) {
                this.proseMirrorView.focus()
            }
            this.removeToken = this.subManager.add(function(_tr) {
                var newState = _this.proseMirrorView.state;
                _this.props.onInput(newState)
            });
            this.menuController = new prosemirror_menu_1.ProseMirrorMenuController(this.props.resources(),this.proseMirrorView,this.props.menuOptions(),this.props.menuOrder && this.props.menuOrder(),this.props.interpExprs);
            requestAnimationFrame(function() {
                return _this.update()
            })
        }
        ;
        ProseMirrorView.prototype.containerWillUnmount = function() {
            if (this.props.proseMirrorViewWillUnmount) {
                this.props.proseMirrorViewWillUnmount()
            }
            this.proseMirrorView.destroy();
            $(this.node).off();
            this.removeToken()
        }
        ;
        return ProseMirrorView
    }(DCGView.Class);
    exports.ProseMirrorView = ProseMirrorView
});
define("activitybuilder/components/shared/prosemirror/placeholder-plugin", ["require", "exports", "prosemirror-state", "prosemirror-view"], function(require, exports, prosemirror_state_1, prosemirror_view_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function placeholder(text) {
        return new prosemirror_state_1.Plugin({
            props: {
                decorations: function(state) {
                    var doc = state.doc;
                    if (!doc)
                        return;
                    if (doc.firstChild && doc.firstChild.isTextblock && doc.firstChild.content.size == 0 && !doc.maybeChild(1)) {
                        return prosemirror_view_1.DecorationSet.create(doc, [prosemirror_view_1.Decoration.widget(1, function() {
                            var htmlNode = document.createElement("span");
                            htmlNode.className = "prosemirror-placeholder";
                            htmlNode.innerText = text();
                            return htmlNode
                        })])
                    }
                    return null
                }
            }
        })
    }
    exports.placeholder = placeholder
});
define("loadcss!activitybuilder/components/shared/prosemirror/rich-text-view", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/activitybuilder/components/shared/prosemirror/rich-text-view.css", decodeURIComponent(".rich-text-view.rich-text-view--editable%20.prosemirror-container%20.ProseMirror%20%7B%0A%20%20position%3A%20relative%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0A.rich-text-view.rich-text-view--editable%20.prosemirror-format-menu%20%7B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%20-36px%3B%0A%20%20right%3A%200%3B%0A%20%20width%3A%20auto%3B%0A%20%20text-align%3A%20right%3B%0A%7D%0A.rich-text-view%20.prosemirror-container%20.dcg-prosemirror-editor%20.prosemirror-placeholder%20%7B%0A%20%20color%3A%20%23bbb%3B%0A%20%20position%3A%20absolute%3B%0A%20%20top%3A%200%3B%0A%20%20left%3A%200%3B%0A%20%20z-index%3A%20-1%3B%0A%20%20padding%3A%2010px%3B%0A%20%20pointer-events%3A%20none%3B%0A%20%20-webkit-user-select%3A%20none%3B%0A%20%20-moz-user-select%3A%20none%3B%0A%20%20-ms-user-select%3A%20none%3B%0A%20%20user-select%3A%20none%3B%0A%7D%0A.rich-text-view%20.prosemirror-container%20.dcg-prosemirror-editor%20h1%20%7B%0A%20%20font-size%3A%20150%25%3B%0A%20%20line-height%3A%201.2em%3B%0A%7D%0A.rich-text-view%20.prosemirror-container%20.dcg-prosemirror-editor%20h1%2C%0A.rich-text-view%20.prosemirror-container%20.dcg-prosemirror-editor%20h2%2C%0A.rich-text-view%20.prosemirror-container%20.dcg-prosemirror-editor%20h3%20%7B%0A%20%20margin%3A%200.5em%200%3B%0A%20%20text-align%3A%20left%3B%0A%7D%0A.rich-text-view%20.prosemirror-container%20.dcg-prosemirror-editor%20a%20%7B%0A%20%20color%3A%20%234781b9%3B%0A%20%20text-decoration%3A%20underline%3B%0A%7D%0A.rich-text-view%20.prosemirror-container%20.dcg-prosemirror-editor%20a%3Ahover%2C%0A.rich-text-view%20.prosemirror-container%20.dcg-prosemirror-editor%20a.dcg-depressed%20%7B%0A%20%20color%3A%20%23004f9b%3B%0A%7D%0A.rich-text-view%20.prosemirror-container%20.dcg-prosemirror-editor%20strong%20%7B%0A%20%20font-family%3A%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans-serif%3B%0A%20%20font-weight%3A%20600%3B%0A%7D%0A"))
});
define("activitybuilder/components/shared/prosemirror/rich-text-view", ["require", "exports", "tslib", "dcgview", "./prosemirror", "core/lib/rich-text", "prosemirror-model", "./placeholder-plugin", "loadcss!./rich-text-view"], function(require, exports, tslib_1, DCGView, prosemirror_1, rich_text_1, prosemirror_model_1, placeholder_plugin_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var Switch = DCGView.Components.Switch;
    var RichTextEditView = function(_super) {
        tslib_1.__extends(RichTextEditView, _super);
        function RichTextEditView() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        RichTextEditView.prototype.template = function() {
            var _this = this;
            return DCGView.createElement("div", {
                class: function() {
                    return {
                        "rich-text-view": true,
                        "rich-text-view--editable": _this.props.editable(),
                        "rich-text-view--readonly": !_this.props.editable()
                    }
                }
            }, DCGView.createElement(prosemirror_1.ProseMirrorView, tslib_1.__assign({}, this.props, {
                doc: function() {
                    var richText = _this.props.content();
                    var schema = rich_text_1.schemas[richText.schemaKey].schema;
                    return prosemirror_model_1.Node.fromJSON(schema, richText.content)
                },
                config: function() {
                    return {
                        schema: rich_text_1.schemas[_this.props.content().schemaKey].schema,
                        plugins: _this.props.placeholder ? [placeholder_plugin_1.placeholder(_this.props.placeholder)] : []
                    }
                },
                menuOptions: function() {
                    return {
                        link: {
                            enable: true
                        },
                        h2: {
                            enable: false
                        },
                        h1: {
                            enable: false
                        }
                    }
                },
                staticMenu: this.props.staticMenu || this.const(true),
                onInput: function(pmState) {
                    _this.props.onInput(pmState)
                }
            })))
        }
        ;
        return RichTextEditView
    }(DCGView.Class);
    exports.RichTextEditView = RichTextEditView;
    var RichTextView = function(_super) {
        tslib_1.__extends(RichTextView, _super);
        function RichTextView() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        RichTextView.prototype.init = function() {
            this.key = 0
        }
        ;
        RichTextView.prototype.template = function() {
            var _this = this;
            return DCGView.createElement(Switch, {
                key: this.bindFn(this.getKey)
            }, function() {
                return DCGView.createElement(RichTextEditView, {
                    content: _this.props.content,
                    focusOnMount: _this.const(false),
                    resources: function() {
                        return {
                            dispatch: function() {},
                            get scientificKeypadController() {
                                throw new Error("Scientific keypad controller unavailable in read-only view")
                            }
                        }
                    },
                    onInput: function() {},
                    editable: _this.const(false),
                    proseMirrorViewDidMount: _this.props.proseMirrorViewDidMount
                })
            })
        }
        ;
        RichTextView.prototype.getKey = function() {
            if (this.props.content() !== this.lastContent && JSON.stringify(this.props.content()) !== JSON.stringify(this.lastContent)) {
                this.key++;
                this.lastContent = this.props.content()
            }
            return this.key
        }
        ;
        return RichTextView
    }(DCGView.Class);
    exports.RichTextView = RichTextView
});
(function(f) {
        if (typeof exports === "object" && typeof module !== "undefined") {
            module.exports = f()
        } else if (typeof define === "function" && define.amd) {
            define("flux", [], f)
        } else {
            var g;
            if (typeof window !== "undefined") {
                g = window
            } else if (typeof global !== "undefined") {
                g = global
            } else if (typeof self !== "undefined") {
                g = self
            } else {
                g = this
            }
            g.Flux = f()
        }
    }
)(function() {
    var define, module, exports;
    return function e(t, n, r) {
        function s(o, u) {
            if (!n[o]) {
                if (!t[o]) {
                    var a = typeof require == "function" && require;
                    if (!u && a)
                        return a(o, !0);
                    if (i)
                        return i(o, !0);
                    var f = new Error("Cannot find module '" + o + "'");
                    throw f.code = "MODULE_NOT_FOUND",
                        f
                }
                var l = n[o] = {
                    exports: {}
                };
                t[o][0].call(l.exports, function(e) {
                    var n = t[o][1][e];
                    return s(n ? n : e)
                }, l, l.exports, e, t, n, r)
            }
            return n[o].exports
        }
        var i = typeof require == "function" && require;
        for (var o = 0; o < r.length; o++)
            s(r[o]);
        return s
    }({
        1: [function(require, module, exports) {
            module.exports.Dispatcher = require("./lib/Dispatcher")
        }
            , {
                "./lib/Dispatcher": 2
            }],
        2: [function(require, module, exports) {
            function _classCallCheck(instance, Constructor) {
                if (!(instance instanceof Constructor)) {
                    throw new TypeError("Cannot call a class as a function")
                }
            }
            var invariant = require("./invariant");
            var _prefix = "ID_";
            var Dispatcher = function() {
                function Dispatcher() {
                    _classCallCheck(this, Dispatcher);
                    this._lastID = 1;
                    this._callbacks = {};
                    this._isPending = {};
                    this._isHandled = {};
                    this._isDispatching = false;
                    this._pendingPayload = null
                }
                Dispatcher.prototype.register = function register(callback) {
                    var id = _prefix + this._lastID++;
                    this._callbacks[id] = callback;
                    return id
                }
                ;
                Dispatcher.prototype.unregister = function unregister(id) {
                    invariant(this._callbacks[id], "Dispatcher.unregister(...): `%s` does not map to a registered callback.", id);
                    delete this._callbacks[id]
                }
                ;
                Dispatcher.prototype.waitFor = function waitFor(ids) {
                    invariant(this._isDispatching, "Dispatcher.waitFor(...): Must be invoked while dispatching.");
                    for (var ii = 0; ii < ids.length; ii++) {
                        var id = ids[ii];
                        if (this._isPending[id]) {
                            invariant(this._isHandled[id], "Dispatcher.waitFor(...): Circular dependency detected while " + "waiting for `%s`.", id);
                            continue
                        }
                        invariant(this._callbacks[id], "Dispatcher.waitFor(...): `%s` does not map to a registered callback.", id);
                        this._invokeCallback(id)
                    }
                }
                ;
                Dispatcher.prototype.dispatch = function dispatch(payload) {
                    invariant(!this._isDispatching, "Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch.");
                    this._startDispatching(payload);
                    try {
                        for (var id in this._callbacks) {
                            if (this._isPending[id]) {
                                continue
                            }
                            this._invokeCallback(id)
                        }
                    } finally {
                        this._stopDispatching()
                    }
                }
                ;
                Dispatcher.prototype.isDispatching = function isDispatching() {
                    return this._isDispatching
                }
                ;
                Dispatcher.prototype._invokeCallback = function _invokeCallback(id) {
                    this._isPending[id] = true;
                    this._callbacks[id](this._pendingPayload);
                    this._isHandled[id] = true
                }
                ;
                Dispatcher.prototype._startDispatching = function _startDispatching(payload) {
                    for (var id in this._callbacks) {
                        this._isPending[id] = false;
                        this._isHandled[id] = false
                    }
                    this._pendingPayload = payload;
                    this._isDispatching = true
                }
                ;
                Dispatcher.prototype._stopDispatching = function _stopDispatching() {
                    this._pendingPayload = null;
                    this._isDispatching = false
                }
                ;
                return Dispatcher
            }();
            module.exports = Dispatcher
        }
            , {
                "./invariant": 3
            }],
        3: [function(require, module, exports) {
            var invariant = function(condition, format, a, b, c, d, e, f) {
                if (false) {
                    if (format === undefined) {
                        throw new Error("invariant requires an error message argument")
                    }
                }
                if (!condition) {
                    var error;
                    if (format === undefined) {
                        error = new Error("Minified exception occurred; use the non-minified dev environment " + "for the full error message and additional helpful warnings.")
                    } else {
                        var args = [a, b, c, d, e, f];
                        var argIndex = 0;
                        error = new Error("Invariant Violation: " + format.replace(/%s/g, function() {
                            return args[argIndex++]
                        }))
                    }
                    error.framesToPop = 1;
                    throw error
                }
            };
            module.exports = invariant
        }
            , {}]
    }, {}, [1])(1)
});
define("core/lib/flux-wrapper", ["require", "exports", "tslib", "flux", "underscore"], function(require, exports, tslib_1, Flux, _) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var now;
    try {
        if (performance) {
            now = function() {
                return performance.now()
            }
        } else {
            throw new Error("Performance not defined")
        }
    } catch (e) {
        now = function() {
            return (new Date).getTime()
        }
    }
    var loadTime = now();
    var Dispatcher = function(_super) {
        tslib_1.__extends(Dispatcher, _super);
        function Dispatcher(options) {
            var _this = _super.call(this) || this;
            _this.options = options;
            _this.lastAction = {
                type: "initialization",
                finished: now()
            };
            _this.views = {};
            var oldDispatch = _this.dispatch;
            _this.dispatch = function(action) {
                return oldDispatch.call(_this, action)
            }
            ;
            return _this
        }
        Dispatcher.prototype.dispatch = function(action) {
            var start = now();
            if (!action.type) {
                throw new Error("Bad action: " + JSON.stringify(action))
            }
            var _onUpdateDoneCbs = [];
            _super.prototype.dispatch.call(this, tslib_1.__assign(tslib_1.__assign({}, action), {
                _onUpdateDone: function(cb) {
                    return _onUpdateDoneCbs.push(cb)
                }
            }));
            var dispatchDone = now();
            this.updateAll();
            var viewUpdateDone = now();
            for (var _i = 0, _onUpdateDoneCbs_1 = _onUpdateDoneCbs; _i < _onUpdateDoneCbs_1.length; _i++) {
                var cb = _onUpdateDoneCbs_1[_i];
                cb()
            }
            var finished = now();
            var downsample = 1e4;
            if (downsample < 1) {
                throw new Error("Downsample less than one will sample every dispatch")
            }
            if (this.options.logJSON && Math.random() * downsample < 1)
                this.options.logJSON("dispatch-sample", {
                    type: action.type,
                    w: downsample,
                    times: {
                        model: dispatchDone - start,
                        view: viewUpdateDone - dispatchDone,
                        updateDone: finished - viewUpdateDone,
                        timeSinceLoad: finished - loadTime
                    },
                    prev: {
                        type: this.lastAction.type,
                        dt: start - this.lastAction.finished
                    }
                });
            this.lastAction = {
                type: action.type,
                finished: finished
            }
        }
        ;
        Dispatcher.prototype.pushView = function(view) {
            var viewToken = _.uniqueId("viewToken_");
            this.views[viewToken] = view;
            return viewToken
        }
        ;
        Dispatcher.prototype.removeView = function(viewToken) {
            delete this.views[viewToken]
        }
        ;
        Dispatcher.prototype.register = function(handler) {
            return _super.prototype.register.call(this, function(action) {
                return handler(action, action._onUpdateDone)
            })
        }
        ;
        Dispatcher.prototype.updateAll = function() {
            if (this.view) {
                this.view.update()
            }
            for (var key in this.views) {
                this.views[key].update()
            }
        }
        ;
        return Dispatcher
    }(Flux.Dispatcher);
    exports.Dispatcher = Dispatcher
});
define("lib/flux-wrapper", ["require", "exports", "tslib", "core/lib/flux-wrapper", "lib/looker", "bugsnag"], function(require, exports, tslib_1, flux_wrapper_1, looker_1, bugsnag_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var Dispatcher = function(_super) {
        tslib_1.__extends(Dispatcher, _super);
        function Dispatcher() {
            return _super.call(this, {
                logJSON: looker_1.logJSON
            }) || this
        }
        Dispatcher.prototype.dispatch = function(action) {
            bugsnag_1.Bugsnag.leaveBreadcrumb(action.type);
            _super.prototype.dispatch.call(this, action)
        }
        ;
        return Dispatcher
    }(flux_wrapper_1.Dispatcher);
    exports.Dispatcher = Dispatcher
});
define("shared-permissions", ["require", "exports", "underscore"], function(require, exports, _) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    function canWriteAlignment(user, meta) {
        if (user.isAdmin || user.roles && user.roles.indexOf("team-desmos") != -1)
            return true;
        if (user.partner && user.partner.isAdmin && meta.licenses) {
            for (var _i = 0, _a = meta.licenses; _i < _a.length; _i++) {
                var license = _a[_i];
                if (license.type === "partner" && license.partnerId == user.partner._id) {
                    return true
                }
            }
        }
        if (user.id && (meta.collaborators || []).indexOf(user.id) > -1)
            return true;
        return false
    }
    exports.canWriteAlignment = canWriteAlignment;
    function canDeleteAlignment(user, meta, partner) {
        var collaborator = user.id && (meta.collaborators || []).indexOf(user.id) > -1;
        if (user.isAdmin || user.roles && user.roles.indexOf("team-desmos") != -1 || collaborator) {
            return meta.licenses ? !!_.find(meta.licenses, function(l) {
                return l.type === "admin"
            }) : true
        }
        if (user.partner && user.partner.isAdmin && partner && partner._id === user.partner._id) {
            return canWriteAlignment(user, meta) && partner.publishedCurriculumIds.indexOf(meta._id) === -1
        }
        return false
    }
    exports.canDeleteAlignment = canDeleteAlignment
});
define("shared/accounts/messages", ["require", "exports", "lib/i18n"], function(require, exports, i18n) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.SOMETHING_WENT_WRONG = function() {
        return i18n.s("account-error-something-went-wrong")
    }
    ;
    exports.LOGIN_WINDOW_BLOCKED = function() {
        return i18n.s("account-error-login-window-blocked")
    }
});
define("shared/get-query-params", ["require", "exports"], function(require, exports) {
    "use strict";
    return function(paramsString) {
        if (!paramsString) {
            paramsString = window.location.search.substring(1)
        }
        var match;
        var pl = /\+/g;
        var search = /([^&=]+)=?([^&]*)/g;
        function decode(s) {
            return decodeURIComponent(s.replace(pl, " "))
        }
        var query = paramsString;
        var urlParams = {};
        while (match = search.exec(query)) {
            urlParams[decode(match[1])] = match[2].length ? decode(match[2]) : "true"
        }
        return urlParams
    }
});
define("feature-flag", ["require", "exports", "shared/get-query-params"], function(require, exports, GetQueryParams) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var query = GetQueryParams();
    var flags = {
        "cl-docs-metadata": !!query["cl-docs-metadata"],
        "dummy-flag": false,
        "feedback-reactions": !!query["feedback-reactions"],
        "alp-redesign": !!query["alp-redesign"],
        sites: !!query["sites"]
    };
    function enableFeatureFlagByDefault(flag) {
        if (query[flag] !== "false") {
            flags[flag] = true
        }
    }
    exports.enableFeatureFlagByDefault = enableFeatureFlagByDefault;
    function isFeatureEnabled(flag) {
        return flags[flag]
    }
    exports.isFeatureEnabled = isFeatureEnabled;
    function retainFeature(originalURL, feature) {
        if (originalURL === "" || new RegExp("(\\?|&)" + feature + "([=&]|$)").test(originalURL) || window.location.href.indexOf(feature) === -1)
            return originalURL;
        var prependChar = originalURL.indexOf("?") === -1 ? "?" : "&";
        var paramString = "" + prependChar + feature + "=" + !!flags[feature];
        if (originalURL.length > 1 && /\/$/.test(originalURL)) {
            return "" + originalURL.slice(0, -1) + paramString + "/"
        } else {
            return "" + originalURL + paramString
        }
    }
    exports.retainFeature = retainFeature
});
define("shared/models/user", ["require", "exports", "tslib", "underscore", "lib/ajaxmanager", "shared-permissions", "../accounts/messages", "feature-flag", "core/lib/i18n"], function(require, exports, tslib_1, _, ajaxmanager_1, shared_permissions_1, messages_1, feature_flag_1, i18n_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var User = function() {
        function User(dispatcher, user) {
            var _this = this;
            this.dispatcher = dispatcher;
            this.popup_window = null;
            this.login = function(data) {
                _this._abortRequests();
                return _this._ajax.JSON("/login", {}, {
                    email: data && data.email || undefined,
                    password: data && data.password || undefined
                }).done(function(resp) {
                    if (resp && resp.success) {
                        if (resp.message && resp.message.accountReenabled) {
                            _this.showReenabledMessage = true
                        }
                        _this._fetchUserInfo()
                    }
                })
            }
            ;
            this._ajax = new ajaxmanager_1.AjaxManager;
            this._setUserInfo(user);
            this.dispatchToken = this.dispatcher.register(function(a) {
                if (a.type == "user-update") {
                    _this._setUserInfo(a.user)
                }
            })
        }
        User.prototype._fetchUserInfo = function() {
            var _this = this;
            this._ajax.abortOpenRequests();
            return this._ajax.JSON("/user/get-info", {
                retry: 1e3
            }).fail(function() {
                _this._clearUserInfo();
                _this.dispatcher.dispatch({
                    type: "user-update",
                    user: undefined
                })
            }).done(function(userInfo) {
                return _this.dispatcher.dispatch({
                    type: "user-update",
                    user: userInfo && userInfo.id ? userInfo : undefined
                })
            }).then(function() {})
        }
        ;
        User.prototype._abortRequests = function() {
            if (this.popup_window) {
                this.popup_window.close();
                this.popup_window = null
            }
            this._ajax.abortOpenRequests()
        }
        ;
        User.prototype._setUserInfo = function(userInfo) {
            this.user = userInfo;
            this.id = userInfo && userInfo.id;
            this.email = userInfo && userInfo.email || "";
            this.displayName = userInfo && userInfo.displayName || "";
            this.loggedIn = !!(userInfo && userInfo.email);
            this.isAdmin = !!(userInfo && userInfo.isAdmin);
            this.roles = userInfo && userInfo.roles || [];
            this.licenses = userInfo && userInfo.licenses || [];
            this.sites = userInfo && userInfo.sites || [];
            this.featureFlags = userInfo && userInfo.featureFlags || [];
            this.primaryEmail = userInfo && userInfo.emails && userInfo.emails[0] || undefined;
            this.subscriptions = userInfo && userInfo.subscriptions || [];
            this.credential = userInfo && userInfo.credential;
            this.partner = userInfo && userInfo.partner || undefined;
            this.status = userInfo && userInfo.status || undefined;
            this.googleSsoId = userInfo && userInfo.googleSsoId || undefined
        }
        ;
        User.prototype._clearUserInfo = function() {
            this._setUserInfo(undefined)
        }
        ;
        User.prototype.owns = function(obj) {
            return obj && (obj.userId && obj.userId == this.id || obj.user && obj.user.id && obj.user.id == this.id || obj.collaborators && _.contains(obj.collaborators, this.id) || obj.teamDesmosAuthored && this.isTeamDesmos())
        }
        ;
        User.prototype.creatorOrCollaborator = function(obj) {
            return obj && (obj.userId && obj.userId == this.id || obj.user && obj.user.id && obj.user.id == this.id || obj.collaborators && _.contains(obj.collaborators, this.id))
        }
        ;
        User.prototype.isInternal = function() {
            return !(this.credential && this.credential.external)
        }
        ;
        User.prototype.canWriteMeta = function(curriculumMeta) {
            return shared_permissions_1.canWriteAlignment(this, curriculumMeta)
        }
        ;
        User.prototype.featureAuthorized = function(featureKey) {
            return this.isAdminOrTeamDesmos() || _.contains(this.featureFlags, featureKey)
        }
        ;
        User.prototype.componentAuthorized = function(componentKey) {
            if (this.isAdminOrTeamDesmos()) {
                return true
            }
            if (componentKey == "cl") {
                return true
            }
            return _.contains(this.featureFlags, "ab-edit-" + componentKey)
        }
        ;
        User.prototype.advancedEditing = function() {
            return this.isAdminOrTeamDesmos() || this.featureAuthorized("ab-advanced-editing")
        }
        ;
        User.prototype.isAdminOrTeamDesmos = function() {
            return this.isAdmin || this.isTeamDesmos()
        }
        ;
        User.prototype.isTeamDesmos = function() {
            return this.hasRole("team-desmos")
        }
        ;
        User.prototype.hasImPilotLicense = function() {
            if (this.hasLicenses([{
                type: "product",
                productId: "im-pilot"
            }])) {
                return true
            }
            return false
        }
        ;
        User.prototype.hasRole = function(role, opts) {
            if (opts === void 0) {
                opts = {}
            }
            if (this.isAdmin && !opts.disableAdminOverride) {
                return true
            }
            return _.contains(this.roles || [], role)
        }
        ;
        User.prototype.hasLicenses = function(required) {
            var _this = this;
            if (this.isAdmin) {
                return true
            }
            return _.all(required, function(license) {
                var _a;
                var hasIndividualLicense = !!_.find(_this.licenses || [], function(l) {
                    return _.isEqual(l, license)
                });
                var hasSiteLicense = license.type === "product" && !!((_a = _this.sites) === null || _a === void 0 ? void 0 : _a.some(function(_a) {
                    var siteUser = _a.siteUser
                        , activelyLicensed = _a.activelyLicensed;
                    return siteUser.status === "accepted" && activelyLicensed.indexOf(license.productId) >= 0
                }));
                return hasIndividualLicense || hasSiteLicense
            })
        }
        ;
        User.prototype.hasCPMLicense = function() {
            if (this.isAdmin) {
                return true
            }
            return !!_.find(this.licenses || [], function(l) {
                return l.type == "product" && (l.productId == "cpm-cc1" || l.productId == "cpm-cc2" || l.productId == "cpm-cc3")
            })
        }
        ;
        User.prototype.hasDrafts = function() {
            return true
        }
        ;
        User.prototype.hasCurriculumCollections = function() {
            return feature_flag_1.isFeatureEnabled("alp-redesign") || _.contains(this.featureFlags, "ab-curriculum-collections")
        }
        ;
        User.prototype.isAmplifyAuthor = function() {
            return this.hasRole("amplifyAuthor", {
                disableAdminOverride: true
            })
        }
        ;
        User.prototype.isRenaissanceAuthor = function() {
            return this.hasRole("renaissanceAuthor", {
                disableAdminOverride: true
            })
        }
        ;
        User.prototype.getMetadataSchemaKey = function() {
            if (this.isAmplifyAuthor()) {
                return "amplify"
            }
            if (this.isTeamDesmos() && feature_flag_1.isFeatureEnabled("cl-docs-metadata")) {
                return "desmos"
            }
            return undefined
        }
        ;
        User.prototype.customUrlUploadEnabled = function() {
            return this.isAmplifyAuthor() || this.isRenaissanceAuthor()
        }
        ;
        User.prototype.dismissReenabledMessage = function() {
            this.showReenabledMessage = false
        }
        ;
        User.prototype.signup = function(data) {
            var _this = this;
            this._abortRequests();
            return this._ajax.JSON("/signup", {}, {
                name: data.name,
                email: data.email,
                password: data.password
            }).done(function(msg) {
                if (msg && msg.success) {
                    _this._fetchUserInfo()
                }
            })
        }
        ;
        User.prototype.logout = function() {
            var _this = this;
            this._abortRequests();
            return this._ajax.JSON("/logout", {
                retry: 1e3
            }).done(function() {
                return _this.dispatcher.dispatch({
                    type: "user-update",
                    user: undefined
                })
            })
        }
        ;
        User.prototype.loginGoogle = function(cb) {
            var _this = this;
            this._abortRequests();
            this.popup_window = window.open("/login/google", "drive_window", "width=650, height=530");
            if (!this.popup_window) {
                alert(messages_1.LOGIN_WINDOW_BLOCKED())
            }
            window.onGoogleLoginCallback = function(errorMessage, message) {
                if (_this.popup_window) {
                    _this.popup_window.close();
                    _this.popup_window = null
                }
                if (message && message.accountReenabled) {
                    _this.showReenabledMessage = true
                }
                _this._fetchUserInfo().always(function() {
                    if (cb) {
                        cb(errorMessage, message)
                    }
                })
            }
        }
        ;
        User.prototype.loginEmailChangeGoogle = function(changeToken, cb) {
            var _this = this;
            this._abortRequests();
            this.popup_window = window.open("/login/google?CT=" + changeToken, "drive_window", "width=650, height=530");
            if (!this.popup_window) {
                alert(messages_1.LOGIN_WINDOW_BLOCKED())
            }
            window.onGoogleLoginCallback = function(errorMessage, message) {
                _this._fetchUserInfo().always(function() {
                    if (cb)
                        cb(errorMessage, message)
                })
            }
        }
        ;
        User.prototype.authorizeGoogleClassroom = function(cb, opts) {
            var _this = this;
            if (opts === void 0) {
                opts = {}
            }
            this._abortRequests();
            var url = opts.isTemporary ? "/google-classroom/authorize?temporary" : "/google-classroom/authorize";
            this.popup_window = window.open(url, "drive_window", "width=650, height=530");
            if (!this.popup_window) {
                alert(messages_1.LOGIN_WINDOW_BLOCKED())
            }
            window.onGoogleLoginCallback = function(errorMessage) {
                if (_this.popup_window) {
                    _this.popup_window.close();
                    _this.popup_window = null
                }
                if (cb)
                    cb(errorMessage)
            }
        }
        ;
        User.prototype.setSubscriptions = function(subscriptions, onSet) {
            var _this = this;
            return this._ajax.JSON("/personal/change-subscriptions", {}, {
                subscriptions: subscriptions
            }).done(function() {
                if (_this.user) {
                    _this.dispatcher.dispatch({
                        type: "user-update",
                        user: tslib_1.__assign(tslib_1.__assign({}, _this.user), {
                            subscriptions: subscriptions
                        })
                    })
                }
                if (onSet) {
                    onSet()
                }
            })
        }
        ;
        User.prototype.setName = function(name, onSet) {
            var _this = this;
            return this._ajax.JSON("/personal/change-name", {}, {
                name: name
            }).done(function() {
                if (_this.user) {
                    _this.dispatcher.dispatch({
                        type: "user-update",
                        user: tslib_1.__assign(tslib_1.__assign({}, _this.user), {
                            displayName: name
                        })
                    })
                }
                if (onSet)
                    onSet()
            })
        }
        ;
        User.prototype._failedHelper = function(data, onFailed) {
            var _a, _b, _c;
            if (onFailed)
                if ((_c = (_b = (_a = data) === null || _a === void 0 ? void 0 : _a.error) === null || _b === void 0 ? void 0 : _b.body) === null || _c === void 0 ? void 0 : _c.packedMessage) {
                    onFailed(i18n_1.i18n.unpack(data.error.body.packedMessage))
                } else {
                    onFailed(data && data.errors && data.errors[0] && data.errors.message || messages_1.SOMETHING_WENT_WRONG())
                }
        }
        ;
        User.prototype.initiateEmailChange = function(email, onSet, onFailed) {
            var _this = this;
            return this._ajax.JSON("/personal/initiate-email-change", {}, {
                email: email
            }).fail(function(data) {
                _this._failedHelper(data, onFailed)
            }).done(function() {
                if (onSet)
                    onSet()
            })
        }
        ;
        User.prototype.changeEmail = function(_a, onSet, onFailed) {
            var _this = this;
            var changeToken = _a.changeToken
                , newEmail = _a.newEmail
                , password = _a.password
                , source = _a.source;
            return this._ajax.JSON("/personal/set-email", {}, {
                changeToken: changeToken,
                newEmail: newEmail,
                password: password,
                source: source
            }).fail(function(data) {
                _this._failedHelper(data, onFailed)
            }).done(function() {
                _this._fetchUserInfo().always(function() {
                    if (onSet)
                        onSet()
                })
            })
        }
        ;
        User.prototype.changePassword = function(password, newPassword, onSet, onFailed) {
            var _this = this;
            return this._ajax.JSON("/personal/change-password", {}, {
                password: password,
                newPassword: newPassword
            }).fail(function(data) {
                return _this._failedHelper(data, onFailed)
            }).done(function() {
                return onSet && onSet()
            })
        }
        ;
        User.prototype.initiatePasswordReset = function(email, onSet, onFailed) {
            var _this = this;
            return this._ajax.JSON("/personal/reset-password", {}, {
                email: email
            }).fail(function(data) {
                return _this._failedHelper(data, onFailed)
            }).done(function() {
                return onSet && onSet()
            })
        }
        ;
        User.prototype.resetPassword = function(_a, onSet, onFailed) {
            var _this = this;
            var resetToken = _a.resetToken
                , newPassword = _a.newPassword;
            return this._ajax.JSON("/personal/set-password", {}, {
                resetToken: resetToken,
                newPassword: newPassword
            }).fail(function(data) {
                return _this._failedHelper(data, onFailed)
            }).done(function() {
                return onSet && onSet()
            })
        }
        ;
        User.prototype.verifyEmail = function(email, onSet, onFailed) {
            var _this = this;
            return this._ajax.JSON("/personal/verify-email", {}, {
                email: email
            }).fail(function(data) {
                return _this._failedHelper(data, onFailed)
            }).done(function() {
                return onSet && onSet()
            })
        }
        ;
        User.prototype.initiateAccountDeletion = function(onSet, onFailed) {
            var _this = this;
            return this._ajax.JSON("/personal/initiate-delete-account", {}, {
                id: this.id
            }).fail(function(data) {
                return _this._failedHelper(data, onFailed)
            }).done(function() {
                return onSet && onSet()
            })
        }
        ;
        return User
    }();
    exports.User = User
});
define("shared/models/async-controller", ["require", "exports", "underscore", "q"], function(require, exports, _, Q) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var AsyncController = function() {
        function AsyncController(loader) {
            this.loader = loader;
            this.moduleCache = {};
            this.modulePromises = {};
            this._onLoadCbs = []
        }
        AsyncController.prototype.clearOnLoad = function() {
            this._onLoadCbs = []
        }
        ;
        AsyncController.prototype.onLoad = function(cb) {
            this._onLoadCbs.push(cb)
        }
        ;
        AsyncController.prototype.hasLoaderRegistered = function() {
            return this._onLoadCbs.length > 0
        }
        ;
        AsyncController.prototype.getAsyncModule = function(moduleName) {
            if (!this.moduleCache[moduleName]) {
                this.moduleCache[moduleName] = this.loader.getLoadedModule(moduleName)
            }
            return this.moduleCache[moduleName]
        }
        ;
        AsyncController.prototype.allSupported = function(modules) {
            var _this = this;
            return modules.every(function(moduleName) {
                return _this.loader.isSupported(moduleName)
            })
        }
        ;
        AsyncController.prototype.allDefined = function(modules) {
            var _this = this;
            if (modules === void 0) {
                modules = []
            }
            return _.all(modules, function(moduleName) {
                if (_this.moduleCache[moduleName] !== undefined) {
                    return true
                } else if (_this.loader.isDefined(moduleName) && !_.isEqual(_this.loader.getLoadedModule(moduleName), {})) {
                    _this.getAsyncModule(moduleName);
                    return true
                }
                return false
            })
        }
        ;
        AsyncController.prototype.anyFailed = function(modules) {
            var _this = this;
            return _.any(modules, function(moduleName) {
                return !!_this.modulePromises[moduleName] && _this.modulePromises[moduleName].isRejected()
            })
        }
        ;
        AsyncController.prototype.load = function(modules) {
            var _this = this;
            for (var _i = 0, modules_1 = modules; _i < modules_1.length; _i++) {
                var moduleName = modules_1[_i];
                if (this.modulePromises[moduleName])
                    continue;
                this.modulePromises[moduleName] = this.loader.load(moduleName, function() {
                    for (var _i = 0, _a = _this._onLoadCbs; _i < _a.length; _i++) {
                        var cb = _a[_i];
                        cb()
                    }
                })
            }
            return Q.all(modules.map(function(moduleName) {
                return _this.modulePromises[moduleName]
            }))
        }
        ;
        return AsyncController
    }();
    exports.AsyncController = AsyncController
});
define("shared/models/async-loader", ["require", "exports", "bugsnag", "q"], function(require, exports, bugsnag_1, Q) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var AsyncLoaderImpl = function() {
        function AsyncLoaderImpl() {}
        AsyncLoaderImpl.prototype.isSupported = function() {
            return true
        }
        ;
        AsyncLoaderImpl.prototype.isDefined = function(moduleName) {
            return requirejs.defined(moduleName)
        }
        ;
        AsyncLoaderImpl.prototype.getLoadedModule = function(moduleName) {
            if (!requirejs.defined(moduleName)) {
                throw new Error("Module " + moduleName + " not yet defined!")
            }
            return requirejs(moduleName)
        }
        ;
        AsyncLoaderImpl.prototype.load = function(moduleName, done) {
            var errCount = 0;
            return Q.Promise(function(resolve, reject) {
                var onSuccess = function(loadedModule) {
                    done();
                    resolve(loadedModule)
                };
                var onFail = function(err) {
                    var failedId = err.requireModules && err.requireModules[0];
                    if (failedId === moduleName && errCount < 3) {
                        console.log("retrying " + errCount);
                        errCount += 1;
                        requirejs.undef(moduleName);
                        requirejs([moduleName], function() {}, onFail)
                    } else {
                        reject(err);
                        done();
                        bugsnag_1.Bugsnag.notify({
                            moduleName: "AsyncLoadFailed",
                            message: "Permanently failed to load module " + moduleName + " in async-controller after 3 retries."
                        }, {
                            severity: "error"
                        })
                    }
                };
                requirejs([moduleName], onSuccess, onFail)
            })
        }
        ;
        return AsyncLoaderImpl
    }();
    exports.AsyncLoaderImpl = AsyncLoaderImpl
});
define("scroll_helpers", ["require"], function(require) {
    var scrollVisible = function(innerEl, outerEl, padding) {
        var newScrollTop;
        var outerHeight = outerEl.height();
        var innerHeight = innerEl.height();
        var innerOffset = innerEl.offset();
        var outerOffset = outerEl.offset();
        if (!innerOffset || !outerOffset)
            return false;
        var scrollTop = outerEl[0].scrollTop;
        var innerTop = innerOffset.top + scrollTop - outerOffset.top;
        var maxScrollTop = innerTop - padding;
        var minScrollTop = innerHeight + innerTop + padding - outerHeight;
        if (maxScrollTop >= minScrollTop) {
            newScrollTop = Math.min(Math.max(scrollTop, minScrollTop), maxScrollTop)
        } else {
            newScrollTop = .5 * (maxScrollTop + minScrollTop)
        }
        if (newScrollTop !== scrollTop) {
            outerEl[0].scrollTop = newScrollTop;
            return outerEl[0].scrollTop != scrollTop
        }
        return false
    };
    return {
        scrollVisible: scrollVisible
    }
});
define("activitybuilder/shared/scientific-keypad-controller", ["require", "exports", "tslib", "../ts-controller", "jquery", "mathquill", "browser", "scroll_helpers"], function(require, exports, tslib_1, ts_controller_1, $, MathQuill, Browser, scroll_helpers_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var eventNamespaceId = 0;
    var ScientificKeypadController = function(_super) {
        tslib_1.__extends(ScientificKeypadController, _super);
        function ScientificKeypadController(resources) {
            var _this = _super.call(this, resources) || this;
            _this.alwaysEnabled = window.location.search.indexOf("noscikeypad") == -1 && (Browser.IS_TOUCH_DEVICE || window.location.search.indexOf("scikeypad") != -1);
            _this.enabled = _this.alwaysEnabled;
            resources.dispatcher.register(function(action) {
                if (action.type === "toggle-scientific-keypad") {
                    _this.enabled = _this.alwaysEnabled || !_this.enabled;
                    if (_this.enabled) {
                        _this.scheduleActiveElementUpdate()
                    } else if (_this.state) {
                        _this.closeKeypad()
                    }
                }
            });
            _this.eventNamespace = "scikeypad" + eventNamespaceId++;
            $(document).on("dcg-tapstart." + _this.eventNamespace, function() {
                _this.tapActive = true
            });
            $(document).on("dcg-tapend." + _this.eventNamespace, function() {
                _this.tapActive = false
            });
            return _this
        }
        ScientificKeypadController.prototype.exit = function() {
            $(document).off("." + this.eventNamespace);
            _super.prototype.exit.call(this)
        }
        ;
        ScientificKeypadController.prototype.getMq = function(drawerParent) {
            if (!this.state || drawerParent !== this.state.drawerParent)
                return undefined;
            return this.state.mq
        }
        ;
        ScientificKeypadController.prototype.isOpen = function(container) {
            if (!this.state)
                return false;
            return container ? container.contains(this.state.mqNode) : true
        }
        ;
        ScientificKeypadController.prototype.isEnabled = function() {
            return this.enabled
        }
        ;
        ScientificKeypadController.prototype.isAlwaysEnabled = function() {
            return this.alwaysEnabled
        }
        ;
        ScientificKeypadController.prototype.scheduleActiveElementUpdate = function() {
            var _this = this;
            if (this.rafHandle != undefined) {
                return
            }
            if (!this.enabled && !this.state)
                return;
            this.rafHandle = requestAnimationFrame(function() {
                delete _this.rafHandle;
                if (_this.tapActive) {
                    return
                }
                _this.updateActiveElement()
            })
        }
        ;
        ScientificKeypadController.prototype.updateActiveElement = function() {
            var mqNode = document.activeElement && document.activeElement.closest(".dcg-mq-editable-field");
            if (!this.state || this.state.mqNode !== mqNode) {
                var wasVisible = !!this.state;
                var drawerParent = mqNode && $(mqNode).closest(".dcg-keypad-main-drawer").get(0);
                var mq = mqNode && MathQuill(mqNode);
                if (mqNode && mq && drawerParent && this.isAllowed(mqNode)) {
                    this.state = {
                        mq: mq,
                        mqNode: mqNode,
                        drawerParent: drawerParent
                    };
                    this.resources.dispatch({
                        type: "keypad-updated"
                    });
                    if (!wasVisible) {
                        if (Browser.IS_ANDROID) {
                            history.pushState("sci-keypad", document.title, location.href);
                            $(window).on("popstate." + this.eventNamespace, function() {
                                if (document.activeElement) {
                                    $(document.activeElement).blur()
                                }
                            })
                        }
                        scrollIntoView(mqNode)
                    }
                } else {
                    this.closeKeypad();
                    this.resources.dispatch({
                        type: "keypad-updated"
                    })
                }
            }
        }
        ;
        ScientificKeypadController.prototype.isAllowed = function(mqNode) {
            if ($(mqNode).closest(".calculator").find(".dcg-keypad").get(0)) {
                return false
            }
            if ($(mqNode).closest(".scientific-calculator").length > 0) {
                return false
            }
            if (!this.alwaysEnabled) {
                return !!mqNode.closest(".textarea-component,.dcg-expression-input-container,.dcg-table-cell-mathquill")
            }
            return true
        }
        ;
        ScientificKeypadController.prototype.closeKeypad = function() {
            var wasVisible = !!this.state;
            this.state = undefined;
            if (wasVisible) {
                if (history.state == "sci-keypad") {
                    history.back()
                }
                $(window).off("." + this.eventNamespace)
            }
        }
        ;
        return ScientificKeypadController
    }(ts_controller_1.Controller);
    exports.ScientificKeypadController = ScientificKeypadController;
    function scrollIntoView(mqNode) {
        var $pmParent = $(mqNode).closest(".ProseMirror");
        if ($pmParent.length) {
            var $scrollParent = $(mqNode).closest(".momentum-scroll");
            if ($scrollParent.length) {
                scroll_helpers_1.scrollVisible($pmParent, $scrollParent, 80)
            }
            var pm = $pmParent.get(0).pm;
            pm.dispatch(pm.state.tr.scrollIntoView())
        } else {
            var $scrollParent = $(mqNode).closest(".momentum-scroll");
            if ($scrollParent.length) {
                scroll_helpers_1.scrollVisible($(mqNode), $scrollParent, 100)
            }
        }
    }
});
define("shared/models/resources", ["require", "exports", "lib/flux-wrapper", "shared/models/user", "lib/looker", "lib/window-location-proxy", "./async-controller", "./async-loader", "activitybuilder/shared/scientific-keypad-controller"], function(require, exports, FluxWrapper, UserModel, looker_1, window_location_proxy_1, async_controller_1, async_loader_1, scientific_keypad_controller_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    var SharedResources = function() {
        function SharedResources(options) {
            var _this = this;
            this.firebasePromise = options.firebasePromise;
            this.dispatcher = new FluxWrapper.Dispatcher;
            this.dispatch = this.dispatcher.dispatch.bind(this.dispatcher);
            this.user = new UserModel.User(this.dispatcher,options.user);
            this.asyncController = new async_controller_1.AsyncController(new async_loader_1.AsyncLoaderImpl);
            this.asyncController.onLoad(function() {
                return _this.dispatch({
                    type: "async-dep-loaded"
                })
            });
            this.scientificKeypadController = new scientific_keypad_controller_1.ScientificKeypadController(this);
            this.notifyPageLoad();
            window_location_proxy_1.addHistoryChangeCb(function() {
                return _this.notifyPageLoad()
            })
        }
        SharedResources.prototype.notifyPageLoad = function() {
            var userId = undefined;
            if (this.user && this.user.id) {
                userId = this.user.id
            }
            looker_1.logPageLoad({
                userId: userId
            })
        }
        ;
        SharedResources.prototype.destroy = function() {
            window_location_proxy_1.clearHistoryChangeCallbacks()
        }
        ;
        return SharedResources
    }();
    exports.SharedResources = SharedResources
});
define("loadcss!demo/prosemirror", ["lib/inject-css"], function(injectCSS) {
    injectCSS("/mnt/jenkins/workspace/classroom-bundle-master/build/js/demo/prosemirror.css", decodeURIComponent(".prosemirror-demo%20%7B%0A%20%20padding%3A%2020px%3B%0A%20%20max-width%3A%20900px%3B%0A%20%20margin%3A%200%20auto%3B%0A%7D%0A.prosemirror-demo%20.dcg-prosemirror-editor%20%7B%0A%20%20border%3A%201px%20solid%20%23e2e2e2%3B%0A%20%20border-radius%3A%203px%3B%0A%7D%0A.prosemirror-demo%20.dcg-prosemirror-editor.dcg-focused%20%7B%0A%20%20border%3A%201px%20solid%20%234781b9%3B%0A%20%20-webkit-box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%20%20box-shadow%3A%200%200%200%201px%20%234781b9%3B%0A%7D%0A.prosemirror-demo%20.ProseMirror%20%7B%0A%20%20min-height%3A%206em%3B%0A%7D%0A.prosemirror-demo%20.description%20%7B%0A%20%20line-height%3A%201.25em%3B%0A%20%20font-size%3A%20115%25%3B%0A%20%20color%3A%20%23888%3B%0A%20%20margin-top%3A%2010px%3B%0A%20%20margin-bottom%3A%2050px%3B%0A%7D%0A.prosemirror-demo%20%3E%20h1%20%7B%0A%20%20color%3A%20%234781b9%3B%0A%20%20font-weight%3A%20normal%3B%0A%20%20margin%3A%200%3B%0A%7D%0A.prosemirror-demo%20.prosemirror-container%20%7B%0A%20%20margin%3A%2020px%200%3B%0A%7D%0A.prosemirror-demo%20.menu-item-mq%20i%20%7B%0A%20%20line-height%3A%201.6em%3B%0A%7D%0A.prosemirror-demo%20.prosemirror-output%20%7B%0A%20%20margin-bottom%3A%2030px%3B%0A%7D%0A.prosemirror-demo%20.prosemirror-output%20pre%20%7B%0A%20%20border%3A%201px%20solid%20%23ccc%3B%0A%20%20background%3A%20%23f0f0f0%3B%0A%20%20padding%3A%2010px%3B%0A%20%20border-radius%3A%203px%3B%0A%20%20white-space%3A%20pre-wrap%3B%0A%7D%0A"))
});
define("demo/prosemirror", ["require", "exports", "tslib", "dcgview", "activitybuilder/components/shared/prosemirror/rich-text-view", "core/lib/rich-text", "core/lib/rich-text-helpers", "lib/i18n", "l10n/context", "shared/models/resources", "core/prosemirror/prosemirror-serialize", "loadcss!./prosemirror"], function(require, exports, tslib_1, DCGView, rich_text_view_1, rich_text_1, rich_text_helpers_1, i18n_1, context_1, resources_1, prosemirror_serialize_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    i18n_1.initialize(new context_1.BrowserLocalizationContext);
    var text = "Type here. Text or... `\\frac{1}{2}+\\frac{3}{4}` math! ";
    var doc = prosemirror_serialize_1.stringToNode(text, rich_text_1.schemas.document.schema);
    var resources = new resources_1.SharedResources({
        user: undefined
    });
    var Main = function(_super) {
        tslib_1.__extends(Main, _super);
        function Main() {
            return _super !== null && _super.apply(this, arguments) || this
        }
        Main.prototype.template = function() {
            return DCGView.createElement("div", {
                class: DCGView.const("prosemirror-demo")
            }, DCGView.createElement("h1", null, DCGView.const("Desmos Demo: Math+Text")), DCGView.createElement("div", {
                class: DCGView.const("description")
            }, DCGView.const("This is a textbox that you can also type math into. Type ` (backtick), or press the f(x) button to go into equation mode. Built by"), DCGView.const(" "), DCGView.createElement("a", {
                href: DCGView.const("https://www.desmos.com/"),
                target: DCGView.const("_blank")
            }, DCGView.const("Desmos")), DCGView.const(", and powered by the wonderful folks at"), DCGView.const(" "), DCGView.createElement("a", {
                href: DCGView.const("http://mathquill.com/"),
                target: DCGView.const("_blank")
            }, DCGView.const("Mathquill")), DCGView.const(" "), DCGView.const("and"), DCGView.const(" "), DCGView.createElement("a", {
                href: DCGView.const("https://prosemirror.net/"),
                target: DCGView.const("_blank")
            }, DCGView.const("ProseMirror")), DCGView.const(".")), DCGView.createElement(rich_text_view_1.RichTextEditView, {
                content: function() {
                    return rich_text_helpers_1.richTextFromNode("document", doc)
                },
                resources: function() {
                    return resources
                },
                focusOnMount: this.const(true),
                onInput: function(pmState) {
                    text = prosemirror_serialize_1.nodeToString(pmState.doc);
                    doc = pmState.doc;
                    resources.dispatch({
                        type: "render"
                    })
                },
                editable: this.const(true)
            }), DCGView.createElement("div", {
                class: DCGView.const("prosemirror-output")
            }, DCGView.createElement("div", {
                class: DCGView.const("description")
            }, DCGView.const("Document representation:")), DCGView.createElement("pre", null, function() {
                return JSON.stringify(doc != undefined ? doc.toJSON() : undefined, null, 2)
            })), DCGView.createElement("div", {
                class: DCGView.const("prosemirror-output")
            }, DCGView.createElement("div", {
                class: DCGView.const("description")
            }, DCGView.const("Serialized representation:")), DCGView.createElement("pre", null, function() {
                return text
            })))
        }
        ;
        return Main
    }(DCGView.Class);
    var view = DCGView.mountToNode(Main, document.body, undefined);
    resources.dispatcher.pushView(view)
});
define("testbridge", ["require"], function(require) {
    function override() {
        window.consoleOverride = true;
        var originalLog = window.console.log;
        window.console.log = function() {
            var args = [];
            for (var i = 0; i < arguments.length; i++) {
                args.push(arguments[i])
            }
            originalLog.apply(window.console, [].concat([args.join(" ")], args))
        }
    }
    var TestBridge = {
        ready: function() {
            try {
                window.TestBridge = TestBridge;
                if (parent.USING_SELENIUM) {
                    override()
                }
            } catch (e) {}
        }
    };
    return TestBridge
});
